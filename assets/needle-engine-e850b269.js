var GL=Object.defineProperty;var HL=(n,t,e)=>t in n?GL(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>(HL(n,typeof t!="symbol"?t+"":t,e),e),Pb=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var ke=(n,t,e)=>(Pb(n,t,"read from private field"),e?e.call(n):t.get(n)),Qi=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},ji=(n,t,e,i)=>(Pb(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);var Mh=(n,t,e)=>(Pb(n,t,"access private method"),e);import{V as oe,a as w,b as Fe,Q as ie,B as Wc,c as Ke,d as Ht,C as be,D as _i,E as hc,F as Or,e as il,L as Mt,M as J,f as _t,O as ne,P as ic,g as pr,S as $e,T as At,h as Xa,i as Bu,j as bt,k as ws,U as $,W as Pu,l as xn,m as Kn,n as jt,o as AP,p as vP,G as TC,q as mt,r as za,s as ae,t as go,u as VL,v as qs,w as Et,x as gi,y as Ge,z as RC,A as WL,H as qL,I as yP,J as Ni,N as xu,R as bP,K as Vv,X as BC,Y as XL,Z as mi,_ as mo,$ as Wi,a0 as nc,a1 as _m,a2 as _P,a3 as Ks,a4 as Uf,a5 as wP,a6 as Lw,a7 as xP,a8 as l0,a9 as CP,aa as SP,ab as EP,ac as IP,ad as YL,ae as qc,af as Pd,ag as KL,ah as Fw,ai as TP,aj as ch,ak as ef,al as PC,am as Ng,an as zg,ao as bo,ap as JL,aq as Dc,ar as ZL,as as $L,at as Up,au as Jo,av as Ur,aw as Zo,ax as xf,ay as ms,az as eF,aA as mv,aB as Lr,aC as ct,aD as Mu,aE as MC,aF as ql,aG as Wv,aH as kC,aI as m1,aJ as RP,aK as BP,aL as PP,aM as qv,aN as Xv,aO as MP,aP as Xc,aQ as Yv,aR as Uw,aS as Kv,aT as uc,aU as tF,aV as iF,aW as nF,aX as sF,aY as rF,aZ as oF,a_ as aF,a$ as lF,b0 as cF,b1 as hF,b2 as uF,b3 as dF,b4 as tf,b5 as Zn,b6 as fF,b7 as pF,b8 as gF,b9 as A1,ba as kP,bb as mh,bc as dr,bd as DP,be as mF,bf as on,bg as AF,bh as vF,bi as yF,bj as OP,bk as Us,bl as bF,bm as ku,bn as _F,bo as LP,bp as wF,bq as xF,br as cn,bs as oA,bt as lp,bu as FP,bv as Md,bw as Hs,bx as Hn,by as Ya,bz as Cf,bA as CF,bB as SF,bC as Av,bD as EF,bE as UP,bF as IF,bG as TF,bH as RF,bI as Nw,bJ as DC,bK as od,bL as ad,bM as v1,bN as y1,bO as BF,bP as PF,bQ as zw,bR as MF,bS as NP,bT as Qg,bU as c0,bV as OC,bW as LC,bX as h0,bY as kF,bZ as DF,b_ as OF,b$ as LF,c0 as FF,c1 as UF,c2 as NF,c3 as zF,c4 as QF,c5 as jF,c6 as GF,c7 as HF,c8 as VF,c9 as WF,ca as qF,cb as b1,cc as XF,cd as zP,ce as YF,cf as _1,cg as QP,ch as KF,ci as JF,cj as ZF,ck as jP,cl as Qw,cm as $F,cn as u0,co as nf,cp as FC,cq as d0,cr as GP,cs as eU,ct as tU,cu as iU,cv as Gs,cw as nU,cx as sU,cy as rU,cz as oU,cA as aU}from"./three.module-19edce0d.js";import{_ as hh}from"./index-ceb733d4.js";let HP,w1=null;function nl(){return HP}function VP(n){if(n==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}w1!==n&&(w1=n,HP=new n)}const Mb=new Map;function fr(n=(t=>(t=globalThis.location)==null?void 0:t.hostname)()){if(Mb.has(n))return Mb.get(n);const e=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(n);return Mb.set(n,e),e===!0}function lU(){return window.location.hostname.includes("glitch.me")}var dt;(function(n){n.ContextRegistered="ContextRegistered",n.ContextCreationStart="ContextCreationStart",n.ContextCreated="ContextCreated",n.ContextFirstFrameRendered="ContextFirstFrameRendered",n.ContextDestroying="ContextDestroying",n.ContextDestroyed="ContextDestroyed",n.MissingCamera="MissingCamera",n.ContextClearing="ContextClearing",n.ContextCleared="ContextCleared"})(dt||(dt={}));class xt{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(t){globalThis["NeedleEngine.Context.Current"]=t}static get All(){return this.Registered}static register(t){this.Registered.push(t),this.dispatchCallback(dt.ContextRegistered,t)}static unregister(t){const e=this.Registered.indexOf(t);e!==-1&&this.Registered.splice(e,1)}static registerCallback(t,e){this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(e)}static unregisterCallback(t,e){if(!this._callbacks[t])return;const i=this._callbacks[t].indexOf(e);i!==-1&&this._callbacks[t].splice(i,1)}static dispatchCallback(t,e,i){if(!this._callbacks[t])return!0;const s={event:t,context:e};if(i)for(const o in i)s[o]=i[o];const r=new Array;return this._callbacks[t].forEach(o=>{const a=o(s);a instanceof Promise&&r.push(a)}),Promise.all(r)}static addContextCreatedCallback(t){this.registerCallback(dt.ContextCreated,t)}static addContextDestroyedCallback(t){this.registerCallback(dt.ContextDestroyed,t)}}c(xt,"Registered",[]),c(xt,"_callbacks",{});const cU=()=>n=>n;function iK(n){return cU()(n)}function nK(){return!!z("debug")}class _o{constructor(t,e){c(this,"_factory");c(this,"_cache",[]);c(this,"_maxSize");c(this,"_index",0);this._factory=t,this._maxSize=e}get(){const t=this._index%this._maxSize;return this._index++,this._cache.length<=t&&(this._cache[t]=this._factory()),this._cache[t]}}let qh=!1;const jw=new Array;typeof window<"u"&&setTimeout(()=>{if(qh){const n={},t=new URL(window.location.href),e=new URL(t);e.searchParams.append("console","");const i=e.toString().replace(/=$|=(?=&)/g,"");for(const r of jw){const o=new URL(t);o.searchParams.append(r,""),n[r]=o.toString().replace(/=$|=(?=&)/g,"")}console.log(`ðŸŒµ ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${i} will show an onscreen console window.`);const s=qh===!0?"":` (containing "${qh}")`;console.group("Available URL parameters:"+s);for(const r in n)typeof qh=="string"&&!r.toLowerCase().includes(qh.toLowerCase())||(console.groupCollapsed(r),console.log("Reload with this flag enabled:"),console.log(n[r]),console.groupEnd());console.groupEnd()}},100);function f0(){var n;return new URLSearchParams((n=globalThis.location)==null?void 0:n.search)}function z(n){qh&&!jw.includes(n)&&jw.push(n);const t=f0();if(t.has(n)){const e=t.get(n);if(e){const i=Number(e);return isNaN(i)?e:i}else return!0}return!1}qh=z("help");function sK(n,t){const e=f0();e.has(n)?e.set(n,t):e.append(n,t),document.location.search=e.toString()}function Gw(n,t,e=!0){const i=f0();i.has(n)?t===null?i.delete(n):i.set(n,t):t!==null&&i.append(n,t),e?hU(n,i):WP(n,i)}function x1(n,t,e){n.has(t)?n.set(t,e.toString()):n.append(t,e.toString())}function hU(n,t,e){window.history.pushState(e,n,"?"+t.toString())}function WP(n,t,e){window.history.replaceState(e,n,"?"+t.toString())}function rK(n){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=e.length,s=0;s<n;s++)t+=e.charAt(Math.floor(Math.random()*i));return t}function oK(n,t){return Math.floor(Math.random()*(t-n+1))+n}const C1=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],S1=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function uU(){const n=C1[Math.floor(Math.random()*C1.length)],t=S1[Math.floor(Math.random()*S1.length)];return n+"_"+t}function dU(n){return n=n.replace(/[^a-z0-9Ã¡Ã©Ã­Ã³ÃºÃ±Ã¼ \.,_-]/gim,""),n.trim()}function jg(n,t,e=!0,i=!1){var s;if(t==null)return null;if(t.userData&&t.userData.guid===n)return t;if(t.guid==n)return t;if(i&&(s=t.userData)!=null&&s.components){for(const r of t.userData.components)if(r.guid===n)return r}if(e){if(t.scenes)for(const r in t.scenes){const o=t.scenes[r],a=jg(n,o,e,i);if(a)return a}if(t.children)for(const r in t.children){const o=t.children[r],a=jg(n,o,e,i);if(a)return a}}}function p0(n,t){if(n!=null&&typeof n=="object"){let e;Array.isArray(n)?e=[]:(e=Object.create(n),Object.assign(e,n));for(const i of Object.keys(n)){const s=n[i];t&&!t(n,i,s)?e[i]=s:(s==null?void 0:s.clone)!==void 0&&typeof s.clone=="function"?e[i]=s.clone():e[i]=p0(s,t)}return e}return n}function sc(n){return new Promise((t,e)=>{setTimeout(t,n)})}function UC(n,t){if(n<=0)return Promise.resolve();if(t||(t=xt.Current),!t)return Promise.reject("No context");const e=t.time.frameCount+n;return new Promise((i,s)=>{if(!t)return s("No context");const r=()=>{t.time.frameCount>=e&&(t.pre_update_callbacks.splice(t.pre_update_callbacks.indexOf(r),1),i())};t.pre_update_callbacks.push(r)})}const aA=z("debugresolveurl"),fU="rel:";function aK(n,t){return Du(n,t)}function Du(n,t){if(t===void 0)return aA&&console.warn("getPath: uri is undefined, returning uri",t),t;if(t.startsWith("./"))return t;if(t.startsWith("http"))return aA&&console.warn("getPath: uri is absolute, returning uri",t),t;if(n===void 0)return aA&&console.warn("getPath: source is undefined, returning uri",t),t;t.startsWith(fU)&&(t=t.substring(4));const e=n.lastIndexOf("/");if(e>=0){const i=n.substring(0,e+1);for(;i.endsWith("/")&&t.startsWith("/");)t=t.substring(1);const s=i+t;return aA&&console.log("source:",n,`changed uri 
from`,t,`
to `,s,`
basePath: `+i),s}return t}class pU{constructor(t,e){c(this,"writeCallbacks",[]);c(this,"_applied",!1);c(this,"_object");c(this,"_prop");c(this,"_wrapperProp");this._object=t,this._prop=e,this._wrapperProp=Symbol("$"+e),this.apply()}subscribeWrite(t){this.writeCallbacks.push(t)}unsubscribeWrite(t){const e=this.writeCallbacks.indexOf(t);e!==-1&&this.writeCallbacks.splice(e,1)}apply(){if(this._applied||!this._object)return;const t=this._object,e=this._prop;if(t[e]===void 0)return;this._applied=!0,t[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const i=t[e];t[this._wrapperProp]=i,Object.defineProperty(t,e,{get:()=>t[this._wrapperProp],set:o=>{t[this._wrapperProp]=o;for(const a of this.writeCallbacks)a(o,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const t=this._object,e=this._prop;Reflect.deleteProperty(t,e);const i=t[this._wrapperProp];t[e]=i,Reflect.deleteProperty(t,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class $c{constructor(t,e){c(this,"_watches",[]);if(Array.isArray(e))for(const i of e)this._watches.push(new $c(t,i));else this._watches.push(new pU(t,e))}subscribeWrite(t){for(const e of this._watches)e.subscribeWrite(t)}unsubscribeWrite(t){for(const e of this._watches)e.unsubscribeWrite(t)}apply(){for(const t of this._watches)t.apply()}revoke(){for(const t of this._watches)t.revoke()}dispose(){for(const t of this._watches)t.dispose();this._watches.length=0}}const _d=Symbol("needle:watches");function NC(n,t){if(!n[_d])if(n instanceof oe)n[_d]=new $c(n,["x","y"]);else if(n instanceof w)n[_d]=new $c(n,["x","y","z"]);else if(n instanceof Fe||n instanceof ie)n[_d]=new $c(n,["x","y","z","w"]);else return!1;return n[_d].subscribeWrite(t),!0}function qP(n,t){if(!n)return;const e=n[_d];e&&e.unsubscribeWrite(t)}let kb;function Gg(){if(kb!==void 0)return kb;const n=window.navigator.userAgent,t=/Windows|MacOS|Mac OS/.test(n),e=/Windows NT/.test(n)&&/Edg/.test(n)&&!/Win64/.test(n);return kb=t&&!e&&!uh()}let lA;function dc(){return lA!==void 0?lA:typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1?lA=!0:lA=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)}function gU(){return/Android/.test(navigator.userAgent)}function sf(){return/WebXRViewer\//i.test(navigator.userAgent)}let cA;function E1(){if(cA!==void 0)return cA;if(navigator.userAgentData)return cA=navigator.userAgentData.platform==="macOS";{const n=navigator.userAgent.toLowerCase();return cA=n.includes("mac os x")||n.includes("macintosh")}}let Db;const mU=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function uh(){return Db!==void 0?Db:Db=mU.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function eg(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function zC(){return navigator.userAgent.includes("OculusBrowser")}async function hA(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(n){return console.error("Error querying `microphone` permissions.",n),!1}}const AU=/ip=(?<ip>.+?)\n/s;async function lK(){const t=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),e=AU.exec(t);return e?e[1]:null}async function cK(){return(await(await fetch("https://api.db-ip.com/v2/free/self")).json()).ipAddress}async function hK(){return await(await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null)).json()}const Yc=new WeakMap;function vU(n,t,e){if(!Yc.get(n)){const s=new MutationObserver(r=>{bU(n,r)});Yc.set(n,{observer:s,attributeChangedListeners:new Map}),s.observe(n,{attributes:!0})}const i=Yc.get(n).attributeChangedListeners;i.has(t)||i.set(t,[]),i.get(t).push(e)}function yU(n,t,e){if(!Yc.get(n))return;const i=Yc.get(n).attributeChangedListeners;if(!i.has(t))return;const s=i.get(t),r=s.indexOf(e);if(r!==-1&&(s.splice(r,1),s.length<=0)){i.delete(t);const o=Yc.get(n);o==null||o.observer.disconnect(),Yc.delete(n)}}function bU(n,t){const e=Yc.get(n).attributeChangedListeners;for(const i of t)if(i.type==="attributes"){const s=i.attributeName,r=n.getAttribute(s);if(e.has(s))for(const o of e.get(s))o(r)}}class I1{constructor(t){c(this,"reason");this.reason=t}}async function QC(n){const t=await Promise.allSettled(n).catch(s=>[new I1(s.message)]);let e=!1;const i=t.map(s=>"value"in s?s.value:(e=!0,new I1(s.reason)));return{anyFailed:e,results:i}}async function _U(n){if(!globalThis.QRCode){const i="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let s=document.head.querySelector(`script[src="${i}"]`);s||(s=document.createElement("script"),s.src=i,document.head.appendChild(s)),await new Promise((r,o)=>{s.addEventListener("load",()=>{r(!0)})})}const t=globalThis.QRCode,e=n.domElement??document.createElement("div");return new t(e,{width:n.width??256,height:n.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:t.CorrectLevel.M,...n}),e}const XP=z("debugdebug");let Hg=!1;(z("noerrors")||z("nooverlaymessages"))&&(Hg=!0);const Ob="needle_engine_global_error_container";var Xi;(function(n){n[n.Log=0]="Log",n[n.Warn=1]="Warn",n[n.Error=2]="Error"})(Xi||(Xi={}));function jC(){return JP}const Hw=new Array;function wU(n){Hw.push(n)}let Lb=!1;function xU(...n){if(!Lb){Lb=!0;try{for(let t=0;t<Hw.length;t++)Hw[t](...n)}catch(t){console.error(t)}Lb=!1}}const YP=console.error,KP=function(...n){YP.apply(console,n),EU(n),Qa(Xi.Error,n),Vw(...n)};function CU(n){Hg=!n,n?console.error=KP:console.error=YP}function uK(n){return CU(n)}function SU(){Hg||(XP&&console.warn("Patch console",window.location.hostname),console.error=KP,window.addEventListener("error",n=>{if(!n)return;const t=n.error;if(t===void 0){fr()&&console.warn("Received unknown error",n,n.target);return}Qa(Xi.Error,t,n.filename,n.lineno),Vw(n)},!0),window.addEventListener("unhandledrejection",n=>{Hg||n&&(n.reason?Qa(Xi.Error,n.reason.message,n.reason.stack):Qa(Xi.Error,"unhandled rejection"),Vw(n))}))}let JP=0;function Vw(...n){JP+=1,xU(...n)}function EU(n){if(Array.isArray(n))for(let t=0;t<n.length;t++){const e=n[t];typeof e=="string"&&e.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(n[t]="Some animated objects couldn't be found: see console for details")}}function Qa(n,t,e,i){if(Hg)return;const s=xt.Current,r=(s==null?void 0:s.domElement)??document.querySelector("needle-engine");if(r){if(Array.isArray(t)){let o="";for(let a=0;a<t.length;a++){let l=t[a];l instanceof Error&&(l=l.message),typeof l!="object"&&(a>0&&(o+=" "),o+=l)}t=o}!t||t.length<=0||IU(n,r,t)}}const tg=new Map;function IU(n,t,e){if(e==null)return;const i=RU(t);if(i.childElementCount>=20){const a=i.lastElementChild;T1(a)}e.length>400&&(e=e.substring(0,400)+"...");const s=e;if(tg.has(s))return;const r=BU(n,e);i.prepend(r);const o=()=>{tg.delete(s),T1(r)};tg.set(s,o),setTimeout(o,1e4)}function dK(){XP&&console.log("Clearing messages");for(const n of tg.values())n==null||n.call(n);tg.clear()}const TU=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
    font-size: 16px;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function RU(n){globalThis[Ob]||(globalThis[Ob]=new Map);const t=globalThis[Ob];if(t.has(n))return t.get(n);{const e=document.createElement("div");t.set(n,e),e.setAttribute("data-needle_engine_debug_overlay",""),e.classList.add("debug-container"),e.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,n.shadowRoot?n.shadowRoot.appendChild(e):n.appendChild(e);const i=document.createElement("style");return i.innerHTML=TU,e.appendChild(i),e}}const ZP=Symbol("logtype"),Jv=new Map;function T1(n){n.remove();const t=n[ZP],e=Jv.get(t)??[];e.push(n),Jv.set(t,e)}function BU(n,t){if(Jv.has(n)){const i=Jv.get(n);if(i.length>0){const s=i.pop();return s.innerHTML=t,s}}const e=document.createElement("div");switch(e.setAttribute("data-id","__needle_engine_debug_overlay"),e.style.marginRight="5px",e.style.padding=".5em",e.style.backgroundColor="rgba(0,0,0,.9)",e.style.marginTop="5px",e.style.marginBottom="3px",e.style.borderRadius="8px",e.style.pointerEvents="all",e.style.userSelect="text",e.style.maxWidth="250px",e.style.whiteSpace="pre-wrap",e.style["backdrop-filter"]="blur(10px)",e.style["-webkit-backdrop-filter"]="blur(10px)",e.style.backgroundColor="rgba(20,20,20,.8)",e.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",e.style.border="1px solid rgba(160,160,160,.2)",e[ZP]=n,n){case Xi.Log:e.classList.add("log"),e.style.color="rgba(200,200,200,.7)",e.style.backgroundColor="rgba(40,40,40,.7)";break;case Xi.Warn:e.classList.add("warn"),e.style.color="rgb(255, 255, 150)",e.style.backgroundColor="rgba(50,50,20,.8)";break;case Xi.Error:e.classList.add("error"),e.style.color="rgb(255, 50, 50",e.style.backgroundColor="rgba(50,20,20,.8)";break}return e.title="Open the browser console (F12) for more information",e.innerHTML=t,e}var $o={};$o.d=(n,t)=>{for(var e in t)$o.o(t,e)&&!$o.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})};$o.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);$o.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var Yi={};$o.d(Yi,{ti:()=>Ot,nS:()=>FM,eB:()=>qg,Yp:()=>GC,VB:()=>Cu,BC:()=>wm,zN:()=>Ou,cV:()=>Ef,hW:()=>Yg,k2:()=>iM,K6:()=>ao,M7:()=>HC,ls:()=>xm,Hi:()=>yM,EY:()=>Xg,MR:()=>uM,zf:()=>tM,Ay:()=>V4,yo:()=>UM});var GC={};$o.r(GC);$o.d(GC,{get:()=>$P,set:()=>PU});var HC={};$o.r(HC);$o.d(HC,{alphaTestTransformer:()=>m0,asPreprocessorValueTransformer:()=>dM,toPreprocessorTriggerTransformer:()=>tS,toUserDataTransformer:()=>j3,uniformOrUserDataTransformer:()=>so});const Ww={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},PU=function(n){for(const t in n)Ww[t]=n[t]},$P=function(n){return Object.prototype.hasOwnProperty.call(Ww,n)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${n}'`),Ww[n]};class Ot{constructor(t,e=null,i=!0){this._id=t,this._value=e,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=i}get id(){return this._id}get value(){return this._value}set value(t){this.isValid(t)&&this._value!==t&&(this._value=t,this._needsUpdate=!0)}update(t,e){this.output(e)}output(t){}_outputValue(t){t[this._id]=this._value}process(t){}render(t){}getInheritedInput(t){if(this._value!=="inherit")return this._value;const e=t._parent._value;return e&&e[`_${this._id}`]?e[`_${this._id}`].getInheritedInput(e):this.getDefaultValue()}getDefaultValue(){return $P(this._id)}isValid(t){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class MU extends Ot{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(t){this.isValid(t)&&(this._value=t,this._needsUpdate=!0)}update(t,e){if(this._value!=="auto")this._actualValue=this._value;else{const i=t._parent._value;if(i!==null){const s=i._renderOrder._actualValue,r=1+i._children._uis.indexOf(t);this._actualValue=s+r}}for(const i of t._children._uis)i._renderOrder._value==="auto"&&(i._renderOrder._needsUpdate=!0);this._outputValue(e)}_outputValue(t){t[this._id]=this._actualValue}get value(){return this._value}}class Ou extends Ot{constructor(t,e=null,i=!0){super(t,e,i),this.output=this._outputValue,this._notInheritedValue=null}update(t,e){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(t)),this.propagate(t),this._outputValue(e)}propagate(t){for(const e of t._children._uis){const i=e[`_${this._id}`];i!==void 0&&i._value==="inherit"&&(e[`_${this._id}`]._needsUpdate=!0)}}_outputValue(t){t[this._id]=this._notInheritedValue}set value(t){this.isValid(t)&&this._value!==t&&(this._value=t,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class kU extends Ou{constructor(){super("offset","inherit",!1)}update(t,e){super.update(t,e),t._parent._value!==null&&(t.position.z=this._notInheritedValue)}}class DU extends Ou{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=LU,this.output=this._outputValue}}const OU=["inherit","none","antialiased"];function LU(n){return OU.indexOf(n)===-1?(console.warn(`.fontSmoothing value '${n}' is not valid. Aborted`),!1):!0}var FU=n=>{var t={};return $o.d(t,n),t};const fe=FU({BackSide:()=>Wc,BufferAttribute:()=>Ke,BufferGeometry:()=>Ht,Color:()=>be,DoubleSide:()=>_i,EventDispatcher:()=>hc,FileLoader:()=>Or,FrontSide:()=>il,LinearFilter:()=>Mt,Mesh:()=>J,MeshBasicMaterial:()=>_t,Object3D:()=>ne,Plane:()=>ic,PlaneGeometry:()=>pr,ShaderMaterial:()=>$e,Texture:()=>At,TextureLoader:()=>Xa,Vector2:()=>oe,Vector3:()=>w,Vector4:()=>Fe});class vi extends Ot{constructor(t,e,i=!0){super(t,"unset",i),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(t,e){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(t)),this.computeOutputValue(t);for(const i of t._children._uis){const s=i[`_${this._id}`];(s._input?s._input:s._value)==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}this.output(e)}computeOutputValue(t){this._value=this._input}_computeFromInherited(t){this._value=this._inheritedInput}set value(t){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(t){this.isValidValue(t)&&t!==this._inline&&(this._input=this._inline=t,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(t){return!0}getInheritedInput(t){if(this._input!=="inherit")return this._input;const e=t._parent._value;return e?e[`_${this._id}`].getInheritedInput(e):this.getDefaultValue()}}class g0 extends vi{constructor(t,e){super(t,e,!1),this._input=new fe.Vector4(0,0,0,0),this._inline=null,this._value=new fe.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(t){this._vector4ValueSetter(this._value,this._input)}set inline(t){this._vector4ValueSetter(this._input,t),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(t){this._input.x!==t&&(this._input.x=t,this._needsUpdate=!0)}get top(){return this._input.x}set right(t){this._input.y!==t&&(this._input.y=t,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(t){this._input.z!==t&&(this._input.z=t,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(t){this._input.w!==t&&(this._input.w=t,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(t,e){if(e instanceof fe.Vector4){t.copy(e);return}if((typeof e=="string"||e instanceof String)&&(e=e.split(" ")),Array.isArray(e))switch(e=e.map(i=>parseFloat(i)),e.length){case 1:t.setScalar(e[0]);return;case 2:t.x=t.z=e[0],t.y=t.w=e[1];return;case 3:t.x=e[0],t.y=e[1],t.z=e[2];return;case 4:t.x=e[0],t.y=e[1],t.z=e[2],t.w=e[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(e)||t.setScalar(e)}}class UU extends g0{constructor(){super("padding",new fe.Vector4(0,0,0,0))}computeOutputValue(t){super.computeOutputValue(t),t._bounds._needsUpdate=!0,t._bounds._needsRender=!0,t._layouter._needsProcess=!0,t._renderer._needsRender=!0,t._parent._value&&(t._parent._value._layouter._needsProcess=!0)}}class NU extends g0{constructor(){super("margin",new fe.Vector4(0,0,0,0))}computeOutputValue(t){super.computeOutputValue(t),t._renderer._needsRender=!0,t._parent._value&&(t._parent._value._flexDirection._needsProcess=!0)}}const R1=function(n,t,e){n[t]=e},zU=function(n,t,e){e!==null&&(n[t]=e)};class uA{constructor(t){this._definition=t}set definition(t){this._definition=t}mediate(t,e,i,s=null){for(const r in this._definition){const o=this._definition[r];if(i[r]!==void 0){const a=o.t?o.t:R1;a(e,o.m,i[r]),s&&a(s,o.m,i[r])}}}static mediate(t,e,i,s,r=null){if(e)for(const o in s){const a=s[o];if(i[o]!==void 0){const l=a.t?a.t:R1;l(e,a.m,i[o]),r&&l(r,a.m,i[o])}}}}class QU extends Ot{constructor(){super("parent",null,!1)}update(t,e){t.parent&&t.parent.isUI?this._value=t.parent:this._value=null}set value(t){console.warn("ParentProperty is readonly")}get value(){return this._value}find(t){return this._value?t(this._value)?this._value:this._value._parent.find(t):null}dispose(){this._value=null}}const qw=function(n,t,e=6){return n.toFixed(e)===t.toFixed(e)};class B1 extends Ot{constructor(t,e){super(t,e,!0),this.output=this._outputValue}set value(t){this.isValid(t)&&(qw(this._value,t)||(this._value=t,this._needsUpdate=!0))}get value(){return this._value}}class P1 extends Ou{constructor(t){super(t,"inherit",!0),this.isValid=GU}}const jU=[fe.FrontSide,fe.BackSide,fe.DoubleSide];function GU(n){return jU.indexOf(n)===-1?(console.warn(`SideProperty value '${n}' is not valid. Abort`),!1):!0}class eM{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(t){this._lineBreak=t}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(t){this._kerning=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(t){this._cumulativeWidth=t}get marginLeft(){return this._marginLeft}set marginLeft(t){this._marginLeft=t}get marginRight(){return this._marginRight}set marginRight(t){this._marginRight=t}get paddingLeft(){return this._paddingLeft}set paddingLeft(t){this._paddingLeft=t}get paddingRight(){return this._paddingRight}set paddingRight(t){this._paddingRight=t}get lineBase(){return 0}set fontFactor(t){this._fontFactor=t}get fontFactor(){return this._fontFactor}}class tM{constructor(t){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=t}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(t){this._yoffset=t}clone(t){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class iM extends eM{constructor(t){super(),this._typographic=t}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const HU={light:"100",normal:"400",bold:"700",bolder:"900"};function VC(n){if(!isNaN(n))return n.toString();const t=HU[n];return t||n}class VU extends fe.EventDispatcher{constructor(t,e){super(),this._isReady=!1,this._weight=VC(t),this._style=e,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(t){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(t){let e=this._chars[t];if(e)return e;if(t.match(/\s/))return this._chars[" "];const i=this._getFallbackCharacter(t);if(i&&(e=this._chars[i],e))return e;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${t}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(t){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(t,e){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(t){return this._kernings[t]?this._kernings[t]:0}adjustTypographicGlyphs(t){for(const e in t){const i=this.getTypographicGlyph(e),s=t[e];for(const r in s)i["_"+r]=t[e][r]}}_checkReadiness(){this._readyCondition()&&qU(this)}_alterElementProperties(t){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const WU={type:"ready"};function qU(n){n._isReady=!0,n.dispatchEvent(WU)}const wm=VU;class XU extends Ot{constructor(t=null){super("font",t,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=YU}output(t){t[this._id]=this._fontVariant}update(t,e){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof wm)this._fontVariant=this._value;else{const i=t._fontFamily._value;i&&(this._fontVariant=i.getVariant(t._fontWeight._value,t._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(t),this._handleFontReadyClosure=KU(t,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!t._fontMaterial._defaultMaterial||!(t._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(t._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,t._fontMaterial._needsUpdate=!0))}set value(t){this.isValid(t)&&this._value!==t&&(this._value=t,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function YU(n){return n instanceof wm?!0:(console.warn(`.font value '${n}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function KU(n,t){return function(){t._needsUpdate=!0,n._glyphs._needsProcess=!0,t._fontVariant.removeEventListener("ready",t._handleFontReadyClosure),t._handleFontReadyClosure=null}}class JU extends vi{constructor(t){super("display",t),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=$U}computeOutputValue(t){t._visible._value=this._output!=="none"}}const ZU=["none","flex"];function $U(n){return ZU.indexOf(n)===-1?(console.warn(`(.style) display value '${n}' is not valid. Aborted`),!1):!0}class e3 extends vi{constructor(t){super("boxSizing",t),this._allowsInherit=!1,this.isValidValue=i3}computeOutputValue(t){this._value=this._inheritedInput,t._bounds._needsUpdate=!0}}const t3=["border-box","content-box"];function i3(n){return t3.indexOf(n)===-1?(console.warn(`(.style) boxSizing value '${n}' is not valid. Aborted`),!1):!0}class Vg extends vi{constructor(t,e){super(t,e,!1),this._value=new fe.Color,this.output=this._outputValue}computeOutputValue(t){this._input!=="inherit"&&this._value.set(this._input)}set inline(t){this._input=this._inline=t,this._needsUpdate=!0}}class Fb extends vi{constructor(t,e){super(t,e,!0),this.isValidValue=n3,this._allowsInherit=!1,this._input=e,this._value=e,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(t){t[this._id]=this._inheritedInput}}function n3(n){return n<0&&n>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${n}' is not valid)`),!1):!0}class s3 extends vi{constructor(t){super("backgroundImage",t,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new fe.Vector2(1,1),this.isValidValue=r3}get value(){return this._value}output(t){t[this._id]=this._value,t.tSize=this._textureSize}computeOutputValue(t){if(this._value=this._inheritedInput,this._value instanceof fe.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(t){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function r3(n){return!0}class o3 extends vi{constructor(t){super("backgroundSize",t,!0),this.isValidValue=l3,this.output=this._outputValue}}const a3=["cover","contain","stretch"];function l3(n){return a3.indexOf(n)===-1?(console.warn(`(.style) backgroundSize value '${n}' is not valid. Aborted`),!1):!0}class c3 extends vi{constructor(t){super("overflow",t,!0),this.isValidValue=u3,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(t,e){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(t)),this.computeOutputValue(t);for(const i of t._children._uis)i._overflow._needsUpdate=!0;this.output(e)}output(t){t.clippingPlanes=this._clippingPlanes}computeOutputValue(t){super.computeOutputValue(t),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const e=t._parent._value;if(e!==null){const i=e._overflow;if((i._value==="hidden"||i._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new fe.Plane(new fe.Vector3(0,-1,0),1),new fe.Plane(new fe.Vector3(-1,0,0),1),new fe.Plane(new fe.Vector3(0,1,0),1),new fe.Plane(new fe.Vector3(1,0,0),1)];for(let s=0;s<this._clippingPlanes.length;s++)this._clippingPlanes[s].parent=e;i._clippingPlanes!==null&&this._clippingPlanes.push(...i._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(i._value==="visible"||i._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(t){this._renderStrategy(t)}_emptyRender(t){}_hiddenRender(t){const e=t._parent._value,i=e._bounds._offsetHeight,s=e._bounds._offsetWidth,r=e._padding._value,o=e._borderWidth._value;for(let a=0;a<4&&a<this._clippingPlanes.length;a++){const l=this._clippingPlanes[a];switch(a%4){case 0:l.constant=i/2-(r.x+o.x);break;case 1:l.constant=s/2-(r.y+o.y);break;case 2:l.constant=i/2-(r.z+o.z);break;case 3:l.constant=s/2-(r.w+o.w);break}l.applyMatrix4(e.matrixWorld)}for(let a=0;a<t._children._uis.length;a++){const l=t._children._uis[a];l._overflow._needsRender=!0}}_propagateRender(t){for(let e=0;e<t._children._uis.length;e++){const i=t._children._uis[e];i._overflow._needsRender=!0}}}const h3=["visible","hidden"];function u3(n){return h3.indexOf(n)===-1?(console.warn(`(.style) overflow value '${n}' is not valid. Aborted`),!1):!0}const Sf="rem",nM="em",Zv="%",d3=[Sf,nM,Zv],sM=function(n){return d3.indexOf(n)===-1?Sf:n};class f3 extends g0{constructor(t){super("borderRadius",t),this._valueUV=this._value.clone(),this._input=new fe.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new fe.Vector2(0,1),this._cornerTR=new fe.Vector2(1,1),this._cornerBR=new fe.Vector2(1,0),this._cornerBL=new fe.Vector2(0,0);const e=new dA(this._valueUV,["x","y"]),i=new dA(this._valueUV,["z","w"]),s=new dA(this._valueUV,["x","w"]),r=new dA(this._valueUV,["y","z"]);e.complementaryMediation=i,i.complementaryMediation=e,s.complementaryMediation=r,r.complementaryMediation=s,this._sideMediators=[e,i,s,r],this._units=Sf}set units(t){this._units=sM(t),this._needsProcess=!0}get units(){return this._units}set mediation(t){t!==this._mediation&&(this._mediation=t,this._needsUpdate=!0)}get mediation(){return this._mediation}output(t){t.cornerTL=this._cornerTL,t.cornerTR=this._cornerTR,t.cornerBR=this._cornerBR,t.cornerBL=this._cornerBL}computeOutputValue(t){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(t){this._needsRender=!0}render(t){this._valueUV.copy(this._value);const e=t._bounds._offsetWidth,i=t._bounds._offsetHeight;if(this._units===Zv&&this._valueUV.divideScalar(100),this._units===Sf&&this._valueUV.divideScalar(Math.min(e,i)),this._mediation)do this._sideMediators.forEach(o=>o.computeValue()),this._sideMediators.sort((o,a)=>o.value<a.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let s=e>i?i/e:1,r=e<i?e/i:1;this._units===Zv&&(s=r=1),this._cornerTL.x=this._valueUV.x*s,this._cornerTL.y=1-this._valueUV.x*r,this._cornerTR.x=1-this._valueUV.y*s,this._cornerTR.y=1-this._valueUV.y*r,this._cornerBR.x=1-this._valueUV.z*s,this._cornerBR.y=this._valueUV.z*r,this._cornerBL.x=this._valueUV.w*s,this._cornerBL.y=this._valueUV.w*r}dispose(){for(const t of this._sideMediators)t.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(t){this._input.x!==t&&(this._input.x=t,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(t){this._input.y!==t&&(this._input.y=t,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(t){this._input.z!==t&&(this._input.z=t,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(t){this._input.w!==t&&(this._input.w=t,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(t){this._input.x===t&&this._input.y===t||(this._input.x=this._input.y=t,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(t){this._input.y===t&&this._input.z===t||(this._input.y=this._input.z=t,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(t){this._input.z===t&&this._input.w===t||(this._input.z=this._input.w=t,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(t){this._input.w===t&&this._input.x===t||(this._input.w=this._input.x=t,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class dA{constructor(t,e){this._borderRadiuses=t,this._sideProperties=e,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(t){this._complementaryMediation=t}computeValue(){let t=0;for(const e of this._sideProperties)t+=this._borderRadiuses[e];this._value=t}mediate(t=!0){if(!(this._value<1)){for(const e of this._sideProperties)this._borderRadiuses[e]/=this._value;t&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class p3 extends g0{constructor(t){super("borderWidth",t,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=Sf}set units(t){this._units=sM(t),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(t){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,t._bounds._needsUpdate=!0,t._layouter._needsUpdate=!0}_outputValue(t){t[this._id]=this._valueUV}process(t){this._needsRender=!0,t._borderRadius._needsRender=!0}render(t){this._valueUV.copy(this._value);const e=t._bounds._offsetWidth,i=t._bounds._offsetHeight;if(this._units===Zv&&(console.log("Percent"),console.log(this._valueUV)),this._units===Sf)e!==0&&(this._valueUV.w/=e,this._valueUV.y/=e),i!==0&&(this._valueUV.x/=i,this._valueUV.z/=i);else if(this._units===nM){if(e!==0){const s=e>i?i/e:1;this._valueUV.y*=s,this._valueUV.w*=s}if(i!==0){const s=e<i?e/i:1;this._valueUV.x*=s,this._valueUV.z*=s}}}}class g3 extends Ot{constructor(t,e=!0){super("visible",e,!0),this._needsUpdate=!1}update(t,e){t.visible=this._value,t._parent._value&&(t._parent._value._children._needsUpdate=!0)}set value(t){this.isValid(t)&&this._value!==t&&(this._value=t,this._needsUpdate=!0)}get value(){return this._value}}class rM extends Vg{constructor(t){super("backgroundColor",t,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(t){t._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(t)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class xl extends Ot{constructor(t="untitled"){super(t,void 0,!1)}update(t,e){}output(t){}}class m3 extends Ot{constructor(){super("inlineJustificator",null,!1),this._value=null}update(t,e){}process(t){const e=t._bounds._innerHeight,i=t._layouter._value,s=Math.abs(i.height);let r=(()=>{switch(t._alignItems._value){case"inherit":case"start":return e/2;case"end":return s-e/2;case"stretch":case"center":return s/2}})();const o=t._padding._value,a=t._borderWidth._value;r+=(-o.x+o.z)/2+(-a.x+a.z)/2,i.forEach(l=>{l.y+=r,l.forEach(h=>{h.offsetY+=r})})}}const A3=["start","center","end","stretch"],v3=function(n){return A3.indexOf(n)===-1?(console.warn(`(.style) alignItems value '${n}' is not valid. Aborted`),!1):!0};class WC extends vi{constructor(){super("alignItems","inherit",!0),this.isValidValue=v3}}class qC extends vi{constructor(){super("textAlign","inherit",!0),this.isValidValue=b3}}const y3=["left","right","center","justify","justify-left","justify-right","justify-center"],b3=function(n){return y3.indexOf(n)===-1?(console.warn(`(.style) textAlign value '${n}' is not valid. Aborted`),!1):!0};class XC extends vi{constructor(){super("flexDirection","inherit",!0),this.isValid=w3}}const _3=["row","row-reverse","column","column-reverse"];function w3(n){return _3.indexOf(n)===-1?(console.warn(`(.style) flexDirection value '${n}' is not valid. Aborted`),!1):!0}class YC extends vi{constructor(){super("justifyContent","inherit",!0),this.isValidValue=C3}}const x3=["start","center","end","space-between","space-around","space-evenly"];function C3(n){return x3.indexOf(n)===-1?(console.warn(`(.style) justifyContent value '${n}' is not valid. Aborted`),!1):!0}class S3 extends vi{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(t){this._value=this._inheritedInput,t._parent._value&&(t._parent._value._children._needsProcess=!0)}}class oM extends vi{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=I3}_computeFromInherited(t){super._computeFromInherited(t),t._parent._value&&(t._parent._value._children._needsProcess=!0)}}const E3=["static","absolute"];function I3(n){return E3.indexOf(n)===-1?(console.warn(`(.style) position value '${n}' is not valid. Aborted`),!1):!0}class aM extends vi{constructor(t,e=null){super(t,e,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(t){this.isValidValue(t)&&t!==this._inline&&(this._inline=t,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let t=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(t=!1),this._input=this._computed):t=this._input==="inherit",t){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const e=parseFloat(this._input.replace("%","").trim());isNaN(e)||(this._value=e/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=t}}update(t,e){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(t)),this.computeOutputValue(t);for(const i of t._children._uis)i[`_${this._id}`]._needsUpdate=!0;this.output(e),t._parent._value&&(t._parent._value._layouter._needsProcess=!0)}}computeOutputValue(t){t._bounds._needsUpdate=!0,t._renderer._needsRender=!0}getInheritedInput(t){if(this._input!=="inherit"&&!this._auto)return this._input;const e=t._parent._value;return e?e[`_${this._id}`].getInheritedInput(e):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class T3 extends aM{constructor(){super("width")}}class R3 extends aM{constructor(){super("height")}computeOutputValue(t){super.computeOutputValue(t)}}class lM extends xl{constructor(){super("textContent"),this._needsUpdate=!1}set value(t){}process(t){let e="";for(let i=0;i<t.children.length;i++){const s=t.children[i];s.isUI&&(e+=s.textContent)}this._value=e}}class cM extends vi{constructor(t){super("fontStyle",t,!0),this.isValidValue=P3}}const B3=["normal","italic"];function P3(n){return B3.indexOf(n)===-1?(console.warn(`(.style) fontStyle value '${n}' is not valid. Aborted`),!1):!0}class hM extends vi{constructor(){super("fontWeight","inherit",!0),this.isValid=k3}}const M3=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function k3(n){return M3.indexOf(n.toString())===-1?(console.warn(`(.style) fontWeight value '${n}' is not valid. Aborted`),!1):!0}class uM{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class D3 extends uM{constructor(t){super(),this._size=t.info.size,this._lineHeight=t.common.lineHeight,this._lineBase=t.common.base,this._name=t.info.face,this._textureWidth=t.common.scaleW,this._textureHeight=t.common.scaleH,this._charset=t.chars.map(e=>e.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class O3 extends iM{constructor(t){super(t)}get uv(){return this.typographic.uv}}class $v extends tM{constructor(t,e){super(t),this._char=e.char,this._width=e.width,this._heigth=e.height,this._xadvance=e.xadvance?e.xadvance:this._width,this._xoffset=e.xoffset?e.xoffset:0,this._yoffset=e.yoffset?e.yoffset:0,this._uv=e.uv?e.uv:null,isNaN(e.x)||(this._uv={left:e.x/t.textureWidth,right:(e.x+e.width)/t.textureWidth,top:1-(e.y+e.height)/t.textureHeight,bottom:1-e.y/t.textureHeight})}get uv(){return this._uv}clone(t){return new $v(this._font,{char:t,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new O3(this)}}class L3 extends fe.PlaneGeometry{constructor(t,e){let i=1,s=1;const r=t.typographic.font.size,o=e._segments.value;i=Math.ceil(t.typographic.width/r*o),s=Math.ceil(t.typographic.height/r*o),super(t.width,t.height,i,s),t.uv?(this._mapUVs(t),this._transformGeometry(t)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,t.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(t){const e=t.uv.right-t.uv.left,i=t.uv.bottom-t.uv.top,s=this.getAttribute("uv").array.slice(),r=[];for(let o=0;o<s.length;o+=2){const a=s[o],l=s[o+1];r.push(t.uv.left+e*a),r.push(t.uv.top+i*l)}this.setAttribute("uvG",new fe.BufferAttribute(new Float32Array(r),2))}_nullifyUVs(){const t=[],e=this.getAttribute("uv").array.length;for(let i=0;i<e;i++)t.push(0);this.setAttribute("uvG",new fe.BufferAttribute(new Float32Array(t),2))}_transformGeometry(t){this.translate(t.width/2,-t.height/2,0)}}const F3=`
attribute vec2 uvG;
varying vec2 vUvG;
`,KC=F3,U3=`
vUvG = uvG;
`,JC=U3,N3=`
gl_Position.z -= 0.00001;
`,ZC=N3,z3=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,$C=z3,Q3=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,eS=Q3,m0=function(n,t,e){n.alphaTest=e,tS(n,"USE_ALPHATEST",e>0)},tS=function(n,t,e){n.defines&&(e?n.defines[t]===void 0&&(n.defines[t]="",n.needsUpdate=!0):n.defines[t]!==void 0&&(delete n.defines[t],n.needsUpdate=!0))},dM=function(n,t,e){n.defines[t]&&n.defines[t]===e||(n.defines[t]=e,n.needsUpdate=!0)},so=function(n,t,e){n.userData[t]?n.userData[t].value=e:n.uniforms[t].value=e},j3=function(n,t,e){n.userData[t].value=e};class ao{static ensureMaterialOptions(t){t.transparent=!0,t.alphaTest=t.alphaTest||.02}static ensureDefines(t){t.defines||(t.defines={})}static ensureUserData(t,e){t.userData.glyphMap={value:e.glyphMap},t.userData.unitRange={value:new fe.Vector2}}static bindUniformsWithUserData(t,e){t.uniforms.glyphMap=e.userData.glyphMap,t.uniforms.unitRange=e.userData.unitRange}static injectShaderChunks(t){ao.injectVertexShaderChunks(t),ao.injectFragmentShaderChunks(t)}static injectVertexShaderChunks(t){t.vertexShader=t.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+KC),t.vertexShader=t.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+JC),t.vertexShader=t.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+ZC)}static injectFragmentShaderChunks(t){t.fragmentShader=t.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+$C),t.fragmentShader=t.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+eS)}static from(t){return class extends t{constructor(i={}){ao.ensureMaterialOptions(i);super(i);c(this,"_cumulativeOnBeforeCompile",i=>{ao.bindUniformsWithUserData(i,this),ao.injectShaderChunks(i),this._userDefinedOnBeforeCompile(i)});ao.ensureDefines(this),ao.ensureUserData(this,i),this._userDefinedOnBeforeCompile=s=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return ao.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return V3}}const G3=function(n,t,e){const i=e?e.texture:null,s=e?e.unitRange:new fe.Vector2;if(n[t]!==void 0){n.glyphMap=i,n.unitRange=s;return}n.userData&&n.userData.glyphMap&&(n.userData.glyphMap.value=i,n.userData.unitRange.value=s)},H3=function(n,t,e){e&&e!=="antialiased"?n.defines.NO_RGSS="":delete n.defines.NO_RGSS,n.needsUpdate=!0},V3={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:m0},fontSide:{m:"side"},font:{m:"glyphMap",t:G3},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:H3},invertAlpha:{m:"INVERT_ALPHA",t:tS}},W3=`
${KC}
#include <clipping_planes_pars_vertex>
void main() {
	${JC}
	#include <begin_vertex>
	#include <project_vertex>
	${ZC}
	#include <clipping_planes_vertex>
}
`,q3=`
uniform vec3 diffuse;
uniform float opacity;
${$C}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${eS}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,X3=.02;class iS extends fe.ShaderMaterial{static get mediation(){return ao.mediation}constructor(t={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new fe.Vector2(0,0)},alphaTest:{value:X3}},transparent:!0,clipping:!0,vertexShader:W3,fragmentShader:q3,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=t.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(t){this.uniforms.unitRange.value.copy(t)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(t){this.uniforms.glyphMap.value=t}get isDefault(){return this.constructor===iS}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(t){this.uniforms.alphaTest.value=t}}class Y3 extends wm{constructor(t,e,i,s){if(super(t,e),this._unitRange=new fe.Vector2(1,1),i.pages?this._buildData(i):K3(this,i),s instanceof fe.Texture)this._texture=s,this._buildTexture(s);else if(typeof s=="string"||s instanceof String)J3(this,s);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof s}'. Only Texture and String allowed.`);this._defaultMaterialClass=iS,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(t){this._defaultMaterialClass=t}get fontMaterial(){return this._defaultMaterialClass}_buildData(t){this._font=new D3(t),this._kernings=this._buildKerningPairs(t),this._chars=this._buildCharacters(t),this._chars[" "]=this._buildCharacterWhite(t),this._chars[`
`]=this._buildCharacterWhite(t,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(t,"	",4,1),this._size=t.info.size,this._lineHeight=t.common.lineHeight,this._lineBase=t.common.base,this._distanceRange=t.distanceField.distanceRange,this._unitRange=new fe.Vector2(this._distanceRange,this._distanceRange).divide(new fe.Vector2(t.common.scaleW,t.common.scaleH))}_buildTexture(t){t.generateMipmaps=!1,t.minFilter=fe.LinearFilter,t.magFilter=fe.LinearFilter,t.needsUpdate=!0}_getFallbackCharacter(t){return Cu.missingCharacter(this,t)}getGeometricGlyph(t,e){return new L3(t,e)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(t){const e={};for(let i=0;i<t.kernings.length;i++){const s=t.kernings[i];if(s.amount===0)continue;const r=String.fromCharCode(s.first,s.second);e[r]=s.amount}return e}_buildCharacters(t){const e={};for(let i=0;i<t.chars.length;i++){const s=t.chars[i];e[s.char]=new $v(this._font,s)}return e}_buildCharacterWhite(t,e=" ",i=1,s=1){return new $v(this._font,{char:e,width:t.info.size/3*i,height:t.info.size*.7*s})}_alterElementProperties(t){}}function K3(n,t){new fe.FileLoader().setResponseType("json").load(t,e=>{n._buildData(e),n._checkReadiness()})}function J3(n,t){n._texture=new fe.TextureLoader().load(t,e=>{n._buildTexture(e),n._checkReadiness()})}class A0 extends fe.EventDispatcher{constructor(e){super();c(this,"_checkReadiness",()=>{this._variants.every(e=>e.isReady)&&$3(this)});this._name=e,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(e,i,s,r,o=!1){if(o||!this.getVariant(e,i)){this._isReady=!1;const a=new Y3(e,i,s,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${e}, ${i}) already exists.`);return this}addCustomImplementationVariant(e,i=!1){return i||!this.getVariant(e.weight,e.style)?(this._isReady=!1,this._variants.push(e),e.isReady?this._checkReadiness():e.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${e.weight}, ${e.style}) already exists.`),this}getVariant(e,i){return e=VC(e),this._variants.find(s=>s.weight===e&&s.style===i)}get name(){return this._name}}const Z3={type:"ready"};function $3(n){n._isReady=!0,n.dispatchEvent(Z3)}const vv={},eN=function(n){const t=[...arguments];t.forEach(i=>{if(!(i instanceof A0))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof i} given.`)});const e=function(){return t.every(i=>i.isReady)};return new Promise((i,s)=>{if(e())i();else for(let r=0;r<t.length;r++){const o=t[r];o.isReady||o.addEventListener("ready",()=>{e()&&i()})}})},tN=function(n){return vv[n]&&console.error(`FontLibrary::addFontFamily - Font('${n}') is already registered`),vv[n]=new A0(n),vv[n]},iN=function(n){return vv[n]},nN=function(n){fM=n};let fM=function(n,t){return console.error(`The character '${t}' is not included in the font characters set.`)," "};function sN(n,t){return fM(n,t)}const rN={addFontFamily:tN,getFontFamily:iN,prepare:eN,setMissingCharacterHandler:nN,missingCharacter:sN},Cu=rN;class pM extends vi{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(t){if(this._input instanceof A0)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const e=Cu.getFontFamily(this._input);e?this._value=e:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(t){if(this._input!=="inherit")return this._input;const e=t._parent._value;return e?e[`_${this._id}`].getInheritedInput(e):this.getDefaultValue()}}class gM extends vi{constructor(){super("lineHeight","inherit",!0)}update(t,e){super.update(t,e),t._layouter._needsProcess=!0}}class mM extends vi{constructor(){super("whiteSpace","inherit"),this.isValidValue=aN}}const oN=["normal","nowrap","pre","pre-line","pre-wrap"];function aN(n){return oN.indexOf(n)===-1?(console.warn(`(.style) whiteSpace value '${n}' is not valid. Aborted`),!1):!0}class AM extends vi{constructor(){super("letterSpacing","inherit",!0)}}class lN extends vi{constructor(){super("fontSize","inherit",!0)}}class vM extends Ot{constructor(){super("segments",1,!1)}}class cN extends Ou{constructor(){super("invertAlpha","inherit")}}class v0 extends vi{constructor(){super("fontKerning","inherit"),this.isValidValue=uN}}const hN=["normal","none","inherit"];function uN(n){return hN.indexOf(n)===-1?(console.warn(`(.style) fontKerning value '${n}' is not valid. Aborted`),!1):!0}class fA extends Ou{constructor(t){super(t,"inherit",!0)}}class M1 extends Ou{constructor(t){super(t,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(t,e){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(t):this.propagate(t),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:m0},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},t._transferToFontMaterial(),this._outputValue(e)}getInheritedInput(t){if(this._value!=="inherit")return this._value;let e=t,i=null;for(;e._parent._value;)if(e=e._parent._value,e[`_${this._id}`]._value!=="inherit"){i=e[`_${this._id}`]._value;break}return i!==null?i:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const dN=function(n,t,e){n.traverse(i=>{i.renderOrder=e})};class xm extends fe.Object3D{constructor(e,i){super();c(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(ey.register(this),this.activatePseudoState("root")):(ey.remove(this),this.deactivatePseudoState("root"))});Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:dN}},this._fontMesh=null,this._fontMaterial=new M1("fontMaterial"),this._fontCustomDepthMaterial=new M1("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:zU},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=e.children?new e.children:new xl("children"),this._parent=new QU,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new P1("backgroundSide"),this._fontSide=new P1("fontSide"),this._backgroundAlphaTest=new B1("backgroundAlphaTest",.02),this._fontAlphaTest=new B1("fontAlphaTest",.02),this._visible=new g3("visible",!0),this._backgroundCastShadow=new fA("backgroundCastShadow"),this._fontCastShadow=new fA("fontCastShadow"),this._backgroundReceiveShadow=new fA("backgroundReceiveShadow"),this._fontReceiveShadow=new fA("fontReceiveShadow"),this._renderOrder=new MU,this._segments=e.segments?new e.segments:new vM,this._bounds=e.bounds?new e.bounds:new xl("bounds"),this._order=new S3,this._padding=new UU,this._margin=new NU,this._position=new oM,this._flexDirection=e.flexDirection?new e.flexDirection:new XC,this._justifyContent=e.justifyContent?new e.justifyContent:new YC,this._alignItems=e.alignItems?new e.alignItems:new WC,this._display=new JU("flex"),this._boxSizing=new e3("border-box"),this._width=new T3,this._height=new R3,this._backgroundColor=e.backgroundColor?new e.backgroundColor:new rM,this._backgroundOpacity=new Fb("backgroundOpacity",.5),this._backgroundImage=new s3,this._backgroundSize=new o3("cover"),this._color=e.color?new e.color:new Vg("color","inherit"),this._fontOpacity=new Fb("fontOpacity","inherit"),this._whiteSpace=e.whiteSpace?new e.whiteSpace:new mM,this._fontFamily=e.fontFamily?new e.fontFamily:new pM,this._fontStyle=e.fontStyle?new e.fontStyle:new cM("normal"),this._fontWeight=e.fontWeight?new e.fontWeight:new hM,this._fontSize=e.fontSize?new e.fontSize:new lN,this._lineHeight=e.lineHeight?new e.lineHeight:new gM,this._fontKerning=e.fontKerning?new e.fontKerning:new v0,this._letterSpacing=e.letterSpacing?new e.letterSpacing:new AM,this._overflow=new c3("visible"),this._borderRadius=new f3(0),this._borderWidth=new p3(0),this._borderColor=new Vg("borderColor",16711935),this._borderOpacity=new Fb("borderOpacity",1),this._font=new XU,this._lineBreak=e.lineBreak?new e.lineBreak:new xl("lineBreak"),this._textContent=e.textContent?new e.textContent:new lM,this._glyphs=e.glyphs?new e.glyphs:new xl("glyphs"),this._inlines=e.inlines?new e.inlines:new xl("inlines"),this._layouter=e.layouter?new e.layouter:new xl("layouter"),this._inlineJustificator=new m3,this._textAlign=e.textAlign?new e.textAlign:new qC,this._autoSize=e.autoSize?new e.autoSize:new xl("autoSize"),this._renderer=e.renderer?new e.renderer:new xl("renderer"),this._offset=new kU,this._invertAlpha=new cN,this._fontSmooth=e.fontSmooth?new e.fontSmooth:new DU,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const e={};for(const i of this._components)i._needsUpdate&&(i.update(this,e),i._needsUpdate=!1);this._transferToBackgroundMesh(e),this._transferToFontMesh(e),this._transferToBackgroundMaterial(e),this._transferToFontMaterial(e);for(const i of this._children._uis)i.update()}process(){for(const e of this._children._uis)e.process();for(const e of this._components)e._needsProcess&&(e.process(this),e._needsProcess=!1)}render(){for(let e=0;e<this._components.length;e++){const i=this._components[e];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const e of this._children._uis)e.render()}set(e){if(e.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),e.fontFamily)){const i=e.fontFamily.pages?e.fontFamily.info.face:e.fontFamily;let s=Cu.getFontFamily(i);if(!s){const r=e.fontStyle?e.fontStyle:"normal",o=e.fontWeight?e.fontWeight:"400";s=Cu.addFontFamily(i).addVariant(o,r,e.fontFamily,e.fontTexture)}e.fontFamily=s,delete e.fontTexture}for(let i of Object.keys(e)){const s=e[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=s;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=s);break;case"paddingTop":this._padding.top=s;break;case"paddingRight":this._padding.right=s;break;case"paddingBottom":this._padding.bottom=s;break;case"paddingLeft":this._padding.left=s;break;case"marginTop":this._margin.top=s;break;case"marginRight":this._margin.right=s;break;case"marginBottom":this._margin.bottom=s;break;case"marginLeft":this._margin.left=s;break;case"borderTopWidth":this._borderWidth.top=s;break;case"borderRightWidth":this._borderWidth.right=s;break;case"borderBottomWidth":this._borderWidth.bottom=s;break;case"borderLeftWidth":this._borderWidth.left=s;break;case"borderTopLeftRadius":this._borderRadius.topLeft=s;break;case"borderTopRightRadius":this._borderRadius.topRight=s;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=s;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=s;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=s,this[`_font${r}`].value=s;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=s;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=s:this[i]=s}}}get(e){switch(e){case"overflow":case"width":case"height":return this[`_${e}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(e){let i=!1;for(let s=0;s<arguments.length;s++)super.add(arguments[s]),arguments[s].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(e){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(e){this._backgroundMaterial=e,this._backgroundMaterialMediation={...e.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,so(e,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(e){this._backgroundCustomDepthMaterial=e,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(e=null){if(!e){e={};for(const i of this._components)i.output(e)}uA.mediate(this,this._backgroundMaterial,e,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(e){this._backgroundSide.value=e,this._backgroundMaterial&&(this._backgroundMaterial.side=e)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(e){this._backgroundAlphaTest.value=e,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=e)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(e){this._fontMaterial.value=e}set fontCustomDepthMaterial(e){this._fontCustomDepthMaterial.value=e}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(e=null){const i=this._fontMaterial.value;if(i){if(!e){e={};for(const s of this._components)s.output(e)}uA.mediate(this,i,e,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(e){this._fontSide.value=e}get fontSide(){return this._fontSide.value}set fontAlphaTest(e){this._fontAlphaTest.value=e}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(e=null){if(!e){e={};for(const i of this._components)i.output(e)}uA.mediate(this,this._backgroundMesh,e,this._backgroundMeshMediation)}setBackgroundMesh(e){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=e,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&so(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(e){}deactivatePseudoState(e){}togglePseudoState(e){}hasPseudoState(e){return!1}set borderRadiusMediation(e){this._borderRadius.mediation=e}set backgroundCastShadow(e){this._backgroundCastShadow&&(this._backgroundCastShadow.value=e)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(e){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=e)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(e){this._renderOrder&&(this._renderOrder.value=e)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(e=null){if(this._fontMesh){if(!e){e={};for(const i of this._components)i.output(e)}uA.mediate(this,this._fontMesh,e,this._fontMeshMediation)}}setFontMesh(e){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=e,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(e){this._fontCastShadow&&(this._fontCastShadow.value=e)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(e){this._fontReceiveShadow&&(this._fontReceiveShadow.value=e)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(e){this._segments.value=e}get segments(){return this._segments.value}set onAfterUpdate(e){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(e)}addAfterUpdate(e){this._onAfterUpdates.push(e)}removeAfterUpdate(e){const i=this._onAfterUpdates.indexOf(e);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let e=0;e<this._onAfterUpdates.length;e++)this._onAfterUpdates[e]()}getProperty(e){return this[`_${e}`]?this[`_${e}`]:null}appendProperty(e,i){this[`_${e}`]=i,this._components.push(i)}replaceProperty(e,i){const s=this[`_${e}`],r=this._components.indexOf(s);return this._components[r]=this[`_${e}`]=i,i.needsUpdate=!0,s}}class ey{static register(t){this.elements.includes(t)||this.elements.push(t)}static remove(t){const e=this.elements.indexOf(t);e!==-1&&this.elements.splice(e,1)}static update(){for(const t of this.elements)t.update(),t.process(),t.process(),t.render()}}ey.elements=[];const fN=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,nS=fN,pN=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,sS=pN,gN=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,rS=gN,mN=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,oS=mN,AN=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,aS=AN,vN=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,lS=vN,yN=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,cS=yN,yM={msdfAlphaglyphParsVertexGlsl:KC,msdfAlphaglyphVertexGlsl:JC,msdfOffsetglyphVertexGlsl:ZC,msdfAlphaglyphParsFragmentGlsl:$C,msdfAlphaglyphFragmentGlsl:eS,frameBorderParsVertexGlsl:nS,frameBorderVertexGlsl:sS,frameCommonParsFragmentGlsl:aS,frameBorderParsFragmentGlsl:rS,frameBorderFragmentGlsl:oS,frameBackgroundParsFragmentGlsl:lS,frameBackgroundFragmentGlsl:cS},bN=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${nS}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${sS}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,_N=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${aS}

${rS}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${lS}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${cS}

	${oS}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class ty{static get mediation(){return xN}static ensureMaterialOptions(t){t.transparent=!0,t.alphaTest=t.alphaTest||.02}static ensureDefines(t){t.defines||(t.defines={})}static ensureUserData(t,e){t.userData.borderColor={value:null},t.userData.borderRadius={value:new fe.Vector4(0,0,0,0)},t.userData.cornerTL={value:new fe.Vector2(0,1)},t.userData.cornerTR={value:new fe.Vector2(1,1)},t.userData.cornerBR={value:new fe.Vector2(1,0)},t.userData.cornerBL={value:new fe.Vector2(0,0)},t.userData.borderWidth={value:new fe.Vector4(0,0,0,0)},t.userData.borderOpacity={value:null},t.userData.frameSize={value:new fe.Vector3(1,1,1)},t.userData.textureSize={value:new fe.Vector2(1,1)}}static bindUniformsWithUserData(t,e){t.uniforms.borderColor=e.userData.borderColor,t.uniforms.borderRadius=e.userData.borderRadius,t.uniforms.cornerTL=e.userData.cornerTL,t.uniforms.cornerTR=e.userData.cornerTR,t.uniforms.cornerBR=e.userData.cornerBR,t.uniforms.cornerBL=e.userData.cornerBL,t.uniforms.borderWidth=e.userData.borderWidth,t.uniforms.borderOpacity=e.userData.borderOpacity,t.uniforms.frameSize=e.userData.frameSize,t.uniforms.textureSize=e.userData.textureSize}static injectShaderChunks(t){ty.injectVertexShaderChunks(t),ty.injectFragmentShaderChunks(t)}static injectVertexShaderChunks(t){t.vertexShader=t.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+nS),t.vertexShader=t.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+sS)}static injectFragmentShaderChunks(t){t.fragmentShader=t.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+lS),t.fragmentShader=t.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+rS),t.fragmentShader=t.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+aS),t.fragmentShader=t.fragmentShader.replace("#include <map_fragment>",cS),t.fragmentShader=t.fragmentShader.replace("#include <alphamap_fragment>",oS+`
#include <alphamap_fragment>`)}}const wN=function(n,t,e){e=["stretch","contain","cover"].indexOf(e),dM(n,"BACKGROUND_MAPPING",e)},xN={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:m0},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:wN},borderWidth:{m:"borderWidth",t:so},borderColor:{m:"borderColor",t:so},cornerTL:{m:"cornerTL",t:so},cornerTR:{m:"cornerTR",t:so},cornerBR:{m:"cornerBR",t:so},cornerBL:{m:"cornerBL",t:so},borderOpacity:{m:"borderOpacity",t:so},size:{m:"frameSize",t:so},tSize:{m:"textureSize",t:so}};class bM extends fe.ShaderMaterial{static get mediation(){return ty.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new fe.Color(16777215)},opacity:{value:1},borderColor:{value:new fe.Color(0)},borderOpacity:{value:0},borderRadius:{value:new fe.Vector4(0,0,0,0)},cornerTL:{value:new fe.Vector2(0,1)},cornerTR:{value:new fe.Vector2(1,1)},cornerBR:{value:new fe.Vector2(1,0)},cornerBL:{value:new fe.Vector2(0,0)},borderWidth:{value:new fe.Vector4(0,0,0,0)},frameSize:{value:new fe.Vector3(1,1,1)},textureSize:{value:new fe.Vector2(1,1)}},side:fe.FrontSide,transparent:!0,clipping:!0,vertexShader:bN,fragmentShader:_N,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(t){this.uniforms.map.value=t,t?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(t){this.uniforms.alphaTest.value=t}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}}class CN extends Ot{constructor(){super("children",null,!1);c(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1);this._uis=[],this._boxes=[]}update(e,i){this._compute(e),e._layouter._needsUpdate=!0,e._renderOrder._needsUpdate=!0}process(e){this._compute(e),e._flexDirection._needsProcess=!0,e._layouter._needsProcess=!0,e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class _M extends Ot{constructor(){super("bounds",null,!1),this._size=new fe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(t,e){const i=t._width,s=t._padding._value,r=t._borderWidth._value,o=t._margin._value,a=i._auto?1:i._value,l=e*a-(o.y+o.w);qw(l,this._offsetWidth)||(this._offsetWidth=l,this._innerWidth=this._offsetWidth-(s.y+s.w+r.y+r.w),this._centerX=Ub(t),this._propagateWidth(t),this._triggerCascadingDependencies(t))}setReferenceHeight(t,e){const i=t._height,s=t._padding._value,r=t._borderWidth._value,o=t._margin._value,a=i._auto?1:i._value,l=e*a-(o.x+o.z);qw(l,this._offsetHeight)||(this._offsetHeight=l,this._innerHeight=this._offsetHeight-(s.x+s.z+r.x+r.z),this._centerY=Nb(t),this._propagateHeight(t),this._triggerCascadingDependencies(t))}setChildrenWidth(t,e){const i=t._padding._value,s=t._borderWidth._value;this._innerWidth=e,this._offsetWidth=this._innerWidth+(i.y+i.w+s.y+s.w),this._centerX=Ub(t),this._propagateWidth(t),this._triggerCascadingDependencies(t)}setChildrenHeight(t,e){const i=t._padding._value,s=t._borderWidth._value;this._innerHeight=e,this._offsetHeight=this._innerHeight+(i.x+i.z+s.x+s.z),this._centerY=Nb(t),this._propagateHeight(t),this._triggerCascadingDependencies(t)}update(t,e){const i=t._padding._value,s=t._borderWidth._value,r=t._width;!r._auto&&!r._relative&&(t._boxSizing._value==="content-box"?(this._innerWidth=r._value,this._offsetWidth=this._innerWidth+i.y+i.w+s.y+s.w):(this._offsetWidth=r._value,this._innerWidth=this._offsetWidth-(i.y+i.w+s.y+s.w)),this._centerX=Ub(t),this._needsProcess=!0,this._propagateWidth(t),this._triggerCascadingDependencies(t));const o=t._height;!o._auto&&!o._relative&&(t._boxSizing._value==="content-box"?(this._innerHeight=o._value,this._offsetHeight=this._innerHeight+i.x+i.z+s.x+s.z):(this._offsetHeight=o._value,this._innerHeight=this._offsetHeight-(i.x+i.z+s.x+s.z)),this._centerY=Nb(t),this._needsProcess=!0,this._propagateHeight(t),this._triggerCascadingDependencies(t))}render(t){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,t._backgroundMesh&&t._backgroundMesh.updateScale(),t._renderer._needsRender=!0}output(t){t.size=this._size}process(t){t._overflow._needsRender=!0}_computeChildrenSideWidth(t){return SN(t)}_computeChildrenSideHeight(t){return EN(t)}_propagateWidth(t){for(let e=0;e<t._children._boxes.length;e++){const i=t._children._boxes[e];i._width._relative&&i._bounds.setReferenceWidth(i,this._innerWidth)}}_propagateHeight(t){for(let e=0;e<t._children._boxes.length;e++){const i=t._children._boxes[e];i._height._relative&&i._bounds.setReferenceHeight(i,this._innerHeight)}}_triggerCascadingDependencies(t){t._parent._value&&(t._parent._value._autoSize._needsProcess=!0),t._flexDirection._needsProcess=!0,t._fontSize._needsProcess=!0,t._layouter._needsProcess=!0,this._needsRender=!0,t._borderWidth._needsRender=!0,t._borderRadius._needsRender=!0,t._overflow._needsRender=!0}}function Ub(n){const t=n._padding._value,e=n._borderWidth._value,i=t.w+e.w,s=t.y+e.y;return(i-s)/2}function Nb(n){const t=n._padding._value,e=n._borderWidth._value,i=t.x+e.x;return(t.z+e.z-i)/2}function SN(n){return n._children._boxes.reduce((t,e)=>{const i=e._margin._value,s=e._bounds._offsetWidth+i.y+i.w;return t+s},0)}function EN(n){return n._children._boxes.reduce((t,e)=>{const i=e._margin._value,s=e._bounds._offsetHeight+i.x+i.z;return t+s},0)}class IN extends WC{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(t){switch(this._value=this._inheritedInput,t._flexDirection._value){case"row":case"row-reverse":switch(this._process=kN,this._value){case"start":this._childAlign=RN;break;case"end":this._childAlign=TN;break;default:this._childAlign=k1}break;case"column":case"column-reverse":switch(this._process=MN,this._value){case"start":this._childAlign=PN;break;case"end":this._childAlign=BN;break;default:this._childAlign=k1}break}this._needsProcess=!0,t._autoSize._needsProcess=!0,t._flexDirection._needsProcess=!0,t._justifyContent._needsProcess=!0,this._needsProcess=!0,t._fontSize._needsProcess=!0,t._layouter._needsProcess=!0}process(t){this._process(t,this._childAlign);let e="center",i="center",s="center";const r=t._padding._value,o=t._borderWidth._value;t._flexDirection._value.indexOf("column")!==-1?this._value==="start"?e=i="left":this._value==="end"?e=i="right":e="centerX":this._value==="start"?e=s="top":this._value==="end"?e=s="bottom":e="centerY";let a=-(r.x-r.z)/2-(o.x-o.z)/2,l=-(r.y-r.w)/2-(o.y-o.w)/2;i==="left"?l=(r.w-r.y)/2+(o.w-o.y)/2:i==="right"&&(l=-(r.y-r.w)/2-(o.y-o.w)/2),s==="top"?a=-(r.x-r.z)/2-(o.x-o.z)/2:s==="bottom"&&(a=(r.z-r.x)/2+(o.z-o.x)/2),t._children._boxes.forEach(h=>{let u=0,d=0;e==="top"?d=-h._margin._value.x:e==="bottom"?d=h._margin._value.z:e==="left"?u=h._margin._value.w:e==="right"?u=-h._margin._value.y:e==="centerX"?u=(h._margin._value.w-h._margin._value.y)/2:e==="centerY"&&(d=(-h._margin._value.x+h._margin._value.z)/2),t._layouter._childrenPos[h.id].x+=l+u,t._layouter._childrenPos[h.id].y+=a+d})}}function k1(){return 0}function TN(n,t){return-t+n._bounds._offsetHeight/2}function RN(n,t){return t-n._bounds._offsetHeight/2}function BN(n,t){return t-n._bounds._offsetWidth/2}function PN(n,t){return-t+n._bounds._offsetWidth/2}function MN(n,t){const e=n._bounds._innerWidth/2;n._children._boxes.forEach(i=>{n._layouter._childrenPos[i.id].x=t(i,e)})}function kN(n,t){const e=n._bounds._innerHeight/2;n._children._boxes.forEach(i=>{n._layouter._childrenPos[i.id].y=t(i,e)})}class DN extends XC{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(t){switch(this._value=this._inheritedInput,this._value){case"row":this._process=ON;break;case"row-reverse":this._process=LN;break;case"column":this._process=FN;break;case"column-reverse":this._process=UN;break}t._justifyContent._needsUpdate||t._justifyContent.computeOutputValue(t),t._alignItems._needsUpdate||t._alignItems.computeOutputValue(t),this._needsProcess=!0}process(t){switch(this._value){case"row":this._offset=-t._bounds._innerWidth/2;break;case"row-reverse":this._offset=t._bounds._innerWidth/2;break;case"column":this._offset=t._bounds._innerHeight/2;break;case"column-reverse":this._offset=-t._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(t),t._justifyContent._needsProcess=!0,t._layouter._needsProcess=!0}}function ON(n){let t=n._flexDirection._offset;const e=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetWidth;t+=r._margin._value.w*e;const l=n._layouter._childrenPos[o];l.x=t+a/2*e,l.y=0,t+=e*(a+r._margin._value.y)}}function LN(n){let t=n._flexDirection._offset;const e=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetWidth;t+=r._margin._value.y*e;const l=n._layouter._childrenPos[o];l.x=t+a/2*e,l.y=0,t+=(a+r._margin._value.w)*e}}function FN(n){let t=n._flexDirection._offset;const e=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetHeight;t+=r._margin._value.x*e;const l=n._layouter._childrenPos[o];l.x=0,l.y=t+a/2*e,t+=(a+r._margin._value.z)*e}}function UN(n){let t=n._flexDirection._offset;const e=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetHeight;t+=r._margin._value.z*e;const l=n._layouter._childrenPos[o];l.x=0,l.y=t+a/2*e,t+=(a+r._margin._value.x)*e}}class NN extends YC{constructor(t){super("justifyContent",t,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(t){switch(this._value=this._inheritedInput,t._flexDirection._value){case"column-reverse":case"column":this._process=QN.bind(this);break;case"row-reverse":case"row":this._process=zN.bind(this);break}switch(this._value){case"end":this._computeOffset=HN,this._computeMargin=zb;break;case"center":this._computeOffset=VN,this._computeMargin=zb;break;case"start":this._computeOffset=pA,this._computeMargin=zb;break;case"space-between":this._computeOffset=pA,this._computeMargin=WN;break;case"space-around":this._computeOffset=pA,this._computeMargin=XN;break;case"space-evenly":this._computeOffset=pA,this._computeMargin=qN;break}t._flexDirection._needsProcess=!0}process(t){this._process(t),t._alignItems._needsProcess=!0}}function zN(n){const t=n._flexDirection._offset,{usedDirectionSpace:e,remainingSpace:i}=jN(n),s=t*2-e*Math.sign(t),r=this._computeOffset(s),o=this._computeMargin(n,i,n._flexDirection._reverse);n._children._boxes.forEach((a,l)=>{n._layouter._childrenPos[a.id].x-=r-o[l]})}function QN(n){const t=n._flexDirection._offset,{usedDirectionSpace:e,remainingSpace:i}=GN(n),s=t*2-e*Math.sign(t),r=this._computeOffset(s),o=this._computeMargin(n,i,n._flexDirection._reverse);n._children._boxes.forEach((a,l)=>{n._layouter._childrenPos[a.id].y-=r-o[l]})}function jN(n){const t=n._bounds._computeChildrenSideWidth(n);return{usedDirectionSpace:t,remainingSpace:n._bounds._innerWidth-t}}function GN(n){const t=n._bounds._computeChildrenSideHeight(n);return{usedDirectionSpace:t,remainingSpace:n._bounds._innerHeight-t}}function pA(n){return 0}function HN(n){return n}function VN(n){return n/2}function zb(n,t=0,e=1){return Array(n._children._boxes.length).fill(0)}function WN(n,t=0,e=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(t>0&&s>1){const o=t/(s-1)*e;r[0]=0;for(let a=1;a<s;a++)r[a]=o*a}return r}function qN(n,t=0,e=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(t>0){const o=t/(s+1)*e;for(let a=0;a<s;a++)r[a]=o*(a+1)}return r}function XN(n,t=0,e=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(t>0){const o=t/s*e,a=o/2;r[0]=a;for(let l=1;l<s;l++)r[l]=a+o*l}return r}let Qb;class wM extends fe.Mesh{constructor(t){const e=t.slice,i={};let s=1,r=1;if(e){if(s=e.width?e.width:1,r=e.height?e.height:1,e.top){if(e.left){const f=new fe.PlaneGeometry(e.left*s,e.top*r,1,1);ml(f,0,e.left,1-e.top,1),f.translate(e.left*s/2,-e.top*r/2,0),i.topLeft=f}const d=new fe.PlaneGeometry(1,e.top*r,1,1);if(ml(d,e.left,1-e.right,1-e.top,1),d.translate(0,-e.top*r/2,0),i.top=d,e.right){const f=new fe.PlaneGeometry(e.right*s,e.top*r,1,1);ml(f,1-e.right,1,1-e.top,1),f.translate(-e.right*s/2,-e.top*r/2,0),i.topRight=f}}if(e.left){const d=new fe.PlaneGeometry(e.left*s,1,1,1);ml(d,0,e.left,e.bottom,1-e.top),d.translate(e.left*s/2,0,0),i.left=d}const u=new fe.PlaneGeometry(1,1,1,1);if(ml(u,e.left,1-e.right,e.bottom,1-e.top),i.middle=u,e.right){const d=new fe.PlaneGeometry(e.right*s,1,1,1);ml(d,1-e.right,1,e.bottom,1-e.top),d.translate(-e.right*s/2,0,0),i.right=d}if(e.bottom){if(e.left){const f=new fe.PlaneGeometry(e.left*s,e.bottom*r,1,1);ml(f,0,e.left,0,e.bottom),f.translate(e.left*s/2,e.bottom*r/2,0),i.bottomLeft=f}const d=new fe.PlaneGeometry(1,e.bottom*r,1,1);if(ml(d,e.left,1-e.right,0,e.bottom),d.translate(0,e.bottom*r/2,0),i.bottom=d,e.right){const f=new fe.PlaneGeometry(e.right*s,e.bottom*r,1,1);ml(f,1-e.right,1,0,e.bottom),f.translate(-e.right*s/2,e.bottom*r/2,0),i.bottomRight=f}}}let o=t.backgroundMaterial;e&&(Qb||(Qb=new fe.MeshBasicMaterial({alphaTest:1.1})),o=Qb);const a=new fe.PlaneGeometry(1,1,t._segments.value,t._segments.value),l=new fe.BufferAttribute(new Float32Array(a.getAttribute("uv").array),2);if(a.setAttribute("uvB",l).name="uvB",super(a,o),this.name="UIBackgroundBox",e){this.slice=e,this.sliceSize=new fe.Vector3(1-(e.left+e.right),1-(e.bottom+e.top),1),this.sliceScale=new fe.Vector3(s,r,1);for(const h in i){const u=new fe.Mesh(i[h],t.backgroundMaterial);this.add(u),i[h]=u}this.updateScale=this.updateScaleSlice,this.slices=i}}updateScale(){}updateScaleSlice(){const t=new fe.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(t.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(t.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const e in this.slices){const i=this.slices[e];i.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const s=YN[e];for(const o in s)i.position[o]=this.scale[o]*s[o]*i.scale[o];const r=KN[e];if(r){r.x&&(i.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),r.y&&(i.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const o in r){const a=this.scale[o]-(1-this.sliceSize[o])*this.sliceScale[o];i.scale[o]=Math.max(0,a*(1/this.scale[o]))}}}t.x!==1&&(this.slices.left.scale.x*=t.x,this.slices.topLeft.scale.x*=t.x,this.slices.bottomLeft.scale.x*=t.x,this.slices.right.scale.x*=t.x,this.slices.topRight.scale.x*=t.x,this.slices.bottomRight.scale.x*=t.x),t.y!==1&&(this.slices.top.scale.y*=t.y,this.slices.topLeft.scale.y*=t.y,this.slices.topRight.scale.y*=t.y,this.slices.bottom.scale.y*=t.y,this.slices.bottomLeft.scale.y*=t.y,this.slices.bottomRight.scale.y*=t.y)}}const YN={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},KN={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function ml(n,t,e,i,s){const r=e-t,o=s-i,a=n.attributes.uv;for(let h=0;h<a.count;h++){const u=a.getX(h),d=a.getY(h);a.setXY(h,t+u*r,i+d*o)}const l=new fe.BufferAttribute(new Float32Array(n.getAttribute("uv").array),2);n.setAttribute("uvB",l).name="uvB"}class xM extends Ot{constructor(){super("renderer")}render(t){t._backgroundMesh||t.setBackgroundMesh(new wM(t)),t.performAfterUpdate()}}class JN extends oM{constructor(){super("position")}update(t,e){super.update(t,e),this._needsProcess=!0}}class ZN extends Ot{constructor(){super("autosize"),this._needsProcess=!0}process(t){t._width._auto&&$N(t),t._height._auto&&e4(t);const e=t._alignItems._value==="stretch",i=e&&t._flexDirection._value.indexOf("column")!==-1,s=e&&!i;for(const r of t._children._boxes)(r._width._auto&&i||r._width._relative)&&r._bounds.setReferenceWidth(r,t._bounds._innerWidth),(r._height._auto&&s||r._height._relative)&&r._bounds.setReferenceHeight(r,t._bounds._innerHeight)}}function $N(n){n._bounds.setChildrenWidth(n,i4(n))}function e4(n){n._bounds.setChildrenHeight(n,t4(n))}function t4(n){switch(n._flexDirection._value){case"row":case"row-reverse":return o4(n);case"column":case"column-reverse":return s4(n)}}function i4(n){switch(n._flexDirection._value){case"row":case"row-reverse":return n4(n);case"column":case"column-reverse":return r4(n)}}function n4(n){let t=0;for(const e of n._children._boxes){if(e._position._value!=="static")continue;const i=e._margin._value,s=e._bounds._offsetWidth+i.y+i.w;t+=s}return t}function s4(n){let t=0;for(const e of n._children._boxes){if(e._position._value!=="static")continue;const i=e._margin._value,s=e._bounds._offsetHeight+i.x+i.z;t+=s}return t}function r4(n){let t=0;for(const e of n._children._boxes){if(e._position._value!=="static")continue;const i=e._margin._value,s=e._bounds._offsetWidth+i.y+i.w;s>t&&(t=s)}return t}function o4(n){let t=0;for(const e of n._children._boxes){if(e._position._value!=="static")continue;const i=e._margin._value,s=e._bounds._offsetHeight+i.x+i.z;s>t&&(t=s)}return t}class Wg extends xm{constructor(t,e){Wg.definePropertiesValues(t,e),super(t,e),Wg.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new fe.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(t,e){t.children||(t.children=CN),t.bounds||(t.bounds=_M),t.flexDirection||(t.flexDirection=DN),t.justifyContent||(t.justifyContent=NN),t.alignItems||(t.alignItems=IN),t.position||(t.position=JN),t.autoSize||(t.autoSize=ZN),t.renderer||(t.renderer=xM),e.fontSide||(e.fontSide=0),e.invertAlpha||(e.invertAlpha=!1),e.fontCastShadow||(e.fontCastShadow=!1),e.fontReceiveShadow||(e.fontReceiveShadow=!1),e.backgroundCastShadow||(e.backgroundCastShadow=!1),e.backgroundReceiveShadow||(e.backgroundReceiveShadow=!1)}static init(t){Object.defineProperties(t,{isBox:{configurable:!1,enumerable:!0,value:!0}}),t.backgroundMaterial=new bM,t._renderer.render(t),t._backgroundMesh.visible=!1}}class D1 extends Array{constructor(...t){super(...t),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}}class a4 extends Ot{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(t,e){this._childrenPos={};for(const i of t._children._boxes)i._position._value==="static"&&(this._childrenPos[i.id]=i.position)}process(t){}}class qg extends Wg{constructor(t={}){const e={};qg.definePropertiesValues(e,t),super(e,t),qg.init(this)}add(t){const e=[];for(let i=0;i<arguments.length;i++){const s=arguments[i];!s.isUI||s.isBox?e.push(s):console.warn("Block element can only contain Box elements.",s)}return super.add(...e)}static definePropertiesValues(t,e){t.layouter=a4}static init(t){Object.defineProperties(t,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class l4 extends Ot{constructor(){super("textContent",null,!1)}update(t,e){t._glyphs._needsUpdate=!0,t._whiteSpace._needsProcess=!0}}class c4 extends Ot{constructor(){super("inlines",null,!1),this._value=null}process(t){if(this._value=t._glyphs._value.map(e=>e.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=t._padding._value.w,this._value[0].marginLeft=t._margin._value.w;const e=this._value.length-1;this._value[e].paddingRight=t._padding._value.y,this._value[e].marginRight=t._margin._value.y}t._fontSize._needsProcess=!0,t._lineBreak._needsProcess=!0,t._fontKerning._needsProcess=!0,t._layouter._needsProcess=!0}get value(){return this._value}}class h4 extends Ot{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(t){t._font._fontVariant&&t._font._fontVariant.isReady&&(this._value=t._whiteSpace._whiteSpacedContent.split("").map(e=>t._font._fontVariant.getTypographicGlyph(e)),this._value&&(t._inlines._needsProcess=!0))}get value(){return this._value}}class u4 extends Vg{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(t){this._input==="inherit"?this._value.set(this.getInheritedInput(t)):this._value.set(this._input)}}class CM extends Ot{constructor(t=`- ,.:?!
`){super("lineBreak",t,!0),this._newLineBreakability=null}update(t,e){this._needsProcess=!0}process(t){const e=t._whiteSpace._newLineBreakability;if(t._inlines._value)for(let i=0;i<t._inlines._value.length;i++){const s=t._inlines._value[i],r=s.char;let o=null;r!==void 0&&(e!=="nowrap"&&(this._value.includes(r)||r.match(/\s/g))&&(o="possible"),r.match(/\n/g)&&(o=e)),s.lineBreak=o}}get value(){return this._value}}class SM extends Ot{constructor(){super("layouter",null,!1),this._value=null}update(t,e){this._value=t._parent.find(i=>i.isUI&&i.isText),this._needsProcess=!0}process(t){this._value&&(this._value._layouter._needsProcess=!0)}}class d4 extends Vg{constructor(t){super("backgroundColor",t,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(t){this._input==="inherit"?this._value.set(this.getInheritedInput(t)):this._value.set(this._input)}}class EM extends cM{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class IM extends hM{constructor(){super()}computeOutputValue(t){this._value=VC(this.getInheritedInput(t))}}class TM extends pM{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(t){let e=this._inheritedInput;if(e==="inherit"&&(e=this.getInheritedInput(t)),e instanceof A0)this._value=e,t._font._needsUpdate=!0;else if(typeof e=="string"){const i=Cu.getFontFamily(e);i?(this._value=i,t._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${e}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class hS extends mM{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(t){switch(super._computeFromInherited(t),this._newLineBreakability=f4(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=p4;break;case"pre-line":this._stringCollapser=RM;break;default:this._stringCollapser=g4}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=b4;break;case"pre-wrap":this._inlineCollapser=y4;break;default:this._inlineCollapser=_4}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=m4;break;case"pre":this._inlineWrapper=A4;break;default:this._inlineWrapper=v4}this._needsProcess=!0}process(t){t.isInline&&!t.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(t._textContent._value),t._glyphs._needsProcess=!0)}}const O1={"	":"	","\n":`
`,"\r":"\r"," ":" "},f4=function(n){switch(n){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function p4(n){return RM(n.replace(/\n/g," "))}function RM(n){return n.replace(/[ ]{2,}/g," ")}function g4(n){return n}function m4(n,t,e,i){const s=n[t];if(s.lineBreak==="mandatory"||e+s.xadvance+s.xoffset+s.kerning>i.INNER_WIDTH)return!0;const r=MM(n,t,i);return w4(n[t-1],e,r,i)}function A4(n,t,e,i){return n[t].lineBreak==="mandatory"}function v4(){return!1}function y4(n){if(!n[0])return 0;const t=n[0],e=n[n.length-1];return t.char&&t.char===`
`&&n.length>1&&PM([t],n[1]),e.char&&e.char===`
`&&n.length>1&&BM([e],n[n.length-2]),t.offsetX}function b4(n){if(!n[0])return 0;let t=[],e;for(let i=0;i<n.length;i++){const s=n[i];if(s.char&&O1[s.char]&&n.length>i){t.push(s),e=n[i+1];continue}break}PM(t,e),t=[],e=null;for(let i=n.length-1;i>0;i--){const s=n[i];if(s.char&&O1[s.char]&&i>0){t.push(s),e=n[i-1];continue}break}return BM(t,e),n[0].offsetX}function _4(n){return n[0]?n[0].offsetX:0}function BM(n,t){if(t)for(let e=0;e<n.length;e++){const i=n[e];i.fontFactor=0,i.offsetX=t.offsetX+t.cumulativeWidth,i.cumulativeWidth=0}}function PM(n,t){if(t)for(let e=0;e<n.length;e++){const i=n[e];i.fontFactor=0,i.offsetX=t.offsetX,i.cumulativeWidth=0}}function MM(n,t,e,i){if(i=i||0,!n[t])return i;const s=n[t];return s.lineBreak?i+s.xadvance:MM(n,t+1,e,i+s.xadvance+s.xoffset+s.kerning+e.LETTERSPACING)}function w4(n,t,e,i){return!n||!n.char||t+e<i.INNER_WIDTH?!1:i.BREAKON.indexOf(n.char)>-1}class kM extends AM{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(t){super._computeFromInherited(t),t._fontSize._needsProcess=!0,t._layouter._needsProcess=!0}}class DM extends vi{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(t){this._value=this._inheritedInput,t._font._fontVariant&&(t._bounds._needsProcess=!0,t._layouter._needsProcess=!0)}process(t){if(!t._font._fontVariant||!t._font._fontVariant.isReady)return;const e=this._value/t._font._fontVariant.typographic.size,i=t._inlines._value;for(let s=0;s<i.length;s++){const r=i[s];r.resetOffsets(),r.fontSize=this._value,r.fontFactor=e}}get value(){return this._value}}class OM extends vM{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(t,e){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(t)),t._layouter._needsUpdate=!0}set value(t){this._value!==t&&(this._value=t,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class x4 extends OM{constructor(){super(),this._value="inherit"}}class C4 extends v0{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(t){super._computeFromInherited(t),t._parent._value._layouter._needsProcess=!1}process(t){if(this._value!=="none"){const e=t._whiteSpace._whiteSpacedContent,i=t._inlines._value;for(let s=1;s<i.length;s++){const r=e[s-1]+e[s];i[s].kerning=t._font._fontVariant.getKerningAmount(r)}}}}class LM extends Ot{constructor(){super("children",null,!1),this._uis=[]}update(t,e){}process(t){}_compute(t){}dispose(){}}function S4(n,t=!1){const e=n[0].index!==null,i=new Set(Object.keys(n[0].attributes)),s=new Set(Object.keys(n[0].morphAttributes)),r={},o={},a=n[0].morphTargetsRelative,l=new fe.BufferGeometry;let h=0;for(let u=0;u<n.length;++u){const d=n[u];let f=0;if(e!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in d.attributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;r[p]===void 0&&(r[p]=[]),r[p].push(d.attributes[p]),f++}if(f!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in d.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(d.morphAttributes[p])}if(t){let p;if(e)p=d.index.count;else if(d.attributes.position!==void 0)p=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(h,p,u),h+=p}}if(e){let u=0;const d=[];for(let f=0;f<n.length;++f){const p=n[f].index;for(let g=0;g<p.count;++g)d.push(p.getX(g)+u);u+=n[f].attributes.position.count}l.setIndex(d)}for(const u in r){const d=L1(r[u]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,d)}for(const u in o){const d=o[u][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let f=0;f<d;++f){const p=[];for(let m=0;m<o[u].length;++m)p.push(o[u][m][f]);const g=L1(p);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(g)}}return l}function L1(n){let t,e,i,s=-1,r=0;for(let h=0;h<n.length;++h){const u=n[h];if(t===void 0&&(t=u.array.constructor),t!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(e===void 0&&(e=u.itemSize),e!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=u.normalized),i!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(s===-1&&(s=u.gpuType),s!==u.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;r+=u.count*e}const o=new t(r),a=new fe.BufferAttribute(o,e,i);let l=0;for(let h=0;h<n.length;++h){const u=n[h];if(u.isInterleavedBufferAttribute){const d=l/e;for(let f=0,p=u.count;f<p;f++)for(let g=0;g<e;g++){const m=u.getComponent(f,g);a.setComponent(f+d,g,m)}}else o.set(u.array,l);l+=u.count*e}return s!==void 0&&(a.gpuType=s),a}class E4 extends Ot{constructor(){super("renderer")}render(t){if(!t._inlines._value||!t._inlines._value.length)return;const e=t._inlines._value.map(s=>t._font._fontVariant.getGeometricGlyph(s,t).translate(s.offsetX,s.offsetY,0)),i=S4(e);t.setFontMesh(new fe.Mesh(i,t.fontMaterial)),t._fontMesh.renderOrder=1/0}}class I4 extends qC{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(t){this._value=this._inheritedInput,t._layouter._needsProcess=!0}}class Ef extends xm{constructor(e={}){const i={};Ef.definePropertiesValues(i,e);super(i,e);c(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0});Ef.init(this)}add(e){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(e){this._textContent.value=e}get textContent(){return this._textContent._value}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(e,i){e.children||(e.children=LM),e.textContent||(e.textContent=l4),e.glyphs||(e.glyphs=h4),e.inlines||(e.inlines=c4),e.layouter||(e.layouter=SM),e.renderer||(e.renderer=E4),e.fontFamily||(e.fontFamily=TM),e.fontWeight||(e.fontWeight=IM),e.fontStyle||(e.fontStyle=EM),e.fontSize||(e.fontSize=DM),e.color||(e.color=u4),e.backgroundColor||(e.backgroundColor=d4),e.lineBreak||(e.lineBreak=CM),e.letterSpacing||(e.letterSpacing=kM),e.whiteSpace||(e.whiteSpace=hS),e.segments||(e.segments=x4),e.textAlign||(e.textAlign=I4),e.fontKerning||(e.fontKerning=C4)}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class T4 extends lM{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(t){this._value!==t&&(this._value=t,this._needsUpdate=!0)}update(t,e){this._needsUpdate=!1;for(let i=t.children.length-1;i>=0;i--){const s=t.children[i];s.isUI&&(t.remove(s),s.clear())}t._children._uis=[],this._value&&t.add(new Ef({name:"anonymousInline",textContent:this._value}))}}class R4 extends Array{constructor(...t){super(...t),this.width=0,this.height=0}}class B4 extends Ot{constructor(){super("layouter",null,!1),this._value=null}update(t,e){}process(t){let e=t._width._value;t._width._auto?e=1/0:e=t._bounds._innerWidth;const i=t._lineHeight._value,s=new R4(new D1);let r=0;t._children._inlines.forEach(d=>{if(!d._inlines.value)return;this._resetInlines(d);const f=d._fontSize._value,p=d._letterSpacing._value*f,g=d._whiteSpace._value,m=d._lineBreak._value,v={WHITESPACE:g,LETTERSPACING:p,BREAKON:m,INNER_WIDTH:e},y=d._whiteSpace._inlineWrapper;r+=d._margin._value.w+d._padding._value.w,d._inlines.value.forEach((b,_,x)=>{const S=s[s.length-1];if(y(x,_,r,v)){if(s.push(new D1(b)),b.offsetX=b.xoffset,b.width===0){r=0;return}b.cumulativeWidth=b.xadvance+p,r=b.cumulativeWidth;return}s[s.length-1].push(b),b.offsetX=r+b.xoffset+b.kerning,b.cumulativeWidth=b.xadvance+b.kerning+p,r+=b.cumulativeWidth,S.length-1===1&&S[S.length-2].width===0&&(b.offsetX-=b.xoffset,r-=b.xoffset)}),r+=d._margin._value.y+d._padding._value.y});const o=t._whiteSpace._inlineCollapser;let a=0,l=0,h=0;s.forEach((d,f)=>{const p=o(d);let g=0,m=0;if(d.forEach(v=>{g=Math.max(g,v.lineHeight),m=Math.max(m,v.lineBase),v.offsetX-=p}),d.lineHeight=g,d.lineBase=m,f===0?h=-(g*i-g)*.5:h-=s[f-1].lineHeight*i,d.y=h,d.x=0,d.forEach(v=>{v.offsetY=h-v.anchor,v.lineHeight<d.lineHeight&&(v.offsetY-=d.lineBase-v.lineBase)}),l+=d.lineHeight*i,d.width=0,d[0]){const v=d[d.length-1];d.width=v.offsetX+v.cumulativeWidth+v.paddingRight+v.marginRight+d[0].offsetX,a=Math.max(a,d.width)}}),s.height=l,s.width=a,this._value=s,e===1/0&&t._bounds.setChildrenWidth(t,s.width),t._height._auto&&t._bounds.setChildrenHeight(t,s.height);const u=t._parent._value;u&&(u._autoSize._needsProcess=!0,u._flexDirection._needsProcess=!0),t._inlineJustificator._needsProcess=!0,t._textAlign._needsProcess=!0,t._overflow._needsUpdate=!0}_resetInlines(t){t._fontSize.process(t)}}class P4 extends qC{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(t){this._value=this._inheritedInput,this._needsProcess=!0}process(t){M4(t),t._renderer._needsRender=!0}}function M4(n){const t=n._layouter._value,e=n._textAlign._value,i=n._bounds._innerWidth;for(let s=0;s<t.length;s++){const r=t[s],o=k4(n,r,s===t.length-1),a=n._padding._value,l=n._borderWidth._value,h=(-a.w+a.y)/2+(-l.w+l.y)/2;r.x+=o;for(let u=0;u<r.length;u++)r[u].offsetX+=o-h}if(e.indexOf("justify")===0)for(let s=0;s<t.length;s++){const r=t[s];if(e.indexOf("-")!==-1&&s===t.length-1)return;const o=i-r.width;if(o<=0)return;let a=0;for(let d=1;d<r.length-1;d++)a+=r[d].char===" "?1:0;const l=o/a;let h=1;e==="justify-right"&&(r.reverse(),h=-1);let u=0;for(let d=1;d<=r.length-1;d++){const f=r[d];f.offsetX+=u*h,u+=f.char===" "?l:0}e==="justify-right"&&r.reverse()}}function k4(n,t,e){switch(n._textAlign._value){case"justify-left":case"justify":case"left":return-n._bounds._innerWidth/2;case"justify-right":case"right":return-t.width+n._bounds._innerWidth/2;case"center":return-t.width/2;case"justify-center":return e?-t.width/2:-n._bounds._innerWidth/2;default:console.warn(`textAlign: '${n._textAlign._value}' is not valid`)}}class D4 extends XC{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(t){this._value=this._inheritedInput}}class O4 extends gM{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class L4 extends v0{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(t){super._computeFromInherited(t)}}class F4 extends _M{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class U4 extends Ot{constructor(){super("children",null,!1);c(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1);this._uis=[],this._inlines=[],this._boxes=[]}update(e,i){this._compute(e),this._needsProcess=!0}process(e){this._compute(e),e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class N4 extends Ot{constructor(){super("autosize")}process(t){if(t._layouter._value&&t._layouter._value.length){const e=t._layouter._value,i=t._padding._value,s=t._borderWidth._value;t._width._auto&&t._bounds.setOffsetWidth(t,e.width+i.w+i.y+s.w+s.y),t._height._auto&&t._bounds.setOffsetHeight(t,e.height+i.x+i.z+s.x+s.z)}}}class z4 extends xM{constructor(){super("renderer"),this._needsUpdate=!1}render(t){super.render(t);for(const e of t._children._inlines)e._renderer.render(e);t.performAfterUpdate()}}class Xg extends Wg{constructor(t={},e={}){Xg.definePropertiesValues(e,t),super(e,t),Xg.init(this)}add(t){const e=[];let i=!1;for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(r.isInline&&(i=!0),e.push(r)):console.warn("Block element can only contain Box elements.",r)}return e.length>0&&super.add(...e),i&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(t){this._textContent.value=t}get textContent(){return super.textContent}set invertAlpha(t){this._invertAlpha.value=t}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(t,e){t.flexDirection=D4,t.justifyContent=YC,t.alignItems=WC,t.bounds=F4,t.autoSize=N4,t.renderer=z4,t.children||(t.children=U4),t.textContent||(t.textContent=T4),t.layouter||(t.layouter=B4),t.lineHeight||(t.lineHeight=O4),t.textAlign||(t.textAlign=P4),t.whiteSpace||(t.whiteSpace=hS),t.fontKerning||(t.fontKerning=L4),t.segments||(t.segments=OM),e.width||(e.width="100%"),e.fontSide||(e.fontSide=0)}static init(t){Object.defineProperties(t,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class Q4 extends Ot{constructor(){super("inlines",null,!1),this._value=[]}process(t){this._value[0].paddingLeft=t._padding._value.w,this._value[0].marginLeft=t._margin._value.w;const e=this._value.length-1;this._value[e].paddingRight=t._padding._value.y,this._value[e].marginRight=t._margin._value.y}}class j4 extends Ot{constructor(){super("renderer")}render(t){t._backgroundMesh||t.setBackgroundMesh(new wM(t)),t._backgroundMesh.position.x=t._inlines._value[0].offsetX+t._inlines._value[0].width/2,t._backgroundMesh.position.y=t._inlines._value[0].offsetY+t._inlines._value[0].lineBase/2,t._bounds.render(t)}}class G4 extends Ot{constructor(){super("bounds",null,!1),this._size=new fe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(t,e){this.output(e),this._needsProcess=!0}process(t){this._offsetWidth=this._innerWidth=t._inlines._value[0].width,this._offsetHeight=this._innerHeight=t._inlines._value[0].height,this._needsRender=!0,t._borderWidth._needsRender=!0,t._borderRadius._needsRender=!0}render(t){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(t){t.size=this._size}}class Yg extends xm{constructor(t={}){const e={};Yg.definePropertiesValues(e,t),super(e,t),Yg.init(this)}clear(){for(const t of this._inlines._value)t.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new fe.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(t){const e=[];for(let i=0;i<arguments.length;i++){const s=arguments[i];s.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",s):(e.push(s),s.position.z=.005)}return super.add(...e)}static definePropertiesValues(t,e){t.children||(t.children=LM),t.bounds||(t.bounds=G4),t.inlines||(t.inlines=Q4),t.layouter||(t.layouter=SM),t.renderer||(t.renderer=j4),t.fontFamily||(t.fontFamily=TM),t.fontWeight||(t.fontWeight=IM),t.fontStyle||(t.fontStyle=EM),t.fontSize||(t.fontSize=DM),t.backgroundColor||(t.backgroundColor=rM),t.lineBreak||(t.lineBreak=CM),t.letterSpacing||(t.letterSpacing=kM),t.whiteSpace||(t.whiteSpace=hS),t.fontKerning||(t.fontKerning=v0),e.backgroundSize||(e.backgroundSize="cover"),e.width||(e.width="100%"),e.height||(e.height="100%"),e.boxSizing||(e.boxSizing="border-box")}static init(t){Object.defineProperties(t,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),t._inlines._value=[new H4(t)],t.backgroundMaterial=new bM,t._renderer.render(t)}}class H4 extends eM{constructor(t){super(),this._uiElement=t}get xadvance(){const t=this._uiElement._padding._value,e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.w+t.y+e.value}get width(){const t=this._uiElement._width;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.value}get height(){const t=this._uiElement._height;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.value}get anchor(){return this.height}get lineHeight(){const t=this._uiElement._height;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.value}get lineBase(){const t=this._uiElement._height;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):t.value}clear(){this._uiElement=null}}class FM{constructor(t){this._subject=t}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const UM=()=>ey.update(),NM={BaseProperty:Ot,Block:qg,Text:Xg,Inline:Ef,InlineBlock:Yg,MeshUIBaseElement:xm,FontLibrary:Cu,update:UM,MSDFFontMaterialUtils:ao,ShaderChunkUI:yM,Behavior:FM,FontVariant:wm};typeof global<"u"&&(global.ThreeMeshUI=NM);const V4=NM;var W4=Yi.ti,zM=Yi.nS,uS=Yi.eB,q4=Yi.Yp,Xw=Yi.VB,X4=Yi.BC,Y4=Yi.zN,yv=Yi.cV,K4=Yi.hW,J4=Yi.k2,Z4=Yi.K6,$4=Yi.M7,ez=Yi.ls,tz=Yi.Hi,dS=Yi.EY,iz=Yi.MR,nz=Yi.zf,Wt=Yi.Ay,QM=Yi.yo;const F1=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:W4,Behavior:zM,Block:uS,DefaultValues:q4,FontLibrary:Xw,FontVariant:X4,InheritableProperty:Y4,Inline:yv,InlineBlock:K4,InlineGlyph:J4,MSDFFontMaterialUtils:Z4,MaterialTransformers:$4,MeshUIBaseElement:ez,ShaderChunkUI:tz,Text:dS,TypographicFont:iz,TypographicGlyph:nz,default:Wt,update:QM},Symbol.toStringTag,{value:"Module"}));class sz{constructor(){c(this,"Rad2Deg",180/Math.PI);c(this,"Deg2Rad",Math.PI/180);c(this,"Epsilon",1e-5)}random(t,e){return Array.isArray(t)?t.length<=0?null:t[Math.floor(Math.random()*t.length)]:t!==void 0&&e!==void 0?Math.random()*(e-t)+t:Math.random()}randomVector3(t,e=0,i=1){t.x=this.random(e,i),t.y=this.random(e,i),t.z=this.random(e,i)}clamp(t,e,i){return t<e?e:t>i?i:t}clamp01(t){return this.clamp(t,0,1)}lerp(t,e,i){return i=i<0?0:i,i=i>1?1:i,t+(e-t)*i}inverseLerp(t,e,i){return(i-t)/(e-t)}remap(t,e,i,s,r){return s+(r-s)*(t-e)/(i-e)}moveTowards(t,e,i){return t+=i,(i<0&&t<e||i>0&&t>e)&&(t=e),t}toDegrees(t){return t*180/Math.PI}toRadians(t){return t*Math.PI/180}tan(t){return Math.tan(t)}gammaToLinear(t){return Math.pow(t,2.2)}linearToGamma(t){return Math.pow(t,1/2.2)}approximately(t,e,i=Number.EPSILON){for(const s of rz){const r=t[s],o=e[s];if(r===void 0||o===void 0)break;if(Math.abs(r-o)>i)return!1}return!0}easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}}const rz=["x","y","z","w"],ye=new sz;class U1{constructor(t){c(this,"y");c(this,"s");c(this,"alpha",0);this.setAlpha(t),this.y=null,this.s=null}setAlpha(t){if(t<=0||t>1)throw new Error;this.alpha=t}filter(t,e){e&&this.setAlpha(e);let i;return this.y?i=this.alpha*t+(1-this.alpha)*this.s:i=t,this.y=t,this.s=i,i}lastValue(){return this.y}reset(t){this.y=t,this.s=t}}class jb{constructor(t,e=1,i=0,s=1){c(this,"freq");c(this,"minCutOff");c(this,"beta");c(this,"dCutOff");c(this,"x");c(this,"dx");c(this,"lasttime");if(t<=0||e<=0||s<=0)throw new Error;this.freq=t,this.minCutOff=e,this.beta=i,this.dCutOff=s,this.x=new U1(this.alpha(this.minCutOff)),this.dx=new U1(this.alpha(this.dCutOff)),this.lasttime=null}alpha(t){const e=1/this.freq;return 1/(1+1/(2*Math.PI*t)/e)}filter(t,e=null){this.lasttime&&e&&(this.freq=1/(e-this.lasttime)),this.lasttime=e;const i=this.x.lastValue(),s=i?(t-i)*this.freq:0,r=this.dx.filter(s,this.alpha(this.dCutOff)),o=this.minCutOff+this.beta*Math.abs(r);return this.x.filter(t,this.alpha(o))}reset(t){t!=null&&this.x.reset(t),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class jM{constructor(t,e=1,i=0,s=1){c(this,"x");c(this,"y");c(this,"z");this.x=new jb(t,e,i,s),this.y=new jb(t,e,i,s),this.z=new jb(t,e,i,s)}filter(t,e,i=null){e.x=this.x.filter(t.x,i),e.y=this.y.filter(t.y,i),e.z=this.z.filter(t.z,i)}reset(t){this.x.reset(t==null?void 0:t.x),this.y.reset(t==null?void 0:t.y),this.z.reset(t==null?void 0:t.z)}}class If extends J{constructor(t,e,i,s=128){if(e<=0||i<=0||s<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const r=new Bu(i,2*s,s);r.scale(1,1,-1);const o=r.getAttribute("position"),a=new w;for(let l=0;l<o.count;++l)if(a.fromBufferAttribute(o,l),a.y<0){const h=-e*3/2,u=a.y<h?-e/a.y:1-a.y*a.y/(3*h*h);a.multiplyScalar(u),a.toArray(o.array,3*l)}o.needsUpdate=!0,super(r,new _t({map:t,depthWrite:!1}))}}const bv="needle:cameraController";function oz(n){return n[bv]}function N1(n,t,e){e?n[bv]=t:n[bv]===t&&(n[bv]=null)}const Yw="needle:autofit";function az(n){return n[Yw]===void 0?!0:n[Yw]!==!1}function z1(n,t){n[Yw]=t}function fK(n,t,e){const i=n.length(),s=t.length(),r=ye.lerp(i,s,e);return n.lerp(t,e).normalize().multiplyScalar(r)}const Gb=new ie,GM=new ie().setFromAxisAngle(new w(0,1,0),Math.PI);function pK(n,t){n.lookAt(t),n.quaternion.multiply(GM)}function y0(n,t,e=!0,i=!1){if(n===t)return;Gb.copy(n.quaternion);const s=He(t),r=He(n);if(i){if(ia(n,Gt(t)),e){const o=r.y,a=r.sub(VM(n));a.y=o,n.lookAt(a),n.quaternion.multiply(GM)}Number.isNaN(n.quaternion.x)&&n.quaternion.copy(Gb);return}e&&(s.y=r.y),n.lookAt(s),Number.isNaN(n.quaternion.x)&&n.quaternion.copy(Gb)}const lz=new _o(()=>new w,100);function Re(n,t,e){const i=lz.get();return i.set(0,0,0),n instanceof w?i.copy(n):Array.isArray(n)?i.set(n[0],n[1],n[2]):n instanceof DOMPointReadOnly?i.set(n.x,n.y,n.z):typeof n=="number"?(i.x=n,i.y=t!==void 0?t:i.x,i.z=e!==void 0?e:i.x):typeof n=="object"&&(i.x=n.x,i.y=n.y,i.z=n.z),i}const cz=new _o(()=>new be,30);function hz(n){const t=cz.get();return n?t.copy(n):t.set(0,0,0),t}const uz=new _o(()=>new ie,100);function Ia(n){const t=uz.get();return t.identity(),n instanceof ie?t.copy(n):n instanceof DOMPointReadOnly&&t.set(n.x,n.y,n.z,n.w),t}const fS=new _o(()=>new w,100),Q1=Symbol("lastMatrixWorldUpdateKey");function He(n,t=null,e=!0){const i=t??fS.get();return n?n.parent?(e&&n.updateWorldMatrix(!0,!1),n.matrixWorldNeedsUpdate&&n[Q1]!==Date.now()&&(n[Q1]=Date.now(),n.updateMatrixWorld()),i.setFromMatrixPosition(n.matrixWorld),i):i.copy(n.position):i.set(0,0,0)}function Cn(n,t){if(!n)return n;const e=fS.get();return t!==e&&e.copy(t),((n==null?void 0:n.parent)??n).worldToLocal(e),n.position.set(e.x,e.y,e.z),n}function Tf(n,t,e,i){const s=fS.get();return s.set(t,e,i),Cn(n,s),n}const iy=new _o(()=>new ie,100),hu=new ie,Hb=new ie;function Gt(n,t=null){if(!n)return iy.get().identity();const e=t??iy.get();return n.parent?(n.getWorldQuaternion(e),e):e.copy(n.quaternion)}function ia(n,t){if(!n)return;t!==hu&&hu.copy(t);const e=hu,i=n==null?void 0:n.parent;i==null||i.getWorldQuaternion(Hb),Hb.invert();const s=Hb.multiply(e);n.quaternion.set(s.x,s.y,s.z,s.w)}function HM(n,t,e,i,s){hu.set(t,e,i,s),ia(n,hu)}const dz=new _o(()=>new w,100),fz=new w;function ri(n,t=null){return t||(t=dz.get()),n?n.parent?(n.getWorldScale(t),t):t.copy(n.scale):t.set(0,0,0)}function Kg(n,t){if(!n)return;if(!n.parent){n.scale.copy(t);return}const e=fz;n.parent.getWorldScale(e),n.scale.copy(t),n.scale.divide(e)}const pz=new w,j1=new ie;function gK(n){return Gt(n,j1),pz.set(0,0,1).applyQuaternion(j1)}const gz=new _o(()=>new w,100),G1=new ie;function VM(n,t){return t||(t=gz.get().set(0,0,1)),Gt(n,G1),t.applyQuaternion(G1)}const H1=new jt,V1=new jt,mz=new w;function WM(n){const t=iy.get();return n.getWorldQuaternion(t),V1.setFromQuaternion(t),V1}function qM(n,t){const e=iy.get();ia(n,e.setFromEuler(t))}function b0(n){const t=WM(n),e=mz;return e.set(t.x,t.y,t.z),e.x=ye.toDegrees(e.x),e.y=ye.toDegrees(e.y),e.z=ye.toDegrees(e.z),e}function XM(n,t){_0(n,t.x,t.y,t.z,!0)}function _0(n,t,e,i,s=!0){s&&(t=ye.toRadians(t),e=ye.toRadians(e),i=ye.toRadians(i)),H1.set(t,e,i),hu.setFromEuler(H1),ia(n,hu)}function Kw(n,t=!0){n&&(t?function e(i){console.groupCollapsed((i.name?i.name:"(no name : "+i.type+")")+" %o",i),i.children.forEach(e),console.groupEnd()}(n):n.traverse(function(e){for(var i="|___",s=e;s.parent!==null;)i="	"+i,s=s.parent;console.log(i+e.name+" <"+e.type+">")}))}function mK(n){let t=(n==null?void 0:n.name)||"";if(!n)return t;let e=n.parent;for(;e;)t=e.name+"/"+t,e=e.parent;return t}function Az(n){if(n){const t=n;return t.blendMode!==void 0&&t.clampWhenFinished!==void 0&&t.enabled!==void 0&&t.fadeIn!==void 0&&t.getClip!==void 0}return!1}class Go{static createBlitMaterial(t){return new $e({uniforms:{map:new $(null)},vertexShader:this.vertex,fragmentShader:t})}static copyTexture(t,e){const i=e??this.blipMaterial;i.uniforms.map.value=t,i.needsUpdate=!0,i.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new $e({uniforms:{map:new $(null)},vertexShader:this.vertex,fragmentShader:this.fragment}));const s=i.vertexShader;i.vertexShader=this.vertex,this.mesh||(this.mesh=new J(this.planeGeometry,this.blipMaterial));const r=this.mesh;r.material=i,r.frustumCulled=!1,this.scene.children.length=0,this.scene.add(r),this.renderer||(this.renderer=new Pu({antialias:!1})),this.renderer.setSize(t.image.width,t.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const o=new At(this.renderer.domElement);return o.name="Copy",o.needsUpdate=!0,i.vertexShader=s,o}static textureToCanvas(t,e){if(!t)return null;(e===!0||t.isCompressedTexture===!0)&&(t=vz(t));const i=t.image;if(yz(i)){const s=document.createElement("canvas");s.width=i.width,s.height=i.height;const r=s.getContext("2d");return r?(r.drawImage(i,0,0,i.width,i.height,0,0,s.width,s.height),s):(console.error("Failed getting canvas 2d context"),null)}return null}}c(Go,"planeGeometry",new pr(2,2,1,1)),c(Go,"renderer"),c(Go,"perspectiveCam",new bt),c(Go,"scene",new ws),c(Go,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),c(Go,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),c(Go,"blipMaterial"),c(Go,"mesh");function vz(n){return Go.copyTexture(n)}function AK(n,t=!1){return Go.textureToCanvas(n,t)}function yz(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}function bz(n){const t=n.type;return t==="Mesh"||t==="SkinnedMesh"}function YM(n,t){t?n["needle:rendercustomshadow"]=!0:n["needle:rendercustomshadow"]=!1}function _z(n){if(n){if(n["needle:rendercustomshadow"]===!0)return!0;if(n["needle:rendercustomshadow"]==null)return!0}return!1}function sl(n,t=void 0){const e=new xn;e.makeEmpty();const i=[];function s(o){let a=!0;if(o.visible&&az(o)!==!1&&!(o.type==="TransformControlsGizmo"||o.type==="TransformControlsPlane")){if(o instanceof vP&&(a=!1),o instanceof TC&&(a=!1),o instanceof If&&(a=!1),o.isGizmo===!0&&(a=!1),o.material instanceof AP&&(a=!1),bz(o)||(a=!1),a){if(t&&Array.isArray(t)&&(t!=null&&t.includes(o)))return;if(typeof t=="function"&&t(o)===!0)return}if(o.isUI!==!0){if(a){const l=o.children;o.children=i;const h=o.position,u=o.scale;if(Number.isNaN(h.x)||Number.isNaN(h.y)||Number.isNaN(h.z)){console.warn(`Object "${o.name}" has NaN values in position or scale.... will ignore it`,h,u);return}e.expandByObject(o,!0),o.children=l}for(const l of o.children)s(l)}}}let r=!1;for(const o of n)o&&(r=!0,o.updateMatrixWorld(),s(o));return r||console.warn("No objects to fit camera to..."),e}function wz(n,t,e){const i=sl([n],e==null?void 0:e.ignore),s=new w;i.getSize(s);const r=new w;i.getCenter(r);const o=new w;t.getSize(o);const a=new w;t.getCenter(a);const l=new w;l.set(o.x/s.x,o.y/s.y,o.z/s.z);const h=Math.min(l.x,l.y,l.z),u=(e==null?void 0:e.scale)!==!1;if(u&&Kg(n,ri(n).multiplyScalar(h)),(e==null?void 0:e.position)!==!1){const d=new w;i.getCenter(d),d.y=i.min.y;const f=new w;t.getCenter(f),f.y=t.min.y;const p=f.clone().sub(d);u&&p.multiplyScalar(h),Cn(n,He(n).add(p))}return{boundsBefore:i,scale:l}}function xz(n,t){const e=sl([n]),i=new w;e.getCenter(i),i.y=e.min.y;const s=t.clone().sub(i),r=He(n);return Cn(n,r.add(s)),{offset:s,bounds:e}}function KM(n,t,e,i){if(Array.isArray(t)){let o=!0;for(let a=0;a<t.length;a++)KM(n,t[a],a,t)||(o=!1);return o}if(t.type==="MeshStandardMaterial")return!1;if(t["material:fbx"]!=null)return!0;const s=new Kn;s["material:fbx"]=t;const r=t;return r&&(r.map?s.color.set(1,1,1):s.color.copyLinearToSRGB(r.color),s.emissive.copyLinearToSRGB(r.emissive),s.emissiveIntensity=r.emissiveIntensity,s.opacity=r.opacity,s.displacementScale=r.displacementScale,s.transparent=r.transparent,s.bumpMap=r.bumpMap,s.aoMap=r.aoMap,s.map=r.map,s.displacementMap=r.displacementMap,s.emissiveMap=r.emissiveMap,s.normalMap=r.normalMap,s.envMap=r.envMap,s.alphaMap=r.alphaMap,s.metalness=r.reflectivity,r.shininess&&(s.roughness=1-Math.sqrt(r.shininess)/10),s.needsUpdate=!0),e===void 0?n.material=s:i[e]=s,!0}let gA=!1;wU((...n)=>{var t;ve()&&((t=xt.Current)!=null&&t.isInXR)&&(rf(!0),JM("error",...n))});function rf(n){if(n){if(gA)return;gA=!0,Sz()}else{if(!gA)return;gA=!1,Ez()}}const ig={log:void 0,warn:void 0,error:void 0};class Cz{constructor(){c(this,"familyName","needle-xr");c(this,"root",null);c(this,"context",null);c(this,"defaultFontSize",.06);c(this,"targetObject",new ne);c(this,"userForwardViewPoint",new w);c(this,"oneEuroFilter",new jM(90,.8));c(this,"_lastElementRemoveTime",0);c(this,"onBeforeRender",()=>{var e,i;const t=(e=this.context)==null?void 0:e.mainCamera;if(this.context&&t instanceof bt){const s=this.getRoot();Number.isNaN(s.position.x)&&s.position.set(0,0,0),Number.isNaN(s.quaternion.x)&&s.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const r=((i=this.context.xr)==null?void 0:i.rigScale)??1,o=3.5*r,a=t.worldForward;a.y=0,a.normalize().multiplyScalar(o),this.userForwardViewPoint.copy(t.worldPosition).sub(a),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*r&&(this.targetObject.position.copy(this.userForwardViewPoint),y0(this.targetObject,t,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,s.position,this.context.time.time);const h=this.context.time.deltaTime;if(s.quaternion.slerp(this.targetObject.quaternion,h*5),s.scale.setScalar(r),this.targetObject.removeFromParent(),this.context.scene.add(s),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const u=Date.now();for(let d=0;d<this._activeTexts.length;d++){const f=this._activeTexts[d];if(f instanceof Wt.Text&&u-f._activatedTime>2e4){f.removeFromParent(),this._textBuffer.push(f),this._activeTexts.splice(d,1);break}}}}});c(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025});c(this,"_textBuffer",[]);c(this,"_activeTexts",[]);this.ensureFont()}onEnable(){this.context=xt.Current||xt.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var t,e,i;(e=this.context)==null||e.pre_render_callbacks.splice((t=this.context)==null?void 0:t.pre_render_callbacks.indexOf(this.onBeforeRender),1),(i=this.root)==null||i.removeFromParent()}addLog(t,e){const i=this.getRoot(),s=this.getText();let r=16777215,o=0;switch(t){case"log":r=16777215,o=0;break;case"warn":r=16772761,o=4465152;break;case"error":r=16755370,o=7798784;break}e.length>1e3&&(e=e.substring(0,1e3)+"...");const a=new Date().toISOString().split("T")[1].split(".")[0];s.textContent="["+a+"] "+e,s.visible=!0,s._activatedTime=Date.now(),i.add(s),this._activeTexts.push(s),this.context&&this.context.scene.add(i),s.set({backgroundColor:r,color:o}),Wt.update()}ensureFont(){let t=Wt.FontLibrary.getFontFamily(this.familyName);if(!t){t=Wt.FontLibrary.addFontFamily(this.familyName);const e=t.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");e==null||e.addEventListener("ready",()=>{Wt.update()})}}getText(){const t=this.getRoot();if(this._textBuffer.length>0){const i=this._textBuffer.pop();return i.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(i),100),i}if(t.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const e=new Wt.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(e),500),setTimeout(()=>this.disableDepthTestRecursive(e),1500),e}disableDepthTestRecursive(t,e=0){for(let s=0;s<t.children.length;s++){const r=t.children[s];r instanceof ne&&this.disableDepthTestRecursive(r,e+1)}t.renderOrder=10*e,t.layers.set(2);const i=t.material;i&&(i.depthWrite=!1,i.depthTest=!1,i.transparent=!0),e===0&&Wt.update()}getRoot(){if(this.root)return this.root;const t=this.defaultFontSize,e={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:t,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new Wt.Block(e),this.root}}let js=null;function Sz(){js||(js=new Cz),js.onEnable();for(const n in ig){ig[n]=console[n];let t=!1;console[n]=function(){var e;if((e=ig[n])==null||e.apply(console,arguments),!t)try{t=!0,JM(n,...arguments)}finally{t=!1}}}}function Ez(){js==null||js.onDisable();for(const n in ig)console[n]=ig[n]}const cp=new Map;function JM(n,...t){try{switch(cp.clear(),n){case"log":js==null||js.addLog("log",e());break;case"warn":js==null||js.addLog("warn",e());break;case"error":js==null||js.addLog("error",e());break}}catch(r){console.error("Error in spatial console",r)}finally{cp.clear()}function e(){let r="";for(let o=0;o<t.length;o++){const a=t[o];r+=i(a),o<t.length-1&&(r+=", ")}return r}function i(r,o=0){if(typeof r=="string")return'"'+r+'"';if(typeof r=="number"){if(r%1!==0){const l=r.toFixed(5),h=l.indexOf(".");let u=l.length-1;for(;u>h&&l[u]==="0";)u--;return l.substring(0,u+1)}return r.toString()}else if(Array.isArray(r)){let a="[";for(let l=0;l<r.length;l++){const h=r[l];a+=i(h,o+1),l<r.length-1&&(a+=", ")}return a+="]",a}else{if(r===null)return"null";if(r===void 0)return"undefined";if(typeof r=="function")return r.name+"()"}if(r instanceof oe)return`(${i(r.x)}, ${i(r.y)})`;if(r instanceof w)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)})`;if(r instanceof Fe)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof ie)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof mt||r instanceof At)return r.name;if(r instanceof za)return`[${r.elements.join(", ")}]`;if(r instanceof ae)return`[${r.elements.join(", ")}]`;if(r instanceof go)return r.mask.toString();if(typeof r=="object"){if(cp.has(r))return"*";let a=`{
`;a+=s(o);const l=Object.keys(r);let h="";for(let u=0;u<l.length;u++){const d=l[u],f=r[d];if(cp.has(f)){h+="";continue}cp.set(f,!0),h+=d+":"+i(f,o+1),u<l.length-1&&(h+=", "),h.length>=60&&(h+=`
`,h+=s(o),a+=h,h="")}return a+=h,a+=`
}`,a}return r}function s(r){let o="";for(let a=0;a<r;a++)o+=" ";return o}}const Iz=z("nodevlogs");function bi(n,t=Xi.Log){Qa(t,n)}function qt(n){bi(n,Xi.Warn)}function pS(n){bi(n,Xi.Error)}let Jw,Vb;function ve(){if(Iz)return!1;if(Jw!==void 0)return Jw;if(Vb!==void 0)return Vb;let n=fr();return n||(n=window.location.hostname.endsWith(".local-credentialless.webcontainer.io")),Vb=n,n}function vK(n){Jw=n}let Mr=null,Rr=null,ja=null,Wb=!1,W1=null;const ZM="terminal",Np=z("console"),Tz=z("noerrors")||z("noconsole");Np&&$M();if(!Tz&&(Np||fr())){if(fr()&&!Np){const t=new URL(window.location.href);t.searchParams.set("console","1"),console.log('ðŸŒµ Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+t.toString())}const n=dc()||zC()&&ve();if((n||Np)&&(SU(),ek(),tk(!0),n)){const t=document.querySelector("needle-engine");t==null||t.addEventListener("enter-ar",()=>{(Np||Mr||jC()>0)&&z("noerrors")}),t==null||t.addEventListener("exit-ar",()=>{kz()})}}const Zw=Symbol("consoleParent");function $M(){if(Mr!==null){Mr.showSwitch();return}tk()}function Rz(){Mr!==null&&(Mr.hide(),Mr.hideSwitch())}function ek(){W1||(W1=setInterval(Bz,500))}let q1=0;function Bz(){const n=jC(),t=n!==q1;q1=n,t&&Pz()}function Pz(){$M(),ja&&(ja.setAttribute("error","true"),ja.innerText="ðŸ¤¬")}function Mz(){ja&&(ja.removeAttribute("error"),ja.innerText=ZM)}function kz(){Rr&&Rr[Zw]&&Rr[Zw].appendChild(Rr)}function tk(n=!1){if(Mr||Wb)return;Wb=!0;const t=document.createElement("script");t.onload=()=>{Wb=!1,ek(),Mr=new VConsole({pluginOrder:["default","needle-console"]});const e=globalThis["needle:codegen_files"];if(e&&e.length>0&&Mr.addPlugin(Dz()),Rr=Lz(),Rr&&(Rr[Zw]=Rr.parentElement,Rr.style.position="absolute",Rr.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),Mr.setSwitchPosition(20,30),ja=Oz(),ja){ja.innerText=ZM,ja.addEventListener("click",Mz);const i=document.createElement("style"),s=40;i.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${s}px;
                    height: ${s}px;
                    padding: 0;
                    line-height: ${s}px;
                    font-size: ${s*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,Rr==null||Rr.prepend(i),n===!0&&jC()<=0&&Rz(),console.log("ðŸŒµ Debug console has loaded")}},t.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(t)}function Dz(){const n=new VConsole.VConsolePlugin("needle-console","ðŸŒµ Inspect glTF"),t=()=>document.querySelector("#__vc_plug_"+n._id+" iframe");return n.on("renderTab",function(e){const i=globalThis["needle:codegen_files"];if(!i||i.length===0)return;let s=globalThis["needle:codegen_files"][0];const r=s.indexOf("?");r>-1&&(s=s.substring(0,r));const a=location.protocol+"//"+location.host+location.pathname+"/"+s,l=encodeURIComponent(a);n.fullUrl="https://viewer.needle.tools?inspect&file="+l;var h='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';e(h)}),n.on("show",function(){const e=t();e&&e.src!==n.fullUrl&&(e.src=n.fullUrl)}),n.on("hide",function(){const e=t();e&&(e.src="")}),n.on("addTopBar",function(e){var i=new Array;i.push({name:"Open in new window â†—",onClick:function(s){window.open(n.fullUrl,"_blank"),Mr==null||Mr.hide()}}),i.push({name:"Reload",onClick:function(s){const r=t();r&&(r.src=n.fullUrl)}}),i.push({name:"Fullscreen",onClick:function(s){const r=t();r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen instanceof Function&&r.webkitRequestFullscreen()}}),e(i)}),n}function Oz(){const n=document.querySelector("#__vconsole .vc-switch");return n||null}function Lz(){const n=document.querySelector("#__vconsole");return n||null}const ik=z("debugdefines");Nf('if(!globalThis[""3.48.1""]) globalThis[""3.48.1""] = "0.0.0";');Nf('if(!globalThis[""Needle Engine for Blender 0.51.4""]) globalThis[""Needle Engine for Blender 0.51.4""] = "unknown";');Nf('if(!globalThis[""Wed Sep 25 2024 20:50:00 GMT-0600 (hora estÃ¡ndar central)""]) globalThis[""Wed Sep 25 2024 20:50:00 GMT-0600 (hora estÃ¡ndar central)""] = "unknown";');Nf('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.48.1";');Nf('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "Needle Engine for Blender 0.51.4";');Nf('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Wed Sep 25 2024 20:50:00 GMT-0600 (hora estÃ¡ndar central)";');const Xo="3.48.1",gS="Needle Engine for Blender 0.51.4",nk="Wed Sep 25 2024 20:50:00 GMT-0600 (hora estÃ¡ndar central)";ik&&console.log(`Engine version: ${Xo} (generator: ${gS})
Project built at ${nk}`);const eh="needle_isActiveInHierarchy",wd="builtin_components",_v="needle_editor_guid";function Nf(n){try{(0,eval)(n)}catch(t){ik&&console.error(t)}}const Fz='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',Uz=btoa(Fz),Nz="data:image/svg+xml;base64,"+Uz,zz=Nz,Qz=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(Qz);const jz='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',Gz=btoa(jz),Hz="data:image/svg+xml;charset=utf-8;base64,"+Gz,Vz=Hz;/**
 * postprocessing v6.36.2 build Tue Sep 10 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van RÃ¼schen
 * @license Zlib
 */var qb=1/1e3,Wz=1e3,qz=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*qb}get fixedDelta(){return this._fixedDelta*qb}set fixedDelta(n){this._fixedDelta=n*Wz}get elapsed(){return this._elapsed*qb}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Xz=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),e=new Ht;return e.setAttribute("position",new Ke(n,3)),e.setAttribute("uv",new Ke(t,2)),e})(),Tn=class $w{static get fullscreenGeometry(){return Xz}constructor(t="Pass",e=new ws,i=new VL){this.name=t,this.renderer=null,this.scene=e,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const e=this.fullscreenMaterial;e!==null&&(e.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let e=this.screen;e!==null?e.material=t:(e=new J($w.fullscreenGeometry,t),e.frustumCulled=!1,this.scene===null&&(this.scene=new ws),this.scene.add(e),this.screen=e)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,e=qs){}render(t,e,i,s,r){throw new Error("Render method not implemented!")}setSize(t,e){}initialize(t,e,i){}dispose(){for(const t of Object.keys(this)){const e=this[t];(e instanceof Et||e instanceof mt||e instanceof At||e instanceof $w)&&this[t].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Yz=class extends Tn{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,t,e,i,s){const r=n.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},Kz=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Lu="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",sk=class extends $e{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new $(null),opacity:new $(1)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Kz,vertexShader:Lu})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},rk=class extends Tn{constructor(n,t=!0){super("CopyPass"),this.fullscreenMaterial=new sk,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Et(1,1,{minFilter:Mt,magFilter:Mt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,t,e,i,s){this.fullscreenMaterial.inputBuffer=t.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){this.autoResize&&this.renderTarget.setSize(n,t)}initialize(n,t,e){e!==void 0&&(this.renderTarget.texture.type=e,e!==gi?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Ge&&(this.renderTarget.texture.colorSpace=Ge))}},X1=new be,w0=class extends Tn{constructor(n=!0,t=!0,e=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=t,this.stencil=e,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,t,e){this.color=n,this.depth=t,this.stencil=e}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,t,e,i,s){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),l=r!==null,h=o>=0;l?(n.getClearColor(X1),n.setClearColor(r,h?o:a)):h&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:t),n.clear(this.color,this.depth,this.stencil),l?n.setClearColor(X1,a):h&&n.setClearAlpha(a)}},Jz=class extends Tn{constructor(n,t){super("MaskPass",n,t),this.needsSwap=!1,this.clearPass=new w0(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,t,e,i,s){const r=n.getContext(),o=n.state.buffers,a=this.scene,l=this.camera,h=this.clearPass,u=this.inverted?0:1,d=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,u,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(n,null):(h.render(n,t),h.render(n,e))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,l)):(n.setRenderTarget(t),n.render(a,l),n.setRenderTarget(e),n.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},mS=class{constructor(n=null,{depthBuffer:t=!0,stencilBuffer:e=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,e,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new rk,this.depthTexture=null,this.passes=[],this.timer=new qz,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const t=this.inputBuffer,e=this.multisampling;e>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):e!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const t=n.getSize(new oe),e=n.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===gi&&n.outputColorSpace===Ge&&(this.inputBuffer.texture.colorSpace=Ge,this.outputBuffer.texture.colorSpace=Ge,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(t.width,t.height);for(const s of this.passes)s.initialize(n,e,i)}}replaceRenderer(n,t=!0){const e=this.renderer,i=e.domElement.parentNode;return this.setRenderer(n),t&&i!==null&&(i.removeChild(e.domElement),i.appendChild(n.domElement)),e}createDepthTexture(){const n=this.depthTexture=new RC;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=WL,n.type=qL):n.type=yP,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,t,e,i){const s=this.renderer,r=s===null?new oe:s.getDrawingBufferSize(new oe),o={minFilter:Mt,magFilter:Mt,stencilBuffer:t,depthBuffer:n,type:e},a=new Et(r.width,r.height,o);return i>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=i),e===gi&&s!==null&&s.outputColorSpace===Ge&&(a.texture.colorSpace=Ge),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(n){for(const t of this.passes)t.mainScene=n}setMainCamera(n){for(const t of this.passes)t.mainCamera=n}addPass(n,t){const e=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new oe),r=i.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(n.setRenderer(i),n.setSize(s.width,s.height),n.initialize(i,r,o),this.autoRenderToScreen&&(e.length>0&&(e[e.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?e.splice(t,0,n):e.push(n),this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(n of e)n.setDepthTexture(a)}else n.setDepthTexture(this.depthTexture)}removePass(n){const t=this.passes,e=t.indexOf(n);if(e!==-1&&t.splice(e,1).length>0){if(this.depthTexture!==null){const r=(a,l)=>a||l.needsDepthTexture;t.reduce(r,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&e===t.length&&(n.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const t=this.renderer,e=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,r=!1,o,a,l;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(t,i,s,n,r),h.needsSwap&&(r&&(e.renderToScreen=h.renderToScreen,o=t.getContext(),a=t.state.buffers.stencil,a.setFunc(o.NOTEQUAL,1,4294967295),e.render(t,i,s,n,r),a.setFunc(o.EQUAL,1,4294967295)),l=i,i=s,s=l),h instanceof Jz?r=!0:h instanceof Yz&&(r=!1))}setSize(n,t,e){const i=this.renderer,s=i.getSize(new oe);(n===void 0||t===void 0)&&(n=s.width,t=s.height),(s.width!==n||s.height!==t)&&i.setSize(n,t,e);const r=i.getDrawingBufferSize(new oe);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height);for(const o of this.passes)o.setSize(r.width,r.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Tn.fullscreenGeometry.dispose()}},Fr={NONE:0,DEPTH:1,CONVOLUTION:2},St={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Zz=class{constructor(){this.shaderParts=new Map([[St.FRAGMENT_HEAD,null],[St.FRAGMENT_MAIN_UV,null],[St.FRAGMENT_MAIN_IMAGE,null],[St.VERTEX_HEAD,null],[St.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Fr.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ni}},Xb=!1,Y1=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let e;if(t.material.flatShading)switch(t.material.side){case _i:e=this.materialsFlatShadedDoubleSide;break;case Wc:e=this.materialsFlatShadedBackSide;break;default:e=this.materialsFlatShaded;break}else switch(t.material.side){case _i:e=this.materialsDoubleSide;break;case Wc:e=this.materialsBackSide;break;default:e=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=e[2]:t.isInstancedMesh?t.material=e[1]:t.material=e[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof $e))return n.clone();const t=n.uniforms,e=new Map;for(const s in t){const r=t[s].value;r.isRenderTargetTexture&&(t[s].value=null,e.set(s,r))}const i=n.clone();for(const s of e)t[s[0]].value=s[1],i.uniforms[s[0]].value=s[1];return i}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const t=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const e of t)e.uniforms=Object.assign({},n.uniforms),e.side=il;t[2].skinning=!0,this.materialsBackSide=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.side=Wc,i}),this.materialsDoubleSide=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.side=_i,i}),this.materialsFlatShaded=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=Wc,i}),this.materialsFlatShadedDoubleSide=t.map(e=>{const i=this.cloneMaterial(e);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=_i,i})}}render(n,t,e){const i=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,Xb){const s=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),n.render(t,e);for(const r of s)r[0].material=r[1];this.meshCount!==s.size&&s.clear()}else{const s=t.overrideMaterial;t.overrideMaterial=this.material,n.render(t,e),t.overrideMaterial=s}n.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of n)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Xb}static set workaroundEnabled(n){Xb=n}},xc=-1,Dt=class extends hc{constructor(n,t=xc,e=xc,i=1){super(),this.resizable=n,this.baseSize=new oe(1,1),this.preferredSize=new oe(t,e),this.target=this.preferredSize,this.s=i,this.effectiveSize=new oe,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,t=this.preferredSize,e=this.effectiveSize,i=this.scale;t.width!==xc?e.width=t.width:t.height!==xc?e.width=Math.round(t.height*(n.width/Math.max(n.height,1))):e.width=Math.round(n.width*i),t.height!==xc?e.height=t.height:t.width!==xc?e.height=Math.round(t.width/Math.max(n.width/Math.max(n.height,1),1)):e.height=Math.round(n.height*i)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(xc),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,t){(this.baseSize.width!==n||this.baseSize.height!==t)&&(this.baseSize.set(n,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,t){(this.preferredSize.width!==n||this.preferredSize.height!==t)&&(this.preferredSize.set(n,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return xc}},$z=class{constructor(n=0){this.nextId=n}getNextId(){return this.nextId++}reset(n=0){return this.nextId=n,this}},Yb=new $z(2),eQ=class extends Set{constructor(n,t=Yb.getNextId()){super(),this.exclusive=!1,this._layer=t,(this._layer<1||this._layer>31)&&(console.warn("Layer out of range, resetting to 2"),Yb.reset(2),this._layer=Yb.getNextId()),n!==void 0&&this.set(n)}get layer(){return this._layer}set layer(n){const t=this._layer;for(const e of this)e.layers.disable(t),e.layers.enable(n);this._layer=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const t of this)t.layers.disable(n);return super.clear()}set(n){this.clear();for(const t of n)this.add(t);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let t;return this.has(n)?(this.delete(n),t=!1):(this.add(n),t=!0),t}setVisible(n){for(const t of this)n?t.layers.enable(0):t.layers.disable(0);return this}},Je={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},tQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",iQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",nQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",sQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",rQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",oQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",aQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",lQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",cQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",hQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",uQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",dQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",fQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",pQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",gQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",mQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",AQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",vQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",yQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",bQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",_Q="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",wQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",xQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",CQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",SQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",EQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",IQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",TQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",RQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",BQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",PQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",MQ="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",kQ=new Map([[Je.ADD,tQ],[Je.ALPHA,iQ],[Je.AVERAGE,nQ],[Je.COLOR,sQ],[Je.COLOR_BURN,rQ],[Je.COLOR_DODGE,oQ],[Je.DARKEN,aQ],[Je.DIFFERENCE,lQ],[Je.DIVIDE,cQ],[Je.DST,null],[Je.EXCLUSION,hQ],[Je.HARD_LIGHT,uQ],[Je.HARD_MIX,dQ],[Je.HUE,fQ],[Je.INVERT,pQ],[Je.INVERT_RGB,gQ],[Je.LIGHTEN,mQ],[Je.LINEAR_BURN,AQ],[Je.LINEAR_DODGE,vQ],[Je.LINEAR_LIGHT,yQ],[Je.LUMINOSITY,bQ],[Je.MULTIPLY,_Q],[Je.NEGATION,wQ],[Je.NORMAL,xQ],[Je.OVERLAY,CQ],[Je.PIN_LIGHT,SQ],[Je.REFLECT,EQ],[Je.SATURATION,IQ],[Je.SCREEN,TQ],[Je.SOFT_LIGHT,RQ],[Je.SRC,BQ],[Je.SUBTRACT,PQ],[Je.VIVID_LIGHT,MQ]]),DQ=class extends hc{constructor(n,t=1){super(),this._blendFunction=n,this.opacity=new $(t)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return kQ.get(this.blendFunction)}},Ka={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},OQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,LQ="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",FQ=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],ok=class extends $e{constructor(n=new Fe){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new $(null),texelSize:new $(new Fe),scale:new $(1),kernel:new $(0)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:OQ,vertexShader:LQ}),this.setTexelSize(n.x,n.y),this.kernelSize=Ka.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return FQ[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t,n*.5,t*.5)}setSize(n,t){const e=1/n,i=1/t;this.uniforms.texelSize.value.set(e,i,e*.5,i*.5)}},AS=class extends Tn{constructor({kernelSize:n=Ka.MEDIUM,resolutionScale:t=.5,width:e=Dt.AUTO_SIZE,height:i=Dt.AUTO_SIZE,resolutionX:s=e,resolutionY:r=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Et(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Dt(this,s,r,t);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new ok,this._blurMaterial.kernelSize=n,this.copyMaterial=new sk}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,e,i,s){const r=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,h=this.blurMaterial,u=h.kernelSequence;let d=t;this.fullscreenMaterial=h;for(let f=0,p=u.length;f<p;++f){const g=f&1?l:a;h.kernel=u[f],h.inputBuffer=d.texture,n.setRenderTarget(g),n.render(r,o),d=g}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,n.setRenderTarget(this.renderToScreen?null:e),n.render(r,o)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t);const i=e.width,s=e.height;this.renderTargetA.setSize(i,s),this.renderTargetB.setSize(i,s),this.blurMaterial.setSize(n,t)}initialize(n,t,e){e!==void 0&&(this.renderTargetA.texture.type=e,this.renderTargetB.texture.type=e,e!==gi?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===Ge&&(this.renderTargetA.texture.colorSpace=Ge,this.renderTargetB.texture.colorSpace=Ge))}static get AUTO_SIZE(){return Dt.AUTO_SIZE}},UQ=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,NQ=class extends $e{constructor(n=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:l0.replace(/\D+/g,"")},uniforms:{inputBuffer:new $(null),threshold:new $(0),smoothing:new $(1),range:new $(null)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:UQ,vertexShader:Lu}),this.colorOutput=n,this.luminanceRange=t}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},ak=class extends Tn{constructor({renderTarget:n,luminanceRange:t,colorOutput:e,resolutionScale:i=1,width:s=Dt.AUTO_SIZE,height:r=Dt.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new NQ(e,t),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new Dt(this,o,a,i);l.addEventListener("change",h=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,t,e,i,s){const r=this.fullscreenMaterial;r.inputBuffer=t.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height)}initialize(n,t,e){e!==void 0&&e!==gi&&(this.renderTarget.texture.type=e,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},zQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,QQ="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",jQ=class extends $e{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new $(null),texelSize:new $(new oe)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zQ,vertexShader:QQ})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},GQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,HQ="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",VQ=class extends $e{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new $(null),supportBuffer:new $(null),texelSize:new $(new oe),radius:new $(.85)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:GQ,vertexShader:HQ})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},WQ=class extends Tn{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new jQ,this.upsamplingMaterial=new VQ,this.resolution=new oe}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let e=0;e<n;++e){const i=t.clone();i.texture.name="Downsampling.Mipmap"+e,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(t);for(let e=1,i=n-1;e<i;++e){const s=t.clone();s.texture.name="Upsampling.Mipmap"+e,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,t,e,i,s){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:l}=this,{downsamplingMipmaps:h,upsamplingMipmaps:u}=this;let d=t;this.fullscreenMaterial=a;for(let f=0,p=h.length;f<p;++f){const g=h[f];a.setSize(d.width,d.height),a.inputBuffer=d.texture,n.setRenderTarget(g),n.render(r,o),d=g}this.fullscreenMaterial=l;for(let f=u.length-1;f>=0;--f){const p=u[f];l.setSize(d.width,d.height),l.inputBuffer=d.texture,l.supportBuffer=h[f].texture,n.setRenderTarget(p),n.render(r,o),d=p}}setSize(n,t){const e=this.resolution;e.set(n,t);let i=e.width,s=e.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)i=Math.round(i*.5),s=Math.round(s*.5),this.downsamplingMipmaps[r].setSize(i,s),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(i,s)}initialize(n,t,e){if(e!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const s of i)s.texture.type=e;if(e!==gi)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===Ge)for(const s of i)s.texture.colorSpace=Ge}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},Xs=class extends hc{constructor(n,t,{attributes:e=Fr.NONE,blendFunction:i=Je.NORMAL,defines:s=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=e,this.fragmentShader=t,this.vertexShader=a,this.defines=s,this.uniforms=r,this.extensions=o,this.blendMode=new DQ(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=Ni,this._outputColorSpace=xu}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,t=qs){}update(n,t,e){}setSize(n,t){}initialize(n,t,e){}dispose(){for(const n of Object.keys(this)){const t=this[n];(t instanceof Et||t instanceof mt||t instanceof At||t instanceof Tn)&&this[n].dispose()}}},qQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,vS=class extends Xs{constructor({blendFunction:t=Je.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,mipmapBlur:s=!1,intensity:r=1,radius:o=.85,levels:a=8,kernelSize:l=Ka.LARGE,resolutionScale:h=.5,width:u=Dt.AUTO_SIZE,height:d=Dt.AUTO_SIZE,resolutionX:f=u,resolutionY:p=d}={}){super("BloomEffect",qQ,{blendFunction:t,uniforms:new Map([["map",new $(null)],["intensity",new $(r)]])}),this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new AS({kernelSize:l}),this.luminancePass=new ak({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new WQ,this.mipmapBlurPass.enabled=s,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=s?this.mipmapBlurPass.texture:this.renderTarget.texture;const g=this.resolution=new Dt(this,f,p,h);g.addEventListener("change",m=>this.setSize(g.baseWidth,g.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(t){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,i){const s=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(t,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(t,r.renderTarget):this.blurPass.render(t,r.renderTarget,s)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(t,e):this.blurPass.render(t,e,s)}setSize(t,e){const i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(t,e),this.mipmapBlurPass.setSize(t,e)}initialize(t,e,i){this.blurPass.initialize(t,e,i),this.luminancePass.initialize(t,e,i),this.mipmapBlurPass.initialize(t,e,i),i!==void 0&&(this.renderTarget.texture.type=i,t!==null&&t.outputColorSpace===Ge&&(this.renderTarget.texture.colorSpace=Ge))}},XQ="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",lk=class extends Xs{constructor({blendFunction:n=Je.SRC,brightness:t=0,contrast:e=0}={}){super("BrightnessContrastEffect",XQ,{blendFunction:n,uniforms:new Map([["brightness",new $(t)],["contrast",new $(e)]])}),this.inputColorSpace=Ge}get brightness(){return this.uniforms.get("brightness").value}set brightness(n){this.uniforms.get("brightness").value=n}getBrightness(){return this.brightness}setBrightness(n){this.brightness=n}get contrast(){return this.uniforms.get("contrast").value}set contrast(n){this.uniforms.get("contrast").value=n}getContrast(){return this.contrast}setContrast(n){this.contrast=n}},YQ=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,KQ="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",ck=class extends Xs{constructor({offset:n=new oe(.001,5e-4),radialModulation:t=!1,modulationOffset:e=.15}={}){super("ChromaticAberrationEffect",YQ,{vertexShader:KQ,attributes:Fr.CONVOLUTION,uniforms:new Map([["offset",new $(n)],["modulationOffset",new $(e)]])}),this.radialModulation=t}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},hk={RED:0,GREEN:1,BLUE:2,ALPHA:3},uk={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},JQ=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,mA=class extends $e{constructor(n=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new $(null),cocBuffer:new $(null),texelSize:new $(new oe),kernel64:new $(null),kernel16:new $(null),scale:new $(1)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:JQ,vertexShader:Lu}),t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,t=new Float64Array(128),e=new Float64Array(32);let i=0,s=0;for(let r=0,o=Math.sqrt(80);r<80;++r){const a=r*n,l=Math.sqrt(r)/o,h=l*Math.cos(a),u=l*Math.sin(a);r%5===0?(e[s++]=h,e[s++]=u):(t[i++]=h,t[i++]=u)}this.uniforms.kernel64.value=t,this.uniforms.kernel16.value=e}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t)}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}};function kd(n,t,e){return n*(t-e)-t}function nu(n,t,e){return Math.min(Math.max((n+t)/(t-e),0),1)}var ZQ=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,$Q=class extends $e{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new $(null),focusDistance:new $(0),focusRange:new $(0),cameraNear:new $(.3),cameraFar:new $(1e3)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ZQ,vertexShader:Lu}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=qs){this.depthBuffer=n,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-kd(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=nu(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-kd(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=nu(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof bt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},ej=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,tj=class extends $e{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new $(n),inputBuffer:new $(null),strength:new $(1)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ej,vertexShader:Lu}),this.colorChannel=hk.RED,this.maskFunction=uk.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==gi&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},Ra=class extends Tn{constructor(n,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=t}setInput(n){this.input=n}render(n,t,e,i,s){const r=this.fullscreenMaterial.uniforms;t!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=t.texture),n.setRenderTarget(this.renderToScreen?null:e),n.render(this.scene,this.camera)}initialize(n,t,e){e!==void 0&&e!==gi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ij=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,dk=class extends Xs{constructor(n,{blendFunction:t,worldFocusDistance:e,worldFocusRange:i,focusDistance:s=0,focalLength:r=.1,focusRange:o=r,bokehScale:a=1,resolutionScale:l=1,width:h=Dt.AUTO_SIZE,height:u=Dt.AUTO_SIZE,resolutionX:d=h,resolutionY:f=u}={}){super("DepthOfFieldEffect",ij,{blendFunction:t,attributes:Fr.DEPTH,uniforms:new Map([["nearColorBuffer",new $(null)],["farColorBuffer",new $(null)],["nearCoCBuffer",new $(null)],["farCoCBuffer",new $(null)],["scale",new $(1)]])}),this.camera=n,this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Ra(new $Q(n));const p=this.cocMaterial;p.focusDistance=s,p.focusRange=o,e!==void 0&&(p.worldFocusDistance=e),i!==void 0&&(p.worldFocusRange=i),this.blurPass=new AS({resolutionScale:l,resolutionX:d,resolutionY:f,kernelSize:Ka.MEDIUM}),this.maskPass=new Ra(new tj(this.renderTargetCoC.texture));const g=this.maskPass.fullscreenMaterial;g.colorChannel=hk.GREEN,this.maskFunction=uk.MULTIPLY_RGB,this.bokehNearBasePass=new Ra(new mA(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Ra(new mA(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Ra(new mA(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Ra(new mA(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const m=this.resolution=new Dt(this,d,f,l);m.addEventListener("change",v=>this.setSize(m.baseWidth,m.baseHeight)),this.bokehScale=a}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const t=this.camera,e=t.position.distanceTo(n);return nu(-e,t.near,t.far)}setDepthTexture(n,t=qs){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=t}update(n,t,e){const i=this.renderTarget,s=this.renderTargetCoC,r=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(n,null,s),this.blurPass.render(n,s,r),this.maskPass.render(n,t,o),this.bokehFarBasePass.render(n,o,i),this.bokehFarFillPass.render(n,i,this.renderTargetFar),this.bokehNearBasePass.render(n,t,i),this.bokehNearFillPass.render(n,i,this.renderTargetNear)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t);const i=e.width,s=e.height;this.cocPass.setSize(n,t),this.blurPass.setSize(n,t),this.maskPass.setSize(n,t),this.renderTargetFar.setSize(n,t),this.renderTargetCoC.setSize(n,t),this.renderTargetMasked.setSize(n,t),this.renderTarget.setSize(i,s),this.renderTargetNear.setSize(i,s),this.renderTargetCoCBlurred.setSize(i,s),this.bokehNearBasePass.fullscreenMaterial.setSize(n,t),this.bokehNearFillPass.fullscreenMaterial.setSize(n,t),this.bokehFarBasePass.fullscreenMaterial.setSize(n,t),this.bokehFarFillPass.fullscreenMaterial.setSize(n,t)}initialize(n,t,e){this.cocPass.initialize(n,t,e),this.maskPass.initialize(n,t,e),this.bokehNearBasePass.initialize(n,t,e),this.bokehNearFillPass.initialize(n,t,e),this.bokehFarBasePass.initialize(n,t,e),this.bokehFarFillPass.initialize(n,t,e),this.blurPass.initialize(n,t,gi),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),e!==void 0&&(this.renderTarget.texture.type=e,this.renderTargetNear.texture.type=e,this.renderTargetFar.texture.type=e,this.renderTargetMasked.texture.type=e,n!==null&&n.outputColorSpace===Ge&&(this.renderTarget.texture.colorSpace=Ge,this.renderTargetNear.texture.colorSpace=Ge,this.renderTargetFar.texture.colorSpace=Ge,this.renderTargetMasked.texture.colorSpace=Ge))}};function nj(n,t,e){const i=new Map([[wP,1],[qc,1],[Pd,2],[Wi,4]]);let s;if(i.has(t)||console.error("Invalid noise texture format"),e===gi){s=new Uint8Array(n*i.get(t));for(let r=0,o=s.length;r<o;++r)s[r]=Math.random()*255+.5}else{s=new Float32Array(n*i.get(t));for(let r=0,o=s.length;r<o;++r)s[r]=Math.random()}return s}var sj=class extends Uf{constructor(n,t,e=wP,i=gi){super(nj(n*t,e,i),n,t,e,i),this.needsUpdate=!0}},ng={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},rj=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,oj=class extends $e{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:ng.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new $(null),depthBuffer0:new $(null),depthBuffer1:new $(null),cameraNearFar:new $(new oe(1,1))},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:rj,vertexShader:Lu}),this.depthMode=Lw}set depthBuffer0(n){this.uniforms.depthBuffer0.value=n}set depthPacking0(n){this.defines.DEPTH_PACKING_0=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(n,t=qs){this.depthBuffer0=n,this.depthPacking0=t}set depthBuffer1(n){this.uniforms.depthBuffer1.value=n}set depthPacking1(n){this.defines.DEPTH_PACKING_1=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(n,t=qs){this.depthBuffer1=n,this.depthPacking1=t}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(n){this.defines.DEPTH_TEST_STRATEGY=n.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(n){this.maxDepthStrategy=n?ng.KEEP_MAX_DEPTH:ng.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(n){this.maxDepthStrategy=n}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(n){this.defines.DEPTH_EPSILON=n.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(n){this.epsilon=n}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(n){let t;switch(n){case YL:t="false";break;case IP:t="true";break;case Vv:t="abs(d1 - d0) <= DEPTH_EPSILON";break;case BC:t="abs(d1 - d0) > DEPTH_EPSILON";break;case Lw:t="d0 > d1";break;case EP:t="d0 >= d1";break;case SP:t="d0 <= d1";break;case CP:default:t="d0 < d1";break}this.defines.DEPTH_MODE=n.toFixed(0),this.defines["depthTest(d0, d1)"]=t,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(n){this.depthMode=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),n instanceof bt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},x0=class extends Tn{constructor(n,t,e=null){super("RenderPass",n,t),this.needsSwap=!1,this.clearPass=new w0,this.overrideMaterialManager=e===null?null:new Y1(e),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const t=this.overrideMaterialManager;n!==null?t!==null?t.setMaterial(n):this.overrideMaterialManager=new Y1(n):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,t,e,i,s){const r=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,h=r.background,u=n.shadowMap.autoUpdate,d=this.renderToScreen?null:t;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(n,t),n.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,r,o):n.render(r,o),o.layers.mask=l,r.background=h,n.shadowMap.autoUpdate=u}},aj="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",fk=class extends Xs{constructor({blendFunction:n=Je.SRC,hue:t=0,saturation:e=0}={}){super("HueSaturationEffect",aj,{blendFunction:n,uniforms:new Map([["hue",new $(new w)],["saturation",new $(e)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(n){this.uniforms.get("saturation").value=n}getSaturation(){return this.saturation}setSaturation(n){this.saturation=n}get hue(){const n=this.uniforms.get("hue").value;return Math.acos((n.x*3-1)/2)}set hue(n){const t=Math.sin(n),e=Math.cos(n);this.uniforms.get("hue").value.set((2*e+1)/3,(-Math.sqrt(3)*t-e+1)/3,(Math.sqrt(3)*t-e+1)/3)}getHue(){return this.hue}setHue(n){this.hue=n}},yS={DEPTH:0,LUMA:1,COLOR:2},lj={DISABLED:0,DEPTH:1,CUSTOM:2},Xh={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},an={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},hp={DEFAULT:0,ESKIL:1},cj=class extends Tn{constructor(n,t,{renderTarget:e,resolutionScale:i=1,width:s=Dt.AUTO_SIZE,height:r=Dt.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new x0(n,t,new xP({depthPacking:bP}));const l=this.renderPass;l.skipShadowMapUpdate=!0,l.ignoreBackground=!0;const h=l.clearPass;h.overrideClearColor=new be(16777215),h.overrideClearAlpha=1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new Et(1,1,{minFilter:mi,magFilter:mi}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new Dt(this,o,a,i);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,e,i,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height)}},hj="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",pk=class extends Xs{constructor(t=30){super("PixelationEffect",hj,{uniforms:new Map([["active",new $(!1)],["d",new $(new Fe)]])}),this.resolution=new oe,this._granularity=0,this.granularity=t}get granularity(){return this._granularity}set granularity(t){let e=Math.floor(t);e%2>0&&(e+=1),this._granularity=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(t){this.granularity=t}setSize(t,e){const i=this.resolution;i.set(t,e);const s=this.granularity,r=s/i.x,o=s/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},gk=class extends vS{constructor(n,t,e){super(e),this.setAttributes(this.getAttributes()|Fr.DEPTH),this.camera=t,this.depthPass=new cj(n,t),this.clearPass=new w0(!0,!1,!1),this.clearPass.overrideClearColor=new be(0),this.depthMaskPass=new Ra(new oj);const i=this.depthMaskMaterial;i.copyCameraSettings(t),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=bP,i.depthMode=Vv,this.renderTargetMasked=new Et(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new eQ,this._inverted=!1,this._ignoreBackground=!1}set mainScene(n){this.depthPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(n){this._inverted=n,this.depthMaskMaterial.depthMode=n?BC:Vv}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(n){this._ignoreBackground=n,this.depthMaskMaterial.maxDepthStrategy=n?ng.DISCARD_MAX_DEPTH:ng.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}setDepthTexture(n,t=qs){this.depthMaskMaterial.depthBuffer0=n,this.depthMaskMaterial.depthPacking0=t}update(n,t,e){const i=this.camera,s=this.selection,r=this.inverted;let o=t;if(this.ignoreBackground||!r||s.size>0){const a=i.layers.mask;i.layers.set(s.layer),this.depthPass.render(n),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(n,o),this.depthMaskPass.render(n,t,o)}super.update(n,o,e)}setSize(n,t){super.setSize(n,t),this.renderTargetMasked.setSize(n,t),this.depthPass.setSize(n,t)}initialize(n,t,e){super.initialize(n,t,e),this.clearPass.initialize(n,t,e),this.depthPass.initialize(n,t,e),this.depthMaskPass.initialize(n,t,e),n!==null&&n.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),e!==void 0&&(this.renderTargetMasked.texture.type=e,n!==null&&n.outputColorSpace===Ge&&(this.renderTargetMasked.texture.colorSpace=Ge))}},uj=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,dj=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,fj=class extends $e{constructor(n=new oe,t=yS.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:l0.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new $(null),depthBuffer:new $(null),predicationBuffer:new $(null),texelSize:new $(n)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:uj,vertexShader:dj}),this.edgeDetectionMode=t}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=qs){this.depthBuffer=n,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(n){this.defines.EDGE_DETECTION_MODE=n.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(n){this.edgeDetectionMode=n}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(n){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=n.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(n){this.localContrastAdaptationFactor=n}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(n){this.defines.EDGE_THRESHOLD=n.toFixed("6"),this.defines.DEPTH_THRESHOLD=(n*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(n){this.edgeDetectionThreshold=n}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(n){this.defines.PREDICATION_MODE=n.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(n){this.predicationMode=n}set predicationBuffer(n){this.uniforms.predicationBuffer.value=n}setPredicationBuffer(n){this.uniforms.predicationBuffer.value=n}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(n){this.defines.PREDICATION_THRESHOLD=n.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(n){this.predicationThreshold=n}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(n){this.defines.PREDICATION_SCALE=n.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(n){this.predicationScale=n}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(n){this.defines.PREDICATION_STRENGTH=n.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(n){this.predicationStrength=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},pj=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,gj="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",mj=class extends $e{constructor(n=new oe,t=new oe){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new $(null),searchTexture:new $(null),areaTexture:new $(null),resolution:new $(t),texelSize:new $(n)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:pj,vertexShader:gj})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(n){this.uniforms.searchTexture.value=n}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(n){this.uniforms.areaTexture.value=n}setLookupTextures(n,t){this.searchTexture=n,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(n){const t=Math.min(Math.max(n,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(n){this.orthogonalSearchSteps=n}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(n){const t=Math.min(Math.max(n,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(n){this.diagonalSearchSteps=n}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(n){n?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(n){this.diagonalDetection=n}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(n){const t=Math.min(Math.max(n,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(n){this.cornerRounding=n}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(n){n?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(n){this.cornerDetection=n}setSize(n,t){const e=this.uniforms;e.texelSize.value.set(1/n,1/t),e.resolution.value.set(n,t)}},K1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",J1="data:image/png;base64,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",Aj="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",vj="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",mk=class extends Xs{constructor({blendFunction:n=Je.SRC,preset:t=Xh.MEDIUM,edgeDetectionMode:e=yS.COLOR,predicationMode:i=lj.DISABLED}={}){super("SMAAEffect",Aj,{vertexShader:vj,blendFunction:n,attributes:Fr.CONVOLUTION|Fr.DEPTH,uniforms:new Map([["weightMap",new $(null)]])});let s,r;arguments.length>1&&(s=arguments[0],r=arguments[1],arguments.length>2&&(t=arguments[2]),arguments.length>3&&(e=arguments[3])),this.renderTargetEdges=new Et(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new w0(!0,!1,!1),this.clearPass.overrideClearColor=new be(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Ra(new fj),this.edgeDetectionMaterial.edgeDetectionMode=e,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Ra(new mj);const o=new XL;o.onLoad=()=>{const a=new At(s);a.name="SMAA.Search",a.magFilter=mi,a.minFilter=mi,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;const l=new At(r);l.name="SMAA.Area",l.magFilter=Mt,l.minFilter=Mt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!1,this.weightsMaterial.areaTexture=l,this.dispatchEvent({type:"load"})},o.itemStart("search"),o.itemStart("area"),s!==void 0&&r!==void 0?(o.itemEnd("search"),o.itemEnd("area")):typeof Image<"u"&&(s=new Image,r=new Image,s.addEventListener("load",()=>o.itemEnd("search")),r.addEventListener("load",()=>o.itemEnd("area")),s.src=K1,r.src=J1),this.applyPreset(t)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(n){this.edgeDetectionMaterial.edgeDetectionThreshold=n}setOrthogonalSearchSteps(n){this.weightsMaterial.orthogonalSearchSteps=n}applyPreset(n){const t=this.edgeDetectionMaterial,e=this.weightsMaterial;switch(n){case Xh.LOW:t.edgeDetectionThreshold=.15,e.orthogonalSearchSteps=4,e.diagonalDetection=!1,e.cornerDetection=!1;break;case Xh.MEDIUM:t.edgeDetectionThreshold=.1,e.orthogonalSearchSteps=8,e.diagonalDetection=!1,e.cornerDetection=!1;break;case Xh.HIGH:t.edgeDetectionThreshold=.1,e.orthogonalSearchSteps=16,e.diagonalSearchSteps=8,e.cornerRounding=25,e.diagonalDetection=!0,e.cornerDetection=!0;break;case Xh.ULTRA:t.edgeDetectionThreshold=.05,e.orthogonalSearchSteps=32,e.diagonalSearchSteps=16,e.cornerRounding=25,e.diagonalDetection=!0,e.cornerDetection=!0;break}}setDepthTexture(n,t=qs){this.edgeDetectionMaterial.depthBuffer=n,this.edgeDetectionMaterial.depthPacking=t}update(n,t,e){this.clearPass.render(n,this.renderTargetEdges),this.edgeDetectionPass.render(n,t,this.renderTargetEdges),this.weightsPass.render(n,this.renderTargetEdges,this.renderTargetWeights)}setSize(n,t){this.edgeDetectionMaterial.setSize(n,t),this.weightsMaterial.setSize(n,t),this.renderTargetEdges.setSize(n,t),this.renderTargetWeights.setSize(n,t)}dispose(){const{searchTexture:n,areaTexture:t}=this.weightsMaterial;n!==null&&t!==null&&(n.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return K1}static get areaImageDataURL(){return J1}},yj=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,bj="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",_j=class extends $e{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new $(null),normalBuffer:new $(null),normalDepthBuffer:new $(null),noiseTexture:new $(null),inverseProjectionMatrix:new $(new ae),projectionMatrix:new $(new ae),texelSize:new $(new oe),cameraNearFar:new $(new oe),distanceCutoff:new $(new oe),proximityCutoff:new $(new oe),noiseScale:new $(new oe),minRadiusScale:new $(.33),intensity:new $(1),fade:new $(.01),bias:new $(0)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:yj,vertexShader:bj}),this.copyCameraSettings(n),this.resolution=new oe,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=qs){this.depthBuffer=n,this.depthPacking=t}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-kd(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=nu(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-kd(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=nu(-n,this.near,this.far)}setDistanceCutoff(n,t){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+t,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-kd(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=nu(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-kd(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=nu(-n,this.near,this.far)}setProximityCutoff(n,t){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+t,0),1))}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof bt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,t){const e=this.uniforms,i=e.noiseTexture.value;i!==null&&e.noiseScale.value.set(n/i.image.width,t/i.image.height),e.texelSize.value.set(1/n,1/t),this.resolution.set(n,t),this.updateRadius()}},wj=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,xj="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",Cj=class extends $e{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new $(null),normalBuffer:new $(null),texelSize:new $(new oe)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:wj,vertexShader:xj})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=qs){this.depthBuffer=n,this.depthPacking=t}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t)}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},bS=class extends Tn{constructor({normalBuffer:n=null,resolutionScale:t=.5,width:e=Dt.AUTO_SIZE,height:i=Dt.AUTO_SIZE,resolutionX:s=e,resolutionY:r=i}={}){super("DepthDownsamplingPass");const o=new Cj;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Et(1,1,{minFilter:mi,magFilter:mi,depthBuffer:!1,type:mo}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Dt(this,s,r,t);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,t=qs){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=t}render(n,t,e,i,s){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height),this.fullscreenMaterial.setSize(n,t)}initialize(n,t,e){const i=n.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},Sj=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,Z1=64,Ak=class extends Xs{constructor(n,t,{blendFunction:e=Je.MULTIPLY,samples:i=9,rings:s=7,normalDepthBuffer:r=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:l,worldProximityThreshold:h,worldProximityFalloff:u,distanceThreshold:d=.97,distanceFalloff:f=.03,rangeThreshold:p=5e-4,rangeFalloff:g=.001,minRadiusScale:m=.1,luminanceInfluence:v=.7,radius:y=.1825,intensity:b=1,bias:_=.025,fade:x=.01,color:S=null,resolutionScale:E=1,width:M=Dt.AUTO_SIZE,height:I=Dt.AUTO_SIZE,resolutionX:B=M,resolutionY:R=I}={}){super("SSAOEffect",Sj,{blendFunction:e,attributes:Fr.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new $(null)],["normalDepthBuffer",new $(r)],["luminanceInfluence",new $(v)],["color",new $(null)],["intensity",new $(b)],["scale",new $(0)]])}),this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const P=this.resolution=new Dt(this,B,R,E);P.addEventListener("change",V=>this.setSize(P.baseWidth,P.baseHeight)),this.camera=n,this.depthDownsamplingPass=new bS({normalBuffer:t,resolutionScale:E}),this.depthDownsamplingPass.enabled=r===null,this.ssaoPass=new Ra(new _j(n));const F=new sj(Z1,Z1,Wi);F.wrapS=F.wrapT=nc;const j=this.ssaoMaterial;j.normalBuffer=t,j.noiseTexture=F,j.minRadiusScale=m,j.samples=i,j.radius=y,j.rings=s,j.fade=x,j.bias=_,j.distanceThreshold=d,j.distanceFalloff=f,j.proximityThreshold=p,j.proximityFalloff=g,a!==void 0&&(j.worldDistanceThreshold=a),l!==void 0&&(j.worldDistanceFalloff=l),h!==void 0&&(j.worldProximityThreshold=h),u!==void 0&&(j.worldProximityFalloff=u),r!==null&&(this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=S}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const t=this.uniforms,e=this.defines;n!==null?e.has("COLORIZE")?t.get("color").value.set(n):(e.set("COLORIZE","1"),t.get("color").value=new be(n),this.setChanged()):e.has("COLORIZE")&&(e.delete("COLORIZE"),t.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,t){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=t}setProximityCutoff(n,t){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=t}setDepthTexture(n,t=qs){this.depthDownsamplingPass.setDepthTexture(n,t),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=t}update(n,t,e){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,i)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t);const i=e.width,s=e.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,s),this.renderTarget.setSize(i,s),this.depthDownsamplingPass.resolution.scale=e.scale,this.depthDownsamplingPass.setSize(n,t)}initialize(n,t,e){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(n,t,e),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},Ej=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Ij="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",Tj=class extends ok{constructor({kernelSize:n=Ka.MEDIUM,offset:t=0,rotation:e=0,focusArea:i=.4,feather:s=.3}={}){super(),this.fragmentShader=Ej,this.vertexShader=Ij,this.kernelSize=n,this.uniforms.aspect=new $(1),this.uniforms.rotation=new $(new oe),this.uniforms.maskParams=new $(new Fe),this._offset=t,this._focusArea=i,this._feather=s,this.rotation=e,this.updateParams()}updateParams(){const n=this.uniforms.maskParams.value,t=Math.max(this.focusArea,0),e=Math.max(t-this.feather,0);n.set(this.offset-t,this.offset-e,this.offset+t,this.offset+e)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(n){this.uniforms.rotation.value.set(Math.cos(n),Math.sin(n))}get offset(){return this._offset}set offset(n){this._offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.updateParams()}setSize(n,t){super.setSize(n,t),this.uniforms.aspect.value=n/t}},Rj=class extends AS{constructor({offset:n=0,rotation:t=0,focusArea:e=.4,feather:i=.3,kernelSize:s=Ka.MEDIUM,resolutionScale:r=.5,resolutionX:o=Dt.AUTO_SIZE,resolutionY:a=Dt.AUTO_SIZE}={}){super({kernelSize:s,resolutionScale:r,resolutionX:o,resolutionY:a}),this.blurMaterial=new Tj({kernelSize:s,offset:n,rotation:t,focusArea:e,feather:i})}},Bj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,Pj="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",vk=class extends Xs{constructor({blendFunction:t,offset:e=0,rotation:i=0,focusArea:s=.4,feather:r=.3,kernelSize:o=Ka.MEDIUM,resolutionScale:a=.5,resolutionX:l=Dt.AUTO_SIZE,resolutionY:h=Dt.AUTO_SIZE}={}){super("TiltShiftEffect",Bj,{vertexShader:Pj,blendFunction:t,uniforms:new Map([["rotation",new $(new oe)],["maskParams",new $(new oe)],["map",new $(null)]])}),this._offset=e,this._focusArea=s,this._feather=r,this.renderTarget=new Et(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new Rj({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:h,offset:e,rotation:i,focusArea:s,feather:r});const u=this.resolution=new Dt(this,l,h,a);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const t=this.uniforms.get("maskParams").value,e=Math.max(this.focusArea-this.feather,0);t.set(this.offset-e,this.offset+e)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(t){this.uniforms.get("rotation").value.set(Math.cos(t),Math.sin(t)),this.blurPass.blurMaterial.rotation=t}get offset(){return this._offset}set offset(t){this._offset=t,this.blurPass.blurMaterial.offset=t,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(t){this._focusArea=t,this.blurPass.blurMaterial.focusArea=t,this.updateParams()}get feather(){return this._feather}set feather(t){this._feather=t,this.blurPass.blurMaterial.feather=t,this.updateParams()}get bias(){return 0}set bias(t){}update(t,e,i){this.blurPass.render(t,e,this.renderTarget)}setSize(t,e){const i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(t,e,i){this.blurPass.initialize(t,e,i),i!==void 0&&(this.renderTarget.texture.type=i,t!==null&&t.outputColorSpace===Ge&&(this.renderTarget.texture.colorSpace=Ge))}},Mj=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,kj=class extends $e{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new $(null),luminanceBuffer1:new $(null),minLuminance:new $(.01),deltaTime:new $(0),tau:new $(1)},extensions:{shaderTextureLOD:!0},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Mj,vertexShader:Lu})}set luminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}setLuminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}set luminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}setLuminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}set mipLevel1x1(n){this.defines.MIP_LEVEL_1X1=n.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(n){this.mipLevel1x1=n}set deltaTime(n){this.uniforms.deltaTime.value=n}setDeltaTime(n){this.uniforms.deltaTime.value=n}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(n){this.uniforms.minLuminance.value=n}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(n){this.uniforms.minLuminance.value=n}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(n){this.uniforms.tau.value=n}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(n){this.uniforms.tau.value=n}},Dj=class extends Tn{constructor(n,{minLuminance:t=.01,adaptationRate:e=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new kj,this.needsSwap=!1,this.renderTargetPrevious=new Et(1,1,{minFilter:mi,magFilter:mi,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const i=this.fullscreenMaterial;i.luminanceBuffer0=this.renderTargetPrevious.texture,i.luminanceBuffer1=n,i.minLuminance=t,i.adaptationRate=e,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new rk(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(n){this.fullscreenMaterial.mipLevel1x1=n}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(n){this.fullscreenMaterial.adaptationRate=n}render(n,t,e,i,s){this.fullscreenMaterial.deltaTime=i,n.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),n.render(this.scene,this.camera),this.copyPass.render(n,this.renderTargetAdapted)}},Oj=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,ny=class extends Xs{constructor({blendFunction:t=Je.SRC,adaptive:e=!1,mode:i=e?an.REINHARD2_ADAPTIVE:an.AGX,resolution:s=256,maxLuminance:r=4,whitePoint:o=r,middleGrey:a=.6,minLuminance:l=.01,averageLuminance:h=1,adaptationRate:u=1}={}){super("ToneMappingEffect",Oj,{blendFunction:t,uniforms:new Map([["luminanceBuffer",new $(null)],["maxLuminance",new $(r)],["whitePoint",new $(o)],["middleGrey",new $(a)],["averageLuminance",new $(h)]])}),this.renderTargetLuminance=new Et(1,1,{minFilter:_m,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new ak({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new Dj(this.luminancePass.texture,{minLuminance:l,adaptationRate:u}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=s,this.mode=i}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(t){if(this.mode===t)return;const i=l0.replace(/\D+/g,"")>=168?"CineonToneMapping(texel)":"OptimizedCineonToneMapping(texel)";switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",t.toFixed(0)),t){case an.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case an.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case an.CINEON:case an.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)",i);break;case an.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case an.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case an.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=t===an.REINHARD2_ADAPTIVE,this.setChanged()}getMode(){return this.mode}setMode(t){this.mode=t}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(t){this.uniforms.get("whitePoint").value=t}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(t){this.uniforms.get("middleGrey").value=t}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(t){this.uniforms.get("averageLuminance").value=t}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(t){const e=Math.max(0,Math.ceil(Math.log2(t))),i=Math.pow(2,e);this.luminancePass.resolution.setPreferredSize(i,i),this.adaptiveLuminanceMaterial.mipLevel1x1=e}getResolution(){return this.resolution}setResolution(t){this.resolution=t}get adaptive(){return this.mode===an.REINHARD2_ADAPTIVE}set adaptive(t){this.mode=t?an.REINHARD2_ADAPTIVE:an.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(t){this.adaptiveLuminanceMaterial.adaptationRate=t}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(t){console.warn(this.name,"distinction was removed.")}update(t,e,i){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(t,e),this.adaptiveLuminancePass.render(t,null,null,i))}initialize(t,e,i){this.adaptiveLuminancePass.initialize(t,e,i)}},Lj=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,yk=class extends Xs{constructor({blendFunction:n,eskil:t=!1,technique:e=t?hp.ESKIL:hp.DEFAULT,offset:i=.5,darkness:s=.5}={}){super("VignetteEffect",Lj,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new $(i)],["darkness",new $(s)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===hp.ESKIL}set eskil(n){this.technique=n?hp.ESKIL:hp.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},Fj=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Uj="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Nj=class extends $e{constructor(n,t,e,i,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:l0.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new $(null),depthBuffer:new $(null),resolution:new $(new oe),texelSize:new $(new oe),cameraNear:new $(.3),cameraFar:new $(1e3),aspect:new $(1),time:new $(0)},blending:Ks,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),n&&this.setShaderParts(n),t&&this.setDefines(t),e&&this.setUniforms(e),this.copyCameraSettings(i)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=qs){this.depthBuffer=n,this.depthPacking=t}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=Fj.replace(St.FRAGMENT_HEAD,n.get(St.FRAGMENT_HEAD)||"").replace(St.FRAGMENT_MAIN_UV,n.get(St.FRAGMENT_MAIN_UV)||"").replace(St.FRAGMENT_MAIN_IMAGE,n.get(St.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Uj.replace(St.VERTEX_HEAD,n.get(St.VERTEX_HEAD)||"").replace(St.VERTEX_MAIN_SUPPORT,n.get(St.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const t of n.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(n){for(const t of n.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(n){this.extensions={};for(const t of n)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof bt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,t){const e=this.uniforms;e.resolution.value.set(n,t),e.texelSize.value.set(1/n,1/t),e.aspect.value=n/t}static get Section(){return St}};function $1(n,t,e){for(const i of t){const s="$1"+n+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const o of e.entries())o[1]!==null&&e.set(o[0],o[1].replace(r,s))}}function zj(n,t,e){let i=t.getFragmentShader(),s=t.getVertexShader();const r=i!==void 0&&/mainImage/.test(i),o=i!==void 0&&/mainUv/.test(i);if(e.attributes|=t.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(o&&e.attributes&Fr.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=e.shaderParts;let h=l.get(St.FRAGMENT_HEAD)||"",u=l.get(St.FRAGMENT_MAIN_UV)||"",d=l.get(St.FRAGMENT_MAIN_IMAGE)||"",f=l.get(St.VERTEX_HEAD)||"",p=l.get(St.VERTEX_MAIN_SUPPORT)||"";const g=new Set,m=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,e.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const b=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);p+=`	${n}MainSupport(`,p+=b?`vUv);
`:`);
`;for(const _ of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const x of _[1].split(/\s*,\s*/))e.varyings.add(x),g.add(x),m.add(x);for(const _ of s.matchAll(a))m.add(_[1])}for(const b of i.matchAll(a))m.add(b[1]);for(const b of t.defines.keys())m.add(b.replace(/\([\w\s,]*\)/g,""));for(const b of t.uniforms.keys())m.add(b);m.delete("while"),m.delete("for"),m.delete("if"),t.uniforms.forEach((b,_)=>e.uniforms.set(n+_.charAt(0).toUpperCase()+_.slice(1),b)),t.defines.forEach((b,_)=>e.defines.set(n+_.charAt(0).toUpperCase()+_.slice(1),b));const v=new Map([["fragment",i],["vertex",s]]);$1(n,m,e.defines),$1(n,m,v),i=v.get("fragment"),s=v.get("vertex");const y=t.blendMode;if(e.blendModes.set(y.blendFunction,y),r){t.inputColorSpace!==null&&t.inputColorSpace!==e.colorSpace&&(d+=t.inputColorSpace===Ge?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==xu?e.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(e.colorSpace=t.inputColorSpace);const b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${n}MainImage(color0, UV, `,e.attributes&Fr.DEPTH&&b.test(i)&&(d+="depth, ",e.readDepth=!0),d+=`color1);
	`;const _=n+"BlendOpacity";e.uniforms.set(_,y.opacity),d+=`color0 = blend${y.blendFunction}(color0, color1, ${_});

	`,h+=`uniform float ${_};

`}if(h+=i+`
`,s!==null&&(f+=s+`
`),l.set(St.FRAGMENT_HEAD,h),l.set(St.FRAGMENT_MAIN_UV,u),l.set(St.FRAGMENT_MAIN_IMAGE,d),l.set(St.VERTEX_HEAD,f),l.set(St.VERTEX_MAIN_SUPPORT,p),t.extensions!==null)for(const b of t.extensions)e.extensions.add(b)}}var eI=class extends Tn{constructor(n,...t){super("EffectPass"),this.fullscreenMaterial=new Nj(null,null,null,n),this.listener=e=>this.handleEvent(e),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const t of this.effects)t.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const t of this.effects)t.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const t=this.fullscreenMaterial;t.dithering=n,t.needsUpdate=!0}setEffects(n){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=n.sort((t,e)=>e.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const n=new Zz;let t=0;for(const o of this.effects)if(o.blendMode.blendFunction===Je.DST)n.attributes|=o.getAttributes()&Fr.DEPTH;else{if(n.attributes&o.getAttributes()&Fr.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);zj("e"+t++,o,n)}let e=n.shaderParts.get(St.FRAGMENT_HEAD),i=n.shaderParts.get(St.FRAGMENT_MAIN_IMAGE),s=n.shaderParts.get(St.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of n.blendModes.values())e+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;n.attributes&Fr.DEPTH?(n.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Ge&&(i+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(St.FRAGMENT_HEAD,e),n.shaderParts.set(St.FRAGMENT_MAIN_IMAGE,i),n.shaderParts.set(St.FRAGMENT_MAIN_UV,s);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,t=qs){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=t;for(const e of this.effects)e.setDepthTexture(n,t)}render(n,t,e,i,s){for(const r of this.effects)r.update(n,t,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=t.texture,r.time+=i*this.timeScale,n.setRenderTarget(this.renderToScreen?null:e),n.render(this.scene,this.camera)}}setSize(n,t){this.fullscreenMaterial.setSize(n,t);for(const e of this.effects)e.setSize(n,t)}initialize(n,t,e){this.renderer=n;for(const i of this.effects)i.initialize(n,t,e);this.updateMaterial(),e!==void 0&&e!==gi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},bk=class extends Tn{constructor(n,t,{renderTarget:e,resolutionScale:i=1,width:s=Dt.AUTO_SIZE,height:r=Dt.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new x0(n,t,new _P);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const h=l.getClearPass();h.overrideClearColor=new be(7829503),h.overrideClearAlpha=1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new Et(1,1,{minFilter:mi,magFilter:mi}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Dt(this,o,a,i);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,e,i,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r,r)}setSize(n,t){const e=this.resolution;e.setBaseSize(n,t),this.renderTarget.setSize(e.width,e.height)}},sg=function(){var n=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(u){u.preventDefault(),i(++n%t.children.length)},!1);function e(u){return t.appendChild(u.dom),u}function i(u){for(var d=0;d<t.children.length;d++)t.children[d].style.display=d===u?"block":"none";n=u}var s=(performance||Date).now(),r=s,o=0,a=e(new sg.Panel("FPS","#0ff","#002")),l=e(new sg.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=e(new sg.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:e,showPanel:i,begin:function(){s=(performance||Date).now()},end:function(){o++;var u=(performance||Date).now();if(l.update(u-s,200),u>=r+1e3&&(a.update(o*1e3/(u-r),100),r=u,o=0,h)){var d=performance.memory;h.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return u},update:function(){s=this.end()},domElement:t,setMode:i}};sg.Panel=function(n,t,e){var i=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,h=3*o,u=2*o,d=3*o,f=15*o,p=74*o,g=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=e,v.fillRect(0,0,a,l),v.fillStyle=t,v.fillText(n,h,u),v.fillRect(d,f,p,g),v.fillStyle=e,v.globalAlpha=.9,v.fillRect(d,f,p,g),{dom:m,update:function(y,b){i=Math.min(i,y),s=Math.max(s,y),v.fillStyle=e,v.globalAlpha=1,v.fillRect(0,0,a,f),v.fillStyle=t,v.fillText(r(y)+" "+n+" ("+r(i)+"-"+r(s)+")",h,u),v.drawImage(m,d+o,f,p-o,g,d,f,p-o,g),v.fillRect(d+p-o,f,o,g),v.fillStyle=e,v.globalAlpha=.9,v.fillRect(d+p-o,f,o,r((1-y/b)*g))}}};const Qj=z("debugpatch");function _S(n,t,e,i){const s=Qj===t;if(!e&&!i)return;const r=t+"___needle";jj(n,t,e,i);const o=Object.getOwnPropertyDescriptor(n,t),a=n[t];s&&console.log("Patch",n.constructor.name,t,o,a),o?(s&&console.log("Apply patch with existing descriptor",n.constructor.name,t,o),typeof o.value=="function"&&(n[t]=iI(o.value,n,t))):(s&&console.log("Create patch with new property",n.constructor.name,t,o),Object.defineProperty(n,t,{set:function(l){if(typeof l=="function")this[r]=iI(l,n,t);else{const h=this[r];_k(n,t,this,h,l),this[r]=l,wk(n,t,this,h,l)}},get:function(){const l=this[r];return typeof l=="function"&&l[r]?l[r]:l}}))}function xK(n,t,e){const i=wS(n,t);if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];r.prefix===e&&(r.prefix=null),r.postfix===e&&(r.postfix=null),!r.prefix&&!r.postfix&&i.splice(s,1)}}const tI=Symbol("Needle:Patches:WrappedFunction");function iI(n,t,e){if(n[tI])return n;const i=function(...s){_k(t,e,this,...s);const r=n.apply(this,s);return wk(t,e,this,r,...s),r};return i[tI]=!0,i}const Kb="Needle:Patches";function ex(){return globalThis[Kb]||(globalThis[Kb]=new WeakMap),globalThis[Kb]}function wS(n,t){const e=ex().get(n);return e?e.get(t):null}function jj(n,t,e,i){let s=ex().get(n);s||(s=new Map,ex().set(n,s));let r=s.get(t);r||(r=[],s.set(t,r)),r.push({prefix:e,postfix:i})}function _k(n,t,e,...i){var r;if(!e)return;const s=wS(n,t);if(s)for(const o of s)(r=o.prefix)==null||r.call(e,...i)}function wk(n,t,e,i,...s){var o;if(!e)return;const r=wS(n,t);if(r)for(const a of r)(o=a.postfix)==null||o.call(e,i,...s)}const xk="1.2.12";globalThis.GLTF_PROGRESSIVE_VERSION=xk;console.debug(`[gltf-progressive] version ${xk}`);function Gj(n,t=1e-4){t=Math.max(t,Number.EPSILON);const e={},i=n.getIndex(),s=n.getAttribute("position"),r=i?i.count:s.count;let o=0;const a=Object.keys(n.attributes),l={},h={},u=[],d=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let b=0,_=a.length;b<_;b++){const x=a[b],S=n.attributes[x];l[x]=new Ke(new S.array.constructor(S.count*S.itemSize),S.itemSize,S.normalized);const E=n.morphAttributes[x];E&&(h[x]=new Ke(new E.array.constructor(E.count*E.itemSize),E.itemSize,E.normalized))}const p=t*.5,g=Math.log10(1/t),m=Math.pow(10,g),v=p*m;for(let b=0;b<r;b++){const _=i?i.getX(b):b;let x="";for(let S=0,E=a.length;S<E;S++){const M=a[S],I=n.getAttribute(M),B=I.itemSize;for(let R=0;R<B;R++)x+=`${~~(I[d[R]](_)*m+v)},`}if(x in e)u.push(e[x]);else{for(let S=0,E=a.length;S<E;S++){const M=a[S],I=n.getAttribute(M),B=n.morphAttributes[M],R=I.itemSize,P=l[M],F=h[M];for(let j=0;j<R;j++){const V=d[j],X=f[j];if(P[X](o,I[V](_)),B)for(let k=0,O=B.length;k<O;k++)F[k][X](o,B[k][V](_))}}e[x]=o,u.push(o),o++}}const y=n.clone();for(const b in n.attributes){const _=l[b];if(y.setAttribute(b,new Ke(_.array.slice(0,o*_.itemSize),_.itemSize,_.normalized)),b in h)for(let x=0;x<h[b].length;x++){const S=h[b][x];y.morphAttributes[b][x]=new Ke(S.array.slice(0,o*S.itemSize),S.itemSize,S.normalized)}}return y.setIndex(u),y}function nI(n,t){if(t===KL)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===Fw||t===TP){let e=n.getIndex();if(e===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),e=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=e.count-2,s=[];if(t===Fw)for(let o=1;o<=i;o++)s.push(e.getX(0)),s.push(e.getX(o)),s.push(e.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(s.push(e.getX(o)),s.push(e.getX(o+1)),s.push(e.getX(o+2))):(s.push(e.getX(o+2)),s.push(e.getX(o+1)),s.push(e.getX(o)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}class rl extends ch{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Xj(e)}),this.register(function(e){return new nG(e)}),this.register(function(e){return new sG(e)}),this.register(function(e){return new rG(e)}),this.register(function(e){return new Kj(e)}),this.register(function(e){return new Jj(e)}),this.register(function(e){return new Zj(e)}),this.register(function(e){return new $j(e)}),this.register(function(e){return new qj(e)}),this.register(function(e){return new eG(e)}),this.register(function(e){return new Yj(e)}),this.register(function(e){return new iG(e)}),this.register(function(e){return new tG(e)}),this.register(function(e){return new Vj(e)}),this.register(function(e){return new oG(e)}),this.register(function(e){return new aG(e)})}load(t,e,i,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const h=ef.extractUrlBase(t);o=ef.resolveURL(h,this.path)}else o=ef.extractUrlBase(t);this.manager.itemStart(t);const a=function(h){s?s(h):console.error(h),r.manager.itemError(t),r.manager.itemEnd(t)},l=new Or(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(h){try{r.parse(h,o,function(u){e(u),r.manager.itemEnd(t)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){let r;const o={},a={},l=new TextDecoder;if(typeof t=="string")r=JSON.parse(t);else if(t instanceof ArrayBuffer)if(l.decode(new Uint8Array(t,0,4))===Ck){try{o[pt.KHR_BINARY_GLTF]=new lG(t)}catch(d){s&&s(d);return}r=JSON.parse(o[pt.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(t));else r=t;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new _G(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](h);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let u=0;u<r.extensionsUsed.length;++u){const d=r.extensionsUsed[u],f=r.extensionsRequired||[];switch(d){case pt.KHR_MATERIALS_UNLIT:o[d]=new Wj;break;case pt.KHR_DRACO_MESH_COMPRESSION:o[d]=new cG(r,this.dracoLoader);break;case pt.KHR_TEXTURE_TRANSFORM:o[d]=new hG;break;case pt.KHR_MESH_QUANTIZATION:o[d]=new uG;break;default:f.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}h.setExtensions(o),h.setPlugins(a),h.parse(i,s)}parseAsync(t,e){const i=this;return new Promise(function(s,r){i.parse(t,e,s,r)})}}function Hj(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const pt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Vj{constructor(t){this.parser=t,this.name=pt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const r=e[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let s=e.cache.get(i);if(s)return s;const r=e.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let h;const u=new be(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],Ni);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":h=new zg(u),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new Ng(u),h.distance=d;break;case"spot":h=new PC(u),h.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,h.angle=l.spot.outerConeAngle,h.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return h.position.set(0,0,0),h.decay=2,Uc(h,l),l.intensity!==void 0&&(h.intensity=l.intensity),h.name=e.createUniqueName(l.name||"light_"+t),s=Promise.resolve(h),e.cache.add(i,s),s}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,r=i.json.nodes[t],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(e.cache,a,l)})}}let Wj=class{constructor(){this.name=pt.KHR_MATERIALS_UNLIT}getMaterialType(){return _t}extendParams(t,e,i){const s=[];t.color=new be(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;t.color.setRGB(o[0],o[1],o[2],Ni),t.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(t,"map",r.baseColorTexture,Ge))}return Promise.all(s)}},qj=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(e.emissiveIntensity=r),Promise.resolve()}},Xj=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new oe(a,a)}return Promise.all(r)}},Yj=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},Kj=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new be(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],Ni)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,Ge)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},Jj=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},Zj=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new be().setRGB(a[0],a[1],a[2],Ni),Promise.all(r)}},$j=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return e.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},eG=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new be().setRGB(a[0],a[1],a[2],Ni),o.specularColorTexture!==void 0&&r.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,Ge)),Promise.all(r)}},tG=class{constructor(t){this.parser=t,this.name=pt.EXT_MATERIALS_BUMP}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(r)}},iG=class{constructor(t){this.parser=t,this.name=pt.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class nG{constructor(t){this.parser=t,this.name=pt.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,s=i.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,o)}}class sG{constructor(t){this.parser=t,this.name=pt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,r=s.textures[t];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const h=i.options.manager.getHandler(a.uri);h!==null&&(l=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(t,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class rG{constructor(t){this.parser=t,this.name=pt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,r=s.textures[t];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const h=i.options.manager.getHandler(a.uri);h!==null&&(l=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(t,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class oG{constructor(t){this.name=pt.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,h=s.byteLength||0,u=s.count,d=s.byteStride,f=new Uint8Array(a,l,h);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,f,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(p),u,d,f,s.mode,s.filter),p})})}else return null}}let aG=class{constructor(t){this.name=pt.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const h of s.primitives)if(h.mode!==ro.TRIANGLES&&h.mode!==ro.TRIANGLE_STRIP&&h.mode!==ro.TRIANGLE_FAN&&h.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const h in o)a.push(this.parser.getDependency("accessor",o[h]).then(u=>(l[h]=u,l[h])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(h=>{const u=h.pop(),d=u.isGroup?u.children:[u],f=h[0].count,p=[];for(const g of d){const m=new ae,v=new w,y=new ie,b=new w(1,1,1),_=new JL(g.geometry,g.material,f);for(let x=0;x<f;x++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,x),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,x),l.SCALE&&b.fromBufferAttribute(l.SCALE,x),_.setMatrixAt(x,m.compose(v,y,b));for(const x in l)if(x==="_COLOR_0"){const S=l[x];_.instanceColor=new Dc(S.array,S.itemSize,S.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&g.geometry.setAttribute(x,l[x]);ne.prototype.copy.call(_,g),this.parser.assignFinalMaterial(_),p.push(_)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}};const Ck="glTF",up=12,sI={JSON:1313821514,BIN:5130562};class lG{constructor(t){this.name=pt.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,up),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Ck)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-up,r=new DataView(t,up);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===sI.JSON){const h=new Uint8Array(t,up+o,a);this.content=i.decode(h)}else if(l===sI.BIN){const h=up+o;this.body=t.slice(h,h+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class cG{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=pt.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,s=this.dracoLoader,r=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},l={},h={};for(const u in o){const d=tx[u]||u.toLowerCase();a[d]=o[u]}for(const u in t.attributes){const d=tx[u]||u.toLowerCase();if(o[u]!==void 0){const f=i.accessors[t.attributes[u]],p=of[f.componentType];h[d]=p.name,l[d]=f.normalized===!0}}return e.getDependency("bufferView",r).then(function(u){return new Promise(function(d,f){s.decodeDracoFile(u,function(p){for(const g in p.attributes){const m=p.attributes[g],v=l[g];v!==void 0&&(m.normalized=v)}d(p)},a,h,Ni,f)})})}}class hG{constructor(){this.name=pt.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class uG{constructor(){this.name=pt.KHR_MESH_QUANTIZATION}}class Sk extends tF{constructor(t,e,i,s){super(t,e,i,s)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=t*s*3+s;for(let o=0;o!==s;o++)e[o]=i[r+o];return e}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,h=a*3,u=s-e,d=(i-e)/u,f=d*d,p=f*d,g=t*h,m=g-h,v=-2*p+3*f,y=p-f,b=1-v,_=y-f+d;for(let x=0;x!==a;x++){const S=o[m+x+a],E=o[m+x+l]*u,M=o[g+x+a],I=o[g+x]*u;r[x]=b*S+_*E+v*M+y*I}return r}}const dG=new ie;class fG extends Sk{interpolate_(t,e,i,s){const r=super.interpolate_(t,e,i,s);return dG.fromArray(r).normalize().toArray(r),r}}const ro={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},of={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},rI={9728:mi,9729:Mt,9984:RP,9985:BP,9986:PP,9987:_m},oI={33071:qv,33648:Xv,10497:nc},Jb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tx={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Cc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},pG={CUBICSPLINE:void 0,LINEAR:kC,STEP:MP},Zb={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function gG(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Kn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:il})),n.DefaultMaterial}function kh(n,t,e){for(const i in e.extensions)n[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function Uc(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function mG(n,t,e){let i=!1,s=!1,r=!1;for(let h=0,u=t.length;h<u;h++){const d=t[h];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(n);const o=[],a=[],l=[];for(let h=0,u=t.length;h<u;h++){const d=t[h];if(i){const f=d.POSITION!==void 0?e.getDependency("accessor",d.POSITION):n.attributes.position;o.push(f)}if(s){const f=d.NORMAL!==void 0?e.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(f)}if(r){const f=d.COLOR_0!==void 0?e.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(h){const u=h[0],d=h[1],f=h[2];return i&&(n.morphAttributes.position=u),s&&(n.morphAttributes.normal=d),r&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}function AG(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let i=0,s=e.length;i<s;i++)n.morphTargetDictionary[e[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function vG(n){let t;const e=n.extensions&&n.extensions[pt.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+$b(e.attributes):t=n.indices+":"+$b(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)t+=":"+$b(n.targets[i]);return t}function $b(n){let t="";const e=Object.keys(n).sort();for(let i=0,s=e.length;i<s;i++)t+=e[i]+":"+n[e[i]]+";";return t}function ix(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function yG(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const bG=new ae;class _G{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Hj,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,r=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&r<98?this.textureLoader=new Xa(this.options.manager):this.textureLoader=new ZL(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Or(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};return kh(r,a,s),Uc(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){t(a)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=e.length;s<r;s++){const o=e[s].joints;for(let a=0,l=o.length;a<l;a++)t[o[a]].isBone=!0}for(let s=0,r=t.length;s<r;s++){const o=t[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const s=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[h,u]of o.children.entries())r(u,a.children[h])};return r(i,s),s.name+="_instance_"+t.uses[e]++,s}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=t(e[i]);if(s)return s}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const r=t(e[s]);r&&i.push(r)}return i}getDependency(t,e){const i=t+":"+e;let s=this.cache.get(i);if(!s){switch(t){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(e)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(e)});break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(e)});break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(e)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(e)});break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(e)});break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(t,e)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(i,s)}return s}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(s.map(function(r,o){return i.getDependency(t,o)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[pt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(ef.resolveURL(e.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){const s=e.byteLength||0,r=e.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(t){const e=this,i=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const o=Jb[s.type],a=of[s.componentType],l=s.normalized===!0,h=new a(s.count*o);return Promise.resolve(new Ke(h,o,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=Jb[s.type],h=of[s.componentType],u=h.BYTES_PER_ELEMENT,d=u*l,f=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let m,v;if(p&&p!==d){const y=Math.floor(f/p),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let _=e.cache.get(b);_||(m=new h(a,y*p,s.count*p/u),_=new $L(m,p/u),e.cache.add(b,_)),v=new Xc(_,l,f%p/u,g)}else a===null?m=new h(s.count*l):m=new h(a,f,s.count*l),v=new Ke(m,l,g);if(s.sparse!==void 0){const y=Jb.SCALAR,b=of[s.sparse.indices.componentType],_=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,S=new b(o[1],_,s.sparse.count*y),E=new h(o[2],x,s.sparse.count*l);a!==null&&(v=new Ke(v.array.slice(),v.itemSize,v.normalized));for(let M=0,I=S.length;M<I;M++){const B=S[M];if(v.setX(B,E[M*l]),l>=2&&v.setY(B,E[M*l+1]),l>=3&&v.setZ(B,E[M*l+2]),l>=4&&v.setW(B,E[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(t){const e=this.json,i=this.options,r=e.textures[t].source,o=e.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(t,r,a)}loadTextureImage(t,e,i){const s=this,r=this.json,o=r.textures[t],a=r.images[e],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const h=this.loadImageSource(e,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const f=(r.samplers||{})[o.sampler]||{};return u.magFilter=rI[f.magFilter]||Mt,u.minFilter=rI[f.minFilter]||_m,u.wrapS=oI[f.wrapS]||nc,u.wrapT=oI[f.wrapT]||nc,u.anisotropy=4,s.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[l]=h,h}loadImageSource(t,e){const i=this,s=this.json,r=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(d=>d.clone());const o=s.images[t],a=self.URL||self.webkitURL;let l=o.uri||"",h=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){h=!0;const f=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(f,p){let g=f;e.isImageBitmapLoader===!0&&(g=function(m){const v=new At(m);v.needsUpdate=!0,f(v)}),e.load(ef.resolveURL(d,r.path),g,void 0,p)})}).then(function(d){return h===!0&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||yG(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[t]=u,u}assignTexture(t,e,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[pt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[pt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[pt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.colorSpace=s),t[e]=o,o})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const s=e.attributes.tangent===void 0,r=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Up,mt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(t.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Jo,mt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}t.material=i}getMaterialType(){return Kn}loadMaterial(t){const e=this,i=this.json,s=this.extensions,r=i.materials[t];let o;const a={},l=r.extensions||{},h=[];if(l[pt.KHR_MATERIALS_UNLIT]){const d=s[pt.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),h.push(d.extendParams(a,r,e))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new be(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],Ni),a.opacity=f[3]}d.baseColorTexture!==void 0&&h.push(e.assignTexture(a,"map",d.baseColorTexture,Ge)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(h.push(e.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),h.push(e.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(t)}),h.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(t,a)})))}r.doubleSided===!0&&(a.side=_i);const u=r.alphaMode||Zb.OPAQUE;if(u===Zb.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Zb.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==_t&&(h.push(e.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new oe(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}if(r.occlusionTexture!==void 0&&o!==_t&&(h.push(e.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==_t){const d=r.emissiveFactor;a.emissive=new be().setRGB(d[0],d[1],d[2],Ni)}return r.emissiveTexture!==void 0&&o!==_t&&h.push(e.assignTexture(a,"emissiveMap",r.emissiveTexture,Ge)),Promise.all(h).then(function(){const d=new o(a);return r.name&&(d.name=r.name),Uc(d,r),e.associations.set(d,{materials:t}),r.extensions&&kh(s,d,r),d})}createUniqueName(t){const e=Ur.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[pt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(l){return aI(l,a,e)})}const o=[];for(let a=0,l=t.length;a<l;a++){const h=t[a],u=vG(h),d=s[u];if(d)o.push(d.promise);else{let f;h.extensions&&h.extensions[pt.KHR_DRACO_MESH_COMPRESSION]?f=r(h):f=aI(new Ht,h,e),s[u]={primitive:h,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(t){const e=this,i=this.json,s=this.extensions,r=i.meshes[t],o=r.primitives,a=[];for(let l=0,h=o.length;l<h;l++){const u=o[l].material===void 0?gG(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(e.loadGeometries(o)),Promise.all(a).then(function(l){const h=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let p=0,g=u.length;p<g;p++){const m=u[p],v=o[p];let y;const b=h[p];if(v.mode===ro.TRIANGLES||v.mode===ro.TRIANGLE_STRIP||v.mode===ro.TRIANGLE_FAN||v.mode===void 0)y=r.isSkinnedMesh===!0?new Zo(m,b):new J(m,b),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),v.mode===ro.TRIANGLE_STRIP?y.geometry=nI(y.geometry,TP):v.mode===ro.TRIANGLE_FAN&&(y.geometry=nI(y.geometry,Fw));else if(v.mode===ro.LINES)y=new xf(m,b);else if(v.mode===ro.LINE_STRIP)y=new ms(m,b);else if(v.mode===ro.LINE_LOOP)y=new eF(m,b);else if(v.mode===ro.POINTS)y=new mv(m,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&AG(y,r),y.name=e.createUniqueName(r.name||"mesh_"+t),Uc(y,r),v.extensions&&kh(s,y,v),e.assignFinalMaterial(y),d.push(y)}for(let p=0,g=d.length;p<g;p++)e.associations.set(d[p],{meshes:t,primitives:p});if(d.length===1)return r.extensions&&kh(s,d[0],r),d[0];const f=new Lr;r.extensions&&kh(s,f,r),e.associations.set(f,{meshes:t});for(let p=0,g=d.length;p<g;p++)f.add(d[p]);return f})}loadCamera(t){let e;const i=this.json.cameras[t],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new bt(ct.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(e=new Mu(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),Uc(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i=[];for(let s=0,r=e.joints.length;s<r;s++)i.push(this._loadNodeShallow(e.joints[s]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,a=[],l=[];for(let h=0,u=o.length;h<u;h++){const d=o[h];if(d){a.push(d);const f=new ae;r!==null&&f.fromArray(r.array,h*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[h])}return new MC(a,l)})}loadAnimation(t){const e=this.json,i=this,s=e.animations[t],r=s.name?s.name:"animation_"+t,o=[],a=[],l=[],h=[],u=[];let d=0,f=s.channels.length;for(d=0,f=s.channels.length;d<f;d++){const p=s.channels[d],g=s.samplers[p.sampler],m=p.target,v=m.node,y=s.parameters!==void 0?s.parameters[g.input]:g.input,b=s.parameters!==void 0?s.parameters[g.output]:g.output;m.node!==void 0&&(o.push(this.getDependency("node",v)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",b)),h.push(g),u.push(m))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(h),Promise.all(u)]).then(function(p){const g=p[0],m=p[1],v=p[2],y=p[3],b=p[4],_=[];for(d=0,f=g.length;d<f;d++){const x=g[d],S=m[d],E=v[d],M=y[d],I=b[d];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const B=i._createAnimationTracks(x,S,E,M,I);if(B)for(let R=0;R<B.length;R++)_.push(B[R])}return new ql(r,void 0,_)})}createNodeMesh(t){const e=this.json,i=this,s=e.nodes[t];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,h=s.weights.length;l<h;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(t){const e=this.json,i=this,s=e.nodes[t],r=i._loadNodeShallow(t),o=[],a=s.children||[];for(let h=0,u=a.length;h<u;h++)o.push(i.getDependency("node",a[h]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),l]).then(function(h){const u=h[0],d=h[1],f=h[2];f!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(f,bG)});for(let p=0,g=d.length;p<g;p++)u.add(d[p]);return u})}_loadNodeShallow(t){const e=this.json,i=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const r=e.nodes[t],o=r.name?s.createUniqueName(r.name):"",a=[],l=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(t)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(h){return s._getNodeRef(s.cameraCache,r.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(t)}).forEach(function(h){a.push(h)}),this.nodeCache[t]=Promise.all(a).then(function(h){let u;if(r.isBone===!0?u=new Wv:h.length>1?u=new Lr:h.length===1?u=h[0]:u=new ne,u!==h[0])for(let d=0,f=h.length;d<f;d++)u.add(h[d]);if(r.name&&(u.userData.name=r.name,u.name=o),Uc(u,r),r.extensions&&kh(i,u,r),r.matrix!==void 0){const d=new ae;d.fromArray(r.matrix),u.applyMatrix4(d)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],s=this,r=new Lr;i.name&&(r.name=s.createUniqueName(i.name)),Uc(r,i),i.extensions&&kh(e,r,i);const o=i.nodes||[],a=[];for(let l=0,h=o.length;l<h;l++)a.push(s.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,d=l.length;u<d;u++)r.add(l[u]);const h=u=>{const d=new Map;for(const[f,p]of s.associations)(f instanceof mt||f instanceof At)&&d.set(f,p);return u.traverse(f=>{const p=s.associations.get(f);p!=null&&d.set(f,p)}),d};return s.associations=h(r),r})}_createAnimationTracks(t,e,i,s,r){const o=[],a=t.name?t.name:t.uuid,l=[];Cc[r.path]===Cc.weights?t.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let h;switch(Cc[r.path]){case Cc.weights:h=Uw;break;case Cc.rotation:h=Kv;break;case Cc.position:case Cc.scale:h=Yv;break;default:switch(i.itemSize){case 1:h=Uw;break;case 2:case 3:default:h=Yv;break}break}const u=s.interpolation!==void 0?pG[s.interpolation]:kC,d=this._getArrayFromAccessor(i);for(let f=0,p=l.length;f<p;f++){const g=new h(l[f]+"."+Cc[r.path],e.array,d,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),o.push(g)}return o}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const i=ix(e.constructor),s=new Float32Array(e.length);for(let r=0,o=e.length;r<o;r++)s[r]=e[r]*i;e=s}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(i){const s=this instanceof Kv?fG:Sk;return new s(this.times,this.values,this.getValueSize()/3,i)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function wG(n,t,e){const i=t.attributes,s=new xn;if(i.POSITION!==void 0){const a=e.json.accessors[i.POSITION],l=a.min,h=a.max;if(l!==void 0&&h!==void 0){if(s.set(new w(l[0],l[1],l[2]),new w(h[0],h[1],h[2])),a.normalized){const u=ix(of[a.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=t.targets;if(r!==void 0){const a=new w,l=new w;for(let h=0,u=r.length;h<u;h++){const d=r[h];if(d.POSITION!==void 0){const f=e.json.accessors[d.POSITION],p=f.min,g=f.max;if(p!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),f.normalized){const m=ix(of[f.componentType]);l.multiplyScalar(m)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const o=new uc;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=o}function aI(n,t,e){const i=t.attributes,s=[];function r(o,a){return e.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=tx[o]||o.toLowerCase();a in n.attributes||s.push(r(i[o],a))}if(t.indices!==void 0&&!n.index){const o=e.getDependency("accessor",t.indices).then(function(a){n.setIndex(a)});s.push(o)}return m1.workingColorSpace!==Ni&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${m1.workingColorSpace}" not supported.`),Uc(n,t),wG(n,t,e),Promise.all(s).then(function(){return t.targets!==void 0?mG(n,t.targets,e):n})}var xG=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",t="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var s=WebAssembly.validate(e)?t:n,r,o=WebAssembly.instantiate(a(s),{}).then(function(y){r=y.instance,r.exports.__wasm_call_ctors()});function a(y){for(var b=new Uint8Array(y.length),_=0;_<y.length;++_){var x=y.charCodeAt(_);b[_]=x>96?x-97:x>64?x-39:x+4}for(var S=0,_=0;_<y.length;++_)b[S++]=b[_]<60?i[b[_]]:(b[_]-60)*64+b[++_];return b.buffer.slice(0,S)}function l(y,b,_,x,S,E){var M=r.exports.sbrk,I=_+3&-4,B=M(I*x),R=M(S.length),P=new Uint8Array(r.exports.memory.buffer);P.set(S,R);var F=y(B,_,x,R,S.length);if(F==0&&E&&E(B,I,x),b.set(P.subarray(B,B+_*x)),M(B-M(0)),F!=0)throw new Error("Malformed buffer data: "+F)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],f=0;function p(y){var b={object:new Worker(y),pending:0,requests:{}};return b.object.onmessage=function(_){var x=_.data;b.pending-=x.count,b.requests[x.id][x.action](x.value),delete b.requests[x.id]},b}function g(y){for(var b="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+v.toString(),_=new Blob([b],{type:"text/javascript"}),x=URL.createObjectURL(_),S=0;S<y;++S)d[S]=p(x);URL.revokeObjectURL(x)}function m(y,b,_,x,S){for(var E=d[0],M=1;M<d.length;++M)d[M].pending<E.pending&&(E=d[M]);return new Promise(function(I,B){var R=new Uint8Array(_),P=f++;E.pending+=y,E.requests[P]={resolve:I,reject:B},E.object.postMessage({id:P,count:y,size:b,source:R,mode:x,filter:S},[R.buffer])})}function v(y){o.then(function(){var b=y.data;try{var _=new Uint8Array(b.count*b.size);l(r.exports[b.mode],_,b.count,b.size,b.source,r.exports[b.filter]),self.postMessage({id:b.id,count:b.count,action:"resolve",value:_},[_.buffer])}catch(x){self.postMessage({id:b.id,count:b.count,action:"reject",value:x})}})}return{ready:o,supported:!0,useWorkers:function(y){g(y)},decodeVertexBuffer:function(y,b,_,x,S){l(r.exports.meshopt_decodeVertexBuffer,y,b,_,x,r.exports[h[S]])},decodeIndexBuffer:function(y,b,_,x){l(r.exports.meshopt_decodeIndexBuffer,y,b,_,x)},decodeIndexSequence:function(y,b,_,x){l(r.exports.meshopt_decodeIndexSequence,y,b,_,x)},decodeGltfBuffer:function(y,b,_,x,S,E){l(r.exports[u[S]],y,b,_,x,r.exports[h[E]])},decodeGltfBufferAsync:function(y,b,_,x,S){return d.length>0?m(y,b,_,u[x],h[S]):o.then(function(){var E=new Uint8Array(y*b);return l(r.exports[u[x]],E,y,b,_,r.exports[h[S]]),E})}}}();const e_=new WeakMap;class CG extends ch{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,s){const r=new Or(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,o=>{this.parse(o,e,s)},i,s)}parse(t,e,i=()=>{}){this.decodeDracoFile(t,e,null,null,Ge).catch(i)}decodeDracoFile(t,e,i,s,r=Ni,o=()=>{}){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(t,a).then(e).catch(o)}decodeGeometry(t,e){const i=JSON.stringify(e);if(e_.has(t)){const l=e_.get(t);if(l.key===i)return l.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=t.byteLength,a=this._getWorker(r,o).then(l=>(s=l,new Promise((h,u)=>{s._callbacks[r]={resolve:h,reject:u},s.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),e_.set(t,{key:i,promise:a}),a}_createGeometry(t){const e=new Ht;t.index&&e.setIndex(new Ke(t.index.array,1));for(let i=0;i<t.attributes.length;i++){const s=t.attributes[i],r=s.name,o=s.array,a=s.itemSize,l=new Ke(o,a);r==="color"&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),e.setAttribute(r,l)}return e}_assignVertexColorSpace(t,e){if(e!==Ge)return;const i=new be;for(let s=0,r=t.count;s<r;s++)i.fromBufferAttribute(t,s).convertSRGBToLinear(),t.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(t,e){const i=new Or(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((s,r)=>{i.load(t,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{const s=i[0];t||(this.decoderConfig.wasmBinary=i[1]);const r=SG.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function SG(){let n,t;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,t=new Promise(function(u){n.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(n)});break;case"decode":const l=a.buffer,h=a.taskConfig;t.then(u=>{const d=u.draco,f=new d.Decoder;try{const p=e(d,f,new Int8Array(l),h),g=p.attributes.map(m=>m.array.buffer);p.index&&g.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},g)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{d.destroy(f)}});break}};function e(o,a,l,h){const u=h.attributeIDs,d=h.attributeTypes;let f,p;const g=a.GetEncodedGeometryType(l);if(g===o.TRIANGULAR_MESH)f=new o.Mesh,p=a.DecodeArrayToMesh(l,l.byteLength,f);else if(g===o.POINT_CLOUD)f=new o.PointCloud,p=a.DecodeArrayToPointCloud(l,l.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const m={index:null,attributes:[]};for(const v in u){const y=self[d[v]];let b,_;if(h.useUniqueIDs)_=u[v],b=a.GetAttributeByUniqueId(f,_);else{if(_=a.GetAttributeId(f,o[u[v]]),_===-1)continue;b=a.GetAttribute(f,_)}const x=s(o,a,f,v,y,b);v==="color"&&(x.vertexColorSpace=h.vertexColorSpace),m.attributes.push(x)}return g===o.TRIANGULAR_MESH&&(m.index=i(o,a,f)),o.destroy(f),m}function i(o,a,l){const u=l.num_faces()*3,d=u*4,f=o._malloc(d);a.GetTrianglesUInt32Array(l,d,f);const p=new Uint32Array(o.HEAPF32.buffer,f,u).slice();return o._free(f),{array:p,itemSize:1}}function s(o,a,l,h,u,d){const f=d.num_components(),g=l.num_points()*f,m=g*u.BYTES_PER_ELEMENT,v=r(o,u),y=o._malloc(m);a.GetAttributeDataArrayForAllPoints(l,d,v,m,y);const b=new u(o.HEAPF32.buffer,y,g).slice();return o._free(y),{name:h,array:b,itemSize:f}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class EG{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const i=this.workersResolve[t];if(i&&i(e),this.queue.length){const{resolve:s,msg:r,transfer:o}=this.queue.shift();this.workersResolve[t]=s,this.workers[t].postMessage(r,o)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,e){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(t,e)):this.queue.push({resolve:i,msg:t,transfer:e})})}dispose(){this.workers.forEach(t=>t.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const IG=0,lI=2,TG=1,cI=2,RG=0,BG=1,PG=10,MG=0,Ek=9,Ik=15,Tk=16,Rk=22,Bk=37,Pk=43,Mk=76,kk=83,Dk=97,Ok=100,Lk=103,Fk=109,Uk=165,Nk=166;class kG{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class dp{constructor(t,e,i,s){this._dataView=new DataView(t.buffer,t.byteOffset+e,i),this._littleEndian=s,this._offset=0}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_nextInt32(){const t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t}_skip(t){return this._offset+=t,this}_scan(t,e=0){const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==e&&s<t;)s++,this._offset++;return s<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const Ds=[171,75,84,88,32,50,48,187,13,10,26,10];function hI(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):Buffer.from(n).toString("utf8")}function DG(n){const t=new Uint8Array(n.buffer,n.byteOffset,Ds.length);if(t[0]!==Ds[0]||t[1]!==Ds[1]||t[2]!==Ds[2]||t[3]!==Ds[3]||t[4]!==Ds[4]||t[5]!==Ds[5]||t[6]!==Ds[6]||t[7]!==Ds[7]||t[8]!==Ds[8]||t[9]!==Ds[9]||t[10]!==Ds[10]||t[11]!==Ds[11])throw new Error("Missing KTX 2.0 identifier.");const e=new kG,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new dp(n,Ds.length,i,!0);e.vkFormat=s._nextUint32(),e.typeSize=s._nextUint32(),e.pixelWidth=s._nextUint32(),e.pixelHeight=s._nextUint32(),e.pixelDepth=s._nextUint32(),e.layerCount=s._nextUint32(),e.faceCount=s._nextUint32();const r=s._nextUint32();e.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),l=s._nextUint32(),h=s._nextUint32(),u=s._nextUint64(),d=s._nextUint64(),f=new dp(n,Ds.length+i,3*r*8,!0);for(let O=0;O<r;O++)e.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const p=new dp(n,o,a,!0),g={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},m=(g.descriptorBlockSize/4-6)/4;for(let O=0;O<m;O++){const H={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&H.channelType?(H.sampleLower=p._nextInt32(),H.sampleUpper=p._nextInt32()):(H.sampleLower=p._nextUint32(),H.sampleUpper=p._nextUint32()),g.samples[O]=H}e.dataFormatDescriptor.length=0,e.dataFormatDescriptor.push(g);const v=new dp(n,l,h,!0);for(;v._offset<h;){const O=v._nextUint32(),H=v._scan(O),ee=hI(H),Y=v._scan(O-H.byteLength);e.keyValue[ee]=ee.match(/^ktx/i)?hI(Y):Y,v._offset%4&&v._skip(4-v._offset%4)}if(d<=0)return e;const y=new dp(n,u,d,!0),b=y._nextUint16(),_=y._nextUint16(),x=y._nextUint32(),S=y._nextUint32(),E=y._nextUint32(),M=y._nextUint32(),I=[];for(let O=0;O<r;O++)I.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const B=u+y._offset,R=B+x,P=R+S,F=P+E,j=new Uint8Array(n.buffer,n.byteOffset+B,x),V=new Uint8Array(n.buffer,n.byteOffset+R,S),X=new Uint8Array(n.buffer,n.byteOffset+P,E),k=new Uint8Array(n.buffer,n.byteOffset+F,M);return e.globalData={endpointCount:b,selectorCount:_,imageDescs:I,endpointsData:j,selectorsData:V,tablesData:X,extendedData:k},e}let t_,Cl,nx;const i_={env:{emscripten_notify_memory_growth:function(n){nx=new Uint8Array(Cl.exports.memory.buffer)}}};class OG{init(){return t_||(t_=typeof fetch<"u"?fetch("data:application/wasm;base64,"+uI).then(t=>t.arrayBuffer()).then(t=>WebAssembly.instantiate(t,i_)).then(this._init):WebAssembly.instantiate(Buffer.from(uI,"base64"),i_).then(this._init),t_)}_init(t){Cl=t.instance,i_.env.emscripten_notify_memory_growth(0)}decode(t,e=0){if(!Cl)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=t.byteLength,s=Cl.exports.malloc(i);nx.set(t,s),e=e||Number(Cl.exports.ZSTD_findDecompressedSize(s,i));const r=Cl.exports.malloc(e),o=Cl.exports.ZSTD_decompress(r,e,s,i),a=nx.slice(r,r+o);return Cl.exports.free(s),Cl.exports.free(r),a}}const uI="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",n_=new WeakMap;let s_=0,r_;class Ga extends ch{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new EG,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}async detectSupportAsync(t){return this.workerConfig={astcSupported:await t.hasFeatureAsync("texture-compression-astc"),etc1Supported:await t.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await t.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await t.hasFeatureAsync("texture-compression-bc"),bptcSupported:await t.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await t.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(t){return t.isWebGPURenderer===!0?this.workerConfig={astcSupported:t.hasFeature("texture-compression-astc"),etc1Supported:t.hasFeature("texture-compression-etc1"),etc2Supported:t.hasFeature("texture-compression-etc2"),dxtSupported:t.hasFeature("texture-compression-bc"),bptcSupported:t.hasFeature("texture-compression-bptc"),pvrtcSupported:t.hasFeature("texture-compression-pvrtc")}:(this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const t=new Or(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),i=new Or(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,s]).then(([r,o])=>{const a=Ga.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Ga.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Ga.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ga.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const h=new Worker(this.workerSourceURL),u=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:u},[u]),h})}),s_>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),s_++}return this.transcoderPending}load(t,e,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Or(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(t,o=>{if(n_.has(o))return n_.get(o).promise.then(e).catch(s);this._createTexture(o).then(a=>e?e(a):null).catch(s)},i,s)}_createTextureFrom(t,e){const{faces:i,width:s,height:r,format:o,type:a,error:l,dfdFlags:h}=t;if(a==="error")return Promise.reject(l);let u;if(e.faceCount===6)u=new uF(i,o,gi);else{const d=i[0].mipmaps;u=e.layerCount>1?new dF(d,s,r,e.layerCount,o,gi):new tf(d,s,r,o,gi)}return u.minFilter=i[0].mipmaps.length===1?Mt:_m,u.magFilter=Mt,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=zk(e),u.premultiplyAlpha=!!(h&TG),u}async _createTexture(t,e={}){const i=DG(new Uint8Array(t));if(i.vkFormat!==MG)return FG(i);const s=e,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:s},[t])).then(o=>this._createTextureFrom(o.data,i));return n_.set(t,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),s_--,this}}Ga.BasisFormat={ETC1S:0,UASTC_4x4:1};Ga.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Ga.EngineFormat={RGBAFormat:Wi,RGBA_ASTC_4x4_Format:iF,RGBA_BPTC_Format:nF,RGBA_ETC2_EAC_Format:sF,RGBA_PVRTC_4BPPV1_Format:rF,RGBA_S3TC_DXT5_Format:oF,RGB_ETC1_Format:aF,RGB_ETC2_Format:lF,RGB_PVRTC_4BPPV1_Format:cF,RGB_S3TC_DXT1_Format:hF};Ga.BasisWorker=function(){let n,t,e;const i=_EngineFormat,s=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(g){const m=g.data;switch(m.type){case"init":n=m.config,o(m.transcoderBinary);break;case"transcode":t.then(()=>{try{const{faces:v,buffers:y,width:b,height:_,hasAlpha:x,format:S,dfdFlags:E}=a(m.buffer);self.postMessage({type:"transcode",id:m.id,faces:v,width:b,height:_,hasAlpha:x,format:S,dfdFlags:E},y)}catch(v){console.error(v),self.postMessage({type:"error",id:m.id,error:v.message})}});break}});function o(g){t=new Promise(m=>{e={wasmBinary:g,onRuntimeInitialized:m},BASIS(e)}).then(()=>{e.initializeBasis(),e.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(g){const m=new e.KTX2File(new Uint8Array(g));function v(){m.close(),m.delete()}if(!m.isValid())throw v(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const y=m.isUASTC()?r.UASTC_4x4:r.ETC1S,b=m.getWidth(),_=m.getHeight(),x=m.getLayers()||1,S=m.getLevels(),E=m.getFaces(),M=m.getHasAlpha(),I=m.getDFDFlags(),{transcoderFormat:B,engineFormat:R}=d(y,b,_,M);if(!b||!_||!S)throw v(),new Error("THREE.KTX2Loader:	Invalid texture");if(!m.startTranscoding())throw v(),new Error("THREE.KTX2Loader: .startTranscoding failed");const P=[],F=[];for(let j=0;j<E;j++){const V=[];for(let X=0;X<S;X++){const k=[];let O,H;for(let Y=0;Y<x;Y++){const he=m.getImageLevelInfo(X,Y,j);j===0&&X===0&&Y===0&&(he.origWidth%4!==0||he.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),S>1?(O=he.origWidth,H=he.origHeight):(O=he.width,H=he.height);const ue=new Uint8Array(m.getImageTranscodedSizeInBytes(X,Y,0,B));if(!m.transcodeImage(ue,X,Y,j,B,0,-1,-1))throw v(),new Error("THREE.KTX2Loader: .transcodeImage failed.");k.push(ue)}const ee=p(k);V.push({data:ee,width:O,height:H}),F.push(ee.buffer)}P.push({mipmaps:V,width:b,height:_,format:R})}return v(),{faces:P,buffers:F,width:b,height:_,hasAlpha:M,format:R,dfdFlags:I}}const l=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=l.sort(function(g,m){return g.priorityETC1S-m.priorityETC1S}),u=l.sort(function(g,m){return g.priorityUASTC-m.priorityUASTC});function d(g,m,v,y){let b,_;const x=g===r.ETC1S?h:u;for(let S=0;S<x.length;S++){const E=x[S];if(n[E.if]&&E.basisFormat.includes(g)&&!(y&&E.transcoderFormat.length<2)&&!(E.needsPowerOfTwo&&!(f(m)&&f(v))))return b=E.transcoderFormat[y?1:0],_=E.engineFormat[y?1:0],{transcoderFormat:b,engineFormat:_}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),b=s.RGBA32,_=i.RGBAFormat,{transcoderFormat:b,engineFormat:_}}function f(g){return g<=2?!0:(g&g-1)===0&&g!==0}function p(g){if(g.length===1)return g[0];let m=0;for(let b=0;b<g.length;b++){const _=g[b];m+=_.byteLength}const v=new Uint8Array(m);let y=0;for(let b=0;b<g.length;b++){const _=g[b];v.set(_,y),y+=_.byteLength}return v}};const LG=new Set([Wi,Pd,qc]),o_={[Fk]:Wi,[Dk]:Wi,[Bk]:Wi,[Pk]:Wi,[Lk]:Pd,[kk]:Pd,[Tk]:Pd,[Rk]:Pd,[Ok]:qc,[Mk]:qc,[Ik]:qc,[Ek]:qc,[Nk]:A1,[Uk]:A1},a_={[Fk]:mo,[Dk]:Zn,[Bk]:gi,[Pk]:gi,[Lk]:mo,[kk]:Zn,[Tk]:gi,[Rk]:gi,[Ok]:mo,[Mk]:Zn,[Ik]:gi,[Ek]:gi,[Nk]:gi,[Uk]:gi};async function FG(n){const{vkFormat:t}=n;if(o_[t]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let e;n.supercompressionScheme===lI&&(r_||(r_=new Promise(async r=>{const o=new OG;await o.init(),r(o)})),e=await r_);const i=[];for(let r=0;r<n.levels.length;r++){const o=Math.max(1,n.pixelWidth>>r),a=Math.max(1,n.pixelHeight>>r),l=n.pixelDepth?Math.max(1,n.pixelDepth>>r):0,h=n.levels[r];let u;if(n.supercompressionScheme===IG)u=h.levelData;else if(n.supercompressionScheme===lI)u=e.decode(h.levelData,h.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;a_[t]===mo?d=new Float32Array(u.buffer,u.byteOffset,u.byteLength/Float32Array.BYTES_PER_ELEMENT):a_[t]===Zn?d=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=u,i.push({data:d,width:o,height:a,depth:l})}let s;if(LG.has(o_[t]))s=n.pixelDepth===0?new Uf(i[0].data,n.pixelWidth,n.pixelHeight):new fF(i[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new tf(i,n.pixelWidth,n.pixelHeight)}return s.mipmaps=i,s.type=a_[t],s.format=o_[t],s.colorSpace=zk(n),s.needsUpdate=!0,Promise.resolve(s)}function zk(n){const t=n.dataFormatDescriptor[0];return t.colorPrimaries===BG?t.transferFunction===cI?Ge:Ni:t.colorPrimaries===PG?t.transferFunction===cI?pF:gF:t.colorPrimaries===RG?xu:(console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),xu)}let af="https://www.gstatic.com/draco/versioned/decoders/1.5.7/",Jg="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";const UG=af,NG=Jg;fetch(af+"draco_decoder.js",{method:"head"}).catch(n=>{af===UG&&(af="./include/draco/"),Jg===NG&&(Jg="./include/ktx2/")});function zG(n){af=n}function QG(n){Jg=n}let xd,wv,Cd;function xS(n){return xd||(xd=new CG,xd.setDecoderPath(af),xd.setDecoderConfig({type:"js"})),Cd||(Cd=new Ga,Cd.setTranscoderPath(Jg)),wv||(wv=xG),n?Cd.detectSupport(n):n!==null&&console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures might fail"),{dracoLoader:xd,ktx2Loader:Cd,meshoptDecoder:wv}}function jG(n){n.dracoLoader||n.setDRACOLoader(xd),n.ktx2Loader||n.setKTX2Loader(Cd),n.meshoptDecoder||n.setMeshoptDecoder(wv)}Cm("debugprogressive");function Cm(n){const e=new URL(window.location.href).searchParams.get(n);return e==null||e==="0"||e==="false"?!1:e===""?!0:e}function GG(n,t){if(t===void 0||t.startsWith("./")||t.startsWith("http")||n===void 0)return t;const e=n.lastIndexOf("/");if(e>=0){const i=n.substring(0,e+1);for(;i.endsWith("/")&&t.startsWith("/");)t=t.substring(1);return i+t}return t}let fp;function HG(){return fp!==void 0||(fp=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),Cm("debugprogressive")&&console.log("[glTF Progressive]: isMobileDevice",fp)),fp}const sx=Symbol("needle:raycast-mesh");function Sm(n){return(n==null?void 0:n[sx])instanceof Ht?n[sx]:null}function VG(n,t){if((n.type==="Mesh"||n.type==="SkinnedMesh")&&!Sm(n)){const i=WG(t);i.userData={isRaycastMesh:!0},n[sx]=i}}function WG(n){const t=new Ht;for(const e in n.attributes)t.setAttribute(e,n.getAttribute(e));return t.setIndex(n.getIndex()),t}const Nc=new Array,kl="NEEDLE_progressive",ti=Cm("debugprogressive"),l_=Symbol("needle-progressive-texture"),rg=new Map,rx=new Set;if(ti){let i=function(){n+=1,console.log("Toggle LOD level",n,rg),rg.forEach((s,r)=>{for(const o of s.keys){const a=r[o];if(a!=null){if(a.isBufferGeometry===!0){const l=ht.getMeshLODInformation(a),h=l?Math.min(n,l.lods.length):0;r["DEBUG:LOD"]=n,ht.assignMeshLOD(r,h),l&&(t=Math.max(t,l.lods.length-1))}else if(r.isMaterial===!0){r["DEBUG:LOD"]=n,ht.assignTextureLOD(r,n);break}}}}),n>=t&&(n=-1)},n=-1,t=2,e=!1;window.addEventListener("keyup",s=>{s.key==="p"&&i(),s.key==="w"&&(e=!e,rx&&rx.forEach(r=>{r.name!="BackgroundCubeMaterial"&&r.glyphMap==null&&"wireframe"in r&&(r.wireframe=e)}))})}function dI(n,t,e){var s;if(!ti)return;rg.has(n)||rg.set(n,{keys:[],sourceId:e});const i=rg.get(n);((s=i==null?void 0:i.keys)==null?void 0:s.includes(t))==!1&&i.keys.push(t)}const sn=class{constructor(t,e){c(this,"parser");c(this,"url");c(this,"_isLoadingMesh");c(this,"loadMesh",t=>{var i,s;if(this._isLoadingMesh)return null;const e=(s=(i=this.parser.json.meshes[t])==null?void 0:i.extensions)==null?void 0:s[kl];return e?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",t).then(r=>{var o;return this._isLoadingMesh=!1,r&&sn.registerMesh(this.url,e.guid,r,(o=e.lods)==null?void 0:o.length,void 0,e),r})):null});ti&&console.log("Progressive extension registered for",e),this.parser=t,this.url=e}get name(){return kl}static getMeshLODInformation(t){const e=this.getAssignedLODInformation(t);return e!=null&&e.key?this.lodInfos.get(e.key):null}static getMaterialMinMaxLODsCount(t,e){const i=this,s="LODS:minmax",r=t[s];if(r!=null)return r;if(e||(e={min_count:1/0,max_count:0,lods:[]}),Array.isArray(t)){for(const a of t)this.getMaterialMinMaxLODsCount(a,e);return t[s]=e,e}if(ti==="verbose"&&console.log("getMaterialMinMaxLODsCount",t),t.type==="ShaderMaterial"||t.type==="RawShaderMaterial"){const a=t;for(const l of Object.keys(a.uniforms)){const h=a.uniforms[l].value;(h==null?void 0:h.isTexture)===!0&&o(h,e)}}else if(t.isMaterial)for(const a of Object.keys(t)){const l=t[a];(l==null?void 0:l.isTexture)===!0&&o(l,e)}return t[s]=e,e;function o(a,l){const h=i.getAssignedLODInformation(a);if(h){const u=i.lodInfos.get(h.key);if(u&&u.lods){l.min_count=Math.min(l.min_count,u.lods.length),l.max_count=Math.max(l.max_count,u.lods.length);for(let d=0;d<u.lods.length;d++){const f=u.lods[d];f.width&&(l.lods[d]=l.lods[d]||{min_height:1/0,max_height:0},l.lods[d].min_height=Math.min(l.lods[d].min_height,f.height),l.lods[d].max_height=Math.max(l.lods[d].max_height,f.height))}}}}}static hasLODLevelAvailable(t,e){var r;if(Array.isArray(t)){for(const o of t)if(this.hasLODLevelAvailable(o,e))return!0;return!1}if(t.isMaterial===!0){for(const o of Object.keys(t)){const a=t[o];if(a&&a.isTexture&&this.hasLODLevelAvailable(a,e))return!0}return!1}else if(t.isGroup===!0){for(const o of t.children)if(o.isMesh===!0&&this.hasLODLevelAvailable(o,e))return!0}let i,s;if(t.isMesh?i=t.geometry:(t.isBufferGeometry||t.isTexture)&&(i=t),i&&(r=i==null?void 0:i.userData)!=null&&r.LODS){const o=i.userData.LODS;if(s=this.lodInfos.get(o.key),e===void 0)return s!=null;if(s)return Array.isArray(s.lods)?e<s.lods.length:e===0}return!1}static assignMeshLOD(t,e){var i;if(!t)return Promise.resolve(null);if(t instanceof J||t.isMesh===!0){const s=t.geometry,r=this.getAssignedLODInformation(s);if(!r)return Promise.resolve(null);for(const o of Nc)(i=o.onBeforeGetLODMesh)==null||i.call(o,t,e);return t["LOD:requested level"]=e,sn.getOrLoadLOD(s,e).then(o=>{if(t["LOD:requested level"]===e){if(delete t["LOD:requested level"],Array.isArray(o)){const a=r.index||0;o=o[a]}o&&s!=o&&((o==null?void 0:o.isBufferGeometry)?(t.geometry=o,ti&&dI(t,"geometry",r.url)):ti&&console.error("Invalid LOD geometry",o))}return o}).catch(o=>(console.error("Error loading mesh LOD",t,o),null))}else ti&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",t);return Promise.resolve(null)}static assignTextureLOD(t,e=0){if(!t)return Promise.resolve(null);if(t.isMesh===!0){const i=t;if(Array.isArray(i.material)){const s=new Array;for(const r of i.material){const o=this.assignTextureLOD(r,e);s.push(o)}return Promise.all(s).then(r=>{const o=new Array;for(const a of r)Array.isArray(a)&&o.push(...a);return o})}else return this.assignTextureLOD(i.material,e)}if(t instanceof mt||t.isMaterial===!0){const i=t,s=[],r=new Array;if(ti&&rx.add(i),i.uniforms&&(i.isRawShaderMaterial||i.isShaderMaterial===!0)){const o=i;for(const a of Object.keys(o.uniforms)){const l=o.uniforms[a].value;if((l==null?void 0:l.isTexture)===!0){const h=this.assignTextureLODForSlot(l,e,i,a).then(u=>(u&&o.uniforms[a].value!=u&&(o.uniforms[a].value=u,o.uniformsNeedUpdate=!0),u));s.push(h),r.push(a)}}}else for(const o of Object.keys(i)){const a=i[o];if((a==null?void 0:a.isTexture)===!0){const l=this.assignTextureLODForSlot(a,e,i,o);s.push(l),r.push(o)}}return Promise.all(s).then(o=>{const a=new Array;for(let l=0;l<o.length;l++){const h=o[l],u=r[l];h&&h.isTexture===!0?a.push({material:i,slot:u,texture:h,level:e}):a.push({material:i,slot:u,texture:null,level:e})}return a})}if(t instanceof At||t.isTexture===!0){const i=t;return this.assignTextureLODForSlot(i,e,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(t,e,i,s){return(t==null?void 0:t.isTexture)!==!0?Promise.resolve(null):s==="glyphMap"?Promise.resolve(t):sn.getOrLoadLOD(t,e).then(r=>{if(Array.isArray(r))return null;if((r==null?void 0:r.isTexture)===!0){if(r!=t){if(i&&s){const o=i[s];if(o){const a=this.getAssignedLODInformation(o);if(a&&(a==null?void 0:a.level)<e)return ti==="verbose"&&console.warn("Assigned texture level is already higher: ",a.level,e,i,o,r),null}i[s]=r}if(ti&&s&&i){const o=this.getAssignedLODInformation(t);o&&dI(i,s,o.url)}}return r}else ti=="verbose"&&console.warn("No LOD found for",t,e);return null}).catch(r=>(console.error("Error loading LOD",t,r),null))}afterRoot(t){var e,i;return ti&&console.log("AFTER",this.url,t),(e=this.parser.json.textures)==null||e.forEach((s,r)=>{var o;if(s!=null&&s.extensions){const a=s==null?void 0:s.extensions[kl];if(a){if(!a.lods){ti&&console.warn("Texture has no LODs",a);return}let l=!1;for(const h of this.parser.associations.keys())if(h.isTexture===!0){const u=this.parser.associations.get(h);(u==null?void 0:u.textures)===r&&(l=!0,sn.registerTexture(this.url,h,(o=a.lods)==null?void 0:o.length,r,a))}l||this.parser.getDependency("texture",r).then(h=>{var u;h&&sn.registerTexture(this.url,h,(u=a.lods)==null?void 0:u.length,r,a)})}}}),(i=this.parser.json.meshes)==null||i.forEach((s,r)=>{if(s!=null&&s.extensions){const o=s==null?void 0:s.extensions[kl];if(o&&o.lods){for(const a of this.parser.associations.keys())if(a.isMesh){const l=this.parser.associations.get(a);(l==null?void 0:l.meshes)===r&&sn.registerMesh(this.url,o.guid,a,o.lods.length,l.primitives,o)}}}}),null}static async getOrLoadLOD(t,e){var a,l,h,u;const i=ti=="verbose",s=t.userData.LODS;if(!s)return null;const r=s==null?void 0:s.key;let o;if(t.isTexture===!0){const d=t;d.source&&d.source[l_]&&(o=d.source[l_])}if(o||(o=sn.lodInfos.get(r)),o){if(e>0){let p=!1;const g=Array.isArray(o.lods);if(g&&e>=o.lods.length?p=!0:g||(p=!0),p)return this.lowresCache.get(r)}const d=Array.isArray(o.lods)?(a=o.lods[e])==null?void 0:a.path:o.lods;if(!d)return ti&&!o["missing:uri"]&&(o["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+e,o)),null;const f=GG(s.url,d);if(f.endsWith(".glb")||f.endsWith(".gltf")){if(!o.guid)return console.warn("missing pointer for glb/gltf texture",o),null;const p=f+"_"+o.guid,g=this.previouslyLoaded.get(p);if(g!==void 0){i&&console.log(`LOD ${e} was already loading/loaded: ${p}`);let b=await g.catch(x=>(console.error(`Error loading LOD ${e} from ${f}
`,x),null)),_=!1;if(b==null||(b instanceof At&&t instanceof At?(l=b.image)!=null&&l.data||(h=b.source)!=null&&h.data?b=this.copySettings(t,b):(_=!0,this.previouslyLoaded.delete(p)):b instanceof Ht&&t instanceof Ht&&((u=b.attributes.position)!=null&&u.array||(_=!0,this.previouslyLoaded.delete(p)))),!_)return b}const m=o,v=new Promise(async(b,_)=>{const x=new rl;jG(x),ti&&(await new Promise(B=>setTimeout(B,1e3)),i&&console.warn("Start loading (delayed) "+f,m.guid));let S=f;if(m&&Array.isArray(m.lods)){const B=m.lods[e];B.hash&&(S+="?v="+B.hash)}const E=await x.loadAsync(S).catch(B=>(console.error(`Error loading LOD ${e} from ${f}
`,B),null));if(!E)return null;const M=E.parser;i&&console.log("Loading finished "+f,m.guid);let I=0;if(E.parser.json.textures){let B=!1;for(const R of E.parser.json.textures){if(R!=null&&R.extensions){const P=R==null?void 0:R.extensions[kl];if(P!=null&&P.guid&&P.guid===m.guid){B=!0;break}}I++}if(B){let R=await M.getDependency("texture",I);return R&&sn.assignLODInformation(s.url,R,r,e,void 0,void 0),i&&console.log('change "'+t.name+'" â†’ "'+R.name+'"',f,I,R,p),t instanceof At&&(R=this.copySettings(t,R)),R&&(R.guid=m.guid),b(R)}else ti&&console.warn("Could not find texture with guid",m.guid,E.parser.json)}if(I=0,E.parser.json.meshes){let B=!1;for(const R of E.parser.json.meshes){if(R!=null&&R.extensions){const P=R==null?void 0:R.extensions[kl];if(P!=null&&P.guid&&P.guid===m.guid){B=!0;break}}I++}if(B){const R=await M.getDependency("mesh",I),P=m;if(i&&console.log(`Loaded Mesh "${R.name}"`,f,I,R,p),R.isMesh===!0){const F=R.geometry;return sn.assignLODInformation(s.url,F,r,e,void 0,P.density),b(F)}else{const F=new Array;for(let j=0;j<R.children.length;j++){const V=R.children[j];if(V.isMesh===!0){const X=V.geometry;sn.assignLODInformation(s.url,X,r,e,j,P.density),F.push(X)}}return b(F)}}else ti&&console.warn("Could not find mesh with guid",m.guid,E.parser.json)}return b(null)});return this.previouslyLoaded.set(p,v),await v}else if(t instanceof At){i&&console.log("Load texture from uri: "+f);const g=await new Xa().loadAsync(f);return g?(g.guid=o.guid,g.flipY=!1,g.needsUpdate=!0,g.colorSpace=t.colorSpace,i&&console.log(o,g)):ti&&console.warn("failed loading",f),g}}else ti&&console.warn(`Can not load LOD ${e}: no LOD info found for "${r}" ${t.name}`,t.type);return null}static assignLODInformation(t,e,i,s,r,o){if(!e)return;e.userData||(e.userData={});const a=new qG(t,i,s,r,o);e.userData.LODS=a}static getAssignedLODInformation(t){var e;return((e=t==null?void 0:t.userData)==null?void 0:e.LODS)||null}static copySettings(t,e){return e=e.clone(),ti&&console.warn(`Copying texture settings
`,t.uuid,`
`,e.uuid),e.offset=t.offset,e.repeat=t.repeat,e.colorSpace=t.colorSpace,e.magFilter=t.magFilter,e.minFilter=t.minFilter,e.wrapS=t.wrapS,e.wrapT=t.wrapT,e.flipY=t.flipY,e.anisotropy=t.anisotropy,e.mipmaps||(e.generateMipmaps=t.generateMipmaps),e}};let ht=sn;c(ht,"registerTexture",(t,e,i,s,r)=>{if(ti&&console.log("> Progressive: register texture",s,e.name,e.uuid,e,r),!e){ti&&console.error("gltf-progressive: Register texture without texture");return}e.source&&(e.source[l_]=r);const o=r.guid;sn.assignLODInformation(t,e,o,i,s,void 0),sn.lodInfos.set(o,r),sn.lowresCache.set(o,e)}),c(ht,"registerMesh",(t,e,i,s,r,o)=>{var h;ti&&console.log("> Progressive: register mesh",r,i.name,o,i.uuid,i);const a=i.geometry;if(!a){ti&&console.warn("gltf-progressive: Register mesh without geometry");return}a.userData||(a.userData={}),sn.assignLODInformation(t,a,e,s,r,o.density),sn.lodInfos.set(e,o);let l=sn.lowresCache.get(e);l?l.push(i.geometry):l=[i.geometry],sn.lowresCache.set(e,l),s>0&&!Sm(i)&&VG(i,a);for(const u of Nc)(h=u.onRegisteredNewMesh)==null||h.call(u,i,o)}),c(ht,"lodInfos",new Map),c(ht,"previouslyLoaded",new Map),c(ht,"lowresCache",new Map);class qG{constructor(t,e,i,s,r){c(this,"url");c(this,"key");c(this,"level");c(this,"index");c(this,"density");this.url=t,this.key=e,this.level=i,s!=null&&(this.index=s),r!=null&&(this.density=r)}}const ko=Cm("debugprogressive"),XG=Cm("noprogressive"),c_=Symbol("Needle:LODSManager"),h_=Symbol("Needle:LODState"),ld=Symbol("Needle:CurrentLOD"),Do={mesh_lod:-1,texture_lod:-1};var Ui,Tr,Dl,qy,bf,_f,Xy,Ol;let Yh=(Ui=class{constructor(t,e){c(this,"context");c(this,"renderer");c(this,"projectionScreenMatrix",new ae);c(this,"targetTriangleDensity",2e5);c(this,"updateInterval","auto");Qi(this,Tr,1);c(this,"pause",!1);c(this,"manual",!1);c(this,"_lodchangedlisteners",[]);Qi(this,Dl,void 0);Qi(this,qy,new kP);Qi(this,bf,0);Qi(this,_f,0);Qi(this,Xy,0);Qi(this,Ol,0);c(this,"_fpsBuffer",[60,60,60,60,60]);c(this,"_sphere",new uc);c(this,"_tempBox",new xn);c(this,"_tempBox2",new xn);c(this,"tempMatrix",new ae);c(this,"_tempWorldPosition",new w);c(this,"_tempBoxSize",new w);c(this,"_tempBox2Size",new w);this.renderer=t,this.context={...e}}static getObjectLODState(t){return t[h_]}static addPlugin(t){Nc.push(t)}static removePlugin(t){const e=Nc.indexOf(t);e>=0&&Nc.splice(e,1)}static get(t,e){if(t[c_])return console.debug("[gltf-progressive] LODsManager already exists for this renderer"),t[c_];const i=new Ui(t,{engine:"unknown",...e});return t[c_]=i,i}get plugins(){return Nc}addEventListener(t,e){t==="changed"&&this._lodchangedlisteners.push(e)}removeEventListener(t,e){if(t==="changed"){const i=this._lodchangedlisteners.indexOf(e);i>=0&&this._lodchangedlisteners.splice(i,1)}}enable(){if(ke(this,Dl))return;console.debug("[gltf-progressive] Enabling LODsManager for renderer");let t=0;ji(this,Dl,this.renderer.render);const e=this;xS(this.renderer),this.renderer.render=function(i,s){const r=e.renderer.getRenderTarget();(r==null||"isXRRenderTarget"in r&&r.isXRRenderTarget)&&(t=0,ji(e,bf,ke(e,bf)+1),ji(e,_f,ke(e,qy).getDelta()),ji(e,Xy,ke(e,Xy)+ke(e,_f)),e._fpsBuffer.shift(),e._fpsBuffer.push(1/ke(e,_f)),ji(e,Ol,e._fpsBuffer.reduce((a,l)=>a+l)/e._fpsBuffer.length),ko&&ke(e,bf)%200===0&&console.log("FPS",Math.round(ke(e,Ol)),"Interval:",ke(e,Tr)));const o=t++;ke(e,Dl).call(this,i,s),e.onAfterRender(i,s,o)}}disable(){ke(this,Dl)&&(this.renderer.render=ke(this,Dl),ji(this,Dl,void 0))}update(t,e){this.internalUpdate(t,e)}onAfterRender(t,e,i){if(this.pause)return;const r=this.renderer.renderLists.get(t,0).opaque;let o=!0;if(r.length===1){const a=r[0].material;(a.name==="EffectMaterial"||a.name==="CopyShader")&&(o=!1)}if((e.parent&&e.parent.type==="CubeCamera"||i>=1&&e.type==="OrthographicCamera")&&(o=!1),o){if(XG||(this.updateInterval==="auto"?ke(this,Ol)<40&&ke(this,Tr)<10?(ji(this,Tr,ke(this,Tr)+1),ko&&console.warn("â†“ Reducing LOD updates",ke(this,Tr),ke(this,Ol).toFixed(0))):ke(this,Ol)>=60&&ke(this,Tr)>1&&(ji(this,Tr,ke(this,Tr)-1),ko&&console.warn("â†‘ Increasing LOD updates",ke(this,Tr),ke(this,Ol).toFixed(0))):ji(this,Tr,this.updateInterval),ke(this,Tr)>0&&ke(this,bf)%ke(this,Tr)!=0))return;this.internalUpdate(t,e)}}internalUpdate(t,e){var l,h;const i=this.renderer.renderLists.get(t,0),s=i.opaque;this.projectionScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);const r=this.targetTriangleDensity;for(const u of s){if(u.material&&(((l=u.geometry)==null?void 0:l.type)==="BoxGeometry"||((h=u.geometry)==null?void 0:h.type)==="BufferGeometry")&&(u.material.name==="SphericalGaussianBlur"||u.material.name=="BackgroundCubeMaterial"||u.material.name==="CubemapFromEquirect"||u.material.name==="EquirectangularToCubeUV")){ko&&(u.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(u.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",u,u.material.name,u.material.type)));continue}switch(u.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}if(ko==="color"&&u.material&&!u.object.progressive_debug_color){u.object.progressive_debug_color=!0;const f=Math.random()*16777215,p=new Kn({color:f});u.object.material=p}const d=u.object;(d instanceof J||d.isMesh)&&this.updateLODs(t,e,d,r)}const o=i.transparent;for(const u of o){const d=u.object;(d instanceof J||d.isMesh)&&this.updateLODs(t,e,d,r)}const a=i.transmissive;for(const u of a){const d=u.object;(d instanceof J||d.isMesh)&&this.updateLODs(t,e,d,r)}}updateLODs(t,e,i,s){var a,l;i.userData||(i.userData={});let r=i[h_];if(r||(r=new YG,i[h_]=r),r.frames++<2)return;for(const h of Nc)(a=h.onBeforeUpdateLOD)==null||a.call(h,this.renderer,t,e,i);this.calculateLodLevel(e,i,r,s,Do),Do.mesh_lod=Math.round(Do.mesh_lod),Do.texture_lod=Math.round(Do.texture_lod),Do.mesh_lod>=0&&this.loadProgressiveMeshes(i,Do.mesh_lod);let o=Do.texture_lod;if(i.material&&o>=0){const h=i["DEBUG:LOD"];h!=null&&(o=h),this.loadProgressiveTextures(i.material,o)}for(const h of Nc)(l=h.onAfterUpdatedLOD)==null||l.call(h,this.renderer,t,e,i,Do);r.lastLodLevel_Mesh=Do.mesh_lod,r.lastLodLevel_Texture=Do.texture_lod}loadProgressiveTextures(t,e){if(!t)return;if(Array.isArray(t)){for(const s of t)this.loadProgressiveTextures(s,e);return}let i=!1;(t[ld]===void 0||e<t[ld])&&(i=!0),i&&(t[ld]=e,ht.assignTextureLOD(t,e).then(s=>{this._lodchangedlisteners.forEach(r=>r({type:"texture",level:e,object:t}))}))}loadProgressiveMeshes(t,e){if(!t)return Promise.resolve(null);if(t[ld]!==e){t[ld]=e;const i=t.geometry;return ht.assignMeshLOD(t,e).then(s=>(s&&t[ld]==e&&i!=t.geometry&&this._lodchangedlisteners.forEach(r=>r({type:"mesh",level:e,object:t})),s))}return Promise.resolve(null)}static isInside(t,e){const i=t.min,s=t.max,r=(i.x+s.x)*.5,o=(i.y+s.y)*.5;return this._tempPtInside.set(r,o,i.z).applyMatrix4(e).z<0}calculateLodLevel(t,e,i,s,r){var v;if(!e){r.mesh_lod=-1,r.texture_lod=-1;return}if(!t){r.mesh_lod=-1,r.texture_lod=-1;return}let a=10+1,l=!1;if(ko&&e["DEBUG:LOD"]!=null)return e["DEBUG:LOD"];const h=ht.getMeshLODInformation(e.geometry),u=h==null?void 0:h.lods,d=u&&u.length>0,f=ht.getMaterialMinMaxLODsCount(e.material),p=(f==null?void 0:f.min_count)!=1/0&&f.min_count>0&&f.max_count>0;if(!d&&!p){r.mesh_lod=0,r.texture_lod=0;return}d||(l=!0,a=0);const g=this.renderer.domElement.clientHeight||this.renderer.domElement.height;let m=e.geometry.boundingBox;if(e.type==="SkinnedMesh"){const y=e;if(!y.boundingBox)y.computeBoundingBox();else if(i.frames%30===0){const b=Sm(y),_=y.geometry;b&&(y.geometry=b),y.computeBoundingBox(),y.geometry=_}m=y.boundingBox}if(m&&t.isPerspectiveCamera){const y=t;if(e.geometry.attributes.color&&e.geometry.attributes.color.count<100&&e.geometry.boundingSphere){this._sphere.copy(e.geometry.boundingSphere),this._sphere.applyMatrix4(e.matrixWorld);const R=t.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(R)){r.mesh_lod=0,r.texture_lod=0;return}}if(this._tempBox.copy(m),this._tempBox.applyMatrix4(e.matrixWorld),Ui.isInside(this._tempBox,this.projectionScreenMatrix)){r.mesh_lod=0,r.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&y.fov>70){const R=this._tempBox.min,P=this._tempBox.max;let F=R.x,j=R.y,V=P.x,X=P.y;const k=2,O=1.5,H=(R.x+P.x)*.5,ee=(R.y+P.y)*.5;F=(F-H)*k+H,j=(j-ee)*k+ee,V=(V-H)*k+H,X=(X-ee)*k+ee;const Y=F<0&&V>0?0:Math.min(Math.abs(R.x),Math.abs(P.x)),he=j<0&&X>0?0:Math.min(Math.abs(R.y),Math.abs(P.y)),ue=Math.max(Y,he);i.lastCentrality=(O-ue)*(O-ue)*(O-ue)}else i.lastCentrality=1;const b=this._tempBox.getSize(this._tempBoxSize);b.multiplyScalar(.5),screen.availHeight>0&&g>0&&b.multiplyScalar(g/screen.availHeight),b.x*=y.aspect;const _=t.matrixWorldInverse,x=this._tempBox2;x.copy(m),x.applyMatrix4(e.matrixWorld),x.applyMatrix4(_);const S=x.getSize(this._tempBox2Size),E=Math.max(S.x,S.y);if(Math.max(b.x,b.y)!=0&&E!=0&&(b.z=S.z/Math.max(S.x,S.y)*Math.max(b.x,b.y)),i.lastScreenCoverage=Math.max(b.x,b.y,b.z),i.lastScreenspaceVolume.copy(b),i.lastScreenCoverage*=i.lastCentrality,ko&&Ui.debugDrawLine){const R=this.tempMatrix.copy(this.projectionScreenMatrix);R.invert();const P=Ui.corner0,F=Ui.corner1,j=Ui.corner2,V=Ui.corner3;P.copy(this._tempBox.min),F.copy(this._tempBox.max),F.x=P.x,j.copy(this._tempBox.max),j.y=P.y,V.copy(this._tempBox.max);const X=(P.z+V.z)*.5;P.z=F.z=j.z=V.z=X,P.applyMatrix4(R),F.applyMatrix4(R),j.applyMatrix4(R),V.applyMatrix4(R),Ui.debugDrawLine(P,F,255),Ui.debugDrawLine(P,j,255),Ui.debugDrawLine(F,V,255),Ui.debugDrawLine(j,V,255)}let I=999;if(u&&i.lastScreenCoverage>0){for(let R=0;R<u.length;R++)if(u[R].density/i.lastScreenCoverage<s){I=R;break}}I<a&&(a=I,l=!0)}if(l?r.mesh_lod=a:r.mesh_lod=i.lastLodLevel_Mesh,ko&&r.mesh_lod!=i.lastLodLevel_Mesh){const b=u==null?void 0:u[r.mesh_lod];b&&console.log(`Mesh LOD changed: ${i.lastLodLevel_Mesh} â†’ ${r.mesh_lod} (${b.density.toFixed(0)}) - ${e.name}`)}if(p){const y="saveData"in globalThis.navigator&&globalThis.navigator.saveData===!0;if(i.lastLodLevel_Texture<0){if(r.texture_lod=f.max_count-1,ko){const b=f.lods[f.max_count-1];ko&&console.log(`First Texture LOD ${r.texture_lod} (${b.max_height}px) - ${e.name}`)}}else{const b=i.lastScreenspaceVolume.x+i.lastScreenspaceVolume.y+i.lastScreenspaceVolume.z;let _=i.lastScreenCoverage*2;((v=this.context)==null?void 0:v.engine)==="model-viewer"&&(_*=2);const S=g/window.devicePixelRatio*_;for(let E=f.lods.length-1;E>=0;E--){let M=f.lods[E];if(!(y&&M.max_height>=2048)&&!(HG()&&M.max_height>4096)&&M.max_height>S){if(r.texture_lod=E,r.texture_lod<i.lastLodLevel_Texture){const I=M.max_height;ko&&console.log(`Texture LOD changed: ${i.lastLodLevel_Texture} â†’ ${r.texture_lod} = ${I}px 
Screensize: ${S.toFixed(0)}px, Coverage: ${(100*i.lastScreenCoverage).toFixed(2)}%, Volume ${b.toFixed(1)} 
${e.name}`)}break}}}}else r.texture_lod=0}},Tr=new WeakMap,Dl=new WeakMap,qy=new WeakMap,bf=new WeakMap,_f=new WeakMap,Xy=new WeakMap,Ol=new WeakMap,c(Ui,"debugDrawLine"),c(Ui,"corner0",new w),c(Ui,"corner1",new w),c(Ui,"corner2",new w),c(Ui,"corner3",new w),c(Ui,"_tempPtInside",new w),Ui);class YG{constructor(){c(this,"frames",0);c(this,"lastLodLevel_Mesh",-1);c(this,"lastLodLevel_Texture",-1);c(this,"lastScreenCoverage",0);c(this,"lastScreenspaceVolume",new w);c(this,"lastCentrality",0)}}const fI=Symbol("NEEDLE_mesh_lod"),AA=Symbol("NEEDLE_texture_lod");let pp=null;function Qk(){const n=KG();n&&(n.mapURLs(function(t){return pI(),t}),pI(),pp==null||pp.disconnect(),pp=new MutationObserver(t=>{t.forEach(e=>{e.addedNodes.forEach(i=>{i instanceof HTMLElement&&i.tagName.toLowerCase()==="model-viewer"&&jk(i)})})}),pp.observe(document,{childList:!0,subtree:!0}))}function KG(){if(typeof customElements>"u")return null;const n=customElements.get("model-viewer");return n||(customElements.whenDefined("model-viewer").then(()=>{console.debug("[gltf-progressive] model-viewer defined"),Qk()}),null)}function pI(){if(typeof document>"u")return;document.querySelectorAll("model-viewer").forEach(t=>{jk(t)})}const gI=new WeakSet;let JG=0;function jk(n){if(!n||gI.has(n))return null;gI.add(n),console.debug("[gltf-progressive] found new model-viewer..."+ ++JG+`
`,n.getAttribute("src"));let t=null,e=null,i=null;for(let s=n;s!=null;s=Object.getPrototypeOf(s)){const r=Object.getOwnPropertySymbols(s),o=r.find(h=>h.toString()=="Symbol(renderer)"),a=r.find(h=>h.toString()=="Symbol(scene)"),l=r.find(h=>h.toString()=="Symbol(needsRender)");!t&&o!=null&&(t=n[o].threeRenderer),!e&&a!=null&&(e=n[a]),!i&&l!=null&&(i=n[l])}if(t&&e){let r=function(){if(i){let o=0,a=setInterval(()=>{if(o++>5){clearInterval(a);return}i==null||i.call(n)},300)}};console.debug("[gltf-progressive] setup model-viewer");const s=Yh.get(t,{engine:"model-viewer"});return Yh.addPlugin(new ZG),s.enable(),s.addEventListener("changed",()=>{i==null||i.call(n)}),n.addEventListener("model-visibility",o=>{o.detail.visible&&(i==null||i.call(n))}),n.addEventListener("load",()=>{r()}),()=>{s.disable()}}return null}class ZG{constructor(){c(this,"_didWarnAboutMissingUrl",!1)}onBeforeUpdateLOD(t,e,i,s){this.tryParseMeshLOD(e,s),this.tryParseTextureLOD(e,s)}getUrl(t){if(!t)return null;let e=t.getAttribute("src");return e||(e=t.src),e||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",t),this._didWarnAboutMissingUrl=!0),e}tryGetCurrentGLTF(t){return t._currentGLTF}tryGetCurrentModelViewer(t){return t.element}tryParseTextureLOD(t,e){if(e[AA]==!0)return;e[AA]=!0;const i=this.tryGetCurrentGLTF(t),s=this.tryGetCurrentModelViewer(t),r=this.getUrl(s);if(r&&i&&e.material){let a=function(l){var u,d,f;if(l[AA]==!0)return;l[AA]=!0,l.userData&&(l.userData.LOD=-1);const h=Object.keys(l);for(let p=0;p<h.length;p++){const g=h[p],m=l[g];if((m==null?void 0:m.isTexture)===!0){const v=(d=(u=m.userData)==null?void 0:u.associations)==null?void 0:d.textures;if(v==null)continue;const y=i.parser.json.textures[v];if(!y){console.warn("Texture data not found for texture index "+v);continue}if((f=y==null?void 0:y.extensions)!=null&&f[kl]){const b=y.extensions[kl];b&&r&&ht.registerTexture(r,m,b.lods.length,v,b)}}}};const o=e.material;if(Array.isArray(o))for(const l of o)a(l);else a(o)}}tryParseMeshLOD(t,e){var o,a;if(e[fI]==!0)return;e[fI]=!0;const i=this.tryGetCurrentModelViewer(t),s=this.getUrl(i);if(!s)return;const r=(a=(o=e.userData)==null?void 0:o.gltfExtensions)==null?void 0:a[kl];if(r&&s){const l=e.uuid;ht.registerMesh(s,l,e,0,r.lods.length,r)}}}Qk();const Rf=[];function CS(n){Rf.indexOf(n)===-1&&Rf.push(n)}function LK(n){const t=Rf.indexOf(n);t!==-1&&Rf.splice(t,1)}const Bf=[];function Gk(n){Bf.indexOf(n)===-1&&Bf.push(n)}function FK(n){const t=Bf.indexOf(n);t!==-1&&Bf.splice(t,1)}function $G(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:n}));for(let t=0;t<Rf.length;t++)Rf[t](n)}function e8(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:n}));for(let t=0;t<Bf.length;t++)Bf[t](n)}const vn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Hk(n){const t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function t8(n){if(!n)throw new Error("No basePath supplied");return await Hk(`${n}/profilesList.json`)}async function i8(n,t,e=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const s=await t8(t);let r;if(n.profiles.some(l=>{const h=s[l];return h&&(r={profileId:l,profilePath:`${t}/${h.path}`,deprecated:!!h.deprecated}),!!r}),!r){if(!e)throw new Error("No matching profile name found");const l=s[e];if(!l)throw new Error(`No matching profile name found and default profile "${e}" missing.`);r={profileId:e,profilePath:`${t}/${l.path}`,deprecated:!!l.deprecated}}const o=await Hk(r.profilePath);let a;if(i){let l;if(n.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const n8={xAxis:0,yAxis:0,button:0,state:vn.ComponentState.DEFAULT};function s8(n=0,t=0){let e=n,i=t;if(Math.sqrt(n*n+t*t)>1){const o=Math.atan2(t,n);e=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:i*.5+.5}}let r8=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===vn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(n8)}updateFromComponent({xAxis:t,yAxis:e,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=s8(t,e);switch(this.componentProperty){case vn.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case vn.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case vn.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case vn.ComponentProperty.STATE:this.valueNodeProperty===vn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},o8=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(i=>{const s=new r8(e.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:vn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=vn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){const e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=vn.ComponentState.PRESSED:(e.touched||this.values.button>vn.ButtonTouchThreshold)&&(this.values.state=vn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===vn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>vn.AxisTouchThreshold&&(this.values.state=vn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===vn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>vn.AxisTouchThreshold&&(this.values.state=vn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},a8=class{constructor(t,e,i){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=i,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new o8(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};const tn=z("debuginput");var Kc;(function(n){n.Mouse="mouse",n.Touch="touch",n.Controller="controller",n.Hand="hand"})(Kc||(Kc={}));var mI;(function(n){n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove"})(mI||(mI={}));var AI;(function(n){n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress"})(AI||(AI={}));var ft;(function(n){n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove",n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress"})(ft||(ft={}));class Oc extends PointerEvent{constructor(e,i,s){super(e,s);c(this,"clientZ");c(this,"deviceIndex");c(this,"origin");c(this,"source");c(this,"mode");c(this,"_ray");c(this,"space");c(this,"isClick",!1);c(this,"isDoubleClick",!1);c(this,"_used",!1);c(this,"_pointerid");c(this,"_pointerType");c(this,"_type");c(this,"metadata",{});c(this,"intersections",new Array);c(this,"_immediatePropagationStopped",!1);c(this,"_propagationStopped",!1);this.clientZ=s.clientZ,this._pointerid=s.pointerId,this._pointerType=s.pointerType,this._type=e,this.deviceIndex=s.deviceIndex,this.origin=s.origin,this.source=i,this.mode=s.mode,this._ray=s.ray,this.space=s.device}get isSpatial(){return this.mode!="screen"}get ray(){return this._ray||(this._ray=new mh(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(e){this._ray=e}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var e;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}stopPropagation(){var e;this._propagationStopped=!0,super.stopPropagation(),(e=this.source)==null||e.stopPropagation(),tn&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class vA extends KeyboardEvent{constructor(e,i,s){super(e,s);c(this,"source");this.source=i}stopImmediatePropagation(){var e;super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}}class QK{constructor(t){c(this,"key");c(this,"keyType");c(this,"source");this.key=t.key,this.keyType=t.type,this.source=t}}var Br;(function(n){n[n.Early=-100]="Early",n[n.Default=0]="Default",n[n.Late=100]="Late"})(Br||(Br={}));class l8{constructor(t){c(this,"_eventListeners",{});c(this,"_doubleClickTimeThreshold",.2);c(this,"_longPressTimeThreshold",1);c(this,"_specialCursorTrigger",0);c(this,"context");c(this,"_pointerDown",[!1]);c(this,"_pointerUp",[!1]);c(this,"_pointerClick",[!1]);c(this,"_pointerDoubleClick",[!1]);c(this,"_pointerPressed",[!1]);c(this,"_pointerPositions",[new oe]);c(this,"_pointerPositionsLastFrame",[new oe]);c(this,"_pointerPositionsDelta",[new oe]);c(this,"_pointerPositionsRC",[new oe]);c(this,"_pointerPositionDown",[new w]);c(this,"_pointerDownTime",[]);c(this,"_pointerUpTime",[]);c(this,"_pointerUpTimestamp",[]);c(this,"_pointerIds",[]);c(this,"_pointerTypes",[""]);c(this,"_mouseWheelChanged",[!1]);c(this,"_mouseWheelDeltaY",[0]);c(this,"_pointerEvent",[]);c(this,"_pointerEventsPressed",[]);c(this,"_pointerSpace",[]);c(this,"_pressedStack",new Map);c(this,"_htmlEventSource");c(this,"onLostFocus",()=>{for(const t in this.keysPressed)this.keysPressed[t].pressed=!1});c(this,"onEndOfFrame",()=>{for(let t=0;t<this._pointerUp.length;t++)this._pointerUp[t]=!1;for(let t=0;t<this._pointerDown.length;t++)this._pointerDown[t]=!1;for(let t=0;t<this._pointerClick.length;t++)this._pointerClick[t]=!1;for(let t=0;t<this._pointerDoubleClick.length;t++)this._pointerDoubleClick[t]=!1;for(const t of this._pointerPositionsDelta)t.set(0,0);for(let t=0;t<this._mouseWheelChanged.length;t++)this._mouseWheelChanged[t]=!1;for(let t=0;t<this._mouseWheelDeltaY.length;t++)this._mouseWheelDeltaY[t]=0});c(this,"onContextMenu",t=>{this.canReceiveInput(t)!==!1&&t instanceof PointerEvent&&t.pointerType});c(this,"keysPressed",{});c(this,"onKeyDown",t=>{if(tn&&console.log(`key down ${t.code}, ${this.context.application.hasFocus}`,t),!this.context.application.hasFocus)return;const e=this.keysPressed[t.code];if(e&&e.pressed)return;this.keysPressed[t.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:t.key,code:t.code};const i=new vA(ft.KeyDown,t,t);this.onDispatchEvent(i)});c(this,"onKeyPressed",t=>{if(!this.context.application.hasFocus)return;const e=this.keysPressed[t.code];if(!e)return;e.pressed=!0,e.frame=this.context.time.frameCount+1;const i=new vA(ft.KeyPressed,t,t);this.onDispatchEvent(i)});c(this,"onKeyUp",t=>{if(!this.context.application.hasFocus)return;const e=this.keysPressed[t.code];if(!e)return;e.pressed=!1,e.frame=this.context.time.frameCount+1;const i=new vA(ft.KeyUp,t,t);this.onDispatchEvent(i)});c(this,"onWheelWindow",t=>{document.pointerLockElement&&this.onMouseWheel(t)});c(this,"onMouseWheel",t=>{if(this.canReceiveInput(t)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const e=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=e+t.deltaY});c(this,"onPointerDown",t=>{if(this.context.isInAR||this.canReceiveInput(t)===!1)return;t.target instanceof HTMLElement&&t.target.setPointerCapture(t.pointerId);const e=this.getPointerId(t);tn&&bi(`pointer down #${e}, identifier:${t.pointerId}`);const i=this.getAndUpdateSpatialObjectForScreenPosition(e,t.clientX,t.clientY),s=new Oc(ft.PointerDown,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:e,button:t.button,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,buttonName:this.getButtonName(t),device:i,pressure:t.pressure});this.onDown(s)});c(this,"onPointerMove",t=>{if(this.context.isInAR)return;let e=t.button;t.pointerType==="mouse"&&(e=this.getFirstPressedButtonForPointer(0)??0);const i=this.getPointerId(t,e);e===-1&&(e=i);const s=this.getAndUpdateSpatialObjectForScreenPosition(i,t.clientX,t.clientY),r=new Oc(ft.PointerMove,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:i,button:e,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,buttonName:this.getButtonName(t),device:s,pressure:t.pressure});this.onMove(r)});c(this,"onPointerCancel",t=>{this.context.isInAR||(tn&&console.log("Pointer cancel",t),this.onPointerUp(t))});c(this,"onPointerUp",t=>{if(this.context.isInAR)return;t.target instanceof HTMLElement&&t.target.releasePointerCapture(t.pointerId);const e=this.getPointerId(t),i=new Oc(ft.PointerUp,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:e,button:t.button,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,buttonName:this.getButtonName(t),device:this.getAndUpdateSpatialObjectForScreenPosition(e,t.clientX,t.clientY),pressure:t.pressure});this.onUp(i),this._pointerIds[e]=-1,tn&&console.log("ID="+e,"PointerId="+t.pointerId,"ALL:",[...this._pointerIds])});c(this,"onTouchStart",t=>{if(this.context.isInAR)for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e],s=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),o=new Oc(ft.PointerDown,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onDown(o)}});c(this,"onTouchMove",t=>{if(this.context.isInAR)for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e],s=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),o=new Oc(ft.PointerMove,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onMove(o)}});c(this,"onTouchEnd",t=>{if(this.context.isInAR)for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e],s=this.getPointerIndex(i.identifier),r=new Oc(ft.PointerUp,t,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),pressure:i.force});this.onUp(r),this._pointerIds[s]=-1}});c(this,"tempNearPlaneVector",new w);c(this,"tempFarPlaneVector",new w);c(this,"tempLookMatrix",new ae);this.context=t,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(t,e,i){if(this._eventListeners[t]||(this._eventListeners[t]=[]),!e||typeof e!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}i?i={...i}:i={};let s=0;(i==null?void 0:i.queue)!=null&&(s=i.queue);const r=this._eventListeners[t],o=r.find(a=>a.priority===s);o?o.listeners.push({callback:e,options:i}):(r.push({priority:s,listeners:[{callback:e,options:i}]}),r.sort((a,l)=>a.priority-l.priority))}removeEventListener(t,e,i){if(!this._eventListeners[t]||!e)return;const s=this._eventListeners[t];if((i==null?void 0:i.queue)!=null){const r=s.find(a=>a.priority===i.queue);if(!r)return;const o=r.listeners.findIndex(a=>a.callback===e);o>=0&&r.listeners.splice(o,1)}else for(const r of s){const o=r.listeners.findIndex(a=>a.callback===e);o>=0&&r.listeners.splice(o,1)}}dispatchEvent(t){var i,s,r,o;let e=!1;if(t instanceof vA){const a=this._eventListeners[t.type];if(a)for(const l of a)for(let h=0;h<l.listeners.length;h++){const u=l.listeners[h];if((s=(i=u.options)==null?void 0:i.signal)!=null&&s.aborted){l.listeners.splice(h,1),h--;continue}u.options.once&&(l.listeners.splice(h,1),h--),u.callback(t)}}if(t instanceof Oc){const a=this._eventListeners[t.type];if(a)for(const l of a){if(e)break;for(let h=0;h<l.listeners.length;h++){const u=l.listeners[h];if((o=(r=u.options)==null?void 0:r.signal)!=null&&o.aborted){l.listeners.splice(h,1),h--;continue}if(t.immediatePropagationStopped){e=!0,tn&&console.log("immediatePropagationStopped",t.type);break}else t.propagationStopped&&(e=!0,tn&&console.log("propagationStopped",t.type));u.options.once&&(l.listeners.splice(h,1),h--),u.callback(t)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getIsPointerIdInUse(t){for(const e of this._pointerEventsPressed)if(e.pointerId===t&&e.used)return!0;return!1}getPointerPressedCount(){let t=0;for(let e=0;e<this._pointerPressed.length;e++)this._pointerPressed[e]&&t++;return t}getPointerPosition(t){return t>=this._pointerPositions.length?null:this._pointerPositions[t]}getPointerPositionLastFrame(t){return t>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[t]}getPointerPositionDelta(t){return t>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[t]}getPointerPositionRC(t){return t>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[t]}getPointerDown(t){return t>=this._pointerDown.length?!1:this._pointerDown[t]}getPointerUp(t){return t>=this._pointerUp.length?!1:this._pointerUp[t]}getPointerPressed(t){return t>=this._pointerPressed.length?!1:this._pointerPressed[t]}getPointerClicked(t){return t>=this._pointerClick.length?!1:this._pointerClick[t]}getPointerDoubleClicked(t){return t>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[t]}getPointerDownTime(t){return t>=this._pointerDownTime.length?-1:this._pointerDownTime[t]}getPointerUpTime(t){return t>=this._pointerUpTime.length?-1:this._pointerUpTime[t]}getPointerLongPress(t){return t>=this._pointerDownTime.length?!1:this.getPointerPressed(t)&&this.context.time.time-this._pointerDownTime[t]>this._longPressTimeThreshold}getIsMouse(t){return t<0||t>=this._pointerTypes.length?!1:this._pointerTypes[t]===Kc.Mouse}getIsTouch(t){return t<0||t>=this._pointerTypes.length?!1:this._pointerTypes[t]===Kc.Touch}getTouchesPressedCount(){let t=0;for(let e=0;e<this._pointerPressed.length;e++)this._pointerPressed[e]&&this.getIsTouch(e)&&t++;return t}getMouseWheelChanged(t=0){return t>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[t]}getMouseWheelDeltaY(t=0){return t>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[t]}getPointerEvent(t){if(!(t>=this._pointerEvent.length))return this._pointerEvent[t]??void 0}*foreachPointerId(t){for(let e=0;e<this._pointerTypes.length;e++)if(this._pointerIsActive(e)){if(t!==void 0){const i=this._pointerTypes[e];if(Array.isArray(t)){let s=!1;for(const r of t)if(i===r){s=!0;break}if(!s)continue}else if(t!==i)continue}yield e}}*foreachTouchId(){for(let t=0;t<this._pointerTypes.length;t++)this._pointerTypes[t]===Kc.Touch&&this._pointerIsActive[t]&&(yield t)}_pointerIsActive(t){return t<0?!1:this._pointerPressed[t]||this._pointerDown[t]||this._pointerUp[t]}onDownButton(t,e){let i=this._pressedStack.get(t);i||(i=[],this._pressedStack.set(t,i)),i.push(e)}onReleaseButton(t,e){const i=this._pressedStack.get(t);if(!i)return;const s=i.indexOf(e);s>=0&&i.splice(s,1)}getFirstPressedButtonForPointer(t){const e=this._pressedStack.get(t);if(e)return e[0]}getLatestPressedButtonForPointer(t){const e=this._pressedStack.get(t);if(e)return e[e.length-1]}getKeyDown(){for(const t in this.keysPressed){const e=this.keysPressed[t];if(e.startFrame===this.context.time.frameCount)return e.key}return null}getKeyPressed(){for(const t in this.keysPressed){const e=this.keysPressed[t];if(e.pressed)return e.key}return null}isKeyDown(t){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const e=this.getCodeForCommonKeyName(t);if(e!==null){for(const s of e)if(this.isKeyDown(s))return!0;return!1}return((i=this.keysPressed[t])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[t].pressed}isKeyUp(t){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const e=this.getCodeForCommonKeyName(t);if(e!==null){for(const s of e)if(this.isKeyUp(s))return!0;return!1}return((i=this.keysPressed[t])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[t].pressed}isKeyPressed(t){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const e=this.getCodeForCommonKeyName(t);if(e!==null){for(const s of e)if(this.isKeyPressed(s))return!0;return!1}return(i=this.keysPressed[t])==null?void 0:i.pressed}getCodeForCommonKeyName(t){if(t.length===1){if(t>="0"&&t<="9")return["Digit"+t];if(t>="a"&&t<="z")return["Key"+t.toUpperCase()];if(t==" ")return["Space"]}switch(t){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(t){switch(t.type){case ft.PointerDown:tn&&bi("Create Pointer down"),this.onDownButton(t.deviceIndex,t.button),this.onDown(t);break;case ft.PointerMove:tn&&bi("Create Pointer move"),this.onMove(t);break;case ft.PointerUp:tn&&bi("Create Pointer up"),this.onUp(t),this.onReleaseButton(t.deviceIndex,t.button);break}}convertScreenspaceToRaycastSpace(t){return t.x=(t.x-this.context.domX)/this.context.domWidth*2-1,t.y=-((t.y-this.context.domY)/this.context.domHeight)*2+1,t}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var t,e;window.removeEventListener("contextmenu",this.onContextMenu),(t=this._htmlEventSource)==null||t.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(e=this._htmlEventSource)==null||e.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const t=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);t>=0&&this.context.post_render_callbacks.splice(t,1),this.unbindEvents()}canReceiveInput(t){var e;return t.target===((e=this.context.renderer)==null?void 0:e.domElement)||t.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&t.target===document.body&&sf()?!0:(tn&&console.warn("CanReceiveInput:False for",t.target),!1)}getPointerId(t,e){return t.pointerType==="mouse"?0+(e??t.button):this.getPointerIndex(t.pointerId)}getButtonName(t){const e=t.button;if(t.pointerType==="mouse")switch(e){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(t,e,i){let s=this._pointerSpace[t];s||(s=new ne,this._pointerSpace[t]=s),this._pointerSpace[t]=s;const r=this.context.mainCamera;if(r){const o=this.tempNearPlaneVector.set(e,i,-1);this.convertScreenspaceToRaycastSpace(o);const a=this.tempFarPlaneVector.set(o.x,o.y,1);o.unproject(r),a.unproject(r);const l=r.worldUp||Re(0,1,0).applyQuaternion(Gt(r));this.tempLookMatrix.lookAt(a,o,l),s.position.set(o.x,o.y,o.z),s.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return s}isInRect(t){if(this.context.isInXR)return!0;const e=this.context.domElement.getBoundingClientRect(),i=t.clientX,s=t.clientY,r=i>=e.x&&i<=e.right&&s>=e.y&&s<=e.bottom;return tn&&!r&&console.log("Not in rect",e,i,s),r}onDown(t){const e=t.pointerId;if(this.getPointerPressed(e)&&console.warn(`Received pointerDown for pointerId that is already pressed: ${e}`,tn?t:""),tn&&console.log(t.pointerType,"DOWN",e),!!this.isInRect(t)){for(this.setPointerState(e,this._pointerPressed,!0),this.setPointerState(e,this._pointerDown,!0),this.setPointerStateT(e,this._pointerEvent,t.source);e>=this._pointerTypes.length;)this._pointerTypes.push(t.pointerType);for(this._pointerTypes[e]=t.pointerType;e>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new w);for(this._pointerPositionDown[e].set(t.clientX,t.clientY,t.clientZ??0);e>=this._pointerPositions.length;)this._pointerPositions.push(new oe);this._pointerPositions[e].set(t.clientX,t.clientY),e>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[e]=this.context.time.realtimeSinceStartup,this.updatePointerPosition(t),this._pointerEventsPressed.push(t),this.onDispatchEvent(t)}}onMove(t){const e=t.pointerId,i=this.getPointerPressed(e);i===!1&&!this.isInRect(t)||t.pointerType===Kc.Touch&&!i||(this.updatePointerPosition(t),this.setPointerStateT(e,this._pointerEvent,t.source),this.onDispatchEvent(t))}onUp(t){const e=t.pointerId;if(!this.getPointerPressed(e)){tn&&console.log(t.pointerType,"UP",e,"was not down");return}tn&&console.log(t.pointerType,"UP",e),this.setPointerState(e,this._pointerPressed,!1),this.setPointerStateT(e,this._pointerEvent,t.source),this.setPointerState(e,this._pointerUp,!0),this.updatePointerPosition(t);for(let l=this._pointerEventsPressed.length-1;l>=0;l--)if(this._pointerEventsPressed[l].pointerId===e){this._pointerEventsPressed.splice(l,1);break}if(!this._pointerPositionDown[e]){tn&&qt("Received pointer up event without matching down event for button: "+e),console.warn("Received pointer up event without matching down event for button: "+e);return}const s=this._pointerUpTime[e],r=this._pointerDownTime[e],o=this.context.time.realtimeSinceStartup,a=o-r;if(e>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),this._pointerUpTime[e]=o,a<1){let l=t.clientX-this._pointerPositionDown[e].x,h=t.clientY-this._pointerPositionDown[e].y,u=0;if(t.isSpatial&&t.clientZ!=null&&(u=t.clientZ-this._pointerPositionDown[e].z,l*=200,h*=200,u*=200),Math.abs(l)<5&&Math.abs(h)<5&&Math.abs(u)<5){this.setPointerState(e,this._pointerClick,!0),t.isClick=!0;const d=o-s;tn&&console.log("CLICK",e,l,h,u,d),d<this._doubleClickTimeThreshold&&d>0&&(this.setPointerState(e,this._pointerDoubleClick,!0),t.isDoubleClick=!0)}}this.onDispatchEvent(t)}updatePointerPosition(t){const e=t.pointerId;for(;e>=this._pointerPositions.length;)this._pointerPositions.push(new oe);for(;e>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new oe);for(;e>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new oe);const i=this._pointerPositionsLastFrame[e];i.copy(this._pointerPositions[e]);const s=this._pointerPositionsDelta[e];let r=t.clientX-i.x,o=t.clientY-i.y;if(t.source instanceof MouseEvent||t.source instanceof TouchEvent){const u=t.source;r===0&&u.movementX!==0&&(r=u.movementX||0),o===0&&u.movementY!==0&&(o=u.movementY||0)}s.x+=r,s.y+=o,this._pointerPositions[e].x=t.clientX,this._pointerPositions[e].y=t.clientY;const a=t.clientX,l=t.clientY;for(;e>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new oe);const h=this._pointerPositionsRC[e];h.set(a,l),this.convertScreenspaceToRaycastSpace(h)}getPointerIndex(t){let e=-1;for(let i=0;i<this._pointerIds.length;i++){if(this._pointerIds[i]===t)return i;e===-1&&this._pointerIds[i]===-1&&(e=i)}return e!==-1?(this._pointerIds[e]=t,e):(tn&&console.log("PUSH pointerId:",t),this._pointerIds.push(t),this._pointerIds.length-1)}setPointerState(t,e,i){e[t]=i}setPointerStateT(t,e,i){return e[t]=i,i}onDispatchEvent(t){const e=je.Current;try{je.Current=this.context,this.dispatchEvent(t)}finally{je.Current=e}}}const lf=new ae().makeRotationY(Math.PI),oo=new ie().setFromAxisAngle(new w(0,1,0),Math.PI),c8=z("debugwebxr");class h8{constructor(){c(this,"priority",-1e5);c(this,"gameObject");if(this.gameObject=new ne,this.gameObject.name="Implicit XR Rig",c8){const t=MS(16733661);t.position.y+=.5,this.gameObject.add(t)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const Al=z("debugwebxr"),yA=z("debugcustomgesture"),u8="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",d8="generic-trigger",f8=new ie().setFromEuler(new jt(ct.degToRad(0),ct.degToRad(-90),ct.degToRad(-90))),p8=new w(.04,-.04,0);class Vk{constructor(t,e,i){c(this,"xr");c(this,"inputSource");c(this,"index",0);c(this,"emitEvents",!0);c(this,"_connected",!0);c(this,"_isTracking",!1);c(this,"__gamepad");c(this,"__hand");c(this,"__side");c(this,"_hitTestSource");c(this,"_hasSelectEvent",!1);c(this,"_isMxInk",!1);c(this,"_isMetaQuestTouchController",!1);c(this,"_handJointPoses",new Map);c(this,"_gripMatrix",new ae);c(this,"_gripPosition",new w);c(this,"_gripQuaternion",new ie);c(this,"_linearVelocity",new w);c(this,"_rayPositionRaw",new w);c(this,"_rayRotationRaw",new ie);c(this,"_rayMatrix",new ae);c(this,"_rayPosition",new w);c(this,"_rayQuaternion",new ie);c(this,"_gripWorldPosition",new w);c(this,"_gripWorldQuaternion",new ie);c(this,"_rayWorldPosition",new w);c(this,"_rayWorldQuaternion",new ie);c(this,"_pinchPosition",new w);c(this,"_ray");c(this,"_hand_wristDotUp");c(this,"_object");c(this,"_gripSpaceObject");c(this,"_raySpaceObject");c(this,"model",null);c(this,"_debugAxesHelper",new dr(.15));c(this,"_debugGripAxesHelper",new dr(.07));c(this,"_debugRayAxesHelper",new dr(.07));c(this,"_hitTestSourcePromise",null);c(this,"onPointerHits",t=>{});c(this,"_needleGamepadButtons",{});c(this,"_buttonMap",new Map);c(this,"_motioncontroller");c(this,"_layout");c(this,"getMotionController");c(this,"emitPointerDownEvent",!0);c(this,"emitPointerUpEvent",!0);c(this,"emitPointerMoveEvent",!0);c(this,"pointerMoveDistanceThreshold",.03);c(this,"pointerMoveAngleThreshold",.05);c(this,"_selectButtonIndex");c(this,"_squeezeButtonIndex");c(this,"onSelectStart",t=>{var s,r,o,a;if(!this.emitPointerDownEvent||this.inputSource!==t.inputSource)return;this.onUpdateFrame(t.frame),this._hasSelectEvent=!0;const e=(s=this._layout)==null?void 0:s.selectComponentId,i=(a=(o=(r=this._layout)==null?void 0:r.components[e])==null?void 0:o.gamepadIndices)==null?void 0:a.button;i!==void 0&&(this._selectButtonIndex=i),!yA&&(Al&&Be.DrawDirection(this.rayWorldPosition,Re(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(ft.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,t))});c(this,"onSelectEnd",t=>{this.emitPointerUpEvent&&(yA||this.inputSource===t.inputSource&&this.emitPointerEvent(ft.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,t))});c(this,"onSequeezeStart",t=>{var e,i,s;this.emitPointerDownEvent&&this.inputSource===t.inputSource&&(this._squeezeButtonIndex=(s=(i=(e=this._layout)==null?void 0:e.components["xr-standard-squeeze"])==null?void 0:i.gamepadIndices)==null?void 0:s.button,this._squeezeButtonIndex!==void 0&&(Al&&Be.DrawDirection(this.rayWorldPosition,Re(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(ft.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,t)))});c(this,"onSequeezeEnd",t=>{this.emitPointerUpEvent&&this.inputSource===t.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(ft.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,t)});c(this,"states",{});c(this,"_didMoveLastFrame",!1);c(this,"_lastPointerMovePosition",new w);c(this,"_lastPointerMoveQuaternion",new ie);c(this,"pointerInit");this.xr=t,this.inputSource=e,this.index=i,this._object=new ne,this._object.name=`NeedleXRController_${i}`,Al&&(this._object.add(this._debugAxesHelper),this._gripSpaceObject=new ne,this._raySpaceObject=new ne,this._gripSpaceObject.name=`NeedleXRController_${i}_gripSpace`,this._raySpaceObject.name=`NeedleXRController_${i}_raySpace`,this._gripSpaceObject.add(this._debugGripAxesHelper),this._raySpaceObject.add(this._debugRayAxesHelper),this.xr.context.scene.add(this._gripSpaceObject),this.xr.context.scene.add(this._raySpaceObject)),this.xr.context.scene.add(this._object),this._ray=new mh,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents()}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.__gamepad??(this.__gamepad=this.inputSource.gamepad)}get isHand(){return this.hand!=null}get hand(){return this.__hand??(this.__hand=this.inputSource.hand)}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.__side??(this.__side=this.inputSource.handedness)}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}get isStylus(){return this._isMxInk}getHitTestSource(){return this._hitTestSource||this._requestHitTestSource(),this._hitTestSource}get hasHitTestSource(){return this._hitTestSource}cancelHitTestSource(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(t,e){var s;if(e=e||this.xr.frame,!this.hand||!(e!=null&&e.getJointPose)||!this.xr.referenceSpace)return null;let i=(s=this._handJointPoses)==null?void 0:s.get(t);return i||(i=e.getJointPose(t,this.xr.referenceSpace),i&&this._handJointPoses.set(t,i),i)}get gripPosition(){return Re(this._gripPosition)}get gripQuaternion(){return Ia(this._gripQuaternion)}get gripMatrix(){return this._gripMatrix}get gripLinearVelocity(){return Re(this._linearVelocity).applyQuaternion(oo)}get rayPosition(){return Re(this._rayPosition)}get rayQuaternion(){return Ia(this._rayQuaternion)}get gripWorldPosition(){return Re(this._gripWorldPosition)}get gripWorldQuaternion(){return Ia(this._gripWorldQuaternion)}get rayWorldPosition(){return Re(this._rayWorldPosition)}updateRayWorldPosition(){var e;const t=(e=this.xr.context.mainCamera)==null?void 0:e.parent;this._rayWorldPosition.copy(this._rayPositionRaw),t&&this._rayWorldPosition.applyMatrix4(t.matrixWorld)}get rayWorldQuaternion(){return Ia(this._rayWorldQuaternion)}get pinchPosition(){return Re(this._pinchPosition)}updateRayWorldQuaternion(){var i;const t=(i=this.xr.context.mainCamera)==null?void 0:i.parent,e=t?Gt(t):void 0;this._rayWorldQuaternion.copy(this._rayRotationRaw).multiply(oo),e&&this._rayWorldQuaternion.premultiply(e)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(Re(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get handWristDotUp(){var e;if(this._hand_wristDotUp!==void 0)return this._hand_wristDotUp;const t=(e=this.handObject)==null?void 0:e.joints.wrist;if(t){const i=Re(0,1,0).applyQuaternion(t.quaternion),s=Re(0,1,0).dot(i);return this._hand_wristDotUp=s}}get isHandUpsideDown(){return this.handWristDotUp!==void 0?this.handWristDotUp<-.7:!1}get isTeleportGesture(){var t;return this.isHandUpsideDown&&((t=this.getGesture("pinch"))==null?void 0:t.isDown)}get object(){return this._object}async getModelUrl(){var t;return(t=this.getMotionController)==null?void 0:t.then(e=>(e==null?void 0:e.assetUrl)||null)}_requestHitTestSource(){var t;return this._hitTestSourcePromise?this._hitTestSourcePromise:this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&this.xr.session.requestHitTestSourceForTransientInput?this._hitTestSourcePromise=((t=this.xr.session.requestHitTestSourceForTransientInput({profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null?void 0:t.then(e=>(this._hitTestSourcePromise=null,this.connected?this._hitTestSource=e:(e.cancel(),null))))??null:null}onUpdate(t){performance.mark("NeedleXRController onUpdate start"),this.onUpdateFrame(t),this.updateInputEvents(),this.onUpdateMove(),performance.mark("NeedleXRController onUpdate end"),performance.measure("NeedleXRController onUpdate","NeedleXRController onUpdate start","NeedleXRController onUpdate end")}onRenderDebug(){var r;Be.DrawSphere(this.rayWorldPosition,.003),Be.DrawDirection(this.rayWorldPosition,Re(0,0,10).applyQuaternion(this.rayWorldQuaternion));const e=(this.inputSource.gripSpace?this.gripWorldPosition:this.object.worldPosition).sub(this.object.worldForward.multiplyScalar(.1)),i=this.inputSource.profiles.join(`
`);let s=`Controller[${this.index}] (${this.inputSource.targetRayMode}, ${this.side})
C:${this.connected?"x":"-"} T:${this.isTracking?"x":"-"} Hand:${this.inputSource.hand?"x":"-"} Pen: ${this._isMxInk?"x":"-"}`;if(this.inputSource.hand&&(s+=`
Pinch: ${(r=this.getGesture("pinch"))==null?void 0:r.value.toFixed(3)}`),s+=`
`+i,s+=`
`+(this.inputSource.targetRaySpace?"Ray: x":"Ray: -")+(this.inputSource.gripSpace?" Grip: x":" Grip: -")+(this.inputSource.gamepad?` Gamepad: ${this.inputSource.gamepad.mapping}`:" Gamepad: -"),this.inputSource.gamepad){const o=this.inputSource.gamepad;let a="[btns "+o.buttons.length+"]: "+o.buttons.map(l=>l.value.toPrecision(1)).join(",");a+=`
[axes `+o.axes.length+"]: "+o.axes.map(l=>l.toPrecision(1)).join(","),s+=`
`+a}Be.DrawLabel(e,s,.006)}onUpdateFrame(t){var u,d,f,p,g,m,v,y,b,_,x;if(this._handJointPoses.clear(),this._hand_wristDotUp=void 0,!this.xr.referenceSpace){this._isTracking=!1;return}const e=t.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);this._isTracking=e!=null;let i=null,s=null,r=null,o=null;if(e){const S=e.transform;if(this._rayMatrix.fromArray(S.matrix).premultiply(lf),this._rayMatrix.decompose(this._rayPosition,this._rayQuaternion,Re(1,1,1)),r=Re(S.position),o=Ia(S.orientation),this._isMxInk){const E=Re(.013,0,-.028).applyQuaternion(o);r.add(E),this._rayPosition.add(E)}this._rayPositionRaw.copy(r),this._rayRotationRaw.copy(o)}if(this.inputSource.gripSpace){const S=t.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(S){const E=S.transform;if(i=Re(E.position),s=Ia(E.orientation),this._gripMatrix.fromArray(E.matrix).premultiply(lf),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,Re(1,1,1)),"linearVelocity"in S&&S.linearVelocity){const M=S.linearVelocity;this._linearVelocity.set(M.x,M.y,M.z)}}}(u=this.xr.context.mainCamera)!=null&&u.parent&&(this._object.parent!==((d=this.xr.context.mainCamera)==null?void 0:d.parent)&&this.xr.context.mainCamera.parent.add(this._object),this._gripSpaceObject!==void 0&&((f=this._gripSpaceObject)==null?void 0:f.parent)!==((p=this.xr.context.mainCamera)==null?void 0:p.parent)&&this.xr.context.mainCamera.parent.add(this._gripSpaceObject),this._raySpaceObject!==void 0&&((g=this._raySpaceObject)==null?void 0:g.parent)!==((m=this.xr.context.mainCamera)==null?void 0:m.parent)&&this.xr.context.mainCamera.parent.add(this._raySpaceObject));const a=this.hand;if(a){let S=!1;const E=a.get("wrist"),M=E&&this.getHandJointPose(E,t);if(M){S=!0;const R=M.transform.position,P=M.transform.orientation;this._object.position.set(R.x,R.y,R.z),this._object.quaternion.set(P.x,P.y,P.z,P.w).multiply(oo)}S||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(oo));const I=a.get("middle-finger-metacarpal"),B=I&&this.getHandJointPose(I,t);B&&(this._gripMatrix.fromArray(B.transform.matrix).premultiply(lf),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,Re(1,1,1)),i=Re().copy(B.transform.position),s=Ia().copy(B.transform.orientation),s.multiply(f8),i.add(Re(p8).applyQuaternion(s)))}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"&&i&&s?(this._object.position.copy(i),this._object.quaternion.copy(s).multiply(oo)):r&&o&&(this._object.position.copy(r),this._object.quaternion.copy(o).multiply(oo));Al&&(r&&o&&((v=this._raySpaceObject)==null||v.position.copy(r),(y=this._raySpaceObject)==null||y.quaternion.copy(o).multiply(oo)),i&&s&&((b=this._gripSpaceObject)==null||b.position.copy(i),(_=this._gripSpaceObject)==null||_.quaternion.copy(s).multiply(oo)));const l=(x=this.xr.context.mainCamera)==null?void 0:x.parent,h=l?Gt(l):void 0;i&&s&&(this._gripWorldPosition.copy(i),l&&this._gripWorldPosition.applyMatrix4(l.matrixWorld),this._gripWorldQuaternion.copy(s),this._gripWorldQuaternion.multiply(oo),h&&this._gripWorldQuaternion.premultiply(h)),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){var t,e,i,s,r,o;this._connected=!1,Al&&console.warn("Controller disconnected",this.index);for(const a of this._object.children)this.xr.context.scene.attach(a);(t=this._object)==null||t.removeFromParent(),(e=this._debugAxesHelper)==null||e.removeFromParent(),(i=this._debugGripAxesHelper)==null||i.removeFromParent(),(s=this._debugRayAxesHelper)==null||s.removeFromParent(),(r=this._gripSpaceObject)==null||r.removeFromParent(),(o=this._raySpaceObject)==null||o.removeFromParent(),this.unsubscribeEvents(),this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}getButton(t){var i;if(!this._layout)return;switch(t){case"primary-button":if(this.isLeft)t="x-button";else if(this.isRight)t="a-button";else return;break;case"primary":return this.hand?this.getGesture("pinch"):this.toNeedleGamepadButton(0,t)}if(this._buttonMap.has(t))return this.toNeedleGamepadButton(this._buttonMap.get(t),t);const e=(i=this._layout)==null?void 0:i.components[t];if(e!=null&&e.gamepadIndices)switch(e.type){case"button":case"squeeze":if(this.inputSource.gamepad){const s=e.gamepadIndices.button;return this._buttonMap.set(t,s),this.toNeedleGamepadButton(s,t)}break;default:console.warn("Unsupported component type",e.type);break}this._buttonMap.set(t,void 0)}getGesture(t){const e=this.states[t];if(!e)return null;this.states[t]=e;const i=this._needleGamepadButtons[t]||new yI(void 0,t);return i.pressed=e.pressed,i.value=e.value,i.isDown=e.isDown,i.isUp=e.isUp,this._needleGamepadButtons[t]=i,i}getPointerId(t){if((t==="primary"||t==="pinch")&&(t=0),typeof t!="number"){const e=this._buttonMap.get(t);if(e===void 0)return;t=e}return this.index*10+t}toNeedleGamepadButton(t,e){var o,a;if(!((o=this.inputSource.gamepad)!=null&&o.buttons))return;const i=(a=this.inputSource.gamepad)==null?void 0:a.buttons[t],s=this.states[t],r=this._needleGamepadButtons[t]||new yI(t,e);return i&&(r.pressed=i.pressed,r.value=i.value,r.touched=i.touched),s&&(r.isDown=s.isDown,r.isUp=s.isUp),this._needleGamepadButtons[t]=r,r}getStick(t){var i,s,r,o,a,l,h,u,d;if(!this._layout)return{x:0,y:0,z:0};if(t==="primary"){const f=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,p=((s=this.inputSource.gamepad)==null?void 0:s.axes[1])||0,g=((o=(r=this.inputSource.gamepad)==null?void 0:r.buttons[3])==null?void 0:o.value)||0;return{x:f,y:p,z:g}}const e=(a=this._layout)==null?void 0:a.components[t];if(e!=null&&e.gamepadIndices)switch(e.type){case"thumbstick":if(this.inputSource.gamepad){const f=e.gamepadIndices.xAxis,p=e.gamepadIndices.yAxis;let g=(l=this.inputSource.gamepad)==null?void 0:l.axes[f],m=(h=this.inputSource.gamepad)==null?void 0:h.axes[p];g*=-1,m*=-1;const v=e.gamepadIndices.button,y=(d=(u=this.inputSource.gamepad)==null?void 0:u.buttons[v])==null?void 0:d.value;return{x:g,y:m,z:y}}}return{x:0,y:0,z:0}}initialize(){var t;if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(e=>e.startsWith("generic-trigger")),this._isMetaQuestTouchController=this.profiles.includes("meta-quest-touch-plus")||this.profiles.includes("oculus-touch-v3"),this._isMxInk=this.profiles.includes("logitech-mx-ink")||this.profiles.includes("meta-quest-touch-plus")&&((t=this.inputSource.gamepad)==null?void 0:t.buttons.length)===7,!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const e=i8(this.inputSource,u8,d8);this.getMotionController=e.then(i=>{var o;if(!this.connected)return null;this._isMxInk&&(i.assetPath="https://cdn.needle.tools/static/models/controllers/logitech_vr_stylus_v1.3.1_grip_questos68.glb"),this._motioncontroller=new a8(this.inputSource,i.profile,i.assetPath||"");const r=i.profile.layouts[this.inputSource.handedness];if(this._layout=r,this._layout&&!((o=this._layout.gamepad)!=null&&o.length)){this._layout.gamepad=[];for(const a in this._layout.components){const l=this._layout.components[a];this._layout.gamepad[l.gamepadIndices.button]=a}}return this._motioncontroller}).catch(i=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,i),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var t,e,i;if((t=this.gamepad)!=null&&t.buttons){for(let s=0;s<this.gamepad.buttons.length;s++){const r=this.gamepad.buttons[s],o=this.states[s]||new vI;let a=null;this._isMxInk&&(s===4||s===5)?(r.value>0&&!o.pressed?(a="pointerdown",o.isDown=!0,o.isUp=!1):r.value===0&&o.pressed?(a="pointerup",o.isDown=!1,o.isUp=!0):o.pressed&&(a="pointermove",o.isDown=!1,o.isUp=!1),o.pressed=r.value>0,o.value=r.value):(r.pressed&&!o.pressed?(a="pointerdown",o.isDown=!0,o.isUp=!1):!r.pressed&&o.pressed?(a="pointerup",o.isDown=!1,o.isUp=!0):(o.isDown=!1,o.isUp=!1),o.pressed=r.pressed,o.value=r.value),this.states[s]=o;const l=s!==this._selectButtonIndex&&s!==this._squeezeButtonIndex;if(a!=null&&l){let h=(e=this._layout)==null?void 0:e.gamepad[s];this._isMxInk&&s===4&&(h="stylus-touch"),this._isMxInk&&s===5&&(h="stylus-tip"),(Al||yA)&&console.log("Emitting pointer event",a,s,h,r.value,this.gamepad,this._layout),this.emitPointerEvent(a,s,h??"none",!1,null,r.value)}}if(this._isMetaQuestTouchController){const s=this.gamepad.buttons.length-1,r=this.states[s];if(r&&r.isDown){const o=this.context.menu;o.spatialMenuIsVisible?o.setSpatialMenuVisible(!1):this.context.menu.setSpatialMenuVisible(!0)}}}if(this.hand){const s=this.handObject;if(s){const r=s.joints["index-finger-tip"],o=s.joints["thumb-tip"];if(r&&o){const a=r.position.distanceTo(o.position);this._pinchPosition.lerpVectors(r.position,o.position,.5);const l=(i=this.xr.context.mainCamera)==null?void 0:i.parent;if(l&&this._pinchPosition.applyMatrix4(l.matrixWorld),a!==0){const d=this.states.pinch||new vI,f=(.02+.01)*1.5;d.value=1-(a-.02)/f;const p=a<.02-.01,g=a>.02+.01;p&&!d.pressed?(yA&&console.log("pinch start",a),d.isDown=!0,d.isUp=!1,d.pressed=!0):g&&d.pressed?(d.isDown=!1,d.isUp=!0,d.pressed=!1):(d.isDown=!1,d.isUp=!1),this.states.pinch=d}}}}}onUpdateMove(){var i,s;if(!this.emitPointerMoveEvent)return;let t=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>this.pointerMoveDistanceThreshold*this.xr.rigScale&&(t=!0),t||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>this.pointerMoveAngleThreshold&&(t=!0),t){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),Al&&Be.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let r=this.xr.context.input.getFirstPressedButtonForPointer(this.index);r===void 0&&(r=0);const o=(s=(i=this.gamepad)==null?void 0:i.buttons[r])==null?void 0:s.value;this.emitPointerEvent("pointermove",r,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(t,e,i,s,r=null,o){if(!this.emitEvents){Al&&t!==ft.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,t,e);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.getPointerId(e),this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=e,this.pointerInit.buttonName=i,this.pointerInit.isPrimary=s,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=o,this.pointerInit.clientX=this._rayPosition.x/this.xr.rigScale,this.pointerInit.clientY=this._rayPosition.y/this.xr.rigScale,this.pointerInit.clientZ=this._rayPosition.z/this.xr.rigScale;const a=je.Current;je.Current=this.xr.context,Al&&t!=="pointermove"&&console.warn("Pointer event",t,e,i,{...this.pointerInit}),this.xr.context.input.createInputEvent(new Oc(t,r,this.pointerInit)),je.Current=a}}}class vI{constructor(){c(this,"isDown",!1);c(this,"isUp",!1);c(this,"pressed",!1);c(this,"value",0)}}class yI{constructor(t,e){c(this,"index");c(this,"name");c(this,"touched",!1);c(this,"pressed",!1);c(this,"value",0);c(this,"isDown",!1);c(this,"isUp",!1);this.index=t,this.name=e}}const cf=new Map,Dd=new Map;let bI=0;function Ah(n,t,e){if(cf.has(t)||cf.set(t,new Array),cf.get(t).push({method:n,options:{once:!1,...e}}),bI<30){const i=Dd.get(t);i&&(i==null?void 0:i.length)>100&&(bI+=1,console.warn(`You have ${i.length} methods registered for Event ${t}.

This might be a performance issue!
Consider unregistering the methods when they are not needed anymore!

To unregister you can call the function returned by your event hook (e.g.const unregister = onStart(...)) 

or by using the once option like onStart(()=>{}, { once:true }).

See https://engine.needle.tools/docs/scripting.html#special-lifecycle-hooks for more information.`))}}function vh(n,t){const e=Dd.get(t);if(e){for(let s=0;s<e.length;s++)if(e[s].method===n){e.splice(s,1);return}}const i=cf.get(t);if(i){for(let s=0;s<i.length;s++)if(i[s].method===n){i.splice(s,1);return}}}function ha(n,t){t===dt.ContextCreated&&ox.delete(n),Wk(n,t)}function Wk(n,t){t===We.Start&&cf.get(dt.ContextCreated)&&Wk(n,dt.ContextCreated);const e=t===We.Start||t===dt.ContextCreated,i=Dd.get(t);i&&i.length>0&&wI(n,i,e);const s=cf.get(t);if(s&&s.length>0){const r=[...s];s.length=0,wI(n,r,e),r.length>0&&(Dd.has(t)||Dd.set(t,new Array),Dd.get(t).push(...r))}}const bA=new Array,_I={context:null};function wI(n,t,e){var s,r;bA.length=0;for(let o=0;o<t.length;o++)bA.push(t[o]);let i=ox.get(n);for(let o=0;o<bA.length;o++){const a=bA[o];let l=!0;if(i&&i.has(a)&&(l=!1),l)try{_I.context=n,(s=a.method)==null||s.call(_I,n)}catch(h){console.error("Error in lifecycle method",h)}if((r=a.options)!=null&&r.once){for(let h=0;h<t.length;h++)if(t[h]===a){t.splice(h,1);break}}else e&&(i||(i=new Set,ox.set(n,i)),i.add(a))}}const ox=new WeakMap,u_=2,Oa=4,Fl=4,SS=4,zc=new Int32Array(2),xI=new Float32Array(zc.buffer),CI=new Float64Array(zc.buffer),_A=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class Xl{constructor(t,e){this.low=t|0,this.high=e|0}static create(t,e){return t==0&&e==0?Xl.ZERO:new Xl(t,e)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(t){return this.low==t.low&&this.high==t.high}}Xl.ZERO=new Xl(0,0);var ax;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(ax||(ax={}));class Zg{constructor(t){this.bytes_=t,this.position_=0}static allocate(t){return new Zg(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return new Xl(this.readInt32(t),this.readInt32(t+4))}readUint64(t){return new Xl(this.readUint32(t),this.readUint32(t+4))}readFloat32(t){return zc[0]=this.readInt32(t),xI[0]}readFloat64(t){return zc[_A?0:1]=this.readInt32(t),zc[_A?1:0]=this.readInt32(t+4),CI[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)}writeUint64(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)}writeFloat32(t,e){xI[0]=e,this.writeInt32(t,zc[0])}writeFloat64(t,e){CI[0]=e,this.writeInt32(t,zc[_A?0:1]),this.writeInt32(t+4,zc[_A?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Oa+Fl)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Fl;e++)t+=String.fromCharCode(this.readInt8(this.position_+Oa+e));return t}__offset(t,e){const i=t-this.readInt32(t);return e<this.readInt16(i)?this.readInt16(i+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const i=this.readInt32(t);let s="",r=0;if(t+=Oa,e===ax.UTF8_BYTES)return this.bytes_.subarray(t,t+i);for(;r<i;){let o;const a=this.readUint8(t+r++);if(a<192)o=a;else{const l=this.readUint8(t+r++);if(a<224)o=(a&31)<<6|l&63;else{const h=this.readUint8(t+r++);if(a<240)o=(a&15)<<12|(l&63)<<6|h&63;else{const u=this.readUint8(t+r++);o=(a&7)<<18|(l&63)<<12|(h&63)<<6|u&63}}}o<65536?s+=String.fromCharCode(o):(o-=65536,s+=String.fromCharCode((o>>10)+55296,(o&1024-1)+56320))}return s}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Oa}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Fl)throw new Error("FlatBuffers: file identifier must be length "+Fl);for(let e=0;e<Fl;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+Oa+e))return!1;return!0}createLong(t,e){return Xl.create(t,e)}createScalarList(t,e){const i=[];for(let s=0;s<e;++s)t(s)!==null&&i.push(t(s));return i}createObjList(t,e){const i=[];for(let s=0;s<e;++s){const r=t(s);r!==null&&i.push(r.unpack())}return i}}class Em{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let e;t?e=t:e=1024,this.bb=Zg.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const i=~(this.bb.capacity()-this.space+e)+1&t-1;for(;this.space<i+t+e;){const s=this.bb.capacity();this.bb=Em.growByteBuffer(this.bb),this.space+=this.bb.capacity()-s}this.pad(i)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,i){(this.force_defaults||e!=i)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,i){(this.force_defaults||e!=i)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,i){(this.force_defaults||e!=i)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,i){(this.force_defaults||!e.equals(i))&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,i){(this.force_defaults||e!=i)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,i){(this.force_defaults||e!=i)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,i){(this.force_defaults||e!=i)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,i){e!=i&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(e&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=e<<1,s=Zg.allocate(i);return s.setPosition(i-e),s.bytes().set(t.bytes(),i-e),s}addOffset(t){this.prep(Oa,0),this.writeInt32(this.offset()-t+Oa)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const i=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);const s=2;this.addInt16(t-this.object_start);const r=(i+s)*u_;this.addInt16(r);let o=0;const a=this.space;e:for(e=0;e<this.vtables.length;e++){const l=this.bb.capacity()-this.vtables[e];if(r==this.bb.readInt16(l)){for(let h=u_;h<r;h+=u_)if(this.bb.readInt16(a+h)!=this.bb.readInt16(l+h))continue e;o=this.vtables[e];break}}return o?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,o-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,i){const s=i?SS:0;if(e){const r=e;if(this.prep(this.minalign,Oa+Fl+s),r.length!=Fl)throw new Error("FlatBuffers: file identifier must be length "+Fl);for(let o=Fl-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,Oa+s),this.addOffset(t),s&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const i=this.bb.capacity()-t,s=i-this.bb.readInt32(i);if(!(this.bb.readInt16(s+e)!=0))throw new Error("FlatBuffers: field "+e+" must be set")}startVector(t,e,i){this.notNested(),this.vector_num_elems=e,this.prep(Oa,t*e),this.prep(i,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(!t)return 0;let e;if(t instanceof Uint8Array)e=t;else{e=[];let i=0;for(;i<t.length;){let s;const r=t.charCodeAt(i++);if(r<55296||r>=56320)s=r;else{const o=t.charCodeAt(i++);s=(r<<10)+o+(65536-56623104-56320)}s<128?e.push(s):(s<2048?e.push(s>>6&31|192):(s<65536?e.push(s>>12&15|224):e.push(s>>18&7|240,s>>12&63|128),e.push(s>>6&63|128)),e.push(s&63|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(let i=0,s=this.space,r=this.bb.bytes();i<e.length;i++)r[s++]=e[i];return this.endVector()}createLong(t,e){return Xl.create(t,e)}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let i=0;i<t.length;++i){const s=t[i];if(s!==null)e.push(this.createObjectOffset(s));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t),this.endVector()}}const qk={};function Xk(n,t){qk[n]=t}function g8(n){const t=n.getBufferIdentifier(),e=qk[t];return e(n)}function m8(n){return typeof n.guid=="function"?n.guid():null}function C0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yk={exports:{}};(function(n){var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=t;var e=n.exports.BlobBuilder;typeof window<"u"&&(e=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(s){typeof s=="number"?this._pieces.push(s):(this.flush(),this._parts.push(s))},i.prototype.flush=function(){if(this._pieces.length>0){var s=new Uint8Array(this._pieces);t.useArrayBufferView||(s=s.buffer),this._parts.push(s),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),t.useBlobBuilder){for(var s=new e,r=0,o=this._parts.length;r<o;r++)s.append(this._parts[r]);return s.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=i})(Yk);var Kk=Yk.exports,A8=Kk.BufferBuilder,SI=Kk.binaryFeatures,v8={unpack:function(n){var t=new ts(n);return t.unpack()},pack:function(n){var t=new is;t.pack(n);var e=t.getBuffer();return e}},y8=v8;function ts(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}ts.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var t;if((t=n^160)<=15)return this.unpack_raw(t);if((t=n^176)<=15)return this.unpack_string(t);if((t=n^144)<=15)return this.unpack_array(t);if((t=n^128)<=15)return this.unpack_map(t);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}};ts.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n};ts.prototype.unpack_uint16=function(){var n=this.read(2),t=(n[0]&255)*256+(n[1]&255);return this.index+=2,t};ts.prototype.unpack_uint32=function(){var n=this.read(4),t=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,t};ts.prototype.unpack_uint64=function(){var n=this.read(8),t=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,t};ts.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-256};ts.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-65536};ts.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)};ts.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)};ts.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,t};ts.prototype.unpack_string=function(n){for(var t=this.read(n),e=0,i="",s,r;e<n;)s=t[e],s<128?(i+=String.fromCharCode(s),e++):(s^192)<32?(r=(s^192)<<6|t[e+1]&63,i+=String.fromCharCode(r),e+=2):(r=(s&15)<<12|(t[e+1]&63)<<6|t[e+2]&63,i+=String.fromCharCode(r),e+=3);return this.index+=n,i};ts.prototype.unpack_array=function(n){for(var t=new Array(n),e=0;e<n;e++)t[e]=this.unpack();return t};ts.prototype.unpack_map=function(n){for(var t={},e=0;e<n;e++){var i=this.unpack(),s=this.unpack();t[i]=s}return t};ts.prototype.unpack_float=function(){var n=this.unpack_uint32(),t=n>>31,e=(n>>23&255)-127,i=n&8388607|8388608;return(t===0?1:-1)*i*Math.pow(2,e-23)};ts.prototype.unpack_double=function(){var n=this.unpack_uint32(),t=this.unpack_uint32(),e=n>>31,i=(n>>20&2047)-1023,s=n&1048575|1048576,r=s*Math.pow(2,i-20)+t*Math.pow(2,i-52);return(e===0?1:-1)*r};ts.prototype.read=function(n){var t=this.index;if(t+n<=this.length)return this.dataView.subarray(t,t+n);throw new Error("BinaryPackFailure: read index out of range")};function is(){this.bufferBuilder=new A8}is.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};is.prototype.pack=function(n){var t=typeof n;if(t==="string")this.pack_string(n);else if(t==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(t==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(t==="undefined")this.bufferBuilder.append(192);else if(t==="object")if(n===null)this.bufferBuilder.append(192);else{var e=n.constructor;if(e==Array)this.pack_array(n);else if(e==Blob||e==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(e==ArrayBuffer)SI.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)SI.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(e==Object||e.toString().startsWith("class"))this.pack_object(n);else if(e==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+e.toString()+'" not yet supported')}else throw new Error('Type "'+t+'" not yet supported');this.bufferBuilder.flush()};is.prototype.pack_bin=function(n){var t=n.length||n.byteLength||n.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(n)};is.prototype.pack_string=function(n){var t=_8(n);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(t);else throw new Error("Invalid length");this.bufferBuilder.append(n)};is.prototype.pack_array=function(n){var t=n.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");for(var e=0;e<t;e++)this.pack(n[e])};is.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")};is.prototype.pack_double=function(n){var t=0;n<0&&(t=1,n=-n);var e=Math.floor(Math.log(n)/Math.LN2),i=n/Math.pow(2,e)-1,s=Math.floor(i*Math.pow(2,52)),r=Math.pow(2,32),o=t<<31|e+1023<<20|s/r&1048575,a=s%r;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)};is.prototype.pack_object=function(n){var t=Object.keys(n),e=t.length;if(e<=15)this.pack_uint8(128+e);else if(e<=65535)this.bufferBuilder.append(222),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(e);else throw new Error("Invalid length");for(var i in n)n.hasOwnProperty(i)&&(this.pack(i),this.pack(n[i]))};is.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)};is.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)};is.prototype.pack_uint32=function(n){var t=n&4294967295;this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};is.prototype.pack_uint64=function(n){var t=n/Math.pow(2,32),e=n%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};is.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)};is.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)};is.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};is.prototype.pack_int64=function(n){var t=Math.floor(n/Math.pow(2,32)),e=n%Math.pow(2,32);this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255),this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};function b8(n){var t=n.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}function _8(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,b8).length}const EI=C0(y8);let Jk=!0,Zk=!0;function zp(n,t,e){const i=n.match(t);return i&&i.length>=e&&parseInt(i[e],10)}function zf(n,t,e){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(o,a){if(o!==t)return s.apply(this,arguments);const l=h=>{const u=e(h);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,l),s.apply(this,[o,l])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(a))return r.apply(this,arguments);const l=this._eventMap[t].get(a);return this._eventMap[t].delete(a),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,l])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function w8(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Jk=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function x8(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Zk=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function ES(){if(typeof window=="object"){if(Jk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function S0(n,t){Zk&&console.warn(n+" is deprecated, please use "+t+" instead.")}function C8(n){const t={browser:null,version:null};if(typeof n>"u"||!n.navigator)return t.browser="Not a browser.",t;const{navigator:e}=n;if(e.mozGetUserMedia)t.browser="firefox",t.version=zp(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)t.browser="chrome",t.version=zp(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=zp(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&e.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=zp(e.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function II(n){return Object.prototype.toString.call(n)==="[object Object]"}function $k(n){return II(n)?Object.keys(n).reduce(function(t,e){const i=II(n[e]),s=i?$k(n[e]):n[e],r=i&&!Object.keys(s).length;return s===void 0||r?t:Object.assign(t,{[e]:s})},{}):n}function lx(n,t,e){!t||e.has(t.id)||(e.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?lx(n,n.get(t[i]),e):i.endsWith("Ids")&&t[i].forEach(s=>{lx(n,n.get(s),e)})}))}function TI(n,t,e){const i=e?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const r=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&r.push(o)}),r.forEach(o=>{n.forEach(a=>{a.type===i&&a.trackId===o.id&&lx(n,a,s)})}),s}const RI=ES;function eD(n,t){const e=n&&n.navigator;if(!e.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const u=typeof a[h]=="object"?a[h]:{ideal:a[h]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){l.optional=l.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",h)]=u.ideal,l.optional.push(f),f={},f[d("max",h)]=u.ideal,l.optional.push(f)):(f[d("",h)]=u.ideal,l.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",h)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(f,h)]=u[f])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},s=function(a,l){if(t.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const h=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),h(a.audio,"autoGainControl","googAutoGainControl"),h(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let h=a.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const u=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(e.mediaDevices.getSupportedConstraints&&e.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(h.exact==="environment"||h.ideal==="environment"?d=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(d=["front"]),d)return e.mediaDevices.enumerateDevices().then(f=>{f=f.filter(g=>g.kind==="videoinput");let p=f.find(g=>d.some(m=>g.label.toLowerCase().includes(m)));return!p&&f.length&&d.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=h.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),RI("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return RI("chrome: "+JSON.stringify(a)),l(a)},r=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,h){s(a,u=>{e.webkitGetUserMedia(u,l,d=>{h&&h(r(d))})})};if(e.getUserMedia=o.bind(e),e.mediaDevices.getUserMedia){const a=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(l){return s(l,h=>a(h).then(u=>{if(h.audio&&!u.getAudioTracks().length||h.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(r(u))))}}}function S8(n,t){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(s=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),n.navigator.mediaDevices.getUserMedia(i)})}}}function tD(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function iD(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):r={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.id):r={track:s};const o=new Event("track");o.track=s,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else zf(n,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function nD(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const t=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){let h=s.apply(this,arguments);return h||(h=t(this,a),this._senders.push(h)),h};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],e.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(t(this,o))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function sD(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,s,r]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);const o=function(l){const h={};return l.result().forEach(d=>{const f={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(p=>{f[p]=d.stat(p)}),h[f.id]=f}),h},a=function(l){return new Map(Object.keys(l).map(h=>[h,l[h]]))};if(arguments.length>=2){const l=function(h){s(a(o(h)))};return t.apply(this,[l,i])}return new Promise((l,h)=>{t.apply(this,[function(u){l(a(o(u)))},h])}).then(s,r)}}function rD(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>TI(o,r.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s}),zf(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>TI(r,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let s,r,o;return this.getSenders().forEach(a=>{a.track===i&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function oD(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(h=>{if(this.getSenders().find(d=>d.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();e.apply(this,arguments);const l=this.getSenders().filter(h=>a.indexOf(h)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function aD(n,t){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&t.version>=65)return oD(n);const e=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=e.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new n.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new n.MediaStream([u]);this._streams[d.id]=m,this._reverseStreams[m.id]=d,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function r(h,u){let d=u.sdp;return Object.keys(h._reverseStreams||[]).forEach(f=>{const p=h._reverseStreams[f],g=h._streams[p.id];d=d.replace(new RegExp(g.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(h,u){let d=u.sdp;return Object.keys(h._reverseStreams||[]).forEach(f=>{const p=h._reverseStreams[f],g=h._streams[p.id];d=d.replace(new RegExp(p.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(h){const u=n.RTCPeerConnection.prototype[h],d={[h](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const m=r(this,g);f[0].apply(null,[m])},g=>{f[1]&&f[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>r(this,g))}};n.RTCPeerConnection.prototype[h]=d[h]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=l.get.apply(this);return h.type===""?h:r(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>u.track===m)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function cx(n,t){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const i=n.RTCPeerConnection.prototype[e],s={[e](){return arguments[0]=new(e==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[e]=s[e]})}function lD(n,t){zf(n,"negotiationneeded",e=>{const i=e.target;if(!((t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return e})}const BI=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:lD,shimAddTrackRemoveTrack:aD,shimAddTrackRemoveTrackWithNative:oD,shimGetDisplayMedia:S8,shimGetSendersWithDtmf:nD,shimGetStats:sD,shimGetUserMedia:eD,shimMediaStream:tD,shimOnTrack:iD,shimPeerConnection:cx,shimSenderReceiverGetStats:rD},Symbol.toStringTag,{value:"Module"}));function E8(n,t){let e=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(i=>{if(i&&(i.urls||i.url)){let s=i.urls||i.url;i.url&&!i.urls&&S0("RTCIceServer.url","RTCIceServer.urls");const r=typeof s=="string";return r&&(s=[s]),s=s.filter(o=>{if(o.indexOf("stun:")===0)return!1;const a=o.startsWith("turn")&&!o.startsWith("turn:[")&&o.includes("transport=udp");return a&&!e?(e=!0,!0):a&&!e}),delete i.url,i.urls=r?s[0]:s,!!s.length}})}var cD={exports:{}};(function(n){var t={};t.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(function(i){return i.trim()})},t.splitSections=function(e){var i=e.split(`
m=`);return i.map(function(s,r){return(r>0?"m="+s:s).trim()+`\r
`})},t.getDescription=function(e){var i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){var i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter(function(s){return s.indexOf(i)===0})},t.parseCandidate=function(e){var i;e.indexOf("a=candidate:")===0?i=e.substring(12).split(" "):i=e.substring(10).split(" ");for(var s={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]=i[r+1];break}return s},t.writeCandidate=function(e){var i=[];i.push(e.foundation),i.push(e.component),i.push(e.protocol.toUpperCase()),i.push(e.priority),i.push(e.address||e.ip),i.push(e.port);var s=e.type;return i.push("typ"),i.push(s),s!=="host"&&e.relatedAddress&&e.relatedPort&&(i.push("raddr"),i.push(e.relatedAddress),i.push("rport"),i.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(i.push("ufrag"),i.push(e.usernameFragment||e.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var i=e.substr(9).split(" "),s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(e){var i=e.payloadType;e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType);var s=e.channels||e.numChannels||1;return"a=rtpmap:"+i+" "+e.name+"/"+e.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(e){var i=e.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+`\r
`},t.parseFmtp=function(e){for(var i={},s,r=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)s=r[o].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(e){var i="",s=e.payloadType;if(e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(o){e.parameters[o]?r.push(o+"="+e.parameters[o]):r.push(o)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},t.parseRtcpFb=function(e){var i=e.substr(e.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(e){var i="",s=e.payloadType;return e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(r){i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(e){var i=e.indexOf(" "),s={ssrc:parseInt(e.substr(7,i-7),10)},r=e.indexOf(":",i);return r>-1?(s.attribute=e.substr(i+1,r-i-1),s.value=e.substr(r+1)):s.attribute=e.substr(i+1),s},t.parseSsrcGroup=function(e){var i=e.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(s){return parseInt(s,10)})}},t.getMid=function(e){var i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(e){var i=e.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},t.getDtlsParameters=function(e,i){var s=t.matchPrefix(e+i,"a=fingerprint:");return{role:"auto",fingerprints:s.map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,i){var s="a=setup:"+i+`\r
`;return e.fingerprints.forEach(function(r){s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},t.parseCryptoLine=function(e){var i=e.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;var i=e.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){var s=t.matchPrefix(e+i,"a=crypto:");return s.map(t.parseCryptoLine)},t.getIceParameters=function(e,i){var s=t.matchPrefix(e+i,"a=ice-ufrag:")[0],r=t.matchPrefix(e+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substr(12),password:r.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`},t.parseRtpParameters=function(e){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(e),r=s[0].split(" "),o=3;o<r.length;o++){var a=r[o],l=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(l){var h=t.parseRtpMap(l),u=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(h.parameters=u.length?t.parseFmtp(u[0]):{},h.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase());break}}}return t.matchPrefix(e,"a=extmap:").forEach(function(d){i.headerExtensions.push(t.parseExtmap(d))}),i},t.writeRtpDescription=function(e,i){var s="";s+="m="+e+" ",s+=i.codecs.length>0?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){s+=t.writeRtpMap(o),s+=t.writeFmtp(o),s+=t.writeRtcpFb(o)});var r=0;return i.codecs.forEach(function(o){o.maxptime>r&&(r=o.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),s+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){s+=t.writeExtmap(o)}),s},t.parseRtpEncodingParameters=function(e){var i=[],s=t.parseRtpParameters(e),r=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=t.matchPrefix(e,"a=ssrc:").map(function(f){return t.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),l=a.length>0&&a[0].ssrc,h,u=t.matchPrefix(e,"a=ssrc-group:FID").map(function(f){var p=f.substr(17).split(" ");return p.map(function(g){return parseInt(g,10)})});u.length>0&&u[0].length>1&&u[0][0]===l&&(h=u[0][1]),s.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var p={ssrc:l,codecPayloadType:parseInt(f.parameters.apt,10)};l&&h&&(p.rtx={ssrc:h}),i.push(p),r&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&l&&i.push({ssrc:l});var d=t.matchPrefix(e,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(function(f){f.maxBitrate=d})),i},t.parseRtcpParameters=function(e){var i={},s=t.matchPrefix(e,"a=ssrc:").map(function(a){return t.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);var r=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;var o=t.matchPrefix(e,"a=rtcp-mux");return i.mux=o.length>0,i},t.parseMsid=function(e){var i,s=t.matchPrefix(e,"a=msid:");if(s.length===1)return i=s[0].substr(7).split(" "),{stream:i[0],track:i[1]};var r=t.matchPrefix(e,"a=ssrc:").map(function(o){return t.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},t.parseSctpDescription=function(e){var i=t.parseMLine(e),s=t.matchPrefix(e,"a=max-message-size:"),r;s.length>0&&(r=parseInt(s[0].substr(19),10)),isNaN(r)&&(r=65536);var o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};var a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){var l=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,i){var s=[];return e.protocol!=="DTLS/SCTP"?s=["m="+e.kind+" 9 "+e.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:s=["m="+e.kind+" 9 "+e.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,i,s){var r,o=i!==void 0?i:2;e?r=e:r=t.generateSessionId();var a=s||"thisisadapterortc";return`v=0\r
o=`+a+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.writeMediaSection=function(e,i,s,r){var o=t.writeRtpDescription(e.kind,i);if(o+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":"active"),o+="a=mid:"+e.mid+`\r
`,e.direction?o+="a="+e.direction+`\r
`:e.rtpSender&&e.rtpReceiver?o+=`a=sendrecv\r
`:e.rtpSender?o+=`a=sendonly\r
`:e.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+`\r
`;o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+`\r
`),o},t.getDirection=function(e,i){for(var s=t.splitLines(e),r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){var i=t.splitLines(e),s=i[0].split(" ");return s[0].substr(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){var i=t.splitLines(e),s=i[0].substr(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},t.parseOLine=function(e){var i=t.matchPrefix(e,"o=")[0],s=i.substr(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;for(var i=t.splitLines(e),s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=t})(cD);var hD=cD.exports;const xv=C0(hD);var Ve=hD;function I8(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function PI(n,t,e,i,s){var r=Ve.writeRtpDescription(n.kind,t);if(r+=Ve.writeIceParameters(n.iceGatherer.getLocalParameters()),r+=Ve.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":s||"active"),r+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?r+=`a=sendrecv\r
`:n.rtpSender?r+=`a=sendonly\r
`:n.rtpReceiver?r+=`a=recvonly\r
`:r+=`a=inactive\r
`,n.rtpSender){var o=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=o;var a="msid:"+(i?i.id:"-")+" "+o+`\r
`;r+="a="+a,r+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+a,n.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+a,r+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return r+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+Ve.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+Ve.localCName+`\r
`),r}function T8(n,t){var e=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(i){if(i&&(i.urls||i.url)){var s=i.urls||i.url;i.url&&!i.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r=typeof s=="string";return r&&(s=[s]),s=s.filter(function(o){var a=o.indexOf("turn:")===0&&o.indexOf("transport=udp")!==-1&&o.indexOf("turn:[")===-1&&!e;return a?(e=!0,!0):o.indexOf("stun:")===0&&t>=14393&&o.indexOf("?transport=udp")===-1}),delete i.url,i.urls=r?s[0]:s,!!s.length}})}function wA(n,t){var e={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(r,o){r=parseInt(r,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===r||o[a].preferredPayloadType===r)return o[a]},s=function(r,o,a,l){var h=i(r.parameters.apt,a),u=i(o.parameters.apt,l);return h&&u&&h.name.toLowerCase()===u.name.toLowerCase()};return n.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt&&!s(r,a,n.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),e.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(l){for(var h=0;h<r.rtcpFeedback.length;h++)if(r.rtcpFeedback[h].type===l.type&&r.rtcpFeedback[h].parameter===l.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(r){for(var o=0;o<t.headerExtensions.length;o++){var a=t.headerExtensions[o];if(r.uri===a.uri){e.headerExtensions.push(a);break}}}),e}function MI(n,t,e){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][n].indexOf(e)!==-1}function d_(n,t){var e=n.getRemoteCandidates().find(function(i){return t.foundation===i.foundation&&t.ip===i.ip&&t.port===i.port&&t.priority===i.priority&&t.protocol===i.protocol&&t.type===i.type});return e||n.addRemoteCandidate(t),!e}function ls(n,t){var e=new Error(t);return e.name=n,e.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],e}var R8=function(n,t){function e(l,h){h.addTrack(l),h.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:l}))}function i(l,h){h.removeTrack(l),h.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:l}))}function s(l,h,u,d){var f=new Event("track");f.track=h,f.receiver=u,f.transceiver={receiver:u},f.streams=d,n.setTimeout(function(){l._dispatchEvent("track",f)})}var r=function(l){var h=this,u=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){h[f]=u[f].bind(u)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",l=JSON.parse(JSON.stringify(l||{})),this.usingBundle=l.bundlePolicy==="max-bundle",l.rtcpMuxPolicy==="negotiate")throw ls("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(l.rtcpMuxPolicy||(l.rtcpMuxPolicy="require"),l.iceTransportPolicy){case"all":case"relay":break;default:l.iceTransportPolicy="all";break}switch(l.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:l.bundlePolicy="balanced";break}if(l.iceServers=T8(l.iceServers||[],t),this._iceGatherers=[],l.iceCandidatePoolSize)for(var d=l.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:l.iceServers,gatherPolicy:l.iceTransportPolicy}));else l.iceCandidatePoolSize=0;this._config=l,this.transceivers=[],this._sdpSessionId=Ve.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(l,h){this._isClosed||(this.dispatchEvent(h),typeof this["on"+l]=="function"&&this["on"+l](h))},r.prototype._emitGatheringStateChange=function(){var l=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",l)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(l,h){var u=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:l,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&u)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();d.iceTransport=f.iceTransport,d.dtlsTransport=f.dtlsTransport}return h||this.transceivers.push(d),d},r.prototype.addTrack=function(l,h){if(this._isClosed)throw ls("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var u=this.transceivers.find(function(p){return p.track===l});if(u)throw ls("InvalidAccessError","Track already exists.");for(var d,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===l.kind&&(d=this.transceivers[f]);return d||(d=this._createTransceiver(l.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(h)===-1&&this.localStreams.push(h),d.track=l,d.stream=h,d.rtpSender=new n.RTCRtpSender(l,d.dtlsTransport),d.rtpSender},r.prototype.addStream=function(l){var h=this;if(t>=15025)l.getTracks().forEach(function(d){h.addTrack(d,l)});else{var u=l.clone();l.getTracks().forEach(function(d,f){var p=u.getTracks()[f];d.addEventListener("enabled",function(g){p.enabled=g.enabled})}),u.getTracks().forEach(function(d){h.addTrack(d,u)})}},r.prototype.removeTrack=function(l){if(this._isClosed)throw ls("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(l instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var h=this.transceivers.find(function(f){return f.rtpSender===l});if(!h)throw ls("InvalidAccessError","Sender was not created by this connection.");var u=h.stream;h.rtpSender.stop(),h.rtpSender=null,h.track=null,h.stream=null;var d=this.transceivers.map(function(f){return f.stream});d.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(l){var h=this;l.getTracks().forEach(function(u){var d=h.getSenders().find(function(f){return f.track===u});d&&h.removeTrack(d)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(l){return!!l.rtpSender}).map(function(l){return l.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(l){return!!l.rtpReceiver}).map(function(l){return l.rtpReceiver})},r.prototype._createIceGatherer=function(l,h){var u=this;if(h&&l>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[l].bufferedCandidateEvents=[],this.transceivers[l].bufferCandidates=function(f){var p=!f.candidate||Object.keys(f.candidate).length===0;d.state=p?"completed":"gathering",u.transceivers[l].bufferedCandidateEvents!==null&&u.transceivers[l].bufferedCandidateEvents.push(f)},d.addEventListener("localcandidate",this.transceivers[l].bufferCandidates),d},r.prototype._gather=function(l,h){var u=this,d=this.transceivers[h].iceGatherer;if(!d.onlocalcandidate){var f=this.transceivers[h].bufferedCandidateEvents;this.transceivers[h].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[h].bufferCandidates),d.onlocalcandidate=function(p){if(!(u.usingBundle&&h>0)){var g=new Event("icecandidate");g.candidate={sdpMid:l,sdpMLineIndex:h};var m=p.candidate,v=!m||Object.keys(m).length===0;if(v)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),m.component=1,m.ufrag=d.getLocalParameters().usernameFragment;var y=Ve.writeCandidate(m);g.candidate=Object.assign(g.candidate,Ve.parseCandidate(y)),g.candidate.candidate=y,g.candidate.toJSON=function(){return{candidate:g.candidate.candidate,sdpMid:g.candidate.sdpMid,sdpMLineIndex:g.candidate.sdpMLineIndex,usernameFragment:g.candidate.usernameFragment}}}var b=Ve.getMediaSections(u._localDescription.sdp);v?b[g.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:b[g.candidate.sdpMLineIndex]+="a="+g.candidate.candidate+`\r
`,u._localDescription.sdp=Ve.getDescription(u._localDescription.sdp)+b.join("");var _=u.transceivers.every(function(x){return x.iceGatherer&&x.iceGatherer.state==="completed"});u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),v||u._dispatchEvent("icecandidate",g),_&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange())}},n.setTimeout(function(){f.forEach(function(p){d.onlocalcandidate(p)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var l=this,h=new n.RTCIceTransport(null);h.onicestatechange=function(){l._updateIceConnectionState(),l._updateConnectionState()};var u=new n.RTCDtlsTransport(h);return u.ondtlsstatechange=function(){l._updateConnectionState()},u.onerror=function(){Object.defineProperty(u,"state",{value:"failed",writable:!0}),l._updateConnectionState()},{iceTransport:h,dtlsTransport:u}},r.prototype._disposeIceAndDtlsTransports=function(l){var h=this.transceivers[l].iceGatherer;h&&(delete h.onlocalcandidate,delete this.transceivers[l].iceGatherer);var u=this.transceivers[l].iceTransport;u&&(delete u.onicestatechange,delete this.transceivers[l].iceTransport);var d=this.transceivers[l].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[l].dtlsTransport)},r.prototype._transceive=function(l,h,u){var d=wA(l.localCapabilities,l.remoteCapabilities);h&&l.rtpSender&&(d.encodings=l.sendEncodingParameters,d.rtcp={cname:Ve.localCName,compound:l.rtcpParameters.compound},l.recvEncodingParameters.length&&(d.rtcp.ssrc=l.recvEncodingParameters[0].ssrc),l.rtpSender.send(d)),u&&l.rtpReceiver&&d.codecs.length>0&&(l.kind==="video"&&l.recvEncodingParameters&&t<15019&&l.recvEncodingParameters.forEach(function(f){delete f.rtx}),l.recvEncodingParameters.length?d.encodings=l.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:l.rtcpParameters.compound},l.rtcpParameters.cname&&(d.rtcp.cname=l.rtcpParameters.cname),l.sendEncodingParameters.length&&(d.rtcp.ssrc=l.sendEncodingParameters[0].ssrc),l.rtpReceiver.receive(d))},r.prototype.setLocalDescription=function(l){var h=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(ls("TypeError",'Unsupported type "'+l.type+'"'));if(!MI("setLocalDescription",l.type,h.signalingState)||h._isClosed)return Promise.reject(ls("InvalidStateError","Can not set local "+l.type+" in state "+h.signalingState));var u,d;if(l.type==="offer")u=Ve.splitSections(l.sdp),d=u.shift(),u.forEach(function(p,g){var m=Ve.parseRtpParameters(p);h.transceivers[g].localCapabilities=m}),h.transceivers.forEach(function(p,g){h._gather(p.mid,g)});else if(l.type==="answer"){u=Ve.splitSections(h._remoteDescription.sdp),d=u.shift();var f=Ve.matchPrefix(d,"a=ice-lite").length>0;u.forEach(function(p,g){var m=h.transceivers[g],v=m.iceGatherer,y=m.iceTransport,b=m.dtlsTransport,_=m.localCapabilities,x=m.remoteCapabilities,S=Ve.isRejected(p)&&Ve.matchPrefix(p,"a=bundle-only").length===0;if(!S&&!m.rejected){var E=Ve.getIceParameters(p,d),M=Ve.getDtlsParameters(p,d);f&&(M.role="server"),(!h.usingBundle||g===0)&&(h._gather(m.mid,g),y.state==="new"&&y.start(v,E,f?"controlling":"controlled"),b.state==="new"&&b.start(M));var I=wA(_,x);h._transceive(m,I.codecs.length>0,!1)}})}return h._localDescription={type:l.type,sdp:l.sdp},l.type==="offer"?h._updateSignalingState("have-local-offer"):h._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(l){var h=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(ls("TypeError",'Unsupported type "'+l.type+'"'));if(!MI("setRemoteDescription",l.type,h.signalingState)||h._isClosed)return Promise.reject(ls("InvalidStateError","Can not set remote "+l.type+" in state "+h.signalingState));var u={};h.remoteStreams.forEach(function(y){u[y.id]=y});var d=[],f=Ve.splitSections(l.sdp),p=f.shift(),g=Ve.matchPrefix(p,"a=ice-lite").length>0,m=Ve.matchPrefix(p,"a=group:BUNDLE ").length>0;h.usingBundle=m;var v=Ve.matchPrefix(p,"a=ice-options:")[0];return v?h.canTrickleIceCandidates=v.substr(14).split(" ").indexOf("trickle")>=0:h.canTrickleIceCandidates=!1,f.forEach(function(y,b){var _=Ve.splitLines(y),x=Ve.getKind(y),S=Ve.isRejected(y)&&Ve.matchPrefix(y,"a=bundle-only").length===0,E=_[0].substr(2).split(" ")[2],M=Ve.getDirection(y,p),I=Ve.parseMsid(y),B=Ve.getMid(y)||Ve.generateIdentifier();if(S||x==="application"&&(E==="DTLS/SCTP"||E==="UDP/DTLS/SCTP")){h.transceivers[b]={mid:B,kind:x,protocol:E,rejected:!0};return}!S&&h.transceivers[b]&&h.transceivers[b].rejected&&(h.transceivers[b]=h._createTransceiver(x,!0));var R,P,F,j,V,X,k,O,H,ee=Ve.parseRtpParameters(y),Y,he;S||(Y=Ve.getIceParameters(y,p),he=Ve.getDtlsParameters(y,p),he.role="client"),k=Ve.parseRtpEncodingParameters(y);var ue=Ve.parseRtcpParameters(y),_e=Ve.matchPrefix(y,"a=end-of-candidates",p).length>0,Se=Ve.matchPrefix(y,"a=candidate:").map(function(Tt){return Ve.parseCandidate(Tt)}).filter(function(Tt){return Tt.component===1});if((l.type==="offer"||l.type==="answer")&&!S&&m&&b>0&&h.transceivers[b]&&(h._disposeIceAndDtlsTransports(b),h.transceivers[b].iceGatherer=h.transceivers[0].iceGatherer,h.transceivers[b].iceTransport=h.transceivers[0].iceTransport,h.transceivers[b].dtlsTransport=h.transceivers[0].dtlsTransport,h.transceivers[b].rtpSender&&h.transceivers[b].rtpSender.setTransport(h.transceivers[0].dtlsTransport),h.transceivers[b].rtpReceiver&&h.transceivers[b].rtpReceiver.setTransport(h.transceivers[0].dtlsTransport)),l.type==="offer"&&!S){R=h.transceivers[b]||h._createTransceiver(x),R.mid=B,R.iceGatherer||(R.iceGatherer=h._createIceGatherer(b,m)),Se.length&&R.iceTransport.state==="new"&&(_e&&(!m||b===0)?R.iceTransport.setRemoteCandidates(Se):Se.forEach(function(Tt){d_(R.iceTransport,Tt)})),O=n.RTCRtpReceiver.getCapabilities(x),t<15019&&(O.codecs=O.codecs.filter(function(Tt){return Tt.name!=="rtx"})),X=R.sendEncodingParameters||[{ssrc:(2*b+2)*1001}];var qe=!1;if(M==="sendrecv"||M==="sendonly"){if(qe=!R.rtpReceiver,V=R.rtpReceiver||new n.RTCRtpReceiver(R.dtlsTransport,x),qe){var Pe;H=V.track,I&&I.stream==="-"||(I?(u[I.stream]||(u[I.stream]=new n.MediaStream,Object.defineProperty(u[I.stream],"id",{get:function(){return I.stream}})),Object.defineProperty(H,"id",{get:function(){return I.track}}),Pe=u[I.stream]):(u.default||(u.default=new n.MediaStream),Pe=u.default)),Pe&&(e(H,Pe),R.associatedRemoteMediaStreams.push(Pe)),d.push([H,V,Pe])}}else R.rtpReceiver&&R.rtpReceiver.track&&(R.associatedRemoteMediaStreams.forEach(function(Tt){var ci=Tt.getTracks().find(function(Ei){return Ei.id===R.rtpReceiver.track.id});ci&&i(ci,Tt)}),R.associatedRemoteMediaStreams=[]);R.localCapabilities=O,R.remoteCapabilities=ee,R.rtpReceiver=V,R.rtcpParameters=ue,R.sendEncodingParameters=X,R.recvEncodingParameters=k,h._transceive(h.transceivers[b],!1,qe)}else if(l.type==="answer"&&!S){R=h.transceivers[b],P=R.iceGatherer,F=R.iceTransport,j=R.dtlsTransport,V=R.rtpReceiver,X=R.sendEncodingParameters,O=R.localCapabilities,h.transceivers[b].recvEncodingParameters=k,h.transceivers[b].remoteCapabilities=ee,h.transceivers[b].rtcpParameters=ue,Se.length&&F.state==="new"&&((g||_e)&&(!m||b===0)?F.setRemoteCandidates(Se):Se.forEach(function(Tt){d_(R.iceTransport,Tt)})),(!m||b===0)&&(F.state==="new"&&F.start(P,Y,"controlling"),j.state==="new"&&j.start(he));var Ye=wA(R.localCapabilities,R.remoteCapabilities),Pt=Ye.codecs.filter(function(Tt){return Tt.name.toLowerCase()==="rtx"}).length;!Pt&&R.sendEncodingParameters[0].rtx&&delete R.sendEncodingParameters[0].rtx,h._transceive(R,M==="sendrecv"||M==="recvonly",M==="sendrecv"||M==="sendonly"),V&&(M==="sendrecv"||M==="sendonly")?(H=V.track,I?(u[I.stream]||(u[I.stream]=new n.MediaStream),e(H,u[I.stream]),d.push([H,V,u[I.stream]])):(u.default||(u.default=new n.MediaStream),e(H,u.default),d.push([H,V,u.default]))):delete R.rtpReceiver}}),h._dtlsRole===void 0&&(h._dtlsRole=l.type==="offer"?"active":"passive"),h._remoteDescription={type:l.type,sdp:l.sdp},l.type==="offer"?h._updateSignalingState("have-remote-offer"):h._updateSignalingState("stable"),Object.keys(u).forEach(function(y){var b=u[y];if(b.getTracks().length){if(h.remoteStreams.indexOf(b)===-1){h.remoteStreams.push(b);var _=new Event("addstream");_.stream=b,n.setTimeout(function(){h._dispatchEvent("addstream",_)})}d.forEach(function(x){var S=x[0],E=x[1];b.id===x[2].id&&s(h,S,E,[b])})}}),d.forEach(function(y){y[2]||s(h,y[0],y[1],[])}),n.setTimeout(function(){h&&h.transceivers&&h.transceivers.forEach(function(y){y.iceTransport&&y.iceTransport.state==="new"&&y.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),y.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(l){l.iceTransport&&l.iceTransport.stop(),l.dtlsTransport&&l.dtlsTransport.stop(),l.rtpSender&&l.rtpSender.stop(),l.rtpReceiver&&l.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(l){this.signalingState=l;var h=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",h)},r.prototype._maybeFireNegotiationNeeded=function(){var l=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(l.needNegotiation){l.needNegotiation=!1;var h=new Event("negotiationneeded");l._dispatchEvent("negotiationneeded",h)}},0))},r.prototype._updateIceConnectionState=function(){var l,h={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&h[d.iceTransport.state]++}),l="new",h.failed>0?l="failed":h.checking>0?l="checking":h.disconnected>0?l="disconnected":h.new>0?l="new":h.connected>0?l="connected":h.completed>0&&(l="completed"),l!==this.iceConnectionState){this.iceConnectionState=l;var u=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",u)}},r.prototype._updateConnectionState=function(){var l,h={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(h[d.iceTransport.state]++,h[d.dtlsTransport.state]++)}),h.connected+=h.completed,l="new",h.failed>0?l="failed":h.connecting>0?l="connecting":h.disconnected>0?l="disconnected":h.new>0?l="new":h.connected>0&&(l="connected"),l!==this.connectionState){this.connectionState=l;var u=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",u)}},r.prototype.createOffer=function(){var l=this;if(l._isClosed)return Promise.reject(ls("InvalidStateError","Can not call createOffer after close"));var h=l.transceivers.filter(function(g){return g.kind==="audio"}).length,u=l.transceivers.filter(function(g){return g.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?h=1:d.offerToReceiveAudio===!1?h=0:h=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?u=1:d.offerToReceiveVideo===!1?u=0:u=d.offerToReceiveVideo)}for(l.transceivers.forEach(function(g){g.kind==="audio"?(h--,h<0&&(g.wantReceive=!1)):g.kind==="video"&&(u--,u<0&&(g.wantReceive=!1))});h>0||u>0;)h>0&&(l._createTransceiver("audio"),h--),u>0&&(l._createTransceiver("video"),u--);var f=Ve.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.transceivers.forEach(function(g,m){var v=g.track,y=g.kind,b=g.mid||Ve.generateIdentifier();g.mid=b,g.iceGatherer||(g.iceGatherer=l._createIceGatherer(m,l.usingBundle));var _=n.RTCRtpSender.getCapabilities(y);t<15019&&(_.codecs=_.codecs.filter(function(S){return S.name!=="rtx"})),_.codecs.forEach(function(S){S.name==="H264"&&S.parameters["level-asymmetry-allowed"]===void 0&&(S.parameters["level-asymmetry-allowed"]="1"),g.remoteCapabilities&&g.remoteCapabilities.codecs&&g.remoteCapabilities.codecs.forEach(function(E){S.name.toLowerCase()===E.name.toLowerCase()&&S.clockRate===E.clockRate&&(S.preferredPayloadType=E.payloadType)})}),_.headerExtensions.forEach(function(S){var E=g.remoteCapabilities&&g.remoteCapabilities.headerExtensions||[];E.forEach(function(M){S.uri===M.uri&&(S.id=M.id)})});var x=g.sendEncodingParameters||[{ssrc:(2*m+1)*1001}];v&&t>=15019&&y==="video"&&!x[0].rtx&&(x[0].rtx={ssrc:x[0].ssrc+1}),g.wantReceive&&(g.rtpReceiver=new n.RTCRtpReceiver(g.dtlsTransport,y)),g.localCapabilities=_,g.sendEncodingParameters=x}),l._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+l.transceivers.map(function(g){return g.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,l.transceivers.forEach(function(g,m){f+=PI(g,g.localCapabilities,"offer",g.stream,l._dtlsRole),f+=`a=rtcp-rsize\r
`,g.iceGatherer&&l.iceGatheringState!=="new"&&(m===0||!l.usingBundle)&&(g.iceGatherer.getLocalCandidates().forEach(function(v){v.component=1,f+="a="+Ve.writeCandidate(v)+`\r
`}),g.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var p=new n.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(p)},r.prototype.createAnswer=function(){var l=this;if(l._isClosed)return Promise.reject(ls("InvalidStateError","Can not call createAnswer after close"));if(!(l.signalingState==="have-remote-offer"||l.signalingState==="have-local-pranswer"))return Promise.reject(ls("InvalidStateError","Can not call createAnswer in signalingState "+l.signalingState));var h=Ve.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.usingBundle&&(h+="a=group:BUNDLE "+l.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),h+=`a=ice-options:trickle\r
`;var u=Ve.getMediaSections(l._remoteDescription.sdp).length;l.transceivers.forEach(function(f,p){if(!(p+1>u)){if(f.rejected){f.kind==="application"?f.protocol==="DTLS/SCTP"?h+=`m=application 0 DTLS/SCTP 5000\r
`:h+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?h+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(h+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),h+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`;return}if(f.stream){var g;f.kind==="audio"?g=f.stream.getAudioTracks()[0]:f.kind==="video"&&(g=f.stream.getVideoTracks()[0]),g&&t>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1})}var m=wA(f.localCapabilities,f.remoteCapabilities),v=m.codecs.filter(function(y){return y.name.toLowerCase()==="rtx"}).length;!v&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,h+=PI(f,m,"answer",f.stream,l._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(h+=`a=rtcp-rsize\r
`)}});var d=new n.RTCSessionDescription({type:"answer",sdp:h});return Promise.resolve(d)},r.prototype.addIceCandidate=function(l){var h=this,u;return l&&!(l.sdpMLineIndex!==void 0||l.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,f){if(h._remoteDescription)if(!l||l.candidate==="")for(var p=0;p<h.transceivers.length&&!(!h.transceivers[p].rejected&&(h.transceivers[p].iceTransport.addRemoteCandidate({}),u=Ve.getMediaSections(h._remoteDescription.sdp),u[p]+=`a=end-of-candidates\r
`,h._remoteDescription.sdp=Ve.getDescription(h._remoteDescription.sdp)+u.join(""),h.usingBundle));p++);else{var g=l.sdpMLineIndex;if(l.sdpMid){for(var m=0;m<h.transceivers.length;m++)if(h.transceivers[m].mid===l.sdpMid){g=m;break}}var v=h.transceivers[g];if(v){if(v.rejected)return d();var y=Object.keys(l.candidate).length>0?Ve.parseCandidate(l.candidate):{};if(y.protocol==="tcp"&&(y.port===0||y.port===9)||y.component&&y.component!==1)return d();if((g===0||g>0&&v.iceTransport!==h.transceivers[0].iceTransport)&&!d_(v.iceTransport,y))return f(ls("OperationError","Can not add ICE candidate"));var b=l.candidate.trim();b.indexOf("a=")===0&&(b=b.substr(2)),u=Ve.getMediaSections(h._remoteDescription.sdp),u[g]+="a="+(y.type?b:"end-of-candidates")+`\r
`,h._remoteDescription.sdp=Ve.getDescription(h._remoteDescription.sdp)+u.join("")}else return f(ls("OperationError","Can not add ICE candidate"))}else return f(ls("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},r.prototype.getStats=function(l){if(l&&l instanceof n.MediaStreamTrack){var h=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===l?h=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===l&&(h=d.rtpReceiver)}),!h)throw ls("InvalidAccessError","Invalid selector.");return h.getStats()}var u=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){d[f]&&u.push(d[f].getStats())})}),Promise.all(u).then(function(d){var f=new Map;return d.forEach(function(p){p.forEach(function(g){f.set(g.id,g)})}),f})};var o=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];o.forEach(function(l){var h=n[l];if(h&&h.prototype&&h.prototype.getStats){var u=h.prototype.getStats;h.prototype.getStats=function(){return u.apply(this).then(function(d){var f=new Map;return Object.keys(d).forEach(function(p){d[p].type=I8(d[p]),f.set(p,d[p])}),f})}}});var a=["createOffer","createAnswer"];return a.forEach(function(l){var h=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[0]=="function"||typeof u[1]=="function"?h.apply(this,[arguments[2]]).then(function(d){typeof u[0]=="function"&&u[0].apply(null,[d])},function(d){typeof u[1]=="function"&&u[1].apply(null,[d])}):h.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(l){var h=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[1]=="function"||typeof u[2]=="function"?h.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)},function(d){typeof u[2]=="function"&&u[2].apply(null,[d])}):h.apply(this,arguments)}}),["getStats"].forEach(function(l){var h=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[1]=="function"?h.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)}):h.apply(this,arguments)}}),r};const B8=C0(R8);function uD(n){const t=n&&n.navigator,e=function(s){return{name:{PermissionDeniedError:"NotAllowedError"}[s.name]||s.name,message:s.message,constraint:s.constraint,toString(){return this.name}}},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(s){return i(s).catch(r=>Promise.reject(e(r)))}}function dD(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function hx(n,t){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(s){return s}),n.RTCSessionDescription||(n.RTCSessionDescription=function(s){return s}),t.version<15025)){const i=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(s){i.set.call(this,s);const r=new Event("enabled");r.enabled=s,this.dispatchEvent(r)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const e=B8(n,t.version);n.RTCPeerConnection=function(s){return s&&s.iceServers&&(s.iceServers=E8(s.iceServers,t.version),ES("ICE servers after filtering:",s.iceServers)),new e(s)},n.RTCPeerConnection.prototype=e.prototype}function fD(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const kI=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:dD,shimGetUserMedia:uD,shimPeerConnection:hx,shimReplaceTrack:fD},Symbol.toStringTag,{value:"Module"}));function pD(n,t){const e=n&&n.navigator,i=n&&n.MediaStreamTrack;if(e.getUserMedia=function(s,r,o){S0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(s).then(r,o)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const s=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},r=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function P8(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,n.navigator.mediaDevices.getUserMedia(i)})}function gD(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ux(n,t){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=n.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=o[s]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(l=>{if(t.version<53&&!o)try{l.forEach(h=>{h.type=e[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:e[u.type]||u.type}))})}return l}).then(o,a)}}function mD(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s});const e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=e.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function AD(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),zf(n,"track",e=>(e.receiver._pc=e.srcElement,e)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function vD(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){S0("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&e.getTracks().includes(i.track)&&this.removeTrack(i)})})}function yD(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function bD(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.addTransceiver;t&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],s=i&&"sendEncodings"in i;s&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(s){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function _D(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const t=n.RTCRtpSender.prototype.getParameters;t&&(n.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function wD(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function xD(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const t=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const DI=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:bD,shimCreateAnswer:xD,shimCreateOffer:wD,shimGetDisplayMedia:P8,shimGetParameters:_D,shimGetUserMedia:pD,shimOnTrack:gD,shimPeerConnection:ux,shimRTCDataChannel:yD,shimReceiverGetStats:AD,shimRemoveStream:vD,shimSenderGetStats:mD},Symbol.toStringTag,{value:"Module"}));function CD(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>t.call(this,s,i)),i.getVideoTracks().forEach(s=>t.call(this,s,i))},n.RTCPeerConnection.prototype.addTrack=function(i,...s){return s&&s.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),t.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(e);if(i===-1)return;this._localStreams.splice(i,1);const s=e.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function SD(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),t.apply(i,arguments)}}}function ED(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype,e=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(h,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=e.apply(this,[d]);return u?(f.then(h,u),Promise.resolve()):f},t.createAnswer=function(h,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return u?(f.then(h,u),Promise.resolve()):f};let a=function(l,h,u){const d=s.apply(this,[l]);return u?(d.then(h,u),Promise.resolve()):d};t.setLocalDescription=a,a=function(l,h,u){const d=r.apply(this,[l]);return u?(d.then(h,u),Promise.resolve()):d},t.setRemoteDescription=a,a=function(l,h,u){const d=o.apply(this,[l]);return u?(d.then(h,u),Promise.resolve()):d},t.addIceCandidate=a}function ID(n){const t=n&&n.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=s=>i(TD(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(i,s,r){t.mediaDevices.getUserMedia(i).then(s,r)}.bind(t))}function TD(n){return n&&n.video!==void 0?Object.assign({},n,{video:$k(n.video)}):n}function RD(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection;n.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(S0("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new t(i,s)},n.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function BD(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function PD(n){const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return t.apply(this,arguments)}}function MD(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const OI=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:MD,shimCallbacksAPI:ED,shimConstraints:TD,shimCreateOfferLegacy:PD,shimGetUserMedia:ID,shimLocalStreamsAPI:CD,shimRTCIceServerUrls:RD,shimRemoteStreamsAPI:SD,shimTrackEventTransceiver:BD},Symbol.toStringTag,{value:"Module"}));function Cv(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const t=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new t(i),r=xv.parseCandidate(i.candidate),o=Object.assign(s,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(i)},n.RTCIceCandidate.prototype=t.prototype,zf(n,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Qp(n,t){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const e=function(a){if(!a||!a.sdp)return!1;const l=xv.splitSections(a.sdp);return l.shift(),l.some(h=>{const u=xv.parseMLine(h);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const h=parseInt(l[1],10);return h!==h?-1:h},s=function(a){let l=65536;return t.browser==="firefox"&&(t.version<57?a===-1?l=16384:l=2147483637:t.version<60?l=t.version===57?65535:65536:l=2147483637),l},r=function(a,l){let h=65536;t.browser==="firefox"&&t.version===57&&(h=65535);const u=xv.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?h=parseInt(u[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(h=2147483637),h},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const l=i(arguments[0]),h=s(l),u=r(arguments[0],l);let d;h===0&&u===0?d=Number.POSITIVE_INFINITY:h===0||u===0?d=Math.max(h,u):d=Math.min(h,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function jp(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function t(i,s){const r=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&s.sctp&&l>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const e=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=e.apply(this,arguments);return t(s,this),s},zf(n,"datachannel",i=>(t(i.channel,i.target),i))}function dx(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",s);r.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function fx(n,t){if(!n.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return e.apply(this,arguments)}}function Sv(n,t){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const e=n.RTCPeerConnection.prototype.addIceCandidate;!e||e.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const M8=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:fx,shimAddIceCandidateNullOrEmpty:Sv,shimConnectionState:dx,shimMaxMessageSize:Qp,shimRTCIceCandidate:Cv,shimSendThrowTypeError:jp},Symbol.toStringTag,{value:"Module"}));function k8({window:n}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const e=ES,i=C8(n),s={browserDetails:i,commonShim:M8,extractVersion:zp,disableLog:w8,disableWarnings:x8};switch(i.browser){case"chrome":if(!BI||!cx||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),s;if(i.version===null)return e("Chrome shim can not determine version, not shimming."),s;e("adapter.js shimming chrome."),s.browserShim=BI,Sv(n,i),eD(n,i),tD(n),cx(n,i),iD(n),aD(n,i),nD(n),sD(n),rD(n),lD(n,i),Cv(n),dx(n),Qp(n,i),jp(n),fx(n,i);break;case"firefox":if(!DI||!ux||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),s;e("adapter.js shimming firefox."),s.browserShim=DI,Sv(n,i),pD(n,i),ux(n,i),gD(n),vD(n),mD(n),AD(n),yD(n),bD(n),_D(n),wD(n),xD(n),Cv(n),dx(n),Qp(n,i),jp(n);break;case"edge":if(!kI||!hx||!t.shimEdge)return e("MS edge shim is not included in this adapter release."),s;e("adapter.js shimming edge."),s.browserShim=kI,uD(n),dD(n),hx(n,i),fD(n),Qp(n,i),jp(n);break;case"safari":if(!OI||!t.shimSafari)return e("Safari shim is not included in this adapter release."),s;e("adapter.js shimming safari."),s.browserShim=OI,Sv(n,i),RD(n),PD(n),ED(n),CD(n),SD(n),BD(n),ID(n),MD(n),Cv(n),Qp(n,i),jp(n),fx(n,i);break;default:e("Unsupported browser!");break}return s}const LI=k8({window:typeof window>"u"?void 0:window});function al(n,t,e,i){Object.defineProperty(n,t,{get:e,set:i,enumerable:!0,configurable:!0})}var f_=LI.default||LI,gp=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var t=this.getBrowser(),e=this.getVersion(),i=this.supportedBrowsers.includes(t);return i?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return f_.browserDetails.browser},n.prototype.getVersion=function(){return f_.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var t=this.getBrowser(),e=f_.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i,s=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),s=!0}catch{}finally{i&&i.close()}return s},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),FI={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},D8=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=FI,this.browser=gp.getBrowser(),this.browserVersion=gp.getVersion(),this.supports=function(){var t={browser:gp.isBrowserSupported(),webRTC:gp.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;var e;try{e=new RTCPeerConnection(FI),t.audioVideo=!0;var i=void 0;try{i=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!i.ordered;try{i.binaryType="blob",t.binaryBlob=!gp.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{e&&e.close()}return t}(),this.pack=EI.pack,this.unpack=EI.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t)},n.prototype.chunk=function(t){for(var e=[],i=t.size,s=Math.ceil(i/Rt.chunkedMTU),r=0,o=0;o<i;){var a=Math.min(i,o+Rt.chunkedMTU),l=t.slice(o,a),h={__peerData:this._dataCount,n:r,data:l,total:s};e.push(h),o=a,r++}return this._dataCount++,e},n.prototype.blobToArrayBuffer=function(t,e){var i=new FileReader;return i.onload=function(s){s.target&&e(s.target.result)},i.readAsArrayBuffer(t),i},n.prototype.binaryStringToArrayBuffer=function(t){for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=t.charCodeAt(i)&255;return e.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),Rt=new D8,kD={};al(kD,"Peer",()=>mx,n=>mx=n);var Im={},O8=Object.prototype.hasOwnProperty,Ys="~";function $g(){}Object.create&&($g.prototype=Object.create(null),new $g().__proto__||(Ys=!1));function L8(n,t,e){this.fn=n,this.context=t,this.once=e||!1}function DD(n,t,e,i,s){if(typeof e!="function")throw new TypeError("The listener must be a function");var r=new L8(e,i||n,s),o=Ys?Ys+t:t;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],r]:n._events[o].push(r):(n._events[o]=r,n._eventsCount++),n}function Ev(n,t){--n._eventsCount===0?n._events=new $g:delete n._events[t]}function xs(){this._events=new $g,this._eventsCount=0}xs.prototype.eventNames=function(){var t=[],e,i;if(this._eventsCount===0)return t;for(i in e=this._events)O8.call(e,i)&&t.push(Ys?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};xs.prototype.listeners=function(t){var e=Ys?Ys+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,r=i.length,o=new Array(r);s<r;s++)o[s]=i[s].fn;return o};xs.prototype.listenerCount=function(t){var e=Ys?Ys+t:t,i=this._events[e];return i?i.fn?1:i.length:0};xs.prototype.emit=function(t,e,i,s,r,o){var a=Ys?Ys+t:t;if(!this._events[a])return!1;var l=this._events[a],h=arguments.length,u,d;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,s),!0;case 5:return l.fn.call(l.context,e,i,s,r),!0;case 6:return l.fn.call(l.context,e,i,s,r,o),!0}for(d=1,u=new Array(h-1);d<h;d++)u[d-1]=arguments[d];l.fn.apply(l.context,u)}else{var f=l.length,p;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(t,l[d].fn,void 0,!0),h){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,e);break;case 3:l[d].fn.call(l[d].context,e,i);break;case 4:l[d].fn.call(l[d].context,e,i,s);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];l[d].fn.apply(l[d].context,u)}}return!0};xs.prototype.on=function(t,e,i){return DD(this,t,e,i,!1)};xs.prototype.once=function(t,e,i){return DD(this,t,e,i,!0)};xs.prototype.removeListener=function(t,e,i,s){var r=Ys?Ys+t:t;if(!this._events[r])return this;if(!e)return Ev(this,r),this;var o=this._events[r];if(o.fn)o.fn===e&&(!s||o.once)&&(!i||o.context===i)&&Ev(this,r);else{for(var a=0,l=[],h=o.length;a<h;a++)(o[a].fn!==e||s&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=l.length===1?l[0]:l:Ev(this,r)}return this};xs.prototype.removeAllListeners=function(t){var e;return t?(e=Ys?Ys+t:t,this._events[e]&&Ev(this,e)):(this._events=new $g,this._eventsCount=0),this};xs.prototype.off=xs.prototype.removeListener;xs.prototype.addListener=xs.prototype.on;xs.prefixed=Ys;xs.EventEmitter=xs;Im=xs;var Ee={};al(Ee,"LogLevel",()=>ar,n=>ar=n);al(Ee,"default",()=>UI,n=>UI=n);var Dh=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],o;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return r},Oh=function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},F8="PeerJS: ",ar;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(ar||(ar={}));var U8=function(){function n(){this._logLevel=ar.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){this._logLevel=t},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=ar.All&&this._print.apply(this,Oh([ar.All],Dh(t),!1))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=ar.Warnings&&this._print.apply(this,Oh([ar.Warnings],Dh(t),!1))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logLevel>=ar.Errors&&this._print.apply(this,Oh([ar.Errors],Dh(t),!1))},n.prototype.setLogFunction=function(t){this._print=t},n.prototype._print=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=Oh([F8],Dh(e),!1);for(var r in s)s[r]instanceof Error&&(s[r]="("+s[r].name+") "+s[r].message);t>=ar.All?console.log.apply(console,Oh([],Dh(s),!1)):t>=ar.Warnings?console.warn.apply(console,Oh(["WARNING"],Dh(s),!1)):t>=ar.Errors&&console.error.apply(console,Oh(["ERROR"],Dh(s),!1))},n}(),UI=new U8,OD={};al(OD,"Socket",()=>NI,n=>NI=n);var Wo;(function(n){n.Data="data",n.Media="media"})(Wo||(Wo={}));var Oi;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(Oi||(Oi={}));var El;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(El||(El={}));var jl;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(jl||(jl={}));var Xn;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(Xn||(Xn={}));var IS={};IS=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz StÃ¼ckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","SoÌˆren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var N8=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),z8=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],o;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return r},Q8=function(n,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))},j8=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},NI=function(n){N8(t,n);function t(e,i,s,r,o,a){a===void 0&&(a=5e3);var l=n.call(this)||this;l.pingInterval=a,l._disconnected=!0,l._messagesQueue=[];var h=e?"wss://":"ws://";return l._baseUrl=h+i+":"+s+r+"peerjs?key="+o,l}return t.prototype.start=function(e,i){var s=this;this._id=e;var r="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(i);this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+IS.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),Ee.default.log("Server message received:",a)}catch{Ee.default.log("Invalid server message",o.data);return}s.emit(jl.Message,a)},this._socket.onclose=function(o){s._disconnected||(Ee.default.log("Socket closed.",o),s._cleanup(),s._disconnected=!0,s.emit(jl.Disconnected))},this._socket.onopen=function(){s._disconnected||(s._sendQueuedMessages(),Ee.default.log("Socket open"),s._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(!this._wsOpen()){Ee.default.log("Cannot send heartbeat, because socket closed");return}var e=JSON.stringify({type:Xn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()},t.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},t.prototype._sendQueuedMessages=function(){var e,i,s=Q8([],z8(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=j8(s),o=r.next();!o.done;o=r.next()){var a=o.value;this.send(a)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected){if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(jl.Error,"Invalid message");return}if(this._wsOpen()){var i=JSON.stringify(e);this._socket.send(i)}}},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(Im.EventEmitter),px={};al(px,"MediaConnection",()=>jI,n=>jI=n);var TS={};al(TS,"Negotiator",()=>zI,n=>zI=n);var sy=function(){return sy=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},sy.apply(this,arguments)},xA=function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(u){try{h(i.next(u))}catch(d){o(d)}}function l(u){try{h(i.throw(u))}catch(d){o(d)}}function h(u){u.done?r(u.value):s(u.value).then(a,l)}h((i=i.apply(n,t||[])).next())})},CA=function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(u){return l([h,u])}}function l(h){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=h[0]&2?s.return:h[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;switch(s=0,r&&(h=[h[0]&2,r.value]),h[0]){case 0:case 1:r=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,s=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!r||h[1]>r[0]&&h[1]<r[3])){e.label=h[1];break}if(h[0]===6&&e.label<r[1]){e.label=r[1],r=h;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(h);break}r[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(n,e)}catch(u){h=[6,u],s=0}finally{i=r=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},zI=function(){function n(t){this.connection=t}return n.prototype.startConnection=function(t){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===Wo.Media&&t._stream&&this._addTracksToConnection(t._stream,e),t.originator){if(this.connection.type===Wo.Data){var i=this.connection,s={ordered:!!t.reliable},r=e.createDataChannel(i.label,s);i.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)},n.prototype._startPeerConnection=function(){Ee.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},n.prototype._setupListeners=function(t){var e=this,i=this.connection.peer,s=this.connection.connectionId,r=this.connection.type,o=this.connection.provider;Ee.default.log("Listening for ICE candidates."),t.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(Ee.default.log("Received ICE candidates for ".concat(i,":"),a.candidate),o.socket.send({type:Xn.Candidate,payload:{candidate:a.candidate,type:r,connectionId:s},dst:i}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":Ee.default.log("iceConnectionState is failed, closing connections to "+i),e.connection.emit("error",new Error("Negotiation of connection to "+i+" failed.")),e.connection.close();break;case"closed":Ee.default.log("iceConnectionState is closed, closing connections to "+i),e.connection.emit("error",new Error("Connection to "+i+" closed.")),e.connection.close();break;case"disconnected":Ee.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":t.onicecandidate=Rt.noop;break}e.connection.emit("iceStateChanged",t.iceConnectionState)},Ee.default.log("Listening for data channel"),t.ondatachannel=function(a){Ee.default.log("Received data channel");var l=a.channel,h=o.getConnection(i,s);h.initialize(l)},Ee.default.log("Listening for remote stream"),t.ontrack=function(a){Ee.default.log("Received remote stream");var l=a.streams[0],h=o.getConnection(i,s);if(h.type===Wo.Media){var u=h;e._addStreamToMediaConnection(l,u)}}},n.prototype.cleanup=function(){Ee.default.log("Cleaning up PeerConnection to "+this.connection.peer);var t=this.connection.peerConnection;if(t){this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=function(){};var e=t.signalingState!=="closed",i=!1;if(this.connection.type===Wo.Data){var s=this.connection,r=s.dataChannel;r&&(i=!!r.readyState&&r.readyState!=="closed")}(e||i)&&t.close()}},n.prototype._makeOffer=function(){return xA(this,void 0,Promise,function(){var t,e,i,s,r,o,a;return CA(this,function(l){switch(l.label){case 0:t=this.connection.peerConnection,e=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:i=l.sent(),Ee.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,t.setLocalDescription(i)];case 4:return l.sent(),Ee.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),s={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:Rt.browser},this.connection.type===Wo.Data&&(r=this.connection,s=sy(sy({},s),{label:r.label,reliable:r.reliable,serialization:r.serialization})),e.socket.send({type:Xn.Offer,payload:s,dst:this.connection.peer}),[3,6];case 5:return o=l.sent(),o!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(e.emitError(Oi.WebRTC,o),Ee.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=l.sent(),e.emitError(Oi.WebRTC,a),Ee.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return xA(this,void 0,Promise,function(){var t,e,i,s,r;return CA(this,function(o){switch(o.label){case 0:t=this.connection.peerConnection,e=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:i=o.sent(),Ee.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,t.setLocalDescription(i)];case 4:return o.sent(),Ee.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),e.socket.send({type:Xn.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:Rt.browser},dst:this.connection.peer}),[3,6];case 5:return s=o.sent(),e.emitError(Oi.WebRTC,s),Ee.default.log("Failed to setLocalDescription, ",s),[3,6];case 6:return[3,8];case 7:return r=o.sent(),e.emitError(Oi.WebRTC,r),Ee.default.log("Failed to create answer, ",r),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(t,e){return xA(this,void 0,Promise,function(){var i,s,r,o;return CA(this,function(a){switch(a.label){case 0:e=new RTCSessionDescription(e),i=this.connection.peerConnection,s=this.connection.provider,Ee.default.log("Setting remote description",e),r=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,i.setRemoteDescription(e)];case 2:return a.sent(),Ee.default.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),t!=="OFFER"?[3,4]:[4,r._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),s.emitError(Oi.WebRTC,o),Ee.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(t){return xA(this,void 0,Promise,function(){var e,i,s,r,o,a;return CA(this,function(l){switch(l.label){case 0:Ee.default.log("handleCandidate:",t),e=t.candidate,i=t.sdpMLineIndex,s=t.sdpMid,r=this.connection.peerConnection,o=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,r.addIceCandidate(new RTCIceCandidate({sdpMid:s,sdpMLineIndex:i,candidate:e}))];case 2:return l.sent(),Ee.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=l.sent(),o.emitError(Oi.WebRTC,a),Ee.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(t,e){if(Ee.default.log("add tracks from stream ".concat(t.id," to peer connection")),!e.addTrack)return Ee.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(i){e.addTrack(i,t)})},n.prototype._addStreamToMediaConnection=function(t,e){Ee.default.log("add stream ".concat(t.id," to media connection ").concat(e.connectionId)),e.addStream(t)},n}(),RS={};al(RS,"BaseConnection",()=>QI,n=>QI=n);var G8=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),QI=function(n){G8(t,n);function t(e,i,s){var r=n.call(this)||this;return r.peer=e,r.provider=i,r.options=s,r._open=!1,r.metadata=s.metadata,r}return Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(Im.EventEmitter),H8=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),ry=function(){return ry=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},ry.apply(this,arguments)},V8=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},jI=function(n){H8(t,n);function t(e,i,s){var r=n.call(this,e,i,s)||this;return r._localStream=r.options._stream,r.connectionId=r.options.connectionId||t.ID_PREFIX+Rt.randomToken(),r._negotiator=new TS.Negotiator(r),r._localStream&&r._negotiator.startConnection({_stream:r._localStream,originator:!0}),r}return Object.defineProperty(t.prototype,"type",{get:function(){return Wo.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(e){Ee.default.log("Receiving stream",e),this._remoteStream=e,n.prototype.emit.call(this,"stream",e)},t.prototype.handleMessage=function(e){var i=e.type,s=e.payload;switch(e.type){case Xn.Answer:this._negotiator.handleSDP(i,s.sdp),this._open=!0;break;case Xn.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:Ee.default.warn("Unrecognized message type:".concat(i," from peer:").concat(this.peer));break}},t.prototype.answer=function(e,i){var s,r;if(i===void 0&&(i={}),this._localStream){Ee.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection(ry(ry({},this.options._payload),{_stream:e}));var o=this.provider._getMessages(this.connectionId);try{for(var a=V8(o),l=a.next();!l.done;l=a.next()){var h=l.value;this.handleMessage(h)}}catch(u){s={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}this._open=!0},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(RS.BaseConnection),gx={};al(gx,"DataConnection",()=>HI,n=>HI=n);var LD={};al(LD,"EncodingQueue",()=>GI,n=>GI=n);var W8=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),GI=function(n){W8(t,n);function t(){var e=n.call(this)||this;return e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(i){e._processing=!1,i.target&&e.emit("done",i.target.result),e.doNextTask()},e.fileReader.onerror=function(i){Ee.default.error("EncodingQueue error:",i),e._processing=!1,e.destroy(),e.emit("error",i)},e}return Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),!this.processing&&this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(Im.EventEmitter),q8=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),X8=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},HI=function(n){q8(t,n);function t(e,i,s){var r=n.call(this,e,i,s)||this;return r.stringify=JSON.stringify,r.parse=JSON.parse,r._buffer=[],r._bufferSize=0,r._buffering=!1,r._chunkedData={},r._encodingQueue=new LD.EncodingQueue,r.connectionId=r.options.connectionId||t.ID_PREFIX+Rt.randomToken(),r.label=r.options.label||r.connectionId,r.serialization=r.options.serialization||El.Binary,r.reliable=!!r.options.reliable,r._encodingQueue.on("done",function(o){r._bufferedSend(o)}),r._encodingQueue.on("error",function(){Ee.default.error("DC#".concat(r.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),r.close()}),r._negotiator=new TS.Negotiator(r),r._negotiator.startConnection(r.options._payload||{originator:!0}),r}return Object.defineProperty(t.prototype,"type",{get:function(){return Wo.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;(!Rt.supports.binaryBlob||Rt.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){Ee.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(i){Ee.default.log("DC#".concat(e.connectionId," dc onmessage:"),i.data),e._handleDataMessage(i)},this.dataChannel.onclose=function(){Ee.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},t.prototype._handleDataMessage=function(e){var i=this,s=e.data,r=s.constructor,o=this.serialization===El.Binary||this.serialization===El.BinaryUTF8,a=s;if(o){if(r===Blob){Rt.blobToArrayBuffer(s,function(h){var u=Rt.unpack(h);i.emit("data",u)});return}else if(r===ArrayBuffer)a=Rt.unpack(s);else if(r===String){var l=Rt.binaryStringToArrayBuffer(s);a=Rt.unpack(l)}}else this.serialization===El.JSON&&(a=this.parse(s));if(a.__peerData){this._handleChunk(a);return}n.prototype.emit.call(this,"data",a)},t.prototype._handleChunk=function(e){var i=e.__peerData,s=this._chunkedData[i]||{data:[],count:0,total:e.total};if(s.data[e.n]=e.data,s.count++,this._chunkedData[i]=s,s.total===s.count){delete this._chunkedData[i];var r=new Blob(s.data);this._handleDataMessage({data:r})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},t.prototype.send=function(e,i){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===El.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===El.Binary||this.serialization===El.BinaryUTF8){var s=Rt.pack(e);if(!i&&s.size>Rt.chunkedMTU){this._sendChunks(s);return}Rt.supports.binaryBlob?this._bufferedSend(s):this._encodingQueue.enque(s)}else this._bufferedSend(e)},t.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){i._buffering=!1,i._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(s){return Ee.default.error("DC#:".concat(this.connectionId," Error when sending:"),s),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var i,s,r=Rt.chunk(e);Ee.default.log("DC#".concat(this.connectionId," Try to send ").concat(r.length," chunks..."));try{for(var o=X8(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l,!0)}}catch(h){i={error:h}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.handleMessage=function(e){var i=e.payload;switch(e.type){case Xn.Answer:this._negotiator.handleSDP(e.type,i.sdp);break;case Xn.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:Ee.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(RS.BaseConnection),FD={};al(FD,"API",()=>qI,n=>qI=n);var VI=function(n,t,e,i){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(u){try{h(i.next(u))}catch(d){o(d)}}function l(u){try{h(i.throw(u))}catch(d){o(d)}}function h(u){u.done?r(u.value):s(u.value).then(a,l)}h((i=i.apply(n,t||[])).next())})},WI=function(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(u){return l([h,u])}}function l(h){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=h[0]&2?s.return:h[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;switch(s=0,r&&(h=[h[0]&2,r.value]),h[0]){case 0:case 1:r=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,s=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!r||h[1]>r[0]&&h[1]<r[3])){e.label=h[1];break}if(h[0]===6&&e.label<r[1]){e.label=r[1],r=h;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(h);break}r[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(n,e)}catch(u){h=[6,u],s=0}finally{i=r=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},qI=function(){function n(t){this._options=t}return n.prototype._buildRequest=function(t){var e=this._options.secure?"https":"http",i=this._options,s=i.host,r=i.port,o=i.path,a=i.key,l=new URL("".concat(e,"://").concat(s,":").concat(r).concat(o).concat(a,"/").concat(t));return l.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),l.searchParams.set("version",IS.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return VI(this,void 0,Promise,function(){var t,e,i;return WI(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(t=s.sent(),t.status!==200)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw e=s.sent(),Ee.default.error("Error retrieving ID",e),i="",this._options.path==="/"&&this._options.host!==Rt.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return VI(this,void 0,Promise,function(){var t,e,i;return WI(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(t=s.sent(),t.status!==200)throw t.status===401?(e="",this._options.host===Rt.CLOUD_HOST?e="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":e="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)):new Error("Error. Status:".concat(t.status));return[2,t.json()];case 2:throw i=s.sent(),Ee.default.error("Error retrieving list peers",i),new Error("Could not get list peers from the server."+i);case 3:return[2]}})})},n}(),Y8=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),og=function(){return og=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},og.apply(this,arguments)},mp=function(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},K8=function(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),s,r=[],o;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return r},mx=function(n){Y8(t,n);function t(e,i){var s=n.call(this)||this;s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map;var r;return e&&e.constructor==Object?i=e:e&&(r=e.toString()),i=og({debug:0,host:Rt.CLOUD_HOST,port:Rt.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:Rt.randomToken(),config:Rt.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),s._options=i,s._options.host==="/"&&(s._options.host=window.location.hostname),s._options.path&&(s._options.path[0]!=="/"&&(s._options.path="/"+s._options.path),s._options.path[s._options.path.length-1]!=="/"&&(s._options.path+="/")),s._options.secure===void 0&&s._options.host!==Rt.CLOUD_HOST?s._options.secure=Rt.isSecure():s._options.host==Rt.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&Ee.default.setLogFunction(s._options.logFunction),Ee.default.logLevel=s._options.debug||0,s._api=new FD.API(i),s._socket=s._createServerConnection(),!Rt.supports.audioVideo&&!Rt.supports.data?(s._delayedAbort(Oi.BrowserIncompatible,"The current browser does not support WebRTC"),s):r&&!Rt.validateId(r)?(s._delayedAbort(Oi.InvalidID,'ID "'.concat(r,'" is invalid')),s):(r?s._initialize(r):s._api.retrieveId().then(function(o){return s._initialize(o)}).catch(function(o){return s._abort(Oi.ServerError,o)}),s)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,i,s=Object.create(null);try{for(var r=mp(this._connections),o=r.next();!o.done;o=r.next()){var a=K8(o.value,2),l=a[0],h=a[1];s[l]=h}}catch(u){e={error:u}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return s},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,i=new OD.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return i.on(jl.Message,function(s){e._handleMessage(s)}),i.on(jl.Error,function(s){e._abort(Oi.SocketError,s)}),i.on(jl.Disconnected,function(){e.disconnected||(e.emitError(Oi.Network,"Lost connection to server."),e.disconnect())}),i.on(jl.Close,function(){e.disconnected||e._abort(Oi.SocketClosed,"Underlying socket is already closed.")}),i},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var i,s,r=e.type,o=e.payload,a=e.src;switch(r){case Xn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Xn.Error:this._abort(Oi.ServerError,o.msg);break;case Xn.IdTaken:this._abort(Oi.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Xn.InvalidKey:this._abort(Oi.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Xn.Leave:Ee.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case Xn.Expire:this.emitError(Oi.PeerUnavailable,"Could not connect to peer ".concat(a));break;case Xn.Offer:var g=o.connectionId,m=this.getConnection(a,g);if(m&&(m.close(),Ee.default.warn("Offer received for existing Connection ID:".concat(g))),o.type===Wo.Media){var l=new px.MediaConnection(a,this,{connectionId:g,_payload:o,metadata:o.metadata});m=l,this._addConnection(a,m),this.emit("call",l)}else if(o.type===Wo.Data){var h=new gx.DataConnection(a,this,{connectionId:g,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});m=h,this._addConnection(a,m),this.emit("connection",h)}else{Ee.default.warn("Received malformed connection type:".concat(o.type));return}var u=this._getMessages(g);try{for(var d=mp(u),f=d.next();!f.done;f=d.next()){var p=f.value;m.handleMessage(p)}}catch(v){i={error:v}}finally{try{f&&!f.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}break;default:if(!o){Ee.default.warn("You received a malformed message from ".concat(a," of type ").concat(r));return}var g=o.connectionId,m=this.getConnection(a,g);m&&m.peerConnection?m.handleMessage(e):g?this._storeMessage(g,e):Ee.default.warn("You received an unrecognized message:",e);break}},t.prototype._storeMessage=function(e,i){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(i)},t.prototype._getMessages=function(e){var i=this._lostMessages.get(e);return i?(this._lostMessages.delete(e),i):[]},t.prototype.connect=function(e,i){if(i===void 0&&(i={}),this.disconnected){Ee.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Oi.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var s=new gx.DataConnection(e,this,i);return this._addConnection(e,s),s},t.prototype.call=function(e,i,s){if(s===void 0&&(s={}),this.disconnected){Ee.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Oi.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){Ee.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var r=new px.MediaConnection(e,this,og(og({},s),{_stream:i}));return this._addConnection(e,r),r},t.prototype._addConnection=function(e,i){Ee.default.log("add connection ".concat(i.type,":").concat(i.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(i)},t.prototype._removeConnection=function(e){var i=this._connections.get(e.peer);if(i){var s=i.indexOf(e);s!==-1&&i.splice(s,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,i){var s,r,o=this._connections.get(e);if(!o)return null;try{for(var a=mp(o),l=a.next();!l.done;l=a.next()){var h=l.value;if(h.connectionId===i)return h}}catch(u){s={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return null},t.prototype._delayedAbort=function(e,i){var s=this;setTimeout(function(){s._abort(e,i)},0)},t.prototype._abort=function(e,i){Ee.default.error("Aborting!"),this.emitError(e,i),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,i){Ee.default.error("Error:",i);var s;typeof i=="string"?s=new Error(i):s=i,s.type=e,this.emit("error",s)},t.prototype.destroy=function(){this.destroyed||(Ee.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var e,i;try{for(var s=mp(this._connections.keys()),r=s.next();!r.done;r=s.next()){var o=r.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){e={error:a}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var i,s,r=this._connections.get(e);if(r)try{for(var o=mp(r),a=o.next();!a.done;a=o.next()){var l=a.value;l.close()}}catch(h){i={error:h}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;Ee.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)Ee.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Ee.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},t.prototype.listAllPeers=function(e){var i=this;e===void 0&&(e=function(s){}),this._api.listAllPeers().then(function(s){return e(s)}).catch(function(s){return i._abort(Oi.ServerError,s)})},t.DEFAULT_KEY="peerjs",t}(Im.EventEmitter),Ax=kD.Peer;const J8=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return mx},default:Ax,util:Rt},Symbol.toStringTag,{value:"Module"}));let BS;function jK(){return BS}function GK(n){BS=n}function Z8(n,t){return t||(t={}),t={...BS,...t},n?new Ax(n,t):new Ax(t)}async function XI(){const n=await hh(()=>Promise.resolve().then(()=>J8),void 0,import.meta.url);return console.log(n),n.default===void 0?n:n.default}var vx;(function(n){n.ConnectionList="connection-list"})(vx||(vx={}));class $8{constructor(){c(this,"_host");c(this,"_client");c(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const t="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(t)}async trySetupHost(t){const e=await XI(),i=new e(t);i.on("error",s=>{console.error(s),this._host=void 0,this.trySetupClient(t)}),i.on("open",s=>{this._host=new t5(i)})}async trySetupClient(t){const e=await XI();this._client=new e,this._client.on("error",i=>{console.error("Client error",i)}),this._client.on("open",i=>{console.log("client connected",i),this._clientData=this._client.connect(t,{metadata:{id:i}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",s=>{console.log("<<",s)})})}}class e5{constructor(t){c(this,"_peer");this._peer=t}}class t5 extends e5{constructor(e){var i;super(e);c(this,"_connections",[]);console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(e){console.log("host connection",e),e.on("open",()=>{this._connections.push(e),this.broadcastConnection(e)})}broadcastConnection(e){const i=this._connections.map(s=>{var r;return(r=s.metadata)==null?void 0:r.id}).filter(s=>s!==void 0);this.broadcast({type:vx.ConnectionList,connections:i})}broadcast(e){if(e!=null){console.log(">>",e);for(const i in this._peer.connections){const s=this._peer.connections[i];if(s)if(Array.isArray(s))for(const r of s)r&&r.send(e);else console.warn(s)}}}}var Ho;(function(n){n[n.OnConnection=0]="OnConnection",n[n.OnRoomJoin=1]="OnRoomJoin",n[n.Queued=2]="Queued",n[n.Immediate=3]="Immediate"})(Ho||(Ho={}));const YI="https://urls.needle.tools/default-networking-backend/index";let vl="wss://needle-tiny-starter.glitch.me/socket";const nr=!!z("debugnet"),SA=!!(nr||z("debugowner")),p_=z("debugnetbin");var yx;(function(n){n.ConnectionInfo="connection-start-info"})(yx||(yx={}));var Qe;(function(n){n.Join="join-room",n.Leave="leave-room",n.JoinedRoom="joined-room",n.LeftRoom="left-room",n.UserJoinedRoom="user-joined-room",n.UserLeftRoom="user-left-room",n.RoomStateSent="room-state-sent"})(Qe||(Qe={}));class HK{constructor(){c(this,"room");c(this,"viewId");c(this,"allowEditing");c(this,"inRoom")}}class VK{constructor(){c(this,"room")}}class WK{constructor(){c(this,"userId")}}var us;(function(n){n.RequestHasOwner="request-has-owner",n.ResponseHasOwner="response-has-owner",n.RequestIsOwner="request-is-owner",n.ResponseIsOwner="response-is-owner",n.RequestOwnership="request-ownership",n.GainedOwnership="gained-ownership",n.RemoveOwnership="remove-ownership",n.LostOwnership="lost-ownership",n.GainedOwnershipBroadcast="gained-ownership-broadcast",n.LostOwnershipBroadcast="lost-ownership-broadcast"})(us||(us={}));class UD{constructor(t,e){c(this,"guid");c(this,"connection");c(this,"_hasOwnership",!1);c(this,"_isOwned");c(this,"_gainSubscription");c(this,"_lostSubscription");c(this,"_hasOwnerResponse");c(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=t,this.guid=e,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),t.beginListen(us.LostOwnership,this._lostSubscription),t.beginListen(us.GainedOwnershipBroadcast,this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),t.beginListen(us.ResponseHasOwner,this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send(us.RequestHasOwner,{guid:this.guid})}onHasOwnerResponse(t){t.guid===this.guid&&(this._isOwned=t.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen(us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this.connection.send(us.RequestHasOwner,{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(t){t.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=t.value,t.value||(SA&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((t,e)=>{this.requestOwnership();let i=0;const s=()=>{if(i++>10)return e("Timeout");setTimeout(()=>{this.hasOwnership?t(this):s()},100)};s()})}requestOwnership(){return SA&&console.log("Request ownership",this.guid),this.connection.send(us.RequestOwnership,{guid:this.guid}),this}freeOwnership(){return this.connection.send(us.RemoveOwnership,{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen(us.GainedOwnership,this._gainSubscription),this.connection.stopListen(us.LostOwnership,this._lostSubscription),this.connection.stopListen(us.ResponseHasOwner,this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(t){t.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===t.owner?(SA&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(t){t===this.guid&&(SA&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class i5{constructor(t){c(this,"context");c(this,"_peer",null);c(this,"_usersInRoomCopy",[]);c(this,"_defaultMessagesBuffer",[]);c(this,"_defaultMessagesBufferArray",[]);c(this,"netWebSocketUrlProvider");c(this,"_listeners",{});c(this,"_listenersBinary",{});c(this,"connected",!1);c(this,"channelId");c(this,"_connectionId",null);c(this,"_ws");c(this,"_waitingForSocket",{});c(this,"_isInRoom",!1);c(this,"_currentRoomName",null);c(this,"_currentRoomViewId",null);c(this,"_currentRoomAllowEditing",!0);c(this,"_currentInRoom",[]);c(this,"_state",{});c(this,"_currentDelay",-1);c(this,"_connectingToWebsocketPromise",null);this.context=t}get peer(){return this._peer||(this._peer=new $8),this._peer}tryGetState(t){return t==="invalid"?null:this._state[t]}get connectionId(){return this._connectionId}get isDebugEnabled(){return nr}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const t=new URL(window.location.href);return t.searchParams.set("view",this.currentRoomViewId),t.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var t;return((t=this._ws)==null?void 0:t.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(t){return this._currentInRoom.indexOf(t)!==-1}usersInRoom(t=null){t||(t=this._usersInRoomCopy),t.length=0;for(const e of this._currentInRoom)t.push(e);return t}joinRoom(t,e=!1){return t?t.length>1024?(console.error('Room name too long, can not join: "'+t+'". Max length is 1024 characters.'),!1):(this.connect(),nr&&console.log("join: "+t),this.send(Qe.Join,{room:t,viewOnly:e},Ho.OnConnection),!0):(console.error('Missing room name, can not join: "'+t+'"'),!1)}leaveRoom(t=null){return t||(t=this.currentRoomName),t?(this.send(Qe.Leave,{room:t}),!0):(console.error('Missing room name, can not join: "'+t+'"'),!1)}send(t,e=null,i=Ho.Queued){if(e===null&&(e={}),i===Ho.Queued){this._defaultMessagesBuffer.push({key:t,value:e});return}return this.sendWithWebsocket(t,e,i)}sendDeleteRemoteState(t){this.send("delete-state",{guid:t,dontSave:!0}),delete this._state[t]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(t){var e;p_&&console.log("<< send binary",this.context.time.frame,t.length/1024+" KB"),(e=this._ws)==null||e.send(t)}sendBufferedMessagesNow(){var i;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const t=Object.keys(this._defaultMessagesBuffer).length;for(const s in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[s];if(t<=1){this.sendWithWebsocket(r.key,r.value,Ho.Immediate);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&nr&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const e=JSON.stringify(this._defaultMessagesBufferArray);(i=this._ws)==null||i.send(e)}beginListen(t,e){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),e}stopListening(t,e){return this.stopListen(t,e)}stopListen(t,e){if(!e||!this._listeners[t])return;const i=this._listeners[t].indexOf(e);i>=0&&this._listeners[t].splice(i,1)}beginListenBinary(t,e){return this._listenersBinary[t]||(this._listenersBinary[t]=[]),this._listenersBinary[t].push(e),e}stopListenBinary(t,e){if(!this._listenersBinary[t])return;const i=this._listenersBinary[t].indexOf(e);i>=0&&this._listenersBinary[t].splice(i,1)}registerProvider(t){this.netWebSocketUrlProvider=t}async connect(){var e;if(this.connected)return Promise.resolve(!0);nr&&console.log("connecting");const t=(e=this.netWebSocketUrlProvider)==null?void 0:e.getWebsocketUrl();return t?vl=t:lU()&&(vl="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var t;(t=this._ws)==null||t.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(t,e)=>{var h,u;let i=!1;const s=d=>{i||(i=!0,t(d))};if(vl===void 0&&(console.log("Fetch default backend url: "+YI),vl=await(await fetch(YI)).text()),vl===void 0){s(!1);return}console.debug(`âŠ¡ Connecting to networking backend on
`+vl);const r=await hh(()=>import("./index-d7be2e3b.js"),[],import.meta.url),o=((h=r.default)==null?void 0:h.WebsocketBuilder)??r.WebsocketBuilder,a=((u=r.default)==null?void 0:u.ExponentialBackoff)??r.ExponentialBackoff,l=new o(vl).withMaxRetries(3).withBackoff(new a(2e3,2)).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=l,this.connected=!0,ve()||nr?console.log(`âŠž Connected to networking backend
`+vl):console.debug("âŠž Connected to networking backend",vl),s(!0),this.onSendQueued(Ho.OnConnection)}).onClose(d=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,s(!1)}).onError(d=>{console.error("âŠ  Websocket error"),s(!1)}).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build();l.addEventListener(r.WebsocketEvent.message,(d,f)=>{this.onMessage(d,f)})})}onMessage(t,e){const i=e.data;try{if(typeof i!="string"){i.size&&this.handleIncomingBinaryMessage(i);return}const s=JSON.parse(i);if(Array.isArray(s))for(const r of s)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(s);return}catch(s){nr&&i==="pong"?console.log("<<",i):ve()&&console.error("Failed to parse message",s)}}async handleIncomingBinaryMessage(t){p_&&console.log("<< bin",this.context.time.frame);const e=await t.arrayBuffer();var i=new Uint8Array(e);const s=new Zg(i),r=s.getBufferIdentifier(),o=this._listenersBinary[r],a=g8(s),l=m8(a);if(l&&typeof l=="string"&&(this._state[l]=a),!o)return;const h=a??s;for(const u of o)u(h)}handleIncomingStringMessage(t){var s,r;if(nr&&console.log("<<",t.key??t),t.key)switch(t.key){case yx.ConnectionInfo:if(t.data){const l=t.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.debug("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+t.key);break;case Qe.JoinedRoom:if(nr&&console.log(t),t){this._isInRoom=!0;const l=t;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),(p_||ve())&&console.debug("Joined Needle Engine Room: "+l.room);const h=new URL(window.location.href);h.searchParams.has("room")&&h.searchParams.delete("room"),h.searchParams.set("view",this._currentRoomViewId),console.debug(`Room view id: ${this._currentRoomViewId}
${h.href}`)}this.onSendQueued(Ho.OnRoomJoin);break;case Qe.LeftRoom:t.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case Qe.UserJoinedRoom:if(t.data){const l=t.data;this._currentInRoom.push(l.userId),nr&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case Qe.UserLeftRoom:if(t.data){const l=t.data,h=this._currentInRoom.indexOf(l.userId);h>=0&&(nr&&console.log(l.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(h,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":nr&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(s=t.data)==null?void 0:s.time;a&&(this._currentDelay=this.context.time.time-a),nr&&console.log("Current latency: "+this._currentDelay.toFixed(4)+" sec","Clients in room: "+((r=this._currentInRoom)==null?void 0:r.length));break}const e=t.data;e&&(this._state[e.guid]=e);let i=this._listeners[t.key];if(i){i=[...i];for(const o of i)try{o(t.data)}catch(a){console.error('Error invoking callback for "'+t.key+'"',a)}}}toMessage(t,e){return{key:t,data:e}}sendWithWebsocket(t,e,i=Ho.OnRoomJoin){if(!this._ws){const r=this._waitingForSocket[i]||[];r.push(()=>this.sendWithWebsocket(t,e,i)),this._waitingForSocket[i]=r;return}const s=JSON.stringify(this.toMessage(t,e));nr&&console.log(">>",t),this._ws.send(s)}onSendQueued(t){const e=this._waitingForSocket[t];if(e){for(const i of e)i();e.length=0}}}const ag=z("debugwebxr");class g_{constructor(t,e){c(this,"controllerStates",[]);c(this,"userId");c(this,"context");c(this,"userStateEvtName");c(this,"onReceivedControllerState",t=>{ag&&console.log(`XRSync: Received change for ${this.userId}: ${t.type} ${t.handedness}; tracked=${t.isTracking}`);let e=!1;for(let i=0;i<this.controllerStates.length;i++)if(this.controllerStates[i].index===t.index){this.controllerStates[i]=t,e=!0;break}e||this.controllerStates.push(t)});this.userId=t,this.context=e,this.userStateEvtName="xr-sync-user-state-"+t,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(t){if(this.context.connection.isConnected!=!1){for(let e=this.controllerStates.length-1;e>=0;e--){const i=this.controllerStates[e];let s=!1;for(let r=0;r<t.controllers.length;r++)t.controllers[r].index===i.index&&(s=!0);s||(ag&&console.log(`XRSync: ${i.type} ${i.handedness} removed`,i.index),this.controllerStates.splice(e,1),this.sendControllerRemoved(i))}for(const e of t.controllers)this.updateControllerStates(e)}}onExitXR(t){for(const e of this.controllerStates)this.sendControllerRemoved(e);this.controllerStates.length=0}sendControllerRemoved(t){t.isTracking=!1,t.guid="",this.context.connection.send(this.userStateEvtName,t),this.context.connection.sendDeleteRemoteState(t.guid)}updateControllerStates(t){const e=this.controllerStates.find(i=>i.index===t.index);if(e){let i=!1;i||(i=e.isTracking!=t.isTracking),i&&(e.isTracking=t.isTracking,this.context.connection.send(this.userStateEvtName,e))}else{const i={guid:this.userId+"-"+t.index,isTracking:t.isTracking,handedness:t.side,index:t.index,type:t.hand?"hand":"controller"};this.controllerStates.push(i),this.context.connection.send(this.userStateEvtName,i),ag&&console.log(`XRSync: ${i.type} ${i.handedness} added`,i.index)}}}class n5{constructor(t){c(this,"context");c(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(ag&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new g_(this.context.connection.connectionId,this.context)));for(const t of this.context.connection.usersInRoom())this._states.has(t)||this._states.set(t,new g_(t,this.context))}});c(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const t=this._states.get(this.context.connection.connectionId);t==null||t.dispose(),this._states.delete(this.context.connection.connectionId)}});c(this,"onOtherUserJoinedRoom",t=>{const e=t.userId;this._states.has(e)||(ag&&console.log("XRSync: Remote user joined room",e),this._states.set(e,new g_(e,this.context)))});c(this,"onOtherUserLeftRoom",t=>{const e=t.userId;if(!this._states.has(e)){const i=this._states.get(e);i==null||i.dispose(),this._states.delete(e)}});c(this,"_states",new Map);this.context=t,this.context.connection.beginListen(Qe.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qe.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(Qe.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(Qe.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(t){return t?this._states.has(t):!1}isTracking(t,e){if(!t)return;const i=this._states.get(t);if(!i)return;const s=i.controllerStates.find(r=>r.handedness===e);return(s==null?void 0:s.isTracking)||!1}getDeviceType(t,e){if(!t)return;const i=this._states.get(t);if(!i)return;const s=i.controllerStates.find(r=>r.handedness===e);return(s==null?void 0:s.type)||"unknown"}destroy(){this.context.connection.stopListen(Qe.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qe.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(Qe.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(Qe.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(t){if(this.context.connection.isConnected&&this.context.connection.connectionId){const e=this._states.get(this.context.connection.connectionId);e==null||e.update(t)}}onExitXR(t){if(this.context.connection.isConnected&&this.context.connection.connectionId){const e=this._states.get(this.context.connection.connectionId);e==null||e.onExitXR(t)}}}class KI{constructor(){c(this,"_fadeToColorQuad");c(this,"_fadeToColorMaterial");c(this,"_requestedFadeValue",0);c(this,"_transitionPromise",null);c(this,"_transitionResolve",null);this._fadeToColorMaterial=new _t({color:0,transparent:!0,depthTest:!1,fog:!1,side:_i}),this._fadeToColorQuad=new J(new pr(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(t,e){const i=this._fadeToColorQuad,s=this._fadeToColorMaterial;i.parent!==t&&s.opacity>0?t.add(i):s.opacity===0&&i.removeFromParent(),i.layers.set(2),i.material=this._fadeToColorMaterial,i.position.z=-1,i.renderOrder=1/0;const r=this._requestedFadeValue;s.opacity=ye.lerp(s.opacity,r,e/.03),Math.abs(s.opacity-r)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const t=new Promise(e=>{this._transitionResolve=e});return this._transitionPromise=t,t}}class s5 extends DP{constructor(t,e={}){const i=e.font;if(i===void 0)super();else{const s=i.generateShapes(t,e.size);e.depth=e.height!==void 0?e.height:50,e.bevelThickness===void 0&&(e.bevelThickness=10),e.bevelSize===void 0&&(e.bevelSize=8),e.bevelEnabled===void 0&&(e.bevelEnabled=!1),super(s,e)}this.type="TextGeometry"}}class r5 extends ch{constructor(t){super(t)}load(t,e,i,s){const r=this,o=new Or(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(a){const l=r.parse(JSON.parse(a));e&&e(l)},i,s)}parse(t){return new ND(t)}}class ND{constructor(t){this.isFont=!0,this.type="Font",this.data=t}generateShapes(t,e=100){const i=[],s=o5(t,e,this.data);for(let r=0,o=s.length;r<o;r++)i.push(...s[r].toShapes());return i}}function o5(n,t,e){const i=Array.from(n),s=t/e.resolution,r=(e.boundingBox.yMax-e.boundingBox.yMin+e.underlineThickness)*s,o=[];let a=0,l=0;for(let h=0;h<i.length;h++){const u=i[h];if(u===`
`)a=0,l-=r;else{const d=a5(u,s,a,l,e);a+=d.offsetX,o.push(d.path)}}return o}function a5(n,t,e,i,s){const r=s.glyphs[n]||s.glyphs["?"];if(!r){console.error('THREE.Font: character "'+n+'" does not exists in font family '+s.familyName+".");return}const o=new mF;let a,l,h,u,d,f,p,g;if(r.o){const m=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let v=0,y=m.length;v<y;)switch(m[v++]){case"m":a=m[v++]*t+e,l=m[v++]*t+i,o.moveTo(a,l);break;case"l":a=m[v++]*t+e,l=m[v++]*t+i,o.lineTo(a,l);break;case"q":h=m[v++]*t+e,u=m[v++]*t+i,d=m[v++]*t+e,f=m[v++]*t+i,o.quadraticCurveTo(d,f,h,u);break;case"b":h=m[v++]*t+e,u=m[v++]*t+i,d=m[v++]*t+e,f=m[v++]*t+i,p=m[v++]*t+e,g=m[v++]*t+i,o.bezierCurveTo(d,f,p,g,h,u);break}}return{offsetX:r.ha*t,path:o}}var Yo;(function(n){n[n.Quad=0]="Quad",n[n.Cube=1]="Cube",n[n.Sphere=2]="Sphere",n[n.RoundedCube=10]="RoundedCube"})(Yo||(Yo={}));var Am,bx;class Fu{static createText(t,e){let i=null;const s=(e==null?void 0:e.font)||c5((e==null?void 0:e.familyFamily)||null);s instanceof ND?i=Mh(this,Am,bx).call(this,t,s,e):i==null&&(i=new Ht);const r=(e==null?void 0:e.color)||16777215,o=new J(i,(e==null?void 0:e.material)??new Kn({color:r}));return this.applyDefaultObjectOptions(o,e),s instanceof Promise?s.then(a=>{o.geometry=Mh(this,Am,bx).call(this,t,a,e),e!=null&&e.onGeometry&&e.onGeometry(o)}):e!=null&&e.onGeometry&&e.onGeometry(o),o}static createOccluder(t){const e=new _t({colorWrite:!1,depthWrite:!0,side:_i});return this.createPrimitive(t,{material:e})}static createPrimitive(t,e){let i;const s=(e==null?void 0:e.color)||16777215;switch(t){case"Quad":case Yo.Quad:{const r=new pr(1,1,1,1),o=(e==null?void 0:e.material)??new Kn({color:s});e!=null&&e.texture&&"map"in o&&(o.map=e.texture),i=new J(r,o),i.name="Quad"}break;case"Cube":case Yo.Cube:{const r=new on(1,1,1),o=(e==null?void 0:e.material)??new Kn({color:s});e!=null&&e.texture&&"map"in o&&(o.map=e.texture),i=new J(r,o),i.name="Cube"}break;case Yo.RoundedCube:case"RoundedCube":{const r=l5(1,1,1,.1,2),o=(e==null?void 0:e.material)??new Kn({color:s});e!=null&&e.texture&&"map"in o&&(o.map=e.texture),i=new J(r,o),i.name="RoundedCube"}break;case"Sphere":case Yo.Sphere:{const r=new Bu(.5,16,16),o=(e==null?void 0:e.material)??new Kn({color:s});e!=null&&e.texture&&"map"in o&&(o.map=e.texture),i=new J(r,o),i.name="Sphere"}break;case"ShaderBall":i=new Lr,i.name="ShaderBall",h5(i,e);break}return this.applyDefaultObjectOptions(i,e),i}static createSprite(t){const i=new AF({color:16777215});t!=null&&t.texture&&"map"in i&&(i.map=t.texture);const s=new vF(i);return this.applyDefaultObjectOptions(s,t),s}static applyDefaultObjectOptions(t,e){t.receiveShadow=!0,t.castShadow=!0,e!=null&&e.name&&(t.name=e.name),e!=null&&e.position&&(Array.isArray(e.position)?t.position.set(e.position[0],e.position[1],e.position[2]):t.position.set(e.position.x,e.position.y,e.position.z)),e!=null&&e.rotation&&(Array.isArray(e.rotation)?t.rotation.set(e.rotation[0],e.rotation[1],e.rotation[2]):t.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z)),e!=null&&e.scale&&(typeof e.scale=="number"?t.scale.set(e.scale,e.scale,e.scale):t.scale.set(e.scale.x,e.scale.y,e.scale.z)),(e==null?void 0:e.receiveShadow)!=null&&(t.receiveShadow=e.receiveShadow),(e==null?void 0:e.castShadow)!=null&&(t.castShadow=e.castShadow),e!=null&&e.parent&&e.parent.add(t)}}Am=new WeakSet,bx=function(t,e,i){const s=(i==null?void 0:i.depth)||.1;return new s5(t,{font:e,size:1,depth:s,height:s,bevelEnabled:(i==null?void 0:i.bevel)||!1,bevelThickness:.01,bevelOffset:.01,bevelSize:.01})},Qi(Fu,Am);function l5(n,t,e,i,s){const r=new yF,o=1e-5,a=i-o;r.absarc(o,o,o,-Math.PI/2,-Math.PI,!0),r.absarc(o,t-a*2,o,Math.PI,Math.PI/2,!0),r.absarc(n-a*2,t-a*2,o,Math.PI/2,0,!0),r.absarc(n-a*2,o,o,0,-Math.PI/2,!0);const l=new DP(r,{bevelEnabled:!0,bevelSegments:s*2,steps:1,bevelSize:a,bevelThickness:i,curveSegments:s});return l.scale(1,1,1-i),l.center(),l.computeVertexNormals(),l}const EA=new Map;function c5(n){let t="";switch(n){default:case"OpenSans":t="https://cdn.needle.tools/static/fonts/facetype/Open Sans_Regular_ascii.json";break;case"Helvetiker":t="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json";break}if(EA.has(t)){const s=EA.get(t);if(s)return s}const e=new r5,i=new Promise((s,r)=>{e.load(t,o=>{EA.set(t,o),s(o)},void 0,r)});return EA.set(t,i),i}let m_=!1,A_=null;function h5(n,t){if(A_===null){const e="https://cdn.needle.tools/static/models/shaderball.glb",i=new rl,s=xS(null);i.setDRACOLoader(s.dracoLoader),i.setKTX2Loader(s.ktx2Loader),m_=!0,A_=i.loadAsync(e).then(r=>{const o=r.scene;return o.position.y-=.5,o}).catch(r=>(console.warn("Failed to load shaderball mesh: "+r.message),ZI())).finally(()=>{m_=!1})}if(m_){const e=ZI();e.name="ShaderBall-Placeholder";const i=e.children[0];(i==null?void 0:i.type)==="Mesh"&&JI(i,t),n.add(e)}A_.then(e=>{n.children.forEach(r=>{r.name==="ShaderBall-Placeholder"&&n.remove(r)});const i=e.clone(),s=i.children[0];(s==null?void 0:s.type)==="Mesh"&&JI(s,t),n.add(i)})}function JI(n,t){var i;if((t==null?void 0:t.color)||(t==null?void 0:t.material)||(t==null?void 0:t.texture)){const s=(t==null?void 0:t.material)??((i=n.material)==null?void 0:i.clone())??new Kn;t.color&&"color"in s&&s.color instanceof be&&s.color.set(t.color),t!=null&&t.texture&&"map"in s&&(s.map=t.texture),n.material=s}}function ZI(){return new Lr().add(Fu.createPrimitive("Sphere",{material:new _t({transparent:!0,opacity:.1})}))}const ZE=class{constructor(t,e,i){c(this,"_session");c(this,"_mode");c(this,"_init");c(this,"_renderer");c(this,"_camera");c(this,"_scene");c(this,"onEnd",()=>{var t;(t=this._session)==null||t.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()});c(this,"_lastTime",0);c(this,"onFrame",(t,e)=>{const i=t-this._lastTime;this.update(t,i),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)});c(this,"_objects",[]);this._mode=t,this._init=e,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new Pu({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new bt,this._scene=new ws,this._scene.fog=new OP(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(t,e){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!e)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(t,e);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new ZE(t,e,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await sc(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const t={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,t}async onBeforeHandoff(){await sc(1e3),this._scene.clear()}setupScene(){this._scene.background=new be(0),this._scene.add(new TC(5,10,1118481,1118481));const t=new zg(16777215,1);t.position.set(0,20,0),t.castShadow=!1,this._scene.add(t);const e=new zg(16777215,1);e.position.set(0,-1,0),e.castShadow=!1,this._scene.add(e);const i=new Ng(16777215,1,100,1);i.position.set(0,2,0),i.castShadow=!1,i.distance=200,this._scene.add(i);const s=50;for(let r=0;r<100;r++){const o=new Kn({color:2236962,metalness:1,roughness:.8});this.isAR&&(o.emissive=new be(Math.random(),Math.random(),Math.random()),o.emissiveIntensity=Math.random());const a=ye.random(0,1)>.5?Yo.Sphere:Yo.Cube,l=Fu.createPrimitive(a,{material:o});l.position.x=ye.random(-s,s),l.position.y=ye.random(-2,s),l.position.z=ye.random(-s,s),l.rotation.x=ye.random(0,Math.PI*2),l.rotation.y=ye.random(0,Math.PI*2),l.rotation.z=ye.random(0,Math.PI*2),l.scale.multiplyScalar(.5+Math.random()*10);const h=l.position.distanceTo(this._camera.position)-l.scale.x;h<1&&l.position.multiplyScalar(1+1/h),this._objects.push(l),this._scene.add(l)}}update(t,e){const i=t*4e-4;for(let s=0;s<this._objects.length;s++){const r=this._objects[s];r.position.y+=Math.sin(i+s*.5)*.005,r.rotateY(.002)}}};let Jc=ZE;c(Jc,"_active",null),c(Jc,"_requestInFlight",!1);var em;(function(n){const t=[];function e(){if(!(t!=null&&t.length))return!1;for(const r of t)r.exportAndOpen();return!0}n.exportAndOpen=e;function i(r){t.push(r)}n.registerExporter=i;function s(r){if(!t)return;const o=t.indexOf(r);o>=0&&t.splice(o,1)}n.unregisterExporter=s})(em||(em={}));const $I="NeedleXRSession onStart",eT="NeedleXRSession onEnd",Gi=z("debugwebxr"),tT=z("stats");let v_=0;function u5(n){let t=null;const e=n;return e.getAROverlayContainer?t=e.getAROverlayContainer():t=n,t}d5();async function d5(){var n;if(z("debugasap")){let t=globalThis["needle:XRSession"];if(t instanceof Promise){delete globalThis["needle:XRSession"],xt.addContextCreatedCallback(async e=>{if(!t)return;rf(!0);const i=await t;if(i){const s=Le.getDefaultSessionInit("immersive-vr");Le.setSession("immersive-vr",i,s,e.context)}else console.error("NeedleXRSession: ASAP session was rejected");t=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(n=navigator.xr)==null||n.addEventListener("sessiongranted",async()=>{rf(!0),console.log("Received Session Granted..."),await sc(100);const t=sessionStorage.getItem("needle_xr_session_mode"),e=sessionStorage.getItem("needle_xr_session_init")??null,i=e?JSON.parse(e):null;let s=null;if(zD()&&(await Jc.start(t||"immersive-vr",i||Le.getDefaultSessionInit("immersive-vr")),await g5(),s=await Jc.handoff()),s)Le.setSession(s.mode,s.session,s.init,je.Current);else if(t&&e){console.log("Session Granted: Restore last session");const r=JSON.parse(e);Le.start(t,r).catch(o=>console.warn(o))}else Le.start("immersive-vr").catch(r=>console.warn("Session Granted failed:",r))},{once:!0})}}function f5(n,t){sessionStorage.setItem("needle_xr_session_mode",n),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(t))}function p5(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const PS=new Set;xt.registerCallback(dt.ContextCreationStart,async n=>{PS.add(n.context)});xt.registerCallback(dt.ContextCreated,async n=>{PS.delete(n.context)});function zD(){return PS.size>0}function g5(){return new Promise(n=>{const t=Date.now(),e=setInterval(()=>{(!zD()||Date.now()-t>6e4)&&(clearInterval(e),n())},100)})}Gg()&&ve()&&window.addEventListener("keydown",n=>{(n.key==="x"||n.key==="Escape")&&Le.active&&Le.stop()});const Ml=class{constructor(t,e,i,s){c(this,"context");c(this,"session");c(this,"mode");c(this,"controllers",[]);c(this,"_rigScale",1);c(this,"_lastRigScaleUpdate",-1);c(this,"_rigs",[]);c(this,"_viewerHitTestSource",null);c(this,"_defaultRig");c(this,"_xr_scripts");c(this,"_xr_update_scripts",[]);c(this,"_inactive_scripts",[]);c(this,"_controllerAdded");c(this,"_controllerRemoved");c(this,"_originalCameraWorldPosition");c(this,"_originalCameraWorldRotation");c(this,"_originalCameraWorldScale");c(this,"_originalCameraParent");c(this,"_mainCamera",null);c(this,"onRendererSessionSet",()=>{var t;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(t=this.context.mainCameraComponent)==null||t.applyClearFlags())});c(this,"onInputSourceAdded",t=>{if(t.targetRayMode==="screen")return;let e=0;for(let s=0;s<this.session.inputSources.length;s++)if(this.session.inputSources[s]===t){e=s;break}if(this.controllers.find(s=>s.inputSource===t)){console.warn("Controller already exists for input source",e);return}Gi&&console.log("Adding controller",e);const i=new Vk(this,t,e);this._newControllers.push(i)});c(this,"_ended",!1);c(this,"_newControllers",[]);c(this,"onEnd",t=>{var s,r,o;if(this._ended)return;this._ended=!0,Gi&&console.log("XR Session ended"),p5(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,vh(this.onBefore,We.LateUpdate);const e=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);e>=0&&this.context.pre_render_callbacks.splice(e,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRender);i>=0&&this.context.post_render_callbacks.splice(i,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var a,l;(a=this.context.mainCameraComponent)==null||a.applyClearFlags(),(l=this.context.mainCameraComponent)==null||l.applyClippingPlane()}),e8({session:this});for(const a of Ml._xrEndListeners)a({xr:this});for(let a=0;a<this.controllers.length;a++)this.disconnectInputSource(this.controllers[a].inputSource);for(const a of this._xr_scripts)(s=a==null?void 0:a.onLeaveXR)==null||s.call(a,{xr:this});(r=this.sync)==null||r.onExitXR(this),this.context.mainCamera&&((o=this._originalCameraParent)==null||o.add(this.context.mainCamera),this._originalCameraWorldPosition&&Cn(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&ia(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&Kg(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),rf(!1),performance.mark(eT),performance.measure("NeedleXRSession",$I,eT)});c(this,"_didStart",!1);c(this,"onBefore",t=>{var s,r,o,a,l,h,u,d;const e=t.xrFrame;if(!e)return;performance.mark("NeedleXRSession onBefore start"),this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((s=this.rig)==null?void 0:s.isActive)==!1&&(Gi&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&((r=this._mainCamera)!=null&&r.gameObject)&&((a=(o=this._mainCamera)==null?void 0:o.gameObject)==null?void 0:a.parent)!==this.rig.gameObject&&this.rig.gameObject.add((l=this._mainCamera)==null?void 0:l.gameObject),this.internalUpdateState(),this.applyCustomForward();const i={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const f=[...this.context.new_scripts_xr];for(let p=0;p<f.length;p++){const g=this.context.new_scripts_xr[p];if(!g||g.destroyed||((h=g.supportsXR)==null?void 0:h.call(g,this.mode))==!1){this.context.new_scripts_xr.splice(p,1);continue}if(!g.activeAndEnabled){this.context.new_scripts_xr.splice(p,1),this.markInactive(g);continue}if(this.addScript(g)){this.invokeCallback_EnterXR(g);for(const m of this.controllers)this.invokeCallback_ControllerAdded(g,m)}}}}else{if(this._didStart=!0,this.mode==="immersive-vr"){const p=sl(this.context.scene.children);if(p){const g=p.getSize(Re());if(g.length()>0){const m=this._defaultRig.gameObject;m.position.set(p.min.x+g.x*.5,p.min.y,p.max.z+g.z*.5+1.5);const v=p.getCenter(Re());v.y=m.position.y,m.lookAt(v)}}}$G({session:this});for(const p of Ml._xrStartListeners)p(i);const f=[...this._xr_scripts];Gi&&console.log("NeedleXRSession start, handle scripts:",f);for(const p of f){if(p.destroyed){this._script_to_remove.push(p);continue}if(!p.activeAndEnabled){this.markInactive(p);continue}this.invokeCallback_EnterXR(p);for(const g of this.controllers)this.invokeCallback_ControllerAdded(p,g)}}this.syncCameraCullingMask();for(const f of this.controllers)f.onUpdate(e);if(this._newControllers.length>0){const f=[...this._newControllers];this._newControllers.length=0;for(const p of f){if(!p.connected){console.warn("New controller is not connected",p);continue}this.controllers.push(p);for(const g of this._xr_scripts){if(g.destroyed){this._script_to_remove.push(g);continue}g.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(g,p)}}this.controllers.sort((p,g)=>p.index-g.index)}Gi&&this.context.time.frame%30===0&&this.controllers.length<=0&&this.session.inputSources.length>0&&(rf(!0),console.error("XRControllers are not added but inputSources are present")),performance.mark("NeedleXRSession update scripts start");for(const f of this._xr_update_scripts){if(f.destroyed===!0){this._script_to_remove.push(f);continue}if(f.activeAndEnabled===!1){this.markInactive(f);continue}f.onUpdateXR&&f.onUpdateXR(i)}if(performance.mark("NeedleXRSession update scripts end"),performance.measure("NeedleXRSession update scripts","NeedleXRSession update scripts start","NeedleXRSession update scripts end"),this.handleInactiveScripts(),this._script_to_remove.length>0){const f=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const p of f)!p.destroyed&&this.running&&((u=p.onLeaveXR)==null||u.call(p,i)),this.removeScript(p)}(d=this.sync)==null||d.onUpdate(this),this.onRenderDebug(),performance.mark("NeedleXRSession onBefore end"),performance.measure("NE XR frame","NeedleXRSession onBefore start","NeedleXRSession onBefore end")});c(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)});c(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),Gg()||!this._renderOnceOnDevice){const t=this.context.renderer;if(t.xr.isPresenting&&this.context.mainCamera){this._renderOnceOnDevice=!0;const e=t.xr.enabled,i=t.getRenderTarget(),s=this.context.scene.background;t.xr.enabled=!1,t.setRenderTarget(null),this.isPassThrough&&(this.context.scene.background=null),this.context.composer?this.context.composer.render(this.context.time.deltaTime):t.render(this.context.scene,this.context.mainCamera),t.xr.enabled=e,t.setRenderTarget(i),this.context.scene.background=s}}});c(this,"_script_to_remove",[]);c(this,"_camera");c(this,"_cameraRenderParent",new ne().rotateY(Math.PI));c(this,"_previousCameraParent");c(this,"_customforward",!0);c(this,"originalCameraNearPlane");c(this,"_viewerPose");c(this,"_transformOrientation",new ie);c(this,"_transformPosition",new w);c(this,"_transition");var r,o;performance.mark($I),f5(t,s.init),this.session=e,this.mode=t,this.context=i,(Gi||z("console"))&&rf(!0),this._xr_scripts=[...s.scripts],this._xr_update_scripts=this._xr_scripts.filter(a=>typeof a.onUpdateXR=="function"),this._controllerAdded=s.controller_added,this._controllerRemoved=s.controller_removed,Ah(this.onBefore,We.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((r=s.init.optionalFeatures)!=null&&r.includes("hit-test")||(o=s.init.requiredFeatures)!=null&&o.includes("hit-test"))&&e.requestReferenceSpace("viewer").then(a=>{var l,h;return(h=(l=e.requestHitTestSource)==null?void 0:l.call(e,{space:a}))==null?void 0:h.then(u=>this._viewerHitTestSource=u).catch(u=>console.error(u))}).catch(a=>console.error(a)),this.context.mainCamera&&(this._originalCameraWorldPosition=He(this.context.mainCamera,new w),this._originalCameraWorldRotation=Gt(this.context.mainCamera,new ie),this._originalCameraWorldScale=ri(this.context.mainCamera,new w),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new h8,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let a=0;a<e.inputSources.length;a++){const l=e.inputSources[a];if(!l.handedness){console.warn("Input source in xr session has no handedness - ignoring",a);continue}this.onInputSourceAdded(l)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",a=>{for(const l of a.removed)this.disconnectInputSource(l);for(const l of a.added)this.onInputSourceAdded(l)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),"controllerAutoUpdate"in this.context.renderer.xr?(console.debug("Disabling three.js controllerAutoUpdate"),this.context.renderer.xr.controllerAutoUpdate=!1):Gi&&console.warn("controllerAutoUpdate is not available in three.js - cannot disable it")}static getXRSync(t){return this._sync||(this._sync=new n5(t)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var t;return((t=this._activeSession)==null?void 0:t.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(t=>t.some(e=>e)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(t){var e;return((e=this.xrSystem)==null?void 0:e.isSessionSupported(t).catch(i=>(Gi&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(t){this._sessionRequestStartListeners.push(t)}static offSessionRequestStart(t){const e=this._sessionRequestStartListeners.indexOf(t);e>=0&&this._sessionRequestStartListeners.splice(e,1)}static onSessionRequestEnd(t){this._sessionRequestEndListeners.push(t)}static offSessionRequestEnd(t){const e=this._sessionRequestEndListeners.indexOf(t);e>=0&&this._sessionRequestEndListeners.splice(e,1)}static onXRSessionStart(t){this._xrStartListeners.push(t)}static offXRSessionStart(t){const e=this._xrStartListeners.indexOf(t);e>=0&&this._xrStartListeners.splice(e,1)}static onXRSessionEnd(t){this._xrEndListeners.push(t)}static offXRSessionEnd(t){const e=this._xrEndListeners.indexOf(t);e>=0&&this._xrEndListeners.splice(e,1)}static onControllerAdded(t){this._controllerAddedListeners.push(t)}static offControllerAdded(t){const e=this._controllerAddedListeners.indexOf(t);e>=0&&this._controllerAddedListeners.splice(e,1)}static onControllerRemoved(t){this._controllerRemovedListeners.push(t)}static offControllerRemoved(t){const e=this._controllerRemovedListeners.indexOf(t);e>=0&&this._controllerRemovedListeners.splice(e,1)}static offerSession(t,e,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+t),e=="default"&&(e=this.getDefaultSessionInit(t)),navigator.xr.offerSession(t,{...e}).then(s=>Ml.setSession(t,s,e,i)).catch(s=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(t){switch(t){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test","unbounded"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",t),{}}}static async start(t,e,i){var a,l,h,u;if(t==="immersive-ar"&&uh()&&!await this.isARSupported()&&em.exportAndOpen())return null;if(ve()&&z("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await Jc.start(t,e||Ml.getDefaultSessionInit(t)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(Gi||ve())&&qt("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=je.Current),i||(i=xt.All[0]),!i)throw new Error("No Needle Engine Context found");switch(performance.mark("NeedleXRSession start"),e||(e={}),t){case"immersive-ar":{if(await((a=this.xrSystem)==null?void 0:a.isSessionSupported("immersive-ar"))!==!0)return console.error(t+" is not supported by this browser."),null;const f=this.getDefaultSessionInit(t),p=u5(i.domElement);p&&!zC()&&(f.domOverlay={root:p},f.optionalFeatures.push("dom-overlay")),e={...f,...e}}break;case"immersive-vr":{if(await((l=this.xrSystem)==null?void 0:l.isSessionSupported("immersive-vr"))!==!0)return console.error(t+" is not supported by this browser."),null;e={...this.getDefaultSessionInit(t),...e}}break;default:console.warn("No default session init for mode",t);break}e.optionalFeatures??(e.optionalFeatures=[]),e.requiredFeatures??(e.requiredFeatures=[]),await Jc.stop();const s=t=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;Gi?console.log(`%cRequesting ${t} session`,"font-weight:bold;",e,s):console.log(`%cRequesting ${t} session`,"font-weight:bold;");for(const d of s)d.onBeforeXR&&d.onBeforeXR(t,e);for(const d of this._sessionRequestStartListeners)d({mode:t,init:e});Gi&&bi("Requesting "+t+" session ("+Date.now()+")"),this._currentSessionRequest=(h=navigator.xr)==null?void 0:h.requestSession(t,e),this._currentSessionRequestMode=t;const r=await((u=this._currentSessionRequest)==null?void 0:u.catch(d=>{console.error(d,"Code: "+d.code),d.code===9&&qt("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&qt("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const d of this._sessionRequestEndListeners)d({mode:t,init:e,newSession:r||null});if(!r)return console.warn("XR Session request was rejected"),null;const o=this.setSession(t,r,e,i);return performance.mark("NeedleXRSession end"),performance.measure("NeedleXRSession Startup","NeedleXRSession start","NeedleXRSession end"),o}static setSession(t,e,i,s){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const r=t=="immersive-ar"?s.scripts_immersive_ar:s.scripts_immersive_vr;return this._activeSession=new Ml(t,e,s,{scripts:r,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),e.addEventListener("end",this.onEnd),Gi?console.log(`%cStarted ${t} session`,"font-weight:bold;",r):console.log(`%cStarted ${t} session`,"font-weight:bold;"),this._activeSession}static stop(){var t;(t=this._activeSession)==null||t.end()}get sync(){return Ml._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get isVisibleBlurred(){return this.session.visibilityState==="visible-blurred"}get isSystemKeyboardSupported(){return this.session.isSystemKeyboardSupported}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(t=>t.side==="left")}get rightController(){return this.controllers.find(t=>t.side==="right")}getController(t){return typeof t=="number"?this.controllers[t]||null:this.controllers.find(e=>e.side===t)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(t=>t.inputSource.targetRayMode==="tracked-pointer")||ve()&&Gg()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const t=this.frame.getImageTrackingResults();for(const e of t)if(e.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const t=this._rigs[0]??null;return t!=null&&t.gameObject&&kf(t.gameObject)||(t==null?void 0:t.isActive)===!1?(this.updateActiveXRRig(),this._rigs[0]??null):t}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(t){this._rigs.indexOf(t)>=0||(t.priority===void 0&&(t.priority=0),this._rigs.push(t),this.updateActiveXRRig())}removeRig(t){const e=this._rigs.indexOf(t);e!==-1&&(this._rigs.splice(e,1),this.updateActiveXRRig())}setRigActive(t){const e=this._rigs.indexOf(t);this._rigs.splice(e,1),this._rigs.unshift(t),this.updateActiveXRRig()}getUserOffsetInRig(){var i;const t=(i=this.context.mainCamera)==null?void 0:i.position;if(!t||!this.rig)return Re(0,0,0);const e=Re(t);return e.x*=-1,e.z*=-1,e.applyQuaternion(Ia(this.rig.gameObject.quaternion)),e}updateActiveXRRig(){const t=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let e=this._rigs[0];e&&e.priority===void 0&&(e.priority=0);for(let i=1;i<this._rigs.length;i++){const s=this._rigs[i];if(s.isActive){if(kf(s.gameObject)){this._rigs.splice(i,1),i--;continue}(!e||e.isActive===!1||s.priority!==void 0&&s.priority>e.priority)&&(e=s)}}if(t!==e){const i=this._rigs.indexOf(e);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(e)}Gi&&(t===e?console.log("Updated Active XR Rig:",e,"prev:",t):console.log("Updated Active XRRig:",e," (the same as before)"))}getHitTest(t){if(t)return this.getControllerHitTest(t);if(!this._viewerHitTestSource)return null;const e=this._viewerHitTestSource,i=this.frame.getHitTestResults(e);if(i.length>0){const s=i[0];return this.convertHitTestResult(s)}return null}getControllerHitTest(t){const e=t.getHitTestSource();if(!e)return null;const i=this.frame.getHitTestResultsForTransientInput(e);for(const s of i)if(s.inputSource===t.inputSource)for(const r of s.results)return this.convertHitTestResult(r);return null}convertHitTestResult(t){const e=this.context.renderer.xr.getReferenceSpace(),i=e&&t.getPose(e);if(i){const s=Re(i.transform.position),r=Ia(i.transform.orientation),o=this.context.mainCamera;if((o==null?void 0:o.parent)!==this._cameraRenderParent&&s.applyMatrix4(lf),o!=null&&o.parent){s.applyMatrix4(o.parent.matrixWorld),r.multiply(oo);const a=Gt(o.parent);a.premultiply(oo),r.premultiply(a)}return{hit:t,position:s,quaternion:r}}return null}convertSpace(t){const e=Re(t.position);e.applyMatrix4(lf);const i=Ia(t.orientation);return i.premultiply(oo),{position:e,quaternion:i}}disconnectInputSource(t){const e=(i,s,r)=>{if(i.inputSource===t){Gi&&console.log("Disconnecting controller",i.index),this.controllers.splice(r,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const o={xr:this,controller:i,change:"removed"};for(const a of this._xr_scripts)a.onXRControllerRemoved&&a.onXRControllerRemoved(o);i.onDisconnected()}};for(let i=this.controllers.length-1;i>=0;i--){const s=this.controllers[i];e(s,this.controllers,i)}for(let i=this._newControllers.length-1;i>=0;i--){const s=this._newControllers[i];e(s,this._newControllers,i)}}end(){this._ended||this.session.end().catch(t=>console.warn(t))}onRenderDebug(){if(Gi)for(const t of this.controllers)t.onRenderDebug();if((Gi||tT)&&this.rig&&(v_++,v_>=20)){const t=this.rig.gameObject.worldPosition,e=this.rig.gameObject.worldForward;t.add(e.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;t.add(i.multiplyScalar(2.5));let s="";if(s+=`${this.context.time.smoothedFps.toFixed(0)} FPS`,s+=`, calls: ${this.context.renderer.info.render.calls}, tris: ${this.context.renderer.info.render.triangles.toLocaleString()}`,Gi||tT)for(const r of this.controllers)s+=`
${r.hand?"hand":"ctrl"} ${r.inputSource.handedness}[${r.index}] con:${r.connected} tr:${r.isTracking} hts:${r.hasHitTestSource?"yes":"no"}`;v_=0,Be.DrawLabel(t,s,void 0,1/60*20)}}addScript(t){return this._xr_scripts.includes(t)?!1:(Gi&&console.log("Register new XRScript",t),this._xr_scripts.push(t),typeof t.onUpdateXR=="function"&&this._xr_update_scripts.push(t),!0)}markInactive(t){if(!(this._inactive_scripts.indexOf(t)>=0)){this.removeScript(t,!1),this._inactive_scripts.push(t);for(const e of this.controllers)this.invokeCallback_ControllerRemoved(t,e);this.invokeCallback_LeaveXR(t)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let t=this._inactive_scripts.length-1;t>=0;t--){const e=this._inactive_scripts[t];if(e.activeAndEnabled){this._inactive_scripts.splice(t,1),this.addScript(e),this.invokeCallback_EnterXR(e);for(const i of this.controllers)this.invokeCallback_ControllerAdded(e,i)}}}removeScript(t,e=!0){Gi&&console.log("Remove XRScript",t);const i=this._xr_scripts.indexOf(t);i>=0&&this._xr_scripts.splice(i,1);const s=this._xr_update_scripts.indexOf(t);if(s>=0&&this._xr_update_scripts.splice(s,1),e){const r=this._inactive_scripts.indexOf(t);r>=0&&this._inactive_scripts.splice(r,1)}}invokeCallback_EnterXR(t){t.onEnterXR&&t.onEnterXR({xr:this})}invokeCallback_ControllerAdded(t,e){t.onXRControllerAdded&&t.onXRControllerAdded({xr:this,controller:e,change:"added"})}invokeCallback_ControllerRemoved(t,e){t.onXRControllerRemoved&&t.onXRControllerRemoved({xr:this,controller:e,change:"removed"})}invokeCallback_LeaveXR(t){t.onLeaveXR&&!t.destroyed&&t.onLeaveXR({xr:this})}syncCameraCullingMask(){var i;const t=this.context.xrCamera,e=(i=this.context.mainCameraComponent)==null?void 0:i.cullingMask;if(t&&e!==void 0){for(const s of t.cameras)s.layers.mask=e;t.layers.mask=e}else if(t){for(const s of t.cameras)s.layers.enableAll();t.layers.enableAll()}}invokeControllerEvent(t,e,i){for(let s=e.length-1;s>=0;s--){const r=e[s];if(r)try{r({xr:this,controller:t,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var t;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(t=this._previousCameraParent)==null||t.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let e=.02;if(this.rig){const i=ri(this.rig.gameObject);e*=i.x}this._camera instanceof bt&&this._camera.near>e&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=e)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof bt&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const t=this.context.renderer.xr.getReferenceSpace();if(!t){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(t),this._viewerPose){const e=this._viewerPose.transform;this._transformPosition.set(e.position.x,e.position.y,e.position.z),this._transformOrientation.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w)}}get transition(){return this._transition||(this._transition=new KI),this._transition}fadeTransition(){return this._transition||(this._transition=new KI),this._transition.fadeTransition()}updateFade(t){this._transition&&t instanceof bt&&this._transition.update(t,this.context.time.deltaTime)}onUpdateFade_PostRender(){var t;(t=this._transition)==null||t.remove()}};let Le=Ml;c(Le,"_sync",null),c(Le,"_currentSessionRequestMode",null),c(Le,"_currentSessionRequest"),c(Le,"_activeSession"),c(Le,"_sessionRequestStartListeners",[]),c(Le,"_sessionRequestEndListeners",[]),c(Le,"_xrStartListeners",[]),c(Le,"_xrEndListeners",[]),c(Le,"_controllerAddedListeners",[]),c(Le,"_controllerRemovedListeners",[]),c(Le,"onEnd",()=>{Gi&&console.log("XR Session ended"),Ml._activeSession=null});const y_=z("debugwebxr");class m5{static tryFindAvatarObjects(t,e,i){if(i.head&&i.leftHand&&i.rightHand)return;const s=t.name.toLocaleLowerCase();!i.head&&s.includes("head")&&(y_&&console.log("FOUND AVATAR HEAD",t.name),i.head=new et("",e,t)),s.includes("hand")&&(!i.leftHand&&s.includes("left")&&(y_&&console.log("FOUND AVATAR LEFT HAND",t.name),i.leftHand=new et("",e,t)),!i.rightHand&&s.includes("right")&&(y_&&console.log("FOUND AVATAR RIGHT HAND",t.name),i.rightHand=new et("",e,t)));for(let r=0;r<t.children.length;r++){if(i.head&&i.leftHand&&i.rightHand)return;const o=t.children[r];this.tryFindAvatarObjects(o,e,i)}}}const cs=new w,iT=new w,nT=new ie,A5=z("debuggizmos"),Oo=8947848,b_=32,io=class{constructor(){}static isGizmo(t){return t[_x]!==void 0}static DrawLabel(t,e,i=.05,s=0,r,o,a){var u;if(!io.enabled)return null;r||(r=Oo);const l=((u=Le.active)==null?void 0:u.rigScale)??1,h=ni.getTextLabel(s,e,i*l,r,o);return a instanceof ne&&a.add(h),h.position.x=t.x,h.position.y=t.y,h.position.z=t.z,h}static DrawRay(t,e,i=Oo,s=0,r=!0){if(!io.enabled)return;const o=ni.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,t.x,t.y,t.z),cs.set(e.x,e.y,e.z).multiplyScalar(999999999),a.setXYZ(1,t.x+cs.x,t.y+cs.y,t.z+cs.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(t,e,i=Oo,s=0,r=!0,o=1){if(!io.enabled)return;const a=ni.getLine(s),l=a.geometry.getAttribute("position");l.setXYZ(0,t.x,t.y,t.z),e.w!==void 0?(cs.set(0,0,-o),nT.set(e.x,e.y,e.z,e.w),cs.applyQuaternion(nT)):(cs.set(e.x,e.y,e.z),cs.multiplyScalar(o)),l.setXYZ(1,t.x+cs.x,t.y+cs.y,t.z+cs.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(t,e,i=Oo,s=0,r=!0){if(!io.enabled)return;const o=ni.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,t.x,t.y,t.z),a.setXYZ(1,e.x,e.y,e.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawCircle(t,e,i,s=Oo,r=0,o=!0){if(!io.enabled)return;const a=ni.getCircle(r);a.position.set(t.x,t.y,t.z),a.scale.set(i,i,i),a.quaternion.setFromUnitVectors(this._up,cs.set(e.x,e.y,e.z).normalize()),a.material.color.set(s),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawWireSphere(t,e,i=Oo,s=0,r=!0){if(!io.enabled)return;const o=ni.getSphere(e,s,!0);Tf(o,t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawSphere(t,e,i=Oo,s=0,r=!0){if(!io.enabled)return;const o=ni.getSphere(e,s,!1);Tf(o,t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireBox(t,e,i=Oo,s=0,r=!0){if(!io.enabled)return;const o=ni.getBox(s);o.position.set(t.x,t.y,t.z),o.scale.set(e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireBox3(t,e=Oo,i=0,s=!0){if(!io.enabled)return;const r=ni.getBox(i);r.position.copy(t.getCenter(cs)),r.scale.copy(t.getSize(cs)),r.material.color.set(e),r.material.depthTest=s,r.material.wireframe=!0,r.material.depthWrite=!1,r.material.fog=!1}static DrawArrow(t,e,i=Oo,s=0,r=!0,o=!1){if(!io.enabled)return;const a=ni.getArrowHead(s);a.position.set(e.x,e.y,e.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),cs.set(e.x,e.y,e.z).sub(iT.set(t.x,t.y,t.z)).normalize());const h=cs.set(e.x,e.y,e.z).sub(iT.set(t.x,t.y,t.z)).length()*.1;a.scale.set(h,h,h),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(t,e,i,s,r)}static DrawWireMesh(t){const e=ni.getMesh(t.duration??0);"mesh"in t?(e.geometry=t.mesh.geometry,e.matrix.copy(t.mesh.matrixWorld)):(e.geometry=t.geometry,e.matrix.copy(t.matrix)),e.matrixAutoUpdate=!1,e.matrixWorldAutoUpdate=!1,e.material.color.set(t.color??Oo),e.material.depthTest=t.depthTest??!0,e.material.wireframe=!0}static setVisible(t){for(const e of ni.timedObjectsBuffer)e.visible=t}};let Be=io;c(Be,"enabled",!0),c(Be,"_up",new w(0,1,0));const v5=new on(1,1,1);function MS(n=null){const t=new be(n??14540253),e=new bF(v5);return new xf(e,new Jo({color:t}))}const _x=Symbol("GizmoCache");class ni{static ensureFont(){let t=Wt.FontLibrary.getFontFamily(this.familyName);if(!t){t=Wt.FontLibrary.addFontFamily(this.familyName);const e=t.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");e==null||e.addEventListener("ready",()=>{Wt.update()})}}static getTextLabel(t,e,i,s,r){this.ensureFont();let o=this.textLabelCache.pop(),a=1;r&&typeof r=="string"&&(r==null?void 0:r.length)>=8&&r.startsWith("#")?(a=parseInt(r.substring(7),16)/255,r=r.substring(0,7),A5&&console.log(r,a)):typeof r=="object"&&r.a!==void 0&&(a=r.a);const l={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:i,color:s,lineHeight:1,backgroundColor:r??void 0,backgroundOpacity:a,textContent:e,borderRadius:.5*i,padding:.8*i,whiteSpace:"pre",offset:.05*i};if(o)o.set(l);else{o=new dS(l);const h=this,u=o;u.setText=function(d){this.set({textContent:d}),h.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(je.Current,o,t,this.textLabelCache),o}static getBox(t){let e=this.boxesCache.pop();if(!e){const i=new on(1,1,1);e=new J(i)}return this.registerTimedObject(je.Current,e,t,this.boxesCache),e}static getLine(t){let e=this.linesCache.pop();if(!e){e=new ms;let i=e.geometry.getAttribute("position");i||(i=new Ke(new Float32Array(2*3),3),e.geometry.setAttribute("position",i))}return e.frustumCulled=!1,this.registerTimedObject(je.Current,e,t,this.linesCache),e}static getCircle(t){let e=this.circlesCache.pop();if(!e){e=new ms;let i=e.geometry.getAttribute("position");if(!i){i=new Ke(new Float32Array(b_*3),3),e.geometry.setAttribute("position",i);const s=Re(0,1,0),r=Re(0,0,1),o=Re(r);o.cross(s).normalize();const a=Re(o),l=Math.PI*2/(b_-1);for(let h=0;h<b_+1;h++){const u=l*h;s.copy(a).multiplyScalar(Math.cos(u)*1),o.copy(r).multiplyScalar(Math.sin(u)*1);const d=s.add(o);i.setXYZ(h,d.x,d.y,d.z)}}}return e.frustumCulled=!1,this.registerTimedObject(je.Current,e,t,this.circlesCache),e}static getSphere(t,e,i){let s=this.spheresCache.pop();return s||(s=new J(new Bu(1,8,8))),s.scale.set(t,t,t),s.material.wireframe=i,this.registerTimedObject(je.Current,s,e,this.spheresCache),s}static getArrowHead(t){let e=this.arrowHeadsCache.pop();return e||(e=new J(new Us(0,.5,1,8))),this.registerTimedObject(je.Current,e,t,this.arrowHeadsCache),e}static getMesh(t){let e=this.mesh.pop();return e||(e=new J,e.material=new _t),this.registerTimedObject(je.Current,e,t,this.mesh),e}static registerTimedObject(t,e,i,s){if(!t){console.error("No Needle Engine context available. Did you call a Gizmos function in global scope?");return}const r=this.contextBeforeRenderCallbacks.get(t),o=this.contextPostRenderCallbacks.get(t);if(r){if(t.pre_render_callbacks[t.pre_render_callbacks.length-1]!==r){const a=t.pre_render_callbacks.indexOf(r);a>=0&&t.pre_render_callbacks.splice(a,1),t.pre_render_callbacks.push(r)}}else{const a=()=>{this.onBeforeRender(t,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(t,a),t.pre_render_callbacks.push(a)}if(o){if(t.post_render_callbacks[t.post_render_callbacks.length-1]!==o){const a=t.post_render_callbacks.indexOf(o);a>=0&&t.post_render_callbacks.splice(a,1),t.post_render_callbacks.push(o)}}else{const a=()=>{this.onPostRender(t,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(t,a),t.post_render_callbacks.push(a)}e.traverse(a=>{a.layers.disableAll(),a.layers.enable(2)}),e.renderOrder=999999,e[_x]=s,e.castShadow=!1,e.receiveShadow=!1,e.isGizmo=!0,this.timedObjectsBuffer.push(e),this.timesBuffer.push(je.Current.time.realtimeSinceStartup+i),t.scene.add(e)}static onBeforeRender(t,e){this.tmuiNeedsUpdate&&(this.tmuiNeedsUpdate=!1,Wt.update());for(let i=0;i<e.length;i++){const s=e[i];if(t.mainCamera&&s instanceof Wt.MeshUIBaseElement){if(kf(s))continue;const r=t.isInVR,o=!1,a=!r;y0(s,t.mainCamera,o,a)}}}static onPostRender(t,e,i){const s=t.time.realtimeSinceStartup;for(let r=e.length-1;r>=0;r--){const o=e[r];s>=i[r]-1e-6&&(e.splice(r,1),i.splice(r,1),o.removeFromParent(),kf(o)!=!0&&o[_x].push(o))}}}c(ni,"familyName","needle-gizmos"),c(ni,"linesCache",[]),c(ni,"circlesCache",[]),c(ni,"spheresCache",[]),c(ni,"boxesCache",[]),c(ni,"arrowHeadsCache",[]),c(ni,"mesh",[]),c(ni,"textLabelCache",[]),c(ni,"timedObjectsBuffer",new Array),c(ni,"timesBuffer",new Array),c(ni,"contextPostRenderCallbacks",new Map),c(ni,"contextBeforeRenderCallbacks",new Map),c(ni,"tmuiNeedsUpdate",!1);const Vo=z("debugphysics"),sT=new go;class rc{constructor(){c(this,"ray");c(this,"cam");c(this,"screenPoint");c(this,"raycaster");c(this,"results");c(this,"targets");c(this,"recursive",!0);c(this,"minDistance");c(this,"maxDistance");c(this,"lineThreshold");c(this,"layerMask");c(this,"ignore");c(this,"testObject");c(this,"useAcceleratedRaycast")}screenPointFromOffset(t,e){this.screenPoint===void 0&&(this.screenPoint=new oe),this.screenPoint.x=t/window.innerWidth*2-1,this.screenPoint.y=-(e/window.innerHeight)*2+1}setLayer(t){sT.set(t),this.layerMask=sT}setMask(t){this.layerMask||(this.layerMask=new go);const e=this.layerMask;e?e.mask=t:this.layerMask=t}}c(rc,"AllLayers",4294967295);class QD{constructor(t,e,i){c(this,"distance");c(this,"point");c(this,"object");this.object=t,this.distance=e,this.point=i}}const Yy=class{constructor(t){c(this,"context");c(this,"engine");c(this,"raycaster",new ku);c(this,"defaultRaycastOptions",new rc);c(this,"targetBuffer",new Array(1));c(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}});c(this,"sphereResults",new Array);c(this,"sphereMask",new go);c(this,"sphere",new uc);c(this,"tempBoundingBox",new xn);this.context=t}static get raycasting(){return this._raycasting>0}raycastPhysicsFast(t,e=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(t,e,{maxDistance:i,solid:s}))??null}raycastPhysicsFastAndGetNormal(t,e=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(t,e,{maxDistance:i,solid:s}))??null}sphereOverlapPhysics(t,e){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(t,e))??null}sphereOverlap(t,e,i=!0,s=!1,r=null){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const o=this.sphereMask;o.enableAll(),o.disable(2);for(const a of this.context.scene.children)this.intersectSphere(a,t,e,o,this.sphereResults,i,s,r);return this.sphereResults.sort((a,l)=>a.distance-l.distance)}raycastFromRay(t,e=null){const i=e??this.defaultRaycastOptions;i.ray=t;const s=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),s}raycast(t=null){Vo&&performance.mark("raycast.start"),t||(t=this.defaultRaycastOptions);const e=t.screenPoint??this.context.input.mousePositionRC,i=t.raycaster??this.raycaster;if(i.near=t.minDistance??0,i.far=t.maxDistance??1/0,i.params=this.defaultThresholds,t.lineThreshold===void 0&&(t.lineThreshold=-1),i.params.Line={threshold:t.lineThreshold},t.ray)i.ray.copy(t.ray);else{const a=t.cam??this.context.mainCamera;if(!a)return Vo&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const l=this.context.xrCamera;this.context.isInXR&&l instanceof _F&&l.cameras.length>0?i.setFromCamera(e,l.cameras[0]):i.setFromCamera(e,a)}let s=t.targets;s||(s=this.targetBuffer,s.length=1,s[0]=this.context.scene);let r=t.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),t.layerMask!==void 0?t.layerMask instanceof go?i.layers.mask=t.layerMask.mask:i.layers.mask=t.layerMask:(i.layers.enableAll(),i.layers.disable(2)),Vo&&(Be.DrawRay(i.ray.origin,i.ray.direction,16711680,2),console.time("raycast")),r.length=0,Yy._raycasting++,this.intersect(this.raycaster,s,r,t),r.sort((a,l)=>a.distance-l.distance);const o=t.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),Yy._raycasting--,Vo&&(console.timeEnd("raycast"),console.warn("#"+this.context.time.frame+", hits:",r!=null&&r.length?[...r]:"nothing"),performance.mark("raycast.end"),performance.measure("raycast","raycast.start","raycast.end")),r}intersect(t,e,i,s){var r,o,a;for(const l of e){if(!l||l.visible===!1||Be.isGizmo(l)||s.lineThreshold!==void 0&&s.lineThreshold<0&&l instanceof ms)continue;let h=!0;const u=l,d=u.geometry;if(s.testObject){const f=(r=s.testObject)==null?void 0:r.call(s,l);if(f===!1)continue;f==="continue in children"&&(h=!1)}if(h&&(d&&rT(d)||(h=!1)),h){const f=Sm(l);f&&(u.geometry=f);const p=i.length;let g=!0;s.precise===!1&&(g=!1),g||(g=((a=(o=d.getAttribute("position"))==null?void 0:o.array)==null?void 0:a.length)<64),u instanceof If&&(g=!1),!g&&b5(u,t,i)||(s.useAcceleratedRaycast!==!1?oy.runMeshBVHRaycast(t,u,i,this.context):t.intersectObject(u,!1,i)),Vo&&i.length!=p&&Be.DrawWireMesh({mesh:l,depthTest:!1,duration:.2,color:f?8969557:7798784}),u.geometry=d}s.recursive!==!1&&this.intersect(t,l.children,i,s)}return i}intersectSphere(t,e,i,s,r,o,a,l){let h=t&&t.isMesh&&t.layers.test(s)&&!Be.isGizmo(t);h&&(h=t.visible),h&&(h=!(t instanceof ms)),h&&(h=!(t instanceof If));const u=t,d=u.geometry;if(h&&l){const f=l(t);if(f===!1)return;f==="continue in children"&&(h=!1)}if(d&&rT(d)||(h=!1),h){if(a){const f=this.sphere;f.center.copy(e),f.radius=i;const p=r.length;if(oy.runMeshBVHRaycast(this.sphere,u,r,this.context),p!=r.length&&!o)return}else if(d.boundingBox||d.computeBoundingBox(),d.boundingBox){u.matrixWorldNeedsUpdate&&u.updateWorldMatrix(!1,!1);const f=this.tempBoundingBox.copy(d.boundingBox).applyMatrix4(u.matrixWorld),p=this.sphere;if(p.center.copy(e),p.radius=i,p.intersectsBox(f)){const g=He(t),m=g.distanceTo(p.center),v=new QD(t,m,g);if(r.push(v),!o)return}}}if(t.children)for(const f of t.children){const p=r.length;if(this.intersectSphere(f,e,i,s,r,o,a,l),p!=r.length&&!o)return}}};let lg=Yy;c(lg,"_raycasting",0);function rT(n){return!(n.index&&n.index.array.length<3)}const Lh=new uc,IA=new ic,y5=new za;function b5(n,t,e){const i=n._computeIntersections;if(!i)return!1;let s=n["_computeIntersections:Needle"];return s||(s=n["_computeIntersections:Needle"]=function(r,o,a){const l=this,h=l.geometry.boundingSphere;if(h){if(l instanceof If){IA.setFromNormalAndCoplanarPoint(Re(0,1,0),Re(0,-l.position.y,0)),IA.applyMatrix4(l.matrixWorld,y5);const d=r.ray.intersectPlane(IA,Re());if(d){Lh.copy(h),Lh.applyMatrix4(l.matrixWorld);const p=Re(d).sub(r.ray.origin).length(),g=Lh.radius*.5;p<g&&o.push({distance:p,point:d,object:l,normal:IA.normal.clone()})}return}Lh.copy(h),Lh.applyMatrix4(l.matrixWorld);const u=r.ray.intersectSphere(Lh,Re());if(u){const d=Re(u).sub(r.ray.origin),f=d.length();if(f>Lh.radius){const p=d.clone().normalize();o.push({distance:f,point:u,object:l,normal:p})}}}}),n._computeIntersections=s,t.intersectObject(n,!1,e),n._computeIntersections=i,!0}var oy;(function(n){function t(y,b,_,x){var E,M,I;if(!b.geometry||!b.geometry.hasAttribute("position"))return!1;const S=b.geometry;if(b!=null&&b.isSkinnedMesh){const B=b,R=B.bvhNeedsUpdate;if(!B.staticGenerator)a(),r&&(B.staticGenerator=new r(b),B.staticGenerator.applyWorldTransforms=!1,B.staticGeometry=B.staticGenerator.generate(),S.boundsTree=o==null?void 0:o.call(B.staticGeometry),B.staticGeometryLastUpdate=performance.now()+Math.random()*200,B.autoUpdateMeshBVH===void 0&&(B.autoUpdateMeshBVH=!1));else if(S.boundsTree&&(B.autoUpdateMeshBVH===!0||R===!0)){const P=performance.now(),F=P-B.staticGeometryLastUpdate;(R||F>100)&&(B.bvhNeedsUpdate=!1,B.staticGeometryLastUpdate=P,(E=B.staticGenerator)==null||E.generate(B.staticGeometry),S.boundsTree.refit())}}else if(!S.boundsTree){h||v();let B=!0;if((x.xr||S[p]===!1||(M=S.getAttribute("position"))!=null&&M.isInterleavedBufferAttribute||S.index&&((I=S.index)!=null&&I.isInterleavedBufferAttribute))&&(B=!1),B&&d){if(S[f]===void 0){let R=null;if(m.length>0){const P=m.shift();P&&!P.running&&(R=P)}if(!R&&g.length<3&&(R=new d,g.push(R)),R!=null&&!R.running){Vo&&console.log("<<<< worker start",R),S[f]="queued",performance.mark("bvh.create.start");const P=S.clone();R.generate(P).then(F=>{S[f]="done",S.boundsTree=F}).catch(F=>{S[f]="failed - "+(F==null?void 0:F.message),S[p]=!1}).finally(()=>{Vo&&console.log(">>>>> worker done"),m.push(R),P.dispose(),performance.mark("bvh.create.end"),performance.measure("bvh.create (worker)","bvh.create.start","bvh.create.end")})}else Vo&&console.warn("No worker available")}}else(!u||!B)&&(a(),s&&(performance.mark("bvh.create.start"),S.boundsTree=new s(S),performance.mark("bvh.create.end"),performance.measure("bvh.create","bvh.create.start","bvh.create.end")))}if(y instanceof ku){const B=y,R=b.raycast;i&&S.boundsTree?(b.acceleratedRaycast||(b.acceleratedRaycast=i.bind(b)),b.raycast=b.acceleratedRaycast):Vo&&console.warn("No bounds tree found for mesh",b.name);const P=B.firstHitOnly;return B.firstHitOnly=!1,B.intersectObject(b,!1,_),B.firstHitOnly=P,b.raycast=R,!0}else if(y instanceof uc){const B=S.boundsTree;if(B){const R=y;if(l.copy(b.matrixWorld).invert(),R.applyMatrix4(l),B.intersectsSphere(R)){const F=He(b),j=F.distanceTo(R.center),V=new QD(b,j,F);_.push(V)}}return!0}return!1}n.runMeshBVHRaycast=t;let e=!1,i=null,s=null,r=null,o=null;function a(){e||(e=!0,hh(()=>import("./index-6703deee.js"),["./index-6703deee.js","./MeshBVH-b62bff9f.js","./three.module-19edce0d.js"],import.meta.url).then(y=>{i=y.acceleratedRaycast,s=y.MeshBVH,r=y.StaticGeometryGenerator,o=y.computeBoundsTree}).catch(y=>{(Vo||ve())&&console.warn("Failed to load mesh bvh library")}))}const l=new ae;let h=!1,u=!1,d=null;const f=Symbol("Needle:MeshBVH-Worker"),p=Symbol("Needle:MeshBVH-CanUseWorker"),g=[],m=[];function v(){h=!0,u=!0,hh(()=>import("./GenerateMeshBVHWorker-a6403e14.js"),["./GenerateMeshBVHWorker-a6403e14.js","./three.module-19edce0d.js","./MeshBVH-b62bff9f.js"],import.meta.url).then(y=>{d=y.GenerateMeshBVHWorker}).catch(y=>{(Vo||ve())&&console.warn("Failed to setup mesh bvh worker")}).finally(()=>{u=!1})}})(oy||(oy={}));const oT=Symbol("gltf-loader-internal-usage-tracker"),_5=z("debugusers"),kg=class{constructor(t){c(this,"parser");c(this,"_getDependency");c(this,"_loadingId");c(this,"_loadedObjects",new Set);this.parser=t,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(t){return kg._loadingProcesses>0}beforeRoot(){kg._loadingProcesses++;const t=this,e=this._getDependency;return this.parser.getDependency=function(i,s){const r=e.call(this,i,s);return r.then(o=>(o&&(t._loadedObjects.add(o),o[oT]=t._loadingId),o)),r},null}afterRoot(t){kg._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const e of this._loadedObjects)delete e[oT],e instanceof ne&&(e.parent||e instanceof J&&setTimeout(()=>{_5&&console.warn("> GLTF LOADER: Mesh not used in scene!",e),e.material=null,e.geometry=null},1e3));return null}};let cg=kg;c(cg,"_loadingProcesses",0);class w5{constructor(){window.addEventListener("unhandledrejection",t=>{var i;if(t.defaultPrevented)return;const e=(i=t==null?void 0:t.reason)==null?void 0:i.path;if(e){const s=e[0];s&&s.tagName==="IMG"&&(console.warn(`Could not load image:
`+s.src),t.preventDefault())}})}}const E0=z("trackresources");function jD(){return E0==="dispose"}let Uu=!0;E0===0&&(Uu=!1);function qK(n){Uu=n}function x5(){return Uu}const GD=Symbol("disposable");function HD(n,t){n&&(n[GD]=t,uu&&console.warn("Set disposable",t,n))}const VD=Symbol("disposed");function XK(n){return n[VD]===!0}function ii(n){var t;if(n){if(n[GD]===!1){uu&&console.warn("Object is marked as not disposable",n);return}if(n[VD]=!0,n instanceof ws)ii(n.environment),ii(n.background),ii(n.customDepthMaterial),ii(n.customDistanceMaterial);else if(n instanceof Zo)ii(n.geometry),ii(n.material),ii(n.skeleton),ii(n.bindMatrix),ii(n.bindMatrixInverse),ii(n.customDepthMaterial),ii(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof J)ii(n.geometry),ii(n.material),ii(n.customDepthMaterial),ii(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof Ht){cd(n);for(const e of Object.keys(n.attributes)){const i=n.attributes[e];ii(i)}}else if(n instanceof Ke||n instanceof Xc)uu&&console.warn("BufferAttribute dispose not supported",n.count);else if(n instanceof Array)for(const e of n)e instanceof mt&&ii(e);else if(n instanceof mt){cd(n);for(const i of Object.keys(n)){const s=n[i];s instanceof At&&(ii(s),n[i]=null)}const e=n.uniforms;if(e)for(const i of Object.keys(e)){const s=e[i];s instanceof At?(ii(s),e[i]=null):s instanceof $&&(ii(s.value),s.value=null)}}else n instanceof At?(cd(n),cd(n.source),((t=n.source)==null?void 0:t.data)instanceof ImageBitmap&&cd(n.source.data)):n instanceof MC?(cd(n.boneTexture),n.boneTexture=null):n instanceof Wv||!(n instanceof ne)&&uu&&console.warn("Unknown object type",n)}}function cd(n){n&&((uu||jD()||E0)&&console.warn("ðŸ§¨ FREE",n),n instanceof ImageBitmap?n.close():n instanceof LP?n.data=null:n.dispose())}function C5(n){(n instanceof J||n instanceof Zo)&&(n.material=null,n.geometry=null)}const S5=new Set;function WD(n,t,e=null,i){if(i||(i=S5,i.clear()),!n)return i;const s=n[tm];if(s)for(const r of s)i.has(r)||(e==null?void 0:e.call(null,r))!==!1&&(i.add(r),t&&WD(r,!0,e,i));return i}function YK(n){return n[Gp]}const uu=z("debugresourceusers")||z("debugmemory"),tm=Symbol("needle-resource-users"),Gp=Symbol("needle-resource-users-count");function Os(n,t){_S(n,t,function(e,i){Uu&&!lg.raycasting&&(ay(tm,this,e,!1),ay(tm,this,i,!0))})}Uu&&(Os(J.prototype,"material"),Os(J.prototype,"geometry"),Os(mt.prototype,"map"),Os(mt.prototype,"bumpMap"),Os(mt.prototype,"alphaMap"),Os(mt.prototype,"normalMap"),Os(mt.prototype,"displacementMap"),Os(mt.prototype,"roughnessMap"),Os(mt.prototype,"metalnessMap"),Os(mt.prototype,"emissiveMap"),Os(mt.prototype,"specularMap"),Os(mt.prototype,"envMap"),Os(mt.prototype,"lightMap"),Os(mt.prototype,"aoMap"),Os(mt.prototype,"gradientMap"));function E5(n){if(Uu===!1)return;const t=n[tm];if(t)for(const e of t)ay(tm,e,n,!1)}Uu&&_S(mt.prototype,"dispose",function(){E5(this)});let wx=0;function ay(n,t,e,i){if(wx>0)return;if(Array.isArray(e)){for(const r of e)ay(n,t,r,i);return}if(!e)return;let s=e[n];if(s||(s=new Set),i){if(t&&!s.has(t)){s.add(t);let r=e[Gp]||0;r+=1,e[Gp]=r,uu&&console.warn(`ðŸŸ¢ Added user of "${e.type}"`,t,e,r,"users:",s)}}else if(t&&s.has(t)){s.delete(t);let r=e[Gp]||0;r>0&&(r-=1,e[Gp]=r),uu&&console.warn(`ðŸ”´ Removed user of "${e.type}"`,t,e,r,"users:",s),r<=0&&(cg.isLoading(e)||(E0&&console.warn(`ðŸ”´ Removed all user of "${e.type}"`,e),jD()&&ii(e)))}e[n]=s}try{_S(Pu.prototype,"render",function(){wx++},function(){wx--})}catch(n){console.warn("Could not wrap WebGLRenderer.render",n)}var im;(function(n){n.Added="component-added",n.Removing="removing-component"})(im||(im={}));const aT=z("debugcomponentevents");class I0{static addComponentLifecylceEventListener(t,e){this.eventListeners.has(t)&&this.eventListeners.set(t,[]);let i=this.eventListeners.get(t);i||(i=[]),i.push(e),this.eventListeners.set(t,i),aT&&console.log("Added event listener for "+t,this.eventListeners)}static removeComponentLifecylceEventListener(t,e){const i=this.eventListeners.get(t);if(!i)return;const s=i.indexOf(e);s<0||i.splice(s,1)}static dispatchComponentLifecycleEvent(t,e){const i=this.eventListeners.get(t);if(aT&&console.log("Dispatching event "+t,i),!!i)for(const s of i)s(e)}}c(I0,"eventListeners",new Map);const nm=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),qD=Symbol("isUsingInstancing"),XD=Symbol("instancingRenderer"),Hp=Symbol("instancingAutoUpdateBounds");class ea{static isUsingInstancing(t){return t[qD]===!0}static getRenderer(t){return t[XD]||null}setAutoUpdateBounds(t,e){const i=ea.getRenderer(t);i&&(i[Hp]=e)}static markDirty(t,e=!0){if(t&&(this.isUsingInstancing(t)&&(t[nm]=!0,t.matrixWorldNeedsUpdate=!0),e))for(const i of t.children)ea.markDirty(i,!0)}}function hf(n,t){try{t?n(t):n()}catch(e){return console.error(e),!1}return!0}const xx=z("debugnewscripts"),I5=z("debughierarchy"),hi=[];function T5(){return hi.length>0}function ly(n){if(!(n.new_scripts.length<=0)){if(xx&&console.log("Register new components",n.new_scripts.length,[...n.new_scripts],n.alias?"element: "+n.alias:n.hash,n),n.new_scripts_pre_setup_callbacks.length>0){for(const t of n.new_scripts_pre_setup_callbacks)t&&t();n.new_scripts_pre_setup_callbacks.length=0}hi.length=0,n.new_scripts.length>0&&hi.push(...n.new_scripts),n.new_scripts.length=0;for(let t=0;t<hi.length;t++)try{const e=hi[t];if(e.isComponent!==!0){(ve()||xx)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,e),hi.splice(t,1),t--;continue}if(e.destroyed)continue;if(!e.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),hi.splice(t,1),t--;continue}e.context=n,hg(e.gameObject),kS(e,n)}catch(e){console.error(e),Ul(hi[t],n),hi.splice(t,1),t--}for(let t=0;t<hi.length;t++)try{const e=hi[t];if(e.destroyed){Ul(hi[t],n),hi.splice(t,1),t--;continue}if(e.registering)try{e.registering()}catch(i){console.error(i)}e.__internalAwake!==void 0&&(e.gameObject||console.error("Calling awake for a component without a GameObject",e,e.gameObject),hg(e.gameObject),e.activeAndEnabled&&hf(e.__internalAwake.bind(e)))}catch(e){console.error(e),Ul(hi[t],n),hi.splice(t,1),t--}for(let t=0;t<hi.length;t++)try{const e=hi[t];if(e.destroyed||e.enabled===!1||(hg(e.gameObject),e.activeAndEnabled===!1))continue;e.__internalEnable!==void 0&&(e.enabled=!0,hf(e.__internalEnable.bind(e)))}catch(e){console.error(e),Ul(hi[t],n),hi.splice(t,1),t--}for(let t=0;t<hi.length;t++)try{const e=hi[t];if(e.destroyed||!e.gameObject)continue;n.new_script_start.push(e)}catch(e){console.error(e),Ul(hi[t],n),hi.splice(t,1),t--}hi.length=0;for(const t of n.new_scripts_post_setup_callbacks)t&&t();n.new_scripts_post_setup_callbacks.length=0}}function R5(n){n&&(n.__internalDisable(!0),Ul(n,n.context))}function YD(n,t){for(let e=0;e<n.new_script_start.length;e++)try{const i=n.new_script_start[e];if(t!==void 0&&i.gameObject!==t||i.destroyed||i.activeAndEnabled===!1)continue;hf(i.__internalAwake.bind(i)),i.enabled&&(hf(i.__internalEnable.bind(i)),hf(i.__internalStart.bind(i)),n.new_script_start.splice(e,1),e--)}catch(i){console.error(i),Ul(n.new_script_start[e],n),n.new_script_start.splice(e,1),e--}}function kS(n,t){t.scripts.indexOf(n)===-1&&(t.scripts.push(n),n.earlyUpdate&&t.scripts_earlyUpdate.push(n),n.update&&t.scripts_update.push(n),n.lateUpdate&&t.scripts_lateUpdate.push(n),n.onBeforeRender&&t.scripts_onBeforeRender.push(n),n.onAfterRender&&t.scripts_onAfterRender.push(n),n.onPausedChanged&&t.scripts_pausedChanged.push(n),__(n,null)&&t.new_scripts_xr.push(n),__(n,"immersive-vr")&&t.scripts_immersive_vr.push(n),__(n,"immersive-ar")&&t.scripts_immersive_ar.push(n))}function Ul(n,t){Kr(n,t.new_scripts),Kr(n,t.new_script_start),Kr(n,t.scripts),Kr(n,t.scripts_earlyUpdate),Kr(n,t.scripts_update),Kr(n,t.scripts_lateUpdate),Kr(n,t.scripts_onBeforeRender),Kr(n,t.scripts_onAfterRender),Kr(n,t.scripts_pausedChanged),Kr(n,t.new_scripts_xr),Kr(n,t.scripts_immersive_vr),Kr(n,t.scripts_immersive_ar),t.stopAllCoroutinesFrom(n)}function Kr(n,t){const e=t.indexOf(n);e>=0&&t.splice(e,1)}function __(n,t){var e;if(n){const i=n;if(i.onBeforeXR||i.onEnterXR||i.onUpdateXR||i.onLeaveXR||i.onXRControllerAdded||i.onXRControllerRemoved)return!(t!=null&&((e=i.supportsXR)==null?void 0:e.call(i,t))===!1)}return!1}function Iv(n){if(n||(n=xt.Current.scene),!n){console.trace("Invalid call - no current context.");return}const t=Bm(n);KD(n,t,!0)||(xx||ve()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,n):console.error('Failed to update active state in hierarchy of "'+n.name+'"',n),console.warn(" â†‘ this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function KD(n,t,e,i=0){if(i>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const s=Bm(n);if(t&&(t=s,t&&n.parent)){const l=n.parent;t=l[eh],t===void 0&&(l instanceof ws||(t=!0))}const o=n[eh]!==t;n[eh]=t,o&&(I5&&console.warn("ACTIVE CHANGE",n.name,s,n.visible,t,"changed?"+o,n),e&&B5(n,l=>{t?l.enabled&&(hf(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(n.children){const l=i+1;for(const h of n.children)KD(h,t,e,l)===!1&&(a=!1)}return a}function hg(n){let t=!0,e=n,i=!1;for(;e&&e;){if(e.type==="Scene"&&(i=!0),!Bm(e)){t=!1;break}e=e.parent}if(!n){console.error("GO is null");return}n[eh]=t&&i}function B5(n,t){var e;if((e=n.userData)!=null&&e.components)for(const i of n.userData.components)t(i)}const Tv=new Map,JD=Symbol("prewarmFlag"),Cx=Symbol("waitingForPrewarm"),Sx=z("debugprewarm");function P5(n,t){if(!n||n[JD]===!0||n[Cx]===!0)return;Tv.has(t)||Tv.set(t,[]),n[Cx]=!0,Tv.get(t).push(n),Sx&&console.debug("register prewarm",n.name)}let lT=null,cT=null;function M5(n){if(!n)return;const t=Tv.get(n);if(!(t!=null&&t.length))return;const e=n.mainCamera;if(e){Sx&&console.log("prewarm",t.length,"objects",[...t]);const i=n.renderer;if(i.compile){const s=n.scene;i.compile(s,e),lT??(lT=new wF(64)),cT??(cT=new xF(.001,9999999,lT)),cT.update(i,s);for(const r of t)r[JD]=!0,r[Cx]=!1;t.length=0,Sx&&console.log("prewarm done")}}}const k5=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function D5(n){return typeof n=="string"&&k5.test(n)}const jn=[];for(let n=0;n<256;++n)jn.push((n+256).toString(16).slice(1));function O5(n,t=0){return jn[n[t+0]]+jn[n[t+1]]+jn[n[t+2]]+jn[n[t+3]]+"-"+jn[n[t+4]]+jn[n[t+5]]+"-"+jn[n[t+6]]+jn[n[t+7]]+"-"+jn[n[t+8]]+jn[n[t+9]]+"-"+jn[n[t+10]]+jn[n[t+11]]+jn[n[t+12]]+jn[n[t+13]]+jn[n[t+14]]+jn[n[t+15]]}function L5(n){if(!D5(n))throw TypeError("Invalid UUID");let t;const e=new Uint8Array(16);return e[0]=(t=parseInt(n.slice(0,8),16))>>>24,e[1]=t>>>16&255,e[2]=t>>>8&255,e[3]=t&255,e[4]=(t=parseInt(n.slice(9,13),16))>>>8,e[5]=t&255,e[6]=(t=parseInt(n.slice(14,18),16))>>>8,e[7]=t&255,e[8]=(t=parseInt(n.slice(19,23),16))>>>8,e[9]=t&255,e[10]=(t=parseInt(n.slice(24,36),16))/1099511627776&255,e[11]=t/4294967296&255,e[12]=t>>>24&255,e[13]=t>>>16&255,e[14]=t>>>8&255,e[15]=t&255,e}function F5(n){n=unescape(encodeURIComponent(n));const t=[];for(let e=0;e<n.length;++e)t.push(n.charCodeAt(e));return t}const U5="6ba7b810-9dad-11d1-80b4-00c04fd430c8",N5="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function z5(n,t,e){function i(s,r,o,a){var l;if(typeof s=="string"&&(s=F5(s)),typeof r=="string"&&(r=L5(r)),((l=r)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let h=new Uint8Array(16+s.length);if(h.set(r),h.set(s,r.length),h=e(h),h[6]=h[6]&15|t,h[8]=h[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=h[u];return o}return O5(h)}try{i.name=n}catch{}return i.DNS=U5,i.URL=N5,i}function Q5(n,t,e,i){switch(n){case 0:return t&e^~t&i;case 1:return t^e^i;case 2:return t&e^t&i^e&i;case 3:return t^e^i}}function w_(n,t){return n<<t|n>>>32-t}function j5(n){const t=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const o=unescape(encodeURIComponent(n));n=[];for(let a=0;a<o.length;++a)n.push(o.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const i=n.length/4+2,s=Math.ceil(i/16),r=new Array(s);for(let o=0;o<s;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=n[o*64+l*4]<<24|n[o*64+l*4+1]<<16|n[o*64+l*4+2]<<8|n[o*64+l*4+3];r[o]=a}r[s-1][14]=(n.length-1)*8/Math.pow(2,32),r[s-1][14]=Math.floor(r[s-1][14]),r[s-1][15]=(n.length-1)*8&4294967295;for(let o=0;o<s;++o){const a=new Uint32Array(80);for(let p=0;p<16;++p)a[p]=r[o][p];for(let p=16;p<80;++p)a[p]=w_(a[p-3]^a[p-8]^a[p-14]^a[p-16],1);let l=e[0],h=e[1],u=e[2],d=e[3],f=e[4];for(let p=0;p<80;++p){const g=Math.floor(p/20),m=w_(l,5)+Q5(g,h,u,d)+f+t[g]+a[p]>>>0;f=d,d=u,u=w_(h,30)>>>0,h=l,l=m}e[0]=e[0]+l>>>0,e[1]=e[1]+h>>>0,e[2]=e[2]+u>>>0,e[3]=e[3]+d>>>0,e[4]=e[4]+f>>>0}return[e[0]>>24&255,e[0]>>16&255,e[0]>>8&255,e[0]&255,e[1]>>24&255,e[1]>>16&255,e[1]>>8&255,e[1]&255,e[2]>>24&255,e[2]>>16&255,e[2]>>8&255,e[2]&255,e[3]>>24&255,e[3]>>16&255,e[3]>>8&255,e[3]&255,e[4]>>24&255,e[4]>>16&255,e[4]>>8&255,e[4]&255]}const G5=z5("v5",80,j5),hT=G5;xt.registerCallback(dt.ContextCreated,n=>{const t=n.context;q5(t),V5(t)});const cy=z("debugcomponents"),uT="eff8ba80-635d-11ec-90d6-0242ac120003";class Sn{constructor(t){c(this,"_originalSeed");c(this,"_seed");typeof t=="string"&&(t=Sn.hash(t)),this._originalSeed=t,this._seed=t}get seed(){return this._seed}set seed(t){this._seed=t}reset(){this._seed=this._originalSeed}generateUUID(t){if(typeof t=="string")return hT(t,uT);const e=this._seed;return this._seed-=1,hT(e.toString(),uT)}initialize(t){typeof t=="string"?this._seed=Sn.hash(t):this._seed=t}static createFromString(t){return new Sn(this.hash(t))}static hash(t){let e=0;for(let i=0;i<t.length;i++)e=t.charCodeAt(i)+((e<<5)-e);return e}}var Pf;(function(n){n.NewInstanceCreated="new-instance-created",n.InstanceDestroyed="instance-destroyed"})(Pf||(Pf={}));class H5{constructor(t){c(this,"guid");c(this,"dontSave");this.guid=t}}function T0(n,t,e=!0,i){if(!n)return;const s=n;if(wo(n,e),!t){console.warn("Can not send destroy: No networking connection provided",n.guid);return}if(!t.isConnected){console.warn("Can not send destroy: not connected",n.guid);return}let r=n.guid;if(!r&&s.uuid&&(r=s.uuid),!r){console.warn("Can not send destroy: failed to find guid",n);return}ZD(r,t,i)}function ZD(n,t,e){const i=new H5(n);(e==null?void 0:e.saveInRoom)===!1&&(i.dontSave=!0),t.send(Pf.InstanceDestroyed,i,Ho.Queued)}function V5(n){n.connection.beginListen(Pf.InstanceDestroyed,t=>{cy&&console.log("[Remote] Destroyed",n.scene,t);const e=M0(t.guid,n.scene);e&&wo(e)})}class KK{constructor(t,e,i){c(this,"filename");c(this,"hash");c(this,"size");this.filename=t,this.hash=e,this.size=i}}class W5{constructor(t,e){c(this,"guid");c(this,"originalGuid");c(this,"seed");c(this,"visible");c(this,"hostData");c(this,"dontSave");c(this,"parent");c(this,"position");c(this,"rotation");c(this,"scale");c(this,"preventCreation");c(this,"deleteStateOnDisconnect");this.originalGuid=t,this.guid=e}}function $D(n,t,e,i){var l;const s=n;if(!s.guid)return console.warn("Can not instantiate: No guid",s),null;if(t.context||(t.context=je.Current),!t.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=t?{...t}:null,{instance:o,seed:a}=X5(s,t);if(o){const h=o;if(h.guid){cy&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const u=new W5(s.guid,h.guid);u.seed=a,t.deleteOnDisconnect===!0&&(u.deleteStateOnDisconnect=!0),r&&(r.position&&(u.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(u.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(u.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),u.position||(u.position={x:h.position.x,y:h.position.y,z:h.position.z}),u.rotation||(u.rotation={x:h.quaternion.x,y:h.quaternion.y,z:h.quaternion.z,w:h.quaternion.w}),u.scale||(u.scale={x:h.scale.x,y:h.scale.y,z:h.scale.z}),u.visible=s.visible,r!=null&&r.parent&&(typeof r.parent=="string"?u.parent=r.parent:u.parent=r.parent.guid),u.hostData=e,i===!1&&(u.dontSave=!0),(l=t==null?void 0:t.context)==null||l.connection.send(Pf.NewInstanceCreated,u)}else console.warn("Missing guid, can not send new instance event",h)}return o}function DS(){return Math.random()*9999999}function q5(n){n.connection.beginListen(Pf.NewInstanceCreated,async t=>{const e=await K5(t.originalGuid,n.scene);if(t.preventCreation===!0)return;if(!e){console.warn("could not find object that was instantiated: "+t.guid);return}const i=new ll;t.position&&(i.position=new w(t.position.x,t.position.y,t.position.z)),t.rotation&&(i.rotation=new ie(t.rotation.x,t.rotation.y,t.rotation.z,t.rotation.w)),t.scale&&(i.scale=new w(t.scale.x,t.scale.y,t.scale.z)),i.parent=t.parent,t.seed&&(i.idProvider=new Sn(t.seed)),i.visible=t.visible,i.context=n,cy&&n.alias&&console.log("[Remote] instantiate in: "+n.alias);const s=Pm(e,i);s&&(t.parent==="scene"&&n.scene.add(s),cy&&console.log("[Remote] new instance","gameobject:",s==null?void 0:s.guid,e))})}function X5(n,t){const e=DS(),i=t??new ll;i.idProvider=new Sn(e);const s=Pm(n,i);return{seed:e,instance:s}}const eO={};function Y5(n,t){eO[n]=t}async function K5(n,t){const e=eO[n];if(e!=null){const i=await e(n);if(i)return i}return tO(n,t)}function tO(n,t){if(t===null||!n)return null;if(t.guid===n)return t;if(t.children)for(const e of t.children){const i=tO(n,e);if(i)return i}return null}const Tm=z("gizmos"),yn=z("debugextension"),x_=z("debugtypes");class J5{constructor(){c(this,"_types",new Map);x_&&console.warn("TypeStore: Created",this)}add(t,e){x_&&console.warn("ADD TYPE",t);const i=this._types.get(t);i?x_&&i!==e&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",t):this._types.set(t,e)}get(t){return this._types.get(t)||null}getKey(t){for(const[e,i]of this._types)if(i===t)return e;return null}}const Z5=Symbol("BuiltInType"),D=new J5,JK=function(n){D.get(n.name)||D.add(n.name,n)},OS=z("debugresolvedependencies"),$5=["/extensions/","extensions/"],e6=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function LS(n,t){OS&&console.log(n,t);const e=[];Ex(e6,n,t,e);const i=await Promise.all(e);return typeof t=="string"&&i.length===1?i[0]:i}function t6(n,t){return!n||!t?!1:n["needle:identifier"]!=null&&t["needle:identifier"]!=null?n["needle:identifier"]===t["needle:identifier"]:!1}function i6(n,t){n["needle:identifier"]=t}function Ex(n,t,e,i){if(typeof e=="object"&&e!==void 0&&e!==null)for(const s of Object.keys(e)){const r=e[s];if(typeof r=="string"){const o=dT(t,r);if(o!=null)typeof o.then=="function"?i.push(o.then(a=>e[s]=a)):e[s]=o;else{const a=fT(n,t,r);if(a){i.push(a.then(l=>(e[s]=l,l)));continue}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const a=r[o],l=dT(t,a);if(l!==null){typeof l.then=="function"?i.push(l.then(h=>r[o]=h)):r[o]=l;continue}for(const h of n){const u=iO(h.prefix,a);if(u>=0){OS&&console.log(h,u,h.dependencyName),i.push(t.getDependency(h.dependencyName,u).then(d=>r[o]=d));break}}typeof a=="object"&&Ex(n,t,a,i)}else typeof r=="object"&&Ex(n,t,r,i)}else if(typeof e=="string"){const s=fT(n,t,e);s&&i.push(s)}}function dT(n,t){if(n&&n.plugins&&typeof t=="string"){for(const e of $5)if(t.startsWith(e)){let i=t.substring(e.length);const s=i.indexOf("/");s>=0&&(i=i.substring(0,s));const r=n.plugins[i];if(yn&&console.log(i,r),typeof(r==null?void 0:r.resolve)=="function"){const o=t.substring(e.length+i.length+1);return r.resolve(n,o)}break}}return null}function fT(n,t,e){for(const i of n){const s=iO(i.prefix,e);if(s>=0)return OS&&console.warn("GET DEPENDENCY",i,s,i.dependencyName),t.getDependency(i.dependencyName,s)}return null}function iO(n,t){if(typeof t=="string"&&t.startsWith(n)){const e=t.substring(n.length),i=Number.parseInt(e);if(i>=0)return i}return-1}const C_="NEEDLE_persistent_assets";function n6(n){return(n==null?void 0:n.___persistentAsset)===!0}class s6{constructor(t){c(this,"parser");this.parser=t}get name(){return C_}async afterRoot(t){var s,r;if(!((r=(s=this.parser)==null?void 0:s.json)!=null&&r.extensions))return;const e=this.parser.json.extensions[C_];if(!e)return;yn&&console.log(e);const i=new Array;for(const o of e==null?void 0:e.assets){const a=LS(this.parser,o);a&&i.push(a)}await Promise.all(i)}resolve(t,e){const i=Number.parseInt(e);if(i>=0){yn&&console.log(e);const s=t.json.extensions[C_];if(s){const r=s==null?void 0:s.assets[i];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&D.get(o)}return r}}return null}}const Ba=z("debugserializer");class r6{constructor(){c(this,"typeMap",new Map)}register(t,e){if(this.typeMap.has(t)){const i=this.typeMap.get(t);if(i===e)return;Ba&&console.warn("Type: "+t+" is already registered",e,i)}Ba&&console.log("Register type serializer",e.name,e,t),this.typeMap.set(t,e)}getSerializer(t){if(t)return this.typeMap.get(t)}getSerializerForConstructor(t,e=0){if(e>20)return;if(!t||!t.constructor){Ba&&console.log("invalid type");return}const i=t.name,s=this.getSerializer(t);if(s!==void 0)return Ba&&console.log("FOUND SERIALIZER",s==null?void 0:s.name,t.name,t.constructor.name,"for type: "+i,s,t,this.typeMap),s;const r=Object.getPrototypeOf(t);if(r&&r!==t){const o=this.getSerializerForConstructor(r,++e);if(o){const a=r.constructor||r.prototype;Ba&&console.log("FOUND SERIALIZER(in constructor) "+a.constructor.name,a.name,a,o),this.register(a,o)}return o}Ba&&console.warn("No serializer found for "+i,t,t.name,t.constructor.name)}}const hy=new r6;class So{constructor(t,e){c(this,"name");if(this.name=e,Array.isArray(t))for(const i of t)hy.register(i,this);else hy.register(t,this)}}class o6{constructor(){c(this,"isDevMode",fr());c(this,"cache",{})}registerDefinedKeys(t,e){if(this.isDevMode&&this.cache[t]===void 0){this.cache[t]=Object.keys(e);const i=e;i.$serializedTypes&&Object.keys(i.$serializedTypes)&&this.cache[t].push(...Object.keys(i.$serializedTypes)),Ba&&console.log("registerDefinedKeys for "+t,this.cache[t],e)}}getDefinedKey(t,e){return this.cache[t]===void 0?!1:this.cache[t].includes(e)}}class nO{constructor(t){c(this,"root");c(this,"gltf");c(this,"gltfId");c(this,"object");c(this,"target");c(this,"nodeId");c(this,"nodeToObject");c(this,"objectToNode");c(this,"context");c(this,"path");c(this,"type");c(this,"serializable");c(this,"implementationInformation");this.root=t}}function a6(n,t){const e=n.$serializedTypes;if(e===void 0)return null;const i={};for(const s in e){const r=n[s];if(r!=null&&typeof r=="object"){const o=hy.getSerializerForConstructor(r);if(o){i[s]=o.onSerialize(r,t);continue}}i[s]=r}return i.name=n.constructor.name,typeof n.guid=="string"&&(i.guid=n.guid),i}const Rv=[];function sO(n,t){if(!n)return t;typeof n.$serializedTypes=="object"&&(t||(t={}),Object.assign(t,n.$serializedTypes));const e=Object.getPrototypeOf(n);return sO(e,t)}function Ix(n,t,e){if(!n)return!1;if(e.target=n,n.onBeforeDeserialize!==void 0){const s=n.onBeforeDeserialize(t,e);if(typeof s=="boolean")return s}const i=sO(n);if(t){if(typeof t.guid=="string"&&(n.guid=t.guid),i)for(const s in i){let a=function(l){const u=l.type;return u?Tx(o,u,e,void 0,n[s]):Tx(o,l,e,void 0,n[s])};const r=i[s],o=t[s];if(Ba&&console.log(s,o,n,r),!(n[s]!==void 0&&o===void 0)&&(e.type=void 0,e.path=s,e.serializable=r,!(n.onBeforeDeserializeMember!==void 0&&n.onBeforeDeserializeMember(s,o,e)===!0))){if(r===null)n[s]=o;else{if(Array.isArray(r))for(let l=0;l<r.length;l++){const h=r[l],u=a(h);if(u!==void 0||l===r.length-1){n[s]=u;break}}else n[s]=a(r);Rv.length=0}n.onAfterDeserializeMember!==void 0&&n.onAfterDeserializeMember(s,o,e)}}h6(n,t)}return c6(n,t,e.implementationInformation),n.onAfterDeserialize!==void 0&&n.onAfterDeserialize(t,e),!0}const l6=z("noerrors");function c6(n,t,e){var r,o;if(l6||!t||!fr()||!n||n.constructor&&n.constructor[Z5]===!0)return;const i=(r=n.constructor)==null?void 0:r.name,s=Object.getOwnPropertyNames(t);for(const a of s){if(a==="sourceId")continue;const l=n[a];if(l==null)continue;const h=t[a];if((e==null?void 0:e.getDefinedKey(i,a))===!1){const u=a.charAt(0).toUpperCase()+a.slice(1);e.getDefinedKey(i,u)&&(Qa(Xi.Warn,'<strong>Please rename</strong> "'+u+'" to "'+a+'" in '+i),console.warn('Please use lowercase for field: "'+u+'" in '+i,h,n));continue}if(h!=null){if(typeof h=="object"&&(l===void 0||!l.isObject3D)){if(typeof h.node=="number"||typeof h.guid=="string"){if(h.could_not_resolve)continue;if(!(l!==void 0&&Object.keys(l).length>1)){Qa(Xi.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${a}? : Object3D;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,n[a],n);continue}}else if(!Array.isArray(l)){const u=(o=l.constructor)==null?void 0:o.name;if(u==="Object"&&!l.constructor["did_warn:missing_serializable"]){l.constructor["did_warn:missing_serializable"]=!0;const d='You might be missing a @serializable(Type) decorator for field "'+a+'" in '+i+".ts";console.warn(d+`
${a}:`,h,u),Qa(Xi.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof l=="string"&&typeof h=="string"&&(h.endsWith(".gltf")||h.endsWith(".glb"))){Qa(Xi.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${a}? : AssetReference;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,n[a],n);continue}}}}function h6(n,t){for(const e of Object.keys(t)){const i=t[e];if(typeof i=="object"&&i!==null&&i!==void 0){const s=n[e];if(!s){Ba&&console.log(e,"is undefined on",n);continue}for(const r of Object.keys(i))if(s[r]===void 0&&pT(i[r])&&!pT(s)){const a=u6(s,r);if(a&&((a==null?void 0:a.writable)===void 0||(a==null?void 0:a.writable)===!1)&&a.set===void 0){Ba&&console.warn('Property is not writable "'+r+'"',s,a,i[r],s[r]);continue}s[r]=i[r]}}}}function u6(n,t){for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=Object.getPrototypeOf(n)}}function pT(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}function Tx(n,t,e,i,s){let r=typeof t=="function"&&t.prototype===void 0,o=t;if(r)try{if(o=t==null?void 0:t.call(t,s),r=!1,o==null)return}catch(u){console.error("Error in callback",u,n)}if(e.type=o,!r&&s instanceof o)return s;if(i||(i={serializer:hy.getSerializerForConstructor(o)}),s&&typeof s=="object"&&n6(s)){if(s.__concreteInstance)return s.__concreteInstance;const u=s;if(!u.$serializedTypes&&o.prototype.$serializedTypes&&(u.$serializedTypes=o.prototype.$serializedTypes),u.$serializedTypes&&Ix(u,n,e),s&&o!==void 0)try{let d=null;i.serializer&&(d=i.serializer.onDeserialize(n,e)),d||(d=new o,yn&&console.log("Create concrete instance for persistent asset",s,"instance:",d),Mf(d,s)),s.__concreteInstance=d,s=d}catch(d){console.error("Error creating instance or creating values on instance",d,s,o)}return s}if(Array.isArray(n)){const u=[];for(let d=0;d<n.length;d++){const f=n[d],p=Tx(f,t,e,i,f);u.push(p)}return u}const a=i==null?void 0:i.serializer;if(a)return a.onDeserialize(n,e);let l;if(n&&(n.isMaterial||n.isTexture||n.isObject3D||n instanceof ql))l=n;else{if(n===void 0)return;if(n===null&&(o===mt||o===At||o===J||o===ql))return null;try{l=new o(...d6(n))}catch(u){console.error("Error creating "+e.path,e.target,u);return}}const h=l;return h.$serializedTypes&&Ix(h,n,e),l}function d6(n){if(Rv.length=0,typeof n=="object"&&n!==null&&n!==void 0)for(const t of Object.keys(n))Rv.push(n[t]);return Rv}const Rx=Symbol("assigned component properties");function Mf(n,t,e){var s;if(t==null||n==null)return;n[Rx]=!0;const i=((s=n.constructor)==null?void 0:s.name)??"unknown";e==null||e.registerDefinedKeys(i,n);for(const r of Object.keys(t)){const o=f6(n,r);typeof(o==null?void 0:o.value)!="function"&&(!o||o.writable===!0||(o==null?void 0:o.set)!==void 0)&&(n[r]=t[r])}delete n[Rx]}function f6(n,t){let e;do e=Object.getOwnPropertyDescriptor(n,t);while(!e&&(n=Object.getPrototypeOf(n)));return e}const rO=Symbol("customVisibilityFlag");function Gc(n,t){n.layers[rO]=t}const gT=Symbol("DidPatchLayers");function p6(){const n=go.prototype;if(n[gT])return;n[gT]=!0;const t=n.test;n.test=function(e){return this[rO]===!1?!1:t.call(this,e)}}p6();Object.defineProperty(bt.prototype,"fov",{get:function(){return this._fov},set:function(n){const t=n!==this._fov;this._fov=n,t&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});Object.defineProperty(bt.prototype,"near",{get:function(){return this._near},set:function(n){const t=n!==this._near;this._near=n,t&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});Object.defineProperty(bt.prototype,"far",{get:function(){return this._far},set:function(n){const t=n!==this._far;this._far=n,t&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});const oO=new Map;function g6(n,t){if(!n)return;if(!t){console.warn("No prototype found",n,n.prototype,n.constructor);return}const e=oO.get(t);e&&e.apply(n)}function m6(n){const t=A6(n.prototype);oO.set(n,t)}function A6(n){return new v6(n)}class v6{constructor(t){c(this,"$symbol");c(this,"extensions");c(this,"descriptors");this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(t),this.descriptors=new Array;for(let e=0;e<this.extensions.length;e++){const i=this.extensions[e],s=Object.getOwnPropertyDescriptor(t,i);s&&this.descriptors.push(s)}}apply(t){if(!t[this.$symbol]){t[this.$symbol]=!0;for(let e=0;e<this.extensions.length;e++){const i=this.extensions[e],s=this.descriptors[e];s&&Object.defineProperty(t,i,s)}}}}const Fh=new ku,fs=new w,Sc=new w,fi=new ie,mT={X:new w(1,0,0),Y:new w(0,1,0),Z:new w(0,0,1)},S_={type:"change"},AT={type:"mouseDown"},vT={type:"mouseUp",mode:null},yT={type:"objectChange"};class y6 extends ne{constructor(t,e){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const i=new FS;this._gizmo=i,this.add(i);const s=new S6;this._plane=s,this.add(s);const r=this;function o(b,_){let x=_;Object.defineProperty(r,b,{get:function(){return x!==void 0?x:_},set:function(S){x!==S&&(x=S,s[b]=S,i[b]=S,r.dispatchEvent({type:b+"-changed",value:S}),r.dispatchEvent(S_))}}),r[b]=_,s[b]=_,i[b]=_}o("camera",t),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new w,l=new w,h=new ie,u=new ie,d=new w,f=new ie,p=new w,g=new w,m=new w,v=0,y=new w;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",h),o("worldQuaternionStart",u),o("cameraPosition",d),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",g),o("rotationAxis",m),o("rotationAngle",v),o("eye",y),this._offset=new w,this._startNorm=new w,this._endNorm=new w,this._cameraScale=new w,this._parentPosition=new w,this._parentQuaternion=new ie,this._parentQuaternionInv=new ie,this._parentScale=new w,this._worldScaleStart=new w,this._worldQuaternionInv=new ie,this._worldScale=new w,this._positionStart=new w,this._quaternionStart=new ie,this._scaleStart=new w,this._getPointer=b6.bind(this),this._onPointerDown=w6.bind(this),this._onPointerHover=_6.bind(this),this._onPointerMove=x6.bind(this),this._onPointerUp=C6.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&Fh.setFromCamera(t,this.camera);const e=E_(this._gizmo.picker[this.mode],Fh);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&Fh.setFromCamera(t,this.camera);const e=E_(this._plane,Fh,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,AT.mode=this.mode,this.dispatchEvent(AT)}}pointerMove(t){const e=this.axis,i=this.mode,s=this.object;let r=this.space;if(i==="scale"?r="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(r="world"),s===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&Fh.setFromCamera(t,this.camera);const o=E_(this._plane,Fh,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(s.position.applyQuaternion(fi.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),r==="world"&&(s.parent&&s.position.add(fs.setFromMatrixPosition(s.parent.matrixWorld)),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(fs.setFromMatrixPosition(s.parent.matrixWorld))));else if(i==="scale"){if(e.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Sc.set(a,a,a)}else fs.copy(this.pointStart),Sc.copy(this.pointEnd),fs.applyQuaternion(this._worldQuaternionInv),Sc.applyQuaternion(this._worldQuaternionInv),Sc.divide(fs),e.search("X")===-1&&(Sc.x=1),e.search("Y")===-1&&(Sc.y=1),e.search("Z")===-1&&(Sc.z=1);s.scale.copy(this._scaleStart).multiply(Sc),this.scaleSnap&&(e.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(fs.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(fs.copy(this.rotationAxis).cross(this.eye))*a):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(mT[e]),fs.copy(mT[e]),r==="local"&&fs.applyQuaternion(this.worldQuaternion),fs.cross(this.eye),fs.length()===0?l=!0:this.rotationAngle=this._offset.dot(fs.normalize())*a),(e==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&e!=="E"&&e!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(fi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(fi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(S_),this.dispatchEvent(yT)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(vT.mode=this.mode,this.dispatchEvent(vT)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(S_),this.dispatchEvent(yT),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Fh}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function b6(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const t=this.domElement.getBoundingClientRect();return{x:(n.clientX-t.left)/t.width*2-1,y:-(n.clientY-t.top)/t.height*2+1,button:n.button}}}function _6(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function w6(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function x6(n){this.enabled&&this.pointerMove(this._getPointer(n))}function C6(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function E_(n,t,e){const i=t.intersectObject(n,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||e)return i[s];return!1}const TA=new jt,Vt=new w(0,1,0),bT=new w(0,0,0),_T=new ae,RA=new ie,Bv=new ie,ua=new w,wT=new ae,Vp=new w(1,0,0),Wh=new w(0,1,0),Wp=new w(0,0,1),BA=new w,Ap=new w,vp=new w;class FS extends ne{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new _t({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new Jo({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=t.clone();i.opacity=.15;const s=e.clone();s.opacity=.5;const r=t.clone();r.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const a=t.clone();a.color.setHex(255);const l=t.clone();l.color.setHex(16711680),l.opacity=.5;const h=t.clone();h.color.setHex(65280),h.opacity=.5;const u=t.clone();u.color.setHex(255),u.opacity=.5;const d=t.clone();d.opacity=.25;const f=t.clone();f.color.setHex(16776960),f.opacity=.25,t.clone().color.setHex(16776960);const g=t.clone();g.color.setHex(7895160);const m=new Us(0,.04,.1,12);m.translate(0,.05,0);const v=new on(.08,.08,.08);v.translate(0,.04,0);const y=new Ht;y.setAttribute("position",new cn([0,0,0,1,0,0],3));const b=new Us(.0075,.0075,.5,3);b.translate(0,.25,0);function _(X,k){const O=new lp(X,.0075,3,64,k*Math.PI*2);return O.rotateY(Math.PI/2),O.rotateX(Math.PI/2),O}function x(){const X=new Ht;return X.setAttribute("position",new cn([0,0,0,1,1,1],3)),X}const S={X:[[new J(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new J(m,r),[-.5,0,0],[0,0,Math.PI/2]],[new J(b,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new J(m,o),[0,.5,0]],[new J(m,o),[0,-.5,0],[Math.PI,0,0]],[new J(b,o)]],Z:[[new J(m,a),[0,0,.5],[Math.PI/2,0,0]],[new J(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new J(b,a),null,[Math.PI/2,0,0]]],XYZ:[[new J(new oA(.1,0),d.clone()),[0,0,0]]],XY:[[new J(new on(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new J(new on(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new on(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},E={X:[[new J(new Us(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new J(new Us(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new J(new Us(.2,0,.6,4),i),[0,.3,0]],[new J(new Us(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new J(new Us(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new J(new Us(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new J(new oA(.2,0),i)]],XY:[[new J(new on(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new J(new on(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new on(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new J(new oA(.01,2),s),null,null,null,"helper"]],END:[[new J(new oA(.01,2),s),null,null,null,"helper"]],DELTA:[[new ms(x(),s),null,null,null,"helper"]],X:[[new ms(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ms(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ms(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I={XYZE:[[new J(_(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new J(_(.5,.5),r)]],Y:[[new J(_(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new J(_(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new J(_(.75,1),f),null,[0,Math.PI/2,0]]]},B={AXIS:[[new ms(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},R={XYZE:[[new J(new Bu(.25,10,8),i)]],X:[[new J(new lp(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new J(new lp(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new J(new lp(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new J(new lp(.75,.1,2,24),i)]]},P={X:[[new J(v,r),[.5,0,0],[0,0,-Math.PI/2]],[new J(b,r),[0,0,0],[0,0,-Math.PI/2]],[new J(v,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new J(v,o),[0,.5,0]],[new J(b,o)],[new J(v,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new J(v,a),[0,0,.5],[Math.PI/2,0,0]],[new J(b,a),[0,0,0],[Math.PI/2,0,0]],[new J(v,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new J(new on(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new J(new on(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new on(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new J(new on(.1,.1,.1),d.clone())]]},F={X:[[new J(new Us(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new J(new Us(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new J(new Us(.2,0,.6,4),i),[0,.3,0]],[new J(new Us(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new J(new Us(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new J(new Us(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new J(new on(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new J(new on(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new on(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new J(new on(.2,.2,.2),i),[0,0,0]]]},j={X:[[new ms(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ms(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ms(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function V(X){const k=new ne;for(const O in X)for(let H=X[O].length;H--;){const ee=X[O][H][0].clone(),Y=X[O][H][1],he=X[O][H][2],ue=X[O][H][3],_e=X[O][H][4];ee.name=O,ee.tag=_e,Y&&ee.position.set(Y[0],Y[1],Y[2]),he&&ee.rotation.set(he[0],he[1],he[2]),ue&&ee.scale.set(ue[0],ue[1],ue[2]),ee.updateMatrix();const Se=ee.geometry.clone();Se.applyMatrix4(ee.matrix),ee.geometry=Se,ee.renderOrder=1/0,ee.position.set(0,0,0),ee.rotation.set(0,0,0),ee.scale.set(1,1,1),k.add(ee)}return k}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=V(S)),this.add(this.gizmo.rotate=V(I)),this.add(this.gizmo.scale=V(P)),this.add(this.picker.translate=V(E)),this.add(this.picker.rotate=V(R)),this.add(this.picker.scale=V(F)),this.add(this.helper.translate=V(M)),this.add(this.helper.rotate=V(B)),this.add(this.helper.scale=V(j)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Bv;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(fi.setFromEuler(TA.set(0,0,0)),o.quaternion.copy(i).multiply(fi),Math.abs(Vt.copy(Vp).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(fi.setFromEuler(TA.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(fi),Math.abs(Vt.copy(Wh).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(fi.setFromEuler(TA.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(fi),Math.abs(Vt.copy(Wp).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(fi.setFromEuler(TA.set(0,Math.PI/2,0)),Vt.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(_T.lookAt(bT,Vt,Wh)),o.quaternion.multiply(fi),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),fs.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),fs.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(fs),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Vt.copy(Vp).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Vt.copy(Wh).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Vt.copy(Wp).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Vt.copy(Wp).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Vt.copy(Vp).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Vt.copy(Wh).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(RA.copy(i),Vt.copy(this.eye).applyQuaternion(fi.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(_T.lookAt(this.eye,bT,Wh)),o.name==="X"&&(fi.setFromAxisAngle(Vp,Math.atan2(-Vt.y,Vt.z)),fi.multiplyQuaternions(RA,fi),o.quaternion.copy(fi)),o.name==="Y"&&(fi.setFromAxisAngle(Wh,Math.atan2(Vt.x,Vt.z)),fi.multiplyQuaternions(RA,fi),o.quaternion.copy(fi)),o.name==="Z"&&(fi.setFromAxisAngle(Wp,Math.atan2(Vt.y,Vt.x)),fi.multiplyQuaternions(RA,fi),o.quaternion.copy(fi))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(t)}}class S6 extends J{constructor(){super(new pr(1e5,1e5,2,2),new _t({visible:!1,wireframe:!0,side:_i,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),BA.copy(Vp).applyQuaternion(e==="local"?this.worldQuaternion:Bv),Ap.copy(Wh).applyQuaternion(e==="local"?this.worldQuaternion:Bv),vp.copy(Wp).applyQuaternion(e==="local"?this.worldQuaternion:Bv),Vt.copy(Ap),this.mode){case"translate":case"scale":switch(this.axis){case"X":Vt.copy(this.eye).cross(BA),ua.copy(BA).cross(Vt);break;case"Y":Vt.copy(this.eye).cross(Ap),ua.copy(Ap).cross(Vt);break;case"Z":Vt.copy(this.eye).cross(vp),ua.copy(vp).cross(Vt);break;case"XY":ua.copy(vp);break;case"YZ":ua.copy(BA);break;case"XZ":Vt.copy(vp),ua.copy(Ap);break;case"XYZ":case"E":ua.set(0,0,0);break}break;case"rotate":default:ua.set(0,0,0)}ua.length()===0?this.quaternion.copy(this.cameraQuaternion):(wT.lookAt(fs.set(0,0,0),ua,Vt),this.quaternion.setFromRotationMatrix(wT)),super.updateMatrixWorld(t)}}const E6=z("debuggetcomponent"),xT=()=>E6||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function I6(n){return n==null||n.isObject3D?n:n.object&&n.object.isObject3D?n.object:n}function aO(n,t){if(!n||!n.userData.components)return t;const e=n.userData.components.indexOf(t);return e<0||(I0.dispatchComponentLifecycleEvent(im.Removing,t),t.gameObject=null,n.userData.components.splice(e,1)),t}function R0(n,t,e){const i=Qf(n,t);return i||Ao(n,t,e)}const lO=new Sn("addComponentIdProvider");function uf(n,t,e=!0){n.userData||(n.userData={}),n.userData.components||(n.userData.components=[]),n.userData.components.push(t),t.gameObject=n,(t.guid===void 0||t.guid==="invalid")&&(t.guid=lO.generateUUID()),zS(n),qS(t,t.context);try{e&&t.__internalAwake&&(hg(n),t.activeAndEnabled&&t.__internalAwake()),I0.dispatchComponentLifecycleEvent(im.Added,t)}catch(i){console.error(i)}return t}function Ao(n,t,e,i){if(typeof t=="function"){const s=new t;e&&s.__internalNewInstanceCreated(e);let r=!0;return(i==null?void 0:i.callAwake)!=null&&(r=i.callAwake),uf(n,s,r)}if(t.destroyed)return console.warn("Can not move/add a destroyed component",t),t;if(t.gameObject===n)return t;if(t.gameObject&&t.gameObject.userData.components){const s=t.gameObject.userData.components.indexOf(t);t.gameObject.userData.components.splice(s,1)}if(!n.userData.components)n.userData.components=[];else if(n.userData.components.includes(t))return t;return n.userData.components.push(t),t.gameObject=n,(t.guid===void 0||t.guid==="invalid")&&(t.guid=lO.generateUUID()),e&&t._internalInit(e),qS(t,t.context),t}function T6(n){if(n.gameObject&&n.gameObject.userData.components){const t=n.gameObject.userData.components.indexOf(n);n.gameObject.userData.components.splice(t,1)}n.__internalDisable&&n.__internalDisable(),Ul(n,n.context??je.Current),n.destroy(),n.gameObject=null}let CT=!1;function cO(n,t,e){var i;if(n==null)return null;if(!n.isObject3D)return console.error("Object is not object3D"),null;if(!((i=n==null?void 0:n.userData)!=null&&i.components)||(typeof t=="string"&&(CT||(CT=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,t))),xT()&&console.log("[onGetComponent] FIND",t),t==null))return null;for(let s=0;s<n.userData.components.length;s++){const r=n.userData.components[s];let o=Object.getPrototypeOf(r);for(;o;){if(o===t.prototype)if(xT()&&console.log("[onGetComponent] MATCH BY PROTOYPE",o),e)e.push(r);else return r;o=Object.getPrototypeOf(o)}}return e||null}function Qf(n,t){const e=cO(n,t);return e?Array.isArray(e)?e[0]:e:null}function B0(n,t,e,i=!0){return e||(e=[]),i&&(e.length=0),cO(n,t,e),e}function P0(n,t,e){var s;const i=Qf(n,t);if(e===!1&&(i==null?void 0:i.enabled)===!1)return null;if(i)return i;for(let r=0;r<((s=n==null?void 0:n.children)==null?void 0:s.length);r++){const o=P0(n.children[r],t);if(o)return o}return null}function Rm(n,t,e,i=!0){var s;e||(e=[]),i&&(e.length=0),B0(n,t,e,!1);for(let r=0;r<((s=n==null?void 0:n.children)==null?void 0:s.length);r++)Rm(n.children[r],t,e,!1);return e}function uy(n,t){if(!n)return null;if(Array.isArray(n)){for(let i=0;i<n.length;i++){const s=I6(n[i]),r=uy(s,t);if(r)return r}return null}const e=Qf(n,t);return e||(n.parent?uy(n.parent,t):null)}function US(n,t,e,i=!0){return e||(e=[]),i&&(e.length=0),n?(B0(n,t,e,!1),n.parent?US(n.parent,t,e,!1):e):e}function NS(n,t=void 0,e=!0){if(!n)return null;if(!t&&(t=je.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),null;let i=t;if(i.isScene||(i=t==null?void 0:t.scene),!i)return null;for(const s in i.children){const r=i.children[s];if(e===!1&&r[eh]===!1)continue;const o=P0(r,n);if(o)return o}return null}function R6(n,t,e=void 0){if(!n)return t??[];if(t||(t=[]),t.length=0,!e&&(e=je.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),t;"scene"in e&&(e=e.scene);const i=e;if(!i)return t;for(const s in i.children){const r=i.children[s];Rm(r,n,t,!1)}return t}function zS(n){n&&n.isObject3D===!0&&g6(n,ne)}ne.prototype.SetActive=function(n){this.visible=n};ne.prototype.setActive=function(n){this.visible=n};ne.prototype.destroy=function(){wo(this)};ne.prototype.addComponent=function(n,t){return Ao(this,n,t)};ne.prototype.addNewComponent=function(n,t){return Ao(this,n,t)};ne.prototype.removeComponent=function(n){return aO(this,n)};ne.prototype.getOrAddComponent=function(n,t){return R0(this,n,t)};ne.prototype.getComponent=function(n){return Qf(this,n)};ne.prototype.getComponents=function(n,t){return B0(this,n,t)};ne.prototype.getComponentInChildren=function(n){return P0(this,n)};ne.prototype.getComponentsInChildren=function(n,t){return Rm(this,n,t)};ne.prototype.getComponentInParent=function(n){return uy(this,n)};ne.prototype.getComponentsInParent=function(n,t){return US(this,n,t)};Object.getOwnPropertyDescriptor(ne.prototype,"activeSelf")||Object.defineProperty(ne.prototype,"activeSelf",{get:function(){return Bm(this)},set:function(n){kv(this,n)}});Object.getOwnPropertyDescriptor(ne.prototype,"transform")||Object.defineProperty(ne.prototype,"transform",{get:function(){return this}});Object.getOwnPropertyDescriptor(ne.prototype,"worldPosition")||Object.defineProperty(ne.prototype,"worldPosition",{get:function(){return this instanceof FS?He(this.object):He(this)},set:function(n){Cn(this,n)}});Object.getOwnPropertyDescriptor(ne.prototype,"worldQuaternion")||Object.defineProperty(ne.prototype,"worldQuaternion",{get:function(){return this instanceof FS?Gt(this.object):Gt(this)},set:function(n){ia(this,n)}});Object.getOwnPropertyDescriptor(ne.prototype,"worldRotation")||Object.defineProperty(ne.prototype,"worldRotation",{get:function(){return b0(this)},set:function(n){XM(this,n)}});Object.getOwnPropertyDescriptor(ne.prototype,"worldScale")||Object.defineProperty(ne.prototype,"worldScale",{get:function(){return ri(this)},set:function(n){Kg(this,n)}});Object.getOwnPropertyDescriptor(ne.prototype,"worldForward")||Object.defineProperty(ne.prototype,"worldForward",{get:function(){return Re().set(0,0,1).applyQuaternion(Gt(this))}});Object.getOwnPropertyDescriptor(ne.prototype,"worldRight")||Object.defineProperty(ne.prototype,"worldRight",{get:function(){return Re().set(1,0,0).applyQuaternion(Gt(this))}});Object.getOwnPropertyDescriptor(ne.prototype,"worldUp")||Object.defineProperty(ne.prototype,"worldUp",{get:function(){return Re().set(0,1,0).applyQuaternion(Gt(this))}});m6(ne);class Ut extends be{constructor(e,i,s,r){var t=(...args)=>{super(...args);c(this,"alpha",1)};i!=null&&s!=null?(t(e,i,s),this.alpha=r):(t(e),this.alpha=1)}get isRGBAColor(){return!0}set a(e){this.alpha=e}get a(){return this.alpha}clone(){const e=super.clone();return e.alpha=this.alpha,e}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,"alpha"in e&&typeof e.alpha=="number"?this.alpha=e.alpha:typeof e.a=="number"&&(this.alpha=e.a),this}lerp(e,i){const s=e;return s.alpha!=null&&(this.alpha=ye.lerp(this.alpha,s.alpha,i)),super.lerp(e,i)}lerpColors(e,i,s){const r=e,o=i;return r.alpha!=null&&o.alpha!=null&&(this.alpha=ye.lerp(r.alpha,o.alpha,s)),super.lerpColors(e,i,s)}multiply(e){const i=e;return i.alpha!=null&&(this.alpha=this.alpha*i.alpha),super.multiply(e)}fromArray(e,i=0){return this.alpha=e[i+3],super.fromArray(e,i)}}const Pv=z("debuggetcomponent"),Mv=z("debuginstantiate");var ST;(function(n){n[n.None=0]="None",n[n.HideInHierarchy=1]="HideInHierarchy",n[n.HideInInspector=2]="HideInInspector",n[n.DontSaveInEditor=4]="DontSaveInEditor",n[n.NotEditable=8]="NotEditable",n[n.DontSaveInBuild=16]="DontSaveInBuild",n[n.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",n[n.DontSave=52]="DontSave",n[n.HideAndDontSave=61]="HideAndDontSave"})(ST||(ST={}));class ll{constructor(){c(this,"idProvider");c(this,"parent");c(this,"keepWorldPosition");c(this,"position");c(this,"rotation");c(this,"scale");c(this,"visible");c(this,"context");c(this,"components")}clone(){var e,i,s;const t=new ll;return t.idProvider=this.idProvider,t.parent=this.parent,t.keepWorldPosition=this.keepWorldPosition,t.position=(e=this.position)==null?void 0:e.clone(),t.rotation=(i=this.rotation)==null?void 0:i.clone(),t.scale=(s=this.scale)==null?void 0:s.clone(),t.visible=this.visible,t.context=this.context,t.components=this.components,t}cloneAssign(t){var e,i,s;this.idProvider=t.idProvider,this.parent=t.parent,this.keepWorldPosition=t.keepWorldPosition,this.position=(e=t.position)==null?void 0:e.clone(),this.rotation=(i=t.rotation)==null?void 0:i.clone(),this.scale=(s=t.scale)==null?void 0:s.clone(),this.visible=t.visible,this.context=t.context,this.components=t.components}}function Bm(n){return n.visible}function kv(n,t){return typeof t=="number"&&(t=t>.5),n.visible=t,n.visible}function B6(n){return n[eh]||QS(n)}function P6(n,t){n[qD]=t}function QS(n){return ea.isUsingInstancing(n)}function M0(n,t){return jg(n,t,!0,!0)}const hO=Symbol("isDestroyed");function kf(n){return n[hO]}function M6(n,t){n[hO]=t}const Bx=Symbol("isDontDestroy");function ET(n,t=!0){n[Bx]=t}const Dv=[],Ov=[];function wo(n,t=!0,e=!1){Dv.length=0,Ov.length=0,Px(n,t,!0);for(const i of Dv)i.gameObject=null,i.context=null;for(const i of Ov)M6(i,!0),e&&ii(i),C5(i);Ov.length=0,Dv.length=0}function Px(n,t=!0,e=!0){var o;if(n==null)return;const i=n;if(i.isComponent){if(i[Bx])return;Dv.push(i);const a=i.gameObject;i.__internalDisable(),i.__internalDestroy(),i.gameObject=a;return}if(n[Bx])return;const s=n;Pv&&console.log(s),Ov.push(s);const r=(o=s.userData)==null?void 0:o.components;if(r!=null&&Array.isArray(r)){let a=r.length;for(let l=0;l<r.length;l++){const h=r[l];Px(h,t,!1),r.length<a&&(a=r.length,l--)}}if(t&&s.children)for(const a of s.children)Px(a,t,!1);e&&s.removeFromParent()}function Df(n,t,e=!0){return uO(n,t,e)}function*jS(n,t,e=!1,i=999,s=0){if(n!=null&&n.userData.components&&!(s>i)){for(const r of n.userData.components)t&&(r==null?void 0:r.isComponent)===!0&&r instanceof t?yield r:yield r;if(e===!0)for(const r of n.children)yield*jS(r,t,!0,i,s+1)}}function uO(n,t,e,i=0){var s;if(n){if(n.isObject3D,i>1e3){console.warn("Failed to iterate components: too many levels");return}if((s=n.userData)!=null&&s.components)for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r];if((o==null?void 0:o.isComponent)===!0){const a=t(o);if(a!==void 0)return a}}if(e&&n.children){const r=i+1;for(let o=0;o<n.children.length;o++){const a=n.children[o];if(!a)continue;const l=uO(a,t,e,r);if(l!==void 0)return l}}}}function Pm(n,t=null){let e=null;t!==null&&(t.x!==void 0?(e=new ll,e.position=t):e=t);let i=je.Current;e!=null&&e.context&&(i=e.context),Pv&&i.alias&&console.log("context",i.alias),e&&!e.idProvider&&(e.idProvider=new Sn(Date.now()));const s=[],r={},o={},a=dO(i,n,e,s,r,o);a&&(D6(r),k6(o,r)),Pv&&(Kw(n,!0),Kw(a,!0));const l={};if((e==null?void 0:e.components)!==!1){for(const h in s){const u=s[h],d=u.guid;e&&e.idProvider&&(u.guid=e.idProvider.generateUUID(),l[d]=u.guid,Pv&&console.log(u.name,u.guid)),qS(u,i),u.__internalNewInstanceCreated&&u.__internalNewInstanceCreated()}for(const h in s){const u=s[h];u.resolveGuids&&u.resolveGuids(l),u.enabled!==!1&&(u.enabled=!0)}ly(i)}return a}function dO(n,t,e,i,s,r){var u;if(!t)return null;const o=t.userData;t.userData={};const a=t.children;t.children=[];const l=t.clone(!1);if(zS(l),t.userData=o,t.children=a,s[t.uuid]={original:t,clone:l},Mv&&console.log("ADD",t,l),t.type==="SkinnedMesh"&&(r[t.uuid]={original:t,clone:l}),(e==null?void 0:e.visible)!==void 0&&(l.visible=e.visible),e!=null&&e.idProvider){l.uuid=e.idProvider.generateUUID();const d=l;d&&(d.guid=l.uuid)}t.animations&&t.animations.length>0&&(l.animations=[...t.animations]);const h=t.parent;if(h&&h.add(l),e!=null&&e.position?Cn(l,e.position):l.position.copy(t.position),e!=null&&e.rotation?ia(l,e.rotation):l.quaternion.copy(t.quaternion),e!=null&&e.scale?l.scale.copy(e.scale):l.scale.copy(t.scale),e!=null&&e.parent&&e.parent!=="scene"){let d=null;if(typeof e.parent=="string"?d=jg(e.parent,n.scene,!0):d=e.parent,d){const f=e.keepWorldPosition===!0?d.attach:d.add;f?f.call(d,l):console.error("Invalid parent object",d,"received when instantiating:",t)}else console.warn("could not find parent:",e.parent)}for(const[d,f]of Object.entries(t.userData))d!=="components"&&(l.userData[d]=f);if((u=t.userData)!=null&&u.components){const d=t.userData.components,f=[];l.userData.components=f;for(let p=0;p<d.length;p++){const g=d[p],m=new g.constructor;Mf(m,g),g[_v]!==void 0&&(m[_v]=g[_v]),f.push(m),m.gameObject=l,i.push(m),s[g.guid]={original:g,clone:m},I0.dispatchComponentLifecycleEvent(im.Added,m)}}e&&(e.position=void 0,e.rotation=void 0,e.scale=void 0,e.parent=void 0);for(const d in t.children){const f=t.children[d],p=dO(n,f,e,i,s,r);p&&l.add(p)}return l}function k6(n,t){for(const e in n){const i=n[e],s=i.original,r=s.skeleton,o=i.clone;if(!r){console.warn("Skinned mesh has no skeleton?",i);continue}const a=r.bones,l=o.skeleton.clone();o.skeleton=l,o.bindMatrix.clone().copy(s.bindMatrix),o.bindMatrixInverse.copy(s.bindMatrixInverse);const h=[];l.bones=h;for(let u=0;u<a.length;u++){const d=a[u],p=t[d.uuid].clone;h.push(p)}}for(const e in n){const i=n[e].clone;i.skeleton.update(),i.bind(i.skeleton,i.bindMatrix),i.updateMatrixWorld(!0)}}function D6(n){var t;for(const e in n){const s=n[e].clone;if(s!=null&&s.isObject3D&&((t=s==null?void 0:s.userData)!=null&&t.components))for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r],a=Object.entries(o);for(const[l,h]of a)if(Array.isArray(h)){const u=[];o[l]=u;for(let d=0;d<h.length;d++){const f=h[d];if(typeof f!="object"){u.push(f);continue}const p=IT(o,l,f,n);p!==void 0?u.push(p):u.push(f)}}else if(typeof h=="object"){const u=IT(o,l,h,n);u!==void 0&&(o[l]=u)}}}}function IT(n,t,e,i){var s,r;if(e!=null)if(e.isComponent===!0){const o=e.gameObject;if(o){const a=o.uuid,l=(s=i[a])==null?void 0:s.clone;if(!l){Mv&&console.log("reference did not change",t,n,e);return}const h=o.userData.components.indexOf(e);if(h>=0&&l.isObject3D)return Mv&&console.log(t,a),l.userData.components[h];console.warn("could not find component",t,e)}}else if(e.isObject3D===!0){if(t==="gameObject")return;const o=e;if(o){const a=o.uuid,l=(r=i[a])==null?void 0:r.clone;if(l)return Mv&&console.log(t,"old",e,"new",l),l}}else{if(e.isVector4||e.isVector3||e.isVector2||e.isQuaternion||e.isEuler)return e.clone();if(e.isColor===!0)return e.clone();if(e.isEventList===!0)return e.__internalOnInstantiate(i)}}var fO={exports:{}},pO={exports:{}};(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(e,i){return e<<i|e>>>32-i},rotr:function(e,i){return e<<32-i|e>>>i},endian:function(e){if(e.constructor==Number)return t.rotl(e,8)&16711935|t.rotl(e,24)&4278255360;for(var i=0;i<e.length;i++)e[i]=t.endian(e[i]);return e},randomBytes:function(e){for(var i=[];e>0;e--)i.push(Math.floor(Math.random()*256));return i},bytesToWords:function(e){for(var i=[],s=0,r=0;s<e.length;s++,r+=8)i[r>>>5]|=e[s]<<24-r%32;return i},wordsToBytes:function(e){for(var i=[],s=0;s<e.length*32;s+=8)i.push(e[s>>>5]>>>24-s%32&255);return i},bytesToHex:function(e){for(var i=[],s=0;s<e.length;s++)i.push((e[s]>>>4).toString(16)),i.push((e[s]&15).toString(16));return i.join("")},hexToBytes:function(e){for(var i=[],s=0;s<e.length;s+=2)i.push(parseInt(e.substr(s,2),16));return i},bytesToBase64:function(e){for(var i=[],s=0;s<e.length;s+=3)for(var r=e[s]<<16|e[s+1]<<8|e[s+2],o=0;o<4;o++)s*8+o*6<=e.length*8?i.push(n.charAt(r>>>6*(3-o)&63)):i.push("=");return i.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/ig,"");for(var i=[],s=0,r=0;s<e.length;r=++s%4)r!=0&&i.push((n.indexOf(e.charAt(s-1))&Math.pow(2,-2*r+8)-1)<<r*2|n.indexOf(e.charAt(s))>>>6-r*2);return i}};pO.exports=t})();var O6=pO.exports,Mx={utf8:{stringToBytes:function(n){return Mx.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(Mx.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var t=[],e=0;e<n.length;e++)t.push(n.charCodeAt(e)&255);return t},bytesToString:function(n){for(var t=[],e=0;e<n.length;e++)t.push(String.fromCharCode(n[e]));return t.join("")}}},TT=Mx;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var L6=function(n){return n!=null&&(gO(n)||F6(n)||!!n._isBuffer)};function gO(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function F6(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&gO(n.slice(0,0))}(function(){var n=O6,t=TT.utf8,e=L6,i=TT.bin,s=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=i.stringToBytes(r):r=t.stringToBytes(r):e(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var a=n.bytesToWords(r),l=r.length*8,h=1732584193,u=-271733879,d=-1732584194,f=271733878,p=0;p<a.length;p++)a[p]=(a[p]<<8|a[p]>>>24)&16711935|(a[p]<<24|a[p]>>>8)&4278255360;a[l>>>5]|=128<<l%32,a[(l+64>>>9<<4)+14]=l;for(var g=s._ff,m=s._gg,v=s._hh,y=s._ii,p=0;p<a.length;p+=16){var b=h,_=u,x=d,S=f;h=g(h,u,d,f,a[p+0],7,-680876936),f=g(f,h,u,d,a[p+1],12,-389564586),d=g(d,f,h,u,a[p+2],17,606105819),u=g(u,d,f,h,a[p+3],22,-1044525330),h=g(h,u,d,f,a[p+4],7,-176418897),f=g(f,h,u,d,a[p+5],12,1200080426),d=g(d,f,h,u,a[p+6],17,-1473231341),u=g(u,d,f,h,a[p+7],22,-45705983),h=g(h,u,d,f,a[p+8],7,1770035416),f=g(f,h,u,d,a[p+9],12,-1958414417),d=g(d,f,h,u,a[p+10],17,-42063),u=g(u,d,f,h,a[p+11],22,-1990404162),h=g(h,u,d,f,a[p+12],7,1804603682),f=g(f,h,u,d,a[p+13],12,-40341101),d=g(d,f,h,u,a[p+14],17,-1502002290),u=g(u,d,f,h,a[p+15],22,1236535329),h=m(h,u,d,f,a[p+1],5,-165796510),f=m(f,h,u,d,a[p+6],9,-1069501632),d=m(d,f,h,u,a[p+11],14,643717713),u=m(u,d,f,h,a[p+0],20,-373897302),h=m(h,u,d,f,a[p+5],5,-701558691),f=m(f,h,u,d,a[p+10],9,38016083),d=m(d,f,h,u,a[p+15],14,-660478335),u=m(u,d,f,h,a[p+4],20,-405537848),h=m(h,u,d,f,a[p+9],5,568446438),f=m(f,h,u,d,a[p+14],9,-1019803690),d=m(d,f,h,u,a[p+3],14,-187363961),u=m(u,d,f,h,a[p+8],20,1163531501),h=m(h,u,d,f,a[p+13],5,-1444681467),f=m(f,h,u,d,a[p+2],9,-51403784),d=m(d,f,h,u,a[p+7],14,1735328473),u=m(u,d,f,h,a[p+12],20,-1926607734),h=v(h,u,d,f,a[p+5],4,-378558),f=v(f,h,u,d,a[p+8],11,-2022574463),d=v(d,f,h,u,a[p+11],16,1839030562),u=v(u,d,f,h,a[p+14],23,-35309556),h=v(h,u,d,f,a[p+1],4,-1530992060),f=v(f,h,u,d,a[p+4],11,1272893353),d=v(d,f,h,u,a[p+7],16,-155497632),u=v(u,d,f,h,a[p+10],23,-1094730640),h=v(h,u,d,f,a[p+13],4,681279174),f=v(f,h,u,d,a[p+0],11,-358537222),d=v(d,f,h,u,a[p+3],16,-722521979),u=v(u,d,f,h,a[p+6],23,76029189),h=v(h,u,d,f,a[p+9],4,-640364487),f=v(f,h,u,d,a[p+12],11,-421815835),d=v(d,f,h,u,a[p+15],16,530742520),u=v(u,d,f,h,a[p+2],23,-995338651),h=y(h,u,d,f,a[p+0],6,-198630844),f=y(f,h,u,d,a[p+7],10,1126891415),d=y(d,f,h,u,a[p+14],15,-1416354905),u=y(u,d,f,h,a[p+5],21,-57434055),h=y(h,u,d,f,a[p+12],6,1700485571),f=y(f,h,u,d,a[p+3],10,-1894986606),d=y(d,f,h,u,a[p+10],15,-1051523),u=y(u,d,f,h,a[p+1],21,-2054922799),h=y(h,u,d,f,a[p+8],6,1873313359),f=y(f,h,u,d,a[p+15],10,-30611744),d=y(d,f,h,u,a[p+6],15,-1560198380),u=y(u,d,f,h,a[p+13],21,1309151649),h=y(h,u,d,f,a[p+4],6,-145523070),f=y(f,h,u,d,a[p+11],10,-1120210379),d=y(d,f,h,u,a[p+2],15,718787259),u=y(u,d,f,h,a[p+9],21,-343485551),h=h+b>>>0,u=u+_>>>0,d=d+x>>>0,f=f+S>>>0}return n.endian([h,u,d,f])};s._ff=function(r,o,a,l,h,u,d){var f=r+(o&a|~o&l)+(h>>>0)+d;return(f<<u|f>>>32-u)+o},s._gg=function(r,o,a,l,h,u,d){var f=r+(o&l|a&~l)+(h>>>0)+d;return(f<<u|f>>>32-u)+o},s._hh=function(r,o,a,l,h,u,d){var f=r+(o^a^l)+(h>>>0)+d;return(f<<u|f>>>32-u)+o},s._ii=function(r,o,a,l,h,u,d){var f=r+(a^(o|~l))+(h>>>0)+d;return(f<<u|f>>>32-u)+o},s._blocksize=16,s._digestsize=16,fO.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var a=n.wordsToBytes(s(r,o));return o&&o.asBytes?a:o&&o.asString?i.bytesToString(a):n.bytesToHex(a)}})();var U6=fO.exports;const N6=C0(U6);class RT{constructor(t,e,i,s){c(this,"success");c(this,"filename");c(this,"hash");c(this,"size");c(this,"url");this.success=t,this.filename=e,this.hash=i,this.size=s}}async function z6(n,t){const e=await n.arrayBuffer(),i=mO(e),s=n.name.split(".").pop(),r=i+"."+s,o=n.name.split(".").shift();console.assert(o!==void 0);const a={alias:o,filename:r},h=await(await fetch(t+"/exists",{method:"POST",body:JSON.stringify(a)})).json();if(h.success||console.warn("exists check did fail"),h.exists)return console.log("file already exists",i),new RT(!0,r,i,n.size);console.log("begin uploading file",o,n.size);const u=new FormData;u.append("file",n);const d={};d.filesize=n.size,o&&(d.alias=o);const p=await(await fetch(t+"/upload/file",{method:"POST",body:u,headers:d})).json();if((p==null?void 0:p.success)===!1)return p.message!==void 0?console.error("Upload failed:",p.message):console.error("Upload failed"),null;console.assert(p.hash_sum===i,"hash sum did not match","received:",p.hash_sum,"expected:",i),p.success&&console.log("successfully uploaded",i,p.id);const g=new RT(p.success,r,i,n.size);return g.url=t,g}function mO(n){return N6(new Uint8Array(n))}async function AO(n,t,e,i,s=!1){try{const r=await fetch(i+"/download/file",{method:"POST",body:n});if(r.status!==200)return console.error("download failed",r),null;const o=await r.blob(),a=await o.arrayBuffer();s||console.assert(o.size===e,"size mismatch","expected:",e,"got:",o.size);const l=mO(a);return s||console.assert(l===t,"hash mismatch, downloaded file is invalid"),o.arrayBuffer()}catch(r){console.error(r)}return null}async function Q6(n,t){var u;const e=await fetch(n),i=(u=e.body)==null?void 0:u.getReader(),s=e.headers.get("Content-Length"),r=s?parseInt(s):0;if(!i)return null;let o=0;const a=[];for(;;){const{done:d,value:f}=await i.read();if(f&&(a.push(f),o+=f.length,t.call(null,new ProgressEvent("progress",{loaded:o,total:r}))),d)break}const l=new Uint8Array(o);let h=0;for(const d of a)l.set(d,h),h+=d.length;return l}const Ec=z("debugaddressables");class j6{constructor(t){c(this,"_context");c(this,"_assetReferences",{});c(this,"preUpdate",()=>{});this._context=t,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const t=this._context.pre_update_callbacks.indexOf(this.preUpdate);t>=0&&this._context.pre_update_callbacks.splice(t,1);for(const e in this._assetReferences){const i=this._assetReferences[e];i==null||i.unload()}this._assetReferences={}}findAssetReference(t){return this._assetReferences[t]||null}registerAssetReference(t){return t.uri&&(this._assetReferences[t.uri]?console.warn("Asset reference already registered",t):this._assetReferences[t.uri]=t),t}unregisterAssetReference(t){t.uri&&delete this._assetReferences[t.uri]}}const I_=Symbol("assetReference"),$h=class{constructor(t,e,i=null){c(this,"_loading");c(this,"_asset");c(this,"_glbRoot");c(this,"_url");c(this,"_progressListeners",[]);c(this,"_hash");c(this,"_hashedUri");c(this,"_isLoadingRawBinary",!1);c(this,"_rawBinary");this._url=t,this._hash=e,t.includes("?v=")?this._hashedUri=t:this._hashedUri=e?t+"?v="+e:t,i!==null&&(this.asset=i),Y5(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(t,e){if(!e&&(e=je.Current,!e))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const i=e.addressables,s=i.findAssetReference(t);if(s)return s;const r=new $h(t,e.hash);return i.registerAssetReference(r),r}static getOrCreate(t,e,i){if(typeof t=="string"){if(!i&&(i=je.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=t.context,t=t.sourceId;const s=Du(t,e);Ec&&console.log("GetOrCreate Addressable from",t,e,"FinalPath=",s);const r=i.addressables,o=r.findAssetReference(s);if(o)return o;const a=new $h(s,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(t){this._asset=t}get uri(){return this._url}get url(){return this._url}get hasUrl(){return this._url!==void 0&&(this._url.startsWith("http")||this._url.startsWith("blob:")||this._url.startsWith("www.")||this._url.includes("/"))}get rawAsset(){return this._asset}async onResolvePrefab(t){return t===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||kf(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(Ec&&console.log("Unload",this.asset),this.asset.scene&&wo(this.asset.scene,!0,!0),wo(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,je.Current&&je.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,Ec&&console.log("Preload",this._hashedUri);const t=await Q6(this._hashedUri,e=>{this.raiseProgressEvent(e)});return this._rawBinary=(t==null?void 0:t.buffer)??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(t){if(Ec&&console.log("loadAssetAsync",this.uri),!this.mustLoad)return this.asset;if(t&&this._progressListeners.push(t),this._loading!==void 0)return this._loading.then(s=>this.asset);const e=je.Current;this._rawBinary?(this._loading=nl().parseSync(e,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(Ec&&console.log("Load async",this.uri),this._loading=nl().loadSync(e,this._hashedUri,this.uri,null,s=>{this.raiseProgressEvent(s)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[I_]=this,this._glbRoot&&(this._glbRoot[I_]=this),this.asset&&(this.asset[I_]=this),ly(e),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(t){return this.onInstantiate(t,!1)}async instantiateSynced(t,e=!0){return this.onInstantiate(t,!0,e)}beginListenDownload(t){this._progressListeners.indexOf(t)<0&&this._progressListeners.push(t)}endListenDownload(t){const e=this._progressListeners.indexOf(t);e>=0&&this._progressListeners.splice(e,1)}raiseProgressEvent(t){for(const e of this._progressListeners)e(this,t)}async onInstantiate(t,e=!1,i){const s=je.Current,r=new ll;if(t instanceof ne?r.parent=t:t&&(Object.assign(r,t),r.cloneAssign(t)),r.parent||(r.parent=s.scene),this.mustLoad&&await this.loadAssetAsync(),Ec&&console.log("Instantiate",this.uri,"parent:",t),this.asset){Ec&&console.log("Add to scene",this.asset);let o=$h.currentlyInstantiating.get(this.uri);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.uri+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,$h.currentlyInstantiating.set(this.uri,o),e){r.context=s;const a=this.asset;a.guid=this.uri;const l=$D(a,r,void 0,i);if(l)return l}else{const a=Pm(this.asset,r);if(a)return a}}finally{s.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,$h.currentlyInstantiating.set(this.uri,o)})}}else Ec&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(t){if(t&&t.scene){const e=t.scene;return e.isGroup&&e.children.length===1&&e.children[0].name+"glb"===e.name?e.children[0]:e}return null}};let et=$h;c(et,"currentlyInstantiating",new Map);class G6 extends So{constructor(){super([et],"AssetReferenceSerializer")}onSerialize(t,e){if(t&&t.uri!==void 0&&typeof t.uri=="string")return t.uri}onDeserialize(t,e){if(typeof t=="string")return e.context?e.gltfId?et.getOrCreate(e.gltfId,t,e.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(t instanceof ne){if(!e.context)return console.error("Missing context"),null;if(!e.gltfId)return console.error("Missing source id"),null;const i=t,s=e.context,r=i.guid??i.uuid,o=s.addressables.findAssetReference(r);if(o)return o;const a=new et(r,void 0,i);return s.addressables.registerAssetReference(a),a}return null}}new G6;const H6=Promise.resolve(null),Dg=class{constructor(t){c(this,"url");c(this,"_bitmap");c(this,"_bitmapObject");c(this,"loader",null);this.url=t}static getOrCreate(t){let e=Dg.imageReferences.get(t);return e||(e=new Dg(t),Dg.imageReferences.set(t,e)),e}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const t=new Image;return t.src=this.url,t}createTexture(){return this.url?(this.loader||(this.loader=new Xa),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):H6}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((t,e)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(s=>(this._bitmapObject=s,t(s),s))}),i.addEventListener("error",s=>{console.error("Failed to load image:"+this.url,s),t(null)}),i.src=this.url}),this._bitmap)}};let ug=Dg;c(ug,"imageReferences",new Map);class V6 extends So{constructor(){super([ug],"ImageReferenceSerializer")}onSerialize(t,e){return null}onDeserialize(t,e){if(typeof t=="string"){const i=Du(e.gltfId,t);return ug.getOrCreate(i)}}}new V6;const Og=class{constructor(t){c(this,"url");c(this,"res");this.url=t}static getOrCreate(t){let e=Og.cache.get(t);return e||(e=new Og(t),Og.cache.set(t,e)),e}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(t=>t.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(t=>t.text())}};let dg=Og;c(dg,"cache",new Map);class W6 extends So{constructor(){super([dg],"FileReferenceSerializer")}onSerialize(t,e){return null}onDeserialize(t,e){if(typeof t=="string"){const i=Du(e.gltfId,t);return dg.getOrCreate(i)}}}new W6;class q6{constructor(t){c(this,"context");c(this,"mixers",[]);this.context=t}onDestroy(){this.mixers.forEach(t=>t.stopAllAction()),this.mixers.length=0}registerAnimationMixer(t){if(!t){console.warn("AnimationsRegistry.registerAnimationMixer called with null or undefined mixer");return}this.mixers.includes(t)||this.mixers.push(t)}unregisterAnimationMixer(t){if(!t){console.warn("AnimationsRegistry.unregisterAnimationMixer called with null or undefined mixer");return}const e=this.mixers.indexOf(t);e!==-1&&this.mixers.splice(e,1)}}class sm{static tryGetActionsFromMixer(t){const e=t._actions;return e||null}static tryGetAnimationClipsFromObjectHierarchy(t,e){if(e||(e=new Array),t)t.animations&&e.push(...t.animations);else return e;if(t.children)for(const i of t.children)this.tryGetAnimationClipsFromObjectHierarchy(i,e);return e}static assignAnimationsFromFile(t,e){if(!t||!t.animations){console.debug("No animations found in file");return}for(let s=0;s<t.animations.length;s++){const r=t.animations[s];if(!r.tracks||r.tracks.length<=0){console.warn("Animation has no tracks");continue}for(const o in r.tracks){const a=r.tracks[o],l=Ur.parseTrackName(a.name);let h=Ur.findNode(t.scene,l.nodeName);if(!h){const d=a.__objectName??a.name.substring(0,a.name.indexOf("."));if(h=t.scene.getObjectByProperty("uuid",d),!h)continue}let u=i(h);if(!u){if(!(e!=null&&e.createAnimationComponent)){console.warn("No AnimationComponent found in parent hierarchy of object and no 'createAnimationComponent' callback was provided in options.");continue}u=e.createAnimationComponent(t.scene,r)}u.addClip&&u.addClip(r)}}function i(s){var o;if(!s)return null;const r=(o=s.userData)==null?void 0:o.components;if(r&&r.length>0){for(let a=0;a<r.length;a++)if(r[a].isAnimationComponent===!0)return s}return i(s.parent)}}}var du;(function(n){n.Visible="application-visible",n.Hidden="application-hidden",n.MuteChanged="application-mutechanged"})(du||(du={}));let dy=!1;const Od=[];function Nu(){if(dy)return;ve()&&console.debug("User interaction registered: audio can now be played"),dy=!0;const n=[...Od];Od.length=0,n.forEach(t=>t())}document.addEventListener("mousedown",Nu);document.addEventListener("pointerup",Nu);document.addEventListener("click",Nu);document.addEventListener("dragstart",Nu);document.addEventListener("touchend",Nu);document.addEventListener("keydown",Nu);Le.onXRSessionStart(()=>{Nu()});const $E=class extends EventTarget{constructor(e){super();c(this,"_mute",!1);c(this,"context");c(this,"_isVisible",!0);this.context=e,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return dy}static registerWaitForInteraction(e){if(e!==null){if(dy){e();return}Od.indexOf(e)===-1&&Od.push(e)}}static unregisterWaitForInteraction(e){const i=Od.indexOf(e);i!==-1&&Od.splice(i,1)}get muted(){return this._mute}set muted(e){e!==this._mute&&(this._mute=e,this.dispatchEvent(new Event(du.MuteChanged)))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(e){switch(e.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event(du.Hidden));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event(du.Visible));break}}};let Ja=$E;c(Ja,"registerWaitForAllowAudio",$E.registerWaitForInteraction);function*X6(n,t=null){const e=t?t.time:je.Current.time,i=e.time;for(;e.time-i<n;)yield}function*ZK(n){for(let t=0;t<n;t++)yield}function*Y6(n){let t=!0;for(n.then(()=>t=!1),n.catch(()=>t=!1);t;)yield}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var BT=function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))};try{URL.revokeObjectURL(BT(""))}catch{BT=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)}}var qi=Uint8Array,Vs=Uint16Array,Of=Uint32Array,k0=new qi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),D0=new qi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),kx=new qi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vO=function(n,t){for(var e=new Vs(31),i=0;i<31;++i)e[i]=t+=1<<n[i-1];for(var s=new Of(e[30]),i=1;i<30;++i)for(var r=e[i];r<e[i+1];++r)s[r]=r-e[i]<<5|i;return[e,s]},yO=vO(k0,2),bO=yO[0],Dx=yO[1];bO[28]=258,Dx[258]=28;var _O=vO(D0,0),K6=_O[0],PT=_O[1],Ox=new Vs(32768);for(var oi=0;oi<32768;++oi){var Ic=(oi&43690)>>>1|(oi&21845)<<1;Ic=(Ic&52428)>>>2|(Ic&13107)<<2,Ic=(Ic&61680)>>>4|(Ic&3855)<<4,Ox[oi]=((Ic&65280)>>>8|(Ic&255)<<8)>>>1}var Za=function(n,t,e){for(var i=n.length,s=0,r=new Vs(t);s<i;++s)++r[n[s]-1];var o=new Vs(t);for(s=0;s<t;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(e){a=new Vs(1<<t);var l=15-t;for(s=0;s<i;++s)if(n[s])for(var h=s<<4|n[s],u=t-n[s],d=o[n[s]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)a[Ox[d]>>>l]=h}else for(a=new Vs(i),s=0;s<i;++s)n[s]&&(a[s]=Ox[o[n[s]-1]++]>>>15-n[s]);return a},dh=new qi(288);for(var oi=0;oi<144;++oi)dh[oi]=8;for(var oi=144;oi<256;++oi)dh[oi]=9;for(var oi=256;oi<280;++oi)dh[oi]=7;for(var oi=280;oi<288;++oi)dh[oi]=8;var rm=new qi(32);for(var oi=0;oi<32;++oi)rm[oi]=5;var J6=Za(dh,9,0),Z6=Za(dh,9,1),$6=Za(rm,5,0),eH=Za(rm,5,1),T_=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},Lo=function(n,t,e){var i=t/8|0;return(n[i]|n[i+1]<<8)>>(t&7)&e},R_=function(n,t){var e=t/8|0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>(t&7)},GS=function(n){return(n/8|0)+(n&7&&1)},HS=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var i=new(n instanceof Vs?Vs:n instanceof Of?Of:qi)(e-t);return i.set(n.subarray(t,e)),i},tH=function(n,t,e){var i=n.length;if(!i||e&&!e.l&&i<5)return t||new qi(0);var s=!t||e,r=!e||e.i;e||(e={}),t||(t=new qi(i*3));var o=function(Pe){var Ye=t.length;if(Pe>Ye){var Pt=new qi(Math.max(Ye*2,Pe));Pt.set(t),t=Pt}},a=e.f||0,l=e.p||0,h=e.b||0,u=e.l,d=e.d,f=e.m,p=e.n,g=i*8;do{if(!u){e.f=a=Lo(n,l,1);var m=Lo(n,l+1,3);if(l+=3,m)if(m==1)u=Z6,d=eH,f=9,p=5;else if(m==2){var _=Lo(n,l,31)+257,x=Lo(n,l+10,15)+4,S=_+Lo(n,l+5,31)+1;l+=14;for(var E=new qi(S),M=new qi(19),I=0;I<x;++I)M[kx[I]]=Lo(n,l+I*3,7);l+=x*3;for(var B=T_(M),R=(1<<B)-1,P=Za(M,B,1),I=0;I<S;){var F=P[Lo(n,l,R)];l+=F&15;var v=F>>>4;if(v<16)E[I++]=v;else{var j=0,V=0;for(v==16?(V=3+Lo(n,l,3),l+=2,j=E[I-1]):v==17?(V=3+Lo(n,l,7),l+=3):v==18&&(V=11+Lo(n,l,127),l+=7);V--;)E[I++]=j}}var X=E.subarray(0,_),k=E.subarray(_);f=T_(X),p=T_(k),u=Za(X,f,1),d=Za(k,p,1)}else throw"invalid block type";else{var v=GS(l)+4,y=n[v-4]|n[v-3]<<8,b=v+y;if(b>i){if(r)throw"unexpected EOF";break}s&&o(h+y),t.set(n.subarray(v,b),h),e.b=h+=y,e.p=l=b*8;continue}if(l>g){if(r)throw"unexpected EOF";break}}s&&o(h+131072);for(var O=(1<<f)-1,H=(1<<p)-1,ee=l;;ee=l){var j=u[R_(n,l)&O],Y=j>>>4;if(l+=j&15,l>g){if(r)throw"unexpected EOF";break}if(!j)throw"invalid length/literal";if(Y<256)t[h++]=Y;else if(Y==256){ee=l,u=null;break}else{var he=Y-254;if(Y>264){var I=Y-257,ue=k0[I];he=Lo(n,l,(1<<ue)-1)+bO[I],l+=ue}var _e=d[R_(n,l)&H],Se=_e>>>4;if(!_e)throw"invalid distance";l+=_e&15;var k=K6[Se];if(Se>3){var ue=D0[Se];k+=R_(n,l)&(1<<ue)-1,l+=ue}if(l>g){if(r)throw"unexpected EOF";break}s&&o(h+131072);for(var qe=h+he;h<qe;h+=4)t[h]=t[h-k],t[h+1]=t[h+1-k],t[h+2]=t[h+2-k],t[h+3]=t[h+3-k];h=qe}}e.l=u,e.p=ee,e.b=h,u&&(a=1,e.m=f,e.d=d,e.n=p)}while(!a);return h==t.length?t:HS(t,0,h)},yl=function(n,t,e){e<<=t&7;var i=t/8|0;n[i]|=e,n[i+1]|=e>>>8},yp=function(n,t,e){e<<=t&7;var i=t/8|0;n[i]|=e,n[i+1]|=e>>>8,n[i+2]|=e>>>16},B_=function(n,t){for(var e=[],i=0;i<n.length;++i)n[i]&&e.push({s:i,f:n[i]});var s=e.length,r=e.slice();if(!s)return[VS,0];if(s==1){var o=new qi(e[0].s+1);return o[e[0].s]=1,[o,1]}e.sort(function(S,E){return S.f-E.f}),e.push({s:-1,f:25001});var a=e[0],l=e[1],h=0,u=1,d=2;for(e[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=s-1;)a=e[e[h].f<e[d].f?h++:d++],l=e[h!=u&&e[h].f<e[d].f?h++:d++],e[u++]={s:-1,f:a.f+l.f,l:a,r:l};for(var f=r[0].s,i=1;i<s;++i)r[i].s>f&&(f=r[i].s);var p=new Vs(f+1),g=Lx(e[u-1],p,0);if(g>t){var i=0,m=0,v=g-t,y=1<<v;for(r.sort(function(E,M){return p[M.s]-p[E.s]||E.f-M.f});i<s;++i){var b=r[i].s;if(p[b]>t)m+=y-(1<<g-p[b]),p[b]=t;else break}for(m>>>=v;m>0;){var _=r[i].s;p[_]<t?m-=1<<t-p[_]++-1:++i}for(;i>=0&&m;--i){var x=r[i].s;p[x]==t&&(--p[x],++m)}g=t}return[new qi(p),g]},Lx=function(n,t,e){return n.s==-1?Math.max(Lx(n.l,t,e+1),Lx(n.r,t,e+1)):t[n.s]=e},MT=function(n){for(var t=n.length;t&&!n[--t];);for(var e=new Vs(++t),i=0,s=n[0],r=1,o=function(l){e[i++]=l},a=1;a<=t;++a)if(n[a]==s&&a!=t)++r;else{if(!s&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(s),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(s);r=1,s=n[a]}return[e.subarray(0,i),t]},bp=function(n,t){for(var e=0,i=0;i<t.length;++i)e+=n[i]*t[i];return e},Lv=function(n,t,e){var i=e.length,s=GS(t+2);n[s]=i&255,n[s+1]=i>>>8,n[s+2]=n[s]^255,n[s+3]=n[s+1]^255;for(var r=0;r<i;++r)n[s+r+4]=e[r];return(s+4+i)*8},kT=function(n,t,e,i,s,r,o,a,l,h,u){yl(t,u++,e),++s[256];for(var d=B_(s,15),f=d[0],p=d[1],g=B_(r,15),m=g[0],v=g[1],y=MT(f),b=y[0],_=y[1],x=MT(m),S=x[0],E=x[1],M=new Vs(19),I=0;I<b.length;++I)M[b[I]&31]++;for(var I=0;I<S.length;++I)M[S[I]&31]++;for(var B=B_(M,7),R=B[0],P=B[1],F=19;F>4&&!R[kx[F-1]];--F);var j=h+5<<3,V=bp(s,dh)+bp(r,rm)+o,X=bp(s,f)+bp(r,m)+o+14+3*F+bp(M,R)+(2*M[16]+3*M[17]+7*M[18]);if(j<=V&&j<=X)return Lv(t,u,n.subarray(l,l+h));var k,O,H,ee;if(yl(t,u,1+(X<V)),u+=2,X<V){k=Za(f,p,0),O=f,H=Za(m,v,0),ee=m;var Y=Za(R,P,0);yl(t,u,_-257),yl(t,u+5,E-1),yl(t,u+10,F-4),u+=14;for(var I=0;I<F;++I)yl(t,u+3*I,R[kx[I]]);u+=3*F;for(var he=[b,S],ue=0;ue<2;++ue)for(var _e=he[ue],I=0;I<_e.length;++I){var Se=_e[I]&31;yl(t,u,Y[Se]),u+=R[Se],Se>15&&(yl(t,u,_e[I]>>>5&127),u+=_e[I]>>>12)}}else k=J6,O=dh,H=$6,ee=rm;for(var I=0;I<a;++I)if(i[I]>255){var Se=i[I]>>>18&31;yp(t,u,k[Se+257]),u+=O[Se+257],Se>7&&(yl(t,u,i[I]>>>23&31),u+=k0[Se]);var qe=i[I]&31;yp(t,u,H[qe]),u+=ee[qe],qe>3&&(yp(t,u,i[I]>>>5&8191),u+=D0[qe])}else yp(t,u,k[i[I]]),u+=O[i[I]];return yp(t,u,k[256]),u+O[256]},iH=new Of([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),VS=new qi(0),nH=function(n,t,e,i,s,r){var o=n.length,a=new qi(i+o+5*(1+Math.ceil(o/7e3))+s),l=a.subarray(i,a.length-s),h=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var d=u+65535;d<o?h=Lv(l,h,n.subarray(u,d)):(l[u]=r,h=Lv(l,h,n.subarray(u,o)))}else{for(var f=iH[t-1],p=f>>>13,g=f&8191,m=(1<<e)-1,v=new Vs(32768),y=new Vs(m+1),b=Math.ceil(e/3),_=2*b,x=function(ss){return(n[ss]^n[ss+1]<<b^n[ss+2]<<_)&m},S=new Of(25e3),E=new Vs(288),M=new Vs(32),I=0,B=0,u=0,R=0,P=0,F=0;u<o;++u){var j=x(u),V=u&32767,X=y[j];if(v[V]=X,y[j]=V,P<=u){var k=o-u;if((I>7e3||R>24576)&&k>423){h=kT(n,l,0,S,E,M,B,R,F,u-F,h),R=I=B=0,F=u;for(var O=0;O<286;++O)E[O]=0;for(var O=0;O<30;++O)M[O]=0}var H=2,ee=0,Y=g,he=V-X&32767;if(k>2&&j==x(u-he))for(var ue=Math.min(p,k)-1,_e=Math.min(32767,u),Se=Math.min(258,k);he<=_e&&--Y&&V!=X;){if(n[u+H]==n[u+H-he]){for(var qe=0;qe<Se&&n[u+qe]==n[u+qe-he];++qe);if(qe>H){if(H=qe,ee=he,qe>ue)break;for(var Pe=Math.min(he,qe-2),Ye=0,O=0;O<Pe;++O){var Pt=u-he+O+32768&32767,Tt=v[Pt],ci=Pt-Tt+32768&32767;ci>Ye&&(Ye=ci,X=Pt)}}}V=X,X=v[V],he+=V-X+32768&32767}if(ee){S[R++]=268435456|Dx[H]<<18|PT[ee];var Ei=Dx[H]&31,Bs=PT[ee]&31;B+=k0[Ei]+D0[Bs],++E[257+Ei],++M[Bs],P=u+H,++I}else S[R++]=n[u],++E[n[u]]}}h=kT(n,l,r,S,E,M,B,R,F,u-F,h),!r&&h&7&&(h=Lv(l,h+1,VS))}return HS(a,0,i+GS(h)+s)},sH=function(){for(var n=new Of(256),t=0;t<256;++t){for(var e=t,i=9;--i;)e=(e&1&&3988292384)^e>>>1;n[t]=e}return n}(),rH=function(){var n=-1;return{p:function(t){for(var e=n,i=0;i<t.length;++i)e=sH[e&255^t[i]]^e>>>8;n=e},d:function(){return~n}}},oH=function(n,t,e,i,s){return nH(n,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+t.mem,e,i,!s)},wO=function(n,t){var e={};for(var i in n)e[i]=n[i];for(var i in t)e[i]=t[i];return e},Vn=function(n,t,e){for(;e;++t)n[t]=e,e>>>=8},aH=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function lH(n,t){return oH(n,t||{},0,0)}function qp(n,t){return tH((aH(n),n.subarray(2,-4)),t)}var xO=function(n,t,e,i){for(var s in n){var r=n[s],o=t+s;r instanceof qi?e[o]=[r,i]:Array.isArray(r)?e[o]=[r[0],wO(i,r[1])]:xO(r,o+"/",e,i)}},DT=typeof TextEncoder<"u"&&new TextEncoder,cH=typeof TextDecoder<"u"&&new TextDecoder,hH=0;try{cH.decode(VS,{stream:!0}),hH=1}catch{}function fy(n,t){if(t){for(var e=new qi(n.length),i=0;i<n.length;++i)e[i]=n.charCodeAt(i);return e}if(DT)return DT.encode(n);for(var s=n.length,r=new qi(n.length+(n.length>>1)),o=0,a=function(u){r[o++]=u},i=0;i<s;++i){if(o+5>r.length){var l=new qi(o+8+(s-i<<1));l.set(r),r=l}var h=n.charCodeAt(i);h<128||t?a(h):h<2048?(a(192|h>>6),a(128|h&63)):h>55295&&h<57344?(h=65536+(h&1047552)|n.charCodeAt(++i)&1023,a(240|h>>18),a(128|h>>12&63),a(128|h>>6&63),a(128|h&63)):(a(224|h>>12),a(128|h>>6&63),a(128|h&63))}return HS(r,0,o)}var Fx=function(n){var t=0;if(n)for(var e in n){var i=n[e].length;if(i>65535)throw"extra field too long";t+=i+4}return t},OT=function(n,t,e,i,s,r,o,a){var l=i.length,h=e.extra,u=a&&a.length,d=Fx(h);Vn(n,t,o!=null?33639248:67324752),t+=4,o!=null&&(n[t++]=20,n[t++]=e.os),n[t]=20,t+=2,n[t++]=e.flag<<1|(r==null&&8),n[t++]=s&&8,n[t++]=e.compression&255,n[t++]=e.compression>>8;var f=new Date(e.mtime==null?Date.now():e.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Vn(n,t,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),t+=4,r!=null&&(Vn(n,t,e.crc),Vn(n,t+4,r),Vn(n,t+8,e.size)),Vn(n,t+12,l),Vn(n,t+14,d),t+=16,o!=null&&(Vn(n,t,u),Vn(n,t+6,e.attrs),Vn(n,t+10,o),t+=14),n.set(i,t),t+=l,d)for(var g in h){var m=h[g],v=m.length;Vn(n,t,+g),Vn(n,t+2,v),n.set(m,t+4),t+=4+v}return u&&(n.set(a,t),t+=u),t},uH=function(n,t,e,i,s){Vn(n,t,101010256),Vn(n,t+8,e),Vn(n,t+10,e),Vn(n,t+12,i),Vn(n,t+16,s)};function dH(n,t){t||(t={});var e={},i=[];xO(n,"",e,t);var s=0,r=0;for(var o in e){var a=e[o],l=a[0],h=a[1],u=h.level==0?0:8,d=fy(o),f=d.length,p=h.comment,g=p&&fy(p),m=g&&g.length,v=Fx(h.extra);if(f>65535)throw"filename too long";var y=u?lH(l,h):l,b=y.length,_=rH();_.p(l),i.push(wO(h,{size:l.length,crc:_.d(),c:y,f:d,m:g,u:f!=o.length||g&&p.length!=m,o:s,compression:u})),s+=30+f+v+b,r+=76+2*(f+v)+(m||0)+b}for(var x=new qi(r+22),S=s,E=r-s,M=0;M<i.length;++M){var d=i[M];OT(x,d.o,d,d.f,d.u,d.c.length);var I=30+d.f.length+Fx(d.extra);x.set(d.c,d.o+I),OT(x,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+I+(d.m?d.m.length:0)}return uH(x,s,i.length,E,S),x}class om extends FP{constructor(t){super(t),this.type=Zn}parse(t){const B=Math.pow(2.7182818,2.2);function R(C,T){let L=0;for(let te=0;te<65536;++te)(te==0||C[te>>3]&1<<(te&7))&&(T[L++]=te);const W=L-1;for(;L<65536;)T[L++]=0;return W}function P(C){for(let T=0;T<16384;T++)C[T]={},C[T].len=0,C[T].lit=0,C[T].p=null}const F={l:0,c:0,lc:0};function j(C,T,L,W,te){for(;L<C;)T=T<<8|yt(W,te),L+=8;L-=C,F.l=T>>L&(1<<C)-1,F.c=T,F.lc=L}const V=new Array(59);function X(C){for(let L=0;L<=58;++L)V[L]=0;for(let L=0;L<65537;++L)V[C[L]]+=1;let T=0;for(let L=58;L>0;--L){const W=T+V[L]>>1;V[L]=T,T=W}for(let L=0;L<65537;++L){const W=C[L];W>0&&(C[L]=W|V[W]++<<6)}}function k(C,T,L,W,te,Z){const de=T;let ge=0,Ae=0;for(;W<=te;W++){if(de.value-T.value>L)return!1;j(6,ge,Ae,C,de);const ce=F.l;if(ge=F.c,Ae=F.lc,Z[W]=ce,ce==63){if(de.value-T.value>L)throw new Error("Something wrong with hufUnpackEncTable");j(8,ge,Ae,C,de);let pe=F.l+6;if(ge=F.c,Ae=F.lc,W+pe>te+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pe--;)Z[W++]=0;W--}else if(ce>=59){let pe=ce-59+2;if(W+pe>te+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pe--;)Z[W++]=0;W--}}X(Z)}function O(C){return C&63}function H(C){return C>>6}function ee(C,T,L,W){for(;T<=L;T++){const te=H(C[T]),Z=O(C[T]);if(te>>Z)throw new Error("Invalid table entry");if(Z>14){const de=W[te>>Z-14];if(de.len)throw new Error("Invalid table entry");if(de.lit++,de.p){const ge=de.p;de.p=new Array(de.lit);for(let Ae=0;Ae<de.lit-1;++Ae)de.p[Ae]=ge[Ae]}else de.p=new Array(1);de.p[de.lit-1]=T}else if(Z){let de=0;for(let ge=1<<14-Z;ge>0;ge--){const Ae=W[(te<<14-Z)+de];if(Ae.len||Ae.p)throw new Error("Invalid table entry");Ae.len=Z,Ae.lit=T,de++}}}return!0}const Y={c:0,lc:0};function he(C,T,L,W){C=C<<8|yt(L,W),T+=8,Y.c=C,Y.lc=T}const ue={c:0,lc:0};function _e(C,T,L,W,te,Z,de,ge,Ae){if(C==T){W<8&&(he(L,W,te,Z),L=Y.c,W=Y.lc),W-=8;let ce=L>>W;if(ce=new Uint8Array([ce])[0],ge.value+ce>Ae)return!1;const pe=de[ge.value-1];for(;ce-- >0;)de[ge.value++]=pe}else if(ge.value<Ae)de[ge.value++]=C;else return!1;ue.c=L,ue.lc=W}function Se(C){return C&65535}function qe(C){const T=Se(C);return T>32767?T-65536:T}const Pe={a:0,b:0};function Ye(C,T){const L=qe(C),te=qe(T),Z=L+(te&1)+(te>>1),de=Z,ge=Z-te;Pe.a=de,Pe.b=ge}function Pt(C,T){const L=Se(C),W=Se(T),te=L-(W>>1)&65535,Z=W+te-32768&65535;Pe.a=Z,Pe.b=te}function Tt(C,T,L,W,te,Z,de){const ge=de<16384,Ae=L>te?te:L;let ce=1,pe,Me;for(;ce<=Ae;)ce<<=1;for(ce>>=1,pe=ce,ce>>=1;ce>=1;){Me=0;const Te=Me+Z*(te-pe),Xe=Z*ce,it=Z*pe,Oe=W*ce,ze=W*pe;let ot,Ii,Mi,_r;for(;Me<=Te;Me+=it){let ei=Me;const wt=Me+W*(L-pe);for(;ei<=wt;ei+=ze){const $i=ei+Oe,Yr=ei+Xe,fn=Yr+Oe;ge?(Ye(C[ei+T],C[Yr+T]),ot=Pe.a,Mi=Pe.b,Ye(C[$i+T],C[fn+T]),Ii=Pe.a,_r=Pe.b,Ye(ot,Ii),C[ei+T]=Pe.a,C[$i+T]=Pe.b,Ye(Mi,_r),C[Yr+T]=Pe.a,C[fn+T]=Pe.b):(Pt(C[ei+T],C[Yr+T]),ot=Pe.a,Mi=Pe.b,Pt(C[$i+T],C[fn+T]),Ii=Pe.a,_r=Pe.b,Pt(ot,Ii),C[ei+T]=Pe.a,C[$i+T]=Pe.b,Pt(Mi,_r),C[Yr+T]=Pe.a,C[fn+T]=Pe.b)}if(L&ce){const $i=ei+Xe;ge?Ye(C[ei+T],C[$i+T]):Pt(C[ei+T],C[$i+T]),ot=Pe.a,C[$i+T]=Pe.b,C[ei+T]=ot}}if(te&ce){let ei=Me;const wt=Me+W*(L-pe);for(;ei<=wt;ei+=ze){const $i=ei+Oe;ge?Ye(C[ei+T],C[$i+T]):Pt(C[ei+T],C[$i+T]),ot=Pe.a,C[$i+T]=Pe.b,C[ei+T]=ot}}pe=ce,ce>>=1}return Me}function ci(C,T,L,W,te,Z,de,ge,Ae){let ce=0,pe=0;const Me=de,Te=Math.trunc(W.value+(te+7)/8);for(;W.value<Te;)for(he(ce,pe,L,W),ce=Y.c,pe=Y.lc;pe>=14;){const it=ce>>pe-14&16383,Oe=T[it];if(Oe.len)pe-=Oe.len,_e(Oe.lit,Z,ce,pe,L,W,ge,Ae,Me),ce=ue.c,pe=ue.lc;else{if(!Oe.p)throw new Error("hufDecode issues");let ze;for(ze=0;ze<Oe.lit;ze++){const ot=O(C[Oe.p[ze]]);for(;pe<ot&&W.value<Te;)he(ce,pe,L,W),ce=Y.c,pe=Y.lc;if(pe>=ot&&H(C[Oe.p[ze]])==(ce>>pe-ot&(1<<ot)-1)){pe-=ot,_e(Oe.p[ze],Z,ce,pe,L,W,ge,Ae,Me),ce=ue.c,pe=ue.lc;break}}if(ze==Oe.lit)throw new Error("hufDecode issues")}}const Xe=8-te&7;for(ce>>=Xe,pe-=Xe;pe>0;){const it=T[ce<<14-pe&16383];if(it.len)pe-=it.len,_e(it.lit,Z,ce,pe,L,W,ge,Ae,Me),ce=ue.c,pe=ue.lc;else throw new Error("hufDecode issues")}return!0}function Ei(C,T,L,W,te,Z){const de={value:0},ge=L.value,Ae=zt(T,L),ce=zt(T,L);L.value+=4;const pe=zt(T,L);if(L.value+=4,Ae<0||Ae>=65537||ce<0||ce>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Me=new Array(65537),Te=new Array(16384);P(Te);const Xe=W-(L.value-ge);if(k(C,L,Xe,Ae,ce,Me),pe>8*(W-(L.value-ge)))throw new Error("Something wrong with hufUncompress");ee(Me,Ae,ce,Te),ci(Me,Te,C,L,pe,ce,Z,te,de)}function Bs(C,T,L){for(let W=0;W<L;++W)T[W]=C[T[W]]}function Vr(C){for(let T=1;T<C.length;T++){const L=C[T-1]+C[T]-128;C[T]=L}}function ss(C,T){let L=0,W=Math.floor((C.length+1)/2),te=0;const Z=C.length-1;for(;!(te>Z||(T[te++]=C[L++],te>Z));)T[te++]=C[W++]}function Ar(C){let T=C.byteLength;const L=new Array;let W=0;const te=new DataView(C);for(;T>0;){const Z=te.getInt8(W++);if(Z<0){const de=-Z;T-=de+1;for(let ge=0;ge<de;ge++)L.push(te.getUint8(W++))}else{const de=Z;T-=2;const ge=te.getUint8(W++);for(let Ae=0;Ae<de+1;Ae++)L.push(ge)}}return L}function Wr(C,T,L,W,te,Z){let de=new DataView(Z.buffer);const ge=L[C.idx[0]].width,Ae=L[C.idx[0]].height,ce=3,pe=Math.floor(ge/8),Me=Math.ceil(ge/8),Te=Math.ceil(Ae/8),Xe=ge-(Me-1)*8,it=Ae-(Te-1)*8,Oe={value:0},ze=new Array(ce),ot=new Array(ce),Ii=new Array(ce),Mi=new Array(ce),_r=new Array(ce);for(let wt=0;wt<ce;++wt)_r[wt]=T[C.idx[wt]],ze[wt]=wt<1?0:ze[wt-1]+Me*Te,ot[wt]=new Float32Array(64),Ii[wt]=new Uint16Array(64),Mi[wt]=new Uint16Array(Me*64);for(let wt=0;wt<Te;++wt){let $i=8;wt==Te-1&&($i=it);let Yr=8;for(let Ft=0;Ft<Me;++Ft){Ft==Me-1&&(Yr=Xe);for(let Xt=0;Xt<ce;++Xt)Ii[Xt].fill(0),Ii[Xt][0]=te[ze[Xt]++],qr(Oe,W,Ii[Xt]),To(Ii[Xt],ot[Xt]),Ro(ot[Xt]);Xr(ot);for(let Xt=0;Xt<ce;++Xt)vr(ot[Xt],Mi[Xt],Ft*64)}let fn=0;for(let Ft=0;Ft<ce;++Ft){const Xt=L[C.idx[Ft]].type;for(let gl=8*wt;gl<8*wt+$i;++gl){fn=_r[Ft][gl];for(let ap=0;ap<pe;++ap){const ca=ap*64+(gl&7)*8;de.setUint16(fn+0*2*Xt,Mi[Ft][ca+0],!0),de.setUint16(fn+1*2*Xt,Mi[Ft][ca+1],!0),de.setUint16(fn+2*2*Xt,Mi[Ft][ca+2],!0),de.setUint16(fn+3*2*Xt,Mi[Ft][ca+3],!0),de.setUint16(fn+4*2*Xt,Mi[Ft][ca+4],!0),de.setUint16(fn+5*2*Xt,Mi[Ft][ca+5],!0),de.setUint16(fn+6*2*Xt,Mi[Ft][ca+6],!0),de.setUint16(fn+7*2*Xt,Mi[Ft][ca+7],!0),fn+=8*2*Xt}}if(pe!=Me)for(let gl=8*wt;gl<8*wt+$i;++gl){const ap=_r[Ft][gl]+8*pe*2*Xt,ca=pe*64+(gl&7)*8;for(let rA=0;rA<Yr;++rA)de.setUint16(ap+rA*2*Xt,Mi[Ft][ca+rA],!0)}}}const ei=new Uint16Array(ge);de=new DataView(Z.buffer);for(let wt=0;wt<ce;++wt){L[C.idx[wt]].decoded=!0;const $i=L[C.idx[wt]].type;if(L[wt].type==2)for(let Yr=0;Yr<Ae;++Yr){const fn=_r[wt][Yr];for(let Ft=0;Ft<ge;++Ft)ei[Ft]=de.getUint16(fn+Ft*2*$i,!0);for(let Ft=0;Ft<ge;++Ft)de.setFloat32(fn+Ft*2*$i,K(ei[Ft]),!0)}}}function qr(C,T,L){let W,te=1;for(;te<64;)W=T[C.value],W==65280?te=64:W>>8==255?te+=W&255:(L[te]=W,te++),C.value++}function To(C,T){T[0]=K(C[0]),T[1]=K(C[1]),T[2]=K(C[5]),T[3]=K(C[6]),T[4]=K(C[14]),T[5]=K(C[15]),T[6]=K(C[27]),T[7]=K(C[28]),T[8]=K(C[2]),T[9]=K(C[4]),T[10]=K(C[7]),T[11]=K(C[13]),T[12]=K(C[16]),T[13]=K(C[26]),T[14]=K(C[29]),T[15]=K(C[42]),T[16]=K(C[3]),T[17]=K(C[8]),T[18]=K(C[12]),T[19]=K(C[17]),T[20]=K(C[25]),T[21]=K(C[30]),T[22]=K(C[41]),T[23]=K(C[43]),T[24]=K(C[9]),T[25]=K(C[11]),T[26]=K(C[18]),T[27]=K(C[24]),T[28]=K(C[31]),T[29]=K(C[40]),T[30]=K(C[44]),T[31]=K(C[53]),T[32]=K(C[10]),T[33]=K(C[19]),T[34]=K(C[23]),T[35]=K(C[32]),T[36]=K(C[39]),T[37]=K(C[45]),T[38]=K(C[52]),T[39]=K(C[54]),T[40]=K(C[20]),T[41]=K(C[22]),T[42]=K(C[33]),T[43]=K(C[38]),T[44]=K(C[46]),T[45]=K(C[51]),T[46]=K(C[55]),T[47]=K(C[60]),T[48]=K(C[21]),T[49]=K(C[34]),T[50]=K(C[37]),T[51]=K(C[47]),T[52]=K(C[50]),T[53]=K(C[56]),T[54]=K(C[59]),T[55]=K(C[61]),T[56]=K(C[35]),T[57]=K(C[36]),T[58]=K(C[48]),T[59]=K(C[49]),T[60]=K(C[57]),T[61]=K(C[58]),T[62]=K(C[62]),T[63]=K(C[63])}function Ro(C){const T=.5*Math.cos(.7853975),L=.5*Math.cos(3.14159/16),W=.5*Math.cos(3.14159/8),te=.5*Math.cos(3*3.14159/16),Z=.5*Math.cos(5*3.14159/16),de=.5*Math.cos(3*3.14159/8),ge=.5*Math.cos(7*3.14159/16),Ae=new Array(4),ce=new Array(4),pe=new Array(4),Me=new Array(4);for(let Te=0;Te<8;++Te){const Xe=Te*8;Ae[0]=W*C[Xe+2],Ae[1]=de*C[Xe+2],Ae[2]=W*C[Xe+6],Ae[3]=de*C[Xe+6],ce[0]=L*C[Xe+1]+te*C[Xe+3]+Z*C[Xe+5]+ge*C[Xe+7],ce[1]=te*C[Xe+1]-ge*C[Xe+3]-L*C[Xe+5]-Z*C[Xe+7],ce[2]=Z*C[Xe+1]-L*C[Xe+3]+ge*C[Xe+5]+te*C[Xe+7],ce[3]=ge*C[Xe+1]-Z*C[Xe+3]+te*C[Xe+5]-L*C[Xe+7],pe[0]=T*(C[Xe+0]+C[Xe+4]),pe[3]=T*(C[Xe+0]-C[Xe+4]),pe[1]=Ae[0]+Ae[3],pe[2]=Ae[1]-Ae[2],Me[0]=pe[0]+pe[1],Me[1]=pe[3]+pe[2],Me[2]=pe[3]-pe[2],Me[3]=pe[0]-pe[1],C[Xe+0]=Me[0]+ce[0],C[Xe+1]=Me[1]+ce[1],C[Xe+2]=Me[2]+ce[2],C[Xe+3]=Me[3]+ce[3],C[Xe+4]=Me[3]-ce[3],C[Xe+5]=Me[2]-ce[2],C[Xe+6]=Me[1]-ce[1],C[Xe+7]=Me[0]-ce[0]}for(let Te=0;Te<8;++Te)Ae[0]=W*C[16+Te],Ae[1]=de*C[16+Te],Ae[2]=W*C[48+Te],Ae[3]=de*C[48+Te],ce[0]=L*C[8+Te]+te*C[24+Te]+Z*C[40+Te]+ge*C[56+Te],ce[1]=te*C[8+Te]-ge*C[24+Te]-L*C[40+Te]-Z*C[56+Te],ce[2]=Z*C[8+Te]-L*C[24+Te]+ge*C[40+Te]+te*C[56+Te],ce[3]=ge*C[8+Te]-Z*C[24+Te]+te*C[40+Te]-L*C[56+Te],pe[0]=T*(C[Te]+C[32+Te]),pe[3]=T*(C[Te]-C[32+Te]),pe[1]=Ae[0]+Ae[3],pe[2]=Ae[1]-Ae[2],Me[0]=pe[0]+pe[1],Me[1]=pe[3]+pe[2],Me[2]=pe[3]-pe[2],Me[3]=pe[0]-pe[1],C[0+Te]=Me[0]+ce[0],C[8+Te]=Me[1]+ce[1],C[16+Te]=Me[2]+ce[2],C[24+Te]=Me[3]+ce[3],C[32+Te]=Me[3]-ce[3],C[40+Te]=Me[2]-ce[2],C[48+Te]=Me[1]-ce[1],C[56+Te]=Me[0]-ce[0]}function Xr(C){for(let T=0;T<64;++T){const L=C[0][T],W=C[1][T],te=C[2][T];C[0][T]=L+1.5747*te,C[1][T]=L-.1873*W-.4682*te,C[2][T]=L+1.8556*W}}function vr(C,T,L){for(let W=0;W<64;++W)T[L+W]=Md.toHalfFloat(kn(C[W]))}function kn(C){return C<=1?Math.sign(C)*Math.pow(Math.abs(C),2.2):Math.sign(C)*Math.pow(B,Math.abs(C)-1)}function $s(C){return new DataView(C.array.buffer,C.offset.value,C.size)}function yr(C){const T=C.viewer.buffer.slice(C.offset.value,C.offset.value+C.size),L=new Uint8Array(Ar(T)),W=new Uint8Array(L.length);return Vr(L),ss(L,W),new DataView(W.buffer)}function rs(C){const T=C.array.slice(C.offset.value,C.offset.value+C.size),L=qp(T),W=new Uint8Array(L.length);return Vr(L),ss(L,W),new DataView(W.buffer)}function Ps(C){const T=C.viewer,L={value:C.offset.value},W=new Uint16Array(C.width*C.scanlineBlockSize*(C.channels*C.type)),te=new Uint8Array(8192);let Z=0;const de=new Array(C.channels);for(let it=0;it<C.channels;it++)de[it]={},de[it].start=Z,de[it].end=de[it].start,de[it].nx=C.width,de[it].ny=C.lines,de[it].size=C.type,Z+=de[it].nx*de[it].ny*de[it].size;const ge=tt(T,L),Ae=tt(T,L);if(Ae>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(ge<=Ae)for(let it=0;it<Ae-ge+1;it++)te[it+ge]=pl(T,L);const ce=new Uint16Array(65536),pe=R(te,ce),Me=zt(T,L);Ei(C.array,T,L,Me,W,Z);for(let it=0;it<C.channels;++it){const Oe=de[it];for(let ze=0;ze<de[it].size;++ze)Tt(W,Oe.start+ze,Oe.nx,Oe.size,Oe.ny,Oe.nx*Oe.size,pe)}Bs(ce,W,Z);let Te=0;const Xe=new Uint8Array(W.buffer.byteLength);for(let it=0;it<C.lines;it++)for(let Oe=0;Oe<C.channels;Oe++){const ze=de[Oe],ot=ze.nx*ze.size,Ii=new Uint8Array(W.buffer,ze.end*2,ot*2);Xe.set(Ii,Te),Te+=ot*2,ze.end+=ot}return new DataView(Xe.buffer)}function Ms(C){const T=C.array.slice(C.offset.value,C.offset.value+C.size),L=qp(T),W=C.lines*C.channels*C.width,te=C.type==1?new Uint16Array(W):new Uint32Array(W);let Z=0,de=0;const ge=new Array(4);for(let Ae=0;Ae<C.lines;Ae++)for(let ce=0;ce<C.channels;ce++){let pe=0;switch(C.type){case 1:ge[0]=Z,ge[1]=ge[0]+C.width,Z=ge[1]+C.width;for(let Me=0;Me<C.width;++Me){const Te=L[ge[0]++]<<8|L[ge[1]++];pe+=Te,te[de]=pe,de++}break;case 2:ge[0]=Z,ge[1]=ge[0]+C.width,ge[2]=ge[1]+C.width,Z=ge[2]+C.width;for(let Me=0;Me<C.width;++Me){const Te=L[ge[0]++]<<24|L[ge[1]++]<<16|L[ge[2]++]<<8;pe+=Te,te[de]=pe,de++}break}}return new DataView(te.buffer)}function Dn(C){const T=C.viewer,L={value:C.offset.value},W=new Uint8Array(C.width*C.lines*(C.channels*C.type*2)),te={version:Zi(T,L),unknownUncompressedSize:Zi(T,L),unknownCompressedSize:Zi(T,L),acCompressedSize:Zi(T,L),dcCompressedSize:Zi(T,L),rleCompressedSize:Zi(T,L),rleUncompressedSize:Zi(T,L),rleRawSize:Zi(T,L),totalAcUncompressedCount:Zi(T,L),totalDcUncompressedCount:Zi(T,L),acCompression:Zi(T,L)};if(te.version<2)throw new Error("EXRLoader.parse: "+op.compression+" version "+te.version+" is unsupported");const Z=new Array;let de=tt(T,L)-2;for(;de>0;){const Oe=Ji(T.buffer,L),ze=pl(T,L),ot=ze>>2&3,Ii=(ze>>4)-1,Mi=new Int8Array([Ii])[0],_r=pl(T,L);Z.push({name:Oe,index:Mi,type:_r,compression:ot}),de-=Oe.length+3}const ge=op.channels,Ae=new Array(C.channels);for(let Oe=0;Oe<C.channels;++Oe){const ze=Ae[Oe]={},ot=ge[Oe];ze.name=ot.name,ze.compression=0,ze.decoded=!1,ze.type=ot.pixelType,ze.pLinear=ot.pLinear,ze.width=C.width,ze.height=C.lines}const ce={idx:new Array(3)};for(let Oe=0;Oe<C.channels;++Oe){const ze=Ae[Oe];for(let ot=0;ot<Z.length;++ot){const Ii=Z[ot];ze.name==Ii.name&&(ze.compression=Ii.compression,Ii.index>=0&&(ce.idx[Ii.index]=Oe),ze.offset=Oe)}}let pe,Me,Te;if(te.acCompressedSize>0)switch(te.acCompression){case 0:pe=new Uint16Array(te.totalAcUncompressedCount),Ei(C.array,T,L,te.acCompressedSize,pe,te.totalAcUncompressedCount);break;case 1:const Oe=C.array.slice(L.value,L.value+te.totalAcUncompressedCount),ze=qp(Oe);pe=new Uint16Array(ze.buffer),L.value+=te.totalAcUncompressedCount;break}if(te.dcCompressedSize>0){const Oe={array:C.array,offset:L,size:te.dcCompressedSize};Me=new Uint16Array(rs(Oe).buffer),L.value+=te.dcCompressedSize}if(te.rleRawSize>0){const Oe=C.array.slice(L.value,L.value+te.rleCompressedSize),ze=qp(Oe);Te=Ar(ze.buffer),L.value+=te.rleCompressedSize}let Xe=0;const it=new Array(Ae.length);for(let Oe=0;Oe<it.length;++Oe)it[Oe]=new Array;for(let Oe=0;Oe<C.lines;++Oe)for(let ze=0;ze<Ae.length;++ze)it[ze].push(Xe),Xe+=Ae[ze].width*C.type*2;Wr(ce,it,Ae,pe,Me,W);for(let Oe=0;Oe<Ae.length;++Oe){const ze=Ae[Oe];if(!ze.decoded)switch(ze.compression){case 2:let ot=0,Ii=0;for(let Mi=0;Mi<C.lines;++Mi){let _r=it[Oe][ot];for(let ei=0;ei<ze.width;++ei){for(let wt=0;wt<2*ze.type;++wt)W[_r++]=Te[Ii+wt*ze.width*ze.height];Ii++}ot++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(W.buffer)}function Ji(C,T){const L=new Uint8Array(C);let W=0;for(;L[T.value+W]!=0;)W+=1;const te=new TextDecoder().decode(L.slice(T.value,T.value+W));return T.value=T.value+W+1,te}function os(C,T,L){const W=new TextDecoder().decode(new Uint8Array(C).slice(T.value,T.value+L));return T.value=T.value+L,W}function er(C,T){const L=dn(C,T),W=zt(C,T);return[L,W]}function as(C,T){const L=zt(C,T),W=zt(C,T);return[L,W]}function dn(C,T){const L=C.getInt32(T.value,!0);return T.value=T.value+4,L}function zt(C,T){const L=C.getUint32(T.value,!0);return T.value=T.value+4,L}function yt(C,T){const L=C[T.value];return T.value=T.value+1,L}function pl(C,T){const L=C.getUint8(T.value);return T.value=T.value+1,L}const Zi=function(C,T){let L;return"getBigInt64"in DataView.prototype?L=Number(C.getBigInt64(T.value,!0)):L=C.getUint32(T.value+4,!0)+Number(C.getUint32(T.value,!0)<<32),T.value+=8,L};function On(C,T){const L=C.getFloat32(T.value,!0);return T.value+=4,L}function N(C,T){return Md.toHalfFloat(On(C,T))}function K(C){const T=(C&31744)>>10,L=C&1023;return(C>>15?-1:1)*(T?T===31?L?NaN:1/0:Math.pow(2,T-15)*(1+L/1024):6103515625e-14*(L/1024))}function tt(C,T){const L=C.getUint16(T.value,!0);return T.value+=2,L}function Qt(C,T){return K(tt(C,T))}function ks(C,T,L,W){const te=L.value,Z=[];for(;L.value<te+W-1;){const de=Ji(T,L),ge=dn(C,L),Ae=pl(C,L);L.value+=3;const ce=dn(C,L),pe=dn(C,L);Z.push({name:de,pixelType:ge,pLinear:Ae,xSampling:ce,ySampling:pe})}return L.value+=1,Z}function br(C,T){const L=On(C,T),W=On(C,T),te=On(C,T),Z=On(C,T),de=On(C,T),ge=On(C,T),Ae=On(C,T),ce=On(C,T);return{redX:L,redY:W,greenX:te,greenY:Z,blueX:de,blueY:ge,whiteX:Ae,whiteY:ce}}function tr(C,T){const L=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],W=pl(C,T);return L[W]}function p1(C,T){const L=zt(C,T),W=zt(C,T),te=zt(C,T),Z=zt(C,T);return{xMin:L,yMin:W,xMax:te,yMax:Z}}function Bb(C,T){const L=["INCREASING_Y"],W=pl(C,T);return L[W]}function sd(C,T){const L=On(C,T),W=On(C,T);return[L,W]}function Bo(C,T){const L=On(C,T),W=On(C,T),te=On(C,T);return[L,W,te]}function Po(C,T,L,W,te){if(W==="string"||W==="stringvector"||W==="iccProfile")return os(T,L,te);if(W==="chlist")return ks(C,T,L,te);if(W==="chromaticities")return br(C,L);if(W==="compression")return tr(C,L);if(W==="box2i")return p1(C,L);if(W==="lineOrder")return Bb(C,L);if(W==="float")return On(C,L);if(W==="v2f")return sd(C,L);if(W==="v3f")return Bo(C,L);if(W==="int")return dn(C,L);if(W==="rational")return er(C,L);if(W==="timecode")return as(C,L);if(W==="preview")return L.value+=te,"skipped";L.value+=te}function Ph(C,T,L){const W={};if(C.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");W.version=C.getUint8(4);const te=C.getUint8(5);W.spec={singleTile:!!(te&2),longName:!!(te&4),deepFormat:!!(te&8),multiPart:!!(te&16)},L.value=8;let Z=!0;for(;Z;){const de=Ji(T,L);if(de==0)Z=!1;else{const ge=Ji(T,L),Ae=zt(C,L),ce=Po(C,T,L,ge,Ae);ce===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${ge}'.`):W[de]=ce}}if(te&-5)throw console.error("THREE.EXRHeader:",W),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return W}function Mo(C,T,L,W,te){const Z={size:0,viewer:T,array:L,offset:W,width:C.dataWindow.xMax-C.dataWindow.xMin+1,height:C.dataWindow.yMax-C.dataWindow.yMin+1,channels:C.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:C.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:Ni};switch(C.compression){case"NO_COMPRESSION":Z.lines=1,Z.uncompress=$s;break;case"RLE_COMPRESSION":Z.lines=1,Z.uncompress=yr;break;case"ZIPS_COMPRESSION":Z.lines=1,Z.uncompress=rs;break;case"ZIP_COMPRESSION":Z.lines=16,Z.uncompress=rs;break;case"PIZ_COMPRESSION":Z.lines=32,Z.uncompress=Ps;break;case"PXR24_COMPRESSION":Z.lines=16,Z.uncompress=Ms;break;case"DWAA_COMPRESSION":Z.lines=32,Z.uncompress=Dn;break;case"DWAB_COMPRESSION":Z.lines=256,Z.uncompress=Dn;break;default:throw new Error("EXRLoader.parse: "+C.compression+" is unsupported")}if(Z.scanlineBlockSize=Z.lines,Z.type==1)switch(te){case mo:Z.getter=Qt,Z.inputSize=2;break;case Zn:Z.getter=tt,Z.inputSize=2;break}else if(Z.type==2)switch(te){case mo:Z.getter=On,Z.inputSize=4;break;case Zn:Z.getter=N,Z.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+Z.type+" for "+C.compression+".");Z.blockCount=(C.dataWindow.yMax+1)/Z.scanlineBlockSize;for(let ge=0;ge<Z.blockCount;ge++)Zi(T,W);Z.outputChannels=Z.channels==3?4:Z.channels;const de=Z.width*Z.height*Z.outputChannels;switch(te){case mo:Z.byteArray=new Float32Array(de),Z.channels<Z.outputChannels&&Z.byteArray.fill(1,0,de);break;case Zn:Z.byteArray=new Uint16Array(de),Z.channels<Z.outputChannels&&Z.byteArray.fill(15360,0,de);break;default:console.error("THREE.EXRLoader: unsupported type: ",te);break}return Z.bytesPerLine=Z.width*Z.inputSize*Z.channels,Z.outputChannels==4?(Z.format=Wi,Z.colorSpace=Ni):(Z.format=qc,Z.colorSpace=xu),Z}const la=new DataView(t),rd=new Uint8Array(t),wc={value:0},op=Ph(la,t,wc),gt=Mo(op,la,rd,wc,this.type),g1={value:0},jL={R:0,G:1,B:2,A:3,Y:0};for(let C=0;C<gt.height/gt.scanlineBlockSize;C++){const T=zt(la,wc);gt.size=zt(la,wc),gt.lines=T+gt.scanlineBlockSize>gt.height?gt.height-T:gt.scanlineBlockSize;const W=gt.size<gt.lines*gt.bytesPerLine?gt.uncompress(gt):$s(gt);wc.value+=gt.size;for(let te=0;te<gt.scanlineBlockSize;te++){const Z=te+C*gt.scanlineBlockSize;if(Z>=gt.height)break;for(let de=0;de<gt.channels;de++){const ge=jL[op.channels[de].name];for(let Ae=0;Ae<gt.width;Ae++){g1.value=(te*(gt.channels*gt.width)+de*gt.width+Ae)*gt.inputSize;const ce=(gt.height-1-Z)*(gt.width*gt.outputChannels)+Ae*gt.outputChannels+ge;gt.byteArray[ce]=gt.getter(W,g1)}}}}return{header:op,width:gt.width,height:gt.height,data:gt.byteArray,format:gt.format,colorSpace:gt.colorSpace,type:this.type}}setDataType(t){return this.type=t,this}load(t,e,i,s){function r(o,a){o.colorSpace=a.colorSpace,o.minFilter=Mt,o.magFilter=Mt,o.generateMipmaps=!1,o.flipY=!1,e&&e(o,a)}return super.load(t,r,i,s)}}const fH=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:om},Symbol.toStringTag,{value:"Module"}));class py extends FP{constructor(t){super(t),this.type=Zn}parse(t){const o=function(I,B){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(B||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(B||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(B||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(B||""))}},u=`
`,d=function(I,B,R){B=B||1024;let F=I.pos,j=-1,V=0,X="",k=String.fromCharCode.apply(null,new Uint16Array(I.subarray(F,F+128)));for(;0>(j=k.indexOf(u))&&V<B&&F<I.byteLength;)X+=k,V+=k.length,F+=128,k+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(F,F+128)));return-1<j?(R!==!1&&(I.pos+=V+j+1),X+k.slice(0,j)):!1},f=function(I){const B=/^#\?(\S+)/,R=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,P=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,F=/^\s*FORMAT=(\S+)\s*$/,j=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,V={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let X,k;for((I.pos>=I.byteLength||!(X=d(I)))&&o(1,"no header found"),(k=X.match(B))||o(3,"bad initial token"),V.valid|=1,V.programtype=k[1],V.string+=X+`
`;X=d(I),X!==!1;){if(V.string+=X+`
`,X.charAt(0)==="#"){V.comments+=X+`
`;continue}if((k=X.match(R))&&(V.gamma=parseFloat(k[1])),(k=X.match(P))&&(V.exposure=parseFloat(k[1])),(k=X.match(F))&&(V.valid|=2,V.format=k[1]),(k=X.match(j))&&(V.valid|=4,V.height=parseInt(k[1],10),V.width=parseInt(k[2],10)),V.valid&2&&V.valid&4)break}return V.valid&2||o(3,"missing format specifier"),V.valid&4||o(3,"missing image size specifier"),V},p=function(I,B,R){const P=B;if(P<8||P>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);P!==(I[2]<<8|I[3])&&o(3,"wrong scanline width");const F=new Uint8Array(4*B*R);F.length||o(4,"unable to allocate buffer space");let j=0,V=0;const X=4*P,k=new Uint8Array(4),O=new Uint8Array(X);let H=R;for(;H>0&&V<I.byteLength;){V+4>I.byteLength&&o(1),k[0]=I[V++],k[1]=I[V++],k[2]=I[V++],k[3]=I[V++],(k[0]!=2||k[1]!=2||(k[2]<<8|k[3])!=P)&&o(3,"bad rgbe scanline format");let ee=0,Y;for(;ee<X&&V<I.byteLength;){Y=I[V++];const ue=Y>128;if(ue&&(Y-=128),(Y===0||ee+Y>X)&&o(3,"bad scanline data"),ue){const _e=I[V++];for(let Se=0;Se<Y;Se++)O[ee++]=_e}else O.set(I.subarray(V,V+Y),ee),ee+=Y,V+=Y}const he=P;for(let ue=0;ue<he;ue++){let _e=0;F[j]=O[ue+_e],_e+=P,F[j+1]=O[ue+_e],_e+=P,F[j+2]=O[ue+_e],_e+=P,F[j+3]=O[ue+_e],j+=4}H--}return F},g=function(I,B,R,P){const F=I[B+3],j=Math.pow(2,F-128)/255;R[P+0]=I[B+0]*j,R[P+1]=I[B+1]*j,R[P+2]=I[B+2]*j,R[P+3]=1},m=function(I,B,R,P){const F=I[B+3],j=Math.pow(2,F-128)/255;R[P+0]=Md.toHalfFloat(Math.min(I[B+0]*j,65504)),R[P+1]=Md.toHalfFloat(Math.min(I[B+1]*j,65504)),R[P+2]=Md.toHalfFloat(Math.min(I[B+2]*j,65504)),R[P+3]=Md.toHalfFloat(1)},v=new Uint8Array(t);v.pos=0;const y=f(v),b=y.width,_=y.height,x=p(v.subarray(v.pos),b,_);let S,E,M;switch(this.type){case mo:M=x.length/4;const I=new Float32Array(M*4);for(let R=0;R<M;R++)g(x,R*4,I,R*4);S=I,E=mo;break;case Zn:M=x.length/4;const B=new Uint16Array(M*4);for(let R=0;R<M;R++)m(x,R*4,B,R*4);S=B,E=Zn;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:b,height:_,data:S,header:y.string,gamma:y.gamma,exposure:y.exposure,type:E}}setDataType(t){return this.type=t,this}load(t,e,i,s){function r(o,a){switch(o.type){case mo:case Zn:o.colorSpace=Ni,o.minFilter=Mt,o.magFilter=Mt,o.generateMipmaps=!1,o.flipY=!0;break}e&&e(o,a)}return super.load(t,r,i,s)}}const pH=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:py},Symbol.toStringTag,{value:"Module"})),LT="NEEDLE_lightmaps",_p=z("debuglightmapsextension")||z("debuglightmaps");var Gl;(function(n){n[n.Lightmap=0]="Lightmap",n[n.Skybox=1]="Skybox",n[n.Reflection=2]="Reflection"})(Gl||(Gl={}));class gH{constructor(t,e,i){c(this,"parser");c(this,"registry");c(this,"source");this.parser=t,this.registry=e,this.source=i}get name(){return LT}afterRoot(t){const e=this.parser.json.extensions;if(e){const i=e[LT];if(i){const s=i.textures;return s!=null&&s.length?(_p&&console.log(i),new Promise(async(r,o)=>{const a=[];for(const h of s)if(h.pointer){_p&&console.log(h);let u=null;if(h.pointer.startsWith("/textures/"))_p&&console.log("Load texture from gltf",h.pointer),u=LS(this.parser,h.pointer).then(d=>this.resolveTexture(h,d));else if(typeof h.pointer=="string"){_p&&console.log("Load texture from path",h.pointer);const d=Du(this.source,h.pointer);let f;d.endsWith(".exr")?f=new om(this.parser.options.manager):d.endsWith(".hdr")?f=new py(this.parser.options.manager):f=new Xa(this.parser.options.manager),u=f.loadAsync(d,void 0).then(p=>this.resolveTexture(h,p))}else h.pointer;u&&a.push(u)}const l=await QC(a);l!=null&&l.anyFailed&&ve()&&console.error("Failed to load lightmap extension",l),r()})):null}}return null}resolveTexture(t,e){const i=e;_p&&console.log("Lightmap loaded:",i),i!=null&&i.isTexture&&(this.registry?(i.colorSpace=Ni,this.registry.registerTexture(this.source,t.type,i,t.index)):console.log(Gl[t.type],t.pointer,i))}}const FT=!!z("debuglightmaps");class mH{constructor(t){c(this,"_context");c(this,"_lightmaps",new Map);this._context=t}clear(){this._lightmaps.clear()}registerTexture(t,e,i,s){FT&&console.log("Registering ",Gl[e]+' "'+t+'"',i),this._lightmaps.has(t)||this._lightmaps.set(t,new Map);const r=this._lightmaps.get(t),o=(r==null?void 0:r.get(e))??[];o.length<s&&(o.length=s+1),o[s]=i,r==null||r.set(e,o)}tryGetLightmap(t,e=0){return this.tryGet(t,Gl.Lightmap,e)}tryGetSkybox(t){return this.tryGet(t,Gl.Skybox,0)}tryGetReflection(t){return this.tryGet(t,Gl.Reflection,0)}tryGet(t,e,i){if(!t)return FT&&console.warn("Missing source id"),null;const s=this._lightmaps.get(t);if(!s)return null;const r=s.get(e);return r===void 0||!(r!=null&&r.length)||r.length<=i?null:r[i]}}Hs.lights_fragment_maps=Hs.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);Hs.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;Hs.lights_fragment_begin=Hs.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);Hn.lightmap.lightmapScaleOffset={value:new Fe(1,1,0,0)};const P_=z("debugprogressive"),PA=new xn,MA=new uc;class AH{constructor(t){c(this,"context");c(this,"_lodsManager");this.context=t}get manager(){return this._lodsManager}get targetTriangleDensity(){var t;return((t=this._lodsManager)==null?void 0:t.targetTriangleDensity)??-1}set targetTriangleDensity(t){this._lodsManager&&(this._lodsManager.targetTriangleDensity=t)}setRenderer(t){var e;(e=this._lodsManager)==null||e.disable(),Yh.removePlugin(this),Yh.addPlugin(this),Yh.debugDrawLine=Be.DrawLine,this._lodsManager=Yh.get(t),this._lodsManager.enable()}onAfterUpdatedLOD(t,e,i,s,r){P_&&this.onRenderDebug(i,s,r)}onRenderDebug(t,e,i){var a,l,h;if(!e.geometry||!ht.hasLODLevelAvailable(e.geometry)&&!ht.hasLODLevelAvailable(e.material))return;const s=Yh.getObjectLODState(e);if(!s)return;let r=i.mesh_lod;const o=i.mesh_lod!=s.lastLodLevel_Mesh||i.texture_lod!=s.lastLodLevel_Texture;if(P_&&e.geometry.boundingSphere){const u=e.geometry.boundingSphere;MA.copy(u),MA.applyMatrix4(e.matrixWorld);const d=MA.center,f=MA.radius,p=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(o)Be.DrawWireSphere(d,f,p[r],.1);else{const g=((a=e.geometry.index)==null?void 0:a.count)??0,m=(l=ht.getMeshLODInformation(e.geometry))==null?void 0:l.lods;r=m?Math.min((m==null?void 0:m.length)-1,r):0;let v="";if(m&&s.lastScreenCoverage>0)for(let _=0;_<m.length;_++){const x=m[_].density,S=_==m.length-1;v+=x.toFixed(0)+">"+(x/s.lastScreenCoverage).toFixed(0)+(S?"":",")}const y=m?(h=m[r])==null?void 0:h.density:-1;let b="LOD "+i.mesh_lod+`
TEX `+i.texture_lod;if(P_=="density"&&(b+=`
`+g+` tris
`+(y/s.lastScreenCoverage).toFixed(0)+` dens
`+(s.lastScreenCoverage*100).toFixed(1)+`% cov
`+(s.lastCentrality*100).toFixed(1)+`% centr
`+(PA.min.x.toFixed(2)+"-"+PA.max.x.toFixed(2)+"x"+PA.min.y.toFixed(2)+"-"+PA.max.y.toFixed(2))+" scr"),s.lastScreenCoverage>.1){const _=t,x=_.worldForward,S=_.worldPosition,M=Re(x).multiplyScalar(f*.7).add(d),I=M.distanceTo(S),B=p[Math.min(p.length-1,Math.max(0,r))]+"88",R=this.context.domHeight>0?screen.height/this.context.domHeight:1,P=t.isPerspectiveCamera?Math.tan(t.fov*Math.PI/180/2):1;Be.DrawLabel(M,b,I*.012*R*P,void 0,16777215,B)}}}}}const vH=z("debugplayerview");var Yl;(function(n){n.Browser="browser",n.Headset="headset",n.Handheld="handheld"})(Yl||(Yl={}));class yH{constructor(t,e){c(this,"userId");c(this,"context");c(this,"viewDevice",Yl.Browser);c(this,"removed",!1);c(this,"_object");this.userId=t,this.context=e}get currentObject(){return this._object}set currentObject(t){this._object=t}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class bH{constructor(t){c(this,"context");c(this,"playerViews",new Map);this.context=t}setPlayerView(t,e,i){let s=this.playerViews.get(t);s||(s=new yH(t,this.context),this.playerViews.set(t,s)),s.viewDevice=i,s.currentObject=e,s.removed=!1}getPlayerView(t){if(!t)return;if(!this.context.connection.userIsInRoom(t)){this.playerViews.delete(t);return}return this.playerViews.get(t)}removePlayerView(t,e){const i=this.playerViews.get(t);(i==null?void 0:i.viewDevice)===e&&(vH&&console.log("REMOVE",t),i.removed=!0,this.playerViews.delete(t))}}new Or;const Mm=new Uint8Array(4);Mm[0]=255;Mm[1]=255;Mm[2]=255;Mm[3]=255;const _H=new Uf(Mm,1,1,Wi);function WS(n,t=1){const e="alpha"in n,i=t*t,s=new Uint8Array(4*i),r=Math.floor(n.r*255),o=Math.floor(n.g*255),a=Math.floor(n.b*255);for(let h=0;h<i;h++){const u=h*4;s[u+0]=r,s[u+1]=o,s[u+2]=a,e?s[u+3]=Math.floor(n.alpha*255):s[u+3]=255}const l=new Uf(s,t,t);return l.needsUpdate=!0,l}function wH(n,t,e,i=1,s=3){const o=i*s,a=[n,t,e],l=a.length,h=new Uint8Array(4*l*o),u=new be;for(let f=0;f<s;f++){const p=Math.floor(f/s*l),g=ye.clamp(p+1,0,l-1),m=a[p],v=a[g],y=f/s*l%1;u.lerpColors(m,v,y);const b=Math.floor(u.r*255),_=Math.floor(u.g*255),x=Math.floor(u.b*255);for(let S=0;S<i;S++){const E=(f*i+S)*4;h[E+0]=b,h[E+1]=_,h[E+2]=x,h[E+3]=255}}const d=new Uf(h,i,s);return d.needsUpdate=!0,d}var UT;(function(n){n[n.Vertex=0]="Vertex",n[n.Fragment=1]="Fragment"})(UT||(UT={}));function gy(n,t){const e=n.elements;t||(t=[]),t.length=0;for(let i=0;i<16;i+=4){const s=e[i],r=e[i+1],o=e[i+2],a=e[i+3],l=new Fe(s,r,o,a);t.push(l)}return t}const M_=[],NT=[];function xH(n,t){if(M_.length===0)for(let e=0;e<27;e++)M_.push(0);t||(t=M_);for(let e=0;e<27;e++)NT[e]=t[e];t=NT,n.unity_SHAr={value:new Fe(t[9],t[3],t[6],t[0])},n.unity_SHBr={value:new Fe(t[12],t[15],t[18],t[21])},n.unity_SHAg={value:new Fe(t[10],t[4],t[7],t[1])},n.unity_SHBg={value:new Fe(t[13],t[16],t[19],t[22])},n.unity_SHAb={value:new Fe(t[11],t[5],t[8],t[2])},n.unity_SHBb={value:new Fe(t[14],t[17],t[20],t[23])},n.unity_SHC={value:new Fe(t[24],t[25],t[26],1)}}class CH{constructor(t,e,i){c(this,"vertexShader");c(this,"fragmentShader");c(this,"technique");this.vertexShader=t,this.fragmentShader=e,this.technique=i}}async function SH(n,t){if(!n)return console.error("Can not find technique: no shader data"),null;const e=n.programs[t],i=e.vertexShader,s=e.fragmentShader;if(i!==void 0&&s!==void 0){const r=n.shaders[i],o=n.shaders[s];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await zT(r),!o.code&&o.uri&&await zT(o),!r.code||!o.code)return null;const a=n.techniques[t];return new CH(r.code,o.code,a)}}return console.error("Shader technique not found",t),null}async function zT(n){const t=n.uri;if(t)if(t.endsWith(".glsl")){const i=await new Or().loadAsync(t);n.code=i.toString()}else n.code=EH(n.uri)}function EH(n){return decodeURIComponent(Array.prototype.map.call(atob(n),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const Fo=z("debugenvlight");var La;(function(n){n[n.Skybox=0]="Skybox",n[n.Trilight=1]="Trilight",n[n.Flat=3]="Flat",n[n.Custom=4]="Custom"})(La||(La={}));var am;(function(n){n[n.Skybox=0]="Skybox",n[n.Custom=1]="Custom"})(am||(am={}));class IH{constructor(t){c(this,"context");c(this,"_currentLightSettingsId");c(this,"_sceneLightSettings");c(this,"_timevec4",new Fe);c(this,"__currentReflectionId",null);c(this,"_lighting",{});this.context=t,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const t=this.context.time;this._timevec4.x=t.time,this._timevec4.y=Math.sin(t.time),this._timevec4.z=Math.cos(t.time),this._timevec4.w=t.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const t=this._sceneLightSettings.get(this._currentLightSettingsId);return t?t.ambientIntensity:1}get sceneLightSettings(){var t;return(t=this._sceneLightSettings)==null?void 0:t.values()}enable(t){var i;t instanceof et&&(t=t.uri);const e=(i=this._sceneLightSettings)==null?void 0:i.get(t);return e?(Fo&&console.log("Enable scene light settings",t,e),t!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=t,e.enabled=!0,!0):(Fo&&console.warn("No light settings found for",t),!1)}disable(t){var i;if(t instanceof et&&(t=t.uri),t==null)return!1;const e=(i=this._sceneLightSettings)==null?void 0:i.get(t);return e?(Fo&&console.log("Disable scene light settings",t,e),e.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const t=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),t}return null}internalRegisterSceneLightSettings(t){const e=t.sourceId;if(!e){console.error("Missing source id for scene light settings, can not register:",t);return}Fo&&console.log("Register "+(t==null?void 0:t.sourceId)+" lighting",t),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(e,t)}internalUnregisterSceneLightSettings(t){const e=t.sourceId;if(!e){console.error("Missing source id for scene light settings, can not unregister:",t);return}Fo&&console.log("Unregister "+(t==null?void 0:t.sourceId)+" lighting",t),this._sceneLightSettings&&this._sceneLightSettings.delete(e)}internalRegisterReflection(t,e){Fo&&console.log("Register reflection",t,e);const i=new TH(this.context,e,1);this._lighting[t]=i}internalGetReflection(t){return this._lighting[t]}internalEnableReflection(t){var i;this.__currentReflectionId=t;const e=(i=this._sceneLightSettings)==null?void 0:i.get(t);switch(Fo&&console.log("Enable reflection",t,e?La[e.ambientMode]:"Unknown ambient mode",e),e==null?void 0:e.ambientMode){case La.Skybox:case La.Custom:const s=this.internalGetReflection(t);if(s&&s.Source){Fo&&console.log("Setting environment reflection",s);const r=this.context.scene,o=s.Source;o.mapping=Ya,r.environment=o;return}else Fo&&console.warn("Could not find reflection for source",t);break}if((e==null?void 0:e.environmentReflectionSource)===am.Custom)switch(e==null?void 0:e.ambientMode){case La.Trilight:if(e.ambientTrilight){const s=e.ambientTrilight,r=wH(s[0],s[1],s[2],64,64);r.colorSpace=Ge,r.mapping=Ya,this.context.scene.environment=r}else console.error("Missing ambient trilight",e.sourceId);return;case La.Flat:if(e.ambientLight){const s=WS(e.ambientLight,64);s.colorSpace=Ge,s.mapping=Ya,this.context.scene.environment=s}else console.error("Missing ambientlight",e.sourceId);return;default:return}}internalDisableReflection(t){if(t&&t!==this.__currentReflectionId){Fo&&console.log("Not disabling reflection for",t,"because it is not the current light settings id",this.__currentReflectionId);return}Fo&&console.log("Disable reflection",t);const e=this.context.scene;e.environment=null}}class TH{constructor(t,e,i=1){c(this,"_source");this._source=e,e.mapping=Ya}get Source(){return this._source}}const QT=z("timescale");let Ux=1;typeof QT=="number"&&(Ux=QT);class RH{constructor(){c(this,"_time",0);c(this,"_deltaTime",0);c(this,"_deltaTimeUnscaled",0);c(this,"timeScale",1);c(this,"_frame",0);c(this,"clock",new kP);c(this,"_smoothedFps",0);c(this,"_smoothedDeltaTime",0);c(this,"_fpsSamples",[]);c(this,"_fpsSampleIndex",0);typeof Ux=="number"&&(this.timeScale=Ux)}get time(){return this._time}set time(t){this._time=t}get deltaTime(){return this._deltaTime}set deltaTime(t){this._deltaTime=t}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(t){this._frame=t}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let t=0;for(let e=0;e<this._fpsSamples.length;e++)t+=this._fpsSamples[e];this._smoothedDeltaTime=t/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}let jT=!1;function CO(n){jT||(jT=!0,BH(),PH())}CO();function BH(){const n=`
float startCompression = 0.8;
float desaturation = 0.5;
// Patched tonemapping function
vec3 NeutralToneMapping( vec3 color ) {
    color *= toneMappingExposure;
    
    float d = 1. - startCompression;
    // float peak = dot(color, vec3(0.299, 0.587, 0.114));
    float peak = max(color.r, max(color.g, color.b));
    if (peak < startCompression) return color;
    float newPeak = 1. - d * d / (peak + d - startCompression);
    float invPeak = 1. / peak;
    
    float extraBrightness = dot(color * (1. - startCompression * invPeak), vec3(1, 1, 1));
    
    color *= newPeak * invPeak;
    float g = 1. - 3. / (desaturation * extraBrightness + 3.);
    return mix(color, vec3(1, 1, 1), g);
}
`,t="vec3 NeutralToneMapping( vec3 color ) {",e=`return mix(color, vec3(1, 1, 1), g);
}`,i=Hs.tonemapping_pars_fragment.indexOf(t),s=Hs.tonemapping_pars_fragment.indexOf(e,i);if(i>=0&&s>=0){const r=Hs.tonemapping_pars_fragment.substring(i,s+e.length);Hs.tonemapping_pars_fragment=Hs.tonemapping_pars_fragment.replace(r,n)}}function PH(){const n=`
// 0: Default, 1: Golden, 2: Punchy
#define AGX_LOOK 0        

vec3 userSlope = vec3(1.0);
vec3 userOffset = vec3(0.0);
vec3 userPower = vec3(1.0);
float userSaturation = 1.0;

// Mean error^2: 3.6705141e-06
vec3 _agxDefaultContrastApprox(vec3 x) {
    vec3 x2 = x * x;
    vec3 x4 = x2 * x2;
    
    return  + 15.5     * x4 * x2
            - 40.14    * x4 * x
            + 31.96    * x4
            - 6.868    * x2 * x
            + 0.4298   * x2
            + 0.1191   * x
            - 0.00232;
}

vec3 _agx(vec3 val) {
    const mat3 agx_mat = mat3(
        0.842479062253094, 0.0423282422610123, 0.0423756549057051,
        0.0784335999999992,  0.878468636469772,  0.0784336,
        0.0792237451477643, 0.0791661274605434, 0.879142973793104);
    
    const float min_ev = -12.47393f;
    const float max_ev = 4.026069f;

    // val = pow(val, vec3(2.2)); 

    // Input transform (inset)
    val = agx_mat * val;
    
    // Log2 space encoding
    val = clamp(log2(val), min_ev, max_ev);
    val = (val - min_ev) / (max_ev - min_ev);
    
    // Apply sigmoid function approximation
    val = _agxDefaultContrastApprox(val);

    return val;
}

vec3 _agxEotf(vec3 val) {
    const mat3 agx_mat_inv = mat3(
        1.19687900512017, -0.0528968517574562, -0.0529716355144438,
        -0.0980208811401368, 1.15190312990417, -0.0980434501171241,
        -0.0990297440797205, -0.0989611768448433, 1.15107367264116);
        
    // Inverse input transform (outset)
    val = agx_mat_inv * val;
    
    // sRGB IEC 61966-2-1 2.2 Exponent Reference EOTF Display
    // NOTE: We're linearizing the output here. Comment/adjust when
    // *not* using a sRGB render target
    val = pow(val, vec3(2.2)); 

    return val;
}

vec3 _agxLook(vec3 val) {
    const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
    float luma = dot(val, lw);
    
    // Default
    vec3 offset = vec3(0.0);
    vec3 slope = vec3(1.0);
    vec3 power = vec3(1.0);
    float sat = 1.0;
    
    #if AGX_LOOK == 1
    // Golden
    slope = vec3(1.0, 0.9, 0.5);
    power = vec3(0.8);
    sat = 0.8;
    #elif AGX_LOOK == 2
    // Punchy
    slope = vec3(1.0);
    power = vec3(1.35, 1.35, 1.35);
    sat = 1.4;
    #endif        
    
    // Needle
    slope = vec3(1.05);
    power = vec3(1.10, 1.10, 1.10);
    sat = 1.15;

    // User
    // slope = userSlope;
    // offset = userOffset;
    // power = userPower;
    // sat = userSaturation;
    
    // ASC CDL
    val = pow(val * slope + offset, power);
    return luma + sat * (val - luma);
}


vec3 AgXToneMapping( vec3 color ) {
    // apply AGX
    color *= toneMappingExposure;
    color = _agx(color);
    color = _agxLook(color); // Optional
    color = _agxEotf(color);
    return color;
}`,t="vec3 AgXToneMapping( vec3 color ) {",e=`	return color;
}`,i=Hs.tonemapping_pars_fragment.indexOf(t),s=Hs.tonemapping_pars_fragment.indexOf(e,i);if(i>=0&&s>=0){const r=Hs.tonemapping_pars_fragment.substring(i,s+e.length);Hs.tonemapping_pars_fragment=Hs.tonemapping_pars_fragment.replace(r,n)}}function ys(n){const t=document.createElement("span");return t.style.maxWidth="48px",t.style.maxHeight="48px",t.style.overflow="hidden",t.classList.add("material-symbols-outlined","notranslate"),t.setAttribute("translate","no"),t.innerText=n,t}function MH(n){var e;return((e=n.classList)==null?void 0:e.contains("material-symbols-outlined"))||!1}const kA=new Map;async function GT(n){const t="Material Symbols Outlined";if(document.fonts.check(`1em '${t}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),kA.has(n))return kA.get(n);const e=document.createElement("canvas"),i=48;e.width=i,e.height=i;const s=e.getContext("2d");if(s){s.font=`${i}px '${t}'`,s.fillStyle="black",s.fillText(n,0,i);const r=e.toDataURL(),o=new At;return o.name=n+" icon",o.image=new Image,o.image.src=r,o.needsUpdate=!0,kA.set(n,o),o}return kA.set(n,null),null}const Ky=class{constructor(){c(this,"_fullscreenButton");c(this,"_muteButton");c(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new Ky),this._instance}static create(){return new Ky}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(t){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return ve()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const e=document.createElement("button");this._fullscreenButton=e,e.classList.add("fullscreen-button"),e.title="Click to enter fullscreen mode";const i=ys("fullscreen"),s=ys("fullscreen_exit");return e.appendChild(i),e.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in t.domElement&&typeof t.domElement.webkitRequestFullscreen=="function"?t.domElement.webkitRequestFullscreen():"requestFullscreen"in t.domElement&&t.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(i.remove(),e.appendChild(s),e.title="Click to enter fullscreen mode"):(s.remove(),e.appendChild(i),e.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{e.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{e.style.display=""}),e}get muteButton(){return this._muteButton}createMuteButton(t){if(this._muteButton)return this._muteButton;const e=document.createElement("button");this._muteButton=e,e.classList.add("mute-button"),e.title="Click to mute/unmute";const i=ys("volume_off"),s=ys("volume_up");return t.application.muted?e.appendChild(i):e.appendChild(s),e.onclick=()=>{t.application.muted?(i.remove(),e.appendChild(s),t.application.muted=!1):(s.remove(),e.appendChild(i),t.application.muted=!0)},e}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const t=document.createElement("button");this._qrButton=t,t.innerText="QR Code",t.prepend(ys("qr_code")),t.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(t);const e=document.createElement("div");e.style.cssText=`
            position: fixed;
            display: inline-block;
            padding: 1rem;
            background-color: white;
            border-radius: 0.4rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        `;const i=document.createElement("div");i.classList.add("qr-code-container"),e.appendChild(i),t.addEventListener("click",()=>{if(e.parentNode)return r();window.location.href.includes("://localhost")&&qt("To access your website from another device in the same local network you have to use the IP address instead of localhost."),s()});async function s(){await o(),document.body.appendChild(e);const a=i.getBoundingClientRect(),l=t.getBoundingClientRect();e.style.left=l.left+l.width*.5-a.width*.5+"px",l.top<a.height?e.style.top=`calc(${l.bottom}px + ${e.style.padding} * .6)`:e.style.top=`calc(${l.top-a.height}px - ${e.style.padding} * 2.5)`,e.style.opacity="0",e.style.pointerEvents="all",e.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{e.style.opacity="1",window.addEventListener("click",r,{once:!0})}),window.addEventListener("resize",r),window.addEventListener("scroll",r),document.fullscreenElement?document.fullscreenElement.appendChild(e):document.body.appendChild(e)}function r(){e.style.pointerEvents="none",e.style.transition="opacity 0.2s",e.style.opacity="0",setTimeout(()=>{var a;return(a=e.parentNode)==null?void 0:a.removeChild(e)},500),window.removeEventListener("click",r),window.removeEventListener("resize",r),window.removeEventListener("scroll",r)}async function o(){const l=await _U({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(l)}return t.addEventListener("pointerenter",()=>{o()},{once:!0}),t}hideElementDuringXRSession(t){CS(e=>{t["previous-display"]=t.style.display,t.style.display="none"}),Gk(e=>{t["previous-display"]!=null&&(t.style.display=t["previous-display"])})}};let Ha=Ky;c(Ha,"_instance");function my(n,t){const e=(t==null?void 0:t.element)||document.head,i=Array.from(e.querySelectorAll(`link[rel=stylesheet][href*='${n}']`));if(i.length<=0){const s=document.createElement("link");s.href=n,s.rel="stylesheet",e.appendChild(s),i.push(s)}if(t!=null&&t.loadedCallback)for(let s=0;s<i.length;s++)t!=null&&t.loadedCallback&&i[s].addEventListener("load",t.loadedCallback)}function SO(){my("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const Nx="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0",Ay="needle-logo-element";class EO extends HTMLElement{constructor(){super();c(this,"_root");c(this,"wrapper");c(this,"logoElement",document.createElement("img"));c(this,"textElement",document.createElement("span"));this._root=this.attachShadow({mode:"closed"});const e=document.createElement("template");e.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
            margin: 0 0.3rem;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${Vz} />
        </div>
        `,this._root.appendChild(e.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return Ay}static create(){return document.createElement(Ay)}setLogoVisible(e){this.logoElement.style.display=e?"block":"none"}}customElements.get(Ay)||customElements.define(Ay,EO);const k_=z("debugspatialmenu");class kH{constructor(t,e){c(this,"_context");c(this,"needleMenu");c(this,"htmlButtonsMap",new Map);c(this,"enabled",!0);c(this,"userRequestedMenu",!1);c(this,"uiisDirty",!1);c(this,"_showNeedleLogo");c(this,"_wasInXR",!1);c(this,"preRender",()=>{var e;if(!this.enabled){(e=this.menu)==null||e.removeFromParent();return}k_&&Gg()&&this.updateMenu();const t=this._context.xr;if(!(t!=null&&t.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()});c(this,"_menuTarget",new ne);c(this,"positionFilter",new jM(90,.5));c(this,"familyName","Needle Spatial Menu");c(this,"menu");c(this,"_poweredByNeedleElement");var s;this._context=t,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=e;const i=(s=this.needleMenu.shadowRoot)==null?void 0:s.querySelector(".options");i?new MutationObserver(o=>{if(this.enabled&&!(this._context.isInXR==!1&&!k_))for(const a of o)a.type==="childList"&&(a.addedNodes.forEach(l=>{this.createButtonFromHTMLNode(l)}),a.removedNodes.forEach(l=>{const h=l,u=this.htmlButtonsMap.get(h);u&&(this.htmlButtonsMap.delete(h),u.remove(),Wt.update())}))}).observe(i,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(t){var e;this.enabled=t,t||(e=this.menu)==null||e.removeFromParent()}setDisplay(t){return this.enabled?(this.userRequestedMenu=t,!0):!1}onDestroy(){const t=this._context.pre_render_callbacks.indexOf(this.preRender);t>-1&&this._context.pre_render_callbacks.splice(t,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(t){this._showNeedleLogo=t}onEnterXR(){var e;const t=(e=this.needleMenu.shadowRoot)==null?void 0:e.querySelector(".options");t&&t.childNodes.forEach(i=>{this.createButtonFromHTMLNode(i)})}onExitXR(){var t;(t=this.menu)==null||t.removeFromParent()}createButtonFromHTMLNode(t){const e=this.getMenu(),i=this.htmlButtonsMap.get(t);if(i){i.add();return}if(t instanceof HTMLButtonElement){const s=this.createButton(e,t);this.htmlButtonsMap.set(t,s),s.add()}else t instanceof HTMLSlotElement&&t.assignedNodes().forEach(s=>{this.createButtonFromHTMLNode(s)})}updateMenu(){var r,o;performance.mark("NeedleSpatialMenu updateMenu start");const t=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(t);const e=this._context.mainCamera,i=this._context.xr,s=(i==null?void 0:i.rigScale)||1;if(e){const a=e.worldPosition,l=e.worldForward.multiplyScalar(-1),h=l.y>.6,u=l.y>.4,d=(t.visible?u:h)||this.userRequestedMenu,f=!t.visible&&d;t.visible=d||Gg()&&k_,l.multiplyScalar(3*s),a.add(l),(f||!1)&&(t.position.copy(this._menuTarget.position),t.position.y+=.25,this._menuTarget.position.copy(t.position),this.positionFilter.reset(t.position),t.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const g=this._menuTarget.position.distanceTo(a);(f||g>1.5*s)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(a),this._context.scene.add(this._menuTarget),y0(this._menuTarget,this._context.mainCamera,!0,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,t.position,this._context.time.time);const m=5;(r=this.menu)==null||r.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*m),(o=this.menu)==null||o.scale.setScalar(s)}this.uiisDirty&&(performance.mark("SpatialMenu.update.uiisDirty.start"),this.uiisDirty=!1,Wt.update(),performance.mark("SpatialMenu.update.uiisDirty.end"),performance.measure("SpatialMenu.update.uiisDirty","SpatialMenu.update.uiisDirty.start","SpatialMenu.update.uiisDirty.end")),performance.mark("NeedleSpatialMenu updateMenu end"),performance.measure("SpatialMenu.update","NeedleSpatialMenu updateMenu start","NeedleSpatialMenu updateMenu end")}ensureRenderOnTop(t,e=0){t instanceof J&&(t.material.depthTest=!1,t.material.depthWrite=!1),t.renderOrder=1e3+e*2;for(const i of t.children)this.ensureRenderOnTop(i,e+1)}get isVisible(){var t;return(t=this.menu)==null?void 0:t.visible}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new Wt.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:.04,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new Fe(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const t=D.get("ObjectRaycaster");return t&&uf(this.menu,new t),this.menu}handleNeedleWatermark(){var t;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new Wt.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const e=new HT(this._context,()=>globalThis.open("https://needle.tools","_self"));uf(this._poweredByNeedleElement,e);const i=new Wt.Text({textContent:"Powered by",width:"auto",height:"auto"}),s=new Wt.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new Fe(0,0,0,.02)});this._poweredByNeedleElement.add(i),this._poweredByNeedleElement.add(s),(t=this.menu)==null||t.add(this._poweredByNeedleElement),this.markDirty(),new Xa().load("./include/needle/poweredbyneedle.webp",o=>{var l;e.allowModifyUI=!1,i.removeFromParent(),s.removeFromParent();const a=o.image.width/o.image.height;(l=this._poweredByNeedleElement)==null||l.set({backgroundImage:o,backgroundOpacity:1,width:.1*a,height:.1}),this.markDirty()})}if(this.menu){const e=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&pu())e>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const i=this.menu.children.indexOf(this._poweredByNeedleElement);e!==i&&this.markDirty()}}}ensureFont(){let t=Wt.FontLibrary.getFontFamily(this.familyName);if(!t){t=Wt.FontLibrary.addFontFamily(this.familyName);const e=t.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");e==null||e.addEventListener("ready",()=>{this.markDirty()})}}createButton(t,e){const i=new Wt.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),s=new Wt.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});i.add(s),i["needle:use_eventsystem"]=!0;const r=new HT(this._context,()=>e.click());return uf(i,r),new DH(this,t,e,i,s)}}class DH{constructor(t,e,i,s,r){c(this,"menu");c(this,"root");c(this,"htmlbutton");c(this,"spatialContainer");c(this,"spatialText");c(this,"spatialIcon");c(this,"_lastText","");c(this,"_lastTexture");this.menu=t,this.root=e,this.htmlbutton=i,this.spatialContainer=s,this.spatialText=r,new MutationObserver(a=>{for(const l of a)l.type==="attributes"?l.attributeName==="style"&&this.updateVisible():l.type==="childList"&&this.updateText()}).observe(i,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const t=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",t!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let t="",e="";this.htmlbutton.childNodes.forEach(i=>{i.nodeType===Node.TEXT_NODE?t+=i.textContent:i instanceof HTMLElement&&MH(i)&&i.textContent&&(e=i.textContent)}),this._lastText!==t&&(this._lastText=t,this.spatialText.name=t,this.spatialText.set({textContent:t}),this.menu.markDirty()),t.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),e&&this.createIcon(e)}async createIcon(t){var i;if(!this.spatialIcon){const s=await GT(t);if(s&&!this.spatialIcon){const o=new Wt.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:s,backgroundOpacity:1,margin:new Fe(0,.005,0,0)});this.spatialIcon=o,this.spatialContainer.add(o),this.menu.markDirty()}}if(t!=this._lastTexture){this._lastTexture=t;const s=await GT(t);s&&((i=this.spatialIcon)==null||i.set({backgroundImage:s}),this.menu.markDirty())}const e=this.spatialContainer.children.indexOf(this.spatialIcon);e>0&&(this.spatialContainer.children.splice(e,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class HT{constructor(t,e){c(this,"isComponent",!0);c(this,"enabled",!0);c(this,"gameObject");c(this,"allowModifyUI",!0);c(this,"context");c(this,"onclick");this.context=t,this.onclick=e}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),Wt.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),Wt.update())}onPointerDown(t){t.use()}onPointerUp(t){t.use()}onPointerClick(t){t.use(),this.onclick()}}const Ld="needle-menu",fg=z("debugmenu"),VT=z("debugnoncommercial");let OH=class{constructor(t){c(this,"_context");c(this,"_menu");c(this,"_spatialMenu");c(this,"onPostMessage",t=>{if(t.origin===globalThis.location.origin&&typeof t.data=="object"){const e=t.data,i=e.type;if(i==="needle:menu"){const s=e.button;if(s){if(!s.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!s.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const r=document.createElement("button");if(r.textContent=s.label,s.icon){const o=ys(s.icon);r.prepend(o)}s.priority&&r.setAttribute("priority",s.priority.toString()),r.onclick=()=>{if(s.onclick){const o=s.onclick.startsWith("http")||s.onclick.startsWith("www."),a=s.target||"_blank";o?globalThis.open(s.onclick,a):console.error("NeedleMenu: onclick is not a valid link",s.onclick)}},this._menu.appendChild(r)}else fg&&console.error("NeedleMenu: unknown postMessage event",e)}else fg&&console.warn("NeedleMenu: unknown postMessage type",i,e)}});c(this,"onStartXR",t=>{t.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),t.session.session.addEventListener("end",this.onExitXR),this._menu.closeFoldout())});c(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)});c(this,"_muteButton");c(this,"_fullscreenButton");this._menu=vy.getOrCreate(t.domElement,t),this._context=t,this._spatialMenu=new kH(t,this._menu),window.addEventListener("message",this.onPostMessage),CS(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(t){this._menu.setPosition(t)}setVisible(t){this._menu.setVisible(t)}showNeedleLogo(t){var e;this._menu.showNeedleLogo(t),(e=this._spatialMenu)==null||e.showNeedleLogo(t)}showSpatialMenu(t){this._spatialMenu.setEnabled(t)}setSpatialMenuVisible(t){this._spatialMenu.setDisplay(t)}get spatialMenuIsVisible(){return this._spatialMenu.isVisible}showQRCodeButton(t){if(t==="desktop-only"&&(t=!dc()),t){const e=Ha.getOrCreate().createQRCode();return e.style.display="",this._menu.appendChild(e),e}else{const e=Ha.getOrCreate().qrButton;return e&&(e.style.display="none"),e??null}}showAudioPlaybackOption(t){var e;if(!t){(e=this._muteButton)==null||e.remove();return}this._muteButton=Ha.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(t){var e;if(!t){(e=this._fullscreenButton)==null||e.remove();return}this._fullscreenButton=Ha.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(t){return this._menu.appendChild(t)}};var vm,ym,zx;const e1=class extends HTMLElement{constructor(){var d,f,p,g,m,v;super();Qi(this,ym);c(this,"_domElement",null);c(this,"_context",null);c(this,"_sizeChangeInterval");Qi(this,vm,e=>{if(!e.defaultPrevented&&e.target==this._domElement&&e instanceof PointerEvent&&e.button===0&&this.root.classList.contains("open")){const i=this.foldout.getBoundingClientRect(),s=e;s.clientX>i.left&&s.clientX<i.right&&s.clientY>i.top&&s.clientY<i.bottom||this.root.classList.toggle("open",!1)}});c(this,"_userRequestedLogoVisible");c(this,"_userRequestedMenuVisible");c(this,"root");c(this,"wrapper");c(this,"options");c(this,"logoContainer");c(this,"compactMenuButton");c(this,"foldout");c(this,"_isHandlingChange",!1);c(this,"_didSort",new Map);c(this,"_lastAvailableWidthChange",0);c(this,"_timeoutHandle",0);c(this,"handleSizeChange",(e,i)=>{if(!this._domElement)return;const s=this._domElement.clientWidth;if(s<100){clearTimeout(this._timeoutHandle),this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style");return}const r=20*2,o=s-r;if(!i&&Math.abs(o-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=o,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const h=l();h<0?(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")):h>0&&(this.root.classList.remove("compact"),this.foldout.classList.remove("floating-panel-style"),l()<0&&(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")))},5);const a=()=>this.options.clientWidth+this.logoContainer.clientWidth,l=()=>o-a()});const e=document.createElement("template");e.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: min(20px, 10vh);
            padding: 0.3rem;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            pointer-events: all;
            z-index: 1000;
        }

        /** hide the menu if it's empty **/
        #root.has-no-options.logo-hidden {
            display: none; 
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: min(30px, 10vh);
        }
        #root.top {
            top: calc(.7rem + env(safe-area-inset-top));
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 .3rem;
        }

        .wrapper > *, .options > button, ::slotted(*) {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(20,20,20);
        }

        .floating-panel-style {
            background: rgba(255, 255, 255, .4);
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            border-radius: 1.1999999999999993rem;
            /** 
             * to make nested background filter work 
             * https://stackoverflow.com/questions/60997948/backdrop-filter-not-working-for-nested-elements-in-chrome 
             **/
            &::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: -1;
                border-radius: 1.1999999999999993rem;
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options {
            display: flex;
            flex-direction: row;
        }

        .options > *, ::slotted(*) {
            max-height: 2.25rem;
            padding: .4rem .5rem;
        }
        
        :host .options > button, ::slotted(*) {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 0.8rem;
            user-select: none;
        }
        :host .options > *:hover, ::slotted(*:hover) {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            box-shadow: inset 0 0 1rem rgba(0,0,30,.2);
            outline: rgba(0,0,0,.1) 1px solid;
        }
        :host .options > *:active, ::slotted(*:active) {
            background: rgba(255, 255, 255, .8);
            box-shadow: inset 0px 1px 1px rgba(255,255,255,.5), inset 0 0 2rem rgba(0,0,30,.2), inset 0px 2px 4px rgba(0,0,20,.5);
            transition: all 0.05s linear;
        }
        :host .options > *:focus, ::slotted(*:focus) {
            outline: rgba(255,255,255,.5) 1px solid;
        }

        :host .options > *:disabled, ::slotted(*:disabled) {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button, ::slotted(button) {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
        }
        .logo-hidden {
            .logo {
                display: none;
            }
        }
        :host .has-options .logo {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */

        /** Hide the menu button normally **/
        .compact-menu-button { display: none; }
        /** And show it when we're in compact mode **/
        .compact .compact-menu-button {
            position: relative;
            display: block;
            background: none;
            border: none;
            border-radius: 2rem;

            margin: 0;
            padding: 0 .3rem;
            padding-top: .2rem;

            z-index: 100;

            color: #000;

            &:hover {
                background: rgba(255,255,255,.2);
                cursor: pointer;
            }
            &:focus {
                outline: 1px solid rgba(255,255,255,.5);
            }
            & .expanded-click-area {
                position: absolute;
                left: 0;
                right: 0;
                top: 10%;
                bottom: 10%;
                transform: scale(1.8);
            }
        }  
        .has-no-options .compact-menu-button {
            display: none;
        }
        .open .compact-menu-button {
            background: rgba(255,255,255,.2);
        }
        .logo-visible .compact-menu-button { 
            margin-left: .2rem;
        }
        
        /** Open and hide menu **/
        .compact .foldout { 
            display: none;
        }
        .open .options, .open .foldout {
            display: flex;
        }
        .compact .wrapper {
            padding: 0;
        }
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: row;
            gap: .12rem;
        }
        .compact .options { 
            flex-wrap: wrap;
            gap: .3rem;
        }
        .compact .top .options {
            height: auto;
            flex-direction: row;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }

        .compact .foldout {
            max-height: min(100ch, calc(100vh - 100px));
            overflow: auto;
            overflow-x: hidden;
            align-items: center;

            position: fixed;
            bottom: calc(100% + 5px);
            z-index: 100;
            width: auto;
            left: .2rem;
            right: .2rem;
            padding: .2rem;

        }
        .compact.logo-hidden .foldout {
            /** for when there's no logo we want to center the foldout **/
            min-width: 24ch;
            margin-left: 50%;
            transform: translateX(calc(-50% - .2rem));
        }
        
        .compact.top .foldout {
            top: calc(100% + 5px);
            bottom: auto;
        }

        ::-webkit-scrollbar {
            max-width: 7px;
            background: rgba(100,100,100,.2);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .3);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgb(150,150,150);
        }

        .compact .options > * {
            font-size: 1.2rem;
            padding: .6rem .5rem;
            width: 100%;
        }
        .compact.has-options .logo {
            border: none;
            padding-left: 0;
            margin-left: 1rem;
            margin-bottom: .02rem;
        }
        .compact .options > button {
            display: flex;
            flex-basis: 100%;
            min-height: 3rem;
        }
        .compact .options > button.row2 {
            //border: 1px solid red !important;
            display: flex;
            flex: 1;
            flex-basis: 30%;
        }

        /** If there's really not enough space then just hide all options **/
        @media (max-width: 100px) or (max-height: 100px){
            .foldout {
                display: none !important;
            }
            .compact-menu-button {
                display: none !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="logo-visible floating-panel-style bottom">
            <div class="wrapper">
                <div class="foldout">
                    <div class="options" part="options">
                        <slot></slot>
                    </div>
                    <div class="options" part="options">
                        <slot name="end"></slot>
                    </div>
                </div>
                <div style="user-select:none" class="logo">
                    <span class="madewith notranslate">powered by</span>
                </div>
            </div>
            <button class="compact-menu-button">
                <div class="expanded-click-area"></div>
            </button>
        </div>
        `;const i=this.attachShadow({mode:"open"});SO(),my(Nx,{loadedCallback:()=>{this.handleSizeChange()}}),my(Nx,{element:i});const s=e.content.cloneNode(!0);i==null||i.appendChild(s),this.root=i.querySelector("#root"),this.wrapper=(d=this.root)==null?void 0:d.querySelector(".wrapper"),this.options=(f=this.root)==null?void 0:f.querySelector(".options"),this.logoContainer=(p=this.root)==null?void 0:p.querySelector(".logo"),this.compactMenuButton=(g=this.root)==null?void 0:g.querySelector(".compact-menu-button"),this.compactMenuButton.append(ys("more_vert")),this.foldout=(m=this.root)==null?void 0:m.querySelector(".foldout"),(v=this.root)==null||v.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const r=EO.create();r.style.minHeight="1rem",this.logoContainer.append(r),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),zH(y=>{if(y==!0&&th()&&!VT){let b=this._userRequestedLogoVisible;b===void 0&&(b=!1),Mh(this,ym,zx).call(this,b)}}),this.compactMenuButton.addEventListener("click",y=>{y.preventDefault(),this.root.classList.toggle("open")});let o=this._context;setTimeout(()=>o=this._context);let a=0;const l=(y,b)=>{var _,x,S;fg&&console.log("Set menu visible",b),o!=null&&o.isInAR&&o.arOverlayElement?y!=o.arOverlayElement&&o.arOverlayElement.appendChild(this):this.parentNode!=((_=this._domElement)==null?void 0:_.shadowRoot)&&((S=(x=this._domElement)==null?void 0:x.shadowRoot)==null||S.appendChild(this)),this.style.display=b?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};let h=!1;new MutationObserver(y=>{var b;if(!h)try{h=!0,this.onChangeDetected(y);const _=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||_!=((b=this._domElement)==null?void 0:b.shadowRoot))&&!th()){const x=a++;fr()&&this._userRequestedMenuVisible===!1?(x===0&&l(_,this._userRequestedMenuVisible),x===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu â†’ The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):x===0?l(_,!0):setTimeout(()=>l(_,!0),5)}}finally{h=!1}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),fg&&this.___insertDebugOptions()}static create(){return document.createElement(Ld,{is:Ld})}static getOrCreate(e,i){let s=e.querySelector(Ld);return!s&&e.shadowRoot&&(s=e.shadowRoot.querySelector(Ld)),s||(s=e1.create(),e.shadowRoot?e.shadowRoot.appendChild(s):e.appendChild(s)),s._domElement=e,s._context=i,s}connectedCallback(){window.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3),setTimeout(()=>{var e,i;(e=this._domElement)==null||e.addEventListener("resize",this.handleSizeChange),(i=this._domElement)==null||i.addEventListener("click",ke(this,vm))},1)}disconnectedCallback(){var e,i;window.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval),(e=this._domElement)==null||e.removeEventListener("resize",this.handleSizeChange),(i=this._context)==null||i.domElement.removeEventListener("click",ke(this,vm))}showNeedleLogo(e){this._userRequestedLogoVisible=e,!(!e&&(!th()||VT)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!fr()))&&Mh(this,ym,zx).call(this,e)}setPosition(e){if(e!=="top"&&e!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",e);this.root.classList.remove("top","bottom"),this.root.classList.add(e)}setVisible(e){this._userRequestedMenuVisible=e,this.style.display=e?"flex":"none"}closeFoldout(){this.root.classList.remove("open")}append(...e){for(const i of e)if(typeof i=="string"){const s=document.createTextNode(i);this.options.appendChild(s)}else this.options.appendChild(i)}appendChild(e){var s;if(!(e instanceof Node)){const r=document.createElement("button");if(r.textContent=e.label,r.onclick=e.onClick,r.setAttribute("priority",((s=e.priority)==null?void 0:s.toString())??"0"),e.title&&(r.title=e.title),e.icon){const o=ys(e.icon);e.iconSide==="right"?r.appendChild(o):r.prepend(o)}e.class&&r.classList.add(e.class),e=r}return this.options.appendChild(e)}prepend(...e){for(const i of e)if(typeof i=="string"){const s=document.createTextNode(i);this.options.prepend(s)}else this.options.prepend(i)}onChangeDetected(e){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const i of e)i.target==this.options&&this.onOptionsChildrenChanged(i)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(e){if(this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions),this.handleSizeChange(void 0,!0),e.type==="childList"&&e.addedNodes.length>0){const i=Array.from(this.options.children);i.sort((r,o)=>{const a=parseInt(r.getAttribute("priority")||"0"),l=parseInt(o.getAttribute("priority")||"0");return a-l});let s=!1;for(let r=0;r<i.length;r++){const o=this.options.children[r],a=i[r];if(o!==a){s=!0;break}}if(s)for(const r of i)this.options.appendChild(r)}}handleMenuVisible(){fg&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let e=0;e<this.options.children.length;e++){const i=this.options.children[e];if(i.tagName==="SLOT"){const r=i.assignedNodes();for(const o of r)if(o instanceof HTMLElement&&o.style.display!="none")return!0}else if(i.style.display!="none")return!0}return!1}___insertDebugOptions(){window.addEventListener("keydown",s=>{s.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const e=document.createElement("button");e.textContent="Hide Buttons",e.onclick=()=>{const s=new Array(this.options.children.length);for(let r=0;r<this.options.children.length;r++)s[r]=this.options.children[r];for(const r of s)this.options.removeChild(r);setTimeout(()=>{for(const r of s)this.options.appendChild(r)},1e3)},this.appendChild(e);const i=document.createElement("button");i.textContent="Toggle Logo",i.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(i)}};let vy=e1;vm=new WeakMap,ym=new WeakSet,zx=function(e){this.logoContainer.style.display="",this.logoContainer.style.opacity="1",this.logoContainer.style.visibility="visible",e?(this.root.classList.remove("logo-hidden"),this.root.classList.add("logo-visible")):(this.root.classList.remove("logo-visible"),this.root.classList.add("logo-hidden"))};customElements.get(Ld)||customElements.define(Ld,vy);const nn=z("debugcontext"),LH=z("stats"),FH=z("debugactive"),UH=z("debugframerate"),NH=z("debugcoroutine"),eJ={};class tJ{constructor(){c(this,"name");c(this,"alias");c(this,"hash");c(this,"runInBackground");c(this,"domElement");c(this,"renderer");c(this,"camera");c(this,"scene")}}var We;(function(n){n[n.Start=-1]="Start",n[n.EarlyUpdate=0]="EarlyUpdate",n[n.Update=1]="Update",n[n.LateUpdate=2]="LateUpdate",n[n.OnBeforeRender=3]="OnBeforeRender",n[n.OnAfterRender=4]="OnAfterRender",n[n.PrePhysicsStep=9]="PrePhysicsStep",n[n.PostPhysicsStep=10]="PostPhysicsStep",n[n.Undefined=-1]="Undefined"})(We||(We={}));function qS(n,t){if(!n)return;if(!n.isComponent){(ve()||nn)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,n);return}t||(t=je.Current,nn&&console.warn("> Registering component without context"));const e=t==null?void 0:t.new_scripts;e.includes(n)||e.push(n)}const Yt=class{constructor(t){c(this,"name");c(this,"alias");c(this,"isManagedExternally",!1);c(this,"isPaused",!1);c(this,"runInBackground",!1);c(this,"targetFrameRate");c(this,"physicsSteps",1);c(this,"hash");c(this,"domElement");c(this,"_resolutionScaleFactor",1);c(this,"_boundingClientRectFrame",-1);c(this,"_boundingClientRect",null);c(this,"_domX");c(this,"_domY");c(this,"xr",null);c(this,"_xrFrame",null);c(this,"_currentFrameEvent",We.Undefined);c(this,"scene");c(this,"renderer");c(this,"composer",null);c(this,"scripts",[]);c(this,"scripts_pausedChanged",[]);c(this,"scripts_earlyUpdate",[]);c(this,"scripts_update",[]);c(this,"scripts_lateUpdate",[]);c(this,"scripts_onBeforeRender",[]);c(this,"scripts_onAfterRender",[]);c(this,"scripts_WithCorroutines",[]);c(this,"scripts_immersive_vr",[]);c(this,"scripts_immersive_ar",[]);c(this,"coroutines",{});c(this,"post_setup_callbacks",[]);c(this,"pre_update_callbacks",[]);c(this,"pre_render_callbacks",[]);c(this,"post_render_callbacks",[]);c(this,"pre_update_oneshot_callbacks",[]);c(this,"new_scripts",[]);c(this,"new_script_start",[]);c(this,"new_scripts_pre_setup_callbacks",[]);c(this,"new_scripts_post_setup_callbacks",[]);c(this,"new_scripts_xr",[]);c(this,"mainCameraComponent");c(this,"_mainCamera",null);c(this,"_fallbackCamera",null);c(this,"application");c(this,"animations");c(this,"time");c(this,"input");c(this,"physics");c(this,"connection");c(this,"assets");c(this,"mainLight",null);c(this,"sceneLighting");c(this,"addressables");c(this,"lightmaps");c(this,"players");c(this,"lodsManager");c(this,"menu");c(this,"_sizeChanged",!1);c(this,"_isCreated",!1);c(this,"_isCreating",!1);c(this,"_isVisible",!1);c(this,"_stats",LH?new sg:null);c(this,"_intersectionObserver",null);c(this,"_disposeCallbacks",[]);c(this,"maxRenderResolution");c(this,"_originalCreationArgs");c(this,"onUnhandledRejection",t=>{this.onError(t.reason)});c(this,"_cameraStack",[]);c(this,"_onBeforeRenderListeners",new Map);c(this,"_onAfterRenderListeners",new Map);c(this,"_requireDepthTexture",!1);c(this,"_requireColorTexture",!1);c(this,"_renderTarget");c(this,"_isRendering",!1);c(this,"_createId",0);c(this,"_renderlooperrors",0);c(this,"_lastTimestamp",0);c(this,"_accumulatedTime",0);c(this,"_dispatchReadyAfterFrame",!1);c(this,"_wasPaused",!1);this.name=(t==null?void 0:t.name)||"",this.alias=t==null?void 0:t.alias,this.domElement=(t==null?void 0:t.domElement)||document.body,this.hash=t==null?void 0:t.hash,t!=null&&t.renderer&&(this.renderer=t.renderer,this.isManagedExternally=!0),(t==null?void 0:t.runInBackground)!==void 0&&(this.runInBackground=t.runInBackground),t!=null&&t.scene?this.scene=t.scene:this.scene=new ws,t!=null&&t.camera&&(this._mainCamera=t.camera),this.application=new Ja(this),this.time=new RH,this.input=new l8(this),this.physics=new lg(this),this.connection=new i5(this),this.assets=new w5,this.sceneLighting=new IH(this),this.addressables=new j6(this),this.lightmaps=new mH(this),this.players=new bH(this),this.menu=new OH(this),this.lodsManager=new AH(this),this.animations=new q6(this);const e=()=>this._sizeChanged=!0;window.addEventListener("resize",e),this._disposeCallbacks.push(()=>window.removeEventListener("resize",e));const i=new ResizeObserver(s=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(s=>{this._isVisible=s[0].isIntersecting}),this._disposeCallbacks.push(()=>{var s;return(s=this._intersectionObserver)==null?void 0:s.disconnect()}),xt.register(this)}static get DefaultTargetFrameRate(){return Yt._defaultTargetFramerate.value}static set DefaultTargetFrameRate(t){Yt._defaultTargetFramerate.value=t}static get DefaultWebGLRendererParameters(){return Yt._defaultWebglRendererParameters}get version(){return Xo}static get Current(){return xt.Current}static set Current(t){xt.Current=t}appendHTMLElement(t){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(t):this.domElement.appendChild(t)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(t){if(t!==this._resolutionScaleFactor&&typeof t=="number"){if(t<=0){console.error("Invalid resolution scale factor",t);return}this._resolutionScaleFactor=t,this.updateSize()}}calculateBoundingClientRect(){if(this.xr){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var t,e;return((e=(t=this.renderer)==null?void 0:t.xr)==null?void 0:e.isPresenting)||!1}get xrSessionMode(){var t;return(t=this.xr)==null?void 0:t.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var t,e;return(e=(t=this.renderer)==null?void 0:t.xr)==null?void 0:e.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var t,e;return this.renderer.xr.isPresenting?(e=(t=this.renderer)==null?void 0:t.xr)==null?void 0:e.getCamera():void 0}get arOverlayElement(){const t=this.domElement;return typeof t.getAROverlayContainer=="function"?t.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._mainCamera)return this._mainCamera;if(this.mainCameraComponent){const t=this.mainCameraComponent;return t.cam||t.buildCamera(),t.cam}return this._fallbackCamera||(this._fallbackCamera=new bt(75,this.domWidth/this.domHeight,.1,1e3)),this._fallbackCamera}set mainCamera(t){this._mainCamera=t}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(t){var e,i,s;if((e=this.renderer)==null||e.dispose(),t={...Yt.DefaultWebGLRendererParameters,...t},!t.canvas){const r=(s=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:s.querySelector("canvas");r&&(t.canvas=r,nn&&console.log("Using canvas from shadow root",r))}nn&&console.log("Using Renderer Parameters:",t,this.domElement),this.renderer=new Pu(t),this.renderer.debug.checkShaderErrors=ve()||z("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=Cf,this.renderer.setClearColor(new be("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=CF,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=Ge,this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var t,e;(t=this._intersectionObserver)==null||t.disconnect(),(e=this._intersectionObserver)==null||e.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(t=!1){var e,i,s;if(t||!this.isManagedExternally&&((e=this.renderer.xr)==null?void 0:e.isPresenting)===!1){this._sizeChanged=!1;const r=this.resolutionScaleFactor;let o=this.domWidth*r,a=this.domHeight*r;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),o=Math.min(this.maxRenderResolution.x,o),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),a=Math.min(this.maxRenderResolution.y,a));const l=this.mainCamera;this.updateAspect(l),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((s=this.composer.setPixelRatio)==null||s.call(this.composer,window.devicePixelRatio)))}}updateAspect(t,e,i){if(!t)return;e===void 0&&(e=this.domWidth),i===void 0&&(i=this.domHeight);const s=t.aspect;t.aspect=e/i,s!==t.aspect&&t.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(t){return this.create(t)}async create(t){try{this._isCreating=!0,t!==this._originalCreationArgs&&(this._originalCreationArgs=p0(t)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const e=await this.internalOnCreate(t);return this._isCreated=e,e}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}onError(t){this.domElement.dispatchEvent(new CustomEvent("error",{detail:t}))}clear(){var t,e,i,s;xt.dispatchCallback(dt.ContextClearing,this),ha(this,dt.ContextClearing),wo(this.scene,!0,!0),this.scene=new ws,(t=this.addressables)==null||t.dispose(),(e=this.lightmaps)==null||e.clear(),(s=(i=this.physics)==null?void 0:i.engine)==null||s.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),xt.dispatchCallback(dt.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var t,e;Yt.Current=this,xt.dispatchCallback(dt.ContextDestroying,this),ha(this,dt.ContextDestroying),this.clear(),(t=this.renderer)==null||t.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(nn&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy(),this.animations.onDestroy();for(const i of this._disposeCallbacks)try{i()}catch(s){console.error("Error in on dispose callback:",s,i)}(e=this.domElement)!=null&&e.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,xt.dispatchCallback(dt.ContextDestroyed,this),ha(this,dt.ContextDestroyed),xt.unregister(this),Yt.Current===this&&(Yt.Current=null)}registerCoroutineUpdate(t,e,i){return typeof(e==null?void 0:e.next)!="function"?(console.error("Registered invalid coroutine function from "+t.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),e):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:t,main:e}),e)}unregisterCoroutineUpdate(t,e){if(!this.coroutines[e])return;const i=this.coroutines[e].findIndex(s=>s.main===t);i>=0&&this.coroutines[e].splice(i,1)}stopAllCoroutinesFrom(t){for(const e in this.coroutines){const i=this.coroutines[e];for(let s=i.length-1;s>=0;s--)i[s].comp===t&&i.splice(s,1)}}setCurrentCamera(t){var s;if(!t)return;if(t.cam||t.buildCamera(),!t.cam){console.warn("Camera component is missing camera",t);return}const e=this._cameraStack.indexOf(t);e>=0&&this._cameraStack.splice(e,1),this._cameraStack.push(t),this.mainCameraComponent=t;const i=t.cam;i.isPerspectiveCamera&&this.updateAspect(i),(s=this.mainCameraComponent)==null||s.applyClearFlagsIfIsActiveCamera()}removeCamera(t){if(!t)return;const e=this._cameraStack.indexOf(t);if(e>=0&&this._cameraStack.splice(e,1),this.mainCameraComponent===t&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(t,e){this._onBeforeRenderListeners.has(t.uuid)||(this._onBeforeRenderListeners.set(t.uuid,[]),t.onBeforeRender=this._createRenderCallbackWrapper(t,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(t.uuid).push(e)}removeBeforeRenderListener(t,e){if(this._onBeforeRenderListeners.has(t.uuid)){const i=this._onBeforeRenderListeners.get(t.uuid),s=i.indexOf(e);s>=0&&i.splice(s,1)}}addAfterRenderListener(t,e){var i;this._onAfterRenderListeners.has(t.uuid)||(this._onAfterRenderListeners.set(t.uuid,[]),t.onAfterRender=this._createRenderCallbackWrapper(t,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(t.uuid))==null||i.push(e)}removeAfterRenderListener(t,e){if(this._onAfterRenderListeners.has(t.uuid)){const i=this._onAfterRenderListeners.get(t.uuid),s=i.indexOf(e);s>=0&&i.splice(s,1)}}_createRenderCallbackWrapper(t,e){return(i,s,r,o,a,l)=>{const h=e.get(t.uuid);if(h)for(let u=0;u<h.length;u++){const d=h[u];d(i,s,r,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(t){this._requireDepthTexture=t}setRequireColor(t){this._requireColorTexture=t}get depthTexture(){var t;return((t=this._renderTarget)==null?void 0:t.depthTexture)||null}get opaqueColorTexture(){var t;return((t=this._renderTarget)==null?void 0:t.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const t=getComputedStyle(this.domElement);return t.visibility!=="hidden"&&t.display!=="none"&&t.opacity!=="0"}async internalOnCreate(t){var a,l,h,u,d,f,p,g;const e=++this._createId;nn&&console.log("Creating context",this.name,t);const i=globalThis["needle:dependencies:ready"];i instanceof Promise&&(nn&&console.log("Waiting for dependencies to be ready"),await i.catch(m=>{if(nn||ve()){if(pS("Needle Engine dependencies failed to load. Please check the console for more details"),m instanceof ReferenceError){let v="YourComponentName";const y=m.message.indexOf("'");if(y>0){const b=m.message.indexOf("'",y+1);if(b>0){const _=m.message.substring(y+1,b);_.length>3&&(v=_)}}console.error(`Needle Engine dependencies failed to load:

# Make sure you don't have circular imports in your scripts!
â†’ Possible solution: Replace @serializable(${v}) in your script with @serializable(Behaviour)

---`,m);return}console.error("Needle Engine dependencies failed to load",m)}}).then(()=>{nn&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(a=this.renderer)==null||a.setAnimationLoop(null)),await sc(1),Yt.Current=this,await xt.dispatchCallback(dt.ContextCreationStart,this);let s=!0,r;try{Yt.Current=this,t?r=await this.internalLoadInitialContent(e,t):r=[]}catch(m){console.error(m),s=!1}if(!s)return this.onError("Failed to load initial content"),!1;if(e!==this._createId||(l=t==null?void 0:t.abortSignal)!=null&&l.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return nn&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),Yt.Current=this,Yt.Current=this;for(let m=0;m<this.new_scripts.length;m++){const v=this.new_scripts[m];if(v.gameObject!==void 0&&v.gameObject!==null){v.gameObject.userData===void 0&&(v.gameObject.userData={}),v.gameObject.userData.components===void 0&&(v.gameObject.userData.components=[]);const y=v.gameObject.userData.components;y.includes(v)||y.push(v)}}if(this.post_setup_callbacks)for(let m=0;m<this.post_setup_callbacks.length;m++)Yt.Current=this,await this.post_setup_callbacks[m](this);if(!this._mainCamera){Yt.Current=this;let m=null;Df(this.scene,v=>{const y=v;if(y!=null&&y.isCamera){if(hg(y.gameObject),!y.activeAndEnabled)return;if(y.tag==="MainCamera")return m=y,!0;m=y}}),m?this.setCurrentCamera(m):!xt.dispatchCallback(dt.MissingCamera,this,{files:r})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),Yt.Current=this,ly(this),this.physics.engine&&((h=this.physics.engine)==null||h.step(0),(u=this.physics.engine)==null||u.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const m=new x0(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(m),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),this._stats.dom.style.position="absolute",(d=this.domElement.shadowRoot)==null||d.appendChild(this._stats.dom)),nn&&Kw(this.scene,!0),this.targetFrameRate===void 0?(nn&&console.warn("No target framerate set, using default",Yt.DefaultTargetFrameRate),this.targetFrameRate=Yt._defaultTargetFramerate):nn&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const o=xt.dispatchCallback(dt.ContextCreated,this,{files:r});return o&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((f=this.domElement)==null||f.internalSetLoadingMessage("finish loading")),await o),(p=t==null?void 0:t.abortSignal)!=null&&p.aborted?!1:(ha(this,dt.ContextCreated),nn&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((g=t==null?void 0:t.abortSignal)!=null&&g.aborted)&&this.restartRenderLoop(),!0)}async internalLoadInitialContent(t,e){var l,h,u,d;const i=new Array;if(e.files.length===0)return i;const s=[...e.files],r={name:"",progress:null,index:0,count:s.length},o=nl(),a=0;for(let f=0;f<s.length;f++){if((l=e.abortSignal)!=null&&l.aborted){nn&&console.log("Aborting loading because of abort signal");break}if(t!==this._createId){nn&&console.log("Aborting loading because create id changed",t,this._createId);break}const p=s[f];(h=e==null?void 0:e.onLoadingStart)==null||h.call(this,f,p),nn&&console.log("Context Load "+p);const g=await o.loadSync(this,p,p,a,m=>{var v,y;(v=e.abortSignal)!=null&&v.aborted||(r.name=p,r.progress=m,r.index=f,r.count=s.length,(y=e.onLoadingProgress)==null||y.call(this,r))});(u=e==null?void 0:e.onLoadingFinished)==null||u.call(this,f,p,g??null),g?i.push({src:p,file:g}):console.warn("Could not load file: "+p)}if(t!==this._createId||(d=e.abortSignal)!=null&&d.aborted){for(const f of i)if(f&&f.file)for(const p of f.file.scenes)wo(p,!0,!0)}else{let f=!1;for(const p of i)p&&p.file&&(p.file.scene?(f=!0,this.scene.add(p.file.scene)):console.warn("No scene found in loaded file"));if(!f){for(const p of i)if(p&&p.file){let g=0;for(let m=0;m<p.file.parser.json.materials.length;m++){const v=await p.file.parser.getDependency("material",m),y=new ne;y.position.x=m*1.1,y.position.y=g,this.scene.add(y),Fu.createPrimitive("ShaderBall",{parent:y,material:v})}g+=1}}}return i}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((t,e)=>{this.isManagedExternally||this.update(t,e)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(t,e){if(e===void 0&&(e=null),ve()||nn||T5())try{performance.mark("update.start"),this.internalStep(t,e),this._renderlooperrors=0,performance.mark("update.end"),performance.measure("NE Frame","update.start","update.end")}catch(i){this._renderlooperrors+=1,(ve()||nn)&&(i instanceof Error||i instanceof TypeError)&&bi("Caught unhandled exception during render-loop - see console for details.",Xi.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(t,e)}updatePhysics(t){this.internalUpdatePhysics(t)}internalStep(t,e){this.internalOnBeforeRender(t,e)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(t,e){var s;this.renderer.info.autoReset=!0;const i=e!==null&&this._xrFrame===null;if(this._xrFrame=e,i&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:e}})),this._currentFrameEvent=We.Undefined,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=t),this._accumulatedTime+=(t-this._lastTimestamp)/1e3,this._lastTimestamp=t;let r=this.targetFrameRate;if(typeof r=="object"&&(r=r.value),this._accumulatedTime<1/(r+1))return!1;this._accumulatedTime=0}if((s=this._stats)==null||s.begin(),Yt.Current=this,this.onHandlePaused())return!1;for(Yt.Current=this,this.time.update(),UH&&console.log("FPS",this.time.smoothedFps.toFixed(0)),ly(this),Iv(this.scene),YD(this),ha(this,We.Start);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_oneshot_callbacks){for(const r in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[r]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();this._currentFrameEvent=We.EarlyUpdate;for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(Yt.Current=this,o.earlyUpdate())}if(this.executeCoroutines(We.EarlyUpdate),ha(this,We.EarlyUpdate),this.onHandlePaused())return!1;this._currentFrameEvent=We.Update;for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];o.activeAndEnabled&&o.update!==void 0&&(Yt.Current=this,o.update())}if(this.executeCoroutines(We.Update),ha(this,We.Update),this.onHandlePaused())return!1;this._currentFrameEvent=We.LateUpdate;for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];o.activeAndEnabled&&o.lateUpdate!==void 0&&(Yt.Current=this,o.lateUpdate())}if(this.executeCoroutines(We.LateUpdate),ha(this,We.LateUpdate),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=We.OnBeforeRender;for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(Yt.Current=this,o.onBeforeRender(e))}if(this.executeCoroutines(We.OnBeforeRender),ha(this,We.OnBeforeRender),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r](e)}return!0}internalUpdatePhysics(t){if(!this.physics.engine)return!1;const e=t,i=this.time.deltaTime/e;for(let s=0;s<e;s++)this._currentFrameEvent=We.PrePhysicsStep,this.executeCoroutines(We.PrePhysicsStep),this.physics.engine.step(i),this._currentFrameEvent=We.PostPhysicsStep,this.executeCoroutines(We.PostPhysicsStep);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(M5(this),this._currentFrameEvent=We.Undefined,this.renderNow(),this._currentFrameEvent=We.OnAfterRender)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let t=0;t<this.scripts_onAfterRender.length;t++){const e=this.scripts_onAfterRender[t];e.activeAndEnabled&&e.onAfterRender!==void 0&&(Yt.Current=this,e.onAfterRender())}if(this.executeCoroutines(We.OnAfterRender),ha(this,We.OnAfterRender),this.post_render_callbacks)for(const t in this.post_render_callbacks)this.post_render_callbacks[t]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory},`
Target Framerate: `+this.targetFrameRate)),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),xt.dispatchCallback(dt.ContextFirstFrameRendered,this))}renderNow(t){return!t&&(t=this.mainCamera,!t)?!1:(this.handleRendererContextLost(),this._isRendering=!0,this.renderRequiredTextures(),this.renderer.toneMapping!==Cf&&CO(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):t&&(this.isInXR&&E1()&&this.renderer.clearDepth(),this.renderer.render(this.scene,t)),this._isRendering=!1,!0)}handleRendererContextLost(){this.renderer.getContext().isContextLost()&&(console.warn("Attempting to recover WebGL context..."),this.renderer.forceContextRestore())}onHandlePaused(){const t=this.evaluatePaused();if(this._wasPaused!==t){FH&&console.log("Paused?",t,"context:"+this.alias);for(let e=0;e<this.scripts_pausedChanged.length;e++){const i=this.scripts_pausedChanged[e];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(Yt.Current=this,i.onPausedChanged(t,this._wasPaused))}}return this._wasPaused=t,t}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new Et(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new RC(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new At,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=mi,this._renderTarget.texture.magFilter=mi,this._renderTarget.texture.format=Wi)}const t=this._renderTarget;t.texture&&(t.texture.colorSpace=this.renderer.outputColorSpace);const e=this.renderer.getRenderTarget();this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(e)}executeCoroutines(t){var i;if(this.coroutines[t]){const s=this.coroutines[t];for(let r=0;r<s.length;r++)try{const o=s[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){NH&&console.log("Removing coroutine",o.comp,o.comp.enabled),s.splice(r,1),--r;continue}const l=o.chained;if(l&&l.length>0){const f=l[l.length-1].next();if(f.done&&l.pop(),e(f)&&(o.chained||(o.chained=[]),o.chained.push(f.value)),!f.done)continue}const h=o.main.next();if(h.done===!0){s.splice(r,1),--r;continue}const u=h.value;if(e(u)){if(u.next().done)continue;o.chained||(o.chained=[]),o.chained.push(u)}else if(u instanceof Promise){const d=u;o.chained||(o.chained=[]);const f=Y6(d);(i=o.chained)==null||i.push(f);continue}}catch(o){console.error(o)}}function e(s){return!!(s&&s.next&&s.return)}}};let je=Yt;c(je,"_defaultTargetFramerate",{value:90,toString(){return this.value}}),c(je,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:uh()||E1()?"default":"high-performance"});const uo=z("debuglicense");let fu="basic";uo&&console.log("License Type: "+fu);function pu(){switch(fu){case"pro":case"enterprise":return!0}return!1}function IO(){switch(fu){case"indie":return!0}return!1}function th(){return pu()||IO()}const TO=[];function zH(n){if(pu()||IO())return n(!0);TO.push(n)}function QH(n){for(const t of TO)try{t(n)}catch{}}xt.registerCallback(dt.ContextRegistered,n=>{HH(n.context),WH(),GH(n.context)});let ih,Qx=!1,Xp="";async function jH(){if(ih)return ih;if(fu==="basic")try{const n="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+Xo+"&generator="+encodeURIComponent(gS),t=await fetch(n,{method:"GET"}).catch(e=>{uo&&console.error("License check failed",e)});(t==null?void 0:t.status)===200?(Qx=!1,uo&&console.log("License check succeeded"),fu="pro",QH(!0)):(t==null?void 0:t.status)===403?(Qx=!0,Xp=await t.text()):uo&&console.log("License check failed with status "+(t==null?void 0:t.status))}catch(n){uo&&console.error("License check failed",n)}else uo&&console.log('Runtime license check is skipped because license is already applied as "'+fu+'"')}ih=jH();async function GH(n){function t(){const s=document.createElement("div");s.className="needle-forbidden",s.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const r=s.style.cssText,o=document.createElement("div");s.appendChild(o),o.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const a=o.style.cssText,l=(Xp==null?void 0:Xp.length)>1?Xp:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return o.innerHTML=l,setInterval(()=>{o.innerHTML!==l&&(o.innerHTML=l),o.parentNode!==s&&s.appendChild(o),s.style.cssText!==r&&(s.style.cssText=r),o.style.cssText!==a&&(o.style.cssText=a)},500),s}let e=t();const i=e.style.cssText;setInterval(()=>{var s;Qx===!0&&(e.style.cssText!==i&&(e=t()),n.domElement.shadowRoot?e.parentNode!==n.domElement.shadowRoot&&((s=n.domElement.shadowRoot)==null||s.appendChild(e)):e.parentNode!=document.body&&document.body.appendChild(e))},500)}async function HH(n){try{if(th()!==!0)return D_(n)}catch(t){return uo&&console.log("License check failed",t),D_(n)}uo&&D_(n)}async function D_(n){n.domElement.addEventListener("ready",()=>!0),await(ih==null?void 0:ih.catch(()=>{})),!th()&&VH()}let WT=0;async function VH(n){var o;const t=Date.now();if(t-WT<2e3)return;WT=t;const i=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine â€” No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${Xo}`;(o=je.Current)!=null&&o.xr?console.log(r):console.log("%c "+r,i)}async function WH(){var n;try{const t="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(t){uo&&console.log("Analytics backend url",t);const e=window.location.href.split("?")[0];let i="api/v2/new/request";t.endsWith("/")||(i="/"+i);const s=fu,r=`${t}${i}`;uo&&console.log("Sending non-commercial usage message to analytics backend",r);const o={license:s,url:e,hostname:window.location.hostname,pathname:window.location.pathname,version:Xo,generator:gS,build_time:nk},a=(n=navigator.sendBeacon)==null?void 0:n.call(navigator,r,JSON.stringify(o));uo&&console.log("Send beacon result",a)}}catch(t){uo&&console.log("Failed to send non-commercial usage message to analytics backend",t)}}const Kh=z("debugloading"),wp=z("debugloadingrendering"),qT=z("debuglicense");class iJ{constructor(){c(this,"className");c(this,"additionalClasses")}}let xp=0,XT;function RO(n){Kh&&console.log(n.progress.loaded.toFixed(0)+"/"+n.progress.total.toFixed(0),n);const t=n.count,e=n.progress.total;e===0||e===void 0?(XT!==n.name&&(xp=0),XT=n.name,xp+=(1-xp)*.001,Kh&&qt("Loading "+n.name+" did not report total size")):xp=n.progress.loaded/e;const i=n.index/t+xp/t;return ye.clamp01(i)}const Jy=class{constructor(t,e){c(this,"loadingProgress",0);c(this,"_element");c(this,"_progress",0);c(this,"_allowCustomLoadingElement",!0);c(this,"_loadingElement");c(this,"_loadingTextContainer",null);c(this,"_loadingBar",null);c(this,"_messageContainer",null);c(this,"_loadingElementOptions");c(this,"_progressLoop");this._element=t,this._loadingElementOptions=e}async onLoadingBegin(t){const e=this._element.shadowRoot||this._element;if(Kh&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<e.children.length;i++){const s=e.children[i];if(s.classList.contains(Jy.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){Kh&&console.warn("Remove custom loading container"),e.removeChild(s);continue}this._loadingElement=this.createLoadingElement(s)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",e.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(t??"")}onLoadingUpdate(t,e){var s;if(!((s=this._loadingElement)!=null&&s.parentNode))return;let i=0;typeof t=="number"?i=t:("index"in t&&(i=RO(t)),!e&&"name"in t&&this.setMessage("loading "+t.name)),this.loadingProgress=i,e&&this.setMessage(e),this.updateDisplay()}onLoadingFinished(){Kh&&console.warn("Finished Loading"),wp||(this.loadingProgress=1,this.onDoneLoading())}setMessage(t){this._messageContainer&&(this._messageContainer.innerText=t)}smoothProgressLoop(){if(this._progressLoop)return;let t=1/12;wp&&(t=1/500,typeof wp=="number"&&(t*=wp)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!wp&&(t=.9),this._progress=ye.lerp(this._progress,this.loadingProgress,t*this.loadingProgress),this.updateDisplay()},t)}onDoneLoading(){this._loadingElement&&(Kh&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const t=this._progress,e=(t*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=t*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=e)}createLoadingElement(t){var g,m;Kh&&!t&&console.log("Creating loading element"),this._loadingElement=t||document.createElement("div");let e=this._element.getAttribute("loading-style");(!e||e==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?e="dark":e="light");const i=pu();if(!t&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",e==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",e==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",i&&this._element)){const v=this._element.getAttribute("loading-background-color");v&&(this._loadingElement.style.backgroundColor=v);const y=this._element.getAttribute("loading-text-color");y&&(this._loadingElement.style.color=y)}const s=((g=this._loadingElementOptions)==null?void 0:g.className)??Jy.LoadingContainerClassName;if(this._loadingElement.classList.add(s),(m=this._loadingElementOptions)!=null&&m.additionalClasses)for(const v of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(v);const r=document.createElement("div");this._loadingElement.appendChild(r);const o=document.createElement("img"),a=120;o.style.width=`${a}px`,o.style.height=`${a}px`,o.style.paddingTop="20px",o.style.paddingBottom="10px",o.style.margin="0px",o.style.userSelect="none",o.style.objectFit="contain",o.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",o.style.transform="translateY(30px)",o.style.opacity="0.05",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0px)"},1),o.src=zz;let l=!1;if(i&&this._element){const v=this._element.getAttribute("loading-logo-src");v&&(l=!0,o.src=v)}l||(o.style.cursor="pointer",o.style.pointerEvents="all",o.addEventListener("click",()=>window.open("https://needle.tools","_blank"))),r.appendChild(o);const h=document.createElement("div");h.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{h.style.opacity="1"},1),this._loadingElement.appendChild(h);const u=document.createElement("div"),d=100;u.style.display="flex",u.style.width=d+"%",u.style.height="3px",u.style.position="absolute",u.style.left="0",u.style.bottom="0px",u.style.opacity="0",u.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{u.style.opacity="1"},1),e==="light"?u.style.backgroundColor="rgba(0,0,0,.2)":u.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(u),this._loadingBar=document.createElement("div"),u.appendChild(this._loadingBar);const f=function(v){return ye.lerp(0,d,v)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${f(0)}, #0BA398 ${f(.3)}, #66A22F ${f(.6)}, #D7DB0A ${f(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",i&&this._element){const v=this._element.getAttribute("primary-color"),y=this._element.getAttribute("secondary-color");v&&y?this._loadingBar.style.background=`linear-gradient(90deg, ${v} ${f(0)}, ${y} ${f(1)})`:v?this._loadingBar.style.background=v:y&&(this._loadingBar.style.background=y)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",h.appendChild(this._loadingTextContainer);const p=document.createElement("div");if(this._messageContainer=p,p.style.display="flex",p.style.fontSize=".8rem",p.style.paddingTop=".1rem",p.style.justifyContent="center",h.appendChild(p),i&&this._element){const v=this._element.getAttribute("loading-text-color");v&&(p.style.color=v)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(t){let e=th();if(e)return;qT&&console.log("Loading UI has commercial license?",e);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,i.style.cursor="pointer",i.style.userSelect="none",i.style.textAlign="center",i.style.pointerEvents="all",i.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),i.style.opacity="0",t.appendChild(i),!ve()&&ih&&(qT&&console.log("Waiting for runtime license check"),await ih,e=th()),!e&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let Fv=Jy;c(Fv,"LoadingContainerClassName","loading");const Cp=z("debugoverlay"),BO="ar",qH="quit-ar";class XH{constructor(){c(this,"arContainer",null);c(this,"currentSession",null);c(this,"_createdAROnlyElements",[]);c(this,"_reparentedObjects",[]);c(this,"contentElement",null);c(this,"originalDomOverlayParent",null);c(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(t,e,i){var s;if(this.currentSession=i,this.arContainer=e,sf()){const r=t.domElement.children;for(let o=0;o<(r==null?void 0:r.length);o++){const a=r[o];if(!a||a===this.arContainer)return;this._reparentedObjects.push({el:a,previousParent:a.parentElement}),(s=this.arContainer)==null||s.appendChild(a)}e?(this.originalDomOverlayParent=e.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",e,e.style.display),e.style.display="",e.style.visibility="",document.body.appendChild(e))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(t){var e;for(const i of this._createdAROnlyElements)i.remove&&i.remove();for(const i of this._reparentedObjects){const s=i.el;(e=i.previousParent)==null||e.appendChild(s)}this._reparentedObjects.length=0,sf()&&setTimeout(()=>{var o;const i=t.renderer.domElement;i&&((o=t.domElement.shadowRoot)==null||o.prepend(i));const s=document.querySelectorAll("*");for(var r=0;r<s.length;r++){const a=s[r];a&&a._displayChanged!==void 0&&a._displayWas!==void 0&&(a.style.display=a._displayWas)}},10)}createOverlayContainer(t){if(this.contentElement)return this.contentElement;Cp&&console.log("Setup overlay container");const e=t.shadowRoot.querySelector(".content");this.contentElement=e;const i=t.shadowRoot.querySelector(".overlay-content");return i&&e.appendChild(i),Cp&&!dc()&&this.ensureQuitARButton(e),e}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(t){const e=document.createElement("slot");e.setAttribute("name","quit-ar"),this.appendElement(e,t),this._createdAROnlyElements.push(e),e.style.pointerEvents="auto";const i=document.querySelector(`.${qH}`);if(i){i.addEventListener("click",this.requestEndAR),Cp&&i.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}e.addEventListener("click",this.requestEndAR),Cp&&e.addEventListener("click",()=>console.log("Clicked fallback close button"));const s=document.createElement("div");s.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(s,e);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("quit-ar-button"),r.setAttribute("width","40px"),r.setAttribute("height","40px"),r.style.cssText=`
            background: rgba(255, 255, 255, .4);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,.3);
            outline: 1px solid rgba(255, 255, 255, .6);
            display: flex;
            justify-content: center;
            align-items: center;
        `,s.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),o.setAttribute("stroke","#000000"),o.setAttribute("stroke-width","2px"),o.style.cssText=`
            /**filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));**/
        `,r.appendChild(o),Cp&&console.log("Created fallback close button",r,t)}appendElement(t,e){return e.shadowRoot?e.shadowRoot.appendChild(t):e.appendChild(t)}}const O0=z("debugdecoders");let O_,L_=null;function L0(){if(!L_){const n=xS(null);L_={dracoLoader:n.dracoLoader,ktx2Loader:n.ktx2Loader,meshoptDecoder:n.meshoptDecoder}}return L_}function YT(n){if(n!==void 0&&typeof n=="string"){zG(n);const t=L0();O0&&console.log("Setting draco decoder path to",n),t.dracoLoader.setDecoderPath(n)}}function KT(n){if(n!==void 0&&typeof n=="string"){const t=L0();O0&&console.log("Setting draco decoder type to",n),t.dracoLoader.setDecoderConfig({type:n})}}function JT(n){if(n!==void 0&&typeof n=="string"){QG(n);const t=L0();O0&&console.log("Setting ktx2 transcoder path to",n),t.ktx2Loader.setTranscoderPath(n)}}function F0(n,t){const e=L0();return O_||(O_=e.meshoptDecoder,O0&&console.log("Using the default meshopt decoder")),t.renderer?e.ktx2Loader.detectSupport(t.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),n.dracoLoader||n.setDRACOLoader(e.dracoLoader),n.ktx2Loader||n.setKTX2Loader(e.ktx2Loader),n.meshoptDecoder||n.setMeshoptDecoder(O_),n}function PO(n,t,e){const i=e.length-n-1;if(t>=e[i])return i-1;if(t<=e[n])return n;let s=n,r=i,o=Math.floor((s+r)/2);for(;t<e[o]||t>=e[o+1];)t<e[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}function YH(n,t,e,i){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=e;++a){r[a]=t-i[n+1-a],o[a]=i[n+a]-t;let l=0;for(let h=0;h<a;++h){const u=o[h+1],d=r[a-h],f=s[h]/(u+d);s[h]=l+u*f,l=d*f}s[a]=l}return s}function KH(n,t,e,i){const s=PO(n,i,t),r=YH(s,i,n,t),o=new Fe(0,0,0,0);for(let a=0;a<=n;++a){const l=e[s-n+a],h=r[a],u=l.w*h;o.x+=l.x*u,o.y+=l.y*u,o.z+=l.z*u,o.w+=l.w*h}return o}function JH(n,t,e,i,s){const r=[];for(let d=0;d<=e;++d)r[d]=0;const o=[];for(let d=0;d<=i;++d)o[d]=r.slice(0);const a=[];for(let d=0;d<=e;++d)a[d]=r.slice(0);a[0][0]=1;const l=r.slice(0),h=r.slice(0);for(let d=1;d<=e;++d){l[d]=t-s[n+1-d],h[d]=s[n+d]-t;let f=0;for(let p=0;p<d;++p){const g=h[p+1],m=l[d-p];a[d][p]=g+m;const v=a[p][d-1]/a[d][p];a[p][d]=f+g*v,f=m*v}a[d][d]=f}for(let d=0;d<=e;++d)o[0][d]=a[d][e];for(let d=0;d<=e;++d){let f=0,p=1;const g=[];for(let m=0;m<=e;++m)g[m]=r.slice(0);g[0][0]=1;for(let m=1;m<=i;++m){let v=0;const y=d-m,b=e-m;d>=m&&(g[p][0]=g[f][0]/a[b+1][y],v=g[p][0]*a[y][b]);const _=y>=-1?1:-y,x=d-1<=b?m-1:e-d;for(let E=_;E<=x;++E)g[p][E]=(g[f][E]-g[f][E-1])/a[b+1][y+E],v+=g[p][E]*a[y+E][b];d<=b&&(g[p][m]=-g[f][m-1]/a[b+1][d],v+=g[p][m]*a[d][b]),o[m][d]=v;const S=f;f=p,p=S}}let u=e;for(let d=1;d<=i;++d){for(let f=0;f<=e;++f)o[d][f]*=u;u*=e-d}return o}function ZH(n,t,e,i,s){const r=s<n?s:n,o=[],a=PO(n,i,t),l=JH(a,i,n,r,t),h=[];for(let u=0;u<e.length;++u){const d=e[u].clone(),f=d.w;d.x*=f,d.y*=f,d.z*=f,h[u]=d}for(let u=0;u<=r;++u){const d=h[a-n].clone().multiplyScalar(l[u][0]);for(let f=1;f<=n;++f)d.add(h[a-n+f].clone().multiplyScalar(l[u][f]));o[u]=d}for(let u=r+1;u<=s+1;++u)o[u]=new Fe(0,0,0);return o}function $H(n,t){let e=1;for(let s=2;s<=n;++s)e*=s;let i=1;for(let s=2;s<=t;++s)i*=s;for(let s=2;s<=n-t;++s)i*=s;return e/i}function eV(n){const t=n.length,e=[],i=[];for(let r=0;r<t;++r){const o=n[r];e[r]=new w(o.x,o.y,o.z),i[r]=o.w}const s=[];for(let r=0;r<t;++r){const o=e[r].clone();for(let a=1;a<=r;++a)o.sub(s[r-a].clone().multiplyScalar($H(r,a)*i[a]));s[r]=o.divideScalar(i[0])}return s}function tV(n,t,e,i,s){const r=ZH(n,t,e,i,s);return eV(r)}class iV extends SF{constructor(t,e,i,s,r){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new Fe(a.x,a.y,a.z,a.w)}}getPoint(t,e=new w){const i=e,s=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=KH(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(t,e=new w){const i=e,s=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),r=tV(this.degree,this.knots,this.controlPoints,s,1);return i.copy(r[1]).normalize(),i}}let nt,Li,Ns;class MO extends ch{constructor(t){super(t)}load(t,e,i,s){const r=this,o=r.path===""?ef.extractUrlBase(t):r.path,a=new Or(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(l){try{e(r.parse(l,o))}catch(h){s?s(h):console.error(h),r.manager.itemError(t)}},i,s)}parse(t,e){if(lV(t))nt=new aV().parse(t);else{const s=LO(t);if(!cV(s))throw new Error("THREE.FBXLoader: Unknown format.");if($T(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+$T(s));nt=new oV().parse(s)}const i=new Xa(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new nV(i,this.manager).parse(nt)}}class nV{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){Li=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),i=this.parseMaterials(e),s=this.parseDeformers(),r=new sV().parse(s);return this.parseScene(s,r,i),Ns}parseConnections(){const t=new Map;return"Connections"in nt&&nt.Connections.connections.forEach(function(i){const s=i[0],r=i[1],o=i[2];t.has(s)||t.set(s,{parents:[],children:[]});const a={ID:r,relationship:o};t.get(s).parents.push(a),t.has(r)||t.set(r,{parents:[],children:[]});const l={ID:s,relationship:o};t.get(r).children.push(l)}),t}parseImages(){const t={},e={};if("Video"in nt.Objects){const i=nt.Objects.Video;for(const s in i){const r=i[s],o=parseInt(s);if(t[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const h=this.parseImage(i[s]);e[r.RelativeFilename||r.Filename]=h}}}}for(const i in t){const s=t[i];e[s]!==void 0?t[i]=e[s]:t[i]=t[i].split("\\").pop()}return t}parseImage(t){const e=t.Content,i=t.RelativeFilename||t.Filename,s=i.slice(i.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof e=="string")return"data:"+r+";base64,"+e;{const o=new Uint8Array(e);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(t){const e=new Map;if("Texture"in nt.Objects){const i=nt.Objects.Texture;for(const s in i){const r=this.parseTexture(i[s],t);e.set(parseInt(s),r)}}return e}parseTexture(t,e){const i=this.loadTexture(t,e);i.ID=t.id,i.name=t.attrName;const s=t.WrapModeU,r=t.WrapModeV,o=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(i.wrapS=o===0?nc:qv,i.wrapT=a===0?nc:qv,"Scaling"in t){const l=t.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in t){const l=t.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(t,e){let i;const s=this.textureLoader.path,r=Li.get(t.id).children;r!==void 0&&r.length>0&&e[r[0].ID]!==void 0&&(i=e[r[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=t.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new At):(l.setPath(this.textureLoader.path),o=l.load(i))}else if(a==="dds"){const l=this.manager.getHandler(".dds");l===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",t.RelativeFilename),o=new At):(l.setPath(this.textureLoader.path),o=l.load(i))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new At):o=this.textureLoader.load(i);return this.textureLoader.setPath(s),o}parseMaterials(t){const e=new Map;if("Material"in nt.Objects){const i=nt.Objects.Material;for(const s in i){const r=this.parseMaterial(i[s],t);r!==null&&e.set(parseInt(s),r)}}return e}parseMaterial(t,e){const i=t.id,s=t.attrName;let r=t.ShadingModel;if(typeof r=="object"&&(r=r.value),!Li.has(i))return null;const o=this.parseParameters(t,e,i);let a;switch(r.toLowerCase()){case"phong":a=new Av;break;case"lambert":a=new EF;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new Av;break}return a.setValues(o),a.name=s,a}parseParameters(t,e,i){const s={};t.BumpFactor&&(s.bumpScale=t.BumpFactor.value),t.Diffuse?s.color=new be().fromArray(t.Diffuse.value).convertSRGBToLinear():t.DiffuseColor&&(t.DiffuseColor.type==="Color"||t.DiffuseColor.type==="ColorRGB")&&(s.color=new be().fromArray(t.DiffuseColor.value).convertSRGBToLinear()),t.DisplacementFactor&&(s.displacementScale=t.DisplacementFactor.value),t.Emissive?s.emissive=new be().fromArray(t.Emissive.value).convertSRGBToLinear():t.EmissiveColor&&(t.EmissiveColor.type==="Color"||t.EmissiveColor.type==="ColorRGB")&&(s.emissive=new be().fromArray(t.EmissiveColor.value).convertSRGBToLinear()),t.EmissiveFactor&&(s.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(s.opacity=parseFloat(t.Opacity.value)),s.opacity<1&&(s.transparent=!0),t.ReflectionFactor&&(s.reflectivity=t.ReflectionFactor.value),t.Shininess&&(s.shininess=t.Shininess.value),t.Specular?s.specular=new be().fromArray(t.Specular.value).convertSRGBToLinear():t.SpecularColor&&t.SpecularColor.type==="Color"&&(s.specular=new be().fromArray(t.SpecularColor.value).convertSRGBToLinear());const r=this;return Li.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(e,o.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(e,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(e,o.ID),s.map!==void 0&&(s.map.colorSpace=Ge);break;case"DisplacementColor":s.displacementMap=r.getTexture(e,o.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(e,o.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=Ge);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(e,o.ID);break;case"ReflectionColor":s.envMap=r.getTexture(e,o.ID),s.envMap!==void 0&&(s.envMap.mapping=Ya,s.envMap.colorSpace=Ge);break;case"SpecularColor":s.specularMap=r.getTexture(e,o.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=Ge);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(e,o.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(t,e){return"LayeredTexture"in nt.Objects&&e in nt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=Li.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in nt.Objects){const i=nt.Objects.Deformer;for(const s in i){const r=i[s],o=Li.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,t[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(o,i),a.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[s]=a}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const i=[];return t.children.forEach(function(s){const r=e[s.ID];if(r.attrType!=="Cluster")return;const o={ID:s.ID,indices:[],weights:[],transformLink:new ae().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(t,e){const i=[];for(let s=0;s<t.children.length;s++){const r=t.children[s],o=e[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=Li.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(t,e,i){Ns=new Lr;const s=this.parseModels(t.skeletons,e,i),r=nt.Objects.Model,o=this;s.forEach(function(l){var d;const h=r[l.ID];o.setLookAtProperties(l,h);const u=(d=Li.get(l.ID))==null?void 0:d.parents;u==null||u.forEach(function(f){const p=s.get(f.ID);p!==void 0&&p.add(l)}),l.parent===null&&Ns.add(l)}),this.bindSkeleton(t.skeletons,e,s),this.addGlobalSceneSettings(),Ns.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const h=DO(l.userData.transformData);l.applyMatrix4(h),l.updateWorldMatrix()}});const a=new rV().parse();Ns.children.length===1&&Ns.children[0].isGroup&&(Ns.children[0].animations=a,Ns=Ns.children[0]),Ns.animations=a}parseModels(t,e,i){const s=new Map,r=nt.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],h=Li.get(a);let u=this.buildSkeleton(h,t,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(h);break;case"Light":u=this.createLight(h);break;case"Mesh":u=this.createMesh(h,e,i);break;case"NurbsCurve":u=this.createCurve(h,e);break;case"LimbNode":case"Root":u=new Wv;break;case"Null":default:u=new Lr;break}u.name=l.attrName?Ur.sanitizeNodeName(l.attrName):"",u.userData.originalName=l.attrName,u.ID=a}this.getTransformData(u,l),s.set(a,u)}return s}buildSkeleton(t,e,i,s){let r=null;return t==null||t.parents.forEach(function(o){for(const a in e){const l=e[a];l.rawBones.forEach(function(h,u){if(h.ID===o.ID){const d=r;r=new Wv,r.matrixWorld.copy(h.transformLink),r.name=s?Ur.sanitizeNodeName(s):"",r.userData.originalName=s,r.ID=i,l.bones[u]=r,d!==null&&r.add(d)}})}}),r}createCamera(t){let e,i;if(t.children.forEach(function(s){const r=nt.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)e=new ne;else{let s=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(s=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,l=i.AspectHeight.value);const h=a/l;let u=45;i.FieldOfView!==void 0&&(u=i.FieldOfView.value);const d=i.FocalLength?i.FocalLength.value:null;switch(s){case 0:e=new bt(u,h,r,o),d!==null&&e.setFocalLength(d);break;case 1:e=new Mu(-a/2,a/2,l/2,-l/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),e=new ne;break}}return e}createLight(t){let e,i;if(t.children.forEach(function(s){const r=nt.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)e=new ne;else{let s;i.LightType===void 0?s=0:s=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=new be().fromArray(i.Color.value).convertSRGBToLinear());let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const l=1;switch(s){case 0:e=new Ng(r,o,a,l);break;case 1:e=new zg(r,o);break;case 2:let h=Math.PI/3;i.InnerAngle!==void 0&&(h=ct.degToRad(i.InnerAngle.value));let u=0;i.OuterAngle!==void 0&&(u=ct.degToRad(i.OuterAngle.value),u=Math.max(u,1)),e=new PC(r,o,a,h,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),e=new Ng(r,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(e.castShadow=!0)}return e}createMesh(t,e,i){let s,r=null,o=null;const a=[];return t.children.forEach(function(l){e.has(l.ID)&&(r=e.get(l.ID)),i.has(l.ID)&&a.push(i.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Av({name:ch.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(s=new Zo(r,o),s.normalizeSkinWeights()):s=new J(r,o),s}createCurve(t,e){const i=t.children.reduce(function(r,o){return e.has(o.ID)&&(r=e.get(o.ID)),r},null),s=new Jo({name:ch.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new ms(i,s)}getTransformData(t,e){const i={};"InheritType"in e&&(i.inheritType=parseInt(e.InheritType.value)),"RotationOrder"in e?i.eulerOrder=OO(e.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in e&&(i.translation=e.Lcl_Translation.value),"PreRotation"in e&&(i.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(i.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(i.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(i.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(i.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(i.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(i.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(i.rotationPivot=e.RotationPivot.value),t.userData.transformData=i}setLookAtProperties(t,e){"LookAtProperty"in e&&Li.get(t.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=nt.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;t.target!==void 0?(t.target.position.fromArray(o),Ns.add(t.target)):t.lookAt(new w().fromArray(o))}}})}bindSkeleton(t,e,i){const s=this.parsePoseNodes();for(const r in t){const o=t[r];Li.get(parseInt(o.ID)).parents.forEach(function(l){if(e.has(l.ID)){const h=l.ID;Li.get(h).parents.forEach(function(d){i.has(d.ID)&&i.get(d.ID).bind(new MC(o.bones),s[d.ID])})}})}}parsePoseNodes(){const t={};if("Pose"in nt.Objects){const e=nt.Objects.Pose;for(const i in e)if(e[i].attrType==="BindPose"&&e[i].NbPoseNodes>0){const s=e[i].PoseNode;Array.isArray(s)?s.forEach(function(r){t[r.Node]=new ae().fromArray(r.Matrix.a)}):t[s.Node]=new ae().fromArray(s.Matrix.a)}}return t}addGlobalSceneSettings(){if("GlobalSettings"in nt){if("AmbientColor"in nt.GlobalSettings){const t=nt.GlobalSettings.AmbientColor.value,e=t[0],i=t[1],s=t[2];if(e!==0||i!==0||s!==0){const r=new be(e,i,s).convertSRGBToLinear();Ns.add(new UP(r,1))}}"UnitScaleFactor"in nt.GlobalSettings&&(Ns.userData.unitScaleFactor=nt.GlobalSettings.UnitScaleFactor.value)}}}class sV{constructor(){this.negativeMaterialIndices=!1}parse(t){const e=new Map;if("Geometry"in nt.Objects){const i=nt.Objects.Geometry;for(const s in i){const r=Li.get(parseInt(s)),o=this.parseGeometry(r,i[s],t);e.set(parseInt(s),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),e}parseGeometry(t,e,i){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,i);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,i){const s=i.skeletons,r=[],o=t.parents.map(function(d){return nt.Objects.Model[d.ID]});if(o.length===0)return;const a=t.children.reduce(function(d,f){return s[f.ID]!==void 0&&(d=s[f.ID]),d},null);t.children.forEach(function(d){i.morphTargets[d.ID]!==void 0&&r.push(i.morphTargets[d.ID])});const l=o[0],h={};"RotationOrder"in l&&(h.eulerOrder=OO(l.RotationOrder.value)),"InheritType"in l&&(h.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(h.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(h.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(h.scale=l.GeometricScaling.value);const u=DO(h);return this.genGeometry(e,a,r,u)}genGeometry(t,e,i,s){const r=new Ht;t.attrName&&(r.name=t.attrName);const o=this.parseGeoNode(t,e),a=this.genBuffers(o),l=new cn(a.vertex,3);if(l.applyMatrix4(s),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new cn(a.colors,3)),e&&(r.setAttribute("skinIndex",new IF(a.weightsIndices,4)),r.setAttribute("skinWeight",new cn(a.vertexWeights,4)),r.FBX_Deformer=e),a.normal.length>0){const h=new za().getNormalMatrix(s),u=new cn(a.normal,3);u.applyNormalMatrix(h),r.setAttribute("normal",u)}if(a.uvs.forEach(function(h,u){const d=u===0?"uv":`uv${u}`;r.setAttribute(d,new cn(a.uvs[u],2))}),o.material&&o.material.mappingType!=="AllSame"){let h=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(d,f){d!==h&&(r.addGroup(u,f-u,h),h=d,u=f)}),r.groups.length>0){const d=r.groups[r.groups.length-1],f=d.start+d.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,h)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,t,i,s),r}parseGeoNode(t,e){const i={};if(i.vertexPositions=t.Vertices!==void 0?t.Vertices.a:[],i.vertexIndices=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(i.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(i.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(i.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){i.uv=[];let s=0;for(;t.LayerElementUV[s];)t.LayerElementUV[s].UV&&i.uv.push(this.parseUVs(t.LayerElementUV[s])),s++}return i.weightTable={},e!==null&&(i.skeleton=e,e.rawBones.forEach(function(s,r){s.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:r,weight:s.weights[a]})})})),i}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,s=0,r=!1,o=[],a=[],l=[],h=[],u=[],d=[];const f=this;return t.vertexIndices.forEach(function(p,g){let m,v=!1;p<0&&(p=p^-1,v=!0);let y=[],b=[];if(o.push(p*3,p*3+1,p*3+2),t.color){const _=DA(g,i,p,t.color);l.push(_[0],_[1],_[2])}if(t.skeleton){if(t.weightTable[p]!==void 0&&t.weightTable[p].forEach(function(_){b.push(_.weight),y.push(_.id)}),b.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const _=[0,0,0,0],x=[0,0,0,0];b.forEach(function(S,E){let M=S,I=y[E];x.forEach(function(B,R,P){if(M>B){P[R]=M,M=B;const F=_[R];_[R]=I,I=F}})}),y=_,b=x}for(;b.length<4;)b.push(0),y.push(0);for(let _=0;_<4;++_)u.push(b[_]),d.push(y[_])}if(t.normal){const _=DA(g,i,p,t.normal);a.push(_[0],_[1],_[2])}t.material&&t.material.mappingType!=="AllSame"&&(m=DA(g,i,p,t.material)[0],m<0&&(f.negativeMaterialIndices=!0,m=0)),t.uv&&t.uv.forEach(function(_,x){const S=DA(g,i,p,_);h[x]===void 0&&(h[x]=[]),h[x].push(S[0]),h[x].push(S[1])}),s++,v&&(f.genFace(e,t,o,m,a,l,h,u,d,s),i++,s=0,o=[],a=[],l=[],h=[],u=[],d=[])}),e}getNormalNewell(t){const e=new w(0,0,0);for(let i=0;i<t.length;i++){const s=t[i],r=t[(i+1)%t.length];e.x+=(s.y-r.y)*(s.z+r.z),e.y+=(s.z-r.z)*(s.x+r.x),e.z+=(s.x-r.x)*(s.y+r.y)}return e.normalize(),e}getNormalTangentAndBitangent(t){const e=this.getNormalNewell(t),s=(Math.abs(e.z)>.5?new w(0,1,0):new w(0,0,1)).cross(e).normalize(),r=e.clone().cross(s).normalize();return{normal:e,tangent:s,bitangent:r}}flattenVertex(t,e,i){return new oe(t.dot(e),t.dot(i))}genFace(t,e,i,s,r,o,a,l,h,u){let d;if(u>3){const f=[];for(let v=0;v<i.length;v+=3)f.push(new w(e.vertexPositions[i[v]],e.vertexPositions[i[v+1]],e.vertexPositions[i[v+2]]));const{tangent:p,bitangent:g}=this.getNormalTangentAndBitangent(f),m=[];for(const v of f)m.push(this.flattenVertex(v,p,g));d=TF.triangulateShape(m,[])}else d=[[0,1,2]];for(const[f,p,g]of d)t.vertex.push(e.vertexPositions[i[f*3]]),t.vertex.push(e.vertexPositions[i[f*3+1]]),t.vertex.push(e.vertexPositions[i[f*3+2]]),t.vertex.push(e.vertexPositions[i[p*3]]),t.vertex.push(e.vertexPositions[i[p*3+1]]),t.vertex.push(e.vertexPositions[i[p*3+2]]),t.vertex.push(e.vertexPositions[i[g*3]]),t.vertex.push(e.vertexPositions[i[g*3+1]]),t.vertex.push(e.vertexPositions[i[g*3+2]]),e.skeleton&&(t.vertexWeights.push(l[f*4]),t.vertexWeights.push(l[f*4+1]),t.vertexWeights.push(l[f*4+2]),t.vertexWeights.push(l[f*4+3]),t.vertexWeights.push(l[p*4]),t.vertexWeights.push(l[p*4+1]),t.vertexWeights.push(l[p*4+2]),t.vertexWeights.push(l[p*4+3]),t.vertexWeights.push(l[g*4]),t.vertexWeights.push(l[g*4+1]),t.vertexWeights.push(l[g*4+2]),t.vertexWeights.push(l[g*4+3]),t.weightsIndices.push(h[f*4]),t.weightsIndices.push(h[f*4+1]),t.weightsIndices.push(h[f*4+2]),t.weightsIndices.push(h[f*4+3]),t.weightsIndices.push(h[p*4]),t.weightsIndices.push(h[p*4+1]),t.weightsIndices.push(h[p*4+2]),t.weightsIndices.push(h[p*4+3]),t.weightsIndices.push(h[g*4]),t.weightsIndices.push(h[g*4+1]),t.weightsIndices.push(h[g*4+2]),t.weightsIndices.push(h[g*4+3])),e.color&&(t.colors.push(o[f*3]),t.colors.push(o[f*3+1]),t.colors.push(o[f*3+2]),t.colors.push(o[p*3]),t.colors.push(o[p*3+1]),t.colors.push(o[p*3+2]),t.colors.push(o[g*3]),t.colors.push(o[g*3+1]),t.colors.push(o[g*3+2])),e.material&&e.material.mappingType!=="AllSame"&&(t.materialIndex.push(s),t.materialIndex.push(s),t.materialIndex.push(s)),e.normal&&(t.normal.push(r[f*3]),t.normal.push(r[f*3+1]),t.normal.push(r[f*3+2]),t.normal.push(r[p*3]),t.normal.push(r[p*3+1]),t.normal.push(r[p*3+2]),t.normal.push(r[g*3]),t.normal.push(r[g*3+1]),t.normal.push(r[g*3+2])),e.uv&&e.uv.forEach(function(m,v){t.uvs[v]===void 0&&(t.uvs[v]=[]),t.uvs[v].push(a[v][f*2]),t.uvs[v].push(a[v][f*2+1]),t.uvs[v].push(a[v][p*2]),t.uvs[v].push(a[v][p*2+1]),t.uvs[v].push(a[v][g*2]),t.uvs[v].push(a[v][g*2+1])})}addMorphTargets(t,e,i,s){if(i.length===0)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const r=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const l=nt.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(t,e,l,s,a.name)})})}genMorphGeometry(t,e,i,s,r){const o=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],a=i.Vertices!==void 0?i.Vertices.a:[],l=i.Indexes!==void 0?i.Indexes.a:[],h=t.attributes.position.count*3,u=new Float32Array(h);for(let g=0;g<l.length;g++){const m=l[g]*3;u[m]=a[g*3],u[m+1]=a[g*3+1],u[m+2]=a[g*3+2]}const d={vertexIndices:o,vertexPositions:u},f=this.genBuffers(d),p=new cn(f.vertex,3);p.name=r||i.attrName,p.applyMatrix4(s),t.morphAttributes.position.push(p)}parseNormals(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,s=t.Normals.a;let r=[];return i==="IndexToDirect"&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:e,referenceType:i}}parseUVs(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,s=t.UV.a;let r=[];return i==="IndexToDirect"&&(r=t.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:e,referenceType:i}}parseVertexColors(t){if(!t.Colors)return;const e=t.MappingInformationType,i=t.ReferenceInformationType,s=t.Colors.a;let r=[];i==="IndexToDirect"&&(r=t.ColorIndex.a);for(let o=0,a=new be;o<s.length;o+=4)a.fromArray(s,o).convertSRGBToLinear().toArray(s,o);return{dataSize:4,buffer:s,indices:r,mappingType:e,referenceType:i}}parseMaterialIndices(t){const e=t.MappingInformationType,i=t.ReferenceInformationType;if(e==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const s=t.Materials.a,r=[];for(let o=0;o<s.length;++o)r.push(o);return{dataSize:1,buffer:s,indices:r,mappingType:e,referenceType:i}}parseNurbsGeometry(t){const e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new Ht;const i=e-1,s=t.KnotVector.a,r=[],o=t.Points.a;for(let d=0,f=o.length;d<f;d+=4)r.push(new Fe().fromArray(o,d));let a,l;if(t.Form==="Closed")r.push(r[0]);else if(t.Form==="Periodic"){a=i,l=s.length-1-a;for(let d=0;d<i;++d)r.push(r[d])}const u=new iV(i,s,r,a,l).getPoints(r.length*12);return new Ht().setFromPoints(u)}}class rV{parse(){const t=[],e=this.parseClips();if(e!==void 0)for(const i in e){const s=e[i],r=this.addClip(s);t.push(r)}return t}parseClips(){if(nt.Objects.AnimationCurve===void 0)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=nt.Objects.AnimationCurveNode,e=new Map;for(const i in t){const s=t[i];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};e.set(r.id,r)}}return e}parseAnimationCurves(t){const e=nt.Objects.AnimationCurve;for(const i in e){const s={id:e[i].id,times:e[i].KeyTime.a.map(hV),values:e[i].KeyValueFloat.a},r=Li.get(s.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?t.get(o).curves.x=s:a.match(/Y/)?t.get(o).curves.y=s:a.match(/Z/)?t.get(o).curves.z=s:a.match(/DeformPercent/)&&t.has(o)&&(t.get(o).curves.morph=s)}}}parseAnimationLayers(t){const e=nt.Objects.AnimationLayer,i=new Map;for(const s in e){const r=[],o=Li.get(parseInt(s));o!==void 0&&(o.children.forEach(function(l,h){if(t.has(l.ID)){const u=t.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(r[h]===void 0){const d=Li.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(d!==void 0){const f=nt.Objects.Model[d.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:f.attrName?Ur.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ns.traverse(function(g){g.ID===f.id&&(p.transform=g.matrix,g.userData.transformData&&(p.eulerOrder=g.userData.transformData.eulerOrder))}),p.transform||(p.transform=new ae),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[h]=p}}r[h]&&(r[h][u.attr]=u)}else if(u.curves.morph!==void 0){if(r[h]===void 0){const d=Li.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,f=Li.get(d).parents[0].ID,p=Li.get(f).parents[0].ID,g=Li.get(p).parents[0].ID,m=nt.Objects.Model[g],v={modelName:m.attrName?Ur.sanitizeNodeName(m.attrName):"",morphName:nt.Objects.Deformer[d].attrName};r[h]=v}r[h][u.attr]=u}}}),i.set(parseInt(s),r))}return i}parseAnimStacks(t){const e=nt.Objects.AnimationStack,i={};for(const s in e){const r=Li.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=t.get(r[0].ID);i[s]={name:e[s].attrName,layer:o}}return i}addClip(t){let e=[];const i=this;return t.layer.forEach(function(s){e=e.concat(i.generateTracks(s))}),new ql(t.name,-1,e)}generateTracks(t){const e=[];let i=new w,s=new w;if(t.transform&&t.transform.decompose(i,new ie,s),i=i.toArray(),s=s.toArray(),t.T!==void 0&&Object.keys(t.T.curves).length>0){const r=this.generateVectorTrack(t.modelName,t.T.curves,i,"position");r!==void 0&&e.push(r)}if(t.R!==void 0&&Object.keys(t.R.curves).length>0){const r=this.generateRotationTrack(t.modelName,t.R.curves,t.preRotation,t.postRotation,t.eulerOrder);r!==void 0&&e.push(r)}if(t.S!==void 0&&Object.keys(t.S.curves).length>0){const r=this.generateVectorTrack(t.modelName,t.S.curves,s,"scale");r!==void 0&&e.push(r)}if(t.DeformPercent!==void 0){const r=this.generateMorphTrack(t);r!==void 0&&e.push(r)}return e}generateVectorTrack(t,e,i,s){const r=this.getTimesForAllAxes(e),o=this.getKeyframeTrackValues(r,e,i);return new Yv(t+"."+s,r,o)}generateRotationTrack(t,e,i,s,r){let o,a;if(e.x===void 0||e.y===void 0||e.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(e.x===void 0?"x ":"")+(e.y===void 0?"y ":"")+(e.z===void 0?"z ":"")+" for animation of "+t+". This is currently not supported.");return}if(e.x!==void 0&&e.y!==void 0&&e.z!==void 0){const d=this.interpolateRotations(e.x,e.y,e.z,r);o=d[0],a=d[1]}i!==void 0&&(i=i.map(ct.degToRad),i.push(r),i=new jt().fromArray(i),i=new ie().setFromEuler(i)),s!==void 0&&(s=s.map(ct.degToRad),s.push(r),s=new jt().fromArray(s),s=new ie().setFromEuler(s).invert());const l=new ie,h=new jt,u=[];if(!(!a||!o)){for(let d=0;d<a.length;d+=3)h.set(a[d],a[d+1],a[d+2],r),l.setFromEuler(h),i!==void 0&&l.premultiply(i),s!==void 0&&l.multiply(s),d>2&&new ie().fromArray(u,(d-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(u,d/3*4);return new Kv(t+".quaternion",o,u)}}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,i=e.values.map(function(r){return r/100}),s=Ns.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new Uw(t.modelName+".morphTargetInfluences["+s+"]",e.times,i)}getTimesForAllAxes(t){let e=[];if(t.x!==void 0&&(e=e.concat(t.x.times)),t.y!==void 0&&(e=e.concat(t.y.times)),t.z!==void 0&&(e=e.concat(t.z.times)),e=e.sort(function(i,s){return i-s}),e.length>1){let i=1,s=e[0];for(let r=1;r<e.length;r++){const o=e[r];o!==s&&(e[i]=o,s=o,i++)}e=e.slice(0,i)}return e}getKeyframeTrackValues(t,e,i){const s=i,r=[];let o=-1,a=-1,l=-1;return t.forEach(function(h){if(e.x&&(o=e.x.times.indexOf(h)),e.y&&(a=e.y.times.indexOf(h)),e.z&&(l=e.z.times.indexOf(h)),o!==-1){const u=e.x.values[o];r.push(u),s[0]=u}else r.push(s[0]);if(a!==-1){const u=e.y.values[a];r.push(u),s[1]=u}else r.push(s[1]);if(l!==-1){const u=e.z.values[l];r.push(u),s[2]=u}else r.push(s[2])}),r}interpolateRotations(t,e,i,s){const r=[],o=[];r.push(t.times[0]),o.push(ct.degToRad(t.values[0])),o.push(ct.degToRad(e.values[0])),o.push(ct.degToRad(i.values[0]));for(let a=1;a<t.values.length;a++){const l=[t.values[a-1],e.values[a-1],i.values[a-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const h=l.map(ct.degToRad),u=[t.values[a],e.values[a],i.values[a]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const d=u.map(ct.degToRad),f=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],p=[Math.abs(f[0]),Math.abs(f[1]),Math.abs(f[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const m=Math.max(...p)/180,v=new jt(...h,s),y=new jt(...d,s),b=new ie().setFromEuler(v),_=new ie().setFromEuler(y);b.dot(_)&&_.set(-_.x,-_.y,-_.z,-_.w);const x=t.times[a-1],S=t.times[a]-x,E=new ie,M=new jt;for(let I=0;I<1;I+=1/m)E.copy(b.clone().slerp(_.clone(),I)),r.push(x+I*S),M.setFromQuaternion(E,s),o.push(M.x),o.push(M.y),o.push(M.z)}else r.push(t.times[a]),o.push(ct.degToRad(t.values[a])),o.push(ct.degToRad(e.values[a])),o.push(ct.degToRad(i.values[a]))}return[r,o]}}class oV{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new kO,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,i=t.split(/[\r\n]+/);return i.forEach(function(s,r){const o=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(o||a)return;const l=s.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),h=s.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=s.match("^\\t{"+(e.currentIndent-1)+"}}");l?e.parseNodeBegin(s,l):h?e.parseNodeProperty(s,h,i[++r]):u?e.popStack():s.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(t,e){const i=e[1].trim().replace(/^"/,"").replace(/"$/,""),s=e[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in a?(i==="PoseNode"?a.PoseNode.push(r):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=r)):typeof o.id=="number"?(a[i]={},a[i][o.id]=r):i!=="Properties70"&&(i==="PoseNode"?a[i]=[r]:a[i]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(t){let e=t[0];t[0]!==""&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let i="",s="";return t.length>1&&(i=t[1].replace(/^(\w+)::/,""),s=t[2]),{id:e,name:i,type:s}}parseNodeProperty(t,e,i){let s=e[1].replace(/^"/,"").replace(/"$/,"").trim(),r=e[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(t,s,r);return}if(s==="C"){const l=r.split(",").slice(1),h=parseInt(l[0]),u=parseInt(l[1]);let d=r.split(",").slice(3);d=d.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",r=[h,u],dV(r,d),o[s]===void 0&&(o[s]=[])}s==="Node"&&(o.id=r),s in o&&Array.isArray(o[s])?o[s].push(r):s!=="a"?o[s]=r:o.a=r,this.setCurrentProp(o,s),s==="a"&&r.slice(-1)!==","&&(o.a=U_(r))}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,t.slice(-1)!==","&&(e.a=U_(e.a))}parseNodeSpecialProperty(t,e,i){const s=i.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],o=s[1],a=s[2],l=s[3];let h=s[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=U_(h);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:h},this.setCurrentProp(this.getPrevNode(),r)}}class aV{parse(t){const e=new ZT(t);e.skip(23);const i=e.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const s=new kO;for(;!this.endOfContent(e);){const r=this.parseNode(e,i);r!==null&&s.add(r.name,r)}return s}endOfContent(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const i={},s=e>=7500?t.getUint64():t.getUint32(),r=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const o=t.getUint8(),a=t.getString(o);if(s===0)return null;const l=[];for(let f=0;f<r;f++)l.push(this.parseProperty(t));const h=l.length>0?l[0]:"",u=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(i.singleProperty=r===1&&t.getOffset()===s;s>t.getOffset();){const f=this.parseNode(t,e);f!==null&&this.parseSubNode(a,i,f)}return i.propertyList=l,typeof h=="number"&&(i.id=h),u!==""&&(i.attrName=u),d!==""&&(i.attrType=d),a!==""&&(i.name=a),i}parseSubNode(t,e,i){if(i.singleProperty===!0){const s=i.propertyList[0];Array.isArray(s)?(e[i.name]=i,i.a=s):e[i.name]=s}else if(t==="Connections"&&i.name==="C"){const s=[];i.propertyList.forEach(function(r,o){o!==0&&s.push(r)}),e.connections===void 0&&(e.connections=[]),e.connections.push(s)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){e[r]=i[r]});else if(t==="Properties70"&&i.name==="P"){let s=i.propertyList[0],r=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],e[s]={type:r,type2:o,flag:a,value:l}}else e[i.name]===void 0?typeof i.id=="number"?(e[i.name]={},e[i.name][i.id]=i):e[i.name]=i:i.name==="PoseNode"?(Array.isArray(e[i.name])||(e[i.name]=[e[i.name]]),e[i.name].push(i)):e[i.name][i.id]===void 0&&(e[i.name][i.id]=i)}parseProperty(t){const e=t.getString(1);let i;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return i=t.getUint32(),t.getArrayBuffer(i);case"S":return i=t.getUint32(),t.getString(i);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=t.getUint32(),r=t.getUint32(),o=t.getUint32();if(r===0)switch(e){case"b":case"c":return t.getBooleanArray(s);case"d":return t.getFloat64Array(s);case"f":return t.getFloat32Array(s);case"i":return t.getInt32Array(s);case"l":return t.getInt64Array(s)}const a=qp(new Uint8Array(t.getArrayBuffer(o))),l=new ZT(a.buffer);switch(e){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class ZT{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=e!==void 0?e:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(t){const e=[];for(let i=0;i<t;i++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),e&2147483648?(e=~e&4294967295,t=~t&4294967295,t===4294967295&&(e=e+1&4294967295),t=t+1&4294967295,-(e*4294967296+t)):e*4294967296+t}getInt64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),e*4294967296+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){const e=this.offset;let i=new Uint8Array(this.dv.buffer,e,t);this.skip(t);const s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,e,s)),this._textDecoder.decode(i)}}class kO{add(t,e){this[t]=e}}function lV(n){const t="Kaydara FBX Binary  \0";return n.byteLength>=t.length&&t===LO(n,0,t.length)}function cV(n){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let e=0;function i(s){const r=n[s-1];return n=n.slice(e+s),e++,r}for(let s=0;s<t.length;++s)if(i(1)===t[s])return!1;return!0}function $T(n){const t=/FBXVersion: (\d+)/,e=n.match(t);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function hV(n){return n/46186158e3}const uV=[];function DA(n,t,e,i){let s;switch(i.mappingType){case"ByPolygonVertex":s=n;break;case"ByPolygon":s=t;break;case"ByVertice":s=e;break;case"AllSame":s=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(s=i.indices[s]);const r=s*i.dataSize,o=r+i.dataSize;return fV(uV,i.buffer,r,o)}const F_=new jt,hd=new w;function DO(n){const t=new ae,e=new ae,i=new ae,s=new ae,r=new ae,o=new ae,a=new ae,l=new ae,h=new ae,u=new ae,d=new ae,f=new ae,p=n.inheritType?n.inheritType:0;if(n.translation&&t.setPosition(hd.fromArray(n.translation)),n.preRotation){const R=n.preRotation.map(ct.degToRad);R.push(n.eulerOrder||jt.DEFAULT_ORDER),e.makeRotationFromEuler(F_.fromArray(R))}if(n.rotation){const R=n.rotation.map(ct.degToRad);R.push(n.eulerOrder||jt.DEFAULT_ORDER),i.makeRotationFromEuler(F_.fromArray(R))}if(n.postRotation){const R=n.postRotation.map(ct.degToRad);R.push(n.eulerOrder||jt.DEFAULT_ORDER),s.makeRotationFromEuler(F_.fromArray(R)),s.invert()}n.scale&&r.scale(hd.fromArray(n.scale)),n.scalingOffset&&a.setPosition(hd.fromArray(n.scalingOffset)),n.scalingPivot&&o.setPosition(hd.fromArray(n.scalingPivot)),n.rotationOffset&&l.setPosition(hd.fromArray(n.rotationOffset)),n.rotationPivot&&h.setPosition(hd.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(d.copy(n.parentMatrix),u.copy(n.parentMatrixWorld));const g=e.clone().multiply(i).multiply(s),m=new ae;m.extractRotation(u);const v=new ae;v.copyPosition(u);const y=v.clone().invert().multiply(u),b=m.clone().invert().multiply(y),_=r,x=new ae;if(p===0)x.copy(m).multiply(g).multiply(b).multiply(_);else if(p===1)x.copy(m).multiply(b).multiply(g).multiply(_);else{const P=new ae().scale(new w().setFromMatrixScale(d)).clone().invert(),F=b.clone().multiply(P);x.copy(m).multiply(g).multiply(F).multiply(_)}const S=h.clone().invert(),E=o.clone().invert();let M=t.clone().multiply(l).multiply(h).multiply(e).multiply(i).multiply(s).multiply(S).multiply(a).multiply(o).multiply(r).multiply(E);const I=new ae().copyPosition(M),B=u.clone().multiply(I);return f.copyPosition(B),M=f.clone().multiply(x),M.premultiply(u.invert()),M}function OO(n){n=n||0;const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[n]}function U_(n){return n.split(",").map(function(e){return parseFloat(e)})}function LO(n,t,e){return t===void 0&&(t=0),e===void 0&&(e=n.byteLength),new TextDecoder().decode(new Uint8Array(n,t,e))}function dV(n,t){for(let e=0,i=n.length,s=t.length;e<s;e++,i++)n[i]=t[e]}function fV(n,t,e,i){for(let s=e,r=0;s<i;s++,r++)n[r]=t[s];return n}const pV=/^[og]\s*(.+)?/,gV=/^mtllib /,mV=/^usemtl /,AV=/^usemap /,eR=/\s+/,tR=new w,N_=new w,iR=new w,nR=new w,Jr=new w,OA=new be;function vV(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=e!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:e!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const h={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return h.clone=this.clone.bind(h),h}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),s&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},i&&i.name&&typeof i.clone=="function"){const s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/3)*3},parseNormalIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/3)*3},parseUVIndex:function(t,e){const i=parseInt(t,10);return(i>=0?i-1:i+e/2)*2},addVertex:function(t,e,i){const s=this.vertices,r=this.object.geometry.vertices;r.push(s[t+0],s[t+1],s[t+2]),r.push(s[e+0],s[e+1],s[e+2]),r.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,i){const s=this.normals,r=this.object.geometry.normals;r.push(s[t+0],s[t+1],s[t+2]),r.push(s[e+0],s[e+1],s[e+2]),r.push(s[i+0],s[i+1],s[i+2])},addFaceNormal:function(t,e,i){const s=this.vertices,r=this.object.geometry.normals;tR.fromArray(s,t),N_.fromArray(s,e),iR.fromArray(s,i),Jr.subVectors(iR,N_),nR.subVectors(tR,N_),Jr.cross(nR),Jr.normalize(),r.push(Jr.x,Jr.y,Jr.z),r.push(Jr.x,Jr.y,Jr.z),r.push(Jr.x,Jr.y,Jr.z)},addColor:function(t,e,i){const s=this.colors,r=this.object.geometry.colors;s[t]!==void 0&&r.push(s[t+0],s[t+1],s[t+2]),s[e]!==void 0&&r.push(s[e+0],s[e+1],s[e+2]),s[i]!==void 0&&r.push(s[i+0],s[i+1],s[i+2])},addUV:function(t,e,i){const s=this.uvs,r=this.object.geometry.uvs;r.push(s[t+0],s[t+1]),r.push(s[e+0],s[e+1]),r.push(s[i+0],s[i+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,i,s,r,o,a,l,h){const u=this.vertices.length;let d=this.parseVertexIndex(t,u),f=this.parseVertexIndex(e,u),p=this.parseVertexIndex(i,u);if(this.addVertex(d,f,p),this.addColor(d,f,p),a!==void 0&&a!==""){const g=this.normals.length;d=this.parseNormalIndex(a,g),f=this.parseNormalIndex(l,g),p=this.parseNormalIndex(h,g),this.addNormal(d,f,p)}else this.addFaceNormal(d,f,p);if(s!==void 0&&s!==""){const g=this.uvs.length;d=this.parseUVIndex(s,g),f=this.parseUVIndex(r,g),p=this.parseUVIndex(o,g),this.addUV(d,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let i=0,s=t.length;i<s;i++){const r=this.parseVertexIndex(t[i],e);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const i=this.vertices.length,s=this.uvs.length;for(let r=0,o=t.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(t[r],i));for(let r=0,o=e.length;r<o;r++)this.addUVLine(this.parseUVIndex(e[r],s))}};return n.startObject("",!1),n}class XS extends ch{constructor(t){super(t),this.materials=null}load(t,e,i,s){const r=this,o=new Or(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(a){try{e(r.parse(a))}catch(l){s?s(l):console.error(l),r.manager.itemError(t)}},i,s)}setMaterials(t){return this.materials=t,this}parse(t){const e=new vV;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));const i=t.split(`
`);let s=[];for(let a=0,l=i.length;a<l;a++){const h=i[a].trimStart();if(h.length===0)continue;const u=h.charAt(0);if(u!=="#")if(u==="v"){const d=h.split(eR);switch(d[0]){case"v":e.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),d.length>=7?(OA.setRGB(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6])).convertSRGBToLinear(),e.colors.push(OA.r,OA.g,OA.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":e.uvs.push(parseFloat(d[1]),parseFloat(d[2]));break}}else if(u==="f"){const f=h.slice(1).trim().split(eR),p=[];for(let m=0,v=f.length;m<v;m++){const y=f[m];if(y.length>0){const b=y.split("/");p.push(b)}}const g=p[0];for(let m=1,v=p.length-1;m<v;m++){const y=p[m],b=p[m+1];e.addFace(g[0],y[0],b[0],g[1],y[1],b[1],g[2],y[2],b[2])}}else if(u==="l"){const d=h.substring(1).trim().split(" ");let f=[];const p=[];if(h.indexOf("/")===-1)f=d;else for(let g=0,m=d.length;g<m;g++){const v=d[g].split("/");v[0]!==""&&f.push(v[0]),v[1]!==""&&p.push(v[1])}e.addLineGeometry(f,p)}else if(u==="p"){const f=h.slice(1).trim().split(" ");e.addPointGeometry(f)}else if((s=pV.exec(h))!==null){const d=(" "+s[0].slice(1).trim()).slice(1);e.startObject(d)}else if(mV.test(h))e.object.startMaterial(h.substring(7).trim(),e.materialLibraries);else if(gV.test(h))e.materialLibraries.push(h.substring(7).trim());else if(AV.test(h))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(u==="s"){if(s=h.split(" "),s.length>1){const f=s[1].trim().toLowerCase();e.object.smooth=f!=="0"&&f!=="off"}else e.object.smooth=!0;const d=e.object.currentMaterial();d&&(d.smooth=e.object.smooth)}else{if(h==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+h+'"')}}e.finalize();const r=new Lr;if(r.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=e.objects.length;a<l;a++){const h=e.objects[a],u=h.geometry,d=h.materials,f=u.type==="Line",p=u.type==="Points";let g=!1;if(u.vertices.length===0)continue;const m=new Ht;m.setAttribute("position",new cn(u.vertices,3)),u.normals.length>0&&m.setAttribute("normal",new cn(u.normals,3)),u.colors.length>0&&(g=!0,m.setAttribute("color",new cn(u.colors,3))),u.hasUVIndices===!0&&m.setAttribute("uv",new cn(u.uvs,2));const v=[];for(let b=0,_=d.length;b<_;b++){const x=d[b],S=x.name+"_"+x.smooth+"_"+g;let E=e.materials[S];if(this.materials!==null){if(E=this.materials.create(x.name),f&&E&&!(E instanceof Jo)){const M=new Jo;mt.prototype.copy.call(M,E),M.color.copy(E.color),E=M}else if(p&&E&&!(E instanceof Up)){const M=new Up({size:10,sizeAttenuation:!1});mt.prototype.copy.call(M,E),M.color.copy(E.color),M.map=E.map,E=M}}E===void 0&&(f?E=new Jo:p?E=new Up({size:1,sizeAttenuation:!1}):E=new Av,E.name=x.name,E.flatShading=!x.smooth,E.vertexColors=g,e.materials[S]=E),v.push(E)}let y;if(v.length>1){for(let b=0,_=d.length;b<_;b++){const x=d[b];m.addGroup(x.groupStart,x.groupCount,b)}f?y=new xf(m,v):p?y=new mv(m,v):y=new J(m,v)}else f?y=new xf(m,v[0]):p?y=new mv(m,v[0]):y=new J(m,v[0]);y.name=h.name,r.add(y)}else if(e.vertices.length>0){const a=new Up({size:1,sizeAttenuation:!1}),l=new Ht;l.setAttribute("position",new cn(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(l.setAttribute("color",new cn(e.colors,3)),a.vertexColors=!0);const h=new mv(l,a);r.add(h)}return r}}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(t,e){c(this,"canvas");return this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.canvas.convertToBlob=(i,s)=>new Promise(r=>{this.canvas.toBlob(r,i,s)}),this.canvas}});const yV=z("debugprogress");function bV(n){n=n||new Date;const t=n.getMonth()+1,e=n.getDate(),i=n.getHours(),s=n.getMinutes(),r=n.getSeconds(),o=(t<10?"0":"")+t,a=(e<10?"0":"")+e,l=(i<10?"0":"")+i,h=(s<10?"0":"")+s,u=(r<10?"0":"")+r;return n.getFullYear()+o+a+"-"+l+h+u}class at{static start(t,e){typeof e=="string"&&(e={parentScope:e});const i=new _V(t,e);Yp.set(t,i)}static report(t,e){const i=Yp.get(t);if(!i){console.warn("Reporting progress for non-existing scope",t);return}typeof e=="string"&&(e={message:e,autoStep:!0}),i.report(e)}static end(t){const e=Yp.get(t);e&&(e.end(),Yp.delete(t))}}const Yp=new Map;class _V{constructor(t,e){c(this,"scopeLabel");c(this,"parentScope");c(this,"childScopes",[]);c(this,"parentDepth",0);c(this,"lastStep",0);c(this,"lastAutoStepWeight",1);c(this,"lastTotalSteps",0);c(this,"onProgress");c(this,"showLogs",!1);c(this,"selfProgress",0);c(this,"totalProgress",0);c(this,"selfReports",0);c(this,"totalReports",0);this.parentScope=e!=null&&e.parentScope?Yp.get(e.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+t,this.showLogs=(e==null?void 0:e.logTimings)??!!yV,this.showLogs&&console.time(this.scopeLabel),this.onProgress=e==null?void 0:e.onProgress}report(t,e=!1){if(t){if(t.totalSteps!==void 0&&(this.lastTotalSteps=t.totalSteps),t.currentStep!==void 0&&(this.lastStep=t.currentStep),t.autoStep!==void 0){if(t.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const s=typeof t.autoStep=="number"?t.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=s,t.currentStep=this.lastStep}t.totalSteps=this.lastTotalSteps}t.progress!==void 0?this.selfProgress=t.progress:t.currentStep!==void 0&&t.totalSteps!==void 0&&(this.selfProgress=t.currentStep/t.totalSteps)}if(this.childScopes.length>0){let s=0,r=0;for(const a of this.childScopes)s+=a.selfProgress,r+=1;r>0&&(s/=r);const o=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+s*o}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let i=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(i+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),t!=null&&t.message&&(i=t.message+" â€“ "+i),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(i="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?"â€“"+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+i),e?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,i),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let t=!1;for(const e of this.childScopes)if(!(e.selfProgress>=1)){t=!0;break}t&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function ol(n){return n=n.replace(/[^a-zA-Z0-9_]/g,""),n.match(/^[a-zA-Z_]/)||(n="_"+n),n}function FO(n){if(n.length===0)return null;const t=n.map(i=>{const s=new Array;for(;i.parent;)s.unshift(i.parent),i=i.parent;return s});return t[0].findLast(i=>t.every(s=>s.includes(i)))||null}function UO(n){const t=FO(n),e=new Set;for(const i of n){let s=i.parent;for(;s&&s!==t;)n.includes(s)||e.add(s),s=s.parent}return e}const wV=new w,xV=new ie,CV=new w(1,1,1),eu=class{constructor(t,e,i=null,s=null,r=null,o=null,a=null,l=null){c(this,"uuid");c(this,"name");c(this,"type");c(this,"extraSchemas",[]);c(this,"displayName");c(this,"visibility");c(this,"transform",null);c(this,"_isDynamic");c(this,"geometry");c(this,"material");c(this,"camera");c(this,"parent");c(this,"skinnedMesh");c(this,"children",[]);c(this,"animations");c(this,"_eventListeners");c(this,"needsTranslate",!1);c(this,"needsOrient",!1);c(this,"needsScale",!1);var h,u,d;this.uuid=t,this.name=ol(e),this.displayName=e,i?this.transform={position:((h=i.position)==null?void 0:h.clone())||null,quaternion:((u=i.quaternion)==null?void 0:u.clone())||null,scale:((d=i.scale)==null?void 0:d.clone())||null}:this.transform=null,this.geometry=s,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=l}getMatrix(){if(!this.transform)return new ae;const{position:t,quaternion:e,scale:i}=this.transform,s=new ae;return s.compose(t||wV,e||xV,i||CV),s}setMatrix(t){if(!t||!(t instanceof ae)){this.transform=null;return}const e=new w,i=new ie,s=new w;t.decompose(e,i,s),this.transform={position:e,quaternion:i,scale:s}}get matrix(){return this.getMatrix()}set matrix(t){this.setMatrix(t)}get isDynamic(){return this._isDynamic}set isDynamic(t){this._isDynamic=t}static createEmptyParent(t){const e=new eu(ct.generateUUID(),t.name+"_empty_"+eu.USDObject_export_id++,t.transform),i=t.parent;return i&&i.add(e),e.add(t),e.isDynamic=!0,t.transform=null,e}static createEmpty(){const t=new eu(ct.generateUUID(),"Empty_"+eu.USDObject_export_id++);return t.isDynamic=!0,t}is(t){return t?this.uuid===t.uuid:!1}isEmpty(){return!this.geometry}clone(){const t=new eu(ct.generateUUID(),this.name,this.transform,this.geometry,this.material);return t.isDynamic=this.isDynamic,t}deepClone(){const t=this.clone();for(const e of this.children)e&&t.add(e.deepClone());return t}getPath(){let t=this.parent,e=this.name;for(;t;)e=(t.parent?t.name:t.name+"/Scenes/Scene")+"/"+e,t=t.parent;return"</"+e+">"}add(t){t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)}remove(t){const e=this.children.indexOf(t);e>=0&&(t.parent===this&&(t.parent=null),this.children.splice(e,1))}addEventListener(t,e){this._eventListeners[t]||(this._eventListeners[t]=[]),this._eventListeners[t].push(e)}removeEventListener(t,e){if(!this._eventListeners[t])return;const i=this._eventListeners[t].indexOf(e);i>=0&&this._eventListeners[t].splice(i,1)}onSerialize(t,e){const i=this._eventListeners.serialize;i&&i.forEach(s=>s(t,e))}};let _s=eu;c(_s,"USDObject_export_id",0);class NO extends _s{constructor(){super(void 0,"StageRoot",null,null,null,null);c(this,"stageLength");this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(e){e.parent=this,this.children.push(e)}remove(e){const i=this.children.indexOf(e);i>=0&&(e.parent===this&&(e.parent=null),this.children.splice(i,1))}traverse(e,i=null){if(i!==null?e(i):i=this,i.children)for(const s of i.children)this.traverse(e,s)}findById(e){let i=!1;function s(r){if(!i){if(r.uuid===e)return i=!0,r;if(r.children)for(const o of r.children){if(!o)continue;const a=s(o);if(a)return a}}}return s(this)}buildHeader(e){var a,l;const i=(a=e.extensions)==null?void 0:a.find(h=>(h==null?void 0:h.extensionName)==="animation"),s=(l=e.extensions)==null?void 0:l.find(h=>(h==null?void 0:h.extensionName)==="Behaviour"),r=(i==null?void 0:i.getStartTimeCode())??0,o=(i==null?void 0:i.getEndTimeCode())??0;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${Xo}"
		dictionary Needle = {
			bool animations = ${i?1:0}
			bool interactive = ${s?1:0}
			bool quickLookCompatible = ${e.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${ol(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${r}
	endTimeCode = ${o}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${Xo}"""
)
`}}const ud=`
`,ir="</StageRoot/Materials";class SV{constructor(){c(this,"str");c(this,"indent");this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(t=void 0,e="{",i=!0){t!==void 0?(t=this.applyIndent(t),this.str+=t,i?(this.str+=ud,this.str+=this.applyIndent(e)):this.str+=" "+e):this.str+=this.applyIndent(e),this.str+=ud,this.indent+=1}closeBlock(t="}"){this.indent-=1,this.str+=this.applyIndent(t)+ud}beginArray(t){t=this.applyIndent(t+" = ["),this.str+=t,this.str+=ud,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+ud}appendLine(t=""){t=this.applyIndent(t),this.str+=t,this.str+=ud}toString(){return this.str}applyIndent(t){let e="";for(let i=0;i<this.indent;i++)e+="	";return e+t}}class EV{constructor(t,e,i){c(this,"root");c(this,"exporter");c(this,"extensions",[]);c(this,"quickLookCompatible");c(this,"exportInvisible");c(this,"materials");c(this,"textures");c(this,"files");c(this,"document");c(this,"output");c(this,"animations");this.root=t,this.exporter=e,this.quickLookCompatible=i.quickLookCompatible,this.exportInvisible=i.exportInvisible,i.extensions&&(this.extensions=i.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new NO,this.output="",this.animations=[]}}class z_{constructor(){c(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}});c(this,"quickLookCompatible",!1);c(this,"extensions",[]);c(this,"maxTextureSize",4096);c(this,"exportInvisible",!1)}}let IV=class{constructor(){c(this,"debug");c(this,"pruneUnusedNodes");c(this,"sceneAnchoringOptions",new z_);c(this,"extensions",[]);c(this,"keepObject");this.debug=!1,this.pruneUnusedNodes=!0}async parse(t,e=new z_){e=Object.assign(new z_,e),this.sceneAnchoringOptions=e;const i=new EV(t,this,e);this.extensions=i.extensions;const s=i.files,r="model.usda";s[r]=null;const o=i.materials,a=i.textures;at.report("export-usdz","Invoking onBeforeBuildDocument"),await Uv(i,"onBeforeBuildDocument"),at.report("export-usdz","Done onBeforeBuildDocument"),at.report("export-usdz","Reparent bones to common ancestor");const l=[],h=new Set;t==null||t.traverse(b=>{if(!(!e.exportInvisible&&!b.visible)&&b instanceof Zo){const _=b.skeleton.bones,x=FO(_);if(x){const S={object:b,originalParent:b.parent,newParent:x};l.push(S),h.add(S.object.uuid),S.newParent&&h.add(S.newParent.uuid),S.originalParent&&h.add(S.originalParent.uuid)}}});for(const b of l){const{object:_,originalParent:x,newParent:S}=b;S.add(_)}at.report("export-usdz","Traversing hierarchy"),t&&zO(t,i.document,i,this.keepObject),at.report("export-usdz","Invoking onAfterBuildDocument"),await Uv(i,"onAfterBuildDocument");const u=i.extensions.find(b=>b.extensionName==="Behaviour"),d=(u==null?void 0:u.getAllTargetUuids())??new Set;if(this.pruneUnusedNodes){const b={allBehaviorTargets:d,debug:!1,boneReparentings:h};this.debug&&sR(i.document,"Hierarchy BEFORE pruning",b),QO(i.document,b),this.debug&&sR(i.document,"Hierarchy AFTER pruning")}else this.debug&&console.log("Pruning of empty nodes is disabled. This may result in a larger USDZ file.");at.report("export-usdz",{message:"Parsing document",autoStep:10}),await TV(i,()=>(at.report("export-usdz","Building materials"),UV(o,a,e.quickLookCompatible))),at.report("export-usdz","Invoking onAfterSerialize"),await Uv(i,"onAfterSerialize");for(const b of l){const{object:_,originalParent:x,newParent:S}=b;x&&x.add(_)}const p=i.document.buildHeader(i)+`
`+i.output;this.debug&&console.log(p),s[r]=fy(p),i.output="",at.report("export-usdz",{message:"Exporting textures",autoStep:10}),at.start("export-usdz-textures","export-usdz");const g=new Pu({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),m=Object.keys(a).length;at.report("export-usdz-textures",{totalSteps:m*3,currentStep:0});const v=async b=>{const _=a[b],x=_.texture,S=VO.includes(x.format);let E={imageData:x.image};at.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const M=_.scale!==void 0&&_.scale.x!==1&&_.scale.y!==1&&_.scale.z!==1&&_.scale.w!==1;(x.isCompressedTexture||x.isRenderTargetTexture||M)&&(E=await RV(x,e.maxTextureSize,g,_.scale)),at.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const I=await PV(E.imageBitmap||E.imageData,e.maxTextureSize).catch(B=>{console.error("Error converting texture to canvas",x,B)});if(I){at.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const B=await I.convertToBlob({type:S?"image/png":"image/jpeg",quality:.95});s[`textures/${b}.${S?"png":"jpg"}`]=new Uint8Array(await B.arrayBuffer())}else console.warn("Can`t export texture: ",x)};for(const b in a)await v(b);g.dispose(),at.end("export-usdz-textures");let y=0;for(const b in s){const _=s[b],x=34+b.length;y+=x;const S=y&63;if(S!==4){const E=64-S,M=new Uint8Array(E);s[b]=[_,{extra:{12345:M}}]}y=_.length}return at.report("export-usdz","zip archive"),dH(s,{level:0})}};function zO(n,t,e,i){if(!e.exportInvisible&&!n.visible)return;let s,r,o;const a={position:n.position,quaternion:n.quaternion,scale:n.scale};if(n.position.x===0&&n.position.y===0&&n.position.z===0&&(a.position=null),n.quaternion.x===0&&n.quaternion.y===0&&n.quaternion.z===0&&n.quaternion.w===1&&(a.quaternion=null),n.scale.x===1&&n.scale.y===1&&n.scale.z===1&&(a.scale=null),(n instanceof J||n instanceof Zo)&&(r=n.geometry,o=n.material),i&&!i(n)&&(r=void 0,o=void 0),(n instanceof J||n instanceof Zo)&&o&&(o instanceof Kn||o instanceof _t||o instanceof mt&&o.type==="MeshLineMaterial")){const l=UA(n),h=n instanceof Zo?n:null;s=new _s(n.uuid,l,a,r,o,void 0,h,n.animations)}else if(n instanceof bt||n instanceof Mu){const l=UA(n);s=new _s(n.uuid,l,a,void 0,void 0,n)}else{const l=UA(n);s=new _s(n.uuid,l,a,void 0,void 0,void 0,void 0,n.animations)}if(s){if(s.displayName=n.name,s.visibility=n.visible?void 0:"invisible",t&&t.add(s),t=s,e.extensions)for(const l of e.extensions)l.onExportObject&&l.onExportObject.call(l,n,s,e)}else{const l=UA(n),h=new _s(n.uuid,l,{position:n.position,quaternion:n.quaternion,scale:n.scale});t&&t.add(h),t=h}for(const l of n.children)zO(l,t,e,i)}function sR(n,t,...e){const i={};let s=0;function r(o,a){s++;let l=o.displayName||o.name;l+=" ("+o.uuid+")",(o.geometry||o.material||o.camera||o.skinnedMesh)&&(l+=" ("+(o.geometry?"geo, ":"")+(o.material?"mat, ":"")+(o.camera?"cam, ":"")+(o.skinnedMesh?"skin, ":"")+")"),a[l]={};const u={object:o};o.material&&(u.mat=!0),o.geometry&&(u.geo=!0),o.camera&&(u.cam=!0),o.skinnedMesh&&(u.skin=!0),a[l]._self=u;for(const d of o.children)d&&r(d,a[l])}r(n,i),console.log(t+" ("+s+" nodes)",i,...e)}function QO(n,t){var h;let e=!0;const i=new Array,s=new Array;if(n.children.length===0)e=!0;else{const u=[...n.children];for(const d of u)if(d){const f=QO(d,t);t.debug&&(f?i.push(d):s.push(d)),e=e&&f}}const r=t.allBehaviorTargets.has(n.uuid),o=n.geometry||n.material||n.camera||n.skinnedMesh||!1,a=t.boneReparentings.has(n.uuid),l=e&&!r&&!o&&!a;return l?(t.debug&&console.log("Pruned object:",(n.displayName||n.name)+" ("+n.uuid+")",{isVisible:o,isBehaviorSourceOrTarget:r,allChildsWerePruned:e,isBoneReparenting:a,object:n,prunedChilds:i,keptChilds:s}),(h=n.parent)==null||h.remove(n)):t.debug&&console.log("Kept object:",(n.displayName||n.name)+" ("+n.uuid+")",{isVisible:o,isBehaviorSourceOrTarget:r,allChildsWerePruned:e,isBoneReparenting:a,object:n,prunedChilds:i,keptChilds:s}),l}async function TV(n,t){at.start("export-usdz-resources","export-usdz");const e=[];for(const l of n.document.children)jO(l,n,e);const i=e.length;for(let l=0;l<i;l++)at.report("export-usdz-resources",{totalSteps:i,currentStep:l}),await new Promise((h,u)=>{e[l](),h()});at.end("export-usdz-resources");const s=new SV,r=n.exporter.sceneAnchoringOptions.ar;s.beginBlock(`def Xform "${n.document.name}"`),s.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),s.beginBlock('def Xform "Scene"',"(",!1),s.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),s.appendLine("customData = {"),s.appendLine("	bool preliminary_collidesWithEnvironment = 0"),s.appendLine('	string sceneName = "Scene"'),s.appendLine("}"),s.appendLine('sceneName = "Scene"'),s.closeBlock(")"),s.beginBlock(),s.appendLine(`token preliminary:anchoring:type = "${r.anchoring.type}"`),r.anchoring.type==="plane"&&s.appendLine(`token preliminary:planeAnchoring:alignment = "${r.planeAnchoring.alignment}"`),r.anchoring.type==="image"&&s.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${n.document.name}/Scenes/Scene/AnchoringReferenceImage>`),s.appendLine();const o=l=>{if(!l)return 0;let h=1;for(const u of l.children)h+=o(u);return h},a=o(n.document);at.start("export-usdz-xforms","export-usdz"),at.report("export-usdz-xforms",{totalSteps:a,currentStep:1});for(const l of n.document.children)GO(l,s,n);at.end("export-usdz-xforms"),at.report("export-usdz","invoke onAfterHierarchy"),Uv(n,"onAfterHierarchy",s),s.closeBlock(),s.closeBlock(),s.appendLine(t()),s.closeBlock(),at.report("export-usdz","write to string"),n.output+=s.toString()}function jO(n,t,e){if(!n)return;const i=n.geometry,s=n.material;if(i)if(s&&("isMeshStandardMaterial"in s&&s.isMeshStandardMaterial||"isMeshBasicMaterial"in s&&s.isMeshBasicMaterial||s.type==="MeshLineMaterial")){const r="geometries/"+jx(i,n.name)+".usda";if(!(r in t.files)){const o=()=>{var l,h;const a=OV(i,(h=(l=n.skinnedMesh)==null?void 0:l.skeleton)==null?void 0:h.bones,t.quickLookCompatible);t.files[r]=DV(a)};e.push(o)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",name);s&&(s.uuid in t.materials||(t.materials[s.uuid]=s));for(const r of n.children)jO(r,t,e)}async function Uv(n,t,e=null){if(n.extensions){for(const i of n.extensions)if(i&&typeof i[t]=="function"){const r=i[t].call(i,n,e);r instanceof Promise&&await r}}}let LA=null,Ls=null,Q_,dd,FA;async function RV(n,t=1/0,e=null,i=void 0){Q_||(Q_=new pr(2,2,1,1)),dd||(dd=new $e({uniforms:{blitTexture:new $(n),flipY:new $(!1),scale:new $(new Fe(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const s=dd.uniforms;s.blitTexture.value=n,s.flipY.value=!1,s.scale.value=new Fe(1,1,1,1),i!==void 0&&s.scale.value.copy(i),dd.defines.IS_SRGB=n.colorSpace==Ge,dd.needsUpdate=!0,FA||(FA=new J(Q_,dd),FA.frustumCulled=!1);const r=new bt,o=new ws;o.add(FA),e||(e=LA=new Pu({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const a=Math.min(n.image.width,t),l=Math.min(n.image.height,t);Ls&&(Ls.width!==a||Ls.height!==l)&&(Ls.dispose(),Ls=null),Ls||(Ls=new Et(a,l,{format:Wi,type:gi,minFilter:Mt,magFilter:Mt})),e.setRenderTarget(Ls),e.setSize(a,l),e.clear(),e.render(o,r),LA&&(LA.dispose(),LA=null);const h=new Uint8ClampedArray(Ls.width*Ls.height*4);e.readRenderTargetPixels(Ls,0,0,Ls.width,Ls.height,h);const u=new ImageData(h,Ls.width,Ls.height,void 0),d=await createImageBitmap(u,{premultiplyAlpha:"none"});return{imageData:u,imageBitmap:d}}function BV(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}async function PV(n,t=4096){const e=t/Math.max(n.width,n.height),i=n.width*Math.min(1,e),s=n.height*Math.min(1,e),r=new OffscreenCanvas(i,s),o={premultiplyAlpha:"none"};n.width!==i&&(o.resizeWidth=i),n.height!==s&&(o.resizeHeight=s);const a=await createImageBitmap(n,o),l=r.getContext("bitmaprenderer");return l&&l.transferFromImageBitmap(a),r}async function MV(n,t=void 0,e=!1,i=4096){if(BV(n)){const s=i/Math.max(n.width,n.height),r=new OffscreenCanvas(n.width*Math.min(1,s),n.height*Math.min(1,s)),o=r.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!o)throw new Error("Could not get canvas 2D context");if(e===!0&&(o.translate(0,r.height),o.scale(1,-1)),o.drawImage(n,0,0,r.width,r.height),t!==void 0){const a=t.x,l=t.y,h=t.z,u=t.w,d=o.getImageData(0,0,r.width,r.height),f=d.data;for(let p=0;p<f.length;p+=4)f[p+0]=f[p+0]*a,f[p+1]=f[p+1]*l,f[p+2]=f[p+2]*h,f[p+3]=f[p+3]*u;o.putImageData(d,0,0)}return r}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const si=7;function kV(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function DV(n,t){let e=kV();return e+=n,fy(e)}function UA(n){return n.name.replace(/[-<>\(\)\[\]Â§$%&\/\\\=\?\,\;]/g,"")+"_"+n.id}function rR(n){return ol(n.name||"bone_"+n.uuid)}function jx(n,t){return ol(n.name||"Geometry")+"_"+n.id}function YS(n){return ol(n.name||"Material")+"_"+n.id}function df(n,t){let e=rR(n),i=n.parent;for(;i&&i!==t;)e=rR(i)+"/"+e,i=i.parent;return e}function GO(n,t,e){var f;if(n==null)return;at.report("export-usdz-xforms",{message:"buildXform "+n.displayName||n.name,autoStep:!0});const i=n.transform,s=n.geometry,r=n.material,o=n.camera,a=n.name;if(n.animations)for(const p of n.animations)e.animations.push(p);const l=s&&s.isBufferGeometry&&s.attributes.skinIndex!==void 0&&s.attributes.skinIndex.count>0,h=l?"SkelRoot":"Xform",u=new Array;if(t.appendLine(),s?(t.beginBlock(`def ${h} "${a}"`,"(",!1),e.quickLookCompatible&&r&&r.side===_i&&!l?t.appendLine(`prepend references = @./geometries/${jx(s)}.usda@</Geometry_doubleSided>`):t.appendLine(`prepend references = @./geometries/${jx(s)}.usda@</Geometry>`),u.push("MaterialBindingAPI"),l&&u.push("SkelBindingAPI")):o?t.beginBlock(`def Camera "${a}"`,"(",!1):n.type!==void 0?t.beginBlock(`def ${n.type} "${a}"`):t.beginBlock(`def Xform "${a}"`,"(",!1),n.type===void 0&&((f=n.extraSchemas)!=null&&f.length&&u.push(...n.extraSchemas),u.length&&t.appendLine(`prepend apiSchemas = [${u.map(p=>`"${p}"`).join(", ")}]`)),n.displayName&&t.appendLine(`displayName = "${n.displayName}"`),(o||n.type===void 0)&&(t.closeBlock(")"),t.beginBlock()),s&&r){const p=YS(r);t.appendLine(`rel material:binding = </StageRoot/Materials/${p}>`),!e.quickLookCompatible&&r.side===_i&&(t.beginBlock('over "Geometry" '),t.appendLine("uniform bool doubleSided = 1"),t.closeBlock())}let d=!1;if(l?(t.appendLine("rel skel:skeleton = <Rig>"),t.appendLine("rel skel:animationSource = <Rig/_anim>"),d=!1):n.type===void 0&&i&&(d=d||i.position!==null||i.quaternion!==null||i.scale!==null,i.position&&(n.needsTranslate=!0,t.appendLine(`double3 xformOp:translate = (${rt(i.position.x)}, ${rt(i.position.y)}, ${rt(i.position.z)})`)),i.quaternion&&(n.needsOrient=!0,t.appendLine(`quatf xformOp:orient = (${rt(i.quaternion.w)}, ${rt(i.quaternion.x)}, ${rt(i.quaternion.y)}, ${rt(i.quaternion.z)})`)),i.scale&&(n.needsScale=!0,t.appendLine(`double3 xformOp:scale = (${rt(i.scale.x)}, ${rt(i.scale.y)}, ${rt(i.scale.z)})`))),n.visibility!==void 0&&t.appendLine(`token visibility = "${n.visibility}"`),o&&("isOrthographicCamera"in o&&o.isOrthographicCamera?(t.appendLine(`float2 clippingRange = (${o.near}, ${o.far})`),t.appendLine(`float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(si)}`),t.appendLine(`float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(si)}`),t.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in o&&o.isPerspectiveCamera&&(t.appendLine(`float2 clippingRange = (${o.near.toPrecision(si)}, ${o.far.toPrecision(si)})`),t.appendLine(`float focalLength = ${o.getFocalLength().toPrecision(si)}`),t.appendLine(`float focusDistance = ${o.focus.toPrecision(si)}`),t.appendLine(`float horizontalAperture = ${o.getFilmWidth().toPrecision(si)}`),t.appendLine('token projection = "perspective"'),t.appendLine(`float verticalAperture = ${o.getFilmHeight().toPrecision(si)}`))),n.onSerialize&&n.onSerialize(t,e),n.type===void 0){const p=new Array;n.needsTranslate&&p.push('"xformOp:translate"'),n.needsOrient&&p.push('"xformOp:orient"'),n.needsScale&&p.push('"xformOp:scale"'),p.length&&t.appendLine(`uniform token[] xformOpOrder = [${p.join(", ")}]`)}if(n.children){t.appendLine();for(const p of n.children)GO(p,t,e)}t.closeBlock()}function rt(n){return Number.isInteger(n)?n.toString():n.toFixed(10)}function oR(n){const t=n.elements;return`( ${NA(t,0)}, ${NA(t,4)}, ${NA(t,8)}, ${NA(t,12)} )`}function NA(n,t){return`(${rt(n[t+0])}, ${rt(n[t+1])}, ${rt(n[t+2])}, ${rt(n[t+3])})`}function OV(n,t=[],e=!0){return`
def "Geometry"
${LV(n,t,e)}
`}function LV(n,t=[],e=!0){const i="Geometry",s=n.attributes,r=s.position.count,o=t&&t.length>0,a=[],l=[];let h=new Array,u=s.skinIndex;if(o){const f=[];for(const m of t)m.parent.type!=="Bone"&&(a.push({bone:m,index:t.indexOf(m)}),f.push(m.uuid));for(;f.length<t.length;)for(const m of a){const v=m.bone.children;for(const y of v)f.indexOf(y.uuid)===-1&&t.indexOf(y)!==-1&&(a.push({bone:y,index:t.indexOf(y)}),f.push(y.uuid))}for(const m of UO(t))a.push({bone:m,index:a.length});const p=a[0].bone.parent;a.sort((m,v)=>df(m.bone,p)>df(v.bone,p)?1:-1),a.map(m=>'"'+df(m.bone,p)+'"').join(", ");for(const m in a)l[a[m].index]=parseInt(m);const g=s.skinIndex;h=new Array;for(let m=0;m<g.count;m++){const v=g.getX(m),y=g.getY(m),b=g.getZ(m),_=g.getW(m);h.push(l[v],l[y],l[b],l[_])}u=new Ke(new Uint16Array(h),4)}const d=s.skinWeight&&s.skinIndex;return`
{	
    def Mesh "${i}" ${d?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${j_(n)}]
        int[] faceVertexIndices = [${G_(n)}]
		${s.normal||e?`normal3f[] normals = [${Nv(s.normal,r)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${Nv(s.position,r)}]
        ${s.uv?`texCoord2f[] primvars:st = [${HO(s.uv,r,!0)}] (
            interpolation = "vertex"
        )`:""}
		${s.uv1?H_("st1",s.uv1):""}
		${s.uv2?H_("st2",s.uv2):""}
		${s.uv3?H_("st3",s.uv3):""}
		${d?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${s.skinIndex?`int[] primvars:skel:jointIndices = [${aR(u,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${s.skinWeight?`float[] primvars:skel:jointWeights = [${aR(s.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${s.color?`color3f[] primvars:displayColor = [${Nv(s.color,r)}] (
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${e?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${i}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${j_(n)+", "+j_(n)}]
		int[] faceVertexIndices = [${G_(n)+", "+G_(n,!0)}]
	}
}
`:""}
`}function j_(n){const t=n.index!==null?n.index.count:n.attributes.position.count;return Array(t/3).fill(3).join(", ")}function G_(n,t=!1){const e=n.index,i=[];if(e!==null)for(let s=0;s<e.count;s++){let r=s;t&&(r=s%3===0?s+2:s%3===2?s-2:s),i.push(e.getX(r))}else{const s=n.attributes.position.count;for(let r=0;r<s;r++){let o=r;t&&(o=r%3===0?r+2:r%3===2?r-2:r),i.push(o)}}return i.join(", ")}function H_(n,t){const e=t.itemSize;switch(e){case 2:return`texCoord2f[] primvars:${n} = [${HO(t,e,!0)}] (
				interpolation = "vertex"
			)`;case 3:return`texCoord3f[] primvars:${n} = [${Nv(t,e)}] (
				interpolation = "vertex"
			)`;case 4:return`double4[] primvars:${n} = [${FV(t,e)}] (
				interpolation = "vertex"
			)`;default:return console.warn("USDZExporter: Attribute with "+e+" components are currently not supported. Results may be undefined for "+n+"."),""}}function Nv(n,t){if(n===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(t).fill("(0, 0, 1)").join(", ");const e=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i),o=n.getZ(i);e.push(`(${s.toPrecision(si)}, ${r.toPrecision(si)}, ${o.toPrecision(si)})`)}return e.join(", ")}function FV(n,t){if(n===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(t).fill("(0, 0, 0, 0)").join(", ");const e=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i),o=n.getZ(i)||0,a=n.getW(i)||0;e.push(`(${s.toPrecision(si)}, ${r.toPrecision(si)}, ${o.toPrecision(si)}, ${a.toPrecision(si)})`)}return e.join(", ")}function aR(n,t=!1){const e=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i),o=n.getZ(i),a=n.getW(i);e.push(`${t?s:s.toPrecision(si)}`),e.push(`${t?r:r.toPrecision(si)}`),e.push(`${t?o:o.toPrecision(si)}`),e.push(`${t?a:a.toPrecision(si)}`)}return e.join(", ")}function HO(n,t,e=!1){if(n===void 0)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");const i=[];for(let s=0;s<n.count;s++){const r=n.getX(s);let o=n.getY(s);e&&(o=1-o),i.push(`(${r.toPrecision(si)}, ${o.toPrecision(si)})`)}return i.join(", ")}function UV(n,t,e=!1){const i=[];for(const s in n){const r=n[s];i.push(NV(r,t,e))}return`
	def "Materials"
    {
${i.join("")}
    }`}function NV(n,t,e=!1){var p;const i="                ",s=[],r=[],o=YS(n),a=new Set;function l(g){var m;return ol(g.name)+"_"+(((m=g.source)==null?void 0:m.id)??g.id)}function h(g,m,v=void 0,y=void 0){const b=l(g),_=b+(y!==void 0&&y!==1?"_"+y:""),x=e&&y!==void 0&&y!==1,S=x?new Fe(1,1,1,y):void 0;y===void 0&&(y=1),x&&(y=1),S&&S.w<=.05&&(S.w=.05),t[_]={texture:g,scale:S};const E=g.channel>0?"st"+g.channel:"st";a.add(g.channel);const M=VO.includes(g.format),I={1e3:"repeat",1001:"clamp",1002:"mirror"},B=g.repeat.clone(),R=g.offset.clone(),P=g.rotation,F=Math.sin(P),j=Math.cos(P);R.y=1-R.y-B.y,e?(B.x===0&&(B.x=1e-4),B.y===0&&(B.y=1e-4),R.x=R.x/B.x,R.y=R.y/B.y,R.x+=F/B.x,R.y+=j-1):(R.x+=F*B.x,R.y+=(1-j)*B.y);const V=B.x!=1||B.y!=1||R.x!=0||R.y!=0||P!=0,X=`${ir}/${o}/${"uvReader_"+E}.outputs:result>`,k=`${ir}/${o}/Transform2d_${m}.outputs:result>`,O=m!=="normal"&&v&&(v.r!==1||v.g!==1||v.b!==1||y!==1)||!1,H=m==="normal",ee=n instanceof Kn&&n.normalScale?n.normalScale.x*2:2,Y=ee.toFixed(si),he=(-1*(ee/2)).toFixed(si),ue=(1-ee).toFixed(si);return`
			${V?`def Shader "Transform2d_${m}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${X}
				float2 inputs:scale = ${cR(B)}
				float2 inputs:translation = ${cR(R)}
				float inputs:rotation = ${(P/Math.PI*180).toFixed(si)}
				float2 outputs:result
			}
			`:""}
			def Shader "${b}_${m}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${_}.${M?"png":"jpg"}@
				token inputs:sourceColorSpace = "${g.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${V?k:X}
				${O?`
				float4 inputs:scale = (${v?v.r+", "+v.g+", "+v.b:"1, 1, 1"}, ${y})
				`:""}
				${H?`
				float4 inputs:scale = (${Y}, ${Y}, ${Y}, 1)
				float4 inputs:bias = (${he}, ${he}, ${ue}, 0)
				`:""}
				token inputs:wrapS = "${I[g.wrapS]}"
				token inputs:wrapT = "${I[g.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${n.transparent||n.alphaTest>0?"float outputs:a":""}
			}`}let u=n.transparent||n.alphaTest?n.opacity:1,d=!1,f=!1;if(n instanceof bo&&n.transmission!==void 0&&(u*=1-n.transmission*(1-n.roughness*.5)),n.map?(s.push(`${i}color3f inputs:diffuseColor.connect = ${ir}/${o}/${l(n.map)}_diffuse.outputs:rgb>`),n instanceof _t&&n.transparent&&n.alphaTest==0&&e?(s.push(`${i}float inputs:opacity.connect = ${ir}/${o}/${l(n.map)}_diffuse.outputs:a>`),d=!0,s.push(`${i}float inputs:opacityThreshold = ${1e-10}`),f=!0):n.transparent?(s.push(`${i}float inputs:opacity.connect = ${ir}/${o}/${l(n.map)}_diffuse.outputs:a>`),d=!0):n.alphaTest>0&&(s.push(`${i}float inputs:opacity.connect = ${ir}/${o}/${l(n.map)}_diffuse.outputs:a>`),d=!0,s.push(`${i}float inputs:opacityThreshold = ${n.alphaTest}`),f=!0),r.push(h(n.map,"diffuse",n.color,u))):s.push(`${i}color3f inputs:diffuseColor = ${lR(n.color)}`),n.alphaHash&&e&&(f?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping alphaHash opacity threshold."):(s.push(`${i}float inputs:opacityThreshold = 0.0000000001`),f=!0)),n.aoMap&&(s.push(`${i}float inputs:occlusion.connect = ${ir}/${o}/${l(n.aoMap)}_occlusion.outputs:r>`),r.push(h(n.aoMap,"occlusion"))),n.alphaMap?(s.push(`${i}float inputs:opacity.connect = ${ir}/${o}/${l(n.alphaMap)}_opacity.outputs:r>`),s.push(`${i}float inputs:opacityThreshold = 0.0000000001`),d=!0,f=!0,r.push(h(n.alphaMap,"opacity",new be(1,1,1),u))):(d?console.warn("Opacity for "+n.name+" was already connected. Skipping default opacity."):(s.push(`${i}float inputs:opacity = ${u}`),d=!0),n.alphaTest>0&&(f?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping default opacity threshold."):(s.push(`${i}float inputs:opacityThreshold = ${n.alphaTest}`),f=!0))),n instanceof Kn){if(n.emissiveMap){s.push(`${i}color3f inputs:emissiveColor.connect = ${ir}/${o}/${l(n.emissiveMap)}_emissive.outputs:rgb>`);const g=n.emissive.clone();g.multiplyScalar(n.emissiveIntensity),r.push(h(n.emissiveMap,"emissive",g))}else if(((p=n.emissive)==null?void 0:p.getHex())>0){const g=n.emissive.clone();g.multiplyScalar(n.emissiveIntensity),s.push(`${i}color3f inputs:emissiveColor = ${lR(g)}`)}n.normalMap&&(s.push(`${i}normal3f inputs:normal.connect = ${ir}/${o}/${l(n.normalMap)}_normal.outputs:rgb>`),r.push(h(n.normalMap,"normal"))),n.roughnessMap&&n.roughness===1?(s.push(`${i}float inputs:roughness.connect = ${ir}/${o}/${l(n.roughnessMap)}_roughness.outputs:g>`),r.push(h(n.roughnessMap,"roughness"))):s.push(`${i}float inputs:roughness = ${n.roughness!==void 0?n.roughness:1}`),n.metalnessMap&&n.metalness===1?(s.push(`${i}float inputs:metallic.connect = ${ir}/${o}/${l(n.metalnessMap)}_metallic.outputs:b>`),r.push(h(n.metalnessMap,"metallic"))):s.push(`${i}float inputs:metallic = ${n.metalness!==void 0?n.metalness:0}`)}return n instanceof bo&&(s.push(`${i}float inputs:clearcoat = ${n.clearcoat}`),s.push(`${i}float inputs:clearcoatRoughness = ${n.clearcoatRoughness}`),s.push(`${i}float inputs:ior = ${n.ior}`),!n.transparent&&!(n.alphaTest>0)&&n.transmissionMap&&(s.push(`${i}float inputs:opacity.connect = ${ir}/${o}/${l(n.transmissionMap)}_transmission.outputs:r>`),r.push(h(n.transmissionMap,"transmission")))),a.size>2?console.warn("USDZExporter: Material "+n.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):a.size===2&&(!a.has(0)||!a.has(1))&&console.warn("USDZExporter: Material "+n.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${o}" ${n.name?`(
			displayName = "${n.name}"
		)`:""}
		{
			token outputs:surface.connect = ${ir}/${o}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${s.join(`
`)}
				int inputs:useSpecularWorkflow = ${n instanceof _t?"1":"0"}
				token outputs:surface
			}
${r.length>0?`
${a.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${a.has(1)?`
			def Shader "uvReader_st1"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st1"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${r.join(`
`)}`:""}
		}`}function lR(n){return`(${n.r}, ${n.g}, ${n.b})`}function cR(n){return`(${n.x}, ${n.y})`}const VO=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];z("debugusdz");const t1=class{constructor(t,e,i){c(this,"id");c(this,"trigger");c(this,"action");c(this,"exclusive",!1);this.id="Behavior_"+ol(t)+"_"+t1.global_id++,this.trigger=e,this.action=i}makeExclusive(t){return this.exclusive=t,this}writeTo(t,e,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`);let s="";if(Array.isArray(this.trigger)){s="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];s+="<"+o.id+">",r+1<this.trigger.length&&(s+=", ")}s+="]"}else s=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${s}`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(e,i),i.appendLine();else this.trigger.writeTo(e,i);i.appendLine(),this.action.writeTo(e,i),i.closeBlock()}};let hn=t1;c(hn,"global_id",0);const fd=new Set;function Gx(n,t){var i,s;let e="";if(Array.isArray(n)){fd.clear();let r="[ ";for(let o=0;o<n.length;o++){let a=n[o];if(!a){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}if(typeof a=="string"){if(fd.has(a))continue;r+=a,fd.add(a)}else if(typeof a=="object"){if(a.isObject3D&&(a=t.findById(a.uuid),!a)){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}const l=(i=a.getPath)==null?void 0:i.call(a);if(fd.has(l))continue;r+=l,fd.add(l)}o+1<n.length&&(r+=", ")}r+=" ]",e=r,fd.clear()}else if(typeof n=="object"){const r=n;if(r.isObject3D&&(n=t.findById(r.uuid)),!n)throw console.error("Invalid target object in behavior, the target object is likely missing from USDZ export. Is the object exported?",r),new Error(`Invalid target object in behavior, the target object is likely missing from USDZ export. Please report a bug. uuid: ${r.uuid}.`);e=(s=n.getPath)==null?void 0:s.call(n)}return e}const i1=class{constructor(t,e){c(this,"id");c(this,"targetId");c(this,"tokenId");c(this,"type");c(this,"distance");t&&(this.targetId=t),e?this.id=e:this.id="Trigger_"+i1.global_id++}writeTo(t,e){e.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=Gx(this.targetId,t)),e.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.type&&e.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&e.appendLine(`double distance = ${this.distance}`),e.closeBlock()}};let Kl=i1;c(Kl,"global_id",0);function hR(n,t={direct:!0,indirect:!0}){const e=_s.createEmpty();e.name="InputTarget_"+e.name,e.displayName=void 0,e.type="RealityKitComponent",e.onSerialize=i=>{i.appendLine("bool allowsDirectInput = "+(t.direct?1:0)),i.appendLine("bool allowsIndirectInput = "+(t.indirect?1:0)),i.appendLine('uniform token info:id = "RealityKit.InputTarget"')},n.add(e)}class $n{static sceneStartTrigger(){const t=new Kl;return t.targetId=void 0,t.tokenId="SceneTransition",t.type="enter",t}static tapTrigger(t,e={direct:!0,indirect:!0}){const i=new Kl(t);if(Array.isArray(t)&&t.length>1)for(const s of t)s instanceof _s&&hR(s,e);else t instanceof _s&&hR(t,e);return i.tokenId="TapGesture",i}static isTapTrigger(t){return(t==null?void 0:t.tokenId)==="TapGesture"}static proximityToCameraTrigger(t,e){const i=new Kl(t);return i.tokenId="ProximityToCamera",i.distance=e,i}}class Zc{constructor(t,e){c(this,"id");c(this,"actions");c(this,"loops",0);c(this,"performCount",1);c(this,"type","serial");c(this,"multiplePerformOperation");this.id=t,this.actions=e}static getId(){return this.global_id++}addAction(t){return this.actions.push(t),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(t){return this.performCount=t,this}writeTo(t,e){e.beginBlock(`def Preliminary_Action "${this.id}"`),e.beginArray("rel actions");for(const i of this.actions){if(!i)continue;const s=i===this.actions[this.actions.length-1];e.appendLine("<"+i.id+">"+(s?"":", "))}e.closeArray(),e.appendLine(),e.appendLine('token info:id = "Group"'),e.appendLine(`bool loops = ${this.loops}`),e.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),e.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&e.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),e.appendLine();for(const i of this.actions)i&&(i.writeTo(t,e),e.appendLine());e.closeBlock()}}c(Zc,"global_id",0);const Zy=class{constructor(t,e){c(this,"id");c(this,"tokenId");c(this,"affectedObjects");c(this,"easeType");c(this,"motionType");c(this,"duration");c(this,"moveDistance");c(this,"style");c(this,"type");c(this,"front");c(this,"up");c(this,"start");c(this,"animationSpeed");c(this,"reversed");c(this,"pingPong");c(this,"xFormTarget");c(this,"audio");c(this,"gain");c(this,"auralMode");c(this,"multiplePerformOperation");c(this,"velocity");t&&(this.affectedObjects=t),e?this.id=e:this.id="Action",this.id+="_"+Zy.global_id++}clone(){const t=new Zy,e=t.id;return Object.assign(t,this),t.id=e,t}writeTo(t,e){e.beginBlock(`def Preliminary_Action "${this.id}"`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=Gx(this.affectedObjects,t)),e.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?e.appendLine(`double duration = ${this.duration/this.animationSpeed} `):e.appendLine(`double duration = ${this.duration} `)),this.easeType&&e.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&e.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&e.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&e.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&e.appendLine(`token style = "${this.style}"`),this.type&&e.appendLine(`token type = "${this.type}"`),this.front&&e.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&e.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&e.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&e.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&e.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&e.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=Gx(this.xFormTarget,t)),e.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&e.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&e.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&e.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&e.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&e.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),e.closeBlock()}};let cr=Zy;c(cr,"global_id",0);let Fd=class Sd{constructor(t,e,i){c(this,"x",0);c(this,"y",0);c(this,"z",0);this.x=t,this.y=e,this.z=i}static get up(){return new Sd(0,1,0)}static get right(){return new Sd(1,0,0)}static get forward(){return new Sd(0,0,1)}static get back(){return new Sd(0,0,-1)}static get zero(){return new Sd(0,0,0)}};class Ct{static sequence(...t){return new Zc("Group_"+Zc.getId(),t).makeSequence()}static parallel(...t){return new Zc("Group_"+Zc.getId(),t).makeParallel()}static fadeAction(t,e,i){const s=new cr(t);return s.tokenId="Visibility",s.type=i?"show":"hide",s.duration=e,s.style="basic",s.motionType="none",s.moveDistance=0,s.easeType="none",s}static startAnimationAction(t,e,i=0,s=1,r=!1,o=!1){const a=new cr(t);if(a.tokenId="StartAnimation",a.start=e,a.duration=i,a.animationSpeed=s,a.reversed=r,a.pingPong=o,a.multiplePerformOperation="allow",r&&(a.start-=i),o){a.pingPong=!1;const l=a.clone();return l.reversed=!r,l.start=a.start,l.reversed&&(l.start-=i),Ct.sequence(a,l)}return a}static waitAction(t){const e=new cr;return e.tokenId="Wait",e.duration=t,e.motionType=void 0,e}static lookAtCameraAction(t,e,i,s){const r=new cr(t);return r.tokenId="LookAtCamera",r.duration=e===void 0?9999999999999:e,r.front=i??Fd.forward,r.up=s??Fd.up,r}static emphasize(t,e,i="bounce",s=1,r="basic"){const o=new cr(t);return o.tokenId="Emphasize",o.duration=e,o.style=r??"basic",o.motionType=i,o.moveDistance=s,o}static transformAction(t,e,i,s,r="inout"){const o=new cr(t);return o.tokenId="Transform",o.duration=i,o.duration=Math.max(1e-6,i),o.type=s,o.easeType=i>0?r:"none",Array.isArray(e)&&console.error("Transform target must not be an array",e),o.xFormTarget=e,o}static playAudioAction(t,e,i="play",s=1,r="spatial"){const o=new cr(t);return o.tokenId="Audio",o.type=i,o.audio=e,o.gain=s,o.auralMode=r,o.multiplePerformOperation="allow",o}static impulseAction(t,e){const i=new cr(t);return i.tokenId="Impulse",i.velocity=e,i}}class zV{constructor(t){c(this,"object");c(this,"model");this.object=t}get id(){return this.object.uuid}apply(t){if(!this.model&&(this.model=t.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(t)}}class WO extends zV{constructor(e,i,s,r){super(e);c(this,"matrix");c(this,"material");c(this,"geometry");c(this,"_enableAction");c(this,"_disableAction");this.matrix=i,this.material=s,this.geometry=r}onApply(e){var r,o;const i=this.model;if(!i)return;(r=i.parent)!=null&&r.isDynamic||_s.createEmptyParent(i);const s=i.clone();this.matrix&&s.setMatrix(this.matrix),this.material&&(s.material=this.material),this.geometry&&(s.geometry=this.geometry),(o=i.parent)==null||o.add(s)}enable(){return this._enableAction?this._enableAction:(this._enableAction=Ct.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=Ct.fadeAction(this.object,0,!1),this._disableAction)}}class qO{constructor(t){c(this,"actions");c(this,"sortedActions");this.actions=[...t]}organize(){this.sortedActions={};for(const t of this.actions){const e=t.id;this.sortedActions[e]||(this.sortedActions[e]=[]),this.sortedActions[e].push(t)}}getActions(t){return this.sortedActions||this.organize(),this.sortedActions[t.uuid]}}const km=function(n){return A(n)},A=function(n){if(n===void 0&&(n=null),!Array.isArray(n))n=uR(n);else for(let t=0;t<n.length;t++){const e=n[t];n[t]=uR(e)}return function(t,e){typeof e!="string"&&(e=e.name),Object.getOwnPropertyDescriptor(t,"$serializedTypes")||(t.$serializedTypes={});const i=t.$serializedTypes=t.$serializedTypes||{};i[e]=n}};function uR(n){var t,e;switch((e=(t=n==null?void 0:n.prototype)==null?void 0:t.constructor)==null?void 0:e.name){case"Number":case"String":case"Boolean":return null}return n}class Q extends ne{constructor(){super(...arguments);c(this,"guid")}static isDestroyed(e){return kf(e)}static setActive(e,i,s=!0){e&&(kv(e,i),Iv(e),i&&s&&YD(je.Current,e))}static isActiveSelf(e){return Bm(e)}static isActiveInHierarchy(e){return B6(e)}static markAsInstancedRendered(e,i){P6(e,i)}static isUsingInstancing(e){return QS(e)}static foreachComponent(e,i,s=!0){return Df(e,i,s)}static instantiateSynced(e,i){return e?$D(e,i):null}static instantiate(e,i=null){return Pm(e,i)}static destroySynced(e,i,s=!0){if(!e)return;const r=e;i=i??je.Current,T0(r,i.connection,s)}static destroy(e,i=!0){return wo(e,i)}static add(e,i,s){if(!(!e||!i)){if(e===i){console.warn("Can not add object to self",e);return}s||(s=je.Current),i.add(e),kv(e,!0),Iv(e),s?Q.foreachComponent(e,r=>{kS(r,s),!r.__internalDidAwakeAndStart&&s.new_script_start.includes(r)===!1&&s.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(e){var i;e&&((i=e.parent)==null||i.remove(e),kv(e,!1),Iv(e),Q.foreachComponent(e,s=>{R5(s)},!0))}static invokeOnChildren(e,i,...s){this.invoke(e,i,!0,s)}static invoke(e,i,s=!1,...r){e&&this.foreachComponent(e,o=>{const a=o[i];a&&typeof a=="function"&&(a==null||a.call(o,...r))},s)}static addNewComponent(e,i,s,r=!0){return Ao(e,i,s,{callAwake:r})}static addComponent(e,i,s,r){return Ao(e,i,s,r)}static moveComponent(e,i){return Ao(e,i)}static removeComponent(e){return aO(e.gameObject,e),e}static getOrAddComponent(e,i){return R0(e,i)}static getComponent(e,i){return e===null?null:Qf(e,i)}static getComponents(e,i,s=null){return e===null?s??[]:B0(e,i,s)}static findByGuid(e,i){return M0(e,i)}static findObjectOfType(e,i,s=!0){return NS(e,i??je.Current,s)}static findObjectsOfType(e,i){const s=[];return R6(e,s,i),s}static getComponentInChildren(e,i){return P0(e,i)}static getComponentsInChildren(e,i,s=null){return Rm(e,i,s??void 0)}static getComponentInParent(e,i){return uy(e,i)}static getComponentsInParent(e,i,s=null){return US(e,i,s)}static getAllComponents(e){var r;return[...(r=e.userData)==null?void 0:r.components]}static*iterateComponents(e){var s;const i=(s=e==null?void 0:e.userData)==null?void 0:s.components;if(i&&Array.isArray(i))for(let r=0;r<i.length;r++)yield i[r]}}var Na;let re=(Na=class{constructor(t){c(this,"__context");c(this,"__name");c(this,"gameObject");c(this,"guid","invalid");c(this,"sourceId");c(this,"__didAwake",!1);c(this,"__didStart",!1);c(this,"__didEnable",!1);c(this,"__isEnabled");c(this,"__destroyed",!1);c(this,"_eventListeners",new Map);this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(t)}get isComponent(){return!0}get context(){return this.__context??je.Current}set context(t){this.__context=t}get scene(){return this.context.scene}get layer(){var t,e;return(e=(t=this.gameObject)==null?void 0:t.userData)==null?void 0:e.layer}get name(){var t,e;return(t=this.gameObject)!=null&&t.name?this.gameObject.name:(e=this.gameObject)==null?void 0:e.userData.name}set name(t){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=t,this.__name=t):this.__name=t}get tag(){var t;return(t=this.gameObject)==null?void 0:t.userData.tag}set tag(t){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=t)}get static(){var t;return(t=this.gameObject)==null?void 0:t.userData.static}set static(t){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.static=t)}get hideFlags(){var t;return(t=this.gameObject)==null?void 0:t.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const t=this.gameObject[eh];return t===void 0?!0:t}set __isActiveInHierarchy(t){this.gameObject&&(this.gameObject[eh]=t)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(t,e=We.Update){return this.context.registerCoroutineUpdate(this,t,e)}stopCoroutine(t,e=We.Update){this.context.unregisterCoroutineUpdate(t,e)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(t){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(t),this}_internalInit(t){if(typeof t=="object")for(const e of Object.keys(t)){const i=t[e];typeof i!="function"&&(this[e]=i)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(t){return this.__destroyed?(ve()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(t!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(t){if(this.__didAwake){if(!this.__didEnable){t!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var t;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((t=this.onDestroy)==null||t.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),T6(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(t){if(this.__destroyed){ve()&&console.warn(`[Needle Engine Dev] Trying to ${t?"enable":"disable"} destroyed component`);return}if(typeof t=="number"&&(t>=.5?t=!0:t=!1),!this.__didAwake){this.__isEnabled=t;return}t?this.__internalEnable():this.__internalDisable()}get worldPosition(){return He(this.gameObject)}set worldPosition(t){Cn(this.gameObject,t)}setWorldPosition(t,e,i){Tf(this.gameObject,t,e,i)}get worldQuaternion(){return Gt(this.gameObject)}set worldQuaternion(t){ia(this.gameObject,t)}setWorldQuaternion(t,e,i,s){HM(this.gameObject,t,e,i,s)}get worldEuler(){return WM(this.gameObject)}set worldEuler(t){qM(this.gameObject,t)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(t){this.setWorldRotation(t.x,t.y,t.z,!0)}setWorldRotation(t,e,i,s=!0){_0(this.gameObject,t,e,i,s)}get forward(){return Na._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return Na._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return Na._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(t,e){this._eventListeners[t]=this._eventListeners[t]||[],this._eventListeners[t].push(e)}removeEventListener(t,e){if(!this._eventListeners[t])return;const i=this._eventListeners[t].indexOf(e);i>=0&&this._eventListeners[t].splice(i,1)}dispatchEvent(t){if(!t||!this._eventListeners[t.type])return!1;const e=this._eventListeners[t.type];for(let i=0;i<e.length;i++)e[i](t);return!1}},c(Na,"_forward",new w),c(Na,"_right",new w),c(Na,"_up",new w),Na);const QV=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:re,Component:re,GameObject:Q},Symbol.toStringTag,{value:"Module"}));var XO=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class U0 extends re{constructor(){super(...arguments);c(this,"from");c(this,"to");c(this,"width",0);c(this,"centered",!0);c(this,"_centerPos")}awake(){this._centerPos=new w}update(){if(!this.from||!this.to)return;const e=He(this.from).clone(),i=He(this.to).clone(),s=e.distanceTo(i);this._centerPos.copy(e),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),Cn(this.gameObject,this.centered?this._centerPos:e),this.gameObject.lookAt(He(this.to).clone()),this.gameObject.scale.set(this.width,this.width,s)}}XO([A(Q)],U0.prototype,"from",void 0);XO([A(Q)],U0.prototype,"to",void 0);var zu=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Tc=z("debuganimation");let YO=class{constructor(){c(this,"x");c(this,"y")}};class Ws extends re{constructor(){super(...arguments);c(this,"playAutomatically",!0);c(this,"randomStartTime",!0);c(this,"minMaxSpeed");c(this,"minMaxOffsetNormalized");c(this,"loop",!0);c(this,"clampWhenFinished",!1);c(this,"_tempAnimationClipBeforeGameObjectExisted",null);c(this,"_tempAnimationsArray");c(this,"mixer");c(this,"_actions");c(this,"_handles")}get isAnimationComponent(){return!0}addClip(e){this.animations||(this.animations=[]),this.animations.push(e)}get time(){if(this.actions){for(const e of this.actions)if(e.isRunning())return e.time}return 0}set time(e){if(this.actions)for(const i of this.actions)i.time=e}get clip(){var e;return(e=this.animations)!=null&&e.length?this.animations[0]:null}set clip(e){if(!this.__didAwake){Tc&&console.warn("Assign clip during serialization",e),this._tempAnimationClipBeforeGameObjectExisted=e;return}e&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(e)&&(this.animations.length>0?this.animations.splice(0,0,e):this.animations.push(e)))}set clips(e){this.animations=e}set animations(e){e==null||!Array.isArray(e)||(this.gameObject?this.gameObject.animations=e:this._tempAnimationsArray=e)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get actions(){return this._actions}set actions(e){this._actions=e}awake(){Tc&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.actions=[],this._handles=[]}onEnable(){var e;if(this.playAutomatically&&((e=this.animations)==null?void 0:e.length)>0){const i=Math.floor(Math.random()*this.animations.length),s=this.animations[i];this.play(i,{exclusive:!0,fadeDuration:0,startTime:this.randomStartTime?Math.random()*s.duration:0,loop:this.loop,clampWhenFinished:this.clampWhenFinished})}}update(){this.mixer&&(this.mixer.update(this.context.time.deltaTime),this._handles.forEach(e=>e.update()))}onDisable(){this.mixer&&this.mixer.stopAllAction()}onDestroy(){this.context.animations.unregisterAnimationMixer(this.mixer)}getAction(e){var i;return((i=this.actions)==null?void 0:i.find(s=>s.getClip().name===e))||null}get isPlaying(){if(this.actions){for(let e=0;e<this.actions.length;e++)if(this.actions[e].isRunning())return!0}return!1}stopAll(e){if(this.actions)for(const i of this.actions)e!=null&&e.fadeDuration?i.fadeOut(e.fadeDuration):i.stop()}stop(e,i){if(e===void 0){this.stopAll();return}else if(typeof e=="number"){if(e>=this.animations.length){Tc&&console.log("No animation at index",e);return}e=this.animations[e]}else typeof e=="string"&&(e=this.animations.find(r=>r.name===e));if(!e){console.error("Could not find clip",e);return}const s=this.actions.find(r=>r.getClip()===e);if(!s){console.error("Could not find action",e);return}i!=null&&i.fadeDuration?s.fadeOut(i.fadeDuration):s.stop()}pause(e,i=!1){if(e===void 0){for(const r of this.actions)r.paused=!i;return}else if(typeof e=="number"){if(e>=this.animations.length){Tc&&console.log("No animation at index",e);return}e=this.animations[e]}else typeof e=="string"&&(e=this.animations.find(r=>r.name===e));if(!e){console.error("Could not find clip",e);return}const s=this.actions.find(r=>r.getClip()===e);if(!s){console.error("Could not find action",e);return}s.paused=!i}resume(){for(const e of this.actions)e.paused=!1}play(e=0,i){if(Tc&&console.log("PLAY",e),this.ensureMixer(),!this.mixer){Tc&&console.warn("Missing mixer",this);return}e===void 0&&(e=0);let s=e;if(typeof e=="number"){if(e>=this.animations.length){Tc&&console.log("No animation at index",e);return}s=this.animations[e]}else typeof e=="string"&&(s=this.animations.find(o=>o.name===e));if(!s){console.error("Could not find clip",e);return}i||(i={});for(const o of this.actions)if(o.getClip()===s)return this.internalOnPlay(o,i);if(!s.tracks){console.warn("Clip is no AnimationClip",s);return}const r=this.mixer.clipAction(s);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(e,i){var s=this.actions.find(a=>a===e);if(s===e&&s.isRunning()&&s.time<s.getClip().duration){const a=this.tryFindHandle(e);if(s.paused&&(s.paused=!1),a)return a.waitForFinish()}if(i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished),i.minMaxOffsetNormalized===void 0&&this.randomStartTime&&(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed===void 0&&(i.minMaxSpeed=this.minMaxSpeed),(i==null?void 0:i.exclusive)??!0)for(const a of this.actions)a!=s&&(i.fadeDuration?a.fadeOut(i.fadeDuration):a.stop());if(i!=null&&i.fadeDuration&&e.fadeIn(i.fadeDuration),e.enabled=!0,(i==null?void 0:i.startTime)!=null)e.time=i.startTime;else if(i!=null&&i.minMaxOffsetNormalized&&i.minMaxOffsetNormalized.x!=0&&i.minMaxOffsetNormalized.y!=0){const a=e.getClip();e.time=ye.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*a.duration}else e.time>=e.getClip().duration&&(e.time=0);i!=null&&i.minMaxSpeed?e.timeScale=ye.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random()):e.timeScale=(i==null?void 0:i.speed)??1,(i==null?void 0:i.loop)!=null?e.loop=i.loop?RF:Nw:e.loop=Nw,i!=null&&i.clampWhenFinished&&(e.clampWhenFinished=!0),e.paused=!1,e.play(),Tc&&console.log("PLAY",e.getClip().name,e);const o=new jV(e,this.mixer,i,a=>{this._handles.splice(this._handles.indexOf(o),1)});return this._handles.push(o),o.waitForFinish()}tryFindHandle(e){for(const i of this._handles)if(i.action===e)return i}ensureMixer(){if(!this.mixer){const e="animationMixer";this.gameObject[e]&&(this.mixer=this.gameObject[e]),(!this.mixer||!this.mixer.clipAction)&&(this.mixer=new DC(this.gameObject),this.gameObject[e]=this.mixer)}this.context.animations.registerAnimationMixer(this.mixer)}}zu([A()],Ws.prototype,"playAutomatically",void 0);zu([A()],Ws.prototype,"randomStartTime",void 0);zu([A(YO)],Ws.prototype,"minMaxSpeed",void 0);zu([A(YO)],Ws.prototype,"minMaxOffsetNormalized",void 0);zu([A()],Ws.prototype,"loop",void 0);zu([A()],Ws.prototype,"clampWhenFinished",void 0);zu([A(ql)],Ws.prototype,"clips",null);class jV{constructor(t,e,i,s){c(this,"mixer");c(this,"action");c(this,"promise",null);c(this,"_options");c(this,"_resolveCallback",null);c(this,"_resolvedOrRejectedCallback");c(this,"onLoop",t=>{});c(this,"onFinished",t=>{t.action===this.action&&this.onResolve()});this.action=t,this.mixer=e,this._resolvedOrRejectedCallback=s,this._options=i}waitForFinish(){return this.promise?this.promise:(this.promise=new Promise(t=>{this._resolveCallback=t}),this.mixer.addEventListener("loop",this.onLoop),this.mixer.addEventListener("finished",this.onFinished),this.promise)}update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var t,e;this.dispose(),(t=this._resolvedOrRejectedCallback)==null||t.call(this,this),(e=this._resolveCallback)==null||e.call(this,this.action)}dispose(){this.mixer.removeEventListener("loop",this.onLoop),this.mixer.removeEventListener("finished",this.onFinished)}}var yh=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class ur{constructor(t=0,e=0){c(this,"time",0);c(this,"value",0);c(this,"inTangent",1/0);c(this,"inWeight");c(this,"outTangent",1/0);c(this,"outWeight");c(this,"weightedMode");this.time=t,this.value=e}}yh([A()],ur.prototype,"time",void 0);yh([A()],ur.prototype,"value",void 0);yh([A()],ur.prototype,"inTangent",void 0);yh([A()],ur.prototype,"inWeight",void 0);yh([A()],ur.prototype,"outTangent",void 0);yh([A()],ur.prototype,"outWeight",void 0);yh([A()],ur.prototype,"weightedMode",void 0);class Ko{constructor(){c(this,"keys",[])}static linearFromTo(t,e,i){const s=new Ko,r=new ur;r.time=0,r.value=t;const o=new ur;return o.time=i,o.value=e,s.keys.push(r,o),s}static constant(t){const e=new Ko,i=new ur;return i.time=0,i.value=t,e.keys.push(i),e}clone(){var e;const t=new Ko;return t.keys=((e=this.keys)==null?void 0:e.map(i=>{const s=new ur;return s.time=i.time,s.value=i.value,s.inTangent=i.inTangent,s.inWeight=i.inWeight,s.outTangent=i.outTangent,s.outWeight=i.outWeight,s.weightedMode=i.weightedMode,s}))||[],t}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(t){if(!this.keys||this.keys.length==0)return 0;if(this.keys.length===1)return this.keys[0].value;if(this.keys[0].time>=t)return this.keys[0].value;for(let e=0;e<this.keys.length;e++){const i=this.keys[e];if(i.time<=t)if(e+1<this.keys.length){const r=this.keys[e+1];if(r.time<t)continue;return!isFinite(i.outTangent)||!isFinite(r.inTangent)?i.value:Ko.interpolateValue(t,i,r)}else return i.value}return this.keys[this.keys.length-1].value}static interpolateValue(t,e,i){const s=e.time,r=e.value,o=e.outTangent,a=i.time,l=i.value,h=i.inTangent,u=a-s,d=u*u,f=d*u,p=((o+h)*u-2*(l-r))/f,g=(3*(l-r)-(h+2*o)*u)/d,m=o,v=r,y=t-s,b=y*y,_=b*y;return p*_+g*b+m*y+v}}yh([A(ur)],Ko.prototype,"keys",void 0);const bl=new Array;class Nl{constructor(t,e,i,s){c(this,"enabled",!0);c(this,"target");c(this,"methodName");c(this,"arguments");this.target=t,this.methodName=e||null,this.arguments=i,s!=null&&(this.enabled=s)}get canClone(){return this.target instanceof Object}invoke(...t){if(this.enabled!==!1){if(typeof this.target=="function")this.arguments?(bl.length=0,t!==void 0&&t.length>0&&bl.push(...t),bl.push(...this.arguments),this.target(...this.arguments),bl.length=0):this.target(...t);else if(this.methodName!=null){const e=this.target[this.methodName];typeof e=="function"?this.arguments?(bl.length=0,t!==void 0&&t.length>0&&bl.push(...t),bl.push(...this.arguments),e.call(this.target,...bl),bl.length=0):e.call(this.target,...t):this.arguments?this.target[this.methodName]=this.arguments[0]||t[0]:this.target[this.methodName]=t[0]}}}}const GV=n=>/^[A-Z]*$/.test(n);class KS extends Event{constructor(){super(...arguments);c(this,"args")}}class $t{constructor(t){c(this,"isEventList",!0);c(this,"target");c(this,"key");c(this,"_isInvoking",!1);c(this,"methods",[]);c(this,"_methodsCopy",[]);if(this.methods=[],Array.isArray(t))for(const e of t)e instanceof Nl?this.methods.push(e):typeof e=="function"&&this.methods.push(new Nl(e));else typeof t=="function"&&this.methods.push(new Nl(t))}__internalOnInstantiate(t){var s;const e=new Array;for(let r=0;r<this.methods.length;r++){const o=this.methods[r];if(!(o.target instanceof Function)){const a=o.target;let l=a==null?void 0:a.uuid;if(a&&(l=a.guid),l){const h=t[l];if(h){const u=(s=o.arguments)==null?void 0:s.map(d=>d instanceof Object&&d.uuid?t[d.uuid]:d!=null&&d.isComponent?t[d.guid]:d);e.push(new Nl(h.clone,o.methodName,u,o.enabled))}else ve()&&console.warn("Could not find target for event listener")}}}return new $t(e)}setEventTarget(t,e){if(this.key=t,this.target=e,this.key!==void 0){let i="",s=!1;for(const r of this.key)s&&GV(r)&&(i+="-"),s=!0,i+=r.toLowerCase();this.key=i}}get listenerCount(){var t;return((t=this.methods)==null?void 0:t.length)??0}get isInvoking(){return this._isInvoking}static from(...t){return new $t(t)}invoke(...t){var e;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((e=this.methods)==null?void 0:e.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const i of this._methodsCopy)i.invoke(...t);if(typeof this.target=="object"&&typeof this.key=="string"){const i=this.target.dispatchEvent;if(typeof i=="function"){const s=new KS(this.key);s.args=t,i.call(this.target,s)}}}finally{this._isInvoking=!1,this._methodsCopy.length=0}return!0}addEventListener(t){return this.methods.push(new Nl(t)),t}removeEventListener(t){if(t)for(let e=this.methods.length-1;e>=0;e--)this.methods[e].target===t&&(this.methods[e].enabled=!1,this.methods.splice(e,1))}removeAllEventListeners(){this.methods.length=0}}const dR=Symbol("previous-visibility"),qd=class extends Et{render(t,e,i){if(i instanceof mS)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const s=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(t,e),i.setRenderTarget(s),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){qd._userSet.clear();const t=WD(this.texture,!0,null,qd._userSet);for(const e of t)e instanceof J&&(e[dR]=e.visible,e.visible=!1)}onAfterRender(){for(const t of qd._userSet)t instanceof J&&(t.visible=t[dR]);qd._userSet.clear()}};let gu=qd;c(gu,"_userSet",new Set);class HV extends So{constructor(){super([be,Ut],"ColorSerializer")}onDeserialize(t){if(t!=null)return t.a!==void 0?new Ut(t.r,t.g,t.b,t.a):t.alpha!==void 0?new Ut(t.r,t.g,t.b,t.alpha):new be(t.r,t.g,t.b)}onSerialize(t){if(t!=null)return t.a!==void 0?{r:t.r,g:t.g,b:t.b,a:t.a}:{r:t.r,g:t.g,b:t.b}}}const oJ=new HV;class VV extends So{constructor(){super([jt],"EulerSerializer")}onDeserialize(t,e){if(t!=null){if(t.order)return new jt(t.x,t.y,t.z,t.order);if(t.x!=null)return new jt(t.x,t.y,t.z)}}onSerialize(t,e){return{x:t.x,y:t.y,z:t.z,order:t.order}}}const aJ=new VV;class WV extends So{constructor(){super(ne,"ObjectSerializer")}onSerialize(t,e){if(e.objectToNode!==void 0&&t.uuid){const i=e.objectToNode[t.uuid];return yn&&console.log(i,t.name,t.uuid),{node:i}}}onDeserialize(t,e){var i,s,r;if(typeof t=="string"){if(t.endsWith(".glb")||t.endsWith(".gltf")){if(e.serializable instanceof Array&&e.serializable.includes(et))return;ve()&&qt("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const o=(s=(i=e.target)==null?void 0:i.constructor)==null?void 0:s.name;console.warn(`Wrong usage of @serializable detected in your script "${o}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${e.path}! : AssetReference;
\0`)}return}if(t){if(t.node!==void 0&&e.nodeToObject){const o=e.nodeToObject[t.node];return yn&&console.log("Deserialized object reference?",t,o,e==null?void 0:e.nodeToObject),o||console.warn("Did not find node: "+t.node,e.nodeToObject,e.object),o}else if(t.guid){if(!e.context){console.error("Missing context");return}let o;const a=(r=e.gltf)==null?void 0:r.scene;return a&&(o=Q.findByGuid(t.guid,a)),o||(o=Q.findByGuid(t.guid,e.context.scene)),o?(o&&o.isComponent===!0&&(yn&&console.warn("Deserialized object reference is a component"),o=o.gameObject),yn&&console.log("Deserialized object reference?",t,o,e==null?void 0:e.nodeToObject)):((ve()||yn)&&console.warn("Could not resolve object reference",e.path,t,e.target,e.context.scene),t.could_not_resolve=!0),o}}}}const qV=new WV;class XV extends So{constructor(){super([re,re],"ComponentSerializer")}onSerialize(t,e){if(t!=null&&t.guid)return{guid:t.guid}}onDeserialize(t,e){var i;if(t!=null&&t.guid){if(t.___persistentAsset){yn&&console.log("Skipping component deserialization because it's a persistent asset",t);return}const s=e.path;yn&&console.log(t.guid,e.root,e.object,e.target);let r=this.findObjectForGuid(t.guid,e.root);if(r||e.context&&(r=this.findObjectForGuid(t.guid,(i=e.context)==null?void 0:i.scene),r))return r;(ve()||yn)&&console.warn('Could not resolve component reference: "'+s+'" using guid '+t.guid,e.target),t.could_not_resolve=!0;return}}findObjectForGuid(t,e){if(e.guid===t)return e;const i=Q.foreachComponent(e,s=>{if(s.guid===t)return s},!1);if(i!==void 0)return i;for(let s=0;s<e.children.length;s++){const r=e.children[s],o=this.findObjectForGuid(t,r);if(o)return o}}}const V_=new XV;class YV extends So{constructor(){super([$t])}onSerialize(t,e){console.log("TODO: SERIALIZE EVENT")}onDeserialize(t,e){var i,s,r;if(typeof t=="function")return new $t([new Nl(t,null,[],!0)]);if(t&&t.type==="EventList"){yn&&console.log("DESERIALIZE EVENT",t);const o=new Array;if(t.calls&&Array.isArray(t.calls))for(const h of t.calls){let f=function(p){if(typeof p=="object"){let g=qV.onDeserialize(p,e);if(g||(g=V_.onDeserialize(p,e)),g)return g}return p};yn&&console.log(h);let u=V_.findObjectForGuid(h.target,e.root);!u&&((i=e.context)!=null&&i.scene)&&(u=V_.findObjectForGuid(h.target,(s=e.context)==null?void 0:s.scene));const d=((r=h.method)==null?void 0:r.length)>0;if(u&&d){const p=()=>{const m=h.method[0].toUpperCase()+h.method.slice(1);if(typeof u[m]=="function"){console.warn(`EventList method:
Could not find method ${h.method} on object ${u.name}. Please rename ${h.method} to ${m}?
`,u[m],`
 in script: `,u),qt("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${h.method} on object ${u.name}`,u,typeof u[h.method])};if(typeof u[h.method]!="function"){let m=!1,v=u;for(;v;){const y=Object.getOwnPropertyDescriptor(v,h.method);if(y&&(y.writable===!0||y.set)){m=!0;break}v=Object.getPrototypeOf(v)}!m&&(ve()||yn)&&p()}}if(u){let p=h.argument;if(p!==void 0?p=f(p):h.arguments!==void 0&&(p=h.arguments.map(f)),!u[h.method])console.warn(`EventList method not found: "${h.method}" on ${u==null?void 0:u.name}`);else{p!==void 0&&!Array.isArray(p)&&(p=[p]);const m=new Nl(u,h.method,p,h.enabled);o.push(m)}}else ve()&&console.warn("[Debug] EventList: Could not find event listener in scene",h)}const a=new $t(o);yn&&console.log(a);const l=e.target;return l!==void 0&&e.path!==void 0&&a.setEventTarget(e.path,l),a}}}const lJ=new YV,yy=new WeakMap,KV=At.prototype.clone;At.prototype.clone=function(){const n=KV.call(this);return yy.has(n)||yy.set(n,this),n};class JV extends So{constructor(){super([gu,Et])}onSerialize(t,e){}onDeserialize(t,e){if(t instanceof At&&e.type===gu){let i=t;yy.has(i)&&(i=yy.get(i)),i.isRenderTargetTexture=!0,i.flipY=!0,i.offset.y=1,i.repeat.y=-1,i.needsUpdate=!0,i.mipmaps=[],i instanceof tf&&(i.isCompressedTexture=!1,i.format=Wi);const s=new gu(i.image.width,i.image.height,{colorSpace:Ni});return s.texture=i,s}}}new JV;class ZV extends So{constructor(){super([URL])}onSerialize(t,e){return null}onDeserialize(t,e){if(typeof t=="string"&&t.length>0)return Du(e.gltfId,t)}}new ZV;const fR={type:"change"},W_={type:"start"},pR={type:"end"},zA=new mh,gR=new ic,$V=Math.cos(70*ct.DEG2RAD);let KO=class extends hc{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new w,this.cursor=new w,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:od.ROTATE,MIDDLE:od.DOLLY,RIGHT:od.PAN},this.touches={ONE:ad.ROTATE,TWO:ad.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(N){N.addEventListener("keydown",Ji),this._domElementKeyEvents=N},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Ji),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(fR),i.update(),r=s.NONE},this.update=function(){const N=new w,K=new ie().setFromUnitVectors(t.up,new w(0,1,0)),tt=K.clone().invert(),Qt=new w,ks=new ie,br=new w,tr=2*Math.PI;return function(Bb=null){const sd=i.object.getWorldPosition(t.position);N.copy(sd).sub(i.target),N.applyQuaternion(K),a.setFromVector3(N),i.autoRotate&&r===s.NONE&&j(P(Bb)),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let Bo=i.minAzimuthAngle,Po=i.maxAzimuthAngle;isFinite(Bo)&&isFinite(Po)&&(Bo<-Math.PI?Bo+=tr:Bo>Math.PI&&(Bo-=tr),Po<-Math.PI?Po+=tr:Po>Math.PI&&(Po-=tr),Bo<=Po?a.theta=Math.max(Bo,Math.min(Po,a.theta)):a.theta=a.theta>(Bo+Po)/2?Math.max(Bo,a.theta):Math.min(Po,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(d,i.dampingFactor):i.target.add(d),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let Ph=!1;if(i.zoomToCursor&&M||i.object.isOrthographicCamera)a.radius=he(a.radius);else{i.enableDamping?u=ct.lerp(u,h,i.dampingFactor):u=h;const Mo=a.radius;a.radius=he(a.radius*u),Ph=Mo!=a.radius}if(N.setFromSpherical(a),N.applyQuaternion(tt),sd.copy(i.target).add(N),i.object.parent?i.object.parent.worldToLocal(sd):i.object.position.copy(sd),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,d.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),d.set(0,0,0)),i.zoomToCursor&&M){let Mo=null;if(i.object.isPerspectiveCamera){const la=N.length();Mo=he(la*h);const rd=la-Mo;i.object.position.addScaledVector(S,rd),i.object.updateMatrixWorld(),Ph=!!rd}else if(i.object.isOrthographicCamera){const la=new w(E.x,E.y,0);la.unproject(i.object);const rd=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/h)),i.object.updateProjectionMatrix(),Ph=rd!==i.object.zoom;const wc=new w(E.x,E.y,0);wc.unproject(i.object),i.object.position.sub(wc).add(la),i.object.updateMatrixWorld(),Mo=N.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;Mo!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(Mo).add(i.object.position):(zA.origin.copy(i.object.position),zA.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(zA.direction))<$V?t.lookAt(i.target):(gR.setFromNormalAndCoplanarPoint(i.object.up,i.target),zA.intersectPlane(gR,i.target))))}else if(i.object.isOrthographicCamera){const Mo=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/h)),Mo!==i.object.zoom&&(i.object.updateProjectionMatrix(),Ph=!0)}return h=1,M=!1,Ph||Qt.distanceToSquared(i.object.position)>o||8*(1-ks.dot(i.object.quaternion))>o||br.distanceToSquared(i.target)>o?(i.dispatchEvent(fR),Qt.copy(i.object.position),ks.copy(i.object.quaternion),br.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",as),i.domElement.removeEventListener("pointerdown",Xr),i.domElement.removeEventListener("pointercancel",kn),i.domElement.removeEventListener("wheel",rs),i.domElement.removeEventListener("pointermove",vr),window.removeEventListener("pointerup",kn),i.domElement.getRootNode().removeEventListener("keydown",Ms,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",Ji),i._domElementKeyEvents=null)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,a=new v1,l=new v1;let h=1,u=1;const d=new w,f=new oe,p=new oe,g=new oe,m=new oe,v=new oe,y=new oe,b=new oe,_=new oe,x=new oe,S=new w,E=new oe;let M=!1;const I=[],B={};let R=!1;function P(N){return N!==null?2*Math.PI/60*i.autoRotateSpeed*N:2*Math.PI/60/60*i.autoRotateSpeed}function F(N){const K=Math.abs(N*.01);return Math.pow(.95,i.zoomSpeed*K)}function j(N){l.theta-=N}function V(N){l.phi-=N}const X=function(){const N=new w;return function(tt,Qt){N.setFromMatrixColumn(Qt,0),N.multiplyScalar(-tt),d.add(N)}}(),k=function(){const N=new w;return function(tt,Qt){i.screenSpacePanning===!0?N.setFromMatrixColumn(Qt,1):(N.setFromMatrixColumn(Qt,0),N.crossVectors(i.object.up,N)),N.multiplyScalar(tt),d.add(N)}}(),O=function(){const N=new w,K=new w;return function(Qt,ks){const br=i.domElement;if(i.object.isPerspectiveCamera){i.object.getWorldPosition(K),N.copy(K).sub(i.target);let tr=N.length();tr*=Math.tan(i.object.fov/2*Math.PI/180),X(2*Qt*tr/br.clientHeight,i.object.matrixWorld),k(2*ks*tr/br.clientHeight,i.object.matrixWorld)}else i.object.isOrthographicCamera?(X(Qt*(i.object.right-i.object.left)/i.object.zoom/br.clientWidth,i.object.matrixWorld),k(ks*(i.object.top-i.object.bottom)/i.object.zoom/br.clientHeight,i.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function H(N){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?h/=N:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ee(N){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?h*=N:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Y(N,K){if(!i.zoomToCursor)return;M=!0;const tt=i.domElement.getBoundingClientRect(),Qt=N-tt.left,ks=K-tt.top,br=tt.width,tr=tt.height;E.x=Qt/br*2-1,E.y=-(ks/tr)*2+1,S.set(E.x,E.y,1).unproject(i.object).sub(i.object.position).normalize()}function he(N){return Math.max(i.minDistance,Math.min(i.maxDistance,N))}function ue(N){f.set(N.clientX,N.clientY)}function _e(N){Y(N.clientX,N.clientX),b.set(N.clientX,N.clientY)}function Se(N){m.set(N.clientX,N.clientY)}function qe(N){p.set(N.clientX,N.clientY),g.subVectors(p,f).multiplyScalar(i.rotateSpeed);const K=i.domElement;j(2*Math.PI*g.x/K.clientHeight),V(2*Math.PI*g.y/K.clientHeight),f.copy(p),i.update()}function Pe(N){_.set(N.clientX,N.clientY),x.subVectors(_,b),x.y>0?H(F(x.y)):x.y<0&&ee(F(x.y)),b.copy(_),i.update()}function Ye(N){v.set(N.clientX,N.clientY),y.subVectors(v,m).multiplyScalar(i.panSpeed),O(y.x,y.y),m.copy(v),i.update()}function Pt(N){Y(N.clientX,N.clientY),N.deltaY<0?ee(F(N.deltaY)):N.deltaY>0&&H(F(N.deltaY)),i.update()}function Tt(N){let K=!1;switch(N.code){case i.keys.UP:N.ctrlKey||N.metaKey||N.shiftKey?V(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(0,i.keyPanSpeed),K=!0;break;case i.keys.BOTTOM:N.ctrlKey||N.metaKey||N.shiftKey?V(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(0,-i.keyPanSpeed),K=!0;break;case i.keys.LEFT:N.ctrlKey||N.metaKey||N.shiftKey?j(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(i.keyPanSpeed,0),K=!0;break;case i.keys.RIGHT:N.ctrlKey||N.metaKey||N.shiftKey?j(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(-i.keyPanSpeed,0),K=!0;break}K&&(N.preventDefault(),i.update())}function ci(N){if(I.length===1)f.set(N.pageX,N.pageY);else{const K=Zi(N),tt=.5*(N.pageX+K.x),Qt=.5*(N.pageY+K.y);f.set(tt,Qt)}}function Ei(N){if(I.length===1)m.set(N.pageX,N.pageY);else{const K=Zi(N),tt=.5*(N.pageX+K.x),Qt=.5*(N.pageY+K.y);m.set(tt,Qt)}}function Bs(N){const K=Zi(N),tt=N.pageX-K.x,Qt=N.pageY-K.y,ks=Math.sqrt(tt*tt+Qt*Qt);b.set(0,ks)}function Vr(N){i.enableZoom&&Bs(N),i.enablePan&&Ei(N)}function ss(N){i.enableZoom&&Bs(N),i.enableRotate&&ci(N)}function Ar(N){if(I.length==1)p.set(N.pageX,N.pageY);else{const tt=Zi(N),Qt=.5*(N.pageX+tt.x),ks=.5*(N.pageY+tt.y);p.set(Qt,ks)}g.subVectors(p,f).multiplyScalar(i.rotateSpeed);const K=i.domElement;j(2*Math.PI*g.x/K.clientHeight),V(2*Math.PI*g.y/K.clientHeight),f.copy(p)}function Wr(N){if(I.length===1)v.set(N.pageX,N.pageY);else{const K=Zi(N),tt=.5*(N.pageX+K.x),Qt=.5*(N.pageY+K.y);v.set(tt,Qt)}y.subVectors(v,m).multiplyScalar(i.panSpeed),O(y.x,y.y),m.copy(v)}function qr(N){const K=Zi(N),tt=N.pageX-K.x,Qt=N.pageY-K.y,ks=Math.sqrt(tt*tt+Qt*Qt);_.set(0,ks),x.set(0,Math.pow(_.y/b.y,i.zoomSpeed)),H(x.y),b.copy(_);const br=(N.pageX+K.x)*.5,tr=(N.pageY+K.y)*.5;Y(br,tr)}function To(N){i.enableZoom&&qr(N),i.enablePan&&Wr(N)}function Ro(N){i.enableZoom&&qr(N),i.enableRotate&&Ar(N)}function Xr(N){i.enabled!==!1&&(I.length===0&&(i.domElement.setPointerCapture(N.pointerId),i.domElement.addEventListener("pointermove",vr),window.addEventListener("pointerup",kn)),!yt(N)&&(dn(N),N.pointerType==="touch"?os(N):$s(N)))}function vr(N){i.enabled!==!1&&(N.pointerType==="touch"?er(N):yr(N))}function kn(N){switch(zt(N),I.length){case 0:i.domElement.releasePointerCapture(N.pointerId),i.domElement.removeEventListener("pointermove",vr),i.domElement.removeEventListener("pointerup",kn),i.dispatchEvent(pR),r=s.NONE;break;case 1:const K=I[0],tt=B[K];os({pointerId:K,pageX:tt.x,pageY:tt.y});break}}function $s(N){let K;switch(N.button){case 0:K=i.mouseButtons.LEFT;break;case 1:K=i.mouseButtons.MIDDLE;break;case 2:K=i.mouseButtons.RIGHT;break;default:K=-1}switch(K){case od.DOLLY:if(i.enableZoom===!1)return;_e(N),r=s.DOLLY;break;case od.ROTATE:if(N.ctrlKey||N.metaKey||N.shiftKey){if(i.enablePan===!1)return;Se(N),r=s.PAN}else{if(i.enableRotate===!1)return;ue(N),r=s.ROTATE}break;case od.PAN:if(N.ctrlKey||N.metaKey||N.shiftKey){if(i.enableRotate===!1)return;ue(N),r=s.ROTATE}else{if(i.enablePan===!1)return;Se(N),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(W_)}function yr(N){switch(r){case s.ROTATE:if(i.enableRotate===!1)return;qe(N);break;case s.DOLLY:if(i.enableZoom===!1)return;Pe(N);break;case s.PAN:if(i.enablePan===!1)return;Ye(N);break}}function rs(N){i.enabled===!1||i.enableZoom===!1||r!==s.NONE||(N.preventDefault(),i.dispatchEvent(W_),Pt(Ps(N)),i.dispatchEvent(pR))}function Ps(N){const K=N.deltaMode,tt={clientX:N.clientX,clientY:N.clientY,deltaY:N.deltaY};switch(K){case 1:tt.deltaY*=16;break;case 2:tt.deltaY*=100;break}return N.ctrlKey&&!R&&(tt.deltaY*=10),tt}function Ms(N){N.key==="Control"&&(R=!0,i.domElement.getRootNode().addEventListener("keyup",Dn,{passive:!0,capture:!0}))}function Dn(N){N.key==="Control"&&(R=!1,i.domElement.getRootNode().removeEventListener("keyup",Dn,{passive:!0,capture:!0}))}function Ji(N){i.enabled===!1||i.enablePan===!1||Tt(N)}function os(N){switch(pl(N),I.length){case 1:switch(i.touches.ONE){case ad.ROTATE:if(i.enableRotate===!1)return;ci(N),r=s.TOUCH_ROTATE;break;case ad.PAN:if(i.enablePan===!1)return;Ei(N),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case ad.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Vr(N),r=s.TOUCH_DOLLY_PAN;break;case ad.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;ss(N),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(W_)}function er(N){switch(pl(N),r){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;Ar(N),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;Wr(N),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;To(N),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ro(N),i.update();break;default:r=s.NONE}}function as(N){i.enabled!==!1&&N.preventDefault()}function dn(N){I.push(N.pointerId)}function zt(N){delete B[N.pointerId];for(let K=0;K<I.length;K++)if(I[K]==N.pointerId){I.splice(K,1);return}}function yt(N){for(let K=0;K<I.length;K++)if(I[K]==N.pointerId)return!0;return!1}function pl(N){let K=B[N.pointerId];K===void 0&&(K=new oe,B[N.pointerId]=K),K.set(N.pageX,N.pageY)}function Zi(N){const K=N.pointerId===I[0]?I[1]:I[0];return B[K]}i.domElement.addEventListener("contextmenu",as),i.domElement.addEventListener("pointerdown",Xr),i.domElement.addEventListener("pointercancel",kn),i.domElement.addEventListener("wheel",rs,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",Ms,{passive:!0,capture:!0}),this.update()}};var Dm=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const mR=z("debuggroundprojection");class bh extends re{constructor(){super(...arguments);c(this,"applyOnAwake",!1);c(this,"autoFit",!0);c(this,"_radius",50);c(this,"_height",3);c(this,"_arblending",0);c(this,"_lastEnvironment");c(this,"_lastRadius");c(this,"_lastHeight");c(this,"_projection");c(this,"_watcher");c(this,"_needsTextureUpdate",!1);c(this,"_blurrynessShader",null);c(this,"_lastBlurriness",-1)}set radius(e){this._radius=e,this.updateProjection()}get radius(){return this._radius}set height(e){this._height=e,this.updateProjection()}get height(){return this._height}set arBlending(e){this._arblending=e,this._needsTextureUpdate=!0}get arBlending(){return this._arblending}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new $c(this.context.scene,"environment"),this._watcher.subscribeWrite(e=>{this.updateProjection()}))}onDisable(){var e,i;(e=this._watcher)==null||e.revoke(),(i=this._projection)==null||i.removeFromParent()}onEnterXR(){this.activeAndEnabled&&(this._needsTextureUpdate=!0,this.updateProjection())}async onLeaveXR(){this.activeAndEnabled&&(await UC(1),this.updateProjection())}onBeforeRender(){this._projection&&this.scene.backgroundRotation&&this._projection.rotation.copy(this.scene.backgroundRotation),this.context.scene.backgroundBlurriness!==void 0&&this._lastBlurriness!=this.context.scene.backgroundBlurriness&&this.context.scene.backgroundBlurriness>.001?this.updateProjection():this._needsTextureUpdate&&this.updateBlurriness()}updateAndCreate(){var e;this.updateProjection(),(e=this._watcher)==null||e.apply()}updateProjection(){var i,s,r,o,a;if(!this.context.scene.environment){(i=this._projection)==null||i.removeFromParent();return}if(((s=this.context.xr)!=null&&s.isPassThrough||(r=this.context.xr)!=null&&r.isAR)&&this.arBlending===0){(o=this._projection)==null||o.removeFromParent();return}if(!this.gameObject||this.destroyed)return;const e=0;if((!this._projection||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius)&&(mR&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(a=this._projection)==null||a.removeFromParent(),this._projection=new If(this.context.scene.environment,this._height,this.radius,64),this._projection.position.y=this._height-e,this._projection.name="GroundProjection",YM(this._projection,!1)),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this._projection.parent||this.gameObject.add(this._projection),this.autoFit){this._projection.updateWorldMatrix(!0,!0);const l=sl(this.context.scene.children,[this._projection]),h=l.min.y;if(h<1/0){const u=He(this._projection);u.x=l.min.x+(l.max.x-l.min.x)*.5,u.y=h+this._height-e,u.z=l.min.z+(l.max.z-l.min.z)*.5,Cn(this._projection,u)}}(this.context.scene.backgroundBlurriness>.001||this._needsTextureUpdate)&&this.updateBlurriness(),this._needsTextureUpdate=!1}updateBlurriness(){var i;if(this._projection){if(!this.context.scene.environment)return}else return;this._needsTextureUpdate=!1,mR&&console.log("Update Blurriness",this.context.scene.backgroundBlurriness),this._blurrynessShader??(this._blurrynessShader=new $e({name:"GroundProjectionBlurriness",uniforms:{map:{value:this.context.scene.environment},blurriness:{value:this.context.scene.backgroundBlurriness},blending:{value:0},alphaFactor:{value:1}},vertexShader:e9,fragmentShader:t9})),this._blurrynessShader.depthWrite=!1,this._blurrynessShader.uniforms.blurriness.value=this.context.scene.backgroundBlurriness,this._lastBlurriness=this.context.scene.backgroundBlurriness,this.context.scene.environment.needsPMREMUpdate=!0;const e=this._projection.material.transparent;this._projection.material.transparent=(((i=this.context.xr)==null?void 0:i.isAR)===!0&&this.arBlending>1e-6)??!1,this._projection.material.transparent?this._blurrynessShader.uniforms.blending.value=this.arBlending:this._blurrynessShader.uniforms.blending.value=0,this.context.isInPassThrough?this._blurrynessShader.uniforms.alphaFactor.value=.95:this._blurrynessShader.uniforms.alphaFactor.value=1,e!==this._projection.material.transparent&&(this._projection.material.needsUpdate=!0),this._projection.material.map=Go.copyTexture(this.context.scene.environment,this._blurrynessShader),this._projection.material.depthTest=!0,this._projection.material.depthWrite=!1}}Dm([A()],bh.prototype,"applyOnAwake",void 0);Dm([A()],bh.prototype,"autoFit",void 0);Dm([A()],bh.prototype,"radius",null);Dm([A()],bh.prototype,"height",null);Dm([A()],bh.prototype,"arBlending",null);const e9=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,t9=`
  uniform sampler2D map;
  uniform float blurriness;
  uniform float alphaFactor;
  uniform float blending;
  varying vec2 vUv;

  const float PI = 3.14159265359;

  // Gaussian function
  float gaussian(float x, float sigma) {
    return exp(-(x * x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * PI) * sigma);
  }

  // Custom smoothstep function for desired falloff
  float customSmoothstep(float edge0, float edge1, float x) {
    float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return t * t * (3.0 - 2.0 * t);
  }

  void main() {
    vec2 center = vec2(0.0, 0.0);
    vec2 pos = vUv;
    pos.x = 0.0; // Only consider vertical distance
    float distance = length(pos - center);
    
    // Calculate blur amount based on custom falloff
    float blurAmount = customSmoothstep(0.5, 1.0, distance * 2.0);
    blurAmount = clamp(blurAmount, 0.0, 1.0); // Ensure blur amount is within valid range

    // Gaussian blur
    vec2 pixelSize = 1.0 / vec2(textureSize(map, 0));
    vec4 color = vec4(0.0);
    float totalWeight = 0.0;
    int blurSize = int(60.0 * min(1.0, blurriness) * blurAmount); // Adjust blur size based on distance and blurriness
    float lodLevel = log2(float(blurSize)) * 0.5; // Compute LOD level

    for (int x = -blurSize; x <= blurSize; x++) {
        for (int y = -blurSize; y <= blurSize; y++) {
            vec2 offset = vec2(float(x), float(y)) * pixelSize * blurAmount;
            float weight = gaussian(length(vec2(float(x), float(y))), 1000.0 * blurAmount); // Use a fixed sigma value
            color += textureLod(map, vUv + offset, lodLevel) * weight;
            totalWeight += weight;
        }
    }

    color = totalWeight > 0.0 ? color / totalWeight : texture2D(map, vUv);

    gl_FragColor = color;

    float brightness = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));
    float stepFactor = blending - brightness * .1;
    gl_FragColor.a = pow(1.0 - blending * customSmoothstep(0.35 * stepFactor, 0.45 * stepFactor, distance), 5.);
    gl_FragColor.a *= alphaFactor;
    // gl_FragColor.rgb = vec3(1.0);

    // #include <tonemapping_fragment>
    // #include <colorspace_fragment>
    
    // Uncomment to visualize blur amount
    // gl_FragColor = vec4(blurAmount, 0.0, 0.0, 1.0);
  }
`;var JS=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class jf extends re{constructor(){super(...arguments);c(this,"constraintActive",!0);c(this,"locked",!1);c(this,"sources",[])}}JS([A()],jf.prototype,"constraintActive",void 0);JS([A()],jf.prototype,"locked",void 0);JS([A(ne)],jf.prototype,"sources",void 0);function hJ(n,t){return Ah(n,dt.ContextCreated,t),()=>vh(n,dt.ContextCreated)}function uJ(n,t){return Ah(n,dt.ContextClearing,t),()=>vh(n,dt.ContextClearing)}function dJ(n,t){return Ah(n,dt.ContextDestroying,t),()=>vh(n,dt.ContextDestroying)}function JO(n,t){return Ah(n,We.Start,t),()=>vh(n,We.Start)}function ZO(n,t){return Ah(n,We.Update,t),()=>vh(n,We.Update)}function i9(n,t){return Ah(n,We.OnBeforeRender,t),()=>vh(n,We.OnBeforeRender)}function fJ(n,t){return Ah(n,We.OnAfterRender,t),()=>vh(n,We.OnAfterRender)}class mu{constructor(){c(this,"bb",null);c(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(t,e,i,s){return t.prep(4,12),t.writeFloat32(s),t.writeFloat32(i),t.writeFloat32(e),t.offset()}}class $O{constructor(){c(this,"bb",null);c(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}position(t){return(t||new mu).__init(this.bb_pos,this.bb)}rotation(t){return(t||new mu).__init(this.bb_pos+12,this.bb)}scale(t){return(t||new mu).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(t,e,i,s,r,o,a,l,h,u){return t.prep(4,36),t.prep(4,12),t.writeFloat32(u),t.writeFloat32(h),t.writeFloat32(l),t.prep(4,12),t.writeFloat32(a),t.writeFloat32(o),t.writeFloat32(r),t.prep(4,12),t.writeFloat32(s),t.writeFloat32(i),t.writeFloat32(e),t.offset()}}class zl{constructor(){c(this,"bb",null);c(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSyncedTransformModel(t,e){return(e||new zl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSyncedTransformModel(t,e){return t.setPosition(t.position()+SS),(e||new zl).__init(t.readInt32(t.position())+t.position(),t)}guid(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}fast(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}transform(t){const e=this.bb.__offset(this.bb_pos,8);return e?(t||new $O).__init(this.bb_pos+e,this.bb):null}dontSave(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startSyncedTransformModel(t){t.startObject(4)}static addGuid(t,e){t.addFieldOffset(0,e,0)}static addFast(t,e){t.addFieldInt8(1,+e,0)}static addTransform(t,e){t.addFieldStruct(2,e,0)}static addDontSave(t,e){t.addFieldInt8(3,+e,0)}static endSyncedTransformModel(t){return t.endObject()}static finishSyncedTransformModelBuffer(t,e){t.finish(e)}static finishSizePrefixedSyncedTransformModelBuffer(t,e){t.finish(e,void 0,!0)}}var mn;(function(n){n[n.Average=0]="Average",n[n.Multiply=1]="Multiply",n[n.Minimum=2]="Minimum",n[n.Maximum=3]="Maximum"})(mn||(mn={}));var by;(function(n){n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous"})(by||(by={}));var ki;(function(n){n[n.None=0]="None",n[n.FreezePositionX=2]="FreezePositionX",n[n.FreezePositionY=4]="FreezePositionY",n[n.FreezePositionZ=8]="FreezePositionZ",n[n.FreezePosition=14]="FreezePosition",n[n.FreezeRotationX=16]="FreezeRotationX",n[n.FreezeRotationY=32]="FreezeRotationY",n[n.FreezeRotationZ=64]="FreezeRotationZ",n[n.FreezeRotation=112]="FreezeRotation",n[n.FreezeAll=126]="FreezeAll"})(ki||(ki={}));var Ud;(function(n){n[n.None=0]="None",n[n.X=2]="X",n[n.Y=4]="Y",n[n.Z=8]="Z",n[n.All=-1]="All"})(Ud||(Ud={}));const Ss=function(n,t){return function(e,i,s){n9(e,i,s,n,t)}};function n9(n,t,e,i,s){if(!s&&!i&&!n.onValidate)return;if(e!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",n,t,e),bi("Invalid usage of validate decorator. Only fields can be validated. Property: "+t,Xi.Error);return}let r="";if(typeof t=="string"?r=t:r=t.name,n.__internalAwake){const o=Symbol(r),a=n.__internalAwake;n.__internalAwake=function(){var l;if(!this.onValidate){ve()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((l=n.constructor)==null?void 0:l.name)+'"');return}if(this[o]===void 0){this[o]=this[r];const h=this[r];if(h instanceof oe||h instanceof w||h instanceof Fe||h instanceof ie){const u=this[r];NC(u,()=>{this.onValidate(r)})}Object.defineProperty(this,r,{set:function(u){var d;if(this[Rx]===!0)this[o]=u;else{i==null||i.call(this,u);const f=this[o];this[o]=u,(d=this.onValidate)==null||d.call(this,r,f)}},get:function(){return s==null||s.call(this),this[o]}})}a.call(this)}}}const pJ=function(n){return function(t,e,i){let s="";typeof e=="string"?s=e:s=e.name;const r=n.prototype,o=Object.getOwnPropertyDescriptor(r,s);if(!(o!=null&&o.value)){console.warn("Can not apply prefix: type does not have method named",e,n);return}const a=o.value,l=t[s];Object.defineProperty(r,s,{value:function(...h){const u=l==null?void 0:l.call(this,...h);if(u instanceof Promise){u.then(d=>{if(d!==!1)return a.call(this,...h)});return}if(u!==!1)return a.call(this,...h)}})}};var Nr=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class s9{constructor(t,e){c(this,"positionChanged",!1);c(this,"rotationChanged",!1);c(this,"position");c(this,"quaternion");c(this,"_positionKeys",["x","y","z"]);c(this,"_quaternionKeys",["_x","_y","_z","_w"]);c(this,"mute",!1);c(this,"context");c(this,"obj");c(this,"_positionWatch");c(this,"_rotationWatch");this.context=e,this.obj=t}get isDirty(){return this.positionChanged||this.rotationChanged}reset(t=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,t){if(this.position)for(const e of this._positionKeys)delete this.position[e];if(this.quaternion)for(const e of this._quaternionKeys)delete this.quaternion[e]}}syncValues(){for(const t of this._positionKeys)this.position[t]=this.obj.position[t];for(const t of this._quaternionKeys)this.quaternion[t]=this.obj.quaternion[t]}applyValues(){if(this.positionChanged&&this.position)for(const t of this._positionKeys){const e=this.position[t];e!==void 0&&(this.obj.position[t]=e)}if(this.rotationChanged&&this.quaternion)for(const t of this._quaternionKeys){const e=this.quaternion[t];e!==void 0&&(this.obj.quaternion[t]=e)}}start(t,e){this.reset(),t&&(this._positionWatch||(this._positionWatch=new $c(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.position[o];Math.abs(a-r)<1e-5||(this.position[o]=r,this.positionChanged=!0)})),e&&(this._rotationWatch||(this._rotationWatch=new $c(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.quaternion[o];Math.abs(a-r)<1e-5||(this.quaternion[o]=r,this.rotationChanged=!0)}));const i=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),s=new ae;this.obj.matrixWorld.multiplyMatrices=(r,o)=>{var a;return(a=this.context.physics.engine)!=null&&a.isUpdating||this.mute||s.equals(r)||(this.positionChanged=!0,this.rotationChanged=!0,s.copy(r)),i(r,o)}}stop(){var t,e;(t=this._positionWatch)==null||t.revoke(),(e=this._rotationWatch)==null||e.revoke()}}const $y=class extends re{constructor(){super(...arguments);c(this,"autoMass",!0);c(this,"_mass",0);c(this,"useGravity",!0);c(this,"centerOfMass",new w(0,0,0));c(this,"constraints",ki.None);c(this,"isKinematic",!1);c(this,"drag",0);c(this,"angularDrag",1);c(this,"detectCollisions",!0);c(this,"sleepThreshold",.01);c(this,"collisionDetectionMode",by.Discrete);c(this,"_gravityScale",1);c(this,"dominanceGroup",0);c(this,"_propertiesChanged",!1);c(this,"_currentVelocity",new w);c(this,"_smoothedVelocity",new w);c(this,"_smoothedVelocityGetter",new w);c(this,"_lastPosition",new w);c(this,"_watch")}set mass(e){e!==this._mass&&(this._mass=e,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var e,i;return this.autoMass?((i=(e=this.context.physics.engine)==null?void 0:e.getBody(this))==null?void 0:i.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&ki.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&ki.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&ki.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&ki.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&ki.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&ki.FreezeRotationZ)!==0}set lockPositionX(e){e?this.constraints|=ki.FreezePositionX:this.constraints&=~ki.FreezePositionX}set lockPositionY(e){e?this.constraints|=ki.FreezePositionY:this.constraints&=~ki.FreezePositionY}set lockPositionZ(e){e?this.constraints|=ki.FreezePositionZ:this.constraints&=~ki.FreezePositionZ}set lockRotationX(e){e?this.constraints|=ki.FreezeRotationX:this.constraints&=~ki.FreezeRotationX}set lockRotationY(e){e?this.constraints|=ki.FreezeRotationY:this.constraints&=~ki.FreezeRotationY}set lockRotationZ(e){e?this.constraints|=ki.FreezeRotationZ:this.constraints&=~ki.FreezeRotationZ}set gravityScale(e){this._gravityScale=e}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){var e;this._watch||(this._watch=new s9(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),We.LateUpdate),ve()&&!((e=this.context.physics.engine)!=null&&e.getBody(this))&&console.warn(`Rigidbody was not created: Does your object (${this.name}) have a collider?`)}onDisable(){var e,i;(e=this._watch)==null||e.stop(),(i=this.context.physics.engine)==null||i.removeBody(this)}onDestroy(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){var e,i,s,r;for(;;)this._propertiesChanged&&(this._propertiesChanged=!1,(e=this.context.physics.engine)==null||e.updateProperties(this)),(i=this._watch)!=null&&i.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(s=this.context.physics.engine)==null||s.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(r=this._watch)==null||r.syncValues(),this.captureVelocity(),yield}teleport(e,i=!0){var s;(s=this._watch)==null||s.reset(!0),i?this.gameObject.position.set(e.x,e.y,e.z):this.setWorldPosition(e.x,e.y,e.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(e=!0){var i;(i=this.context.physics.engine)==null||i.resetForces(this,e)}resetTorques(e=!0){var i;(i=this.context.physics.engine)==null||i.resetTorques(this,e)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var e;(e=this.context.physics.engine)==null||e.wakeup(this)}get isSleeping(){var e;return(e=this.context.physics.engine)==null?void 0:e.isSleeping(this)}updateProperties(){var e;return this._propertiesChanged=!1,(e=this.context.physics.engine)==null?void 0:e.updateProperties(this)}applyForce(e,i,s=!0){var r;this._propertiesChanged&&this.updateProperties(),(r=this.context.physics.engine)==null||r.addForce(this,e,s)}applyImpulse(e,i=!0){var s;this._propertiesChanged&&this.updateProperties(),(s=this.context.physics.engine)==null||s.applyImpulse(this,e,i)}setForce(e,i,s,r=!0){var o,a,l;(o=this.context.physics.engine)==null||o.resetForces(this,r),typeof e=="number"?(i??(i=0),s??(s=0),(a=this.context.physics.engine)==null||a.addForce(this,{x:e,y:i,z:s},r)):(l=this.context.physics.engine)==null||l.addForce(this,e,r)}getVelocity(){var i;const e=(i=this.context.physics.engine)==null?void 0:i.getLinearVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(e,i,s,r=!0){var o,a;if(e instanceof w){const l=e;(o=this.context.physics.engine)==null||o.setLinearVelocity(this,l,r);return}i===void 0||s===void 0||(a=this.context.physics.engine)==null||a.setLinearVelocity(this,{x:e,y:i,z:s},r)}getAngularVelocity(){var i;const e=(i=this.context.physics.engine)==null?void 0:i.getAngularVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(e,i,s,r=!0){var o,a;if(typeof e=="object"){const l=e;(o=this.context.physics.engine)==null||o.setAngularVelocity(this,l,r);return}if(i===void 0||s===void 0||typeof i=="boolean"){console.warn("setAngularVelocity expects either a Vec3 or 3 numbers");return}(a=this.context.physics.engine)==null||a.setAngularVelocity(this,{x:e,y:i,z:s},r)}setTorque(e,i,s){typeof e=="number"?this.setAngularVelocity(e,i,s):this.setAngularVelocity(e)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(e=null){}captureVelocity(){const e=He(this.gameObject);this.gameObject.matrixWorld.decompose($y.tempPosition,r9,o9);const i=e.sub(this._lastPosition);this._lastPosition.copy($y.tempPosition),this._smoothedVelocity.lerp(i,this.context.time.deltaTime/.1)}};let It=$y;c(It,"tempPosition",new w);Nr([Ss()],It.prototype,"autoMass",void 0);Nr([A()],It.prototype,"mass",null);Nr([Ss(),A()],It.prototype,"useGravity",void 0);Nr([A(w)],It.prototype,"centerOfMass",void 0);Nr([Ss(),A()],It.prototype,"constraints",void 0);Nr([Ss(),A()],It.prototype,"isKinematic",void 0);Nr([Ss(),A()],It.prototype,"drag",void 0);Nr([Ss(),A()],It.prototype,"angularDrag",void 0);Nr([Ss(),A()],It.prototype,"detectCollisions",void 0);Nr([Ss(),A()],It.prototype,"sleepThreshold",void 0);Nr([Ss(),A()],It.prototype,"collisionDetectionMode",void 0);Nr([Ss()],It.prototype,"_gravityScale",void 0);Nr([Ss()],It.prototype,"dominanceGroup",void 0);new w;const r9=new ie,o9=new w,Lc=z("debugsync"),lm="STRS";Xk(lm,zl.getRootAsSyncedTransformModel);const da=new Em;function e2(n,t,e=!0){da.clear();const i=da.createString(n);zl.startSyncedTransformModel(da),zl.addGuid(da,i),zl.addFast(da,e);const s=t.worldPosition,r=t.worldEuler,o=t.gameObject.scale;zl.addTransform(da,$O.createTransform(da,s.x,s.y,s.z,r.x,r.y,r.z,o.x,o.y,o.z));const a=zl.endSyncedTransformModel(da);return da.finish(a,lm),da.asUint8Array()}let Hx=0,pg=0;ZO(n=>{var i;const e=((i=n.connection.currentServerUrl)==null?void 0:i.includes("glitch"))?10:40;pg=Math.floor(Hx/e),Hx=0,Lc&&pg>0&&console.log("Sync Transform Fast Interval",pg)});class oc extends re{constructor(){super(...arguments);c(this,"overridePhysics",!0);c(this,"interpolatePosition",!0);c(this,"interpolateRotation",!0);c(this,"fastMode",!1);c(this,"syncDestroy",!1);c(this,"_model",null);c(this,"_needsUpdate",!0);c(this,"rb",null);c(this,"_wasKinematic",!1);c(this,"_receivedDataBefore",!1);c(this,"_targetPosition");c(this,"_targetRotation");c(this,"_receivedFastUpdate",!1);c(this,"_shouldRequestOwnership",!1);c(this,"joinedRoomCallback",null);c(this,"receivedDataCallback",null);c(this,"tempEuler",new jt);c(this,"receivedUpdate",!1);c(this,"lastWorldPos");c(this,"lastWorldRotation")}requestOwnership(){Lc&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var e;return((e=this._model)==null?void 0:e.hasOwnership)??void 0}isOwned(){var e;return(e=this._model)==null?void 0:e.isOwned}awake(){Lc&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new w,this._targetRotation=new ie,this.lastWorldPos=new w,this.lastWorldRotation=new ie,this.rb=Q.getComponentInChildren(this.gameObject,It),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new UD(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(Qe.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(lm,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&ZD(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(Qe.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(lm,this.receivedDataCallback)}tryGetLastState(){const e=this.context.connection.tryGetState(this.guid);e&&this.onReceivedData(e)}onReceivedData(e){var i;if(!this.destroyed&&typeof e.guid=="function"&&e.guid()===this.guid){Lc&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,e),this.receivedUpdate=!0,this._receivedFastUpdate=e.fast();const s=e.transform();if(s){ea.markDirty(this.gameObject,!0);const r=s.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=s.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&qM(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){Lc&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const e=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=e.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(Lc&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,e.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),ea.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const a=this._receivedFastUpdate||this.fastMode?.5:.3;let l=!1;if(this.interpolatePosition&&this._targetPosition){const h=this.worldPosition;h.lerp(this._targetPosition,a),this.worldPosition=h,l=!0}if(this.interpolateRotation&&this._targetRotation){const h=this.worldQuaternion;h.slerp(this._targetRotation,a),this.worldQuaternion=h,l=!0}l&&ea.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(e),this.lastWorldRotation.copy(i),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(Lc&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const s=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%s===0||r)){if(Hx++,r&&pg>0&&this.context.time.frameCount%pg!==0)return;Lc&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this._needsUpdate=!1;const o=e2(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}const a9=z("debugshadowcomponents");uS.prototype.interactable={get(){return this.interactive},set(n){this.interactable=n}};const fo=Symbol("shadowDomOwner");class na extends re{constructor(){super(...arguments);c(this,"_shadowComponent",null);c(this,"_controlsChildLayout",!0);c(this,"_root");c(this,"_parentComponent")}isRoot(){var e;return((e=this.Root)==null?void 0:e.gameObject)===this.gameObject}get canvas(){const e=this.Root;return e!=null&&e.isCanvas?e:null}get Canvas(){return this.canvas}markDirty(){kr.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(e){this._shadowComponent=e}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(e){this._controlsChildLayout=e,this.shadowComponent&&(this.shadowComponent.autoLayout=e)}get Root(){return this._root===void 0&&(this._root=Q.getComponentInParent(this.gameObject,N0)),this._root}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(e,i){var o;if(!e)return;this.removeShadowComponent();const s=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=Q.getComponentInParent(s,na),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}e.name=this.name+" ("+(this.constructor.name??"UI")+")",e.autoLayout=this._parentComponent.controlsChildLayout,e[fo]=this,this.setShadowComponentOwner(e);let r=!1;if(((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(e);else{const a=this._parentComponent.shadowComponent;a&&(a==null||a.add(e),r=!0)}this.shadowComponent=e,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),Tm&&e.add(new dr(.5)),this.onAfterAddedToScene(),r&&QM(),a9&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(e){if(e&&(e[fo]===void 0||e[fo]===this)&&(e[fo]=this,e.children))for(const i of e.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(e,i,s){if(e&&e[fo]===i){s(e);for(const r of e.children)this.traverseOwnedShadowComponents(r,i,s)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(e){this.shadowComponent&&(this.shadowComponent.interactable=e)}}class N0 extends na{awake(){super.awake()}}class Om{constructor(t,e){c(this,"event");c(this,"button");c(this,"buttonName");c(this,"_used",!1);c(this,"_propagationStopped",!1);c(this,"z__pointer_ctured",!1);c(this,"z__pointer_cture_rleased",!1);c(this,"inputSource");c(this,"object");c(this,"point");c(this,"normal");c(this,"face");c(this,"distance");c(this,"instanceId");c(this,"intersection");c(this,"isDown");c(this,"isUp");c(this,"isPressed");c(this,"isClick");c(this,"isDoubleClick");c(this,"input");this.event=e,this.input=t,this.button=e.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use())}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const t=new Om(this.input,this.event);return Object.assign(t,this),t}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function Vx(n,t){return Q.foreachComponent(n,i=>{if(!i.enabled)return;const s=i;if(t)switch(t){case"pointerdown":if(s.onPointerDown)return!0;break;case"pointerup":if(s.onPointerUp||s.onPointerClick)return!0;break;case"pointermove":if(s.onPointerEnter||s.onPointerExit||s.onPointerMove)return!0;break}else if(s.onPointerDown||s.onPointerUp||s.onPointerEnter||s.onPointerExit||s.onPointerClick)return!0},!1)===!0}var l9=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Lm extends re{awake(){kr.createIfNoneExists(this.context)}onEnable(){var t;(t=kr.get(this.context))==null||t.register(this)}onDisable(){var t;(t=kr.get(this.context))==null||t.unregister(this)}}class xo extends Lm{constructor(){super(...arguments);c(this,"targets",null);c(this,"raycastHits",[]);c(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(e=null){if(!this.targets)return null;e??(e=new rc),e.targets=this.targets,e.results=this.raycastHits,e.useAcceleratedRaycast=!0;const i=e.testObject;this.ignoreSkinnedMeshes&&(e.testObject=r=>r instanceof Zo?"continue in children":i?i(r):!0);const s=this.context.physics.raycast(e);return e.testObject=i,s}}l9([A()],xo.prototype,"ignoreSkinnedMeshes",void 0);class ZS extends xo{constructor(){super(),this.ignoreSkinnedMeshes=!0}}const n1=class extends Lm{performRaycast(t){if(!Le.active||!n1.allow||!(t!=null&&t.ray))return null;const e=t.ray.origin,i=.015;return this.context.physics.sphereOverlap(e,i,!1,!0)}};let Au=n1;c(Au,"allow",!0);class $S{static getObject(t){const e=t[fo];return e&&(e.isComponent===!0?t=e.gameObject:t=e),t}static isInteractable(t,e){if(e&&(e.canvasGroup=void 0,e.graphic=void 0),t==null||!t.visible||(t=this.getObject(t),!t.visible))return!1;const i=this.tryFindCanvasGroup(t);if((i==null?void 0:i.isCanvasGroup)===!0&&(e&&(e.canvasGroup=i),i.blocksRaycasts===!1||i.interactable===!1))return!1;const s=Df(t,r=>{if(r.isGraphic===!0)return r},!1);return e&&(s==null?void 0:s.isGraphic)===!0&&(e.graphic=s),!((s==null?void 0:s.raycastTarget)===!1||(s==null?void 0:s.layer)===2)}static tryFindCanvasGroup(t){if(!t)return null;const e=Df(t,i=>{const s=i;if(s.blocksRaycasts!==void 0&&s.interactable!==void 0)return s},!1);return e!==void 0?e:this.tryFindCanvasGroup(t.parent)}}function eE(n){const t=n[fo];return t||(n.parent?eE(n.parent):null)}function c9(n){return n.isUI===!0||typeof n[fo]=="object"}function _y(n,t){if(!n)return;const e=n.material;if((e==null?void 0:e.isMaterial)===!0){const i=n.parent;i&&i.isText,e.side=t.doubleSided??!0?_i:il,e.shadowSide=t.doubleSided?_i:il,n.castShadow=t.castShadows?t.castShadows:!1,n.receiveShadow=t.receiveShadows?t.receiveShadows:!1}for(const i of n.children)_y(i,t)}function Ed(n,t,e){n[t]===void 0&&console.warn("Field",t,"is undefined on",n);const i=Proxy.revocable(n[t],{set(o,a,l,h){const u=o[a],d=Reflect.set(o,a,l,h);return e(l,u),d}}),s=i.revoke,r=n[t];return i.revoke=()=>{n[t]=r,s()},n[t]=i.proxy,i}const AR=Symbol("Scheduled action");function h9(n,t,e=We.OnBeforeRender){let i=n[AR];i||(i=n[AR]={});const s=t.name;i[e]||(i[e]={});const r=i[e];if(r[s])return;function*a(){t==null||t.call(n),r[s]=null}const l=n.startCoroutine(a(),e);r[s]=l}const Sl=z("debugeventsystem");var Lf;(function(n){n.BeforeHandleInput="BeforeHandleInput",n.AfterHandleInput="AfterHandleInput"})(Lf||(Lf={}));const xa=class extends re{constructor(){super();c(this,"raycaster",[]);c(this,"pressedByID",new Map);c(this,"hoveredByID",new Map);c(this,"onPointerEvent",e=>{if(e===void 0||e.propagationStopped||e.defaultPrevented||e.used)return;const i=new Om(this.context.input,e);this._currentPointerEventName=e.type,i.inputSource=this.context.input,i.isClick=e.isClick,i.isDoubleClick=e.isDoubleClick,i.isDown=e.type==ft.PointerDown,i.isUp=e.type==ft.PointerUp,i.isPressed=this.context.input.getPointerPressed(e.pointerId),Sl&&(i.isDown?console.log("DOWN",i.pointerId):i.isUp&&console.log("UP",i.pointerId),i.isClick&&console.log("CLICK",i.pointerId));const s=new rc;e.hasRay?s.ray=e.ray:s.screenPoint=this.context.input.getPointerPositionRC(e.pointerId);const r=this.performRaycast(s);if(r){for(const a of r)a.event=e,e.intersections.push(a);e.origin.onPointerHits&&e.origin.onPointerHits({sender:this,event:e,hits:r})}Sl&&i.isClick&&bi("EventSystem: "+i.pointerId+" - "+this.context.time.frame+" - Up:"+i.isUp+", Down:"+i.isDown);const o={sender:this,args:i,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent(Lf.BeforeHandleInput,{detail:o})),this.handleIntersections(r,i),this.dispatchEvent(new CustomEvent(Lf.AfterHandleInput,{detail:o}))});c(this,"_sortedHits",[]);c(this,"_testObjectsCache",new Map);c(this,"_currentlyActiveRaycaster",null);c(this,"_currentPointerEventName",null);c(this,"shouldRaycastObject",e=>{var r;let i=null;if(c9(e)&&(i=(r=e[fo])==null?void 0:r.gameObject),this._testObjectsCache.has(e)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(e)===!1?"continue in children":!0;{let o=Vx(e,this._currentPointerEventName);if(!o&&i&&(o=Vx(i,this._currentPointerEventName)),o){this._testObjectsCache.set(e,!0);for(const a of e.children)this.shouldRaycastObject_AddToYesCache(a);return!0}return this._testObjectsCache.set(e,!1),"continue in children"}});c(this,"_sortingBuffer",[]);c(this,"_noDepthTestingResults",[]);c(this,"out",{});c(this,"_capturedPointer",{});c(this,"pointerEnterSymbol",Symbol("pointerEnter"));c(this,"pointerExitSymbol",Symbol("pointerExit"));c(this,"currentActiveMeshUIComponents",[]);xa.systems.push(this)}static createIfNoneExists(e){this.didSearchEventSystem||(this.didSearchEventSystem=!0,xa.systems.length<=0&&xa.systems.push(...Q.findObjectsOfType(xa,e)));for(const s of xa.systems)if(s.context===e)return;const i=new ne;Q.addNewComponent(i,xa),e.scene.add(i)}static get systems(){const e=je.Current;return this._eventSystemMap.has(e)||this._eventSystemMap.set(e,[]),this._eventSystemMap.get(e)}static get(e){const i=this._eventSystemMap.get(e);return i&&i.length>0?i[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(e,i,s=!1){Hc.update(e,i,s)}static markUIDirty(e){Hc.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){xa.systems.splice(xa.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!Q.findObjectOfType(Lm,this.context)){const i=Q.addComponent(this.context.scene,xo);this.raycaster.push(i),(ve()||Sl)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(e){var i;e&&this.raycaster&&!this.raycaster.includes(e)&&((i=this.raycaster)==null||i.push(e))}unregister(e){var s,r;const i=(s=this.raycaster)==null?void 0:s.indexOf(e);i!==void 0&&i!==-1&&((r=this.raycaster)==null||r.splice(i,1))}onEnable(){this.context.input.addEventListener(ft.PointerDown,this.onPointerEvent),this.context.input.addEventListener(ft.PointerUp,this.onPointerEvent),this.context.input.addEventListener(ft.PointerMove,this.onPointerEvent)}onDisable(){this.context.input.removeEventListener(ft.PointerDown,this.onPointerEvent),this.context.input.removeEventListener(ft.PointerUp,this.onPointerEvent),this.context.input.removeEventListener(ft.PointerMove,this.onPointerEvent)}onBeforeRender(){this.resetMeshUIStates()}shouldRaycastObject_AddToYesCache(e){this._testObjectsCache.set(e,!0);for(const i of e.children)this.shouldRaycastObject_AddToYesCache(i)}performRaycast(e){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,e||(e=new rc),e.testObject=this.shouldRaycastObject;for(const i of this.raycaster){if(!i.activeAndEnabled)continue;this._currentlyActiveRaycaster=i;const s=i.performRaycast(e);this._currentlyActiveRaycaster=null,s&&s.length>0&&this._sortedHits.push(...s)}return this._sortedHits.sort((i,s)=>i.distance-s.distance),this._sortedHits}assignHitInformation(e,i){i?(e.intersection=i,e.point=i.point,e.normal=i.normal,e.face=i.face,e.distance=i.distance,e.instanceId=i.instanceId):(e.intersection=void 0,e.point=void 0,e.normal=void 0,e.face=void 0,e.distance=void 0,e.instanceId=void 0)}handleIntersections(e,i){var r;if(e!=null&&e.length){e=this.sortCandidates(e);for(const o of e){if(i.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(i,o),this.handleEventOnObject(o.object,i))return!0}}this.assignHitInformation(i,e==null?void 0:e[0]),this.invokePointerCapture(i);const s=this.hoveredByID.get(i.pointerId);return s&&this.propagatePointerExit(s.obj,s.data,null),this.hoveredByID.delete(i.pointerId),i.isUp&&((r=this.pressedByID.get(i.pointerId))==null||r.handlers.forEach(o=>this.invokeOnPointerUp(i,o)),this.pressedByID.delete(i.pointerId)),!1}sortCandidates(e){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let i=0;i<e.length;i++){const s=e[i],r=s.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(s);continue}this._sortingBuffer.push(s)}for(const i of this._sortingBuffer)this._noDepthTestingResults.push(i);return this._noDepthTestingResults}handleEventOnObject(e,i){if(!this.testIsVisible(e))return i.isClick&&Sl&&console.log("not allowed",e),!1;if(i.pointerId===void 0)return Sl&&console.error("Event without pointer can't be handled",i),!1;i.object=e;const s=e.parent,r=i.isClick??!1;let o=null;if(s&&s.isUI){const d=(i.isPressed||i.isClick)??!1;if(s[fo]){const f=s[fo].gameObject;if(f){if(!$S.isInteractable(f,this.out))return!1;o=this.out.canvasGroup??null,this.handleMeshUIIntersection(e,d),e=f}}}r&&Sl&&console.log(this.context.time.frame,e);const a=this.hoveredByID.get(i.pointerId),l=a==null?void 0:a.obj;l!==e&&l&&this.propagatePointerExit(l,a.data,e);const u=this.hoveredByID.get(i.pointerId);if(u?(u.obj=e,u.data=i):this.hoveredByID.set(i.pointerId,{obj:e,data:i}),i.isDown){const d=this.pressedByID.get(i.pointerId);d?(d.obj=e,d.data=i):this.pressedByID.set(i.pointerId,{obj:e,data:i,handlers:new Set})}return(o===null||o.interactable)&&this.handleMainInteraction(e,i,l??null),!0}propagate(e,i){for(;e;)Q.foreachComponent(e,s=>{i(s)},!1),e=e.parent}handleMainInteraction(e,i,s){const r=this.pressedByID.get(i.pointerId),o=s!==e;let a=!0;switch(i.event.pointerType){case"mouse":case"touch":const l=this.context.input.getPointerPositionLastFrame(i.pointerId),h=this.context.input.getPointerPosition(i.pointerId);a=l&&!ye.approximately(l,h);break}this.propagate(e,l=>{var u;const h=l;h.interactable!==!1&&(!h.activeAndEnabled||!h.enabled||(h.onPointerEnter&&o&&this.handlePointerEnter(h,i),i.isDown&&h.onPointerDown&&(h.onPointerDown(i),r==null||r.handlers.add(h),this.handlePointerCapture(i,h)),h.onPointerMove&&(a&&h.onPointerMove(i),this.handlePointerCapture(i,h)),i.isUp&&(h.onPointerUp&&(this.invokeOnPointerUp(i,h),r==null||r.handlers.delete(h)),h.onPointerExit&&((u=i.event)==null?void 0:u.pointerType)===Kc.Touch&&(this.handlePointerExit(h,i),this.hoveredByID.delete(i.pointerId))),i.isClick&&h.onPointerClick&&h.onPointerClick(i)))}),i.isUp&&(r==null||r.handlers.forEach(l=>{this.invokeOnPointerUp(i,l)}),this.pressedByID.delete(i.pointerId))}propagatePointerExit(e,i,s){this.propagate(e,r=>{if(!r.gameObject||r.destroyed)return;const o=r;if(o.onPointerExit||o.onPointerEnter){if(s&&this.isChild(s,r.gameObject))return;this.handlePointerExit(o,i)}})}invokeOnPointerUp(e,i){var s;(s=i.onPointerUp)==null||s.call(i,e),this.releasePointerCapture(e,i)}handlePointerEnter(e,i){e.onPointerEnter&&this.updatePointerState(e,i.pointerId,this.pointerEnterSymbol,!0)&&e.onPointerEnter(i),this.updatePointerState(e,i.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(e,i){e.onPointerExit&&this.updatePointerState(e,i.pointerId,this.pointerExitSymbol,!0)&&e.onPointerExit(i),this.updatePointerState(e,i.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(e,i,s,r){let o=e[s];if(r)return o&&o.includes(i)?!1:(o=o||[],o.push(i),e[s]=o,!0);{if(!o||!o.includes(i))return!1;const a=o.indexOf(i);return a!==-1&&o.splice(a,1),!0}}handlePointerCapture(e,i){if(e.z__pointer_ctured){e.z__pointer_ctured=!1;const s=e.pointerId;if(i.onPointerMove){const r=this._capturedPointer[s]||[];r.push(i),this._capturedPointer[s]=r}else ve()&&!i.z__warned_no_pointermove&&(i.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else e.z__pointer_cture_rleased&&(e.z__pointer_cture_rleased=!1,this.releasePointerCapture(e,i))}releasePointerCapture(e,i){const s=e.pointerId;if(this._capturedPointer[s]){const r=this._capturedPointer[s].indexOf(i);r!==-1&&(this._capturedPointer[s].splice(r,1),Sl&&console.log("released pointer capture",s,i,this._capturedPointer))}}invokePointerCapture(e){var i;if(e.event.type===ft.PointerMove){const s=e.pointerId,r=this._capturedPointer[s];if(r){Sl&&console.log("Captured",s,r);for(let o=0;o<r.length;o++){const a=r[o];if(a.destroyed){r.splice(o,1),o--;continue}(i=a.onPointerMove)==null||i.call(a,e)}}}}isChild(e,i){return!e||!i?!1:e===i?!0:e.parent?this.isChild(e.parent,i):!1}handleMeshUiObjectWithoutShadowDom(e,i){return!e||!e.isUI?!0:this.handleMeshUIIntersection(e,i)}handleMeshUIIntersection(e,i){const s=Hc.updateState(e,i);return s&&this.currentActiveMeshUIComponents.push(s),s!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&Hc.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let e=0;e<this.currentActiveMeshUIComponents.length;e++){const i=this.currentActiveMeshUIComponents[e];Hc.resetState(i)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(e){return e?Q.isActiveSelf(e)?this.testIsVisible(e.parent):!1:!0}};let kr=xa;c(kr,"_eventSystemMap",new Map),c(kr,"didSearchEventSystem",!1);class Hc{static markDirty(){this.needsUpdate=!0}static update(t,e,i=!1){if(i){t.update();return}const s=e.time.frameCount;for(const r of this.lastUpdateFrame)if(r.context===e){if(s===r.frame)return;r.frame=s;let o=this.needsUpdate||s<1;r.nextUpdate<=s&&(o=!0),o&&(Sl&&console.log("Update threemeshui"),this.needsUpdate=!1,r.nextUpdate=s+60,t.update());return}this.lastUpdateFrame=[{context:e,frame:s,nextUpdate:s+60}],t.update(),this.needsUpdate=!1}static updateState(t,e){let i=null;if(t&&(i=this.findBlockInParent(t),i&&i!==this.lastSelected)){if(i.interactable===!1)return null;this.needsUpdate=!0}return i}static resetLastSelected(){const t=this.lastSelected;t&&(this.lastSelected=null,this.resetState(t))}static resetState(t){t&&(this.needsUpdate=!0)}static findBlockInParent(t){return t?t.isBlock?t:this.findBlockInParent(t.parent):null}}c(Hc,"lastSelected",null),c(Hc,"lastUpdateFrame",[]),c(Hc,"needsUpdate",!1);var yi=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const q_=z("debugorbit"),X_=z("freecam"),QA=z("debugcamerafit"),jA=z("smoothcam"),u9={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let Y_;var Wx;(function(n){n.CameraTargetReached="target-reached"})(Wx||(Wx={}));class wy extends CustomEvent{constructor(t,e){super(Wx.CameraTargetReached,{detail:{controls:t,type:e}})}}class Lt extends re{constructor(){super(...arguments);c(this,"autoTarget",!0);c(this,"autoFit",!1);c(this,"enableRotate",!0);c(this,"autoRotate",!1);c(this,"autoRotateSpeed",1);c(this,"minAzimuthAngle",1/0);c(this,"maxAzimuthAngle",1/0);c(this,"minPolarAngle",0);c(this,"maxPolarAngle",Math.PI);c(this,"enableKeys",!0);c(this,"enableDamping",!0);c(this,"dampingFactor",.1);c(this,"enableZoom",!0);c(this,"minZoom",0);c(this,"maxZoom",1/0);c(this,"zoomSpeed",1);c(this,"zoomToCursor",!1);c(this,"enablePan",!0);c(this,"lookAtConstraint",null);c(this,"lookAtConstraint01",1);c(this,"allowInterrupt",!0);c(this,"middleClickToFocus",!0);c(this,"doubleClickToFocus",!0);c(this,"clickBackgroundToFitScene",2);c(this,"debugLog",!1);c(this,"targetLerpDuration",1);c(this,"_controls",null);c(this,"_cameraObject",null);c(this,"_lookTargetLerpActive",!1);c(this,"_lookTargetStartPosition",new w);c(this,"_lookTargetEndPosition",new w);c(this,"_lookTargetLerp01",0);c(this,"_lookTargetLerpDuration",0);c(this,"_cameraLerpActive",!1);c(this,"_cameraStartPosition",new w);c(this,"_cameraEndPosition",new w);c(this,"_cameraLerp01",0);c(this,"_cameraLerpDuration",0);c(this,"_inputs",0);c(this,"_enableTime",0);c(this,"_startedListeningToKeyEvents",!1);c(this,"_eventSystem");c(this,"_afterHandleInputFn");c(this,"_camera",null);c(this,"_syncedTransform");c(this,"_didSetTarget",0);c(this,"targetElement",null);c(this,"_activePointerEvents");c(this,"_lastTimeClickOnBackground",-1);c(this,"_clickOnBackgroundCount",0);c(this,"_onPointerDown",e=>{this._activePointerEvents.push(e)});c(this,"_onPointerUp",e=>{for(let i=this._activePointerEvents.length-1;i>=0;i--){const s=this._activePointerEvents[i];if(s.pointerId===e.pointerId&&s.button===e.button){this._activePointerEvents.splice(i,1);break}}if(this.clickBackgroundToFitScene>0&&e.isClick&&e.button===0){if(e.hasRay||e.intersections.push(...this.context.physics.raycast()),e.intersections.length<=0){const i=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||i<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}q_&&console.log(this.clickBackgroundToFitScene,e.intersections.length,this._clickOnBackgroundCount)}});c(this,"_onPointerUpLate",e=>{this.doubleClickToFocus&&e.isDoubleClick&&!e.used&&this.setTargetFromRaycast()});c(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()});c(this,"_shouldDisable",!1);c(this,"__onPreRender",()=>{const e=this.context.pre_render_callbacks.indexOf(this.__onPreRender);e>=0&&this.context.pre_render_callbacks.splice(e,1),this.autoFit&&(this.autoFit=!1,this.fitCamera({centerCamera:"y",immediate:!0,objects:this.scene.children}))});c(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(e){var i;(i=this.controls)==null||i.addEventListener("start",e)}get targetLerpSpeed(){return 5}set targetLerpSpeed(e){this.targetLerpDuration=1/e}awake(){this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._eventSystem=kr.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(Lf.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var e,i;(e=this._controls)==null||e.dispose(),(i=this._eventSystem)==null||i.removeEventListener(Lf.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._didSetTarget=0,this._enableTime=this.context.time.time;const e=Q.getComponent(this.gameObject,Bt);this._camera=e;let i=e==null?void 0:e.cam;if(!i&&this.gameObject instanceof bt&&(i=this.gameObject),i&&N1(i,this,!0),!this._controls&&i instanceof bt){this._cameraObject=i;const s=this.targetElement??this.context.renderer.domElement,r=i==null?void 0:i.quaternion.clone();this._controls=new KO(i,s),i==null||i.quaternion.copy(r),Y_===void 0&&(Y_={...this._controls.keys})}this._controls&&(X_&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,dc()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=Q.getComponent(this.gameObject,oc)??void 0,this.context.pre_render_callbacks.push(this.__onPreRender),this._activePointerEvents=[],this.context.input.addEventListener("pointerdown",this._onPointerDown,{queue:Br.Early}),this.context.input.addEventListener("pointerup",this._onPointerUp,{queue:Br.Early}),this.context.input.addEventListener("pointerup",this._onPointerUpLate,{queue:Br.Late})}onDisable(){var e;(e=this._camera)!=null&&e.cam&&N1(this._camera.cam,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted)),this._activePointerEvents.length=0,this.context.input.removeEventListener("pointerdown",this._onPointerDown),this.context.input.removeEventListener("pointerup",this._onPointerUp),this.context.input.removeEventListener("pointerup",this._onPointerUpLate)}afterHandleInput(e){e.detail.args.pointerId===0&&(e.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!e.detail.args.isPressed||e.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var i,s,r,o;if(!this._controls)return;if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}if(this._controls.enabled=!0,(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&((i=this.context.input.getPointerPositionDelta(0))!=null&&i.length())||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0,this.autoTarget&&this._didSetTarget++===0){const a=Q.getComponent(this.gameObject,Bt);if(a&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const l=He(a.cam),h=Math.max(.01,l.length()),u=new w(0,0,-h).applyMatrix4(a.cam.matrixWorld);this.setLookTargetPosition(u,!0)}if(!this.setLookTargetFromConstraint()){const l=new rc;l.screenPoint=new oe(0,0),l.lineThreshold=.1;const h=this.context.physics.raycast(l);h.length>0&&this.setLookTargetPosition(h[0].point,!0),QA&&console.log("OrbitControls hits",...h)}}if(this.middleClickToFocus&&this.context.input.getPointerClicked(1)&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new wy(this,"camera"));else{const a=ye.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,a)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new wy(this,"lookat"));else{const a=ye.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,a)}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR&&!this._activePointerEvents.some(a=>a.used),this._controls.keys=this.enableKeys?Y_:u9,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,X_||(((r=(s=this._camera)==null?void 0:s.cam)==null?void 0:r.type)==="PerspectiveCamera"?(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom,this._controls.minZoom=0,this._controls.maxZoom=1/0):(this._controls.minDistance=0,this._controls.maxDistance=1/0,this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom)),typeof jA=="number"||jA===!0){this._controls.enableDamping=!0;const a=typeof jA=="number"?jA:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,a))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!X_&&((o=this.lookAtConstraint)!=null&&o.locked)&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(this.context.time.deltaTime),q_&&Be.DrawWireSphere(this._controls.target,.1,65280))}}setCameraAndLookTarget(e){if(!e||!(e instanceof ne))return;const i=He(e),s=VM(e);this.setTargetFromRaycast(new mh(i,s)),this.setCameraTargetPosition(i)}setCameraTargetPosition(e,i=!1){var s,r;e&&(e instanceof ne&&(e=He(e)),this._cameraEndPosition||(this._cameraEndPosition=new w),this._cameraEndPosition.copy(e),i===!0?(this._cameraLerpActive=!1,(s=this.controllerObject)==null||s.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((r=this._cameraObject)==null?void 0:r.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setLookTargetPosition(e=null,i=!1){this._controls&&e&&(e instanceof ne&&(e=He(e)),this._lookTargetEndPosition.copy(e),this._didSetTarget++,q_&&(console.warn("OrbitControls: setLookTargetPosition",e,i),Be.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(e=0,i=1){var r;if(!this._controls)return!1;const s=(r=this.lookAtConstraint)==null?void 0:r.sources;if(s&&s.length>0){const o=s[e];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(e,i){return this.lerpLookTarget(e,i)}lerpLookTarget(e,i){this._controls&&(i>=1?this._controls.target.copy(e):this._controls.target.lerp(e,i))}setTargetFromRaycast(e){if(!this.controls)return;const i=e?this.context.physics.raycastFromRay(e):this.context.physics.raycast();for(const s of i)if(s.distance>0&&Q.isActiveInHierarchy(s.object)){const r=eE(s.object);if(r){const o=r.canvas;if(o!=null&&o.screenspace)break}this.setLookTargetPosition(s.point);break}}fitCamera(e,i){if(this.context.isInXR)return;let s;if(Array.isArray(e)?s=e:e&&"type"in e?s=e.children:e&&"objects"in e&&(s=e==null?void 0:e.objects,i=e),s&&!Array.isArray(s)&&(s=s.children),(!Array.isArray(s)||s&&s.length<=0)&&(s=this.context.scene.children),!Array.isArray(s)||s.length<=0){console.warn("No objects to fit camera to...");return}i||(i={});const{immediate:r=!1,centerCamera:o="y",cameraNearFar:a="auto",fitOffset:l=1.1}=i,h=this._cameraObject,u=this._controls;if(!h||!u){console.warn("No camera or controls found to fit camera to objects...");return}const d=new w,f=new w,p=sl(s,void 0);h.updateMatrixWorld(),h.updateProjectionMatrix(),p.getCenter(f);const g=new w;if(p.getSize(g),p.applyMatrix4(h.matrixWorldInverse),p.getSize(d),p.setFromCenterAndSize(f,d),Number.isNaN(d.x)||Number.isNaN(d.y)||Number.isNaN(d.z)){console.warn("Camera fit size resultet in NaN",h,p,[...s]);return}if(d.length()<=1e-10){QA&&console.warn("Camera fit size is zero",p,[...s]);return}const m=h.fov,v=2*Math.atan(Math.tan(m*Math.PI/360/2)*h.aspect)/Math.PI*360,y=d.y/(2*Math.atan(Math.PI*m/360)),b=d.x/(2*Math.atan(Math.PI*v/360)),_=l*Math.max(y,b)+d.z/2;QA&&console.log("Fit camera to objects",y,b,"distance",_),u.maxDistance=_*10,u.minDistance=_*.01;const x=.05,S=f.clone();if(S.y-=d.y*x,this.setLookTargetPosition(S,r),this.autoTarget=!1,a==null||a=="auto"){const I=Q.findObjectOfType(bh),B=I?I.radius:0,R=Math.max(g.x,g.y,g.z,B);h.near=_/100,h.far=R+_*10}h.updateMatrixWorld(),h.updateProjectionMatrix();const E=He(h),M=f.clone();if(M.sub(E),o==="y"&&(M.y=0),M.normalize(),M.multiplyScalar(_),o==="y"&&(M.y+=-x*4*d.y),h.parent){const I=h.parent.worldToLocal(f.clone().sub(M));this.setCameraTargetPosition(I,r)}else console.error(`Can not fit camera ${h.name} because it has no parent`);if(QA){const I=new vP(p);this.context.scene.add(I),XM(I,b0(h)),setTimeout(()=>{this.context.scene.remove(I)},1e4),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",B=>{B.code==="KeyF"&&this.fitCamera({objects:s,fitOffset:l,immediate:r})}))}u.update()}}yi([A()],Lt.prototype,"autoTarget",void 0);yi([A()],Lt.prototype,"autoFit",void 0);yi([A()],Lt.prototype,"enableRotate",void 0);yi([A()],Lt.prototype,"autoRotate",void 0);yi([A()],Lt.prototype,"autoRotateSpeed",void 0);yi([A()],Lt.prototype,"minAzimuthAngle",void 0);yi([A()],Lt.prototype,"maxAzimuthAngle",void 0);yi([A()],Lt.prototype,"minPolarAngle",void 0);yi([A()],Lt.prototype,"maxPolarAngle",void 0);yi([A()],Lt.prototype,"enableKeys",void 0);yi([A()],Lt.prototype,"enableDamping",void 0);yi([A()],Lt.prototype,"dampingFactor",void 0);yi([A()],Lt.prototype,"enableZoom",void 0);yi([A()],Lt.prototype,"minZoom",void 0);yi([A()],Lt.prototype,"maxZoom",void 0);yi([A()],Lt.prototype,"zoomSpeed",void 0);yi([A()],Lt.prototype,"enablePan",void 0);yi([A(jf)],Lt.prototype,"lookAtConstraint",void 0);yi([A()],Lt.prototype,"lookAtConstraint01",void 0);yi([A()],Lt.prototype,"allowInterrupt",void 0);yi([A()],Lt.prototype,"middleClickToFocus",void 0);yi([A()],Lt.prototype,"doubleClickToFocus",void 0);yi([A()],Lt.prototype,"clickBackgroundToFitScene",void 0);yi([A()],Lt.prototype,"targetLerpDuration",void 0);var Js=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},hr;(function(n){n[n.None=0]="None",n[n.Skybox=1]="Skybox",n[n.SolidColor=2]="SolidColor",n[n.Uninitialized=4]="Uninitialized"})(hr||(hr={}));const Fc=z("debugcam"),vR=z("debugscreenpointtoray"),Xd=class extends re{constructor(){super(...arguments);c(this,"_nearClipPlane",.1);c(this,"_farClipPlane",1e3);c(this,"orthographic",!1);c(this,"orthographicSize",5);c(this,"ARBackgroundAlpha",0);c(this,"_cullingMask",4294967295);c(this,"_backgroundBlurriness");c(this,"_backgroundIntensity");c(this,"_backgroundRotation");c(this,"_environmentIntensity");c(this,"_targetTexture",null);c(this,"_backgroundColor");c(this,"_fov");c(this,"_cam",null);c(this,"_clearFlags",hr.SolidColor);c(this,"_skybox");c(this,"_frustum");c(this,"_projScreenMatrix",new ae)}get isCamera(){return!0}get aspect(){return this._cam instanceof bt?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(e){this._cam instanceof bt&&this._cam.aspect!==e&&(this._cam.aspect=e,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof bt?this._cam.fov:this._fov}set fieldOfView(e){const i=this.fieldOfView!=e;if(this._fov=e,i&&this._cam&&this._cam instanceof bt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(e){const i=this._nearClipPlane!=e;this._nearClipPlane=e,this._cam&&(i||this._cam.near!=e)&&(this._cam.near=e,this._cam.updateProjectionMatrix())}applyClippingPlane(){this._cam&&(this._cam.near=this._nearClipPlane,this._cam.far=this._farClipPlane,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(e){const i=this._farClipPlane!=e;this._farClipPlane=e,this._cam&&(i||this._cam.far!=e)&&(this._cam.far=e,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(e){e!==this._clearFlags&&(this._clearFlags=e,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(e){this._cullingMask=e,this._cam&&(this._cam.layers.mask=e)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(e){this.cullingMask=(1<<e|0)>>>0}set backgroundBlurriness(e){e!==this._backgroundBlurriness&&(e===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(e,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(e){e!==this._backgroundIntensity&&(e===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(e,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set backgroundRotation(e){e!==this._backgroundRotation&&(e===void 0?this._backgroundRotation=void 0:this._backgroundRotation=e,this.applyClearFlagsIfIsActiveCamera())}get backgroundRotation(){return this._backgroundRotation}set environmentIntensity(e){this._environmentIntensity=e}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(e){if(e){if(this._backgroundColor)this._backgroundColor.copy(e);else{if(!e.clone)return;this._backgroundColor=e.clone()}e.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(e){this._targetTexture=e}get targetTexture(){return this._targetTexture}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(e,i,s){const r=this.cam,o=Xd._origin;o.set(e,i,-1),this.context.input.convertScreenspaceToRaycastSpace(o),vR&&console.log("screenPointToRay",e.toFixed(2),i.toFixed(2),"now:",o.x.toFixed(2),o.y.toFixed(2),"isInXR:"+this.context.isInXR),o.z=-1,o.unproject(r);const a=Xd._direction.set(o.x,o.y,o.z),l=He(r);return a.sub(l),a.normalize(),s?(s.set(l,a),s):new mh(l.clone(),a.clone())}getFrustum(){return this._frustum||(this._frustum=new y1,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new y1),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(e,i){return i&&this._projScreenMatrix.multiplyMatrices(this.cam.projectionMatrix,this.cam.matrixWorldInverse),e===this._projScreenMatrix?e:e.copy(this._projScreenMatrix)}awake(){vR&&window.addEventListener("pointerdown",e=>{const i=e.clientX,s=e.clientY;console.log("touch",i.toFixed(2),s.toFixed(2));const r=this.screenPointToRay(i,s),o="#"+Math.floor(Math.random()*16777215).toString(16);Be.DrawRay(r.origin,r.direction,o,10)})}onEnable(){Fc&&console.log(`Camera enabled: "${this.name}". ClearFlags=${hr[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),f9(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===hr.SolidColor&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const e=this.context.renderer;if(e){const i=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,e),i==null||i.applyClearFlags()}}}buildCamera(){if(this._cam)return;const e=this.gameObject.isCamera;let i=null;if(e?(i=this.gameObject,i==null||i.layers.enableAll(),i instanceof bt&&(this._fov=i.fov)):i=this.gameObject.children[0],i&&i.isCamera)i instanceof bt&&(this._fov&&(i.fov=this._fov),i.near=this._nearClipPlane,i.far=this._farClipPlane,i.updateProjectionMatrix());else if(!this.orthographic)i=new bt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(i.fov=this.fieldOfView),this.gameObject.add(i);else{const s=this.orthographicSize*100;i=new Mu(window.innerWidth/-s,window.innerWidth/s,window.innerHeight/s,window.innerHeight/-s,this._nearClipPlane,this._farClipPlane),this.gameObject.add(i)}this._cam=i,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(e){this.context.mainCameraComponent===this&&this.applyClearFlags(e)}applyClearFlags(e){var i;if(!this._cam){Fc&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,Fc){const s=`Camera "${this.name}" clear flags: ${hr[this._clearFlags]}`;console.debug(s)}switch(this._clearFlags){case hr.None:return;case hr.Skybox:if(Xd.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||(e==null?void 0:e.applySkybox)===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:Fc&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity),this._backgroundRotation!==void 0?this.context.scene.backgroundRotation=this._backgroundRotation:Fc&&console.warn(`Camera "${this.name}" has no background intensity`);break;case hr.SolidColor:if(this._backgroundColor){let s=this._backgroundColor.alpha;Xd.backgroundShouldBeTransparent(this.context)&&(s=this.ARBackgroundAlpha??0),this.context.scene.background=null,(i=this.context.xr)!=null&&i.isVR?this.context.renderer.setClearColor(hz(this._backgroundColor).convertLinearToSRGB()):this.context.renderer.setClearColor(this._backgroundColor,s)}else Fc&&console.warn(`Camera "${this.name}" has no background color`,this);break;case hr.Uninitialized:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new d9(this)),this._skybox.apply()}static backgroundShouldBeTransparent(e){var o,a,l,h;const i=(o=e.renderer.xr)==null?void 0:o.getSession();if(!i)return!1;if(typeof i._transparent=="boolean")return i._transparent;const s=i.environmentBlendMode;Fc&&bi("Environment blend mode: "+s+" on "+navigator.userAgent);let r=s==="additive"||s==="alpha-blend";return e.isInAR&&s==="opaque"&&((a=navigator.userAgent)!=null&&a.includes("OculusBrowser")||(l=navigator.userAgent)!=null&&l.includes("Mozilla")&&((h=navigator.userAgent)!=null&&h.includes("Mobile WebXRViewer/v2")))&&(r=!0),i._transparent=r,r}};let Bt=Xd;c(Bt,"_origin",new w),c(Bt,"_direction",new w);Js([A()],Bt.prototype,"aspect",null);Js([A()],Bt.prototype,"fieldOfView",null);Js([A()],Bt.prototype,"nearClipPlane",null);Js([A()],Bt.prototype,"farClipPlane",null);Js([A()],Bt.prototype,"clearFlags",null);Js([A()],Bt.prototype,"orthographic",void 0);Js([A()],Bt.prototype,"orthographicSize",void 0);Js([A()],Bt.prototype,"ARBackgroundAlpha",void 0);Js([A()],Bt.prototype,"cullingMask",null);Js([A()],Bt.prototype,"backgroundBlurriness",null);Js([A()],Bt.prototype,"backgroundIntensity",null);Js([A(jt)],Bt.prototype,"backgroundRotation",null);Js([A()],Bt.prototype,"environmentIntensity",null);Js([A(Ut)],Bt.prototype,"backgroundColor",null);Js([A(gu)],Bt.prototype,"targetTexture",null);class d9{constructor(t){c(this,"_camera");c(this,"_skybox");this._camera=t}get context(){var t;return(t=this._camera)==null?void 0:t.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(Fc&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=Ya,this.context.scene.background=this._skybox):this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" has no skybox texture. ${this._camera.sourceId}`))}}function f9(n){z("freecam")&&n.context.mainCameraComponent===n&&Q.getOrAddComponent(n.gameObject,Lt)}class vu extends re{constructor(){super(...arguments);c(this,"_listener",null);c(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new BF),this._listener}onEnable(){Ja.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){Ja.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const e=this._listener;if(!e||e!=null&&e.parent)return;const i=this.context.mainCameraComponent||Q.getComponentInParent(this.gameObject,Bt);i!=null&&i.cam?i.cam.add(e):this.gameObject.add(e),e.filter?(e.gain.connect(e.filter),e.filter.connect(e.context.destination)):e.gain.connect(e.context.destination)}removeListenerIfItExists(){const e=this._listener;e&&(e.removeFromParent(),e.filter&&e.filter.disconnect(),e.gain&&e.gain.disconnect())}}class p9 extends ms{constructor(t,e=1,i=16,s=2){const r=new Ht,o=i+s*2,a=new Float32Array((o*3+3)*3);r.setAttribute("position",new Ke(a,3));const l=new Jo({color:65280}),h=new Jo({color:16776960});super(r,[h,l]),this.audio=t,this.range=e,this.divisionsInnerAngle=i,this.divisionsOuterAngle=s,this.type="PositionalAudioHelper",this.update()}update(){const t=this.audio,e=this.range,i=this.divisionsInnerAngle,s=this.divisionsOuterAngle,r=ct.degToRad(t.panner.coneInnerAngle),o=ct.degToRad(t.panner.coneOuterAngle),a=r/2,l=o/2;let h=0,u=0,d,f;const p=this.geometry,g=p.attributes.position;p.clearGroups();function m(v,y,b,_){const x=(y-v)/b;for(g.setXYZ(h,0,0,0),u++,d=v;d<y;d+=x)f=h+u,g.setXYZ(f,Math.sin(d)*e,0,Math.cos(d)*e),g.setXYZ(f+1,Math.sin(Math.min(d+x,y))*e,0,Math.cos(Math.min(d+x,y))*e),g.setXYZ(f+2,0,0,0),u+=3;p.addGroup(h,u,_),h+=u,u=0}m(-l,-a,s,0),m(-a,a,i,1),m(a,l,s,0),g.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var sa=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const hs=z("debugaudio");var gg;(function(n){n[n.Logarithmic=0]="Logarithmic",n[n.Linear=1]="Linear",n[n.Custom=2]="Custom"})(gg||(gg={}));class kt extends re{constructor(){super(...arguments);c(this,"clip","");c(this,"playOnAwake",!1);c(this,"preload",!1);c(this,"playInBackground",!0);c(this,"_spatialBlend",0);c(this,"_minDistance",1);c(this,"_maxDistance",100);c(this,"_volume",1);c(this,"rollOffMode",0);c(this,"_loop",!1);c(this,"sound",null);c(this,"helper",null);c(this,"wasPlaying",!1);c(this,"audioLoader",null);c(this,"shouldPlay",!1);c(this,"_lastClipStartedLoading",null);c(this,"_audioElement",null);c(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||dc())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":hs&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,kt.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&kt.userInteractionRegistered&&this.wasPlaying&&this.play();break}});c(this,"onApplicationMuteChanged",()=>{var e,i;this.context.application.muted?(e=this.sound)==null||e.setVolume(0):(i=this.sound)==null||i.setVolume(this.volume)});c(this,"createAudio",e=>{hs&&console.log("AudioBuffer finished loading",e);const i=this.Sound;if(!i){hs&&console.warn("Failed getting sound?",this.name);return}i.isPlaying&&i.stop(),e&&i.setBuffer(e),i.loop=this._loop,this.context.application.muted?i.setVolume(0):i.setVolume(this.volume),i.autoplay=this.shouldPlay&&kt.userInteractionRegistered,this.applySpatialDistanceSettings(),i.isPlaying&&i.stop(),kt.registerWaitForAllowAudio(this.__onAllowAudioCallback)});c(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()});c(this,"_lastContextTime",0);c(this,"_hasEnded",!0);c(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return Ja.userInteractionRegistered}static registerWaitForAllowAudio(e){Ja.registerWaitForInteraction(e)}get isPlaying(){var e;return((e=this.sound)==null?void 0:e.isPlaying)??!1}get duration(){var e,i;return(i=(e=this.sound)==null?void 0:e.buffer)==null?void 0:i.duration}get time01(){var i;const e=this.duration;return e&&this.sound?((i=this.sound)==null?void 0:i.context.currentTime)/e:0}set time01(e){const i=this.duration;i&&this.sound&&(this.time=e*i)}get time(){var e,i;return(e=this.sound)!=null&&e.source?((i=this.sound.source)==null?void 0:i.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(e){if(this.sound){if(e===this.sound.offset)return;const i=this.isPlaying;this.stop(),this.sound.offset=e,i&&this.play()}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(e){this._loop=e,this.sound&&this.sound.setLoop(e)}get spatialBlend(){return this._spatialBlend}set spatialBlend(e){e!==this._spatialBlend&&(this._spatialBlend=e,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(e){this._minDistance!==e&&(this._minDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(e){this._maxDistance!==e&&(this._maxDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(e){this._volume=e,this.sound&&!this.context.application.muted&&(hs&&console.log(this.name,"audio set volume",e),this.sound.setVolume(e))}set pitch(e){this.sound&&this.sound.setPlaybackRate(e)}get pitch(){return this.sound?this.sound.getPlaybackRate():1}get Sound(){var e;if(!this.sound&&kt.userInteractionRegistered){let i=Q.getComponent(this.context.mainCamera,vu)??Q.findObjectOfType(vu,this.context);!i&&this.context.mainCamera&&(i=Q.addNewComponent(this.context.mainCamera,vu)),i!=null&&i.listener?(this.sound=new PF(i.listener),(e=this.gameObject)==null||e.add(this.sound)):hs&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var e;return(e=this.sound)==null?void 0:e.context}awake(){hs&&console.log(this),this.audioLoader=new zw,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),kt.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():kt.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(du.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(du.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const e=this.sound;if(!e)return;this._needUpdateSpatialDistanceSettings=!1;const i=ye.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(hs&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+i),e.setRefDistance(i),e.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case gg.Logarithmic:e.setDistanceModel("exponential");break;case gg.Linear:e.setDistanceModel("linear");break;case gg.Custom:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?hs&&!this.helper&&(this.helper=new p9(e,e.getRefDistance()),e.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(e){if(e&&(this.clip=e),typeof e=="string")if(hs&&console.log(e),e.endsWith(".mp3")||e.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new zw),this.shouldPlay=!0,this._lastClipStartedLoading===e){hs&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=e,hs&&console.log("load audio",e);const i=await this.audioLoader.loadAsync(e).catch(console.error);this._lastClipStartedLoading=null,i&&this.createAudio(i)}else console.warn("Unsupported audio clip type",e);else this.shouldPlay=!0,this.createAudio()}play(e=void 0){var s,r,o;!e&&this.clip&&(e=this.clip),e!==void 0&&typeof e!="string"&&!(e instanceof MediaStream)&&(ve()&&console.warn("Called play on AudioSource with unknown argument type:",e+`
Using the assigned clip instead:`,this.clip),e=this.clip);let i=!this.sound||e&&e!==this.clip;if(typeof e=="string"&&!this.audioLoader&&(i=!0),(e instanceof MediaStream||typeof e=="string")&&(this.clip=e),i){this.shouldPlay=!0,this.onNewClip(e);return}if(this.shouldPlay=!0,this._hasEnded=!1,hs&&console.log("play",(s=this.sound)==null?void 0:s.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const a=this.context.application.muted;a&&this.sound.setVolume(0),(r=this.gameObject)==null||r.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(o=this.context.domElement.shadowRoot)==null||o.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(a?.1:0))}}pause(){var e,i;hs&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,this.sound.pause()),(i=this._audioElement)==null||i.remove()}stop(){var e,i;hs&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,hs&&console.log(this._lastContextTime),this.sound.stop()),(i=this._audioElement)==null||i.remove()}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,hs&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}}sa([A(URL)],kt.prototype,"clip",void 0);sa([A()],kt.prototype,"playOnAwake",void 0);sa([A()],kt.prototype,"preload",void 0);sa([A()],kt.prototype,"playInBackground",void 0);sa([A()],kt.prototype,"loop",null);sa([A()],kt.prototype,"spatialBlend",null);sa([A()],kt.prototype,"minDistance",null);sa([A()],kt.prototype,"maxDistance",null);sa([A()],kt.prototype,"volume",null);sa([A()],kt.prototype,"pitch",null);sa([A()],kt.prototype,"rollOffMode",void 0);var z0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const g9=z("debugsignals");class Q0{constructor(){c(this,"guid")}}z0([A()],Q0.prototype,"guid",void 0);class Fm{constructor(){c(this,"signal");c(this,"reaction")}}z0([A(Q0)],Fm.prototype,"signal",void 0);z0([A($t)],Fm.prototype,"reaction",void 0);const Ca=class extends re{constructor(){super(...arguments);c(this,"events")}static invoke(e){if(Ca.receivers[e]){const i=Ca.receivers[e];if(!i)return;for(const s of i)s.invoke(e)}}awake(){g9&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const e of this.events)Ca.receivers[e.signal.guid]||(Ca.receivers[e.signal.guid]=[]),Ca.receivers[e.signal.guid].push(this)}onDisable(){if(this.events){for(const e of this.events)if(Ca.receivers[e.signal.guid]){const i=Ca.receivers[e.signal.guid].indexOf(this);i>=0&&Ca.receivers[e.signal.guid].splice(i,1)}}}invoke(e){if(!this.events||!Array.isArray(this.events))return;const i=typeof e=="object"?e.guid:e;for(const s of this.events)if(s.signal.guid===i)try{if(s.reaction){if(!s.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",s,this);continue}}else{console.warn("Missing reaction for signal",s,this);continue}s.reaction.invoke()}catch(r){console.error(r)}}};let nh=Ca;c(nh,"receivers",{});z0([A(Fm)],nh.prototype,"events",void 0);var xr;(function(n){n.Activation="ActivationTrack",n.Animation="AnimationTrack",n.Audio="AudioTrack",n.Control="ControlTrack",n.Marker="MarkerTrack",n.Signal="SignalTrack"})(xr||(xr={}));var va;(function(n){n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue"})(va||(va={}));var qx;(function(n){n.Signal="SignalEmitter"})(qx||(qx={}));const Va=z("debugtimeline");class j0{constructor(){c(this,"director");c(this,"track")}get muted(){return this.track.muted}set muted(t){var e;t!==this.track.muted&&(this.track.muted=t,(e=this.onMuteChanged)==null||e.call(this))}*forEachClip(t=!1){var e;if((e=this.track)!=null&&e.clips)if(t)for(let i=this.track.clips.length-1;i>=0;i--)yield this.track.clips[i];else for(const i of this.track.clips)yield i}getClipTime(t,e){return e.clipIn+(t-e.start)*e.timeScale}getClipTimeNormalized(t,e){return(t-e.start)/e.duration}evaluateWeight(t,e,i,s=!0){if(e<0||e>=i.length)return 0;const r=i[e];if(s||t>=r.start&&t<=r.end){let o=1;const a=!1;if(r.easeInDuration>0){const l=Math.min((t-r.start)/r.easeInDuration,1);o*=l}if(r.easeOutDuration>0&&!a){const l=Math.min((r.end-t)/r.easeOutDuration,1);o*=l}return o}return 0}}class m9{constructor(t){c(this,"clip");c(this,"rootPositionOffset");c(this,"rootQuaternionOffset");c(this,"rootStartPosition");c(this,"rootEndPosition");c(this,"rootStartQuaternion");c(this,"rootEndQuaternion");const e=t.getClip();this.clip=e;const i=t.getRoot(),s=i.name+".position",r=i.name+".quaternion";Va&&console.log(e.name,e.tracks,s);for(const o of e.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(s))this.rootStartPosition=new w().fromArray(o.values,0),this.rootEndPosition=new w().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Va&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new ie().fromArray(o.values,0),this.rootEndQuaternion=new ie().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Va)){const a=new jt().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",a)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class tE extends j0{constructor(){super(...arguments);c(this,"models",[]);c(this,"trackOffset");c(this,"target");c(this,"mixer");c(this,"clips",[]);c(this,"actions",[]);c(this,"_actionOffsets",[]);c(this,"_didBind",!1);c(this,"_animator",null);c(this,"_useclipOffsets",!0);c(this,"_totalOffsetPosition",new w);c(this,"_totalOffsetRotation",new ie);c(this,"_totalOffsetPosition2",new w);c(this,"_totalOffsetRotation2",new ie);c(this,"_summedPos",new w);c(this,"_tempPos",new w);c(this,"_summedRot",new ie);c(this,"_tempRot",new ie);c(this,"_clipRotQuat",new ie)}onDisable(){var e;(e=this.mixer)==null||e.stopAllAction()}onDestroy(){this.director.context.animations.unregisterAnimationMixer(this.mixer)}onStateChanged(){this._animator&&bR(this._animator.gameObject,this,this.director.isPlaying)}createHooks(e,i){var u,d;if(((u=i.tracks)==null?void 0:u.length)<=0){console.warn("No tracks in AnimationClip",i);return}const s=i.tracks[0].name.split("."),r=s[s.length-2],o=r+".position",a=r+".quaternion";let l=!1,h=!1;for(const f of i.tracks)f.name.endsWith(o)?(l=!0,this.createPositionInterpolant(i,e,f)):f.name.endsWith(a)&&(h=!0,this.createRotationInterpolant(i,e,f));if(!l||!h){const f=(d=this.mixer)==null?void 0:d.getRoot(),p=i.tracks[0],g=p.name.lastIndexOf("."),m=p.name.substring(0,g),v=m.substring(m.lastIndexOf(".")+1),y=f.getObjectByName(v);if(y)if(l){if(!h){const b=i.tracks[0].name.substring(0,g)+".quaternion";Va&&console.warn("Create quaternion track",v,y);const _=y.quaternion,x=new Kv(b,[0,i.duration],[_.x,_.y,_.z,_.w,_.x,_.y,_.z,_.w]);i.tracks.push(x),this.createRotationInterpolant(i,e,x)}}else{const b=m+".position";Va&&console.warn("Create position track",v,y);const _=y.position,x=new Yv(b,[0,i.duration],[_.x,_.y,_.z,_.x,_.y,_.z]);i.tracks.push(x),this.createPositionInterpolant(i,e,x)}}}bind(){if(!this._didBind){this._didBind=!0,Va&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const e of this.actions){const i=new m9(e);this._actionOffsets.push(i)}this.target&&(this._animator=Q.getComponent(this.target,Cs)??null,this._animator&&bR(this._animator.gameObject,this,!0));for(const e of this.models){const i=e.asset,s=i.position,r=i.rotation;s&&s.x!==void 0&&(s.isVector3||(i.position=new w(s.x,s.y,s.z)),r.isQuaternion||(i.rotation=new ie(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const e=this.trackOffset.position;e&&(e.isVector3||(this.trackOffset.position=new w(e.x,e.y,e.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new ie(i.x,i.y,i.z,i.w)))}}evaluate(e){var l,h,u,d,f,p,g;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let i=0,s=0,r=!1,o=!1,a=0;for(let m=0;m<this.clips.length;m++){const v=this.models[m],y=this.actions[m],b=v.asset;y.weight=0;const _=e>=v.start&&e<=v.end,x=v.preExtrapolationMode,S=v.postExtrapolationMode,E=m<this.clips.length-1?this.models[m+1]:null;let M=_,I=!1;if(!M&&!r&&v.end<e&&S!==va.None?(!E||E.start>e)&&(M=!0,r=!0):m==0&&!M&&!o&&v.start>e&&x!==va.None&&(!E||E.start<e)&&(M=!0,I=!0,o=!0),M){let B=1;B*=this.evaluateWeight(e,m,this.models,M),B*=this.director.weight;let R=_;if(I)switch(x){case va.Hold:break;case va.Loop:e+=v.start,R=!0;break;default:e+=v.start,R=!0;break}let P=this.getClipTime(e,v),F=0;const j=b.duration;if(I&&x===va.Hold&&(P=0),R){if(b.loop)for(F+=Math.floor(P/(j+1e-6));P>j;)P-=j}else if(!_&&r)switch(S){case va.Hold:P=this.getClipTime(v.end,v);break;case va.Loop:P%=j;break;case va.PingPong:const k=Math.floor(P/j)%2!==0;P%=j,k&&(P=j-P);break}v.reversed===!0?y.time=y.getClip().duration-P:y.time=P,y.timeScale=0;const V=Math.max(0,B);if(y.weight=V,a+=V,y.clampWhenFinished=!1,y.isRunning()||y.play(),this._useclipOffsets){const X=i==0?this._totalOffsetPosition:this._totalOffsetPosition2,k=i==0?this._totalOffsetRotation:this._totalOffsetRotation2;i<1&&(s=1-B),i+=1;const O=this._summedPos.set(0,0,0),H=this._tempPos.set(0,0,0),ee=this._summedRot.identity(),Y=this._tempRot.identity(),he=b.rotation;he&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(he,B));const ue=this._actionOffsets[m];if(ue.hasOffsets)for(let _e=0;_e<F;_e++)ue.rootPositionOffset?H.copy(ue.rootPositionOffset):H.set(0,0,0),H.applyQuaternion(ee),this._clipRotQuat&&H.applyQuaternion(this._clipRotQuat),ue.rootQuaternionOffset&&(Y.copy(ue.rootQuaternionOffset),ee.multiply(Y)),O.add(H);this._clipRotQuat&&k.multiply(this._clipRotQuat),k.multiply(ee),b.position&&O.add(b.position),X.add(O)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,s),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,s)),this.__mixerError===void 0&&(Va||ve())&&((h=(l=this._animator)==null?void 0:l.runtimeAnimatorController)!=null&&h.mixer)&&this.mixer!==((d=(u=this._animator)==null?void 0:u.runtimeAnimatorController)==null?void 0:d.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(f=this._animator)!=null&&f.runtimeAnimatorController){const m=Math.max(0,1-a);(g=(p=this._animator)==null?void 0:p.runtimeAnimatorController)==null||g.update(m)}else this.mixer.update(e)}createRotationInterpolant(e,i,s){var l;const r=s.createInterpolant.bind(s),o=new ie;this.ensureTrackOffsets();const a=(l=this.trackOffset)==null?void 0:l.rotation;s.createInterpolant=()=>{const h=r(),u=h.evaluate.bind(h);return h.evaluate=d=>{var p;const f=u(d);if(o.set(f[0],f[1],f[2],f[3]),o.premultiply(this._totalOffsetRotation),a&&o.premultiply(a),this.director.animationCallbackReceivers)for(const g of this.director.animationCallbackReceivers)(p=g==null?void 0:g.onTimelineRotation)==null||p.call(g,this.director,this.target,d,o);return f[0]=o.x,f[1]=o.y,f[2]=o.z,f[3]=o.w,f},h}}createPositionInterpolant(e,i,s){var u,d;const r=s.createInterpolant.bind(s),o=new w;this.ensureTrackOffsets();const a=(u=this.trackOffset)==null?void 0:u.rotation,l=(d=this.trackOffset)==null?void 0:d.position;let h;s.createInterpolant=()=>{const f=r(),p=f.evaluate.bind(f);return f.evaluate=g=>{var v,y,b;const m=p(g);if(o.set(m[0],m[1],m[2]),i.removeStartOffset&&(h===void 0?(h=null,h=(y=(v=this._actionOffsets.find(_=>_.clip===e))==null?void 0:v.rootStartPosition)==null?void 0:y.clone()):h!=null&&h.isVector3&&o.sub(h)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),a&&o.applyQuaternion(a),l&&(o.x-=l.x,o.y+=l.y,o.z+=l.z),this.director.animationCallbackReceivers)for(const _ of this.director.animationCallbackReceivers)(b=_==null?void 0:_.onTimelinePosition)==null||b.call(_,this.director,this.target,g,o);return m[0]=o.x,m[1]=o.y,m[2]=o.z,m},f}}}const A9=z("mutetimeline"),Yd=class extends j0{constructor(){super(...arguments);c(this,"models",[]);c(this,"listener");c(this,"audio",[]);c(this,"audioContextTimeOffset",[]);c(this,"lastTime",0);c(this,"audioSource");c(this,"_audioLoader",null);c(this,"_playableDirectorResumed",!1)}getAudioFilePath(e){const i=this.director.sourceId;return Du(i,e)}onAllowAudioChanged(e){for(let i=0;i<this.models.length;i++){const s=this.models[i];this.audio[i].setVolume(e?s.asset.volume:0)}}addModel(e){const i=new MF(this.listener);this.audio.push(i);const s=e;s._didTriggerPlay=!1,this.models.push(s)}onDisable(){for(const e of this.audio)e.isPlaying&&e.stop();for(const e of this.models)e._didTriggerPlay=!1}onDestroy(){for(const e of this.audio)e.source&&(e==null||e.disconnect());this.audio.length=0}onMuteChanged(){if(this.muted)for(let e=0;e<this.audio.length;e++){const i=this.audio[e];i!=null&&i.isPlaying&&i.stop()}}stop(){for(let e=0;e<this.audio.length;e++){const i=this.audio[e];i!=null&&i.isPlaying&&i.stop()}for(const e of this.models)e._didTriggerPlay=!1}onPauseChanged(){for(let e=0;e<this.audio.length;e++){const i=this.audio[e];i!=null&&i.isPlaying&&i.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(e){if(A9||this.track.muted||this.director.speed<0)return;const i=this.director.context.application.muted,s=this._playableDirectorResumed;this._playableDirectorResumed=!1;const r=i?.1:0;for(let o=0;o<this.models.length;o++){const a=this.models[o],l=this.audio[o],h=a.asset;if((!l||!l.buffer)&&this.isInTimeRange(a,e-1,e+1)&&this.handleAudioLoading(a,l),kt.userInteractionRegistered!==!1&&!(l===null||!l.buffer))if(l.playbackRate=this.director.context.time.timeScale*this.director.speed,l.loop=h.loop,e>=a.start&&e<=a.end&&e<this.director.duration){if(!l.isPlaying||!this.director.isPlaying)(s||!a._didTriggerPlay&&this.lastTime<e)&&(a.duration*a.timeScale>.3?l.offset=a.clipIn+(e-a.start)*a.timeScale:l.offset=0,Va&&console.log("Timeline Audio ("+this.track.name+") play with offset "+l.offset+" - "+a.asset.clip),l.play(r),a._didTriggerPlay=!0);else{const d=a.clipIn+(e-a.start)*a.timeScale,f=l.context.currentTime-l._startedAt+l.offset;Math.abs(d-f)>.3&&(l.offset=d,l.stop(),l.play(r))}let u=h.volume;if(this.track.volume!==void 0&&(u*=this.track.volume),i&&(u=0),a.easeInDuration>0){const d=Math.min((e-a.start)/a.easeInDuration,1);u*=d}if(a.easeOutDuration>0){const d=Math.min((a.end-e)/a.easeOutDuration,1);u*=d}l.setVolume(u*this.director.weight)}else a._didTriggerPlay=!1,this.director.isPlaying&&l.isPlaying&&l.stop()}this.lastTime=e}loadAudio(e,i=0,s=0){let r=null;const o=e-s,a=e+i;for(const l of this.models)if(this.isInTimeRange(l,o,a)){const h=this.audio[this.models.indexOf(l)],u=this.handleAudioLoading(l,h);u!==null&&(r===null&&(r=[]),r.push(u))}return r!==null?Promise.all(r):null}isInTimeRange(e,i,s){return i<=e.start&&s>=e.end||i>=e.start&&i<=e.end||s>=e.start&&s<=e.end}static dispose(){Yd._audioBuffers.clear()}handleAudioLoading(e,i){this._audioLoader||(this._audioLoader=new zw);const s=this.getAudioFilePath(e.asset.clip);if(Yd._audioBuffers.get(s)){const o=Yd._audioBuffers.get(s);return o.then(a=>{a&&i.setBuffer(a)}),o}Va&&console.warn("LOAD audio track",s,this.director.sourceId);const r=new Promise((o,a)=>{this._audioLoader.load(s,l=>{i.setBuffer(l),o(l)},void 0,l=>{console.error("Error loading audio",l),o(null)})});return Yd._audioBuffers.set(s,r),r}};let ff=Yd;c(ff,"_audioBuffers",new Map);class xy extends j0{constructor(){super(...arguments);c(this,"models",[]);c(this,"didTrigger",[]);c(this,"receivers",[])}evaluate(e){var s;if(this.track.muted)return;const i=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],l=o.time-e;let h=!1;if(o.retroActive)h=l<=1e-6;else{const u=Math.abs(l);(u===0||u>=1e-5&&u<i)&&(h=!0)}if(h){if(!a)if(Va&&console.log("Trigger signal",e,o.time,o),this.didTrigger[r]=!0,((s=this.receivers)==null?void 0:s.length)<=0)nh.invoke(o.asset);else for(const u of this.receivers)u&&u.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class iE extends j0{constructor(){super(...arguments);c(this,"models",[]);c(this,"timelines",[]);c(this,"_previousActiveModel",null)}resolveSourceObjects(e){for(let i=this.models.length-1;i>=0;i--){const r=this.models[i].asset;if(!r.sourceObject||typeof r.sourceObject!="object"){console.log("no source object, removing model",i,r),this.models.splice(i,1);continue}else{const o=Q.getComponent(r.sourceObject,$a);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}}}evaluate(e){var i;this._previousActiveModel=null;for(let s=0;s<this.models.length;s++){const r=this.models[s],o=r.asset;if(e>=r.start&&e<=r.end){this._previousActiveModel=r;const a=this.getClipTime(e,r);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[s];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;(a==null?void 0:a.sourceObject)!==l&&(l.visible=!1)}}}}}var t2=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const _l=z("debugtimeline");var Nd;(function(n){n[n.Hold=0]="Hold",n[n.Loop=1]="Loop",n[n.None=2]="None"})(Nd||(Nd={}));var yR;(function(n){n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue"})(yR||(yR={}));const e0=class extends re{constructor(){super(...arguments);c(this,"playableAsset");c(this,"playOnAwake");c(this,"extrapolationMode",Nd.Loop);c(this,"waitForAudio",!0);c(this,"_visibilityChangeEvt");c(this,"_clonedPlayableAsset",!1);c(this,"_speed",1);c(this,"_guidsMap");c(this,"_isPlaying",!1);c(this,"_internalUpdateRoutine");c(this,"_isPaused",!1);c(this,"_isStopping",!1);c(this,"_time",0);c(this,"_duration",0);c(this,"_weight",1);c(this,"_animationTracks",[]);c(this,"_audioTracks",[]);c(this,"_signalTracks",[]);c(this,"_controlTracks",[]);c(this,"_customTracks",[]);c(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]);c(this,"animationCallbackReceivers",[])}static registerCreateTrack(e,i){this.createTrackFunctions[e]=i}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(e){typeof e=="number"&&!Number.isNaN(e)?this._time=e:(_l||fr())&&console.error("INVALID TIMELINE.TIME VALUE",e,this.name)}get duration(){return this._duration}set duration(e){this._duration=e}get weight(){return this._weight}set weight(e){this._weight=e}get speed(){return this._speed}set speed(e){this._speed=e}awake(){var e,i,s,r,o;_l&&console.log(this,(e=this.playableAsset)==null?void 0:e.tracks),this.rebuildGraph(),!this.isValid()&&(_l||ve())&&(_l?console.warn("PlayableDirector is not valid","Asset?",this.playableAsset,"Tracks:",(i=this.playableAsset)==null?void 0:i.tracks,"IsArray?",Array.isArray((s=this.playableAsset)==null?void 0:s.tracks),this):(o=(r=this.playableAsset)==null?void 0:r.tracks)!=null&&o.length?console.warn("PlayableDirector is not valid"):console.warn("PlayableDirector has no tracks"))}onEnable(){var e,i,s;for(const r of this._audioTracks)(e=r.onEnable)==null||e.call(r);for(const r of this._customTracks)(i=r.onEnable)==null||i.call(r);for(const r of this._animationTracks)(s=r.onEnable)==null||s.call(r);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var e,i,s;this.stop();for(const r of this._audioTracks)(e=r.onDisable)==null||e.call(r);for(const r of this._customTracks)(i=r.onDisable)==null||i.call(r);for(const r of this._animationTracks)(s=r.onDisable)==null||s.call(r);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var e;for(const i of this._allTracks)for(const s of i)(e=s.onDestroy)==null||e.call(s)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const e=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,e&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const i=[];for(const s of this._audioTracks){const r=s.loadAudio(this._time,1,0);r&&i.push(r)}if(i.length>0&&(await Promise.all(i),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!kt.userInteractionRegistered&&this.waitForAudio;)await sc(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),We.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const s of this._audioTracks)s.stop();const e=this._isPaused==!0,i=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),e&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,e&&!i&&this.invokePauseChangedMethodsOnTracks(),i&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const e of this._allTracks)for(const i of e)yield i}get audioTracks(){return this._audioTracks}resolveGuids(e){this._guidsMap=e}invokePauseChangedMethodsOnTracks(){var e;for(const i of this.forEachTrack())(e=i.onPauseChanged)==null||e.call(i)}invokeStateChangedMethodsOnTracks(){var e;for(const i of this.forEachTrack())(e=i.onStateChanged)==null||e.call(i,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(e=!1){if(!this.isValid())return;let i=this._time;switch(this.extrapolationMode){case Nd.Hold:this._speed>0?i=Math.min(i,this._duration):this._speed<0&&(i=Math.max(i,0)),this._time=i;break;case Nd.Loop:i%=this._duration,this._time=i;break;case Nd.None:if(i>this._duration){this.stop();return}break}const s=this._time;for(const r of this.playableAsset.tracks)if(!r.muted)switch(r.type){case xr.Activation:if(!e&&!this._isPlaying)continue;for(let o=0;o<r.outputs.length;o++){const a=r.outputs[o];if(typeof a=="object"){let l=!1;if(r.clips)for(const u of r.clips)u.start<=s&&s<=u.end&&(l=!0);const h=a;h.visible!==void 0&&h.visible!==l&&(h.visible=l,_l&&console.warn(this.name,"set ActivationTrack-"+o,h.name,l,s))}}break}if(!this._isStopping)for(const r of this._animationTracks)r.evaluate(s);for(const r of this._audioTracks)r.evaluate(s);for(const r of this._signalTracks)r.evaluate(s);for(const r of this._controlTracks)r.evaluate(s);for(const r of this._customTracks)r.evaluate(s)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=p0(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const e=this.findRoot(this.gameObject);for(const i of this.playableAsset.tracks){for(let s=i.outputs.length-1;s>=0;s--){let r=i.outputs[s];if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=Q.findByGuid(r,e);o===null||typeof o!="object"?(i.outputs.splice(s,1),console.warn("Failed to resolve binding",r,i.name,i.type)):(_l&&console.log("Resolved binding",r,"to",o),i.outputs[s]=o)}else if(r===null){if(i.outputs.splice(s,1),e0.createTrackFunctions[i.type])continue;i.type!==xr.Audio&&i.type!==xr.Control&&i.type!==xr.Marker&&i.type!==xr.Signal&&console.warn("Missing binding",r,i.name,i.type,this.name,this.playableAsset.name)}}if(i.type===xr.Control&&i.clips)for(let s=0;s<i.clips.length;s++){const r=i.clips[s];let o=r.asset.sourceObject;if(typeof o=="string"){this._guidsMap&&this._guidsMap[o]&&(o=this._guidsMap[o]);const a=Q.findByGuid(o,e);a===null||typeof a!="object"?console.warn("Failed to resolve sourceObject binding",o,i.name,r):(_l&&console.log("Resolved binding",o,"to",a),r.asset.sourceObject=a)}}}}findRoot(e){return e.parent?this.findRoot(e.parent):e}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const e of this.playableAsset.tracks)if(e.muted!==!0){if(e.clips)for(const i of e.clips)i.end>this._duration&&(this._duration=i.end);if(e.markers)for(const i of e.markers)i.time>this._duration&&(this._duration=i.time+.001)}}}setupAndCreateTrackHandlers(){var i,s,r;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let e=Q.findObjectOfType(vu,this.context);for(const o of this.playableAsset.tracks){const a=o.type,l=e0.createTrackFunctions[a];if(l!=null){const h=l(this,o);if(typeof h.evaluate=="function"){h.director=this,h.track=o,this._customTracks.push(h);continue}}if(o.type===xr.Animation){if(!o.clips||o.clips.length<=0){_l&&console.warn("Animation track has no clips",o);continue}for(let h=o.outputs.length-1;h>=0;h--){let u=o.outputs[h];if(u instanceof ne){const f=Q.getOrAddComponent(u,Cs);f&&(u=f)}const d=(i=u==null?void 0:u.gameObject)==null?void 0:i.animations;if(d){const f=new tE;f.trackOffset=o.trackOffset,f.director=this,f.track=o;for(let p=0;p<o.clips.length;p++){const g=o.clips[p],m=g.asset;if(!m){console.error(`Timeline ${this.name}: clip #${p} on track "${o.name}" has no animation data`);continue}const v=m.clip;let y=v;if((typeof y=="string"||typeof y=="number")&&(y=d.find(_=>_.name===v)),_l&&console.log(m,v,"â†’",y),!y){console.warn("Could not find animationClip for model",g,o.name,this.name,(s=this.playableAsset)==null?void 0:s.name,d,u);continue}u instanceof Cs&&u.runtimeAnimatorController&&(u.__internalDidAwakeAndStart||u.initializeRuntimeAnimatorController(),u.runtimeAnimatorController.mixer||u.runtimeAnimatorController.bind(u),f.mixer=u.runtimeAnimatorController.mixer),f.mixer||(f.mixer=new DC(u.gameObject),this.context.animations.registerAnimationMixer(f.mixer)),f.clips.push(y),f.mixer.uncacheAction(y),f.createHooks(g.asset,y);const b=f.mixer.clipAction(y);f.actions.push(b),f.models.push(g)}this._animationTracks.push(f)}}}else if(o.type===xr.Audio){if(!o.clips||o.clips.length<=0)continue;const h=new ff;h.director=this,h.track=o,h.audioSource=o.outputs.find(u=>u instanceof kt),this._audioTracks.push(h),e||(e=(r=this.context.mainCameraComponent)==null?void 0:r.gameObject.addNewComponent(vu)),h.listener=e.listener;for(let u=0;u<o.clips.length;u++){const d=o.clips[u];h.addModel(d)}}else if(o.type===xr.Marker){const h=new xy;if(h.director=this,h.track=o,o.markers)for(const u of o.markers)switch(u.type){case qx.Signal:h.models.push(u),h.didTrigger.push(!1);break}if(h!==null&&h.models.length>0){const u=Q.getComponent(this.gameObject,nh);u&&(h.receivers.push(u),this._signalTracks.push(h))}}else if(o.type===xr.Signal){const h=new xy;if(h.director=this,h.track=o,o.markers)for(const u of o.markers)h.models.push(u),h.didTrigger.push(!1);for(const u of o.outputs)h.receivers.push(u);this._signalTracks.push(h)}else if(o.type===xr.Control){const h=new iE;if(h.director=this,h.track=o,o.clips)for(const u of o.clips)h.models.push(u);h.resolveSourceObjects(this.context),this._controlTracks.push(h)}}}setAudioTracksAllowPlaying(e){for(const i of this._audioTracks)i.onAllowAudioChanged(e)}registerAnimationCallback(e){this.animationCallbackReceivers.push(e)}unregisterAnimationCallback(e){const i=this.animationCallbackReceivers.indexOf(e);i!==-1&&this.animationCallbackReceivers.splice(i,1)}};let $a=e0;c($a,"createTrackFunctions",{});t2([A()],$a.prototype,"playOnAwake",void 0);t2([A()],$a.prototype,"extrapolationMode",void 0);const zv=Symbol("objectIsAnimatedData");function bR(n,t,e){if(!n)return;if(n[zv]===void 0){if(!e)return;n[zv]=new Set}const i=n[zv];e?i.add(t):i.has(t)&&i.delete(t)}function v9(n){if(!n)return!1;const t=n[zv];return t!==void 0&&t.size>0}xt.registerCallback(dt.ContextCreated,n=>{const t=n.context.domElement.getAttribute("autoplay");if(t!==void 0&&(t===""||t==="true"||t==="1")&&n.files)for(const e of n.files)Q.foreachComponent(e.file.scene,s=>{if(s.enabled!==!1){if(s instanceof Ws&&s.playAutomatically||s instanceof Cs||s instanceof $a&&s.playOnAwake===!0)return!0;if(s instanceof Ws)return s.playAutomatically=!0,!0;if(s instanceof $a)return s.playOnAwake=!0,!0}},!0)!==!0&&sm.assignAnimationsFromFile(e.file,{createAnimationComponent:(s,r)=>Ao(s,Ws)})});class gJ{constructor(){c(this,"_context")}get context(){return this._context??je.Current}get isStateMachineBehaviour(){return!0}}class GA{constructor(t,e,i,s){c(this,"name");c(this,"nameHash");c(this,"normalizedTime");c(this,"length");c(this,"speed");c(this,"action");c(this,"hasTransitions");var r;this.name=t.name,this.nameHash=t.hash,this.normalizedTime=e,this.length=i,this.speed=s,this.action=t.motion.action||null,this.hasTransitions=((r=t.transitions)==null?void 0:r.length)>0||!1}}function y9(n,t){return{name:"Empty",isLooping:!1,guid:(t==null?void 0:t.generateUUID())??ct.generateUUID(),index:-1,clip:new ql(n,0,[])}}var Qc;(function(n){n[n.If=1]="If",n[n.IfNot=2]="IfNot",n[n.Greater=3]="Greater",n[n.Less=4]="Less",n[n.Equals=6]="Equals",n[n.NotEqual=7]="NotEqual"})(Qc||(Qc={}));var Xx;(function(n){n[n.Float=1]="Float",n[n.Int=3]="Int",n[n.Bool=4]="Bool",n[n.Trigger=9]="Trigger"})(Xx||(Xx={}));const en=z("debuganimatorcontroller"),HA=z("debugrootmotion");class vo{constructor(t){c(this,"_speed",1);c(this,"normalizedStartOffset",0);c(this,"animator");c(this,"model");c(this,"_mixer");c(this,"_activeState");c(this,"_activeStates",[]);c(this,"_heldActions",[]);c(this,"rootMotionHandler");this.model=t,en&&console.log(this)}static createFromClips(t,e={looping:!1,autoTransition:!0,transitionDuration:0}){const i=[];for(let o=0;o<t.length;o++){const a=t[o],l=[];if(e.autoTransition!==!1){const u=e.transitionDuration??0,d=u/a.duration;let f=o;(e.autoTransition===void 0||e.autoTransition===!0)&&(f=(o+1)%t.length),l.push({exitTime:1-d,offset:0,duration:u,hasExitTime:!0,destinationState:f,conditions:[]})}const h={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:(e==null?void 0:e.looping)??!1},transitions:l,behaviours:[]};i.push(h)}const s={name:"AnimatorController",guid:new Sn(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:i}}]};return new vo(s)}play(t,e=-1,i=Number.NEGATIVE_INFINITY,s=0){if(e<0)e=0;else if(e>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[e].stateMachine;for(const a of o.states)if(a.name===t||a.hash===t){en&&console.log("transition to ",a),this.transitionTo(a,s,i);return}console.warn("Could not find "+t+" to play")}reset(){this.setStartTransition()}setBool(t,e){var s,r;const i=typeof t=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===t).forEach(o=>o.value=e)}getBool(t){var i,s,r;const e=typeof t=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[e]===t))==null?void 0:r.value)??!1}setFloat(t,e){var r,o;const i=typeof t=="string"?"name":"hash",s=(o=(r=this.model)==null?void 0:r.parameters)==null?void 0:o.filter(a=>a[i]===t);return s.forEach(a=>a.value=e),(s==null?void 0:s.length)>0}getFloat(t){var i,s,r;const e=typeof t=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[e]===t))==null?void 0:r.value)??0}setInteger(t,e){var s,r;const i=typeof t=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===t).forEach(o=>o.value=e)}getInteger(t){var i,s,r;const e=typeof t=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[e]===t))==null?void 0:r.value)??0}setTrigger(t){var i,s;en&&console.log("SET TRIGGER",t);const e=typeof t=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(r=>r[e]===t).forEach(r=>r.value=!0)}resetTrigger(t){var i,s;const e=typeof t=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(r=>r[e]===t).forEach(r=>r.value=!1)}getTrigger(t){var i,s,r;const e=typeof t=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[e]===t))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(t){this._speed=t}FindState(t){return this.findState(t)}findState(t){if(!t)return null;if(Array.isArray(this.model.layers)){for(const e of this.model.layers)for(const i of e.stateMachine.states)if(i.name===t||i.hash==t)return i}return null}getCurrentStateInfo(){if(!this._activeState)return null;const t=this._activeState.motion.action;if(!t)return null;const e=this._activeState.motion.clip.duration,i=e<=0?0:Math.abs(t.time/e);return new GA(this._activeState,i,e,this._speed)}get currentAction(){if(!this._activeState)return null;const t=this._activeState.motion.action;return t||null}get context(){var t;return(t=this.animator)==null?void 0:t.context}get mixer(){return this._mixer}dispose(){var t;if(this._mixer.stopAllAction(),this.animator){this._mixer.uncacheRoot(this.animator.gameObject);for(const e of this._activeStates)e.motion.clip&&this.mixer.uncacheAction(e.motion.clip,this.animator.gameObject)}(t=this.context)==null||t.animations.unregisterAnimationMixer(this._mixer)}bind(t){var e,i;t?this.animator!==t&&(this._mixer&&(this._mixer.stopAllAction(),(e=this.context)==null||e.animations.unregisterAnimationMixer(this._mixer)),this.animator=t,this._mixer=new DC(this.animator.gameObject),(i=this.context)==null||i.animations.registerAnimationMixer(this._mixer),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;en&&console.warn("AnimatorController clone()",this.model);const t=p0(this.model,(i,s,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||Az(r)||r.tracks!==void 0||r instanceof vo));return console.assert(t!==this.model),new vo(t)}update(t){var i,s;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(t);const e=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(t)),this._mixer.update(e),this.animator.applyRootMotion&&((s=this.rootMotionHandler)==null||s.onAfterUpdate(t))}get activeState(){return this._activeState}updateActiveStates(t){for(let e=0;e<this._activeStates.length;e++){const i=this._activeStates[e],s=i.motion;if(!s.action)this._activeStates.splice(e,1),e--;else{const r=s.action;r.weight=t,r.getEffectiveWeight()<=0&&!r.isRunning()&&(en&&console.debug("REMOVE",i.name,r.getEffectiveWeight(),r.isRunning(),r.isScheduled()),this._activeStates.splice(e,1),e--)}}}setStartTransition(){var t;this.model.layers.length>1&&(en||ve())&&console.warn("Multiple layers are not supported yet "+((t=this.animator)==null?void 0:t.name));for(const e of this.model.layers){const i=e.stateMachine;i.defaultState===void 0&&(en&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",e),i.defaultState=0);const s=i.states[i.defaultState];this.transitionTo(s,0,this.normalizedStartOffset);break}}evaluateTransitions(){var r;let t=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;t=!0}const e=this._activeState,i=e.motion.action;for(const o of e.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let a=!0;for(const l of o.conditions)if(!this.evaluateCondition(l)){a=!1;break}if(a)if(i){const l=e.motion.clip.duration,h=l<=0?1:Math.abs(i.time/l);let u=o.exitTime;i.timeScale<0&&(u=1-u);let d=!1;if(o.hasExitTime?i.timeScale>0?d=h>=o.exitTime:i.timeScale<0&&(d=1-h>=o.exitTime):d=!0,d){for(const f of o.conditions){const p=this.model.parameters.find(g=>g.name===f.parameter);(p==null?void 0:p.type)===Xx.Trigger&&p.value&&(p.value=!1)}if(i.clampWhenFinished=!0,en){const f=this.getState(o.destinationState,0);console.log(`Transition to ${o.destinationState} / ${f==null?void 0:f.name}`,o,`
Timescale: `+i.timeScale,`
Normalized time: `+h.toFixed(3),`
Exit Time: `+u,o.hasExitTime)}this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}}i&&this.setTimescale(i,e);let s=!1;if(e.motion.isLooping&&i&&(i.time>=i.getClip().duration?(s=!0,i.reset(),i.time=0,i.play()):i.time<=0&&i.timeScale<0&&(s=!0,i.reset(),i.time=i.getClip().duration,i.play())),!s&&e&&!t&&i&&this.animator&&e.behaviours){const o=i==null?void 0:i.getClip().duration,a=i.time/o,l=new GA(this._activeState,a,o,this._speed);for(const h of e.behaviours)h.instance&&((r=h.instance.onStateUpdate)==null||r.call(h.instance,this.animator,l,0))}}setTimescale(t,e){let i=e.speed??1;e.speedParameter&&(i*=this.getFloat(e.speedParameter)),i!==void 0&&(t.timeScale=i*this._speed)}getState(t,e){return typeof t=="number"&&(t==-1&&(t=this.model.layers[e].stateMachine.defaultState,t===void 0&&(en&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+e),t=0)),t=this.model.layers[e].stateMachine.states[t]),t}releaseHeldActions(t){for(const e of this._heldActions)e.fadeOut(t);this._heldActions.length=0}transitionTo(t,e,i){var u,d,f,p,g,m,v,y;if(!this.animator)return;const s=0;if(t=this.getState(t,s),!(t!=null&&t.motion)||!t.motion.clip||!(t.motion.clip instanceof ql))return;const r=this._activeState===t;if(r){const b=t.motion;if(!b.action_loopback&&b.clip){const _=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(b.clip,this.animator.gameObject),_&&_.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),b.action_loopback=this.createAction(b.clip)}}if((u=this._activeState)!=null&&u.behaviours&&this._activeState.motion.action){const b=(d=this._activeState)==null?void 0:d.motion.clip.duration,_=this._activeState.motion.action.time/b,x=new GA(this._activeState,_,b,this._speed);for(const S of this._activeState.behaviours)(p=(f=S.instance)==null?void 0:f.onStateExit)==null||p.call(S.instance,this.animator,x,s)}const o=(g=this._activeState)==null?void 0:g.motion.action;r&&(t.motion.action=t.motion.action_loopback,t.motion.action_loopback=o);const a=this._activeState;this._activeState=t;const l=(m=t.motion)==null?void 0:m.action,h=t.motion.clip;if((h==null?void 0:h.duration)<=0&&h.tracks.length<=0?o&&this._heldActions.push(o):o&&(o.fadeOut(e),this.releaseHeldActions(e)),l){if(i=Math.max(0,Math.min(1,i)),t.cycleOffsetParameter){let _=this.getFloat(t.cycleOffsetParameter);typeof _=="number"?(_<0&&(_+=1),i+=_,i%=1):en&&console.warn("AnimatorController cycle offset parameter is not a number",t.cycleOffsetParameter)}else typeof t.cycleOffset=="number"&&(i+=t.cycleOffset,i%=1);l.isRunning()&&l.stop(),l.reset(),l.enabled=!0,this.setTimescale(l,t);const b=t.motion.clip.duration;if(l.time=r?0:i*b,l.timeScale<0&&(l.time=b-l.time),l.clampWhenFinished=!0,l.setLoop(Nw,0),e>0?l.fadeIn(e):l.weight=1,l.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(l),this._activeStates.includes(t)||this._activeStates.push(t),this._activeState.behaviours){const _=new GA(t,i,b,this._speed);for(const x of this._activeState.behaviours)(y=(v=x.instance)==null?void 0:v.onStateEnter)==null||y.call(x.instance,this.animator,_,s)}}else en&&(t.__warned_no_motion||(t.__warned_no_motion=!0,console.warn("No action",t.motion,this)));en&&console.log("TRANSITION FROM "+(a==null?void 0:a.name)+" TO "+t.name,e,o,l,l==null?void 0:l.getEffectiveTimeScale(),l==null?void 0:l.getEffectiveWeight(),l==null?void 0:l.isRunning(),l==null?void 0:l.isScheduled(),l==null?void 0:l.paused)}createAction(t){var i,s;if(this._mixer.existingAction(t)&&this._mixer.uncacheAction(t,(i=this.animator)==null?void 0:i.gameObject),(s=this.animator)!=null&&s.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new b9(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,t)}else return this._mixer.clipAction(t)}evaluateCondition(t){const e=this.model.parameters.find(i=>i.name===t.parameter);if(!e)return!1;switch(t.mode){case Qc.If:return e.value===!0;case Qc.IfNot:return e.value===!1;case Qc.Greater:return e.value>t.threshold;case Qc.Less:return e.value<t.threshold;case Qc.Equals:return e.value===t.threshold;case Qc.NotEqual:return e.value!==t.threshold}return!1}createActions(t){var e,i,s,r;en&&console.log("AnimatorController createActions",this.model);for(const o of this.model.layers){const a=o.stateMachine;for(let l=0;l<a.states.length;l++){const h=a.states[l];h.transitions||(h.transitions=[]);for(const u of h.transitions)u.conditions||(u.conditions=[]);if(h.motion||(en&&console.warn("No motion",h),h.motion=y9(h.name)),this.animator&&h.motion.clips){const u=(e=h.motion.clips)==null?void 0:e.find(d=>{var f,p;return d.node.name===((p=(f=this.animator)==null?void 0:f.gameObject)==null?void 0:p.name)});u?h.motion.clip=u.clip:(en||ve())&&console.warn('Could not find clip for animator "'+((s=(i=this.animator)==null?void 0:i.gameObject)==null?void 0:s.name)+'"',h.motion.clips.map(d=>d.node.name))}if(!h.motion.clip){en&&console.warn("No clip assigned to state",h);const u=new ql(void 0,void 0,[]);h.motion.clip=u}if((r=h.motion)!=null&&r.clip){const u=h.motion.clip;if(u instanceof ql){const d=this.createAction(u);h.motion.action=d}else(en||ve())&&console.warn("No valid animationclip assigned",h)}if(h.behaviours&&Array.isArray(h.behaviours))for(const u of h.behaviours){if(!(u!=null&&u.typeName))continue;const d=D.get(u.typeName);if(d){const f=new d;f.isStateMachineBehaviour&&(f._context=this.context??void 0,Mf(f,u.properties),u.instance=f),en&&console.log("Created animator controller behaviour",h.name,u.typeName,u.properties,f)}else(en||ve())&&console.warn("Could not find AnimatorBehaviour type: "+u.typeName)}}}}*enumerateActions(){if(this.model.layers)for(const t of this.model.layers){const e=t.stateMachine;for(let i=0;i<e.states.length;i++){const s=e.states[i];s!=null&&s.motion&&(s.motion.action&&(yield s.motion.action),s.motion.action_loopback&&(yield s.motion.action_loopback))}}}}class _R{constructor(t,e){c(this,"track");c(this,"createdInterpolant");c(this,"originalEvaluate");c(this,"customEvaluate");this.track=t;const i=t,s=i.createInterpolant.bind(t);i.createInterpolant=()=>(i.createInterpolant=s,this.createdInterpolant=s(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return e(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const rn=class{constructor(t,e,i,s,r){c(this,"_action");c(this,"root");c(this,"clip");c(this,"positionWrapper",null);c(this,"rotationWrapper",null);c(this,"context");c(this,"positionChange",new w);c(this,"rotationChange",new ie);c(this,"_prevTime",0);if(this.context=t,this.root=e,this.clip=i,rn.firstKeyframeRotation[this.cacheId]||(rn.firstKeyframeRotation[this.cacheId]=new ie),r){const o=r.values;rn.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}rn.spaceRotation[this.cacheId]||(rn.spaceRotation[this.cacheId]=new ie),rn.effectiveSpaceRotation[this.cacheId]||(rn.effectiveSpaceRotation[this.cacheId]=new ie),rn.clipOffsetRotation[this.cacheId]=new ie,r&&rn.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,s),this.handleRotation(i,r)}set action(t){this._action=t}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(t){if(t.getClip()!==this.clip)return;rn.lastObjRotation[this.cacheId]||(rn.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const e=rn.lastObjRotation[this.cacheId];if(rn.spaceRotation[this.cacheId].copy(e),HA){const i=new jt().setFromQuaternion(e);console.log("START",this.clip.name,ye.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return rn.clipOffsetRotation[this.cacheId]}handlePosition(t,e){if(e){const i=this.root;HA&&i.add(new dr),rn.lastObjPosition[this.cacheId]||(rn.lastObjPosition[this.cacheId]=this.root.position.clone());const s=new w,r=new w;this.positionWrapper=new _R(e,(o,a)=>{const l=this.action.getEffectiveWeight();return HA&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(s.set(a[0],a[1],a[2]),s.sub(r),s.multiplyScalar(l),s.applyQuaternion(this.getClipRotationOffset()),s.applyQuaternion(i.quaternion),this.positionChange.copy(s)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(t,e){if(e){if(HA){const o=e.values,a=new jt().setFromQuaternion(new ie(o[0],o[1],o[2],o[3]));console.log(t.name,e.name,"FIRST ROTATION IN TRACK",ye.toDegrees(a.y));const l=e.values.length-4,h=new ie().set(o[l],o[l+1],o[l+2],o[l+3]),u=new jt().setFromQuaternion(h);console.log(t.name,e.name,"LAST ROTATION IN TRACK",ye.toDegrees(u.y))}let i=0;const s=new ie,r=new ie;this.rotationWrapper=new _R(e,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),s.invert(),r.multiply(s),this.rotationChange.copy(r)),s.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(t){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(t){return!this.action||(t*=this.action.getEffectiveWeight(),t<=0)?!1:(this.positionChange.multiplyScalar(t),this.rotationChange.slerp(rn.identityQuaternion,1-t),!0)}};let Aa=rn;c(Aa,"lastObjPosition",{}),c(Aa,"lastObjRotation",{}),c(Aa,"firstKeyframeRotation",{}),c(Aa,"spaceRotation",{}),c(Aa,"effectiveSpaceRotation",{}),c(Aa,"clipOffsetRotation",{}),c(Aa,"identityQuaternion",new ie);class b9{constructor(t){c(this,"controller");c(this,"handler",[]);c(this,"root");c(this,"basePosition",new w);c(this,"baseQuaternion",new ie);c(this,"baseRotation",new jt);c(this,"summedPosition",new w);c(this,"summedRotation",new ie);this.controller=t}createClip(t,e,i){this.root=e,e&&"name"in e&&e.name;const s=this.findRootTrack(i,".position"),r=this.findRootTrack(i,".quaternion"),o=new Aa(this.controller.context,e,i,s,r);this.handler.push(o);const a=t.clipAction(i);return o.action=a,a}onStart(t){for(const e of this.handler)e.onStart(t)}onBeforeUpdate(t){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const e of this.handler)e.onBeforeUpdate(t)}onAfterUpdate(t){if(!(t<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const e of this.handler)e.onAfterUpdate(t)&&(this.summedPosition.add(e.positionChange),this.summedRotation.multiply(e.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(t,e){const i=t.tracks;if(!i)return null;for(const s of i)if(s.name.endsWith(e))return s;return null}}class _9 extends So{onSerialize(t,e){}onDeserialize(t,e){if(e.type===vo&&(t==null?void 0:t.__type)==="AnimatorController")return new vo(t)}}new _9(vo);var G0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Zr=z("debuganimator");class Cs extends re{constructor(){super(...arguments);c(this,"applyRootMotion",!1);c(this,"hasRootMotion",!1);c(this,"keepAnimatorControllerStateOnDisable",!1);c(this,"_parametersAreDirty",!1);c(this,"_isDirty",!1);c(this,"_speed",1);c(this,"_normalizedStartOffset",0);c(this,"_animatorController",null);c(this,"_initializeWithRuntimeAnimatorController")}get isAnimationComponent(){return!0}set runtimeAnimatorController(e){var i;this._animatorController&&this._animatorController.model===e||(e?e instanceof vo?(e.animator&&e.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=e.model)==null?void 0:i.name),e.model||console.error("AnimatorController has no model"),e=new vo(e.model)),this._animatorController=e,this._animatorController.bind(this)):(Zr&&console.log("Assign animator controller",e,this),this._animatorController=new vo(e),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var e;return(e=this.runtimeAnimatorController)==null?void 0:e.getCurrentStateInfo()}get currentAction(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){this.play(e,i,s,r)}play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(e,i,s,r),this._isDirty=!0}Reset(){this.reset()}reset(){var e;(e=this._animatorController)==null||e.reset(),this._isDirty=!0}SetBool(e,i){this.setBool(e,i)}setBool(e,i){var s,r;Zr&&console.log("setBool",e,i),((s=this.runtimeAnimatorController)==null?void 0:s.getBool(e))!==i&&(this._parametersAreDirty=!0),(r=this.runtimeAnimatorController)==null||r.setBool(e,i)}GetBool(e){return this.getBool(e)}getBool(e){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getBool(e))??!1;return Zr&&console.log("getBool",e,i),i}toggleBool(e){this.setBool(e,!this.getBool(e))}SetFloat(e,i){this.setFloat(e,i)}setFloat(e,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getFloat(e))!==i&&(this._parametersAreDirty=!0),Zr&&console.log("setFloat",e,i),(r=this.runtimeAnimatorController)==null||r.setFloat(e,i)}GetFloat(e){return this.getFloat(e)}getFloat(e){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getFloat(e))??-1;return Zr&&console.log("getFloat",e,i),i}SetInteger(e,i){this.setInteger(e,i)}setInteger(e,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getInteger(e))!==i&&(this._parametersAreDirty=!0),Zr&&console.log("setInteger",e,i),(r=this.runtimeAnimatorController)==null||r.setInteger(e,i)}GetInteger(e){return this.getInteger(e)}getInteger(e){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getInteger(e))??-1;return Zr&&console.log("getInteger",e,i),i}SetTrigger(e){this.setTrigger(e)}setTrigger(e){var i;this._parametersAreDirty=!0,Zr&&console.log("setTrigger",e),(i=this.runtimeAnimatorController)==null||i.setTrigger(e)}ResetTrigger(e){this.resetTrigger(e)}resetTrigger(e){var i;this._parametersAreDirty=!0,Zr&&console.log("resetTrigger",e),(i=this.runtimeAnimatorController)==null||i.resetTrigger(e)}GetTrigger(e){this.getTrigger(e)}getTrigger(e){var s;const i=(s=this.runtimeAnimatorController)==null?void 0:s.getTrigger(e);return Zr&&console.log("getTrigger",e,i),i}IsInTransition(){return this.isInTransition()}isInTransition(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.isInTransition())??!1}SetSpeed(e){return this.setSpeed(e)}setSpeed(e){var i;e!==this._speed&&(Zr&&console.log("setSpeed",e),this._speed=e,((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(e))}set minMaxSpeed(e){var i;this._speed=ye.lerp(e.x,e.y,Math.random()),((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(e){var i;this._normalizedStartOffset=ye.lerp(e.x,e.y,Math.random()),((i=this.runtimeAnimatorController)==null?void 0:i.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){Zr&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(e=!1){const i=e||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const s=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=s,s?(console.assert(this.runtimeAnimatorController!==s),this.runtimeAnimatorController=s,console.assert(this.runtimeAnimatorController===s),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var e;this.keepAnimatorControllerStateOnDisable||(e=this._animatorController)==null||e.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!v9(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}G0([A()],Cs.prototype,"applyRootMotion",void 0);G0([A()],Cs.prototype,"hasRootMotion",void 0);G0([A()],Cs.prototype,"keepAnimatorControllerStateOnDisable",void 0);G0([A()],Cs.prototype,"runtimeAnimatorController",null);const Pa=z("debugusdzanimation"),Yx=z("debugusdzanimationserialization");class nE{constructor(t,e,i){c(this,"_start");c(this,"ext");c(this,"root");c(this,"clip");c(this,"speed");this.ext=t,this.root=e,this.clip=i}get start(){return this._start===void 0&&(this._start=this.ext.getStartTime01(this.root,this.clip)),this._start}get duration(){var t;return((t=this.clip)==null?void 0:t.duration)??ln.restPoseClipDuration}}const s1=class{constructor(t,e,i){c(this,"clip");c(this,"pos");c(this,"rot");c(this,"scale");c(this,"root");c(this,"target");c(this,"duration",0);c(this,"useRootMotion",!1);this.root=t,this.target=e,this.clip=i,i?this.duration=i.duration:this.duration=s1.restPoseClipDuration;const s=Q.getComponent(t,Cs);s&&(this.useRootMotion=s.applyRootMotion)}get frameRate(){return 60}addTrack(t){var e,i;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it â€“ this is likely a bug");return}t.name.endsWith("position")?this.pos=t:t.name.endsWith("quaternion")?this.rot=t:t.name.endsWith("scale")?this.scale=t:(t.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+t.name+" on "+(((e=this.root)==null?void 0:e.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+t.name+" on "+(((i=this.root)==null?void 0:i.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),ve()&&qt("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var t,e,i,s,r,o;return this.clip?Math.max(((e=(t=this.pos)==null?void 0:t.times)==null?void 0:e.length)??0,((s=(i=this.rot)==null?void 0:i.times)==null?void 0:s.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(t=!0,e=!0,i=!0){var l,h,u;if(!this.clip)return[0,this.duration];const s=(l=this.pos)==null?void 0:l.times,r=(h=this.rot)==null?void 0:h.times,o=(u=this.scale)==null?void 0:u.times,a=[];if(t&&s)for(const d of s)a.push(d);if(e&&r)for(const d of r)a.push(d);if(i&&o)for(const d of o)a.push(d);return a.includes(0)||a.push(0),a.sort((d,f)=>d-f),[...new Set(a)]}*getValues(t,e=!0,i=!0,s=!0){var f,p,g;const r=new w,o=new ie,a=new w(1,1,1),l=this.target,h=e?(f=this.pos)==null?void 0:f.createInterpolant():void 0,u=i?(p=this.rot)==null?void 0:p.createInterpolant():void 0,d=s?(g=this.scale)==null?void 0:g.createInterpolant():void 0;h||r.set(l.position.x,l.position.y,l.position.z),u||o.set(l.quaternion.x,l.quaternion.y,l.quaternion.z,l.quaternion.w),d||a.set(l.scale.x,l.scale.y,l.scale.z);for(let m=0;m<t.length;m++){const v=t[m];if(h){const y=h.evaluate(v);r.set(y[0],y[1],y[2])}if(u){const y=u.evaluate(v);o.set(y[0],y[1],y[2],y[3])}if(d){const y=d.evaluate(v);a.set(y[0],y[1],y[2])}if(this.useRootMotion&&l===this.root){const y=new ae;y.compose(r,o,a),y.multiply(l.matrix),y.decompose(r,o,a)}yield{time:v,translation:r,rotation:o,scale:a,index:m}}}};let ln=s1;c(ln,"animationDurationPadding",1/60),c(ln,"restPoseClipDuration",1/60);class H0{constructor(t){c(this,"dict",new Map);c(this,"rootTargetMap",new Map);c(this,"rootAndClipToRegisteredAnimationMap",new Map);c(this,"rootToRegisteredClip",new Map);c(this,"serializers",[]);c(this,"injectRestPoses",!1);c(this,"injectImplicitBehaviours",!1);this.injectRestPoses=t,this.injectImplicitBehaviours=t}get extensionName(){return"animation"}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(ln.restPoseClipDuration+ln.animationDurationPadding)*60}getEndTimeCode(){let t=0;for(const[e,i]of this.rootAndClipToRegisteredAnimationMap){const s=i.start+i.duration;s>t&&(t=s)}return t*60}getClipCount(t){var i;return((i=this.rootToRegisteredClip.get(t))==null?void 0:i.length)??0??0}getStartTime01(t,e){if(!e)return 0;const i=this.rootTargetMap.get(t);if(!i)return 0;const s=this.dict.get(i[0]);if(!s)return console.error("Trying to get start time for root that has no animation data",t,e,...this.dict),0;let r=0;for(let o=0;o<s.length&&s[o].clip!==e;o++)r+=s[o].getDuration()+ln.animationDurationPadding;return r}registerAnimation(t,e){var h;if(!t)return null;this.rootTargetMap.has(t)||this.rootTargetMap.set(t,[]);const i=t.uuid+((e==null?void 0:e.uuid)??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(i))return this.rootAndClipToRegisteredAnimationMap.get(i);Pa&&console.log("registerAnimation",t,e);const s=this.injectRestPoses?1:0,r=(((h=this.rootToRegisteredClip.get(t))==null?void 0:h.length)??0)+s,o=this.rootTargetMap.get(t),a=new Set(o);if(e&&e.tracks)for(const u of e.tracks){const d=Ur.parseTrackName(u.name),f=Ur.findNode(t,d.nodeName);if(!f){console.warn("no object found for track",u.name,"using "+t.name+" instead");continue}this.dict.has(f)||this.dict.set(f,[]);const p=this.dict.get(f);if(!p){console.warn("no transform data found for target ",f,"at slot "+r+", this is likely a bug");continue}a.delete(f),this.injectRestPoses&&!p[0]&&(p[0]=new ln(null,f,null));let g=p[r];g||(g=new ln(t,f,e),p[r]=g),g.addTrack(u),o!=null&&o.includes(f)||o==null||o.push(f)}Pa&&console.log("Unregistered nodes for this clip",a,"clip",e,"at slot",r,"for root",t,"targets",o);for(const u of a){const d=this.dict.get(u);if(!d)continue;if(this.injectRestPoses&&!d[0]){console.warn("Adding rest pose for ",u,e,"at slot",r,"This is likely a bug, should have been added earlier.");const p=new ln(null,u,null);d[0]=p}let f=d[r];f||(Pa&&console.log("Adding padding clip for ",u,e,"at slot",r),f=new ln(t,u,e),d[r]=f)}const l=new nE(this,t,e);if(this.rootAndClipToRegisteredAnimationMap.set(i,l),Pa&&console.log({root:t,clip:e,info:l}),e){const u=this.rootToRegisteredClip.get(t);u?u.push(e):this.rootToRegisteredClip.set(t,[e])}return l}onAfterHierarchy(t){Pa&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(t){var e,i;Pa&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const s of this.rootTargetMap.keys()){const r=this.rootTargetMap.get(s);if(!r)continue;let o;const a=[];for(const l of r){const h=this.dict.get(l);if(!h){console.error("No data found for target on USDZ export â€“ please report a bug!",l);continue}o===void 0&&(o=h==null?void 0:h.length),o!==(h==null?void 0:h.length)&&console.error("Different array lengths for targets â€“ please report a bug!",h);for(let u=0;u<h.length;u++){let d=h[u];if(!d){const p=u-(this.injectRestPoses?1:0);h[u]=new ln(null,l,this.rootToRegisteredClip.get(s)[p]),d=h[u]}const f=d.getDuration();if(a[u]===void 0)a[u]=f;else if(a[u]!==f){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:h,target:l}),a[u]=f;continue}}}}for(const s of this.serializers){const r=(e=s.model)==null?void 0:e.parent,o=(r==null?void 0:r.isDynamic)===!0;Yx&&console.log(o,(i=s.model)==null?void 0:i.parent),o&&s.registerCallback(r)}}onExportObject(t,e,i){Q.foreachComponent(t,r=>{const o=r;typeof o.createAnimation=="function"&&o.createAnimation(this,e,i)},!1);const s=new w9(t,this.dict);this.serializers.push(s),s.registerCallback(e)}}class w9{constructor(t,e){c(this,"object");c(this,"dict");c(this,"model");c(this,"callback");this.object=t,this.dict=e}registerCallback(t){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),Yx&&console.log("REPARENT",t),this.model=t,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(t,e){var r;const i=this.model,s=this.dict;if(i&&i.skinnedMesh){let d=function(P){const F=[];for(const[j,V]of P){let X=`${j} : [`;const k=[];for(const O of V)k.push(`(${rt(O.x)}, ${rt(O.y)}, ${rt(O.z)})`);X=X.concat(k.join(", ")),X=X.concat("],"),F.push(X)}return F},f=function(P){const F=[];for(const[j,V]of P){let X=`${j} : [`;const k=[];for(const O of V)k.push(`(${rt(O.w)}, ${rt(O.x)}, ${rt(O.y)}, ${rt(O.z)})`);X=X.concat(k.join(", ")),X=X.concat("],"),F.push(X)}return F},p=function(P){let F,j=!0;const V=new Map;for(const[k,O]of P){F===void 0&&(F=O.length),F!==O.length&&(j=!1);let H=0;for(const ee of O)H++,ee||(V.has(k)||V.set(k,[]),V.get(k).push(H))}Pa&&console.log("Bone count: ",P.size,"TransformData entries per bone: ",F,"Undefined bone entries: ",V),console.assert(j,"All bones should have the same number of TransformData entries",P),console.assert(V.size===0,"All TransformData entries should be set",V);const X=[];for(const[k,O]of P){const H=new Array;let ee=0;for(let Y=0;Y<O.length;Y++)H.push(ee),ee+=O[Y].getDuration()+ln.animationDurationPadding;for(let Y=0;Y<O.length;Y++){const he=O[Y],ue=H[Y];X.length<=Y&&X.push({pos:[],rot:[],scale:[],timeOffset:ue});const _e=X[Y];_e.pos.push(...he.getSortedTimesArray(!0,!1,!1)),_e.rot.push(...he.getSortedTimesArray(!1,!0,!1)),_e.scale.push(...he.getSortedTimesArray(!1,!1,!0))}}for(const k of X)k.pos.sort((O,H)=>O-H),k.rot.sort((O,H)=>O-H),k.scale.sort((O,H)=>O-H),k.pos=[...new Set(k.pos)],k.rot=[...new Set(k.rot)],k.scale=[...new Set(k.scale)];return X},g=function(P,F,j){const V=new Map,X=new Map,k=new Map,O=F.length;for(const H of j){const ee=P.get(H);let Y;ee?console.assert(ee.length===O,"We should have the same number of TransformData entries for each bone",ee,F):Y=new ln(null,H,null);for(let he=0;he<O;he++){const ue=ee?ee[he]:Y,_e=F[he];for(const{time:Se,translation:qe}of ue.getValues(_e.pos,!0,!1,!1)){const Ye=(Se+_e.timeOffset)*60;V.has(Ye)||V.set(Ye,new Array),V.get(Ye).push(qe.clone())}for(const{time:Se,rotation:qe}of ue.getValues(_e.rot,!1,!0,!1)){const Ye=(Se+_e.timeOffset)*60;X.has(Ye)||X.set(Ye,new Array),X.get(Ye).push(qe.clone())}for(const{time:Se,scale:qe}of ue.getValues(_e.scale,!1,!1,!0)){const Ye=(Se+_e.timeOffset)*60;k.has(Ye)||k.set(Ye,new Array),k.get(Ye).push(qe.clone())}}}return{position:V.size==0?void 0:V,quaternion:X.size==0?void 0:X,scale:k.size==0?void 0:k}},m=function(P){const F=[];for(const j of P)F.push(`(${rt(j.x)}, ${rt(j.y)}, ${rt(j.z)})`);return F.join(", ")},v=function(P){const F=[];for(const j of P)F.push(`(${rt(j.w)}, ${rt(j.x)}, ${rt(j.y)}, ${rt(j.z)})`);return F.join(", ")},y=function(P){const F=new Map;if(Pa){const j=new Array;for(const[V,X]of s)j.push(V.uuid+": "+X.length+" "+X.map(k=>{var O;return(O=k.clip)==null?void 0:O.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+j.join(`
`))}for(const j of P){const V=s.get(j);V&&F.set(j,V)}return F},b=function(P){const F=y(P),j=p(F);return g(F,j,P)};const o=i.skinnedMesh.skeleton,a=new Array,l=[],h=[];for(const P of o.bones)if(P.parent.type!=="Bone"){l.push(P);const F=o.boneInverses[o.bones.indexOf(P)];a.push({bone:P,inverse:F}),h.push(P.uuid)}for(;h.length<o.bones.length;)for(const P of l){const F=P.children;for(const j of F)if(h.indexOf(j.uuid)===-1&&o.bones.indexOf(j)!==-1){l.push(j);const V=o.boneInverses[o.bones.indexOf(j)];a.push({bone:j,inverse:V}),h.push(j.uuid)}}for(const P of UO(o.bones))a.push({bone:P,inverse:P.matrixWorld.clone().invert()});const u=a[0].bone.parent;u||console.error("No bone parent found for skinned mesh during USDZ export",i.skinnedMesh),a.sort((P,F)=>df(P.bone,u)>df(F.bone,u)?1:-1);const _=e.quickLookCompatible,x=[],S=[],E=[],M=[];for(const{bone:P}of a){if(_){const F=P.scale;F.x==0&&(F.x=1e-5),F.y==0&&(F.y=1e-5),F.z==0&&(F.z=1e-5),x.push(new ae().compose(P.position,P.quaternion,P.scale))}else x.push(P.matrix.clone());S.push(P.position),E.push(P.quaternion),M.push(P.scale)}const I=a.map(P=>'"'+df(P.bone,u)+'"').join(", "),B=a.map(P=>oR(P.inverse.clone().invert())).join(", ");t.beginBlock('def Skeleton "Rig"'),t.appendLine(`uniform matrix4d[] bindTransforms = [${B}]`),t.appendLine(`uniform token[] joints = [${I}]`),t.appendLine('uniform token purpose = "guide"'),t.appendLine(`uniform matrix4d[] restTransforms = [${x.map(P=>oR(P)).join(", ")}]`);const R=b(a.map(P=>P.bone));if(Pa){let P=1e7,F=0;for(const j of((r=R.position)==null?void 0:r.keys())??[])P=Math.min(P,j),F=Math.max(F,j);console.log("Time samples",P,F,R)}if(t.beginBlock('def SkelAnimation "_anim"'),t.appendLine(`uniform token[] joints = [${I}]`),t.appendLine(`quatf[] rotations = [${v(E)}]`),R&&R.quaternion){t.beginBlock("quatf[] rotations.timeSamples = {","");const P=f(R.quaternion);for(const F of P)t.appendLine(F);t.closeBlock()}if(t.appendLine(`half3[] scales = [${m(M)}]`),R&&R.scale){t.beginBlock("half3[] scales.timeSamples = {","");const P=d(R.scale);for(const F of P)t.appendLine(F);t.closeBlock()}if(t.appendLine(`float3[] translations = [${m(S)}]`),R&&R.position){t.beginBlock("float3[] translations.timeSamples = {","");const P=d(R.position);for(const F of P)t.appendLine(F);t.closeBlock()}t.closeBlock(),t.closeBlock()}}onSerialize(t,e){if(!this.model)return;const i=this.dict.get(this.object);if(i)for(let d=0;d<i.length;d++)i[d]===void 0&&(i[d]=new ln(null,this.object,null));this.skinnedMeshExport(t,e);const s=this.object,r=this.model,o=this.dict.get(s);if(!o||s.isSkinnedMesh)return;Yx&&console.log("SERIALIZE",this.model.name,this.object.type,o);const a=new Array;let l=0;for(let d=0;d<o.length;d++){if(a.push(l),o[d]===void 0){console.error("Got an undefined transform data, this is likely a bug.",s,o);continue}l+=o[d].getDuration()+ln.animationDurationPadding}const h=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1});function u(d,f){var g;if(d.some(m=>m&&{position:m.pos,rotation:m.rot,scale:m.scale}[f])){switch(f){case"position":r.needsTranslate=!0,t.beginBlock("double3 xformOp:translate.timeSamples = {","");break;case"rotation":r.needsOrient=!0,t.beginBlock("quatf xformOp:orient.timeSamples = {","");break;case"scale":r.needsScale=!0,t.beginBlock("double3 xformOp:scale.timeSamples = {","");break}for(let m=0;m<d.length;m++){const v=d[m];if(!v)continue;const y=a[m],b=v.getSortedTimesArray(f==="position",f==="rotation",f==="scale");if(!b||b.length===0){console.error("got an animated object but no time values?",s,v);continue}{const _=((g=v.clip)==null?void 0:g.name)??"rest",x=v.getDuration();Pa&&console.log("Write .timeSamples:",_,y,x,d),t.appendLine("# "+_+": start="+h.format(y*v.frameRate)+", length="+h.format(x*v.frameRate)+", frames="+v.getFrames())}if(f==="position"&&v.pos)for(const{time:_,translation:x}of v.getValues(b,!0,!1,!1)){const E=`${h.format((y+_)*v.frameRate)}: (${rt(x.x)}, ${rt(x.y)}, ${rt(x.z)}),`;t.appendLine(E)}if(f==="rotation"&&v.rot)for(const{time:_,rotation:x}of v.getValues(b,!1,!0,!1)){const E=`${h.format((y+_)*v.frameRate)}: (${rt(x.w)}, ${rt(x.x)}, ${rt(x.y)}, ${rt(x.z)}),`;t.appendLine(E)}if(f==="scale"&&v.scale)for(const{time:_,scale:x}of v.getValues(b,!1,!1,!0)){const E=`${h.format((y+_)*v.frameRate)}: (${rt(x.x)}, ${rt(x.y)}, ${rt(x.z)}),`;t.appendLine(E)}}t.closeBlock()}}u(o,"position"),u(o,"rotation"),u(o,"scale")}}const x9=z("debugpost");let Kx=null;function C9(n){Kx=n}function i2(n){let t=n.gameObject;for(;t;){for(const e of jS(t))if(e.isPostProcessingManager===!0)return e;t=t.parent}return null}function S9(n){let t=i2(n);if(!t)if(Kx){x9&&console.warn("Adding postprocessing manager to the scene.");const e=n.scene;t=Ao(e,Kx)}else ve()&&console.warn("No post processing manager found");return t}var n2=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const E9=z("debugpost");class me{constructor(t){c(this,"isVolumeParameter",!0);c(this,"_isInitialized",!1);c(this,"_active",!0);c(this,"_value");c(this,"_valueRaw");c(this,"_defaultValue");c(this,"valueProcessor");c(this,"onValueChanged");t!==void 0&&this.initialize(t)}get isInitialized(){return this._isInitialized}initialize(t){t!==void 0&&(this._value=t,this._defaultValue=t,this._valueRaw=t,this._isInitialized=!0)}get overrideState(){return this._active}set overrideState(t){if(this._active===t)return;this._active=t;const e=t?this._valueRaw:this._defaultValue;this.processValue(e,!0)}get value(){return this._valueRaw}set value(t){this.isInitialized||this.initialize(t),this.processValue(t,!1)}set defaultValue(t){this._defaultValue=t}__init(){this.processValue(this._valueRaw,!0)}processValue(t,e){if(t==null||!e&&this.testIfValueChanged(t)===!1)return;const i=this._value;E9&&typeof i=="number"&&typeof t=="number"&&(i==null||i.toFixed(4),t==null||t.toFixed(4)),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,t=this._defaultValue,this._valueRaw=t):(this._valueRaw=t,this._active&&this.valueProcessor&&(t=this.valueProcessor(t)),this._value=t),this.onValueChanged&&this.onValueChanged(t,i,this)}testIfValueChanged(t){return this._valueRaw!==t}}n2([A()],me.prototype,"overrideState",null);n2([A()],me.prototype,"value",null);class I9 extends So{constructor(){super([me])}onSerialize(t,e){}onDeserialize(t,e){const i=e.target,s=e.path;let r;if(i&&s&&(r=i[s]),(typeof r!="object"||typeof r=="object"&&r.isVolumeParameter!==!0)&&(r=new me),typeof t=="object"&&"value"in t){const o=t.value;r.initialize(o),r.overrideState=t.overrideState}else r.value=t;return r}}new I9;var T9=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const R9=z("debugpost");class ns extends re{constructor(e=void 0){super();c(this,"active",!0);c(this,"_manager",null);c(this,"_result");c(this,"_postprocessingContext",null);if(e)for(const i of Object.keys(e)){const s=e[i],r=this[i];r instanceof me?r.initialize(s):r!==void 0&&(this[i]=s)}}get isPostProcessingEffect(){return!0}onEnable(){super.onEnable(),this.onEffectEnabled(),this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){var e;super.onDisable(),(e=this._manager)==null||e.removeEffect(this),this.active=!1}onEffectEnabled(e){var i;e&&e.isPostProcessingManager===!0?this._manager=e:this._manager||(this._manager=S9(this)),(i=this._manager)==null||i.addEffect(this)}init(){}get postprocessingContext(){return this._postprocessingContext}apply(e){var i;return this._postprocessingContext=e,this._result||(this.initParameters(),this._result=(i=this.onCreateEffect)==null?void 0:i.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){R9&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(e=>e.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const e=Object.keys(this);for(const i of e){const s=this[i];s instanceof me&&s.__init()}}onEditorModification(e){const i=e.propertyName;if(this[i]instanceof me){const s=e.value;return this[i].value=s,!0}}}T9([A()],ns.prototype,"active",void 0);var B9=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const P9=z("debugpost"),Jx={};function ra(n,t){Jx[n]=t}function M9(n){return n.__type in Jx?Jx[n.__type]:(P9&&n.__type&&console.warn("Unknown postprocessing type",n.__type,n),ns)}class V0{constructor(){c(this,"components",[])}init(){var t;(t=this.components)==null||t.forEach(e=>e.init())}addEffect(t){this.components.push(t)}removeEffect(t){const e=this.components.indexOf(t);e>=0&&this.components.splice(e,1)}}B9([km([n=>M9(n),ns])],V0.prototype,"components",void 0);var k9=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},wR;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH",n[n.ULTRA=3]="ULTRA"})(wR||(wR={}));class W0 extends ns{constructor(){super(...arguments);c(this,"preset",new me(Xh.HIGH))}get typeName(){return"Antialiasing"}onCreateEffect(){const e=new mk({preset:Xh.HIGH,edgeDetectionMode:yS.DEPTH});return this.preset.onValueChanged=i=>{e.applyPreset(i)},e}}k9([A(me)],W0.prototype,"preset",void 0);ra("Antialiasing",W0);const D9=z("debugusdz");class Qu{constructor(){c(this,"files",new Array)}static getName(t){var r;const e=t.split(".").pop();let s=(r=t.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:r.replace(".","_");return s||(s="Audio_"+Math.random().toString(36).substring(2,15)),ol(s)+"."+e}get extensionName(){return"Audio"}onExportObject(t,e,i){const s=Q.getComponents(t,kt);if(s.length)for(const r of s){if(!r.clip||typeof r.clip!="string"||!r.playOnAwake)continue;const o=r.clip.split("/").pop()||"Audio",a=Qu.getName(r.clip),l=ol(a);if(!this.files.some(h=>h.path===r.clip)){this.files.push({path:r.clip,name:a});const h=a.toLowerCase();i.quickLookCompatible&&!h.endsWith(".mp3")&&!h.endsWith(".wav")&&!h.endsWith(".m4a")&&console.error("Audio file "+r.clip+" from "+r.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}i.quickLookCompatible||e.addEventListener("serialize",(h,u)=>{h.appendLine(),h.beginBlock(`def SpatialAudio "${l}"`,"(",!1),h.appendLine(`displayName = "${o}"`),h.closeBlock(")"),h.beginBlock(),h.appendLine(`uniform asset filePath = @audio/${a}@`),h.appendLine(`uniform token auralMode = "${r.spatialBlend>0?"spatial":"nonSpatial"}"`),h.appendLine(`uniform token playbackMode = "${r.loop?"loopFromStage":"onceFromStart"}"`),h.appendLine(`uniform float gain = ${r.volume}`),h.closeBlock()})}}async onAfterSerialize(t){for(const e of this.files){const i="audio/"+e.name;if(t.files[i]){D9&&console.warn("Audio file with name "+i+" already exists in the context. Skipping.");continue}const o=await(await(await fetch(e.path)).blob()).arrayBuffer(),a=new Uint8Array(o);t.files[i]=a}}}const su=z("debugautosync"),K_=Symbol("syncerId");class O9{constructor(){c(this,"_syncers",{})}getOrCreateSyncer(t){if(!t.guid)return null;if(this._syncers[t.guid])return this._syncers[t.guid];const e=new L9(t);return e[K_]=t.guid,this._syncers[e[K_]]=e,e}removeSyncer(t){delete this._syncers[t[K_]]}}const sE=new O9;class L9{constructor(t){c(this,"comp");c(this,"hasChanges",!1);c(this,"changedProperties",{});c(this,"data",{});c(this,"_isReceiving",!1);c(this,"_isInit",!1);c(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const t=this.comp.context.connection;if(!t||!t.isConnected||!t.isInRoom){for(const e in this.changedProperties)delete this.changedProperties[e];return}for(const e in this.data)delete this.data[e];this.data.guid=this.comp.guid;for(const e in this.changedProperties){const i=this.changedProperties[e];delete this.changedProperties[e],this.data[e]=i}t.send(this.networkingKey,this.data,Ho.Queued)});c(this,"onHandleReceiving",t=>{if(su&&console.log("RECEIVE",this.comp.name,this.comp.guid,t),!this._isInit||!this.comp)return;const e=t.guid;if(!(e&&e!==this.comp.guid)){su&&console.log("RECEIVED",this.comp.name,this.comp.guid,t);try{this._isReceiving=!0;for(const i in t){if(i==="guid")continue;const s=t[i];this.comp[i]=s,su&&console.log("SET",i,s)}}catch(i){console.error(i)}finally{this._isReceiving=!1}}});this.comp=t}get networkingKey(){return this.comp.guid}init(t){if(this._isInit)return;this._isInit=!0,this.comp=t,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const e=this.comp.context.connection.tryGetState(this.comp.guid);e&&this.onHandleReceiving(e)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(t,e){this._isReceiving||(su&&console.log("Property changed: "+t,e),this.hasChanges=!0,this.changedProperties[t]=e)}}function F9(n,t){let e=t!==n;return!e&&n&&t&&(Array.isArray(n)&&Array.isArray(t)||typeof n=="object"&&typeof t=="object")&&(e=!0),e}const mg=Symbol("AutoSyncHandler");function U9(n){if(n[mg])return n[mg];const t=sE.getOrCreateSyncer(n);return t==null||t.init(n),n[mg]=t,t}function N9(n){const t=n[mg];t&&(sE.removeSyncer(t),t.destroy(),delete n[mg])}const s2=function(n){return function(t,e){var u;let i="";typeof e=="string"?i=e:i=e.name;let s=null,r;typeof n=="string"?r=t[n]:typeof n=="function"&&(r=n);const o=t,a=o.__internalAwake;if(typeof a!="function"){(su||ve())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((u=t==null?void 0:t.constructor)==null?void 0:u.name)+'" is not supported',t);return}su&&console.log(i);const l=Symbol(i);o.__internalAwake=function(){if(this[l]!==void 0)return;this[l]=this[i],s=sE.getOrCreateSyncer(this);const d=Object.getOwnPropertyDescriptor(this,i);if((d==null?void 0:d.set)===void 0){let f=!1;Object.defineProperty(this,i,{set:function(p){var m;const g=this[l];if(this[l]=p,f){ve()&&console.warn("Recursive call detected",i);return}f=!0;try{const v=F9(p,g);su&&console.log("SyncField assignment",i,"changed?",v,p),v&&(r==null?void 0:r.call(this,p,g))!==!1&&((m=U9(this))==null||m.notifyChanged(i,p))}finally{f=!1}},get:function(){return this[l]},configurable:!0,enumerable:!0})}s==null||s.init(this),a.call(this)};const h=o.__internalDestroy;o.__internalDestroy=function(){N9(this),h.call(this)}}};var q0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Ir=z("debugplayersync");class ju extends re{constructor(){super(...arguments);c(this,"autoSync",!0);c(this,"asset");c(this,"onPlayerSpawned");c(this,"_localInstance");c(this,"onJoinedRoom",()=>{Ir&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()});c(this,"destroyInstance",()=>{var e;(e=this._localInstance)==null||e.then(i=>{Ir&&console.log("PlayerSync.destroyInstance",i),T0(i,this.context.connection,!0,{saveInRoom:!1})}),this._localInstance=void 0})}static async setupFrom(e,i){const s=et.getOrCreateFromUrl(e);if(!s.asset){const a=await s.loadAssetAsync();Q.getOrAddComponent(a,Jn)}const r=new ju;r._internalInit(i),r.asset=s;const o=new ne;return o.guid=e,Q.addComponent(o,r),r}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new $t)}onEnable(){this.context.connection.beginListen(Qe.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(Qe.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qe.LeftRoom,this.destroyInstance),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(Qe.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(Qe.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qe.LeftRoom,this.destroyInstance)}async getInstance(){var i,s,r,o,a,l;if(this._localInstance)return this._localInstance;if(Ir&&console.log("PlayerSync.createInstance",(i=this.asset)==null?void 0:i.uri),!((s=this.asset)!=null&&s.asset)&&!((r=this.asset)!=null&&r.uri))return console.error('PlayerSync: can not create an instance because "asset" is not set and or has no URL!'),null;this.gameObject.guid||console.warn("PlayerSync: gameObject has no guid! This might cause issues with syncing the player state."),this._localInstance=(o=this.asset)==null?void 0:o.instantiateSynced({parent:this.gameObject,deleteOnDisconnect:!0},!0);const e=await this._localInstance;if(e){const h=Q.getComponentsInChildren(e,Jn);if(h!=null&&h.length){for(const u of h)u.owner=this.context.connection.connectionId;(a=this.onPlayerSpawned)==null||a.invoke(e)}else this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((l=this.asset)==null?void 0:l.uri)+"</strong>: please make sure the asset has a PlayerState component!"),Q.destroySynced(e)}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}watchTabVisible(){window.addEventListener("visibilitychange",e=>{if(document.visibilityState==="visible")for(let i=Jn.all.length-1;i>=0;i--){const s=Jn.all[i];(!s.owner||!this.context.connection.userIsInRoom(s.owner))&&s.doDestroy()}})}}q0([A()],ju.prototype,"autoSync",void 0);q0([A(et)],ju.prototype,"asset",void 0);q0([A($t)],ju.prototype,"onPlayerSpawned",void 0);var Zx;(function(n){n.OwnerChanged="ownerChanged"})(Zx||(Zx={}));const An=class extends re{constructor(){super(...arguments);c(this,"onOwnerChangeEvent",new $t);c(this,"onFirstOwnerChangeEvent",new $t);c(this,"hasOwner",!1);c(this,"owner");c(this,"dontDestroy",!1);c(this,"onUserLeftRoom",e=>{if(e.userId===this.owner){Ir&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return An._all}static get local(){return An._local}static getFor(e){if(e instanceof ne)return Q.getComponentInParent(e,An);if(e instanceof re)return Q.getComponentInParent(e.gameObject,An)}static isLocalPlayer(e){const i=An.getFor(e);return(i==null?void 0:i.isLocalPlayer)??!1}static addEventListener(e,i){return this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(i),i}static removeEventListener(e,i){if(!this._callbacks[e])return;const s=this._callbacks[e].indexOf(i);s>=0&&this._callbacks[e].splice(s,1)}static dispatchEvent(e,i){if(this._callbacks[e])for(const s of this._callbacks[e])s(i)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(e,i){var a,l;Ir&&console.log("PlayerSync.onOwnerChange",this,"newOwner",e,"oldOwner",i);const s=An._local.indexOf(this);s>=0&&An._local.splice(s,1);const r={playerState:this,oldValue:i,newValue:e};if(this.hasOwner||(this.hasOwner=!0,(a=this.onFirstOwnerChangeEvent)==null||a.invoke(r)),(l=this.onOwnerChangeEvent)==null||l.invoke(r),this.owner===this.context.connection.connectionId){An._local.push(this);const h=new CustomEvent("local-owner-changed",{detail:r});this.dispatchEvent(h)}const o=new CustomEvent("owner-changed",{detail:r});this.dispatchEvent(o),An.dispatchEvent(Zx.OwnerChanged,o)}awake(){An.all.push(this),Ir&&console.log("Registered new PlayerState",this.guid,An.all.length-1,An.all),this.context.connection.beginListen(Qe.UserLeftRoom,this.onUserLeftRoom)}async start(){Ir&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await sc(300),this.context.connection.userIsInRoom(this.owner)==!1&&(Ir&&console.log(`PlayerSync.start â†’ doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(Ir&&console.warn("PlayerState.start â†’ owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?Ir&&console.warn("PlayerState.start â†’ owner is still undefined but dontDestroy is set to true",this.name):(Ir&&console.warn(`PlayerState.start â†’ owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):Ir&&console.log("PlayerState.start â†’ owner is assigned",this.owner)},2e3))}doDestroy(){Ir&&console.log("PlayerSync.doDestroy â†’ syncDestroy",this.name),T0(this.gameObject,this.context.connection,!0,{saveInRoom:!1})}onDestroy(){if(this.context.connection.stopListen(Qe.UserLeftRoom,this.onUserLeftRoom),An.all.splice(An.all.indexOf(this),1),this.isLocalPlayer){const e=An._local.indexOf(this);e>=0&&An._local.splice(e,1)}}};let Jn=An;c(Jn,"_all",[]),c(Jn,"_local",[]),c(Jn,"_callbacks",{});q0([s2(Jn.prototype.onOwnerChange)],Jn.prototype,"owner",void 0);const z9=z("debugavatar"),zo=class extends re{constructor(){super(...arguments);c(this,"connectionId");c(this,"avatar")}static getAvatar(e){return e>=0&&e<zo.instances.length?zo.instances[e]:null}static onAvatarMarkerCreated(e){return zo._onNewAvatarMarkerAdded.push(e),e}static onAvatarMarkerDestroyed(e){return zo._onAvatarMarkerDestroyed.push(e),e}awake(){zo.instances.push(this),z9&&console.log(this);for(const e of zo._onNewAvatarMarkerAdded)e({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){zo.instances.splice(zo.instances.indexOf(this),1);for(const e of zo._onAvatarMarkerDestroyed)e({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let bn=zo;c(bn,"instances",[]),c(bn,"_onNewAvatarMarkerAdded",[]),c(bn,"_onAvatarMarkerDestroyed",[]);var Q9=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Id=z("debugxrflags"),r2=z("disablexrflags");r2&&console.warn("XRFlags are disabled");var po;(function(n){n[n.Never=0]="Never",n[n.Browser=1]="Browser",n[n.AR=2]="AR",n[n.VR=4]="VR",n[n.FirstPerson=8]="FirstPerson",n[n.ThirdPerson=16]="ThirdPerson",n[n.All=4294967295]="All"})(po||(po={}));const r1=class{constructor(){c(this,"Mask",po.Browser|po.ThirdPerson)}Has(t){return(this.Mask&t)!==0}Set(t){Id&&console.warn("Set XR flag state to",t),this.Mask=t,Yn.Apply()}Enable(t){this.Mask|=t,Yn.Apply()}Disable(t){this.Mask&=~t,Yn.Apply()}Toggle(t){this.Mask^=t,Yn.Apply()}EnableAll(){this.Mask=-1,Yn.Apply()}DisableAll(){this.Mask=0,Yn.Apply()}};let bs=r1;c(bs,"Global",new r1);const Sa=class extends re{constructor(){super(...arguments);c(this,"visibleIn")}static Apply(){for(const e of this.registry)e.UpdateVisible(bs.Global)}awake(){Sa.registry.push(this)}onEnable(){Sa.firstApply?this.UpdateVisible(bs.Global):(Sa.firstApply=!0,Sa.Apply())}onDestroy(){const e=Sa.registry.indexOf(this);e>=0&&Sa.registry.splice(e,1)}get isOn(){return this.gameObject.visible}UpdateVisible(e=null){if(r2)return;let i;const s=e;if(s&&typeof s=="number"&&(console.assert(typeof s=="number","XRFlag.UpdateVisible: state must be a number",s),Id&&console.log(s),Sa.buffer.Mask=s,e=Sa.buffer),e instanceof bs?(Id&&console.warn(this.name,"use passed in mask",e.Mask,this.visibleIn),i=e.Has(this.visibleIn)):(Id&&console.log(this.name,"use global mask"),bs.Global.Has(this.visibleIn)),i!==void 0)if(i)Id&&console.log(this.name,"is visible",this.gameObject.uuid),Q.setActive(this.gameObject,!0);else{if(Id&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}};let Yn=Sa;c(Yn,"registry",[]),c(Yn,"firstApply"),c(Yn,"buffer",new bs);Q9([A()],Yn.prototype,"visibleIn",void 0);var rE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Sp=z("debugwebxr"),xR=new ie().setFromAxisAngle(new w(0,1,0),Math.PI);class Su extends re{constructor(){super(...arguments);c(this,"head");c(this,"leftHand");c(this,"rightHand");c(this,"_leftHandMeshes");c(this,"_rightHandMeshes");c(this,"_syncTransforms")}async onEnterXR(e){if(!this.activeAndEnabled)return;Sp&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=Jn.getFor(this);if(i!=null&&i.owner){const s=this.gameObject.addComponent(bn);s.avatar=this.gameObject,s.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(e){const i=this.gameObject.getComponent(bn);i&&i.destroy()}onUpdateXR(e){var h,u;if(!this.activeAndEnabled)return;const i=Jn.isLocalPlayer(this);if(!i)return;const s=e.xr;if(s.rig&&s.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),s.rig.gameObject.add(this.gameObject)),this._syncTransforms&&i)for(const d of this._syncTransforms)d.fastMode=!0,d.isOwned()||d.requestOwnership();if(this.head&&this.context.mainCamera){const d=this.head.asset;if(d.position.copy(this.context.mainCamera.position),d.position.x*=-1,d.position.z*=-1,d.quaternion.copy(this.context.mainCamera.quaternion),d.quaternion.x*=-1,this.context.time.frameCount%10===0){const f=Q.getComponentsInChildren(this.head.asset,Yn);for(const p of f)p.enabled=!1,p.gameObject.visible=!1}}const r=e.xr.leftController,o=(h=this.leftHand)==null?void 0:h.asset;r&&o?(o.position.copy(r.gripPosition),o.quaternion.copy(r.gripQuaternion),o.quaternion.multiply(xR),o.visible=r.isTracking,this.updateHandVisibility(r,o,this._leftHandMeshes)):o&&o.visible&&(o.visible=!1);const a=e.xr.rightController,l=(u=this.rightHand)==null?void 0:u.asset;a&&l?(l.position.copy(a.gripPosition),l.quaternion.copy(a.gripQuaternion),l.quaternion.multiply(xR),l.visible=a.isTracking,this.updateHandVisibility(a,l,this._rightHandMeshes)):l&&l.visible&&(l.visible=!1)}onBeforeRender(){this.context.xr&&this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateHandVisibility(e,i,s){if(s){const r=e.model&&e.model.visible&&e.model!==i;s.forEach(o=>{Gc(o,!r)})}}updateRemoteAvatarVisibility(){var e,i,s;if(this.context.connection.isConnected){const r=Jn.getFor(this);if(r&&r.isLocalPlayer==!1){const o=Le.getXRSync(this.context);if(o&&o.hasState(r.owner)){this.tryFindAvatarObjectsIfMissing();const a=(e=this.leftHand)==null?void 0:e.asset;a&&(a.visible=(o==null?void 0:o.isTracking(r.owner,"left"))??!1);const l=(i=this.rightHand)==null?void 0:i.asset;l&&(l.visible=(o==null?void 0:o.isTracking(r.owner,"right"))??!1)}if((s=this.head)!=null&&s.asset){const a=Q.getComponentsInChildren(this.head.asset,Yn);for(const l of a)l.enabled=!1,l.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const e={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};m5.tryFindAvatarObjects(this.gameObject,this.sourceId||"",e),e.head&&(this.head=e.head),e.leftHand&&(this.leftHand=e.leftHand),e.rightHand&&(this.rightHand=e.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof ne&&(this.head=new et("",this.sourceId,this.head));else{const e=new ne;e.name="Head";const i=Fu.createPrimitive(Yo.Cube);e.add(i),this.gameObject.add(e),this.head=new et("",this.sourceId,e),Sp&&console.log("Create head",e)}if(this.rightHand)this.rightHand instanceof ne&&(this.rightHand=new et("",this.sourceId,this.rightHand));else{const e=new ne;e.name="Right Hand",this.gameObject.add(e),this.rightHand=new et("",this.sourceId,e),Sp&&console.log("Create right hand",e)}if(this.leftHand)this.leftHand instanceof ne&&(this.leftHand=new et("",this.sourceId,this.leftHand));else{const e=new ne;e.name="Left Hand",this.gameObject.add(e),this.leftHand=new et("",this.sourceId,e),Sp&&console.log("Create left hand",e)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),this._leftHandMeshes=[],this.leftHand.asset.traverse(e=>{e!=null&&e.isMesh&&this._leftHandMeshes.push(e)}),this._rightHandMeshes=[],this.rightHand.asset.traverse(e=>{e!=null&&e.isMesh&&this._rightHandMeshes.push(e)}),Jn.isLocalPlayer(this.gameObject)&&(this._syncTransforms=Q.getComponentsInChildren(this.gameObject,oc))}async loadAvatarObjects(e,i,s){const r=e.loadAssetAsync(),o=i.loadAssetAsync(),a=s.loadAssetAsync(),l=new Array;r&&l.push(r),o&&l.push(o),a&&l.push(a);const h=await QC(l);Sp&&console.log("Avatar loaded results:",h)}}rE([A(et)],Su.prototype,"head",void 0);rE([A(et)],Su.prototype,"leftHand",void 0);rE([A(et)],Su.prototype,"rightHand",void 0);class Jl{static Add(t,e,i=null){if(e){for(const s of this.Pois)if(s.obj===e)return;this.Pois.push({obj:e,avatar:i}),this.LastChangeTime=t.time.time}}static Remove(t,e){var i;if(e){for(const s of this.Pois)if(s.obj===e){this.Pois.splice(this.Pois.indexOf(s),1),this.LastChangeTime=(t==null?void 0:t.time.time)??((i=je.Current)==null?void 0:i.time.time);return}}}}c(Jl,"Pois",[]),c(Jl,"LastChangeTime",0);var Cy;(function(n){n.TargetChanged="avatar-look-target-changed"})(Cy||(Cy={}));class j9{constructor(){c(this,"guid");c(this,"position",new w)}}class Sy extends re{constructor(){super(...arguments);c(this,"target",null);c(this,"avatar",null);c(this,"_model",null);c(this,"_targetModel",new j9);c(this,"_currentTargetObject",null);c(this,"_lastUpdateTime",0);c(this,"_lookDuration",0);c(this,"_lastPoiChangedTime",0)}set controlledTarget(e){this.target=e;const i=D.get("MoveRandom");if(i&&this.target){const s=Q.getComponent(this.target,i);s&&s.destroy()}}awake(){if(this.avatar=Q.getComponentInParent(this.gameObject,bn),this.avatar){const e=Q.getComponentInParent(this.gameObject,bn);this._model=new UD(this.context.connection,this.guid),e!=null&&e.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen(Cy.TargetChanged,e=>{var i;this.target&&e&&e.guid===((i=this.avatar)==null?void 0:i.guid)&&Cn(this.target,e.position)})}update(){var i;if((!this.context.connection.isConnected||(i=this._model)!=null&&i.hasOwnership)&&(Jl.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Jl.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const s=He(this._currentTargetObject);Cn(this.target,s),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send(Cy.TargetChanged,this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(s))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const i=Jl.Pois;if(i.length>0){const s=i[Math.floor(Math.random()*i.length)];if(s&&s.obj){if(s.avatar&&s.avatar===this.avatar)return;this._currentTargetObject=s.obj}}}}}const Di=z("debugnetworkingstreams");var Bi;(function(n){n.Connected="peer-user-connected",n.StreamReceived="receive-stream",n.StreamEnded="call-ended",n.Disconnected="peer-user-disconnected",n.UserJoined="user-joined"})(Bi||(Bi={}));class o2{constructor(t,e){c(this,"type",Bi.StreamEnded);c(this,"userId");c(this,"direction");this.userId=t,this.direction=e}}class G9{constructor(t,e,i){c(this,"type",Bi.StreamReceived);c(this,"userId");c(this,"stream");c(this,"target");this.userId=t,this.stream=e,this.target=i}}class H9{constructor(t,e){c(this,"guid");c(this,"peerId");c(this,"dontSave",!0);this.guid=t.id,this.peerId=e}}var Ql;(function(n){n.Incoming="incoming",n.Outgoing="outgoing"})(Ql||(Ql={}));class V9 extends hc{constructor(e,i,s,r=null){super();c(this,"peerId");c(this,"userId");c(this,"direction");c(this,"call");c(this,"_stream",null);c(this,"_isDisposed",!1);this.peerId=i.peer,this.userId=e,this.call=i,this.direction=s,this._stream=r,i.on("stream",o=>{if(Di&&console.log("Receive stream",`
Audio:`,o.getAudioTracks(),`
Video:`,o.getVideoTracks()),this._stream=o,s===Ql.Incoming){const a=new G9(e,o,this);this.dispatchEvent(a)}}),i.on("close",()=>{this.dispatchEvent(new o2(e,s))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Hl(this._stream))}get isOpen(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connected"}get isOpening(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connecting"}get isClosed(){return!this.isOpen||this._isDisposed}}function CR(n){return n=n.replace("a=fmtp:111 minptime=10;useinbandfec=1","a=fmtp:111 ptime=5;useinbandfec=1;stereo=1;maxplaybackrate=48000;maxaveragebitrat=128000;sprop-stereo=1"),n}const Kd=class extends hc{constructor(e,i){super();c(this,"updateCalls",()=>{var e;for(let i=this._incomingCalls.length-1;i>=0;i--){const s=this._incomingCalls[i];s.isClosed&&!s.isOpening&&this._incomingCalls.splice(i,1)}for(let i=this._outgoingCalls.length-1;i>=0;i--){const s=this._outgoingCalls[i];let r=!1;s.isClosed&&!s.isOpening&&((e=s.stream)!=null&&e.active?Di&&console.warn("!!! Stream is still active, don't remove call",s.userId,"Your id: "+this.context.connection.connectionId):(Di&&console.warn("!!! Remove closed call",s.userId),r=!0)),this.context.connection.userIsInRoom(s.userId)===!1&&(Di&&console.warn("!!! User is not in room anymore, remove call",s.userId),r=!0),r&&(s.close(),this._outgoingCalls.splice(i,1))}});c(this,"id");c(this,"context");c(this,"_incomingCalls",[]);c(this,"_outgoingCalls",[]);c(this,"_peer");c(this,"_enabled",!1);c(this,"_enabledPeer",!1);c(this,"onConnectRoomFn",this.onConnectRoom.bind(this));c(this,"onPeerConnect",e=>{if(Di&&console.log("PEER opened as",e),e===null){console.error("Peer connection failed",e);return}this.context.connection.send(Bi.Connected,new H9(this,e))});c(this,"onPeerClose",()=>{Di&&console.log("PEER closed"),this.updateCalls()});c(this,"onPeerDisconnected",()=>{Di&&console.log("PEER disconnected"),this.updateCalls()});c(this,"onPeerError",e=>{Di&&console.error("PEER error",e)});c(this,"onPeerReceivingCall",e=>{e.answer(void 0,{sdpTransform:i=>CR(i)}),this.registerCall(e,Ql.Incoming,null)});this.context=e,this.id=i,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(e,i){if(Kd.instances.has(i))return Kd.instances.get(i);const s=new Kd(e,i);return Kd.instances.set(i,s),s}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(e){return this.id+"-"+e}getUserIdFromPeerId(e){return e.substring(this.id.length+1)}makeCall(e,i){var o;if(!(i!=null&&i.id)){Di?console.warn("Can not make a call: mediastream has no id or is undefined"):console.debug("Can not make a call: mediastream has no id or is undefined");return}const s={metadata:{userId:this.context.connection.connectionId,streamId:i.id},sdpTransform:a=>CR(a)},r=(o=this._peer)==null?void 0:o.call(e,i,s);if(r){const a=this.registerCall(r,Ql.Outgoing,i);return Di&&console.warn(`ðŸ“ž CALL ${e}`,`
Outgoing:`,this._outgoingCalls,`
Incoming:`,this._incomingCalls),a}else Di&&console.error("Failed to make call",e,i,this._peer)}closeAll(){for(const e of this._incomingCalls)e.close();for(const e of this._outgoingCalls)e.close();this.updateCalls()}get peer(){return this._peer}get incomingCalls(){return this._incomingCalls}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(Qe.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(Qe.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const e=this.getMyPeerId();e?this._peer=Z8(e):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnect),this._peer.on("close",this.onPeerClose),this._peer.on("call",this.onPeerReceivingCall),this._peer.on("disconnected",this.onPeerDisconnected),this._peer.on("error",this.onPeerError))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnect),this._peer.off("close",this.onPeerClose),this._peer.off("call",this.onPeerReceivingCall),this._peer.off("disconnected",this.onPeerDisconnected),this._peer.off("error",this.onPeerError))}registerCall(e,i,s){const r=e.metadata;(!r||!r.userId)&&console.error("Missing call metadata",e);const o=r.userId;i===Ql.Incoming&&Di?console.warn("â† Receive call from",e.metadata,e.connectionId):Di&&console.warn("â†’ Make call to",e.metadata);const a=i===Ql.Incoming?this._incomingCalls:this._outgoingCalls,l=new V9(o,e,i,s);return a.push(l),e.on("error",h=>{console.error("Call error",h)}),e.on("close",()=>{Di&&console.log("Call ended",e.metadata);const h=a.indexOf(l);h!==-1&&a.splice(h,1),l.close(),this.dispatchEvent(new o2(o,i))}),l.addEventListener(Bi.StreamEnded,h=>{this.dispatchEvent(h)}),i===Ql.Incoming&&(l.addEventListener(Bi.StreamReceived,h=>{this.dispatchEvent(h)}),e.on("stream",()=>{Di&&console.log("Received stream for call",e.metadata);let h=0;const u=setInterval(()=>{const d=h===0;!l.isOpen&&d&&(Di&&console.warn("Close call because stream is not active",e.metadata),h+=1,clearInterval(u),l.close())},2e3)})),l}};let Ag=Kd;c(Ag,"instances",new Map);class X0 extends hc{constructor(e,i){super();c(this,"context");c(this,"peer");c(this,"_sendingStreams",new Map);c(this,"debug",!1);c(this,"_enabled",!1);c(this,"_tickIntervalId");c(this,"tick",()=>{this.updateSendingCalls()});c(this,"onJoinedRoom",e=>{this._sendingStreams.size>0&&(this.debug&&console.warn(`${e!=null&&e.userId?`User ${e.userId}`:"You"} joined room`,e,this._sendingStreams.size),this.updateSendingCalls())});c(this,"onLeftRoom",e=>{this.debug&&console.warn(`${(e==null?void 0:e.userId)||"You"} left room`,e),this.stopCallsToUsersThatAreNotInTheRoomAnymore(),this.peer.closeAll()});c(this,"onCallStreamReceived",e=>{this.debug&&console.log("Call with "+e.userId+" started"),this.dispatchEvent({type:Bi.StreamReceived,target:this,stream:e.stream,userId:e.userId}),this.debug&&this.debugLogCurrentState()});c(this,"onCallEnded",e=>{this.debug&&console.log("Call with "+e.userId+" ended"),this.dispatchEvent(e),this.debug&&this.debugLogCurrentState()});c(this,"onUserConnected",e=>{if(this.peer.id===e.guid){this.debug&&console.log("PEER USER CONNECTED",e.guid,e,this._sendingStreams.size);const i=this._sendingStreams.keys().next().value;this.peer.makeCall(e.peerId,i)}else Di&&console.log("Unknown user connected",e.guid,e.peerId)});c(this,"onUserLeft",e=>{this.debug&&console.log("User left room: "+e.userId),this.stopCallsToUsersThatAreNotInTheRoomAnymore()});this.context=e,this.peer=i,Di&&(this.debug=!0)}static create(e,i){const s=Ag.getOrCreate(e.context,i||e.context.connection.connectionId||e.guid);return new X0(e.context,s)}startSendingStream(e){this._sendingStreams.has(e)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(e,[]),this.updateSendingCalls())}stopSendingStream(e){if(e){const i=this._sendingStreams.get(e);if(i){for(const s of i)s.close();i.length=0}this._sendingStreams.delete(e),i&&this.debug&&this.debugLogCurrentState()}this.updateSendingCalls()}get enabled(){return this._enabled}enable(){this._enabled||(this._enabled=!0,this.peer.enable(),this.peer.addEventListener(Bi.StreamReceived,this.onCallStreamReceived),this.peer.addEventListener(Bi.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Bi.Connected,this.onUserConnected),this.context.connection.beginListen(Qe.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qe.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qe.UserLeftRoom,this.onUserLeft),this.context.connection.beginListen(Qe.LeftRoom,this.onLeftRoom),this._tickIntervalId=setInterval(this.tick,5e3))}disable(){this._enabled&&(this._enabled=!1,this.peer.disable(),this.peer.removeEventListener(Bi.StreamReceived,this.onCallStreamReceived),this.peer.removeEventListener(Bi.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Bi.Connected,this.onUserConnected),this.context.connection.stopListen(Qe.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qe.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qe.UserLeftRoom,this.onUserLeft),this.context.connection.stopListen(Qe.LeftRoom,this.onLeftRoom),this._tickIntervalId!=null&&(clearInterval(this._tickIntervalId),this._tickIntervalId=void 0))}updateSendingCalls(){const e=this.context.connection.connectionId;for(const i of this._sendingStreams.keys()){const s=this._sendingStreams.get(i)||[];for(const r of this.context.connection.usersInRoom()){if(r===e)continue;const o=this.peer.getPeerIdFromUserId(r);if(s.find(l=>{var h;return l.peerId===o&&l.direction===Ql.Outgoing&&!l.isClosed&&((h=l.stream)==null?void 0:h.active)}))Di&&console.debug("Already have a call with user "+r+" / peer "+o);else{const l=this.peer.makeCall(o,i);l&&s.push(l)}}this._sendingStreams.set(i,s)}this.stopCallsToUsersThatAreNotInTheRoomAnymore()}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const e of this._sendingStreams.keys()){const i=this._sendingStreams.get(e);if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];this.context.connection.userIsInRoom(r.userId)?Di&&(this.context.connection.connectionId===r.userId?console.warn(`You are still in the room [${s}] ${r.userId}`):console.log(`User is still in room [${s}] ${r.userId}`)):(Di&&console.log(`Remove call ${[s]} to user that is not in room anymore ${r.userId}`),r.close(),i.splice(s,1))}}this.peer.updateCalls(),this.debug&&this.debugLogCurrentState()}debugLogCurrentState(){console.warn(`You (${this.context.connection.connectionId}) are currently sending ${this._sendingStreams.size} and receiving ${this.peer.incomingCalls.length} calls (${this.peer.incomingCalls.map(e=>e.userId).join(", ")})`,this.peer.incomingCalls)}}function Hl(n){if(n&&n instanceof MediaStream)for(const t of n.getTracks())t.stop()}var oE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const W9="noVoip",q9=z("debugvoip");class Gu extends re{constructor(){super(...arguments);c(this,"autoConnect",!0);c(this,"runInBackground",!0);c(this,"createMenuButton",!0);c(this,"debug",!1);c(this,"_net");c(this,"_menubutton");c(this,"_allowSending",!0);c(this,"_outputStream",null);c(this,"onJoinedRoom",async()=>{this.debug&&console.log("VOIP: Joined room"),await sc(300),this.autoConnect&&!this.isSending&&this._allowSending&&this.connect()});c(this,"onLeftRoom",()=>{this.debug&&console.log("VOIP: Left room"),this.disconnect();for(const e of this._incomingStreams.values())Hl(e.srcObject);this._incomingStreams.clear()});c(this,"_incomingStreams",new Map);c(this,"onReceiveStream",e=>{const i=e.target.userId,s=e.stream;let r=this._incomingStreams.get(i);r||(r=new Audio,this._incomingStreams.set(i,r)),r.srcObject=s,r.setAttribute("autoplay","true"),Ja.registerWaitForInteraction(()=>{r==null||r.play().catch(o=>{console.error("VOIP: Failed to play audio",o)})})});c(this,"onStreamEnded",e=>{const i=this._incomingStreams.get(e.userId);Hl(i==null?void 0:i.srcObject),this._incomingStreams.delete(e.userId)});c(this,"onEnabledChanged",()=>{for(const e of this._incomingStreams){const i=e[1];i.muted=!this.enabled}});c(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const i=!(document.visibilityState==="visible");this.setMuted(i);for(const s of this._incomingStreams){const r=s[1];r.muted=i}})}awake(){q9&&(this.debug=!0),this.debug&&(console.log("VOIP debugging: press 'v' to toggle mute or 'c' to toggle connect/disconnect"),window.addEventListener("keydown",async e=>{switch(e.key.toLowerCase()){case"v":console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted);break;case"c":this.isSending?this.disconnect():this.connect();break}}),window.addEventListener("blur",()=>{console.log("VOIP: MUTE ON BLUR"),this.setMuted(!0)}),window.addEventListener("focus",()=>{console.log("VOIP: UNMUTE ON FOCUS"),this.setMuted(!1)}))}onEnable(){this._net||(this._net=X0.create(this)),this.debug&&(this._net.debug=!0),this._net.addEventListener(Bi.StreamReceived,this.onReceiveStream),this._net.addEventListener(Bi.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&this.context.connection.isConnected&&this.connect(),this.context.connection.beginListen(Qe.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qe.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var e;this._net&&(this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(Bi.StreamReceived,this.onReceiveStream),this._net.removeEventListener(Bi.StreamEnded,this.onStreamEnded),(e=this._net)==null||e.disable()),this.context.connection.stopListen(Qe.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qe.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}onDestroy(){var e;(e=this._menubutton)==null||e.remove(),this._menubutton=void 0}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(e){var i,s;if(!this._net)return console.error("Cannot connect to voice chat - NetworkedStreams not initialized. Make sure the component is enabled before calling this method."),!1;if(this.context.connection.isConnected){if(!await hA())return console.error("Cannot connect to voice chat - microphone permissions not granted"),this.updateButton(),!1}else return console.error("Cannot connect to voice chat - not connected to server"),this.updateButton(),!1;return this._allowSending=!0,(i=this._net)==null||i.stopSendingStream(this._outputStream),Hl(this._outputStream),this._outputStream=await this.getAudioStream(e),this._outputStream?(this.debug&&console.log("VOIP: Got audio stream"),(s=this._net)==null||s.startSendingStream(this._outputStream),this.updateButton(),!0):(this.updateButton(),await hA()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):pS("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),(this.debug||ve())&&console.log("VOIP: Failed to get audio stream"),!1)}disconnect(e){var i;e!=null&&e.remember&&(this._allowSending=!1),(i=this._net)==null||i.stopSendingStream(this._outputStream),Hl(this._outputStream),this._outputStream=null,this.updateButton()}setMuted(e){var s;const i=(s=this._outputStream)==null?void 0:s.getAudioTracks();if(i)for(const r of i)r.enabled=!e}get isMuted(){var i;if(this._outputStream===null)return!1;const e=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(e){for(const s of e)if(!s.enabled)return!0}return!1}async updateButton(){var e;if(this.createMenuButton){if(this._menubutton||(this._menubutton=document.createElement("button"),this._menubutton.addEventListener("click",()=>{this.isSending?this.disconnect({remember:!0}):this.connect(),hA().then(i=>{i||qt("<strong>Microphone permissions not granted</strong>. Please allow your browser to use the microphone to be able to talk. Click on the button on the left side of your browser's address bar to allow microphone permissions.")})})),this._menubutton){this.context.menu.appendChild(this._menubutton),this.activeAndEnabled?this._menubutton.style.display="":this._menubutton.style.display="none",this._menubutton.title=this.isSending?"Click to disable your microphone":"Click to enable your microphone";let i=(this.isSending,""),s=this.isSending?"mic":"mic_off";await hA()||(i="No Permission",s="mic_off",this._menubutton.title="Microphone permissions not granted. Please allow your browser to use the microphone to be able to talk. This can usually be done in the addressbar of the webpage."),this._menubutton.innerText=i,this._menubutton.prepend(ys(s)),this.context.connection.isConnected==!1?this._menubutton.setAttribute("disabled",""):this._menubutton.removeAttribute("disabled")}}else this.activeAndEnabled||(e=this._menubutton)==null||e.remove()}getFrequency(e){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,ve()&&qt("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(e){return navigator.mediaDevices.getUserMedia?await navigator.mediaDevices.getUserMedia({audio:e??!0,video:!1}).catch(s=>(console.warn("VOIP failed getting audio stream",s),null)):(console.error("No getDisplayMedia support"),null)}}oE([A()],Gu.prototype,"autoConnect",void 0);oE([A()],Gu.prototype,"runInBackground",void 0);oE([A()],Gu.prototype,"createMenuButton",void 0);var a2=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const X9=z("debugmouth");class Y0 extends re{constructor(){super(...arguments);c(this,"idle",[]);c(this,"talking",[]);c(this,"marker",null);c(this,"voip",null);c(this,"lastMouthChangeTime",0);c(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=Q.findObjectOfType(Gu,this.context),this.marker||(this.marker=Q.getComponentInParent(this.gameObject,bn))},3e3)}update(){var s;if(!this.voip||this.context.time.frameCount%10!==0)return;let e=((s=this.marker)==null?void 0:s.connectionId)??null;if(!e){X9&&(e=null);return}const i=this.voip.getFrequency(e)??0;this.updateLips(i)}updateLips(e){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&e>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(e,i){if(e){e!=this.idle?this.idle.map(s=>s.visible=!1):this.talking.map(s=>s.visible=!1);for(let s=0;s<e.length;s++){const r=e[s];r&&(r.visible=s===i)}}}}a2([A(ne)],Y0.prototype,"idle",void 0);a2([A(ne)],Y0.prototype,"talking",void 0);class l2 extends re{constructor(){super(...arguments);c(this,"voip",null);c(this,"marker",null);c(this,"_startPosition",null)}awake(){this.voip=Q.findObjectOfType(Gu,this.context),this.marker=Q.getComponentInParent(this.gameObject,bn)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const e=this.marker.connectionId,i=this.voip.getFrequency(e);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const s=i/100;this.gameObject.position.y=this._startPosition.y+s*.07}}var K0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Gf extends re{constructor(){super(...arguments);c(this,"eyes",[]);c(this,"lastBlinkTime",0);c(this,"blinkLength",0);c(this,"eyesOpen",!0);c(this,"state",null)}awake(){this.state=Q.getComponentInParent(this.gameObject,Yn)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const i of this.eyes)i&&(i.visible=this.eyesOpen)}}}K0([A(ne)],Gf.prototype,"eyes",void 0);K0([A()],Gf.prototype,"lastBlinkTime",void 0);K0([A()],Gf.prototype,"blinkLength",void 0);K0([A()],Gf.prototype,"eyesOpen",void 0);var aE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const o1=class extends re{constructor(){super(...arguments);c(this,"head",null);c(this,"eyes",null);c(this,"target",null);c(this,"brain",null);c(this,"vec",new w);c(this,"currentTargetPoint",new w)}awake(){this.brain||(this.brain=Q.getComponentInParent(this.gameObject,Sy)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=Q.addNewComponent(this.gameObject,Sy)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const e=this.target;if(e&&this.head){const i=this.eyes;if(i){const s=He(e);this.currentTargetPoint.lerp(s,this.context.time.deltaTime/.1);const r=He(this.head),o=this.vec.copy(this.currentTargetPoint).sub(r).normalize();if(o.length()<.1)return;const a=o1.forward;if(a.set(0,0,1),a.applyQuaternion(Gt(this.head)),a.dot(o)>.45)for(let h=0;h<i.length;h++)i[h].lookAt(this.currentTargetPoint)}}}};let sh=o1;c(sh,"forward",new w(0,0,1));aE([A(ne)],sh.prototype,"head",void 0);aE([A(ne)],sh.prototype,"eyes",void 0);aE([A(ne)],sh.prototype,"target",void 0);const Ep=z("debugavatar");class lE{constructor(t,e,i,s){c(this,"root");c(this,"head");c(this,"leftHand");c(this,"rigthHand");var r;this.root=t,this.head=e,this.leftHand=i,this.rigthHand=s,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class c2{constructor(){c(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(t,e){if(!e)return console.error("Can not create avatar: failed to provide id or root object"),null;let i=null;if(typeof e=="string"){if(i=await this.loadAvatar(t,e),!i){const r=new ll;i=Q.instantiate(jg(e,t.scene),r)}}else i=e;if(!i)return null;const s=this.findAvatar(i);return s.isValid?(Ep&&console.log("[Custom Avatar] valid config",e,Ep?s:""),s):(console.warn("[Custom Avatar] config isn't valid",e,Ep?s:""),null)}async loadAvatar(t,e){if(console.assert(e!=null&&typeof e=="string","Avatar id must not be null"),e.length<=0||!e)return null;if(Ep&&console.log("[Custom Avatar] "+e+", loading..."),e.endsWith(".glb")||(e+=".glb"),this.avatarRegistryUrl===null){const s=await fetch("./"+e);let r=null;if(s.ok){const a=await s.blob();a&&(r=await a.arrayBuffer())}if(!r&&(r=await AO(e,e,0,"no url here go away",!0),!r))return null;const o=await nl().parseSync(t,r,null,0);return(o==null?void 0:o.scene)??null}const i=new rl;return F0(i,t),new Promise((s,r)=>{const o=this.avatarRegistryUrl+"/"+e;i.load(o,async a=>{await nl().createBuiltinComponents(t,o,a,null,void 0),s(a.scene)},a=>{Ep&&console.log("[Custom Avatar] "+a.loaded/a.total*100+"% loaded of "+a.total/1024+"kB")},a=>{console.error("[Custom Avatar] Error when loading: "+a),s(null)})})}cacheModel(t,e){}findAvatar(t){const e=t;let i=e;i.children.length==1&&(i=t.children[0]);let s=this.findAvatarPart(i,["head"]);const r=this.findAvatarPart(i,["left","hand"]),o=this.findAvatarPart(i,["right","hand"]);if(!s){s=e;const l=new w;new xn().setFromObject(s).getSize(l);const h=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+h+" meters! Should be < 0.3m"),h>.3&&s.scale.multiplyScalar(1/h*.3)}return new lE(e,s,r,o)}findAvatarPart(t,e){const i=t.name.toLowerCase();let s=!0;for(const r of e){if(!s)break;i.indexOf(r)===-1&&(s=!1)}if(s)return t;if(t.children)for(const r of t.children){const o=this.findAvatarPart(r,e);if(o)return o}return null}handleCustomAvatarErrors(t){if(!t.ok)throw Error(t.statusText);return t}}var cE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Um extends re{constructor(){super(...arguments);c(this,"length",1);c(this,"depthTest",!0);c(this,"isGizmo",!1);c(this,"_axes",null)}onEnable(){if(this.isGizmo&&!Tm)return;this._axes||(this._axes=new dr(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const e=this._axes.material;e&&e.depthTest!==void 0&&(e.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}cE([A()],Um.prototype,"length",void 0);cE([A()],Um.prototype,"depthTest",void 0);cE([A()],Um.prototype,"isGizmo",void 0);class h2 extends re{constructor(){super(...arguments);c(this,"from");c(this,"to");c(this,"hint");c(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const e=He(this.to).clone(),i=He(this.from).clone(),s=e.distanceTo(i),r=e.clone();r.sub(i);const o=i.clone();o.add(e),o.multiplyScalar(.5);const a=He(this.hint).clone();a.sub(o);const l=new w;l.crossVectors(a,r),l.crossVectors(r,l),l.normalize();const h=s*.5,u=Math.max(this.desiredDistance,h),d=Math.sqrt(u*u-h*h),f=l.clone();f.multiplyScalar(d),f.add(o),Cn(this.gameObject,f);const p=o.clone();p.sub(l),this.gameObject.lookAt(p)}}const VA=z("debugusdzbehaviours");class hE{constructor(){c(this,"behaviours",[]);c(this,"behaviourComponents",[]);c(this,"behaviourComponentsCopy",[]);c(this,"audioClips",[]);c(this,"audioClipsCopy",[]);c(this,"targetUuids",new Set)}get extensionName(){return"Behaviour"}addBehavior(t){this.behaviours.push(t)}addAudioClip(t){if(!t||typeof t!="string")return"";const i="audio/"+Qu.getName(t);return this.audioClips.push({clipUrl:t,filesKey:i}),i}getAllTargetUuids(){return this.targetUuids}onBeforeBuildDocument(t){if(!t.root)return Promise.resolve();const e=[];return t.root.traverse(i=>{Q.foreachComponent(i,s=>{var o;const r=s;if(typeof r.createBehaviours=="function"||typeof r.beforeCreateDocument=="function"||typeof r.afterCreateDocument=="function"||typeof r.afterSerialize=="function"){this.behaviourComponents.push(r);const a=(o=r.beforeCreateDocument)==null?void 0:o.call(r,this,t);a instanceof Promise&&e.push(a)}},!1)}),VA&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(e)}onExportObject(t,e,i){var s;for(const r of this.behaviourComponents)VA&&console.log("onExportObject: createBehaviours",r),(s=r.createBehaviours)==null||s.call(r,this,e,i)}onAfterBuildDocument(t){for(const o of this.behaviourComponents)typeof o.afterCreateDocument=="function"&&o.afterCreateDocument(this,t);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0;const e=new Set,i=new Set,s=new Set;function r(o){if(o instanceof Zc)for(const a of o.actions)r(a);else if(o instanceof cr){const a=o.affectedObjects;a&&(typeof a=="object"?i.add(a):typeof a=="string"&&i.add({uuid:a}));const l=o.xFormTarget;l&&(typeof l=="object"?i.add(l):typeof l=="string"&&i.add({uuid:l}))}}for(const o of this.behaviours)o.trigger instanceof Kl&&typeof o.trigger.targetId=="object"&&e.add(o.trigger.targetId),r(o.action);for(const o of new Set([...e,...i]))if(Array.isArray(o))for(const a of o)s.add(a.uuid);else s.add(o.uuid);VA&&console.log("All Behavior trigger sources and action targets",e,i,s),this.targetUuids=new Set(s)}onAfterHierarchy(t,e){var i;if((i=this.behaviours)!=null&&i.length){e.beginBlock('def Scope "Behaviors"');for(const s of this.behaviours)s.writeTo(this,t.document,e);e.closeBlock()}}async onAfterSerialize(t){VA&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const e of this.behaviourComponentsCopy)typeof e.afterSerialize=="function"&&(e.afterSerialize.constructor.name==="AsyncFunction"?await e.afterSerialize(this,t):e.afterSerialize(this,t));for(const{clipUrl:e,filesKey:i}of this.audioClipsCopy){if(t.files[i])return;const o=await(await(await fetch(e)).blob()).arrayBuffer(),a=new Uint8Array(o);t.files[i]=a}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var uE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const a1=class extends ns{constructor(){super(...arguments);c(this,"threshold",new me(.9));c(this,"intensity",new me(1));c(this,"scatter",new me(.3));c(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.valueProcessor=e=>e,this.intensity.valueProcessor=e=>e,this.scatter.valueProcessor=e=>e}onCreateEffect(){let e;if(this.selectiveBloom==null&&(this.selectiveBloom=a1.useSelectiveBloom),this.selectiveBloom){const i=e=new gk(this.context.scene,this.context.mainCamera,{blendFunction:Je.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});i.inverted=!0}else e=new vS({blendFunction:Je.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});return this.intensity.onValueChanged=i=>{e.intensity=i},this.threshold.onValueChanged=i=>{e.luminanceMaterial.threshold=Math.pow(i,2.2)},this.scatter.onValueChanged=i=>{e.luminancePass.enabled=!0,e.luminanceMaterial.smoothing=i,e.mipmapBlurPass&&(e.mipmapBlurPass.radius=ct.lerp(.1,.9,i))},e}};let Zl=a1;c(Zl,"useSelectiveBloom",!1);uE([A(me)],Zl.prototype,"threshold",void 0);uE([A(me)],Zl.prototype,"intensity",void 0);uE([A(me)],Zl.prototype,"scatter",void 0);ra("Bloom",Zl);var gr=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Eo extends re{constructor(){super(...arguments);c(this,"attachedRigidbody",null);c(this,"isTrigger",!1);c(this,"sharedMaterial");c(this,"membership",[0]);c(this,"filter");c(this,"updateProperties",()=>{var e;(e=this.context.physics.engine)==null||e.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(It))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(It))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(It))}onDisable(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}get body(){var e;return(e=this.context.physics.engine)==null?void 0:e.getBody(this)}updatePhysicsMaterial(){var e;(e=this.context.physics.engine)==null||e.updatePhysicsMaterial(this)}}gr([A(It)],Eo.prototype,"attachedRigidbody",void 0);gr([A()],Eo.prototype,"isTrigger",void 0);gr([A()],Eo.prototype,"sharedMaterial",void 0);gr([A()],Eo.prototype,"membership",void 0);gr([A()],Eo.prototype,"filter",void 0);class Nm extends Eo{constructor(){super(...arguments);c(this,"radius",.5);c(this,"center",new w(0,0,0))}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addSphereCollider(this),NC(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),qP(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}gr([Ss(),A()],Nm.prototype,"radius",void 0);gr([A(w)],Nm.prototype,"center",void 0);class Hu extends Eo{constructor(){super(...arguments);c(this,"size",new w(1,1,1));c(this,"center",new w(0,0,0))}static add(e,i){const s=new Hu;e.geometry.boundingBox||e.geometry.computeBoundingBox();const r=e.geometry.boundingBox;return s.size=r.getSize(new w)||new w(1,1,1),s.center=r.getCenter(new w)||new w(0,0,0),Ao(e,s),(i==null?void 0:i.rigidbody)===!0&&Ao(e,It,{isKinematic:!1}),s}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addBoxCollider(this,this.size),NC(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),qP(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}gr([Ss(),A(w)],Hu.prototype,"size",void 0);gr([A(w)],Hu.prototype,"center",void 0);class Hf extends Eo{constructor(){super(...arguments);c(this,"sharedMesh");c(this,"convex",!1)}onEnable(){var i,s,r;if(super.onEnable(),!this.context.physics.engine)return;(i=this.sharedMesh)!=null&&i.isMesh||this.gameObject instanceof J&&(this.sharedMesh=this.gameObject);const e=0;if((s=this.sharedMesh)!=null&&s.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,ri(this.gameObject)),ht.assignMeshLOD(this.sharedMesh,e).then(o=>{o&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=o,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,ri(this.gameObject)))});else{const o=this.sharedMesh;if(o!=null&&o.isGroup){console.warn(`MeshCollider mesh is a group "${((r=this.sharedMesh)==null?void 0:r.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const a=new Array;for(const l in o.children){const h=o.children[l];h.isMesh&&(this.context.physics.engine.addMeshCollider(this,h,this.convex,ri(this.gameObject)),a.push(ht.assignMeshLOD(h,e)))}Promise.all(a).then(l=>{var u,d;if(l.some(f=>f)==!1)return;(u=this.context.physics.engine)==null||u.removeBody(this);const h=new J;for(const f of l)f&&this.activeAndEnabled&&(h.geometry=f,(d=this.context.physics.engine)==null||d.addMeshCollider(this,h,this.convex,ri(this.gameObject)))})}}}}gr([A(J)],Hf.prototype,"sharedMesh",void 0);gr([A()],Hf.prototype,"convex",void 0);class fh extends Eo{constructor(){super(...arguments);c(this,"center",new w(0,0,0));c(this,"radius",.5);c(this,"height",2)}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addCapsuleCollider(this,this.height,this.radius)}}gr([A(w)],fh.prototype,"center",void 0);gr([A()],fh.prototype,"radius",void 0);gr([A()],fh.prototype,"height",void 0);var dE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Vf extends re{constructor(){super(...arguments);c(this,"objectBounds",!1);c(this,"color");c(this,"isGizmo",!0);c(this,"_gizmoObject",null);c(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!Tm||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new NP(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=MS(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),We.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var e;for(;this._boxHelper;)(e=this._boxHelper)==null||e.update(),yield}}dE([A()],Vf.prototype,"objectBounds",void 0);dE([A(be)],Vf.prototype,"color",void 0);dE([A()],Vf.prototype,"isGizmo",void 0);const Y9=z("gizmos"),K9=z("debugboxhelper"),no=class extends re{constructor(){super(...arguments);c(this,"box",null);c(this,"_lastMatrixUpdateFrame",-1);c(this,"_helper",null);c(this,"_color",null)}isInBox(e,i){var r;if(!e)return;if(this.box||(this.box=new xn),e.type==="Mesh")no.testBox.setFromObject(e);else if(e.type==="Group"){if(no.testBox.makeEmpty(),e.children.length>0)for(let o=0;o<e.children.length;o++)e.children[o].type==="Mesh"&&no.testBox.expandByObject(e)}else{const o=He(e,no._position),a=ri(e,no._size);i!==void 0&&a.multiplyScalar(i),no.testBox.setFromCenterAndSize(o,a)}this.updateBox();const s=(r=this.box)==null?void 0:r.intersectsBox(no.testBox);return s&&K9&&Be.DrawWireBox3(no.testBox,16711680,5),s}intersects(e){return e?this.updateBox(!1).intersectsBox(e):!1}updateBox(e=!1){if(this.box||(this.box=new xn),e||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const i=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const s=i,r=He(this.gameObject,no._position,s),o=ri(this.gameObject,no._size);this.box.setFromCenterAndSize(r,o)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(e=null,i=!1){var s;if(!(!Y9&&!i)){if(this._helper){e&&((s=this._color)==null||s.set(e)),this.gameObject.add(this._helper);return}this._helper=MS(e),this.gameObject.add(this._helper)}}};let qo=no;c(qo,"testBox",new xn),c(qo,"_position",new w),c(qo,"_size",new w(.01,.01,.01));class J9 extends zM{constructor(t,e={}){super(t),t._simpleState__activeStates=[],t._simpleState__normalStyles={},t._simpleState__states=e,t._simpleState__statesProperties={};for(const i in e)for(const s in e[i])t._simpleState__statesProperties[s]||(t._simpleState__statesProperties[s]=[]),t._simpleState__statesProperties[s].push(i);for(const i of t._components)t._simpleState__statesProperties[i.id]&&(t._simpleState__normalStyles[i.id]=i.inline?i.inline:i._value);t.__overridedSet=t.set,t.set=this.storeSet.bind(t),t.renderStates=this.renderStates.bind(t),t.setupState=this.setupState.bind(t),t.setState=this.setState.bind(t),t.activatePseudoState=this.activatePseudoState.bind(t),t.deactivatePseudoState=this.deactivatePseudoState.bind(t),t.togglePseudoState=this.togglePseudoState.bind(t)}act(){}attach(){}detach(){}setupState(t,e){this._simpleState__states[t]=e;const i=[];for(const s in e)this._simpleState__statesProperties[s]||(this._simpleState__statesProperties[s]=[],i.push(s)),this._simpleState__statesProperties[s].push(t);for(const s of this._components)i.indexOf(s.id)>-1&&(this._simpleState__normalStyles[s.id]=s.inline?s.inline:s._value)}renderStates(){let t={...this._simpleState__normalStyles};for(const e in this._simpleState__states)this._simpleState__activeStates.indexOf(e)>-1&&(t={...t,...this._simpleState__states[e]});this.set(t,!1)}storeSet(t,e=!0){if(e)for(const i in t)this._simpleState__statesProperties[i]&&(this._simpleState__normalStyles[i]=t[i]);this.__overridedSet(t)}activatePseudoState(t){this._simpleState__activeStates.indexOf(t)===-1&&(this._simpleState__activeStates.push(t),this.renderStates())}deactivatePseudoState(t){const e=this._simpleState__activeStates.indexOf(t);e>-1&&(this._simpleState__activeStates.splice(e,1),this.renderStates())}togglePseudoState(t){const e=this._simpleState__activeStates.indexOf(t);e>-1?this._simpleState__activeStates.splice(e,1):this._simpleState__activeStates.push(t),this.renderStates()}setState(t){Array.isArray(t)?this._simpleState__activeStates=t:this._simpleState__activeStates=[t],this.renderStates()}}var u2=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class zm extends re{constructor(){super(...arguments);c(this,"effectColor");c(this,"effectDistance")}}u2([A(Ut)],zm.prototype,"effectColor",void 0);u2([A(oe)],zm.prototype,"effectDistance",void 0);var Qm=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const J_=z("debugui"),Z_=z("debuguilayout");class d2{constructor(){c(this,"width");c(this,"height")}}class f2{constructor(){c(this,"x");c(this,"y");c(this,"width");c(this,"height")}}const Uo=new w,Ip=new ae,WA=new ie;class es extends na{constructor(){super(...arguments);c(this,"_anchoredPosition");c(this,"sizeDelta",new oe(100,100));c(this,"pivot",new oe(.5,.5));c(this,"anchorMin",new oe(0,0));c(this,"anchorMax",new oe(1,1));c(this,"minWidth");c(this,"minHeight");c(this,"lastMatrix");c(this,"rectBlock");c(this,"_transformNeedsUpdate",!1);c(this,"_initialPosition");c(this,"_parentRectTransform");c(this,"_lastUpdateFrame",-1);c(this,"_lastAnchoring");c(this,"_createdBlocks",[]);c(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new oe),this._anchoredPosition}set anchoredPosition(e){this._anchoredPosition=e}get width(){let e=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const i=this._parentRectTransform.width,s=this.anchorMax.x-this.anchorMin.x;e=i*s,e+=this.sizeDelta.x}return this.minWidth!==void 0&&e<this.minWidth?this.minWidth:e}get height(){let e=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const i=this._parentRectTransform.height,s=this.anchorMax.y-this.anchorMin.y;e=i*s,e+=this.sizeDelta.y}return this.minHeight!==void 0&&e<this.minHeight?this.minHeight:e}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new oe),this.lastMatrix=new ae,this.rectBlock=new ne,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,Ed(this,"_anchoredPosition",()=>{this.markDirty()}),Ed(this,"sizeDelta",()=>{this.markDirty()}),Ed(this,"pivot",()=>{this.markDirty()}),Ed(this,"anchorMin",()=>{this.markDirty()}),Ed(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var e;super.onEnable(),this.rectBlock||(this.rectBlock=new ne),this.lastMatrix||(this.lastMatrix=new ae),this._lastAnchoring||(this._lastAnchoring=new oe),this._initialPosition||(this._initialPosition=new w),this._anchoredPosition||(this._anchoredPosition=new oe),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(e=this.canvas)==null||e.registerTransform(this)}onDisable(){var e;super.onDisable(),this.removeShadowComponent(),(e=this.canvas)==null||e.unregisterTransform(this)}onParentRectTransformChanged(e){this._transformNeedsUpdate||this.onApplyTransform(Z_?`${e.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(Z_&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(e){var r;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const i=this.shadowComponent;if(!i)return;this.gameObject.parent?this._parentRectTransform=Q.getComponentInParent(this.gameObject.parent,es):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,Z_&&console.warn("RectTransform â†’ ApplyTransform",this.name+" because "+e),this.isRoot()?this.Root.screenspace||(i.rotation.y=Math.PI):(i.matrix.identity(),i.matrixAutoUpdate=!1,Uo.set(0,0,0),this.applyPivot(Uo),i.matrix.setPosition(Uo.x,Uo.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(WA.copy(this.gameObject.quaternion),WA.x*=-1,WA.z*=-1,Ip.makeRotationFromQuaternion(WA),i.matrix.premultiply(Ip)),Uo.set(0,0,0),this.applyAnchoring(Uo),(r=this.canvas)!=null&&r.screenspace?Uo.z+=.1:Uo.z+=.01,Ip.identity(),Ip.setPosition(Uo.x,Uo.y,Uo.z),i.matrix.premultiply(Ip),i.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const s=!0;for(const o of jS(this.gameObject,na,s,1)){if(o===this||!o.activeAndEnabled)continue;const a=o;a.onParentRectTransformChanged&&a.onParentRectTransformChanged(this)}}applyAnchoring(e){this._lastAnchoring||(this._lastAnchoring=new oe);const i=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=i.x,this.gameObject.position.y+=i.y,this._lastAnchoring.copy(this._anchoredPosition),e.x+=this._initialPosition.x-this.gameObject.position.x,e.y+=this._initialPosition.y-this.gameObject.position.y,e.z+=this._initialPosition.z-this.gameObject.position.z;const s=this._parentRectTransform;if(s){let r=0;const o=1-this.anchorMax.y-this.anchorMin.y;r-=s.height*.5*o,e.y+=r;let a=0;const l=1-this.anchorMax.x-this.anchorMin.x;a-=s.width*.5*l,e.x+=a}}applyPivot(e){if(this.pivot&&!this.isRoot()){const i=this.pivot.x-.5;e.x-=i*this.sizeDelta.x*this.gameObject.scale.x;const s=this.pivot.y-.5;e.y-=s*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const e={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(e),e}ensureValidSize(e,i=1e-4){return e.width<=0&&(e.width=i),e.height<=0&&(e.height=1e-4),e}createNewBlock(e){e={...this.getBasicOptions(),...e},J_&&console.log(this.name,e);const i=new uS(e);return this._createdBlocks.push(i),i}createNewText(e){J_&&console.log(e),e={...this.getBasicOptions(),...e},J_&&console.log(this.name,e);const i=new dS(e);return this._createdTextBlocks.push(i),i}}Qm([A(oe)],es.prototype,"anchoredPosition",null);Qm([A(oe)],es.prototype,"sizeDelta",void 0);Qm([A(oe)],es.prototype,"pivot",void 0);Qm([A(oe)],es.prototype,"anchorMin",void 0);Qm([A(oe)],es.prototype,"anchorMax",void 0);var p2=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const qA={backgroundColor:new be(1,1,1),backgroundOpacity:1,borderColor:new be(1,1,1),borderOpacity:1},Jd=class extends na{constructor(){super(...arguments);c(this,"_alphaFactor",1);c(this,"sRGBColor",new be(1,0,1));c(this,"raycastTarget",!0);c(this,"uiObject",null);c(this,"_color",null);c(this,"_rect",null);c(this,"_stateManager",null);c(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new Ut(1,1,1,1)),this._color}set color(e){(!this._color||this._color.r!==e.r||this._color.g!==e.g||this._color.b!==e.b||this._color.alpha!==e.alpha)&&(this._color||(this._color=new Ut(1,1,1,1)),this._color.copy(e),this.onColorChanged())}setAlphaFactor(e){this._alphaFactor=e,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),qA.backgroundColor=this.sRGBColor,qA.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(qA,this._alphaFactor),this.uiObject.set(qA),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=Q.getComponent(this.gameObject,es)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var e;(e=this.uiObject)==null||e.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(e){this.makePanel(),this.uiObject&&(this.uiObject.setState(e),this==null||this.markDirty())}setupState(e){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new J9(this.uiObject)),this.uiObject.setupState(e.state,e.attributes))}setOptions(e){this.makePanel(),this.uiObject&&this.uiObject.set(e)}awake(){super.awake(),this.makePanel(),Ed(this,"_color",()=>h9(this,this.onColorChanged))}onEnable(){var e;super.onEnable(),this.uiObject&&((e=this.rectTransform.shadowComponent)==null||e.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const e=.015,i={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:e};this.onBeforeCreate(i),this.applyEffects(i),this.onCreate(i),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(e){}onCreate(e){this.uiObject=this.rectTransform.createNewBlock(e),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(e,i=1){var r;const s=(r=this.gameObject)==null?void 0:r.getComponent(zm);s&&(s.effectDistance&&(e.borderWidth=Math.max(Math.abs(s.effectDistance.x),Math.abs(s.effectDistance.y))),s.effectColor&&(e.borderColor=s.effectColor,e.borderOpacity=s.effectColor.alpha*i))}async setTexture(e){if(this.setOptions({backgroundOpacity:0}),e){if(Jd.textureCache.has(e))e=Jd.textureCache.get(e);else if(!e.isRenderTargetTexture){const i=e.clone();i.colorSpace=Ni,Jd.textureCache.set(e,i),e=i}this.setOptions({backgroundImage:e,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),ht.assignTextureLOD(e,0).then(i=>{i instanceof At&&(e&&Jd.textureCache.set(e,i),this.setOptions({backgroundImage:i}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}};let $l=Jd;c($l,"textureCache",new Map);p2([A(Ut)],$l.prototype,"color",null);p2([A()],$l.prototype,"raycastTarget",void 0);class J0 extends $l{constructor(){super(...arguments);c(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var Z0=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};let fE=class{constructor(){c(this,"texture",null);c(this,"rect")}};Z0([A(At)],fE.prototype,"texture",void 0);let jm=class extends J0{constructor(){super(...arguments);c(this,"_sprite");c(this,"pixelsPerUnitMultiplier",1)}set image(e){this.sprite||(this.sprite=new fE),this.sprite.texture=e,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(e){this._sprite!==e&&(this._sprite=e,this.onAfterCreated())}isBuiltinSprite(){var i,s,r,o,a,l,h;const e=this.sprite;switch((i=e==null?void 0:e.texture)==null?void 0:i.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((r=(s=e==null?void 0:e.texture)==null?void 0:s.name)!=null&&r.length)&&((a=(o=e==null?void 0:e.texture)==null?void 0:o.image)==null?void 0:a.width)===32&&((h=(l=e==null?void 0:e.texture)==null?void 0:l.image)==null?void 0:h.height)===32}onBeforeCreate(e){var i,s;super.onBeforeCreate(e),this.isBuiltinSprite()&&(e.borderRadius=5/this.pixelsPerUnitMultiplier,((s=(i=this.sprite)==null?void 0:i.texture)==null?void 0:s.name)==="Knob"&&(e.borderRadius=999))}onAfterCreated(){var e;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((e=this.sprite)==null?void 0:e.texture))}};Z0([A(fE)],jm.prototype,"sprite",null);Z0([A()],jm.prototype,"pixelsPerUnitMultiplier",void 0);class pE extends J0{constructor(){super(...arguments);c(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(e){this._mainTexture!==e&&(this._mainTexture=e,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}Z0([A(At)],pE.prototype,"mainTexture",null);var zr=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Uh=z("debugbutton");var ya;(function(n){n[n.None=0]="None",n[n.ColorTint=1]="ColorTint",n[n.SpriteSwap=2]="SpriteSwap",n[n.Animation=3]="Animation"})(ya||(ya={}));class _h{constructor(){c(this,"colorMultiplier");c(this,"disabledColor");c(this,"fadeDuration");c(this,"highlightedColor");c(this,"normalColor");c(this,"pressedColor");c(this,"selectedColor")}}zr([A()],_h.prototype,"colorMultiplier",void 0);zr([A(Ut)],_h.prototype,"disabledColor",void 0);zr([A()],_h.prototype,"fadeDuration",void 0);zr([A(Ut)],_h.prototype,"highlightedColor",void 0);zr([A(Ut)],_h.prototype,"normalColor",void 0);zr([A(Ut)],_h.prototype,"pressedColor",void 0);zr([A(Ut)],_h.prototype,"selectedColor",void 0);class Z9{constructor(){c(this,"disabledTrigger");c(this,"highlightedTrigger");c(this,"normalTrigger");c(this,"pressedTrigger");c(this,"selectedTrigger")}}class wh extends re{constructor(){super(...arguments);c(this,"onClick",new $t);c(this,"_isHovered",0);c(this,"colors");c(this,"transition");c(this,"animationTriggers");c(this,"animator");c(this,"_interactable",!0);c(this,"_requestedAnimatorTrigger");c(this,"_isInit",!1);c(this,"_image")}click(){var e;(e=this.onClick)==null||e.invoke()}onPointerEnter(e){var s,r;const i=e.event.pointerType==="mouse"&&e.button===0;i&&(this._isHovered+=1),Uh&&console.warn("Button Enter",i,this._isHovered,(s=this.animationTriggers)==null?void 0:s.highlightedTrigger,this.animator),this.interactable&&(this.transition==ya.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===ya.ColorTint&&this.colors&&((r=this._image)==null||r.setState("hovered")),i&&this.context.input.setCursorPointer())}onPointerExit(){var e,i;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),Uh&&console.log("Button Exit",this._isHovered,(e=this.animationTriggers)==null?void 0:e.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==ya.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===ya.ColorTint&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(e){var i,s;Uh&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==ya.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===ya.ColorTint&&this.colors&&((s=this._image)==null||s.setState("pressed")))}onPointerUp(e){var i,s;Uh&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==ya.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===ya.ColorTint&&this.colors&&((s=this._image)==null||s.setState(this._isHovered?"hovered":"normal")))}onPointerClick(e){if(this.interactable&&!(e.button!==0&&e.event.pointerType===Kc.Mouse)&&(Uh&&(console.warn("Button Click",this.onClick),bi("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),e.use(),Uh))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),Be.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(e){this._interactable=e,this._image&&(this._image.setInteractable(e),e?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(e){this.interactable=e}awake(){super.awake(),Uh&&console.log(this),this._isInit=!1,this.init()}start(){var e;(e=this._image)==null||e.setInteractable(this.interactable),this.gameObject.getComponentInParent(Lm)||this.gameObject.addComponent(ZS)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(e){var i;this._requestedAnimatorTrigger=e,yield,yield,this._requestedAnimatorTrigger==e&&((i=this.animator)==null||i.SetTrigger(e))}init(){this._isInit||(this._isInit=!0,this._image=Q.getComponent(this.gameObject,jm),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(e){var p,g,m,v,y;e.setInteractable(this.interactable);const i=this.getFinalColor(e.color,(p=this.colors)==null?void 0:p.normalColor),s={state:"normal",attributes:{backgroundColor:i,backgroundOpacity:i.alpha}};e.setupState(s);const r=this.getFinalColor(e.color,(g=this.colors)==null?void 0:g.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};e.setupState(o);const a=this.getFinalColor(e.color,(m=this.colors)==null?void 0:m.pressedColor),l={state:"pressed",attributes:{backgroundColor:a,backgroundOpacity:a.alpha}};e.setupState(l);const h=this.getFinalColor(e.color,(v=this.colors)==null?void 0:v.selectedColor),u={state:"selected",attributes:{backgroundColor:h,backgroundOpacity:h.alpha}};e.setupState(u);const d=this.getFinalColor(e.color,(y=this.colors)==null?void 0:y.disabledColor),f={state:"disabled",attributes:{backgroundColor:d,backgroundOpacity:d.alpha}};e.setupState(f)}getFinalColor(e,i){return i?e.clone().multiply(i).convertLinearToSRGB():e.clone().convertLinearToSRGB()}}zr([A($t)],wh.prototype,"onClick",void 0);zr([A(_h)],wh.prototype,"colors",void 0);zr([A()],wh.prototype,"transition",void 0);zr([A(Z9)],wh.prototype,"animationTriggers",void 0);zr([A(Cs)],wh.prototype,"animator",void 0);zr([A()],wh.prototype,"interactable",null);var Ki=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const SR=z("debuguilayout");class Vu{constructor(){c(this,"left",0);c(this,"right",0);c(this,"top",0);c(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}Ki([A()],Vu.prototype,"left",void 0);Ki([A()],Vu.prototype,"right",void 0);Ki([A()],Vu.prototype,"top",void 0);Ki([A()],Vu.prototype,"bottom",void 0);var $x;(function(n){n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight",n[n.Custom=9]="Custom"})($x||($x={}));var yu;(function(n){n.Horizontal="x",n.Vertical="y"})(yu||(yu={}));class Qr extends re{constructor(){super(...arguments);c(this,"_rectTransform",null);c(this,"_needsUpdate",!1);c(this,"childAlignment",$x.UpperLeft);c(this,"reverseArrangement",!1);c(this,"spacing",0);c(this,"padding");c(this,"minWidth",0);c(this,"minHeight",0);c(this,"flexibleHeight",0);c(this,"flexibleWidth",0);c(this,"preferredHeight",0);c(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(e){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(SR&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){SR&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(es);const e=this.gameObject.getComponentInParent(En);e&&e.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const e=this.gameObject.getComponentInParent(En);e&&e.unregisterLayoutGroup(this)}set m_Spacing(e){e!==this.spacing&&(this._needsUpdate=!0,this.spacing=e)}get m_Spacing(){return this.spacing}}Ki([A()],Qr.prototype,"childAlignment",void 0);Ki([A()],Qr.prototype,"reverseArrangement",void 0);Ki([A()],Qr.prototype,"spacing",void 0);Ki([A(Vu)],Qr.prototype,"padding",void 0);Ki([A()],Qr.prototype,"minWidth",void 0);Ki([A()],Qr.prototype,"minHeight",void 0);Ki([A()],Qr.prototype,"flexibleHeight",void 0);Ki([A()],Qr.prototype,"flexibleWidth",void 0);Ki([A()],Qr.prototype,"preferredHeight",void 0);Ki([A()],Qr.prototype,"preferredWidth",void 0);class xh extends Qr{constructor(){super(...arguments);c(this,"childControlHeight",!0);c(this,"childControlWidth",!0);c(this,"childForceExpandHeight",!1);c(this,"childForceExpandWidth",!1);c(this,"childScaleHeight",!1);c(this,"childScaleWidth",!1)}onCalculateLayout(e){var I;const i=this.primaryAxis,s=e.width;let r=s;const o=e.height;let a=o;r-=this.padding.horizontal,a-=this.padding.vertical,i===yu.Horizontal?this.padding.horizontal:this.padding.vertical;const l=i===yu.Horizontal,h=l?"y":"x",u=l?this.childControlWidth:this.childControlHeight,d=l?this.childControlHeight:this.childControlWidth,f=l?this.childForceExpandWidth:this.childForceExpandHeight,p=l?this.childForceExpandHeight:this.childForceExpandWidth,g=l?a:r,m=l?s:o,v=.5*(l?this.childAlignment%3:Math.floor(this.childAlignment/3));let y=0;l?y+=this.padding.left:y+=this.padding.top;let b=0,_=0;for(let B=0;B<this.gameObject.children.length;B++){const R=this.gameObject.children[B],P=Q.getComponent(R,es);P!=null&&P.activeAndEnabled&&(_+=1,l?b+=P.width:b+=P.height)}let x=0;const S=this.spacing*(_-1);if(f||u){let B=0;l?B=r-=S:B=a-=S,_>0&&(x=B/_)}let E=0;E+=this.padding.left,E-=this.padding.right,v!==0&&(y=m-b,y*=v,y-=S*v,l?(y-=this.padding.right*v,y+=this.padding.left*(1-v),y<this.padding.left&&(y=this.padding.left)):(y-=this.padding.bottom*v,y+=this.padding.top*(1-v),y<this.padding.top&&(y=this.padding.top)));let M=1;for(let B=0;B<this.gameObject.children.length;B++){const R=this.gameObject.children[B],P=Q.getComponent(R,es);if(P!=null&&P.activeAndEnabled){(I=P.pivot)==null||I.set(.5,.5),P.anchorMin.set(0,1),P.anchorMax.set(0,1);const F=s*.5+E*.5;P.anchoredPosition.x!==F&&(P.anchoredPosition.x=F);const j=o*-.5;P.anchoredPosition.y!==j&&(P.anchoredPosition.y=j),p&&d&&P.sizeDelta[h]!==g&&(P.sizeDelta[h]=g),f&&u&&P.sizeDelta[i]!==x&&(P.sizeDelta[i]=x);const V=l?P.width:P.height,X=V*.5;if(y+=X,f){const O=x*M-x*.5;O>y&&(y=O-x*.5+V+this.padding.left,y-=X)}let k=y;i===yu.Vertical&&(k=-k),P.anchoredPosition[i]!==k&&(P.anchoredPosition[i]=k),y+=X,y+=this.spacing,M+=1}}}}Ki([A()],xh.prototype,"childControlHeight",void 0);Ki([A()],xh.prototype,"childControlWidth",void 0);Ki([A()],xh.prototype,"childForceExpandHeight",void 0);Ki([A()],xh.prototype,"childForceExpandWidth",void 0);Ki([A()],xh.prototype,"childScaleHeight",void 0);Ki([A()],xh.prototype,"childScaleWidth",void 0);class g2 extends xh{get primaryAxis(){return yu.Vertical}}class m2 extends xh{get primaryAxis(){return yu.Horizontal}}class A2 extends Qr{onCalculateLayout(){}}var cl=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Ta;(function(n){n[n.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",n[n.ScreenSpaceCamera=1]="ScreenSpaceCamera",n[n.WorldSpace=2]="WorldSpace",n[n.Undefined=-1]="Undefined"})(Ta||(Ta={}));const $_=z("debuguilayout");class En extends N0{constructor(){super(...arguments);c(this,"_renderOnTop");c(this,"_depthWrite",!1);c(this,"_doubleSided",!0);c(this,"_castShadows",!1);c(this,"_receiveShadows",!1);c(this,"_renderMode",Ta.Undefined);c(this,"_rootCanvas");c(this,"_scaleFactor",1);c(this,"worldCamera");c(this,"planeDistance",-1);c(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this));c(this,"previousParent",null);c(this,"_lastMatrixWorld",null);c(this,"_rectTransforms",[]);c(this,"_layoutGroups",new Map);c(this,"_receivers",[]);c(this,"onBeforeRenderRoutine",()=>{var e,i,s,r;if(this.previousParent=this.gameObject.parent,((e=this.context.xr)!=null&&e.isVR||(i=this.context.xr)!=null&&i.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(s=this.shadowComponent)==null||s.updateMatrixWorld(!0),(r=this.shadowComponent)==null||r.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),kr.ensureUpdateMeshUI(F1,this.context))});c(this,"onAfterRenderRoutine",()=>{var e,i,s,r,o;if(((e=this.context.xr)!=null&&e.isVR||(i=this.context.xr)!=null&&i.isPassThrough)&&this.screenspace){(s=this.previousParent)==null||s.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const h=this.context.mainCamera;h==null||h.add(this.gameObject)}else this.previousParent.add(this.gameObject);const a=this.context.renderer.autoClear,l=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(r=this.shadowComponent)==null||r.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),kr.ensureUpdateMeshUI(F1,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=a,this.context.renderer.autoClearColor=l,this.previousParent.add(this.gameObject)}(o=this._lastMatrixWorld)==null||o.copy(this.gameObject.matrixWorld)});c(this,"_updateRenderSettingsRoutine");c(this,"_activeRenderMode",-1);c(this,"_lastWidth",-1);c(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==Ta.WorldSpace}set renderOnTop(e){e!==this._renderOnTop&&(this._renderOnTop=e,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===Ta.ScreenSpaceOverlay)}set depthWrite(e){this._depthWrite!==e&&(this._depthWrite=e,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(e){this._doubleSided!==e&&(this._doubleSided=e,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(e){this._castShadows!==e&&(this._castShadows=e,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(e){this._renderMode!==e&&(this._renderMode=e,this.onRenderSettingsChanged())}set rootCanvas(e){this._rootCanvas instanceof En||(this._rootCanvas=e)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(e){this._scaleFactor=e}awake(){var e;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,$_&&console.log("Canvas.Awake()",((e=this.previousParent)==null?void 0:e.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new ae,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const e=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);e!==-1&&this.context.pre_render_callbacks.splice(e,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);i!==-1&&this.context.post_render_callbacks.splice(i,1)}registerTransform(e){this._rectTransforms.push(e)}unregisterTransform(e){const i=this._rectTransforms.indexOf(e);i!==-1&&this._rectTransforms.splice(i,1)}registerLayoutGroup(e){const i=e.gameObject;this._layoutGroups.set(i,e)}unregisterLayoutGroup(e){const i=e.gameObject;this._layoutGroups.delete(i)}registerEventReceiver(e){this._receivers.push(e)}unregisterEventReceiver(e){const i=this._receivers.indexOf(e);i!==-1&&this._receivers.splice(i,1)}async onEnterXR(e){this.screenspace?(e.xr.isVR||e.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await UC(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(e){this.screenspace&&(e.xr.isVR||e.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var e;for(const i of this._receivers)(e=i.onBeforeCanvasRender)==null||e.call(i,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new ae);const e=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);$_&&e&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const i=!1;for(const s of this._rectTransforms){e&&s.markDirty();let r=this._layoutGroups.get(s.gameObject);s.isDirty&&!r&&(r=s.gameObject.getComponentInParent(Qr)),(s.isDirty||r!=null&&r.isDirty)&&($_&&!i&&console.log("CANVAS UPDATE ### "+s.name+" ##################################### "+this.context.time.frame),r==null||r.updateLayout(),s.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),We.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),_y(this.shadowComponent,this);for(const e of Q.getComponentsInChildren(this.gameObject,na))_y(e.shadowComponent,this)}}onUpdateRenderMode(e=!1){if(!e&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let i=this.context.mainCameraComponent,s=10;switch(i&&i.nearClipPlane>0&&i.farClipPlane>0&&(s=ye.lerp(i.nearClipPlane,i.farClipPlane,.01)),this._renderMode===Ta.ScreenSpaceCamera&&(this.worldCamera&&(i=this.worldCamera),this.planeDistance>0&&(s=this.planeDistance)),this._renderMode){case Ta.ScreenSpaceOverlay:case Ta.ScreenSpaceCamera:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!i)return;const r=s+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-r,this.gameObject.quaternion.identity();const o=this.gameObject.getComponent(es);let a=!1;o.sizeDelta.x!==this.context.domWidth&&(a=!0),o.sizeDelta.y!==this.context.domHeight&&(a=!0);const l=i.fieldOfView*Math.PI/180,h=2*Math.tan(l/2)*Math.abs(r);this.gameObject.scale.x=h/this.context.domHeight,this.gameObject.scale.y=h/this.context.domHeight,this.gameObject.scale.z=.01,a&&(o.sizeDelta.x=this.context.domWidth,o.sizeDelta.y=this.context.domHeight,o==null||o.markDirty());break;case Ta.WorldSpace:this._lastWidth=-1,this._lastHeight=-1;break}}}cl([A()],En.prototype,"renderOnTop",null);cl([A()],En.prototype,"depthWrite",null);cl([A()],En.prototype,"doubleSided",null);cl([A()],En.prototype,"castShadows",null);cl([A()],En.prototype,"receiveShadows",null);cl([A()],En.prototype,"renderMode",null);cl([A(En)],En.prototype,"rootCanvas",null);cl([A()],En.prototype,"scaleFactor",null);cl([A(Bt)],En.prototype,"worldCamera",void 0);cl([A()],En.prototype,"planeDistance",void 0);var gE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Eu extends re{constructor(){super(...arguments);c(this,"_alpha",1);c(this,"interactable",!0);c(this,"blocksRaycasts",!0);c(this,"_isDirty",!1);c(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(e){e!==this._alpha&&(this._alpha=e,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),We.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const e of Q.getComponentsInChildren(this.gameObject,na,this._buffer)){const i=e;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}gE([A()],Eu.prototype,"alpha",null);gE([A()],Eu.prototype,"interactable",void 0);gE([A()],Eu.prototype,"blocksRaycasts",void 0);var xi=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const ER=z("debugusdzbehaviours");function Gm(n){n&&(n.getComponentInParent(Lm)||(ve()&&console.warn("Create Raycaster on "+n.name+" because no raycaster was found in the hierarchy"),n.addNewComponent(xo)))}class Wf extends re{constructor(){super(...arguments);c(this,"object");c(this,"target");c(this,"duration",1);c(this,"relativeMotion",!1);c(this,"coroutine",null);c(this,"targetPos",new w);c(this,"targetRot",new ie);c(this,"targetScale",new w)}start(){Gm(this.gameObject)}onPointerClick(e){e.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const e=He(this.object).clone(),i=He(this.target).clone(),s=Gt(this.object).clone(),r=Gt(this.target).clone(),o=ri(this.object).clone(),a=ri(this.target).clone(),l=e.distanceTo(i),h=s.angleTo(r),u=o.distanceTo(a);if(l<.01&&h<.01&&u<.01){Cn(this.object,i),ia(this.object,r),Kg(this.object,a),this.coroutine=null;return}let d=0,f=0;for(;d<1;)d+=this.context.time.deltaTime/this.duration,d>1&&(d=1),f=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,this.targetPos.lerpVectors(e,i,f),this.targetRot.slerpQuaternions(s,r,f),this.targetScale.lerpVectors(o,a,f),Cn(this.object,this.targetPos),ia(this.object,this.targetRot),Kg(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const e=this.object.position.clone(),i=this.object.quaternion.clone(),s=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,h=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),h=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(e,this.targetPos,h),this.object.quaternion.slerpQuaternions(i,this.targetRot,h),this.object.scale.lerpVectors(s,this.targetScale,h),yield;this.coroutine=null}beforeCreateDocument(e){var i;if(this.target&&this.object&&this.gameObject){const s=new hn("Move to "+((i=this.target)==null?void 0:i.name),$n.tapTrigger(this.gameObject),Ct.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));e.addBehavior(s)}}}xi([A(ne)],Wf.prototype,"object",void 0);xi([A(ne)],Wf.prototype,"target",void 0);xi([A()],Wf.prototype,"duration",void 0);xi([A()],Wf.prototype,"relativeMotion",void 0);const Qo=class extends re{constructor(){super(...arguments);c(this,"materialToSwitch");c(this,"variantMaterial");c(this,"fadeDuration",0);c(this,"_objectsWithThisMaterial",null);c(this,"selfModel");c(this,"targetModels")}start(){var e;this._objectsWithThisMaterial=this.objectsWithThisMaterial,Gm(this.gameObject),ve()&&this._objectsWithThisMaterial.length<=0&&console.warn('ChangeMaterialOnClick: No objects found with material "'+((e=this.materialToSwitch)==null?void 0:e.name)+'"')}onPointerEnter(e){this.context.input.setCursorPointer()}onPointerExit(e){this.context.input.setCursorNormal()}onPointerClick(e){if(e.use(),!!this.variantMaterial)for(let i=0;i<this.objectsWithThisMaterial.length;i++){const s=this.objectsWithThisMaterial[i];s.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(e=>{if(e instanceof J)if(Array.isArray(e.material)){for(const i of e.material)if(i===this.materialToSwitch){this.objectsWithThisMaterial.push(e);break}}else e.material===this.materialToSwitch?this.objectsWithThisMaterial.push(e):t6(e.material,this.materialToSwitch)&&this.objectsWithThisMaterial.push(e)}),this._objectsWithThisMaterial)}async beforeCreateDocument(e,i){this.targetModels=[],Qo._materialTriggersPerId={},Qo.variantSwitchIndex=0,this.materialToSwitch&&await ht.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await ht.assignTextureLOD(this.variantMaterial,0)}createBehaviours(e,i,s){this.objectsWithThisMaterial.find(o=>o.uuid===i.uuid)&&this.targetModels.push(i),this.gameObject.uuid===i.uuid&&(this.selfModel=i,this.materialToSwitch&&(Qo._materialTriggersPerId[this.materialToSwitch.uuid]||(Qo._materialTriggersPerId[this.materialToSwitch.uuid]=[]),Qo._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(e,i){if(!this.materialToSwitch)return;const s=Qo._materialTriggersPerId[this.materialToSwitch.uuid];if(s){const r={};for(const o of s){const a=o.createVariants();a&&a.length>0&&(r[o.selfModel.uuid]=a)}for(const o of s){const a=[];for(const l in r)l!==o.selfModel.uuid&&a.push(...r[l]);o.createAndAttachBehaviors(e,r[o.selfModel.uuid],a)}}delete Qo._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(e,i,s){const r=[],o=[],a=Math.max(0,this.fadeDuration);o.push(Ct.fadeAction([...this.targetModels,...s],a,!1)),r.push(Ct.fadeAction(i,a,!1)),o.push(Ct.fadeAction(i,a,!0)),e.addBehavior(new hn("Select_"+this.selfModel.name,$n.tapTrigger(this.selfModel),Ct.parallel(...o))),e.addBehavior(new hn("StartHidden_"+this.selfModel.name,$n.sceneStartTrigger(),Ct.parallel(...r)))}static getMaterialName(e){return ol(e.name||"Material")+"_"+e.id}createVariants(){if(!this.variantMaterial)return null;const e=[];for(const i of this.targetModels){const s=i.clone();s.name+="_Variant_"+Qo.variantSwitchIndex+++"_"+Qo.getMaterialName(this.variantMaterial),s.displayName=s.displayName+": Variant with material "+this.variantMaterial.name,s.material=this.variantMaterial,s.geometry=i.geometry,s.transform=i.transform,(!i.parent||!i.parent.isEmpty())&&_s.createEmptyParent(i),i.parent&&i.parent.add(s),e.push(s)}return e}};let Vl=Qo;c(Vl,"_materialTriggersPerId",{}),c(Vl,"variantSwitchIndex",0);xi([A(mt)],Vl.prototype,"materialToSwitch",void 0);xi([A(mt)],Vl.prototype,"variantMaterial",void 0);xi([A()],Vl.prototype,"fadeDuration",void 0);const ui=class extends re{constructor(){super(...arguments);c(this,"target");c(this,"toggleOnClick",!1);c(this,"targetState",!0);c(this,"hideSelf",!0);c(this,"selfModel");c(this,"selfModelClone");c(this,"targetModel");c(this,"toggleModel");c(this,"stateBeforeCreatingDocument",!1);c(this,"targetStateBeforeCreatingDocument",!1)}start(){Gm(this.gameObject)}onPointerClick(e){e.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(e,i,s){i.uuid===this.gameObject.uuid&&(this.selfModel=i,this.selfModelClone=i.clone())}beforeCreateDocument(){this.target&&(this.gameObject[ui.wasVisible]===void 0&&(this.gameObject[ui.wasVisible]=this.gameObject.activeSelf),this.target[ui.wasVisible]===void 0&&(this.target[ui.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[ui.wasVisible],this.targetStateBeforeCreatingDocument=this.target[ui.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(e,i){if(!this.target)return;this.targetModel=i.document.findById(this.target.uuid);const s=this.selfModel;if(this.selfModel&&this.targetModel){let r=this.selfModel,o=this.targetState;if(this.toggleOnClick)if(o=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&NO.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[ui.toggleClone]){const h=this.selfModelClone.clone();h.setMatrix(new ae),h.name+="_toggle"+ui.clonedToggleIndex++,s.add(h),this.gameObject[ui.toggleClone]=h,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const l=this.gameObject[ui.toggleClone];if(!this.gameObject[ui.reverseToggleClone]){const h=this.selfModelClone.clone();h.setMatrix(new ae),h.name+="_toggleReverse"+ui.clonedToggleIndex++,s.add(h),this.gameObject[ui.reverseToggleClone]=h}this.toggleModel=this.gameObject[ui.reverseToggleClone],(!this.toggleModel.geometry||!l.geometry)&&console.error("triggers without childs and without geometry won't work!",this,s.geometry),r=l,s.geometry=null,s.material=null}if(this.toggleModel){if(this.toggleOnClick){const l=[];l.push(Ct.fadeAction(r,0,!1)),l.push(Ct.fadeAction(this.toggleModel,0,!0)),l.push(Ct.fadeAction(this.targetModel,0,o)),e.addBehavior(new hn("Toggle_"+r.name+"_toggleTo"+(o?"On":"Off"),$n.tapTrigger(r),Ct.parallel(...l)));const h=[];h.push(Ct.fadeAction(this.toggleModel,0,!1)),h.push(Ct.fadeAction(r,0,!0)),h.push(Ct.fadeAction(this.targetModel,0,!o)),e.addBehavior(new hn("Toggle_"+r.name+"_toggleTo"+(o?"Off":"On"),$n.tapTrigger(this.toggleModel),Ct.parallel(...h)))}}else{const l=[];this.hideSelf&&l.push(Ct.fadeAction(r,0,!1)),l.push(Ct.fadeAction(this.targetModel,0,o)),e.addBehavior(new hn("Toggle_"+r.name+"_toggleTo"+(o?"On":"Off"),$n.tapTrigger(r),Ct.parallel(...l)))}const a=new Array;this.targetStateBeforeCreatingDocument||a.push(this.targetModel),this.stateBeforeCreatingDocument||a.push(s),this.toggleModel&&a.push(this.toggleModel),e.addBehavior(new hn("HideOnStart_"+this.gameObject.name,$n.sceneStartTrigger(),Ct.fadeAction(a,0,!1)))}}afterSerialize(e,i){this.gameObject[ui.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[ui.wasVisible],delete this.gameObject[ui.wasVisible]),this.target&&this.target[ui.wasVisible]!==void 0&&(this.target.visible=this.target[ui.wasVisible],delete this.target[ui.wasVisible]),delete this.gameObject[ui.toggleClone],delete this.gameObject[ui.reverseToggleClone]}};let co=ui;c(co,"clonedToggleIndex",0),c(co,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),c(co,"toggleClone",Symbol("clone for toggling")),c(co,"reverseToggleClone",Symbol("clone for reverse toggling"));xi([A(ne)],co.prototype,"target",void 0);xi([A()],co.prototype,"toggleOnClick",void 0);xi([A()],co.prototype,"targetState",void 0);xi([A()],co.prototype,"hideSelf",void 0);class v2 extends re{constructor(){super(...arguments);c(this,"wasVisible",!1)}start(){Q.setActive(this.gameObject,!1)}createBehaviours(e,i,s){i.uuid===this.gameObject.uuid&&(this.wasVisible||e.addBehavior(new hn("HideOnStart_"+this.gameObject.name,$n.sceneStartTrigger(),Ct.fadeAction(i,0,!1))))}beforeCreateDocument(){this.wasVisible=Q.isActiveSelf(this.gameObject)}}class Hm extends re{constructor(){super(...arguments);c(this,"target");c(this,"duration",.5);c(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(e,i,s){if(this.target&&i.uuid===this.gameObject.uuid){const r=new hn("emphasize "+this.name,$n.tapTrigger(this.gameObject),Ct.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));e.addBehavior(r)}}afterCreateDocument(e,i){}}xi([A()],Hm.prototype,"target",void 0);xi([A()],Hm.prototype,"duration",void 0);xi([A()],Hm.prototype,"motionType",void 0);class Iu extends re{constructor(){super(...arguments);c(this,"target");c(this,"clip","");c(this,"toggleOnClick",!1);c(this,"trigger","tap")}start(){Gm(this.gameObject)}ensureAudioSource(){if(!this.target){const e=this.gameObject.addNewComponent(kt);e&&(this.target=e,e.spatialBlend=1,e.volume=1,e.loop=!1,e.preload=!0)}}onPointerClick(e){var i;e.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(e,i,s){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject;Qu.getName(r);const a=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let h=!1;this.gameObject.traverse(p=>{p instanceof J&&p.visible&&(h=!0)}),h=!0;const u=e.addAudioClip(r);let d=Ct.playAudioAction(o,u,"play",a,l);this.target&&this.target.loop&&(d=Ct.sequence(d).makeLooping());const f=this.name?"_"+this.name:"";if(h&&this.trigger==="tap"){this.toggleOnClick&&(d.multiplePerformOperation="stop");const p=new hn("playAudio"+f,$n.tapTrigger(i),d);e.addBehavior(p)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(h&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const p=new hn("playAudioOnStart"+f,$n.sceneStartTrigger(),d);e.addBehavior(p)}}}}xi([A(kt)],Iu.prototype,"target",void 0);xi([A(URL)],Iu.prototype,"clip",void 0);xi([A()],Iu.prototype,"toggleOnClick",void 0);const jo=class extends re{constructor(){super(...arguments);c(this,"animator");c(this,"stateName");c(this,"trigger","tap");c(this,"animation");c(this,"selfModel");c(this,"stateAnimationModel");c(this,"animationSequence",new Array);c(this,"animationLoopAfterSequence",new Array)}get target(){var e,i;return((e=this.animator)==null?void 0:e.gameObject)||((i=this.animation)==null?void 0:i.gameObject)}start(){Gm(this.gameObject)}onPointerClick(e){var i;e.use(),this.target&&this.stateName&&((i=this.animator)==null||i.play(this.stateName,0,0,.1))}createBehaviours(e,i,s){i.uuid===this.gameObject.uuid&&(this.selfModel=i)}afterSerialize(){if(jo.rootsWithExclusivePlayback.size>1){const e='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';ve()&&qt(e),console.warn(e,...jo.rootsWithExclusivePlayback)}jo.animationActions=[],jo.rootsWithExclusivePlayback=new Set}afterCreateDocument(e,i){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const s=i.document,r=i.extensions.find(l=>l instanceof H0);if(!r)return;const o=r.getClipCount(this.target)>1;o&&(ve()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+r.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),jo.rootsWithExclusivePlayback.add(this.target));const a=this.name?this.name:"";s.traverse(l=>{var h,u;if(l.uuid===((h=this.target)==null?void 0:h.uuid)){const d=jo.getActionForSequences(l,this.animationSequence,this.animationLoopAfterSequence),f=new hn(this.trigger+"_"+a+"_toPlayAnimation_"+this.stateName+"_on_"+((u=this.target)==null?void 0:u.name),this.trigger=="tap"?$n.tapTrigger(this.selfModel):$n.sceneStartTrigger(),d);o&&f.makeExclusive(!0),e.addBehavior(f)}})}static getActionForSequences(e,i,s){const r=(a,l)=>{let h=jo.animationActions.find(u=>u.affectedObjects==a&&u.start==l.start&&u.duration==l.duration&&u.animationSpeed==l.speed);return h||(h=Ct.startAnimationAction(a,l.start,l.duration,l.speed),jo.animationActions.push(h)),h},o=Ct.sequence();if(i&&i.length>0)for(const a of i)o.addAction(r(e,a));if(s&&s.length>0){const a=o.actions.length==0?o:Ct.sequence();for(const l of s)a.addAction(r(e,l));a.makeLooping(),o!==a&&o.addAction(a)}return o}static getAndRegisterAnimationSequences(e,i,s){var g,m,v,y,b;if(!i)return;const r=i.getComponent(Cs),o=i.getComponent(Ws);if(!r&&!o)return;if(r&&!s)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+r.name+" on "+i.name);let a=[],l=[];if(o){const _=e.registerAnimation(i,o.clip);return _&&(o.loop?l.push(_):a.push(_)),{animationSequence:a,animationLoopAfterSequence:l}}const h=r==null?void 0:r.runtimeAnimatorController;let u=h==null?void 0:h.findState(s),d=[],f=[];if(h&&u){const _=new Array;_.push(u);let x=!1;for(;_.length<100;){if(!u||u===null||!u.transitions||u.transitions.length===0){(g=u.motion)!=null&&g.isLooping&&(x=!0);break}const S=u.transitions.find(M=>M.conditions.length===0),E=S?h.getState(S.destinationState,0):null;if(E&&_.includes(E)){u=E,x=!0;break}else if(S){if(u=E,!u)break;_.push(u)}else{x=((m=u.motion)==null?void 0:m.isLooping)??!1;break}}if(x&&u){const S=_.indexOf(u);d=_.slice(0,S),f=_.slice(S),ER&&console.log("found loop from "+s,"states until loop",d,"states looping",f)}else d=_,f=[],ER&&console.log("found no loop from "+s,"states",d)}if(d.length===1&&(!((v=d[0].motion)!=null&&v.clip)||((b=(y=d[0].motion)==null?void 0:y.clip.tracks)==null?void 0:b.length)===0)){a=new Array;const _=e.registerAnimation(i,null);_&&a.push(_);return}if(d=d.filter(_=>{var x,S,E;return((x=_.motion)==null?void 0:x.clip)&&((E=(S=_.motion)==null?void 0:S.clip.tracks)==null?void 0:E.length)>0}),f=f.filter(_=>{var x,S,E;return((x=_.motion)==null?void 0:x.clip)&&((E=(S=_.motion)==null?void 0:S.clip.tracks)==null?void 0:E.length)>0}),d.length===0&&f.length===0){console.warn("No clips found for state "+s+" on "+(r==null?void 0:r.name)+", can't export animation data");return}const p=(_,x)=>{if(!i)return;const S=e.registerAnimation(i,_.motion.clip??null);S?(S.speed=_.speed,x.push(S)):console.warn("Couldn't register animation for state "+_.name+" on "+(r==null?void 0:r.name))};if(d.length>0){a=new Array;for(const _ of d)p(_,a)}if(f.length>0){l=new Array;for(const _ of f)p(_,l)}return{animationSequence:a,animationLoopAfterSequence:l}}createAnimation(e,i,s){if(!this.target||!this.animator&&!this.animation)return;const r=jo.getAndRegisterAnimationSequences(e,this.target,this.stateName);r&&(this.animationSequence=r.animationSequence,this.animationLoopAfterSequence=r.animationLoopAfterSequence,this.stateAnimationModel=i)}};let Wa=jo;c(Wa,"animationActions",[]),c(Wa,"rootsWithExclusivePlayback",new Set);xi([A(Cs)],Wa.prototype,"animator",void 0);xi([A()],Wa.prototype,"stateName",void 0);class Vm extends re{constructor(){super(...arguments);c(this,"target")}getType(){}getDuration(){}}xi([A(ne)],Vm.prototype,"target",void 0);class $0 extends re{constructor(){super(...arguments);c(this,"target")}}xi([A(Vm)],$0.prototype,"target",void 0);class eb extends Vm{constructor(){super(...arguments);c(this,"type",vg.Hide);c(this,"duration",1)}getType(){switch(this.type){case vg.Hide:return"hide";case vg.Show:return"show"}}getDuration(){return this.duration}}xi([A()],eb.prototype,"type",void 0);xi([A()],eb.prototype,"duration",void 0);class y2 extends $0{}var vg;(function(n){n[n.Show=0]="Show",n[n.Hide=1]="Hide"})(vg||(vg={}));var fc=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const IR=z("debugcharactercontroller");class qf extends re{constructor(){super(...arguments);c(this,"center",new w(0,0,0));c(this,"radius",.5);c(this,"height",2);c(this,"_rigidbody",null);c(this,"_activeGroundCollisions");c(this,"_contactVelocity",new w)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(It),this._rigidbody||(this._rigidbody=this.gameObject.addNewComponent(It)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const e=this.rigidbody;let i=this.gameObject.getComponent(fh);i||(i=this.gameObject.addNewComponent(fh)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const s=new w(0,0,1),r=new w(1,0,0),o=new w(0,1,0),a=this.gameObject.getWorldDirection(new w);a.y=0;const l=r.dot(a)<0?-1:1,h=s.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,h),e.lockRotationX=!0,e.lockRotationY=!0,e.lockRotationZ=!0}move(e){this.gameObject.position.add(e)}onCollisionEnter(e){(e.contacts.length==0||e.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(e),IR&&console.log(`Collision(${this._activeGroundCollisions.size}): ${e.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(e){this._activeGroundCollisions.delete(e),IR&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var e;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const s=(e=this.context.physics.engine)==null?void 0:e.getLinearVelocity(i.collider);s&&(this._contactVelocity.x+=s.x,this._contactVelocity.y+=s.y,this._contactVelocity.z+=s.z)}return this._contactVelocity}}fc([A(w)],qf.prototype,"center",void 0);fc([A()],qf.prototype,"radius",void 0);fc([A()],qf.prototype,"height",void 0);class Ch extends re{constructor(){super(...arguments);c(this,"controller");c(this,"movementSpeed",2);c(this,"rotationSpeed",2);c(this,"jumpForce",1);c(this,"doubleJumpForce",2);c(this,"animator");c(this,"lookForward",!0);c(this,"lookInput",new oe(0,0));c(this,"moveInput",new oe(0,0));c(this,"jumpInput",!1);c(this,"_currentSpeed",new w(0,0,0));c(this,"_currentAngularSpeed",new w(0,0,0));c(this,"_temp",new w(0,0,0));c(this,"_jumpCount",0);c(this,"_currentRotation");c(this,"_raycastOptions",new rc)}awake(){this._currentRotation=new ie}update(){const e=this.context.input;e.isKeyPressed("KeyW")?this.moveInput.y+=1:e.isKeyPressed("KeyS")&&(this.moveInput.y-=1),e.isKeyPressed("KeyD")?this.lookInput.x+=1:e.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=e.isKeyDown("Space"))}move(e){this.moveInput.add(e)}look(e){this.lookInput.add(e)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(e,i,s){var r,o,a,l,h,u,d,f,p,g,m;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=e.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",e.length()>.01),(h=this.animator)==null||h.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&s),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=ye.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const v=this.context.mainCameraComponent.forward;v.y=0,v.normalize(),this._currentRotation.setFromUnitVectors(new w(0,0,1),v),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&s&&this.jumpForce>0){let v=(u=this.controller)==null?void 0:u.isGrounded;if(this.doubleJumpForce>0&&!((d=this.controller)!=null&&d.isGrounded)&&this._jumpCount===1&&(v=!0,(f=this.animator)==null||f.setBool("doubleJump",!0)),v){this._jumpCount+=1;const y=this.controller.rigidbody,b=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;y.applyImpulse(new w(0,1,0).multiplyScalar(b))}}if(this.controller){const v=(p=this.controller)==null?void 0:p.rigidbody.getVelocity().y;if(v<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new mh),this._raycastOptions.ray.origin.copy(He(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const y=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const b=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(y),(b.length&&b[0].distance>2||v<-10)&&((g=this.animator)==null||g.setBool("falling",!0))}else(m=this.animator)==null||m.setBool("falling",!1)}}}fc([A(qf)],Ch.prototype,"controller",void 0);fc([A()],Ch.prototype,"movementSpeed",void 0);fc([A()],Ch.prototype,"rotationSpeed",void 0);fc([A()],Ch.prototype,"jumpForce",void 0);fc([A()],Ch.prototype,"doubleJumpForce",void 0);fc([A(Cs)],Ch.prototype,"animator",void 0);var $9=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class tb extends ns{constructor(){super(...arguments);c(this,"intensity",new me(0))}get typeName(){return"ChromaticAberration"}onCreateEffect(){const e=new ck;return e.offset=new oe(0,0),e.radialModulation=!0,e.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{e.offset.x=-i,e.offset.y=i},e}}$9([A(me)],tb.prototype,"intensity",void 0);ra("ChromaticAberration",tb);var b2=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const TR=z("debugpost");var vs;(function(n){n[n.None=0]="None",n[n.Neutral=1]="Neutral",n[n.ACES=2]="ACES",n[n.AgX=3]="AgX",n[n.KhronosNeutral=4]="KhronosNeutral"})(vs||(vs={}));function ew(n){switch(n){case vs.None:return h0;case vs.Neutral:return LC;case vs.ACES:return OC;case vs.AgX:return c0;case vs.KhronosNeutral:return Qg;default:return Qg}}function eW(n){switch(n){case h0:return vs.None;case OC:return vs.ACES;case c0:return vs.AgX;case Qg:return vs.Neutral;case LC:return vs.Neutral;default:return vs.None}}function RR(n){switch(n){case h0:return an.LINEAR;case OC:return an.ACES_FILMIC;case c0:return an.AGX;case Qg:return an.NEUTRAL;case LC:return an.REINHARD;default:return an.LINEAR}}class ac extends ns{constructor(){super(...arguments);c(this,"mode",new me(void 0));c(this,"exposure",new me(1))}get typeName(){return"ToneMapping"}setMode(e){const i=vs[e];return i===void 0?(console.error("Invalid ToneMapping mode",e),this):(this.mode.value=i,this)}get isToneMapping(){return!0}onEffectEnabled(){const e=i2(this);e&&super.onEffectEnabled(e)}onCreateEffect(){if(this.postprocessingContext)for(const s of this.postprocessingContext.components){if(s===this)break;if(s!=this&&s instanceof ac){console.warn("Multiple tonemapping effects found in the same postprocessing stack: Please check your scene setup.",{activeEffect:s,ignoredEffect:this});return}}if(this.mode.isInitialized==!1){const s=eW(this.context.renderer.toneMapping);this.mode.initialize(s)}const e=ew(this.mode.value),i=new ny({mode:RR(e)});return this.mode.onValueChanged=s=>{const r=ew(s);i.mode=RR(r),TR&&console.log("ToneMapping mode changed to",vs[s],r,i.mode)},TR&&console.log("Use ToneMapping",vs[this.mode.value],e,i.mode,"renderer.tonemapping: "+this.context.renderer.toneMapping),this.exposure.onValueChanged=s=>{this.context.renderer.toneMappingExposure=s},i}onBeforeRender(){this.mode.overrideState&&(this.context.renderer.toneMapping=ew(this.mode.value)),this.exposure.overrideState&&(this.context.renderer.toneMappingExposure=this.exposure.value)}}b2([A(me)],ac.prototype,"mode",void 0);b2([A(me)],ac.prototype,"exposure",void 0);ra("Tonemapping",ac);var ib=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Wu extends ns{constructor(){super(...arguments);c(this,"postExposure",new me(0));c(this,"contrast",new me(0));c(this,"hueShift",new me(0));c(this,"saturation",new me(0))}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=e=>(e=Math.pow(2,e),e),this.contrast.valueProcessor=e=>{let i=1;return e>0?i=200:e<0&&(i=100),e/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=e=>Math.PI*e/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=e=>e<0?e/100:e/(100*Math.PI),this.saturation.defaultValue=0}onCreateEffect(){var o,a;const e=[];this.context.renderer.toneMapping!==Cf&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=Cf);let i=(o=this.postprocessingContext)==null?void 0:o.components.find(l=>l instanceof ac);i||(i=new ac,(a=this.postprocessingContext)==null||a.components.push(i)),this.postExposure.onValueChanged=l=>{this.postExposure.overrideState&&(i.exposure.value=l)};const s=new lk;this.contrast.onValueChanged=l=>s.contrast=l;const r=new fk;return e.push(s),e.push(r),this.hueShift.onValueChanged=l=>r.hue=l,this.saturation.onValueChanged=l=>r.saturation=l,e}}ib([A(me)],Wu.prototype,"postExposure",void 0);ib([A(me)],Wu.prototype,"contrast",void 0);ib([A(me)],Wu.prototype,"hueShift",void 0);ib([A(me)],Wu.prototype,"saturation",void 0);ra("ColorAdjustments",Wu);const _2=Math.sqrt(5),tW=(_2-1)/4,Ln=(5-_2)/20,XA=n=>Math.floor(n)|0,YA=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function iW(n=Math.random){const t=nW(n),e=new Float64Array(t).map(o=>YA[o%32*4]),i=new Float64Array(t).map(o=>YA[o%32*4+1]),s=new Float64Array(t).map(o=>YA[o%32*4+2]),r=new Float64Array(t).map(o=>YA[o%32*4+3]);return function(a,l,h,u){let d,f,p,g,m;const v=(a+l+h+u)*tW,y=XA(a+v),b=XA(l+v),_=XA(h+v),x=XA(u+v),S=(y+b+_+x)*Ln,E=y-S,M=b-S,I=_-S,B=x-S,R=a-E,P=l-M,F=h-I,j=u-B;let V=0,X=0,k=0,O=0;R>P?V++:X++,R>F?V++:k++,R>j?V++:O++,P>F?X++:k++,P>j?X++:O++,F>j?k++:O++;const H=V>=3?1:0,ee=X>=3?1:0,Y=k>=3?1:0,he=O>=3?1:0,ue=V>=2?1:0,_e=X>=2?1:0,Se=k>=2?1:0,qe=O>=2?1:0,Pe=V>=1?1:0,Ye=X>=1?1:0,Pt=k>=1?1:0,Tt=O>=1?1:0,ci=R-H+Ln,Ei=P-ee+Ln,Bs=F-Y+Ln,Vr=j-he+Ln,ss=R-ue+2*Ln,Ar=P-_e+2*Ln,Wr=F-Se+2*Ln,qr=j-qe+2*Ln,To=R-Pe+3*Ln,Ro=P-Ye+3*Ln,Xr=F-Pt+3*Ln,vr=j-Tt+3*Ln,kn=R-1+4*Ln,$s=P-1+4*Ln,yr=F-1+4*Ln,rs=j-1+4*Ln,Ps=y&255,Ms=b&255,Dn=_&255,Ji=x&255;let os=.6-R*R-P*P-F*F-j*j;if(os<0)d=0;else{const yt=Ps+t[Ms+t[Dn+t[Ji]]];os*=os,d=os*os*(e[yt]*R+i[yt]*P+s[yt]*F+r[yt]*j)}let er=.6-ci*ci-Ei*Ei-Bs*Bs-Vr*Vr;if(er<0)f=0;else{const yt=Ps+H+t[Ms+ee+t[Dn+Y+t[Ji+he]]];er*=er,f=er*er*(e[yt]*ci+i[yt]*Ei+s[yt]*Bs+r[yt]*Vr)}let as=.6-ss*ss-Ar*Ar-Wr*Wr-qr*qr;if(as<0)p=0;else{const yt=Ps+ue+t[Ms+_e+t[Dn+Se+t[Ji+qe]]];as*=as,p=as*as*(e[yt]*ss+i[yt]*Ar+s[yt]*Wr+r[yt]*qr)}let dn=.6-To*To-Ro*Ro-Xr*Xr-vr*vr;if(dn<0)g=0;else{const yt=Ps+Pe+t[Ms+Ye+t[Dn+Pt+t[Ji+Tt]]];dn*=dn,g=dn*dn*(e[yt]*To+i[yt]*Ro+s[yt]*Xr+r[yt]*vr)}let zt=.6-kn*kn-$s*$s-yr*yr-rs*rs;if(zt<0)m=0;else{const yt=Ps+1+t[Ms+1+t[Dn+1+t[Ji+1]]];zt*=zt,m=zt*zt*(e[yt]*kn+i[yt]*$s+s[yt]*yr+r[yt]*rs)}return 27*(d+f+p+g+m)}}function nW(n){const e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){const s=i+~~(n()*(256-i)),r=e[i];e[i]=e[s],e[s]=r}for(let i=256;i<512;i++)e[i]=e[i-256];return e}const tw=z("debugstencil");function sW(n,t){return(n&1<<t.layer)!=0}const rW=Symbol("stencils"),tu=class{constructor(t,e){c(this,"parser");c(this,"source");this.parser=t,this.source=e}get name(){return"NEEDLE_render_objects"}static applyStencil(t){if(!t)return;const e=t.sourceId;if(tw&&console.log(e,tu.stencils),!e)return;const i=tu.stencils[e];if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];if(sW(r.layer,t)){tw&&console.log(r),setTimeout(()=>{fr()&&QS(t.gameObject)&&(qt("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",t))},500);for(let o=0;o<t.sharedMaterials.length;o++){let a=t.sharedMaterials[o];a&&(a=a.clone(),a[rW]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,t.sharedMaterials[o]=a)}t.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(t){const e=this.parser.json.extensions;if(e){const i=e[aW];if(i){tw&&console.log(i);const s=i.stencil;if(s&&Array.isArray(s))for(const r of s){const o={...r};o.compareFunc=oW(o.compareFunc),o.passOp=iw(o.passOp),o.failOp=iw(o.failOp),o.zFailOp=iw(o.zFailOp),tu.stencils[this.source]||(tu.stencils[this.source]=[]),tu.stencils[this.source].push(o)}}}return null}};let yg=tu;c(yg,"stencils",{});var ba;(function(n){n[n.Keep=0]="Keep",n[n.Zero=1]="Zero",n[n.Replace=2]="Replace",n[n.IncrementSaturate=3]="IncrementSaturate",n[n.DecrementSaturate=4]="DecrementSaturate",n[n.Invert=5]="Invert",n[n.IncrementWrap=6]="IncrementWrap",n[n.DecrementWrap=7]="DecrementWrap"})(ba||(ba={}));var _a;(function(n){n[n.Disabled=0]="Disabled",n[n.Never=1]="Never",n[n.Less=2]="Less",n[n.Equal=3]="Equal",n[n.LessEqual=4]="LessEqual",n[n.Greater=5]="Greater",n[n.NotEqual=6]="NotEqual",n[n.GreaterEqual=7]="GreaterEqual",n[n.Always=8]="Always"})(_a||(_a={}));function iw(n){switch(n){case ba.Keep:return zF;case ba.Zero:return NF;case ba.Replace:return UF;case ba.IncrementSaturate:return FF;case ba.DecrementSaturate:return LF;case ba.IncrementWrap:return OF;case ba.DecrementWrap:return DF;case ba.Invert:return kF}return 0}function oW(n){switch(n){case _a.Never:return b1;case _a.Less:return qF;case _a.Equal:return WF;case _a.LessEqual:return VF;case _a.Greater:return HF;case _a.NotEqual:return GF;case _a.GreaterEqual:return jF;case _a.Always:return QF}return b1}const aW="NEEDLE_render_objects";var w2=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Tp=z("debugreflectionprobe"),BR=z("noreflectionprobe"),lW=Symbol("reflectionProbeKey"),cW=Symbol("original material"),Ea=class extends re{constructor(){var e;super();c(this,"_texture");c(this,"center");c(this,"size");c(this,"_boxHelper");Ea._probes.has(this.context)||Ea._probes.set(this.context,[]),(e=Ea._probes.get(this.context))==null||e.push(this)}static get(e,i,s,r){if(!e||e.isObject3D!==!0||BR)return null;const o=Ea._probes.get(i);if(o){for(const a of o)if(a.__didAwake||a.__internalAwake(),a.enabled){if(r){if(a.gameObject===r)return a}else if(a.isInBox(e,void 0))return Tp&&console.log("Found reflection probe",e.name,a.name),a}}return Tp&&console.debug("Did not find reflection probe",e.name,s,e),null}set texture(e){if(e&&!(e instanceof At)){console.error("ReflectionProbe.texture must be a Texture",e);return}this._texture=e,e&&(e.mapping=Ya,e.colorSpace=Ge,e.needsUpdate=!0)}get texture(){return this._texture}isInBox(e,i){var s;return(s=this._boxHelper)==null?void 0:s.isInBox(e,i)}awake(){this._boxHelper=this.gameObject.addNewComponent(qo),this._boxHelper.updateBox(!0),Tp&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=Ya,this.texture.colorSpace=Ge,this.texture.needsUpdate=!0)}onDestroy(){const e=Ea._probes.get(this.context);if(e){const i=e.indexOf(this);i>=0&&e.splice(i,1)}}onSet(e){var s;if(BR||!this.enabled||((s=e.sharedMaterials)==null?void 0:s.length)<=0||!this.texture)return;let i=Ea._rendererMaterialsCache.get(e);i||(i=[],Ea._rendererMaterialsCache.set(e,i));for(let r=0;r<e.sharedMaterials.length;r++){const o=e.sharedMaterials[r];if(!o||o.envMap===void 0||o instanceof _t)continue;let a=i[r];const l=o===(a==null?void 0:a.copy),h=!a||a.material.uuid!==o.uuid||a.copy.version!==o.version;if(!l&&h){if(Tp){let f="";a?a.material!==o?f="reference changed; cached instance?: "+l:a.copy.version!==o.version&&(f="version changed"):f="not cached",console.warn("Cloning material",o.name,o.version,"Reason:",f,`
`,o.uuid,`
`,a==null?void 0:a.copy.uuid,`
`,e.name)}const d=o.clone();d.version=o.version,a?(a.copy=d,a.material=o):(a={material:o,copy:d},i.push(a)),d[lW]=this,d[cW]=o,Tp&&console.log("Set reflection",e.name,e.guid)}a&&a.copy&&(a.copy.onBeforeCompile=o.onBeforeCompile);const u=a==null?void 0:a.copy;u.envMap=this.texture,e.sharedMaterials[r]=u}}onUnset(e){const i=Ea._rendererMaterialsCache.get(e);if(i)for(let s=0;s<i.length;s++){const r=i[s];e.sharedMaterials[s]=r.material}}};let Wl=Ea;c(Wl,"_probes",new Map),c(Wl,"_rendererMaterialsCache",new Map);w2([A(w)],Wl.prototype,"center",void 0);w2([A(w)],Wl.prototype,"size",void 0);const nw=z("debugexr");class hW{constructor(t){c(this,"parser");this.parser=t,nw&&console.log(t)}get name(){return"EXT_texture_exr"}loadTexture(t){const e=this.name,i=this.parser,r=i.json.textures[t];if(nw&&console.log("EXT_texture_exr.loadTexture",t,r),!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=new om(i.options.manager);return nw&&console.log("EXT_texture_exr.loadTexture",o),i.loadTextureImage(t,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",n=>{});const wl=yn,KA="$___Export_Components",uW="NEEDLE_components";var ZY;class dW{constructor(){c(this,ZY)}}ZY=wd;class fW{constructor(t,e,i){c(this,"node");c(this,"nodeIndex");c(this,"nodeDef");this.node=t,this.nodeIndex=e,this.nodeDef=i}}class pW{constructor(){c(this,"parser");c(this,"nodeToObjectMap",{});c(this,"exportContext");c(this,"objectToNodeMap",{});c(this,"context");c(this,"writer")}get name(){return uW}registerExport(t){t.register(e=>{if("serializeUserData"in e){const i=e.serializeUserData.bind(e);this.writer=e,e.serializeUserData=(s,r)=>{try{this.serializeUserData(s,r),i(s,r)}finally{this.afterSerializeUserData(s,r)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(t,e){var s;const i=(s=t.userData)==null?void 0:s.components;!i||i.length<=0||(delete t.userData.components,t[KA]=i)}afterSerializeUserData(t,e){if(t.type==="Scene"&&wl&&console.log("DONE",JSON.stringify(e)),t[KA]===void 0)return;const i=t[KA];delete t[KA],i!==null&&(t.userData.components=i)}writeNode(t,e){const i=this.writer.json.nodes.length;wl&&console.log(t.name,i,t.uuid);const s=new fW(t,i,e);this.exportContext[i]=s,this.objectToNodeMap[t.uuid]=i}afterParse(t){var e;wl&&console.log("AFTER",t);for(const i in this.exportContext){const s=this.exportContext[i],r=s.node,o=s.nodeDef,a=s.nodeIndex,l=(e=r.userData)==null?void 0:e.components;if(!l||l.length<=0)continue;const h=new dW;o.extensions=o.extensions||{},o.extensions[this.name]=h,this.context.object=r,this.context.nodeId=a,this.context.objectToNode=this.objectToNodeMap;const u=[];for(const d of l){this.context.target=d;const f=nl().writeBuiltinComponentData(d,this.context);f!==null&&u.push(f)}u.length>0&&(h[wd]=u,wl&&console.log("DID WRITE",r,"nodeIndex",a,u))}}beforeRoot(){return wl&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(t){const e=t.parser,i=e==null?void 0:e.extensions;if(!i)return;const s=i[this.name];wl&&console.log("After root",t,this.parser,i);const r=[];if(s===!0){const o=e.json.nodes;if(o){for(let a=0;a<o.length;a++){const l=await e.getDependency("node",a);this.nodeToObjectMap[a]=l}for(let a=0;a<o.length;a++){const l=o[a],h=a,u=l.extensions;if(!u)continue;const d=u[this.name];if(!d)continue;wl&&console.log("NODE",l);const f=this.nodeToObjectMap[h];if(!f){console.error("Could not find object for node index: "+h,l,e);continue}zS(f),r.push(this.createComponents(f,d))}}}await Promise.all(r);for(const o of e.associations.keys()){const a=e.associations.get(o);if((a==null?void 0:a.materials)!=null){const l="/materials/"+a.materials;i6(o,l)}}}async createComponents(t,e){if(!e)return;const i=e[wd];if(i){const s=new Array;wl&&console.log(t.name,i);for(const r in i){const o=i[r];wl&&console.log("Serialized data",JSON.parse(JSON.stringify(o))),o&&this.parser&&s.push(LS(this.parser,o).catch(a=>console.error(`Error while resolving references (see console for details)
`,a,t,o))),t.userData=t.userData||{},t.userData[wd]=t.userData[wd]||[],t.userData[wd].push(o)}await Promise.all(s).catch(r=>{console.error("Error while loading components",r)})}}}const PR="NEEDLE_gameobject_data";class gW{constructor(t){c(this,"parser");this.parser=t}get name(){return PR}afterRoot(t){var i;const e=[];for(let s=0;s<((i=this.parser.json.nodes)==null?void 0:i.length);s++){const r=this.parser.json.nodes[s];if(r&&r.extensions){const o=r.extensions[PR];if(o){const a=this.findAndApplyExtensionData(s,o);e.push(a)}}}return Promise.all(e).then(()=>null)}async findAndApplyExtensionData(t,e){const i=await this.parser.getDependency("node",t);i&&this.applyExtensionData(i,e)}applyExtensionData(t,e){e.layers===void 0&&(e.layers=0),t.userData.layer=e.layers,t.layers.disableAll(),t.layers.set(e.layers),t.userData.tag=e.tag??"none",t.userData.hideFlags=e.hideFlags??0,t.userData.static=e.static??!1,t.visible=e.activeSelf??!0,t.guid=e.guid}}const MR="NEEDLE_lighting_settings",Td=z("debugenvlight");class mW{constructor(t,e,i){c(this,"parser");c(this,"sourceId");c(this,"context");this.parser=t,this.sourceId=e,this.context=i}get name(){return MR}afterRoot(t){const e=this.parser.json.extensions;if(e){const i=e[MR];if(i){Td&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',i);let s;if(t.scene.children.length===1){const r=t.scene.children[0];s=Q.addNewComponent(r,eC,{},!1)}else{const r=new ne;r.name="LightSettings "+this.sourceId,t.scene.add(r),s=Q.addNewComponent(r,eC,{},!1)}s.sourceId=this.sourceId,s.ambientIntensity=i.ambientIntensity,s.ambientLight=new be().fromArray(i.ambientLight),Array.isArray(i.ambientTrilight)&&(s.ambientTrilight=i.ambientTrilight.map(r=>new be().fromArray(r))),s.ambientMode=i.ambientMode,s.environmentReflectionSource=i.environmentReflectionSource}}return null}}xt.registerCallback(dt.ContextCreated,n=>{const t=n.context,e=Q.findObjectOfType(eC,t);e!=null&&e.sourceId&&(e.enabled=!0)});class eC extends re{constructor(){super(...arguments);c(this,"ambientMode",La.Skybox);c(this,"ambientLight");c(this,"ambientTrilight");c(this,"ambientIntensity",1);c(this,"environmentReflectionSource",am.Skybox);c(this,"_hasReflection",!1);c(this,"_ambientLightObj");c(this,"_hemisphereLightObj")}awake(){var i;if(this.sourceId){const s=this.environmentReflectionSource===am.Skybox?Gl.Skybox:Gl.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,s,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),Td&&window.addEventListener("keydown",s=>{if(!this.destroyed)switch(s.key){case"l":this.enabled=!this.enabled;break}});const e=(i=this.gameObject.userData)==null?void 0:i.components;if(e){const s=e.indexOf(this);e.splice(s,1),e.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(e){const i=Math.max(e.r,e.g,e.b);return 2.2*ye.lerp(0,1.33,i)}onEnable(){if(Td&&console.warn("ðŸ’¡ðŸŸ¡ >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==La.Flat){if(this.ambientLight&&!this._ambientLightObj){const e=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new UP(this.ambientLight,this.ambientIntensity*e),Td&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,e)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===La.Trilight){if(this.ambientTrilight){const e=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],s=this.calculateIntensityFactor(i);this._hemisphereLightObj=new XF(i,e,this.ambientIntensity*s),this.gameObject.add(this._hemisphereLightObj),Td&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,s)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){Td&&console.warn("ðŸ’¡âš« <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var kR;(function(n){n[n.Fragment=35632]="Fragment",n[n.Vertex=35633]="Vertex"})(kR||(kR={}));var tC;(function(n){n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN"})(tC||(tC={}));const wa=z("debugcustomshader"),pd="NEEDLE_techniques_webgl";var DR;(function(n){n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN"})(DR||(DR={}));class AW{constructor(){c(this,"objectToWorldMatrix",new ae);c(this,"worldToObjectMatrix",new ae);c(this,"objectToWorld",new Array);c(this,"worldToObject",new Array)}updateFrom(t){this.objectToWorldMatrix.copy(t.matrixWorld),gy(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(t.matrixWorld).invert(),gy(this.worldToObjectMatrix,this.worldToObject)}}var bg;(function(n){n[n.Off=0]="Off",n[n.Front=1]="Front",n[n.Back=2]="Back"})(bg||(bg={}));var Il;(function(n){n[n.Never=1]="Never",n[n.Less=2]="Less",n[n.Equal=3]="Equal",n[n.LEqual=4]="LEqual",n[n.Greater=5]="Greater",n[n.NotEqual=6]="NotEqual",n[n.GEqual=7]="GEqual",n[n.Always=8]="Always"})(Il||(Il={}));const di=class extends zP{constructor(e,...i){super(...i);c(this,"identifier");c(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));c(this,"_sphericalHarmonicsName","unity_SpecCube0");c(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");c(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");c(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");c(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");c(this,"_rendererData",new AW);this.identifier=e,wa&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&je.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const e=super.clone();return x2(e),e}dispose(){super.dispose();const e=je.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);e>=0&&je.Current.pre_render_callbacks.splice(e,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&je.Current.setRequireColor(!0),this.depthTextureUniform&&je.Current.setRequireDepth(!0)}onBeforeRender(e,i,s,r,o,a){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(s,o)}onUpdateUniforms(e,i){const s=je.Current;if(e&&(di.viewProjection&&this.uniforms[this._viewProjectionName]&&(di.viewProjection.copy(e.projectionMatrix).multiply(e.matrixWorldInverse),gy(di.viewProjection,di._viewProjectionValues)),di.viewMatrix&&this.uniforms[this._viewMatrixName]&&(di.viewMatrix.copy(e.matrixWorldInverse),gy(di.viewMatrix,di._viewMatrixValues)),this.uniforms[di._worldSpaceCameraPosName]&&di._worldSpaceCameraPos.setFromMatrixPosition(e.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=s.sceneLighting.timeVec4),this.uniforms._Time){const l=this.uniforms._Time.value;l.x=s.sceneLighting.timeVec4.x/20,l.y=s.sceneLighting.timeVec4.x,l.z=s.sceneLighting.timeVec4.x*2,l.w=s.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const l=this.uniforms._SinTime.value;l.x=Math.sin(s.sceneLighting.timeVec4.x/8),l.y=Math.sin(s.sceneLighting.timeVec4.x/4),l.z=Math.sin(s.sceneLighting.timeVec4.x/2),l.w=Math.sin(s.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const l=this.uniforms._CosTime.value;l.x=Math.cos(s.sceneLighting.timeVec4.x/8),l.y=Math.cos(s.sceneLighting.timeVec4.x/4),l.z=Math.cos(s.sceneLighting.timeVec4.x/2),l.w=Math.cos(s.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const l=this.uniforms.unity_DeltaTime.value;l.x=s.time.deltaTime,l.y=1/s.time.deltaTime,l.z=s.time.smoothedDeltaTime,l.w=1/s.time.smoothedDeltaTime}const r=s.mainLight;if(r){const l=He(r.gameObject,di._mainLightPosition);this.uniforms._MainLightPosition={value:l.normalize()},di._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:di._mainLightColor};const h=r.intensity;di._lightData.z=h,this.uniforms.unity_LightData={value:di._lightData}}if(e&&(di.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=di._viewProjectionValues),di.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=di._viewMatrixValues),this.uniforms[di._worldSpaceCameraPosName]&&(this.uniforms[di._worldSpaceCameraPosName]={value:di._worldSpaceCameraPos}),s.mainCameraComponent)){if(this.uniforms._ProjectionParams){const l=this.uniforms._ProjectionParams.value;l.x=1,l.y=s.mainCameraComponent.nearClipPlane,l.z=s.mainCameraComponent.farClipPlane,l.w=1/l.z,this.uniforms._ProjectionParams.value=l}if(this.uniforms._ZBufferParams){const l=this.uniforms._ZBufferParams.value,h=s.mainCameraComponent;l.x=1-h.farClipPlane/h.nearClipPlane,l.y=h.farClipPlane/h.nearClipPlane,l.z=l.x/h.farClipPlane,l.w=l.y/h.farClipPlane,this.uniforms._ZBufferParams.value=l}if(this.uniforms._ScreenParams){const l=this.uniforms._ScreenParams.value;l.x=s.domWidth,l.y=s.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScreenParams.value=l}if(this.uniforms._ScaledScreenParams){const l=this.uniforms._ScaledScreenParams.value;l.x=s.domWidth,l.y=s.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScaledScreenParams.value=l}}const o=this.depthTextureUniform;o&&(o.value=s.depthTexture);const a=this.opaqueTextureUniform;if(a&&(a.value=s.opaqueColorTexture),i){const l=this._rendererData;l.updateFrom(i),this.uniforms[this._worldToObjectName].value=l.worldToObject,this.uniforms[this._objToWorldName].value=l.objectToWorld}this.uniformsNeedUpdate=!0}};let eo=di;c(eo,"viewProjection",new ae),c(eo,"_viewProjectionValues",[]),c(eo,"viewMatrix",new ae),c(eo,"_viewMatrixValues",[]),c(eo,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),c(eo,"_worldSpaceCameraPos",new w),c(eo,"_mainLightColor",new Fe),c(eo,"_mainLightPosition",new w),c(eo,"_lightData",new Fe);class vW{constructor(t,e){c(this,"parser");c(this,"identifier");this.parser=t,this.identifier=e}get name(){return pd}loadMaterial(t){const e=this.parser.json.materials[t];if(!e)return wa&&console.log(t,this.parser.json.materials),null;if(!e.extensions||!e.extensions[pd])return wa&&console.log(`Material ${t} does not use NEEDLE_techniques_webgl`),null;wa&&console.log(`Material ${t} uses NEEDLE_techniques_webgl`,e);const i=e.extensions[pd].technique;if(i<0)return console.debug(`Material ${t} does not have a valid technique index`),null;const s=this.parser.json.extensions[pd];if(!s)return wa?console.error("Missing shader data",this.parser.json.extensions):console.debug("Missing custom shader data in parser.json.extensions"),null;wa&&console.log(s);const r=s.techniques[i];return r?new Promise(async(o,a)=>{var y,b,_;const l=await SH(s,r.program),h=l==null?void 0:l.fragmentShader,u=l==null?void 0:l.vertexShader;if(!h||!u)return a();wa&&console.log("loadMaterial",e,l);const d={},f=r.uniforms;(u.includes("_Time")||h.includes("_Time"))&&(d._Time={value:new Fe(0,0,0,0)}),(u.includes("_SinTime")||h.includes("_SinTime"))&&(d._SinTime={value:new Fe(0,0,0,0)}),(u.includes("_CosTime")||h.includes("_CosTime"))&&(d._CosTime={value:new Fe(0,0,0,0)}),(u.includes("unity_DeltaTime")||h.includes("unity_DeltaTime"))&&(d.unity_DeltaTime={value:new Fe(0,0,0,0)});for(const x in f){const S=x;switch(S){case"_TimeParameters":const E=new Fe;d[S]={value:E};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":d[S]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":d[S]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":d[S]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":d[S]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":d[S]={value:null};break}}let p=!1;if(e.extensions&&e.extensions[pd]){const x=e.extensions[pd];if(x.technique===i){wa&&console.log(e.name,"Material Properties",x);for(const S in x.values){const E=x.values[S];if(typeof E=="string"){if(E.startsWith("/textures/")){const M=E.substring(10),I=Number.parseInt(M);if(I>=0){const B=await this.parser.getDependency("texture",I);B instanceof At&&(B.colorSpace=Ni,B.needsUpdate=!0),d[S]={value:B};continue}}switch(S){case"alphaMode":E==="BLEND"&&(p=!0);continue}}if(Array.isArray(E)&&E.length===4){d[S]={value:new Fe(E[0],E[1],E[2],E[3])};continue}d[S]={value:E}}}}const g=new eo(this.identifier,{name:e.name??"",uniforms:d,vertexShader:u,fragmentShader:h,lights:!1});switch(g.glslVersion=YF,g.vertexShader=g.vertexShader.replace("#version 300 es",""),g.fragmentShader=g.fragmentShader.replace("#version 300 es",""),(y=d._Cull)==null?void 0:y.value){case bg.Off:g.side=_i;break;case bg.Front:g.side=Wc;break;case bg.Back:g.side=il;break;default:g.side=il;break}switch((b=d._ZTest)==null?void 0:b.value){case Il.Equal:g.depthTest=!0,g.depthFunc=Vv;break;case Il.NotEqual:g.depthTest=!0,g.depthFunc=BC;break;case Il.Less:g.depthTest=!0,g.depthFunc=Lw;break;case Il.LEqual:g.depthTest=!0,g.depthFunc=EP;break;case Il.Greater:g.depthTest=!0,g.depthFunc=CP;break;case Il.GEqual:g.depthTest=!0,g.depthFunc=SP;break;case Il.Always:g.depthTest=!1,g.depthFunc=IP;break}g.transparent=p,p&&(g.depthWrite=!1),xH(d),g.onUpdateUniforms();for(const x in f){const S=x,E=f[x].type;if(((_=d[S])==null?void 0:_.value)===void 0)switch(E){case tC.SAMPLER_2D:d[S]={value:_H},console.warn("Missing/unassigned texture, fallback to white: "+S);break;default:S==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+S,f[x]);break}}wa&&console.log(g.uuid,d),x2(g),o(g)}):null}}function x2(n){if(n.uniforms){wa&&console.log("Uniforms:",n.uniforms);for(const e in n.uniforms)switch(t(e,e),e){case"_Color":t("color",e);break}}function t(e,i){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{get:()=>n.uniforms[i].value,set:s=>{n.uniforms[i].value=s,n.needsUpdate=!0}})}}const yW=z("debugextensions");let Ey;const bW=hh(()=>import("./GLTFLoaderAnimationPointer-6433c7fb.js"),["./GLTFLoaderAnimationPointer-6433c7fb.js","./three.module-19edce0d.js"],import.meta.url).then(async n=>(Ey=n.GLTFAnimationPointerExtension,Ey)).catch(n=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",n)}),Tu=new Array;function vJ(n){Tu.includes(n)||Tu.push(n)}function yJ(n){const t=Tu.indexOf(n);t>=0&&Tu.splice(t,1)}function C2(n){const t=new pW;return n.register(e=>(t.parser=e,t)),t}class _W{resolvePath(t){return t.includes("/extensions/builtin_components/")?t.replace("/extensions/builtin_components/","/userData/components/"):t.includes("extensions/builtin_components/")?t.replace("extensions/builtin_components/","/userData/components/"):t}}async function S2(n,t,e){const i=e.indexOf("?");i>=0&&(e=e.substring(0,i)),n.register(s=>new gW(s)),n.register(s=>new s6(s)),n.register(s=>new gH(s,t.lightmaps,e)),n.register(s=>new mW(s,e,t)),n.register(s=>new vW(s,e)),n.register(s=>new yg(s,e)),n.register(s=>new ht(s,e)),n.register(s=>new hW(s)),x5()&&n.register(s=>new cg(s)),await bW.catch(s=>{}),n.register(s=>{if(Ey){const r=new Ey(s);return r.setAnimationPointerResolver.bind(r)(new _W),r}else return(yW||ve())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const s of Tu)s.onImport&&s.onImport(n,e,t)}function E2(n,t){for(const e of Tu)e.onExport&&e.onExport(n,t)}function I2(n,t,e){for(const i of Tu)i.onLoaded&&i.onLoaded(n,t,e)}const No=z("debuginstancing"),l1=class{constructor(){c(this,"objs",[])}setup(t,e,i,s,r,o=0){t.applySettings(e);const a=this.tryCreateOrAddInstance(e,i,r);if(a){s===null&&(s=[]),s.push(a),ht.assignTextureLOD(a.renderer.material,0);for(const l of t.sharedMeshes){const h=l.geometry;ht.assignMeshLOD(l,0).then(u=>{u&&t.activeAndEnabled&&h!=u&&a.setGeometry(u)})}}else if(o<=0&&e.type!=="Mesh"){const l=o+1;for(const h of e.children)s=this.setup(t,h,i,s,r,l)}return o===0&&r.useMatrixWorldAutoUpdate&&s&&s.length>=0&&this.autoUpdateInstanceMatrix(e),s}tryCreateOrAddInstance(t,e,i){if(t.type==="Mesh"){const s=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing)return null;if(i.rend.enableInstancing!==!0){if(s>=i.rend.enableInstancing.length)return No&&console.error("Something is wrong with instance setup",t,i.rend.enableInstancing,s),null;if(!i.rend.enableInstancing[s])return null}const r=t,o=r.material;for(const d of this.objs){if(!d.canAdd(r.geometry,o))continue;return d.addInstance(r)}const a=16;let l=t.name;l!=null&&l.length||(l=uU());const h=new T2(l,r.geometry,o,a,e);return this.objs.push(h),h.addInstance(r)}return null}autoUpdateInstanceMatrix(t){const e=t.matrixWorld.multiplyMatrices.bind(t.matrixWorld),i=t.matrixWorld.clone(),s=(r,o)=>{const a=e(r,o);return(t[nm]||i.equals(a)===!1)&&(i.copy(a),t[nm]=!0),a};t.matrixWorld.multiplyMatrices=s}};let pf=l1;c(pf,"instance",new l1);const Lg=class{constructor(t,e){c(this,"object");c(this,"renderer");c(this,"__instanceIndex",-1);c(this,"__reservedVertexRange",0);c(this,"__reservedIndexRange",0);c(this,"meshInformation");this.__instanceIndex=-1,this.object=t,this.renderer=e,t[XD]=e,this.meshInformation=Rd(t.geometry),Lg.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(t=!1,e=!0){this.__instanceIndex<0||(e&&this.object.updateWorldMatrix(!0,t),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(t){this.__instanceIndex<0||this.renderer.updateInstance(t,this.__instanceIndex)}setGeometry(t){return this.__instanceIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved vertex range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved index range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(t,this.__instanceIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),Q.markAsInstancedRendered(this.object,!0))}remove(t){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,t),Q.markAsInstancedRendered(this.object,!1),t)){const e=Lg.all.indexOf(this);e>=0&&Lg.all.splice(e,1)}}};let gf=Lg;c(gf,"all",[]);class T2{constructor(t,e,i,s,r){c(this,"allowResize",!0);c(this,"name","");c(this,"geometry");c(this,"material");c(this,"_context");c(this,"_batchedMesh");c(this,"_handles",[]);c(this,"_maxInstanceCount");c(this,"_currentInstanceCount",0);c(this,"_currentVertexCount",0);c(this,"_currentIndexCount",0);c(this,"_maxVertexCount");c(this,"_maxIndexCount");c(this,"_needUpdateBounds",!1);c(this,"_debugMaterial",null);c(this,"onBeforeRender",()=>{this._batchedMesh.layers.enableAll(),this._needUpdateBounds&&this._batchedMesh[Hp]===!0&&(No&&console.log("Update instancing bounds",this.name,this._batchedMesh.matrixWorldNeedsUpdate),this.updateBounds())});c(this,"onAfterRender",()=>{this._batchedMesh.layers.disableAll()});c(this,"_availableBuckets",new Array);c(this,"_usedBuckets",new Array);this.name=t,this.geometry=e,this.material=i,this._context=r,this._maxInstanceCount=Math.max(2,s),No&&(this._debugMaterial=OR());const o=this.tryEstimateVertexCountSize(this._maxInstanceCount,[e],s);this._maxVertexCount=o.vertexCount,this._maxIndexCount=o.indexCount,this._batchedMesh=new _1(this._maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this._batchedMesh[Hp]=!0,this._batchedMesh.visible=!0,this._context.scene.add(this._batchedMesh),i instanceof zP&&(i.defines.USE_INSTANCING=!0,i.needsUpdate=!0),r.pre_render_callbacks.push(this.onBeforeRender),r.post_render_callbacks.push(this.onAfterRender),No&&console.log(`Instanced renderer created with ${this._maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${t}"`)}get batchedMesh(){return this._batchedMesh}get visible(){return this._batchedMesh.visible}set visible(t){this._batchedMesh.visible=t}get castShadow(){return this._batchedMesh.castShadow}set castShadow(t){this._batchedMesh.castShadow=t}set receiveShadow(t){this._batchedMesh.receiveShadow=t}get count(){return this._currentInstanceCount}updateBounds(t=!0,e=!0){this._needUpdateBounds=!1,t&&this._batchedMesh.computeBoundingBox(),e&&this._batchedMesh.computeBoundingSphere()}canAdd(t,e){return this._maxVertexCount>1e7||e!==this.material?!1:!!(!this.mustGrow(t)||this.allowResize)}dispose(){No&&console.warn("Dispose instanced renderer",this.name),this._context.scene.remove(this._batchedMesh),this._batchedMesh.dispose(),this._batchedMesh=null,this._handles=[]}addInstance(t){const e=new gf(t,this);t.castShadow===!0&&this._batchedMesh.castShadow===!1&&(this._batchedMesh.castShadow=!0),t.receiveShadow===!0&&this._batchedMesh.receiveShadow===!1&&(this._batchedMesh.receiveShadow=!0);try{this.add(e)}catch(i){return console.error(`Failed adding mesh to instancing
`,i),ve()&&pS("Failed instancing mesh. See the browser console for details."),null}return e}add(t){const e=t.object.geometry;if(!this.validateGeometry(e))return No?console.error("Cannot add instance, invalid geometry",this.name,e):console.warn("Cannot add instance, invalid geometry: "+t.name),!1;if(this.mustGrow(e))if(this.allowResize)this.grow(e);else return console.error("Cannot add instance, max count reached",this.name,this.count,this._maxInstanceCount),!1;return t.object.updateWorldMatrix(!0,!0),this.addGeometry(t),this._handles[t.__instanceIndex]=t,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this._batchedMesh.visible=!0),!0}remove(t,e){t&&(t.__instanceIndex<0||this._handles[t.__instanceIndex]!=t||this._currentInstanceCount<=0||(this.removeGeometry(t,e),this._handles[t.__instanceIndex]=null,t.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this._batchedMesh.visible=!1),this.markNeedsUpdate()))}updateInstance(t,e){this._batchedMesh.setMatrixAt(e,t),this.markNeedsUpdate()}updateGeometry(t,e){return this.validateGeometry(t)?(this.mustGrow()&&this.grow(t),No&&console.debug("UPDATE MESH",e,t.name,Rd(t),t.attributes.position.count,t.index?t.index.count:0),this._batchedMesh.setGeometryAt(e,t),this.markNeedsUpdate(),!0):!1}validateGeometry(t){const e=this.geometry;for(const i in e.attributes)if(i!=="batchId"&&!t.hasAttribute(i))return console.warn(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`),!1;return!0}markNeedsUpdate(){this._needUpdateBounds=!0}mustGrow(t){if(this.count>=this._maxInstanceCount)return!0;if(!t)return!1;const e=Rd(t),i=e.vertexCount,s=e.indexCount;return this._currentVertexCount+i>this._maxVertexCount||this._currentIndexCount+s>this._maxIndexCount}grow(t){const e=this._maxInstanceCount*2,i=this.tryEstimateVertexCountSize(e,[t]),s=Math.max(this._maxVertexCount,i.vertexCount),r=Math.max(this._maxIndexCount,i.indexCount,this._maxVertexCount*2);if(No){const a=Rd(t);console.warn(`Growing batched mesh for "${this.name}/${t.name}" ${a.vertexCount} vertices, ${a.indexCount} indices
Max count ${this._maxInstanceCount} â†’ ${e}
Max vertex count ${this._maxVertexCount} -> ${s}
Max index count ${this._maxIndexCount} -> ${r}`),this._debugMaterial=OR()}this._maxVertexCount=s,this._maxIndexCount=r;const o=new _1(e,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);o.layers=this._batchedMesh.layers,o.castShadow=this._batchedMesh.castShadow,o.receiveShadow=this._batchedMesh.receiveShadow,o.visible=this._batchedMesh.visible,o[Hp]=this._batchedMesh[Hp],o.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,o.matrixWorldNeedsUpdate=this._batchedMesh.matrixWorldNeedsUpdate,o.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,o.matrixWorld.copy(this._batchedMesh.matrixWorld),o.matrix.copy(this._batchedMesh.matrix),this._batchedMesh.dispose(),this._batchedMesh.removeFromParent(),this._batchedMesh=o,this._maxInstanceCount=e,this._usedBuckets.length=0,this._availableBuckets.length=0;for(const a of this._handles)a&&a.__instanceIndex>=0&&this.addGeometry(a);this._context.scene.add(o)}tryEstimateVertexCountSize(t,e,i=1){const s=new Map;for(const d of this._handles)if(d&&d.__instanceIndex>=0)if(s.has(d.object.geometry)){const f=s.get(d.object.geometry);f.count+=1}else{const f={count:1,...Rd(d.object.geometry)};s.set(d.object.geometry,f)}let r=0,o=0;for(const[d,f]of s)r+=f.vertexCount*f.count,o+=f.indexCount*f.count;let l=Math.ceil(r/Math.max(1,this._currentInstanceCount))*t,u=Math.ceil(o/Math.max(1,this._currentInstanceCount))*t*2;if(e)for(const d of e){const f=Rd(d);l+=f.vertexCount*i,u+=f.indexCount*i}return{vertexCount:l,indexCount:u}}addGeometry(t){let e=null,i=-1;for(let o=this._availableBuckets.length-1;o>=0;o--){const a=this._availableBuckets[o];a.vertexCount>=t.maxVertexCount&&a.indexCount>=t.maxIndexCount&&(e==null||a.vertexCount<e.vertexCount)&&(e=a,i=o)}if(e!=null){const o=e;No&&console.debug(`RE-USE SPACE #${o.index}, ${t.maxVertexCount} vertices, ${t.maxIndexCount} indices, ${t.name}`),this._batchedMesh.setGeometryAt(o.index,t.object.geometry),this._batchedMesh.setMatrixAt(o.index,t.object.matrixWorld),this._batchedMesh.setVisibleAt(o.index,!0),t.__instanceIndex=o.index,this._usedBuckets[o.index]=o,this._availableBuckets.splice(i,1);return}const s=t.object.geometry;No&&console.debug("ADD GEOMETRY",s.name,`
vertex:`,`${this._currentVertexCount} + ${t.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,t.maxIndexCount,this._currentIndexCount,this._maxIndexCount);const r=this._batchedMesh.addGeometry(s,t.maxVertexCount,t.maxIndexCount);t.__instanceIndex=r,t.__reservedVertexRange=t.maxVertexCount,t.__reservedIndexRange=t.maxIndexCount,this._currentVertexCount+=t.maxVertexCount,this._currentIndexCount+=t.maxIndexCount,this._usedBuckets[r]={index:r,vertexCount:t.maxVertexCount,indexCount:t.maxIndexCount},this._batchedMesh.setMatrixAt(r,t.object.matrixWorld),No&&console.debug(`ADD MESH & RESERVE SPACE #${r}, ${t.maxVertexCount} vertices, ${t.maxIndexCount} indices, ${t.name} ${t.object.uuid}`)}removeGeometry(t,e){t.__instanceIndex<0||(this._usedBuckets.splice(t.__instanceIndex,1),this._batchedMesh.setVisibleAt(t.__instanceIndex,!1),this._availableBuckets.push({index:t.__instanceIndex,vertexCount:t.reservedVertexCount,indexCount:t.reservedIndexCount}))}}c(T2,"nullMatrix",new ae);function Rd(n){let t=n.attributes.position.count,e=n.index?n.index.count:0;const i=ht.getMeshLODInformation(n);if(i){const s=i.lods[0];let r=s.vertexCount,o=s.indexCount;const a=Math.min(128,Math.ceil(r*.15));r+=a,o+=20,t=Math.max(t,r),e=Math.max(e,o)}return t=Math.ceil(t),e=Math.ceil(e),{vertexCount:t,indexCount:e}}function OR(){const n=new Kn({color:new be(Math.random(),Math.random(),Math.random())});return n.emissive=n.color,n.emissiveIntensity=.3,z("wireframe")&&(n.wireframe=!0),n}const gd=z("debuglightmaps");class Iy{constructor(t,e){c(this,"lightmapIndex",-1);c(this,"lightmapScaleOffset",new Fe(1,1,0,0));c(this,"context");c(this,"gameObject");c(this,"lightmapTexture",null);c(this,"lightmapScaleOffsetUniform",{value:new Fe(1,1,0,0)});c(this,"lightmapUniform",{value:null});c(this,"onBeforeCompile",(t,e)=>{gd&&console.log(`Lightmaps, before compile
`,t),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,t.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform});this.gameObject=t,this.context=e}get lightmap(){return this.lightmapTexture}set lightmap(t){t!==this.lightmapTexture&&(this.lightmapTexture=t,this.applyLightmap(),this.lightmapTexture&&ht.assignTextureLOD(this.lightmapTexture,0).then(e=>{e!=null&&e.isTexture&&(this.lightmapTexture=e)}))}init(t,e,i){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=t,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=e,this.lightmapTexture=i,ht.assignTextureLOD(i,0).then(s=>{s!=null&&s.isTexture&&(this.lightmapTexture=s)}),gd=="show"?(console.log("Lightmap:",this.gameObject.name,t,`
ScaleOffset:`,e,`
Texture:`,i),this.setLightmapDebugMaterial()):gd&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(t){const e=t.uniforms;e&&e.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,e.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){gd&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){this.gameObject["Needle:Multimaterial-LightmapWarning"]===void 0&&(this.gameObject["Needle:Multimaterial-LightmapWarning"]=!0,console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it"));return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const t=this.gameObject;if(t.geometry.getAttribute("uv1")||t.geometry.setAttribute("uv1",t.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const e=this.gameObject.material;for(let i=0;i<e.length;i++)e[i]=this.ensureLightmapMaterial(e[i])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const e=this.gameObject.material;if(Array.isArray(e))for(const i of e)this.assignLightmapTexture(i);else e&&this.assignLightmapTexture(e)}}ensureLightmapMaterial(t){return t.userData||(t.userData={}),t["NEEDLE:lightmap-material-version"]!=t.version&&t["NEEDLE:lightmap-material-version"]==null&&(gd&&console.warn("Cloning material for lightmap "+t.name),t=t.clone(),t.onBeforeCompile=this.onBeforeCompile),t}assignLightmapTexture(t){!t||t instanceof bo&&t.transmission>0||!(t.lightMap!==this.lightmapTexture||t["NEEDLE:lightmap-material-version"]!==t.version)||(gd&&console.log("Assigning lightmap",t.name,t.version),t.lightMap=this.lightmapTexture,t["NEEDLE:lightmap-material-version"]=t.version)}setLightmapDebugMaterial(){this.gameObject.material=new $e({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var pc=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Kp=z("debugrenderer"),LR=z("debugskinnedmesh"),FR=z("noinstancing"),wW=z("wireframe");var zd;(function(n){n[n.Off=0]="Off",n[n.BlendProbes=1]="BlendProbes",n[n.BlendProbesAndSkybox=2]="BlendProbesAndSkybox",n[n.Simple=3]="Simple"})(zd||(zd={}));class R2{constructor(){c(this,"path",null);c(this,"asset",null);c(this,"default")}}var UR;(function(n){n[n.Both=0]="Both",n[n.Back=1]="Back",n[n.Front=2]="Front"})(UR||(UR={}));class xW{constructor(t,e){c(this,"_renderer");c(this,"_targets",[]);c(this,"_indexMapMaxIndex");c(this,"_indexMap");c(this,"_changed",!1);this._renderer=t;const i=this.setMaterial.bind(this),s=this.getMaterial.bind(this),r=t.gameObject;if(this._targets=[],r)switch(r.type){case"Group":this._targets=[...r.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(r);break}let o=!1,a,l=0;for(let h=0;h<this._targets.length;h++){const u=this._targets[h];if(!u)continue;const d=u.material;if(d){d.shadowSide=d.side;for(let f=0;f<e.length;f++){const p=e[f];if(!p){o=!0;continue}if(d.name===p.name){a===void 0&&(a=new Map),a.set(f,h),l=Math.max(l,f);break}}}}if(o){this._indexMapMaxIndex=l,this._indexMap=a;const h=`Renderer ${t.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(h),fr()&&qt("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(h,u){if(typeof u=="string"){const d=parseInt(u);if(!isNaN(d))return s(d)}return h[u]},set(h,u,d){return typeof u=="string"&&i(d,Number.parseInt(u)),Reflect.set(h,u,d)?(d instanceof mt&&(h.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(t){t===!0&&Kp&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=t}is(t){return this._renderer===t}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let t=0;t<this.length;t++)yield this.getMaterial(t)}resolveIndex(t){const e=this._indexMap;return e&&e.has(t)?e.get(t):t}setMaterial(t,e){if(e=this.resolveIndex(e),e<0||e>=this._targets.length)return;const i=this._targets[e];!i||i.material===void 0||(i.material=t,this.changed=!0)}getMaterial(t){if(t=this.resolveIndex(t),t<0)return null;const e=this._targets;if(t>=e.length)return null;const i=e[t];return i?i.material:null}}class li extends re{constructor(){super(...arguments);c(this,"receiveShadows",!1);c(this,"shadowCastingMode",Ty.Off);c(this,"lightmapIndex",-1);c(this,"lightmapScaleOffset",new Fe(1,1,0,0));c(this,"enableInstancing");c(this,"renderOrder");c(this,"allowOcclusionWhenDynamic",!0);c(this,"probeAnchor");c(this,"reflectionProbeUsage",zd.Off);c(this,"_lightmaps");c(this,"_sharedMeshes",[]);c(this,"_sharedMaterials");c(this,"_originalMaterials");c(this,"_probeAnchorLastFrame");c(this,"_lightmapTextureOverride");c(this,"allowProgressiveLoading",!0);c(this,"_firstFrame",-1);c(this,"_isInstancingEnabled",!1);c(this,"_handles");c(this,"_handlesTempArray",[]);c(this,"onBeforeRenderThree",(e,i,s,r,o,a)=>{var l;if(o.envMapIntensity!==void 0){const h=this.hasLightmap?Math.PI:1,u=((l=this.context.mainCameraComponent)==null?void 0:l.environmentIntensity)??1;o.envMapIntensity=Math.max(0,u*this.context.sceneLighting.environmentIntensity/h)}if(this._lightmaps)for(const h of this._lightmaps)h.updateLightmapUniforms(o),h.applyLightmap()});c(this,"_reflectionProbe",null)}static setInstanced(e,i){const s=R0(e,li);return s.setInstancingEnabled(i),s}static isInstanced(e){const i=Qf(e,li);return i?i.isInstancingActive:ea.isUsingInstancing(e)}static setVisible(e,i){Gc(e,i)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const e of this.gameObject.children)(e.type==="Mesh"||e.type==="SkinnedMesh")&&this._sharedMeshes.push(e);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(e){this.sharedMaterials[0]!==e&&(this.sharedMaterials[0]=e,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(e){this.sharedMaterial=e}set sharedMaterials(e){if(!this._originalMaterials)this._originalMaterials=e;else if(e){let i=!1;for(let s=0;s<this._sharedMaterials.length;s++){const r=s<e.length?e[s]:null;r&&r instanceof mt?this.sharedMaterials[s]=r:i||(i=!0,console.warn("Can not assign null as material: "+this.name,r))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new xW(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return FR}get lightmap(){var e;return(e=this._lightmaps)!=null&&e.length?this._lightmaps[0].lightmap:null}set lightmap(e){var i;if(this._lightmapTextureOverride=e,e===void 0&&(e=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(i=this._lightmaps)!=null&&i.length)for(const s of this._lightmaps)s.lightmap=e}get hasLightmap(){const e=this.lightmap;return e!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,Kp&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&Kp&&this.probeAnchor.add(new dr(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const e of this.gameObject.children)this.context.addBeforeRenderListener(e,this.onBeforeRenderThree),e.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let e=0;for(let i=0;i<this.gameObject.children.length;i++){const s=this.gameObject.children[i];if(!(!this.isMeshOrSkinnedMesh(s)||Q.getComponent(s,li))){if(this.renderOrder.length<=e){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+e,"ChildElement:",s);continue}s.renderOrder=this.renderOrder[e],e+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),wW)for(let e=0;e<this.sharedMaterials.length;e++){const i=this.sharedMaterials[e];i&&(i.wireframe=!0)}}applyLightmapping(){var e;if(this.lightmapIndex>=0){const i=this.gameObject.type,s=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(s){if(this._lightmaps||(this._lightmaps=[]),i==="Mesh"){const r=this.gameObject.material;if(r!=null&&r.isMeshBasicMaterial)r&&console.warn("Lightmapping is not supported on MeshBasicMaterial",r.name);else{if(this._lightmaps.length<=0){const a=new Iy(this.gameObject,this.context);this._lightmaps.push(a)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,s)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let r=0;r<this.gameObject.children.length;r++){const o=this.gameObject.children[r];if(!((e=o.material)!=null&&e.isMeshBasicMaterial)){let a;r>=this._lightmaps.length?(a=new Iy(o,this.context),this._lightmaps.push(a)):a=this._lightmaps[r],a.init(this.lightmapIndex,this.lightmapScaleOffset,s)}}}else Kp&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this._handles!=null&&this._handles.length>0&&this._isInstancingEnabled}get instances(){if(!this._handles||this._handles.length<=0)return null;if(this._handlesTempArray.length=0,this._handles)for(const e of this._handles)this._handlesTempArray.push(e);return this._handlesTempArray}setInstancingEnabled(e){if(this._isInstancingEnabled===e)return e&&(this._handles===void 0||this._handles!=null&&this._handles.length>0);if(this._isInstancingEnabled=e,e){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this._handles===void 0){if(this._handles=pf.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this._handles)return Q.markAsInstancedRendered(this.gameObject,!0),!0}else if(this._handles!==null){for(const i of this._handles)i.updateInstanceMatrix(!0),i.add();return Q.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this._handles)for(const i of this._handles)i.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this._handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!FR&&(this.setInstancingEnabled(!0),ea.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let e=0;e<this.gameObject.children.length;e++){const i=this.gameObject.children[e];i.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(i=>i)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this._handles&&this._handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this._handles=null,this.isMultiMaterialObject(this.gameObject))for(const e of this.gameObject.children)this.context.removeBeforeRenderListener(e,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var e,i,s;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((e=this._reflectionProbe)==null||e.onUnset(this),this.updateReflectionProbe()),Kp==this.name&&this.gameObject instanceof J){this.gameObject.geometry.computeBoundingSphere();const r=Re(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);Be.DrawWireSphere(r,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((i=this.gameObject.children)==null?void 0:i.length)>0)for(const r of this.gameObject.children)this.applySettings(r);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(s=this._handles)!=null&&s.length&&this.gameObject[nm]===!0){this.gameObject[nm]=!1;for(let o=this._handles.length-1;o>=0;o--)this._handles[o].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this._handles&&this._handles.length<=0&&Q.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this._handles)for(let r=0;r<this._handles.length;r++){const o=this._handles[r];Gc(o.object,!1)}this.reflectionProbeUsage!==zd.Off&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this._handles)for(let e=0;e<this._handles.length;e++){const i=this._handles[e];Gc(i.object,!0)}this.reflectionProbeUsage!==zd.Off&&this._reflectionProbe&&this._reflectionProbe.onUnset(this),this.static&&this.gameObject.matrixAutoUpdate&&(this.gameObject.matrixAutoUpdate=!1)}applyStencil(){yg.applyStencil(this)}applySettings(e){e.receiveShadow=this.receiveShadows,this.shadowCastingMode==Ty.On?e.castShadow=!0:e.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==zd.Off&&(this.startCoroutine(this._updateReflectionProbe(),We.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const e=this.probeAnchor||this.gameObject,i=!!this.probeAnchor;this._reflectionProbe=Wl.get(e,this.context,i,this.probeAnchor)}setVisibility(e){if(!this.isMultiMaterialObject(this.gameObject))Gc(this.gameObject,e);else for(const i of this.gameObject.children)this.isMeshOrSkinnedMesh(i)&&Gc(i,e)}isMultiMaterialObject(e){return e.type==="Group"}isMeshOrSkinnedMesh(e){return e.type==="Mesh"||e.type==="SkinnedMesh"}}pc([A()],li.prototype,"receiveShadows",void 0);pc([A()],li.prototype,"shadowCastingMode",void 0);pc([A()],li.prototype,"lightmapIndex",void 0);pc([A(Fe)],li.prototype,"lightmapScaleOffset",void 0);pc([A()],li.prototype,"enableInstancing",void 0);pc([A()],li.prototype,"renderOrder",void 0);pc([A()],li.prototype,"allowOcclusionWhenDynamic",void 0);pc([A(ne)],li.prototype,"probeAnchor",void 0);pc([A()],li.prototype,"reflectionProbeUsage",void 0);class nb extends li{}class B2 extends nb{constructor(){super(...arguments);c(this,"_needUpdateBoundingSphere",!1)}awake(){var e;super.awake(),LR&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const i of this.sharedMeshes)(e=i.parent)==null||e.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const e of this.sharedMeshes)if(e instanceof Zo){this._needUpdateBoundingSphere=!1;const i=e.geometry,s=Sm(e);s&&(e.geometry=s),e.computeBoundingSphere(),e.geometry=i}}if(LR){for(const e of this.sharedMeshes)if(e instanceof Zo&&e.boundingSphere){const i=Re(e.boundingSphere.center).applyMatrix4(e.matrixWorld);Be.DrawWireSphere(i,e.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var Ty;(function(n){n[n.Off=0]="Off",n[n.On=1]="On",n[n.TwoSided=2]="TwoSided",n[n.ShadowsOnly=3]="ShadowsOnly"})(Ty||(Ty={}));var G=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const JA=z("debugparticles");var Ma;(function(n){n[n.Billboard=0]="Billboard",n[n.Stretch=1]="Stretch",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh"})(Ma||(Ma={}));let qu=class{constructor(){c(this,"alphaKeys",[]);c(this,"colorKeys",[])}get duration(){return 1}evaluate(t,e){let i,s=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<t||!i)&&(i=l,s=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<t||!r)&&(r=l,o=a)}if(r)if(o+1<this.colorKeys.length){const l=this.colorKeys[o+1],h=ye.remap(t,r.time,l.time,0,1);e.r=ye.lerp(r.color.r,l.color.r,h),e.g=ye.lerp(r.color.g,l.color.g,h),e.b=ye.lerp(r.color.b,l.color.b,h)}else e.r=r.color.r,e.g=r.color.g,e.b=r.color.b;if(i)if(s+1<this.alphaKeys.length){const l=this.alphaKeys[s+1],h=ye.remap(t,i.time,l.time,0,1);e.alpha=ye.lerp(i.alpha,l.alpha,h)}else e.alpha=i.alpha;return e}};G([A()],qu.prototype,"alphaKeys",void 0);G([A()],qu.prototype,"colorKeys",void 0);var Fi;(function(n){n[n.Constant=0]="Constant",n[n.Curve=1]="Curve",n[n.TwoCurves=2]="TwoCurves",n[n.TwoConstants=3]="TwoConstants"})(Fi||(Fi={}));var Tl;(function(n){n[n.Color=0]="Color",n[n.Gradient=1]="Gradient",n[n.TwoColors=2]="TwoColors",n[n.TwoGradients=3]="TwoGradients",n[n.RandomColor=4]="RandomColor"})(Tl||(Tl={}));var ta;(function(n){n[n.Local=0]="Local",n[n.World=1]="World",n[n.Custom=2]="Custom"})(ta||(ta={}));var zs;(function(n){n[n.Sphere=0]="Sphere",n[n.SphereShell=1]="SphereShell",n[n.Hemisphere=2]="Hemisphere",n[n.HemisphereShell=3]="HemisphereShell",n[n.Cone=4]="Cone",n[n.Box=5]="Box",n[n.Mesh=6]="Mesh",n[n.ConeShell=7]="ConeShell",n[n.ConeVolume=8]="ConeVolume",n[n.ConeVolumeShell=9]="ConeVolumeShell",n[n.Circle=10]="Circle",n[n.CircleEdge=11]="CircleEdge",n[n.SingleSidedEdge=12]="SingleSidedEdge",n[n.MeshRenderer=13]="MeshRenderer",n[n.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",n[n.BoxShell=15]="BoxShell",n[n.BoxEdge=16]="BoxEdge",n[n.Donut=17]="Donut",n[n.Rectangle=18]="Rectangle",n[n.Sprite=19]="Sprite",n[n.SpriteRenderer=20]="SpriteRenderer"})(zs||(zs={}));var Jh;(function(n){n[n.Random=0]="Random",n[n.Loop=1]="Loop",n[n.PingPong=2]="PingPong",n[n.BurstSpread=3]="BurstSpread"})(Jh||(Jh={}));class Ce{constructor(){c(this,"mode","Constant");c(this,"constant");c(this,"constantMin");c(this,"constantMax");c(this,"curve");c(this,"curveMin");c(this,"curveMax");c(this,"curveMultiplier")}static constant(t){const e=new Ce;return e.setConstant(t),e}static betweenTwoConstants(t,e){const i=new Ce;return i.setMinMaxConstant(t,e),i}static curve(t,e=1){const i=new Ce;return i.setCurve(t,e),i}setConstant(t){this.mode=Fi.Constant,this.constant=t}setMinMaxConstant(t,e){this.mode=Fi.TwoConstants,this.constantMin=t,this.constantMax=e}setCurve(t,e=1){this.mode=Fi.Curve,this.curve=t,this.curveMultiplier=e}clone(){var e,i,s;const t=new Ce;return t.mode=this.mode,t.constant=this.constant,t.constantMin=this.constantMin,t.constantMax=this.constantMax,t.curve=(e=this.curve)==null?void 0:e.clone(),t.curveMin=(i=this.curveMin)==null?void 0:i.clone(),t.curveMax=(s=this.curveMax)==null?void 0:s.clone(),t.curveMultiplier=this.curveMultiplier,t}evaluate(t,e){const i=e===void 0?Math.random():e;switch(this.mode){case Fi.Constant:case"Constant":return this.constant;case Fi.Curve:case"Curve":return t=ye.clamp01(t),this.curve.evaluate(t)*this.curveMultiplier;case Fi.TwoCurves:case"TwoCurves":const s=t*this.curveMin.duration,r=t*this.curveMax.duration;return ye.lerp(this.curveMin.evaluate(s),this.curveMax.evaluate(r),i%1)*this.curveMultiplier;case Fi.TwoConstants:case"TwoConstants":return ye.lerp(this.constantMin,this.constantMax,i%1);default:this.curveMax.evaluate(t)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case Fi.Constant:case"Constant":return this.constant;case Fi.Curve:case"Curve":return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case Fi.TwoCurves:case"TwoCurves":return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case Fi.TwoConstants:case"TwoConstants":return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(t){if(!t)return 0;let e=Number.MIN_VALUE;for(let i=0;i<t.keys.length;i++){const s=t.keys[i];s.value>e&&(e=s.value)}return e}}G([A()],Ce.prototype,"mode",void 0);G([A()],Ce.prototype,"constant",void 0);G([A()],Ce.prototype,"constantMin",void 0);G([A()],Ce.prototype,"constantMax",void 0);G([A(Ko)],Ce.prototype,"curve",void 0);G([A(Ko)],Ce.prototype,"curveMin",void 0);G([A(Ko)],Ce.prototype,"curveMax",void 0);G([A()],Ce.prototype,"curveMultiplier",void 0);const or=class{constructor(){c(this,"mode",Tl.Color);c(this,"color");c(this,"colorMin");c(this,"colorMax");c(this,"gradient");c(this,"gradientMin");c(this,"gradientMax")}static constant(t){const e=new or;return e.constant(t),e}static betweenTwoColors(t,e){const i=new or;return i.betweenTwoColors(t,e),i}constant(t){return this.mode=Tl.Color,this.color=t,this}betweenTwoColors(t,e){return this.mode=Tl.TwoColors,this.colorMin=t,this.colorMax=e,this}evaluate(t,e){const i=e===void 0?Math.random():e;switch(this.mode){case Tl.Color:case"Color":return this.color;case Tl.Gradient:case"Gradient":return this.gradient.evaluate(t,or._temp),or._temp;case Tl.TwoColors:case"TwoColors":return or._temp.lerpColors(this.colorMin,this.colorMax,i);case Tl.TwoGradients:case"TwoGradients":return this.gradientMin.evaluate(t,or._temp),this.gradientMax.evaluate(t,or._temp2),or._temp.lerp(or._temp2,i)}return or._temp.set(16711935),or._temp.alpha=1,or._temp}};let wn=or;c(wn,"_temp",new Ut(0,0,0,1)),c(wn,"_temp2",new Ut(0,0,0,1));G([A()],wn.prototype,"mode",void 0);G([A(Ut)],wn.prototype,"color",void 0);G([A(Ut)],wn.prototype,"colorMin",void 0);G([A(Ut)],wn.prototype,"colorMax",void 0);G([A(qu)],wn.prototype,"gradient",void 0);G([A(qu)],wn.prototype,"gradientMin",void 0);G([A(qu)],wn.prototype,"gradientMax",void 0);var Ry;(function(n){n[n.Hierarchy=0]="Hierarchy",n[n.Local=1]="Local",n[n.Shape=2]="Shape"})(Ry||(Ry={}));class Es{constructor(){c(this,"cullingMode");c(this,"duration");c(this,"emitterVelocityMode");c(this,"flipRotation");c(this,"gravityModifier");c(this,"gravityModifierMultiplier");c(this,"loop");c(this,"maxParticles");c(this,"playOnAwake");c(this,"prewarm");c(this,"ringBufferLoopRange");c(this,"ringBufferMode");c(this,"scalingMode");c(this,"simulationSpace");c(this,"simulationSpeed");c(this,"startColor");c(this,"startDelay");c(this,"startDelayMultiplier");c(this,"startLifetime");c(this,"startLifetimeMultiplier");c(this,"startRotation");c(this,"startRotationMultiplier");c(this,"startRotation3D");c(this,"startRotationX");c(this,"startRotationXMultiplier");c(this,"startRotationY");c(this,"startRotationYMultiplier");c(this,"startRotationZ");c(this,"startRotationZMultiplier");c(this,"startSize");c(this,"startSize3D");c(this,"startSizeMultiplier");c(this,"startSizeX");c(this,"startSizeXMultiplier");c(this,"startSizeY");c(this,"startSizeYMultiplier");c(this,"startSizeZ");c(this,"startSizeZMultiplier");c(this,"startSpeed");c(this,"startSpeedMultiplier");c(this,"stopAction");c(this,"useUnscaledTime")}}G([A(Ce)],Es.prototype,"gravityModifier",void 0);G([A(wn)],Es.prototype,"startColor",void 0);G([A(Ce)],Es.prototype,"startDelay",void 0);G([A(Ce)],Es.prototype,"startLifetime",void 0);G([A(Ce)],Es.prototype,"startRotation",void 0);G([A(Ce)],Es.prototype,"startRotationX",void 0);G([A(Ce)],Es.prototype,"startRotationY",void 0);G([A(Ce)],Es.prototype,"startRotationZ",void 0);G([A(Ce)],Es.prototype,"startSize",void 0);G([A(Ce)],Es.prototype,"startSizeX",void 0);G([A(Ce)],Es.prototype,"startSizeY",void 0);G([A(Ce)],Es.prototype,"startSizeZ",void 0);G([A(Ce)],Es.prototype,"startSpeed",void 0);class By{constructor(){c(this,"cycleCount");c(this,"maxCount");c(this,"minCount");c(this,"probability");c(this,"repeatInterval");c(this,"time");c(this,"count");c(this,"_performed",0)}reset(){this._performed=0}run(t){if(t<=this.time)return 0;let e=0;if(this.cycleCount===0||this._performed<this.cycleCount){const i=this.time+this.repeatInterval*this._performed;if(t>=i&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case Fi.Constant:e=this.count.constant;break;case Fi.TwoConstants:e=ye.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case Fi.Curve:e=this.count.curve.evaluate(Math.random());break;case Fi.TwoCurves:const s=Math.random();e=ye.lerp(this.count.curveMin.evaluate(s),this.count.curveMax.evaluate(s),Math.random());break}}return e}}class gc{constructor(){c(this,"enabled");c(this,"bursts");c(this,"rateOverTime");c(this,"rateOverTimeMultiplier");c(this,"rateOverDistance");c(this,"rateOverDistanceMultiplier");c(this,"system")}get burstCount(){var t;return((t=this.bursts)==null?void 0:t.length)??0}reset(){var t;(t=this.bursts)==null||t.forEach(e=>e.reset())}getBurst(){let t=0;if(this.burstCount>0)for(let e=0;e<this.burstCount;e++){const i=this.bursts[e];this.system.main.loop&&i.time>=this.system.time&&i.reset(),t+=Math.round(i.run(this.system.time))}return t}}G([A()],gc.prototype,"enabled",void 0);G([A()],gc.prototype,"bursts",void 0);G([A(Ce)],gc.prototype,"rateOverTime",void 0);G([A()],gc.prototype,"rateOverTimeMultiplier",void 0);G([A(Ce)],gc.prototype,"rateOverDistance",void 0);G([A()],gc.prototype,"rateOverDistanceMultiplier",void 0);class sb{constructor(){c(this,"enabled");c(this,"color")}}G([A(wn)],sb.prototype,"color",void 0);class Xu{constructor(){c(this,"enabled");c(this,"separateAxes");c(this,"size");c(this,"sizeMultiplier");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier");c(this,"_time",0);c(this,"_temp",new w)}evaluate(t,e,i){if(e||(e=this._temp),!this.enabled)return e.x=e.y=e.z=1,e;if(this.separateAxes)e.x=this.x.evaluate(t,i)*this.xMultiplier,e.y=this.y.evaluate(t,i)*this.yMultiplier,e.z=this.z.evaluate(t,i)*this.zMultiplier;else{const s=this.size.evaluate(t,i)*this.sizeMultiplier;e.x=s}return e}}G([A(Ce)],Xu.prototype,"size",void 0);G([A(Ce)],Xu.prototype,"x",void 0);G([A(Ce)],Xu.prototype,"y",void 0);G([A(Ce)],Xu.prototype,"z",void 0);var jc;(function(n){n[n.Vertex=0]="Vertex",n[n.Edge=1]="Edge",n[n.Triangle=2]="Triangle"})(jc||(jc={}));const Zd=class{constructor(){c(this,"shapeType",zs.Box);c(this,"enabled",!0);c(this,"alignToDirection",!1);c(this,"angle",0);c(this,"arc",360);c(this,"arcSpread");c(this,"arcSpeedMultiplier");c(this,"arcMode");c(this,"boxThickness");c(this,"position");c(this,"rotation");c(this,"_rotation",new jt);c(this,"scale");c(this,"radius");c(this,"radiusThickness");c(this,"sphericalDirectionAmount");c(this,"randomDirectionAmount");c(this,"randomPositionAmount");c(this,"meshShapeType");c(this,"meshRenderer");c(this,"_meshObj");c(this,"_meshGeometry");c(this,"system");c(this,"_space");c(this,"_worldSpaceMatrix",new ae);c(this,"_worldSpaceMatrixInverse",new ae);c(this,"_vector",new w(0,0,0));c(this,"_temp",new w(0,0,0));c(this,"_triangle",new QP);c(this,"_dir",new w);c(this,"_loopTime",0);c(this,"_loopDirection",1);JA&&console.log(this)}get type(){return zs[this.shapeType]}initialize(t){this.onInitialize(t),t.position.copy(this._vector)}toJSON(){return this}clone(){return new Zd}setMesh(t){this.meshRenderer=t,t?(this._meshObj=t.sharedMeshes[Math.floor(Math.random()*t.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(t,e,i,s){this.system=t,this._space=i,i===ta.World&&(this._worldSpaceMatrix.copy(s.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(t){const e=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return e&&(this._rotation.x=ye.toRadians(this.rotation.x),this._rotation.y=ye.toRadians(this.rotation.y),this._rotation.z=ye.toRadians(this.rotation.z),this._rotation.order="ZYX",t.applyEuler(this._rotation)),e}onInitialize(t){this._vector.set(0,0,0),t.mesh=void 0,t.mesh_geometry=void 0;const e=this._temp.copy(this.position),i=this._space===ta.World;i&&e.applyQuaternion(this.system.worldQuaternion);let s=this.radius;if(i&&(s*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case zs.Box:JA&&Be.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(e);break;case zs.Cone:this.randomConePoint(this.position,this.angle,s,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case zs.Sphere:this.randomSpherePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case zs.Circle:this.randomCirclePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case zs.MeshRenderer:const r=this.meshRenderer;(r==null?void 0:r.destroyed)==!1&&this.setMesh(r);const o=t.mesh=this._meshObj,a=t.mesh_geometry=this._meshGeometry;if(o&&a)switch(this.meshShapeType){case jc.Vertex:{const l=a.getAttribute("position"),h=Math.floor(Math.random()*l.count);this._vector.fromBufferAttribute(l,h),this._vector.applyMatrix4(o.matrixWorld),t.mesh_normal=h}break;case jc.Edge:break;case jc.Triangle:{const l=a.index;if(l){let h=Math.random(),u=Math.random();h+u>1&&(h=1-h,u=1-u);const d=Math.floor(Math.random()*(l.count/3));let f=d*3,p=d*3+1,g=d*3+2;f=l.getX(f),p=l.getX(p),g=l.getX(g);const m=a.getAttribute("position");this._triangle.a.fromBufferAttribute(m,f),this._triangle.b.fromBufferAttribute(m,p),this._triangle.c.fromBufferAttribute(m,g),this._vector.set(0,0,0).addScaledVector(this._triangle.a,h).addScaledVector(this._triangle.b,u).addScaledVector(this._triangle.c,1-(h+u)),this._vector.applyMatrix4(o.matrixWorld),t.mesh_normal=d}}break}break;default:this._vector.set(0,0,0),ve()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",zs[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),i&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),JA&&Be.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(t,e){var i;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case zs.Box:this._dir.set(0,0,1);break;case zs.Cone:this._dir.set(0,0,1);break;case zs.Circle:case zs.Sphere:const s=e.x,r=e.y,o=e.z;this._dir.set(s,r,o),(i=this.system)!=null&&i.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case zs.MeshRenderer:const a=t.mesh,l=t.mesh_geometry;if(a&&l)switch(this.meshShapeType){case jc.Vertex:{const h=l.getAttribute("normal"),u=t.mesh_normal;this._dir.fromBufferAttribute(h,u)}break;case jc.Edge:break;case jc.Triangle:{const h=l.index;if(h){const u=t.mesh_normal,d=h.getX(u*3),f=h.getX(u*3+1),p=h.getX(u*3+2),g=l.getAttribute("position"),m=Re(),v=Re(),y=Re();m.fromBufferAttribute(g,d),v.fromBufferAttribute(g,f),y.fromBufferAttribute(g,p),m.sub(v),y.sub(v),m.cross(y),this._dir.copy(m).multiplyScalar(-1);const b=Gt(a);this._dir.applyQuaternion(b)}}break}break;default:this._dir.set(0,0,1);break}return this._space===ta.World&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),JA&&(Be.DrawSphere(e,.01,8925952,.5,!0),Be.DrawDirection(e,this._dir,8925952,.5,!0)),this._dir}randomizePosition(t,e){if(e<=0)return;const i=Zd._tempVec;i.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),i.x*=e*this.scale.x,i.y*=e*this.scale.y,i.z*=e*this.scale.z,t.add(i)}randomizeDirection(t,e){if(e===0)return;const i=Zd._randomQuat,s=Zd._tempVec;s.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),i.setFromAxisAngle(s,e*Math.random()*Math.PI),t.applyQuaternion(i)}spherizeDirection(t,e){if(e===0)return;const i=Math.random()*Math.PI*2,s=Math.acos(1-Math.random()*2),r=Math.sin(s)*Math.cos(i),o=Math.sin(s)*Math.sin(i),a=Math.cos(s),l=new w(r,o,a);t.lerp(l,e)}randomSpherePoint(t,e,i,s,r){const o=Math.random(),a=Math.random(),l=2*Math.PI*o*(s/360),h=Math.acos(2*a-1),u=ye.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,d=t.x+this.scale.x*(-u*Math.sin(h)*Math.cos(l)),f=t.y+this.scale.y*(u*Math.sin(h)*Math.sin(l)),p=t.z+this.scale.z*(u*Math.cos(h));r.x=d,r.y=f,r.z=p}randomCirclePoint(t,e,i,s,r){const o=Math.random(),a=2*Math.PI*o*(s/360),l=ye.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,h=t.x+this.scale.x*l*Math.cos(a),u=t.y+this.scale.y*l*Math.sin(a),d=t.z;r.x=h,r.y=u,r.z=d}randomConePoint(t,e,i,s,r,o,a){let l=0,h=0;switch(o){case Jh.Random:l=Math.random(),h=Math.random();break;case Jh.PingPong:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case Jh.Loop:l=.5,h=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let u=2*Math.PI*l*(r/360);switch(o){case Jh.PingPong:case Jh.Loop:u+=Math.PI+.5,u+=this._loopTime*Math.PI*2,u%=ye.toRadians(r);break}const d=Math.acos(2*h-1),f=ye.lerp(1,1-Math.pow(1-Math.random(),Math.PI),s)*i,p=t.x+-f*Math.sin(d)*Math.cos(u),g=t.y+f*Math.sin(d)*Math.sin(u),m=t.z;a.x=p*this.scale.x,a.y=g*this.scale.y,a.z=m*this.scale.z}};let Zt=Zd;c(Zt,"_randomQuat",new ie),c(Zt,"_tempVec",new w);G([A()],Zt.prototype,"shapeType",void 0);G([A()],Zt.prototype,"enabled",void 0);G([A()],Zt.prototype,"alignToDirection",void 0);G([A()],Zt.prototype,"angle",void 0);G([A()],Zt.prototype,"arc",void 0);G([A()],Zt.prototype,"arcSpread",void 0);G([A()],Zt.prototype,"arcSpeedMultiplier",void 0);G([A()],Zt.prototype,"arcMode",void 0);G([A(w)],Zt.prototype,"boxThickness",void 0);G([A(w)],Zt.prototype,"position",void 0);G([A(w)],Zt.prototype,"rotation",void 0);G([A(w)],Zt.prototype,"scale",void 0);G([A()],Zt.prototype,"radius",void 0);G([A()],Zt.prototype,"radiusThickness",void 0);G([A()],Zt.prototype,"sphericalDirectionAmount",void 0);G([A()],Zt.prototype,"randomDirectionAmount",void 0);G([A()],Zt.prototype,"randomPositionAmount",void 0);G([A()],Zt.prototype,"meshShapeType",void 0);G([A(nb)],Zt.prototype,"meshRenderer",void 0);class Nt{constructor(){c(this,"damping");c(this,"enabled");c(this,"frequency");c(this,"octaveCount");c(this,"octaveMultiplier");c(this,"octaveScale");c(this,"positionAmount");c(this,"quality");c(this,"remap");c(this,"remapEnabled");c(this,"remapMultiplier");c(this,"remapX");c(this,"remapXMultiplier");c(this,"remapY");c(this,"remapYMultiplier");c(this,"remapZ");c(this,"remapZMultiplier");c(this,"scrollSpeedMultiplier");c(this,"separateAxes");c(this,"strengthMultiplier");c(this,"strengthX");c(this,"strengthXMultiplier");c(this,"strengthY");c(this,"strengthYMultiplier");c(this,"strengthZ");c(this,"strengthZMultiplier");c(this,"_noise");c(this,"_time",0);c(this,"_temp",new w)}update(t){this._time+=t.time.deltaTime*this.scrollSpeedMultiplier}apply(t,e,i,s,r,o){if(!this.enabled)return;this._noise||(this._noise=iW(()=>0));const a=this._temp.set(e.x,e.y,e.z).multiplyScalar(this.frequency),l=this._noise(a.x,a.y,a.z,this._time),h=this._noise(a.x,a.y,a.z,this._time+1e3*this.frequency),u=this._noise(a.x,a.y,a.z,this._time+2e3*this.frequency);this._temp.set(l,h,u).normalize();const d=r/o;let f=this.positionAmount.evaluate(d);this.separateAxes?(this._temp.x*=f*this.strengthXMultiplier,this._temp.y*=f*this.strengthYMultiplier,this._temp.z*=f*this.strengthZMultiplier):(this.strengthX&&(f*=this.strengthX.evaluate(d)*1.5),this._temp.multiplyScalar(f)),i.x+=this._temp.x,i.y+=this._temp.y,i.z+=this._temp.z}}G([A()],Nt.prototype,"damping",void 0);G([A()],Nt.prototype,"enabled",void 0);G([A()],Nt.prototype,"frequency",void 0);G([A()],Nt.prototype,"octaveCount",void 0);G([A()],Nt.prototype,"octaveMultiplier",void 0);G([A()],Nt.prototype,"octaveScale",void 0);G([A(Ce)],Nt.prototype,"positionAmount",void 0);G([A()],Nt.prototype,"quality",void 0);G([A(Ce)],Nt.prototype,"remap",void 0);G([A()],Nt.prototype,"remapEnabled",void 0);G([A()],Nt.prototype,"remapMultiplier",void 0);G([A(Ce)],Nt.prototype,"remapX",void 0);G([A()],Nt.prototype,"remapXMultiplier",void 0);G([A(Ce)],Nt.prototype,"remapY",void 0);G([A()],Nt.prototype,"remapYMultiplier",void 0);G([A(Ce)],Nt.prototype,"remapZ",void 0);G([A()],Nt.prototype,"remapZMultiplier",void 0);G([A()],Nt.prototype,"scrollSpeedMultiplier",void 0);G([A()],Nt.prototype,"separateAxes",void 0);G([A()],Nt.prototype,"strengthMultiplier",void 0);G([A(Ce)],Nt.prototype,"strengthX",void 0);G([A()],Nt.prototype,"strengthXMultiplier",void 0);G([A(Ce)],Nt.prototype,"strengthY",void 0);G([A()],Nt.prototype,"strengthYMultiplier",void 0);G([A(Ce)],Nt.prototype,"strengthZ",void 0);G([A()],Nt.prototype,"strengthZMultiplier",void 0);var iC;(function(n){n[n.PerParticle=0]="PerParticle",n[n.Ribbon=1]="Ribbon"})(iC||(iC={}));var nC;(function(n){n[n.Stretch=0]="Stretch",n[n.Tile=1]="Tile",n[n.DistributePerSegment=2]="DistributePerSegment",n[n.RepeatPerSegment=3]="RepeatPerSegment"})(nC||(nC={}));class Ci{constructor(){c(this,"enabled");c(this,"attachRibbonToTransform",!1);c(this,"colorOverLifetime");c(this,"colorOverTrail");c(this,"dieWithParticles",!0);c(this,"inheritParticleColor",!0);c(this,"lifetime");c(this,"lifetimeMultiplier");c(this,"minVertexDistance",.2);c(this,"mode",iC.PerParticle);c(this,"ratio",1);c(this,"ribbonCount",1);c(this,"shadowBias",0);c(this,"sizeAffectsLifetime",!1);c(this,"sizeAffectsWidth",!1);c(this,"splitSubEmitterRibbons",!1);c(this,"textureMode",nC.Stretch);c(this,"widthOverTrail");c(this,"widthOverTrailMultiplier");c(this,"worldSpace",!1)}getWidth(t,e,i,s){const r=this.widthOverTrail.evaluate(i,s);return t*=r,t}getColor(t,e,i){const s=this.colorOverTrail.evaluate(i),r=this.colorOverLifetime.evaluate(e);t.x*=s.r*r.r,t.y*=s.g*r.g,t.z*=s.b*r.b,"alpha"in s&&"alpha"in r&&(t.w*=s.alpha*r.alpha)}}G([A()],Ci.prototype,"enabled",void 0);G([A()],Ci.prototype,"attachRibbonToTransform",void 0);G([A(wn)],Ci.prototype,"colorOverLifetime",void 0);G([A(wn)],Ci.prototype,"colorOverTrail",void 0);G([A()],Ci.prototype,"dieWithParticles",void 0);G([A()],Ci.prototype,"inheritParticleColor",void 0);G([A(Ce)],Ci.prototype,"lifetime",void 0);G([A()],Ci.prototype,"lifetimeMultiplier",void 0);G([A()],Ci.prototype,"minVertexDistance",void 0);G([A()],Ci.prototype,"mode",void 0);G([A()],Ci.prototype,"ratio",void 0);G([A()],Ci.prototype,"ribbonCount",void 0);G([A()],Ci.prototype,"shadowBias",void 0);G([A()],Ci.prototype,"sizeAffectsLifetime",void 0);G([A()],Ci.prototype,"sizeAffectsWidth",void 0);G([A()],Ci.prototype,"splitSubEmitterRibbons",void 0);G([A()],Ci.prototype,"textureMode",void 0);G([A(Ce)],Ci.prototype,"widthOverTrail",void 0);G([A()],Ci.prototype,"widthOverTrailMultiplier",void 0);G([A()],Ci.prototype,"worldSpace",void 0);class Pi{constructor(){c(this,"enabled");c(this,"space",ta.Local);c(this,"orbitalX");c(this,"orbitalY");c(this,"orbitalZ");c(this,"orbitalXMultiplier");c(this,"orbitalYMultiplier");c(this,"orbitalZMultiplier");c(this,"orbitalOffsetX");c(this,"orbitalOffsetY");c(this,"orbitalOffsetZ");c(this,"speedModifier");c(this,"speedModifierMultiplier");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier");c(this,"_system");c(this,"_temp",new w);c(this,"_temp2",new w);c(this,"_temp3",new w);c(this,"_hasOrbital",!1);c(this,"_index",0);c(this,"_orbitalMatrix",new ae)}update(t){this._system=t}init(t){this._index==0&&(t.debug=!0),this._index+=1,t.orbitx=this.orbitalX.evaluate(Math.random()),t.orbity=this.orbitalY.evaluate(Math.random()),t.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=t.orbitx!=0||t.orbity!=0||t.orbitz!=0}apply(t,e,i,s,r,o,a){var p;if(!this.enabled)return;const l=o/a,h=this.speedModifier.evaluate(l)*this.speedModifierMultiplier,u=this.x.evaluate(l),d=this.y.evaluate(l),f=this.z.evaluate(l);if(this._temp.set(-u,d,f),this._system&&this._system.main.simulationSpace===ta.World&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((p=this._system)==null?void 0:p.worldPos)){const m=this._temp2.set(i.x,i.y,i.z),v=this.orbitalXMultiplier,y=this.orbitalYMultiplier,b=this.orbitalZMultiplier,_=h*Math.PI*2*10,x=Math.cos(_*v),S=Math.sin(_*v),E=Math.cos(_*y),M=Math.sin(_*y),I=Math.cos(_*b),B=Math.sin(_*b),R=m.x*(E*I)+m.y*(E*B)+m.z*-M,P=m.x*(S*M*I-x*B)+m.y*(S*M*B+x*I)+m.z*(S*E),F=m.x*(x*M*I+S*B)+m.y*(x*M*B-S*I)+m.z*(x*E),j=this._temp3.set(m.x-R,m.y-P,m.z-F);j.normalize(),j.multiplyScalar(.2/r*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),s.x+=j.x,s.y+=j.y,s.z+=j.z}s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z,s.x*=h,s.y*=h,s.z*=h}}G([A()],Pi.prototype,"enabled",void 0);G([A()],Pi.prototype,"space",void 0);G([A(Ce)],Pi.prototype,"orbitalX",void 0);G([A(Ce)],Pi.prototype,"orbitalY",void 0);G([A(Ce)],Pi.prototype,"orbitalZ",void 0);G([A()],Pi.prototype,"orbitalXMultiplier",void 0);G([A()],Pi.prototype,"orbitalYMultiplier",void 0);G([A()],Pi.prototype,"orbitalZMultiplier",void 0);G([A()],Pi.prototype,"orbitalOffsetX",void 0);G([A()],Pi.prototype,"orbitalOffsetY",void 0);G([A()],Pi.prototype,"orbitalOffsetZ",void 0);G([A(Ce)],Pi.prototype,"speedModifier",void 0);G([A()],Pi.prototype,"speedModifierMultiplier",void 0);G([A(Ce)],Pi.prototype,"x",void 0);G([A()],Pi.prototype,"xMultiplier",void 0);G([A(Ce)],Pi.prototype,"y",void 0);G([A()],Pi.prototype,"yMultiplier",void 0);G([A(Ce)],Pi.prototype,"z",void 0);G([A()],Pi.prototype,"zMultiplier",void 0);var sC;(function(n){n[n.Lifetime=0]="Lifetime",n[n.Speed=1]="Speed",n[n.FPS=2]="FPS"})(sC||(sC={}));var NR;(function(n){n[n.Grid=0]="Grid",n[n.Sprites=1]="Sprites"})(NR||(NR={}));var zR;(function(n){n[n.Custom=0]="Custom",n[n.Random=1]="Random",n[n.MeshIndex=2]="MeshIndex"})(zR||(zR={}));var QR;(function(n){n[n.WholeSheet=0]="WholeSheet",n[n.SingleRow=1]="SingleRow"})(QR||(QR={}));class Is{constructor(){c(this,"animation");c(this,"enabled");c(this,"cycleCount");c(this,"frameOverTime");c(this,"frameOverTimeMultiplier");c(this,"numTilesX");c(this,"numTilesY");c(this,"startFrame");c(this,"startFrameMultiplier");c(this,"rowMode");c(this,"rowIndex");c(this,"spriteCount");c(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===sC.Lifetime)switch(this.frameOverTime.mode){case Fi.Constant:case Fi.TwoConstants:case Fi.TwoCurves:case Fi.Curve:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(t){if(!this.sampleOnceAtStart())return this.getIndex(t)}getIndex(t){const e=this.numTilesX*this.numTilesY;t=t*this.cycleCount;let i=this.frameOverTime.evaluate(t%1);return i*=this.frameOverTimeMultiplier,i*=e,i=i%e,i=Math.floor(i),i}}G([A()],Is.prototype,"animation",void 0);G([A()],Is.prototype,"enabled",void 0);G([A()],Is.prototype,"cycleCount",void 0);G([A(Ce)],Is.prototype,"frameOverTime",void 0);G([A()],Is.prototype,"frameOverTimeMultiplier",void 0);G([A()],Is.prototype,"numTilesX",void 0);G([A()],Is.prototype,"numTilesY",void 0);G([A(Ce)],Is.prototype,"startFrame",void 0);G([A()],Is.prototype,"startFrameMultiplier",void 0);G([A()],Is.prototype,"rowMode",void 0);G([A()],Is.prototype,"rowIndex",void 0);G([A()],Is.prototype,"spriteCount",void 0);G([A()],Is.prototype,"timeMode",void 0);class oa{constructor(){c(this,"enabled");c(this,"separateAxes");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier")}evaluate(t,e){return this.enabled?this.separateAxes?0:this.z.evaluate(t,e)*-1:0}}G([A()],oa.prototype,"enabled",void 0);G([A()],oa.prototype,"separateAxes",void 0);G([A(Ce)],oa.prototype,"x",void 0);G([A()],oa.prototype,"xMultiplier",void 0);G([A(Ce)],oa.prototype,"y",void 0);G([A()],oa.prototype,"yMultiplier",void 0);G([A(Ce)],oa.prototype,"z",void 0);G([A()],oa.prototype,"zMultiplier",void 0);class Io{constructor(){c(this,"enabled");c(this,"range");c(this,"separateAxes");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier")}evaluate(t,e){if(!this.enabled)return 0;if(!this.separateAxes){const i=ye.lerp(this.range.x,this.range.y,e);return this.z.evaluate(i)*-1}return 0}}G([A()],Io.prototype,"enabled",void 0);G([A()],Io.prototype,"range",void 0);G([A()],Io.prototype,"separateAxes",void 0);G([A(Ce)],Io.prototype,"x",void 0);G([A()],Io.prototype,"xMultiplier",void 0);G([A(Ce)],Io.prototype,"y",void 0);G([A()],Io.prototype,"yMultiplier",void 0);G([A(Ce)],Io.prototype,"z",void 0);G([A()],Io.prototype,"zMultiplier",void 0);class un{constructor(){c(this,"enabled");c(this,"dampen");c(this,"drag");c(this,"dragMultiplier");c(this,"limit");c(this,"limitMultiplier");c(this,"separateAxes");c(this,"limitX");c(this,"limitXMultiplier");c(this,"limitY");c(this,"limitYMultiplier");c(this,"limitZ");c(this,"limitZMultiplier");c(this,"multiplyDragByParticleSize",!1);c(this,"multiplyDragByParticleVelocity",!1);c(this,"space");c(this,"_temp",new w);c(this,"_temp2",new w)}apply(t,e,i,s,r,o,a){if(this.enabled){const l=this.limit.evaluate(r)*this.limitMultiplier;if(e.length()>l){this._temp.copy(e).normalize().multiplyScalar(l);const u=this.dampen*.5;e.x=ye.lerp(e.x,this._temp.x,u),e.y=ye.lerp(e.y,this._temp.y,u),e.z=ye.lerp(e.z,this._temp.z,u),i.x=ye.lerp(i.x,this._temp.x,u),i.y=ye.lerp(i.y,this._temp.y,u),i.z=ye.lerp(i.z,this._temp.z,u)}}}}G([A()],un.prototype,"enabled",void 0);G([A()],un.prototype,"dampen",void 0);G([A(Ce)],un.prototype,"drag",void 0);G([A()],un.prototype,"dragMultiplier",void 0);G([A(Ce)],un.prototype,"limit",void 0);G([A()],un.prototype,"limitMultiplier",void 0);G([A()],un.prototype,"separateAxes",void 0);G([A(Ce)],un.prototype,"limitX",void 0);G([A()],un.prototype,"limitXMultiplier",void 0);G([A(Ce)],un.prototype,"limitY",void 0);G([A()],un.prototype,"limitYMultiplier",void 0);G([A(Ce)],un.prototype,"limitZ",void 0);G([A()],un.prototype,"limitZMultiplier",void 0);G([A()],un.prototype,"multiplyDragByParticleSize",void 0);G([A()],un.prototype,"multiplyDragByParticleVelocity",void 0);G([A()],un.prototype,"space",void 0);var Py;(function(n){n[n.Initial=0]="Initial",n[n.Current=1]="Current"})(Py||(Py={}));class mc{constructor(){c(this,"enabled");c(this,"curve");c(this,"curveMultiplier");c(this,"mode");c(this,"system");c(this,"_temp",new w);c(this,"_firstUpdate",!0);c(this,"_frames",0)}clone(){var e;const t=new mc;return t.enabled=this.enabled,t.curve=(e=this.curve)==null?void 0:e.clone(),t.curveMultiplier=this.curveMultiplier,t.mode=this.mode,t}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new w),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new w),this.system._iv_velocity}awake(t){this.system=t,this.reset()}reset(){this._firstUpdate=!0}update(t){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(t){if(this.enabled&&this.system.worldspace!==!1&&this.mode===Py.Initial){const e=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(e),t.add(this._temp)}}applyCurrent(t,e,i){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===Py.Current){const s=this.curve.evaluate(e,i);this._temp.copy(this._velocity).multiplyScalar(s),t.add(this._temp)}}}G([A()],mc.prototype,"enabled",void 0);G([A(Ce)],mc.prototype,"curve",void 0);G([A()],mc.prototype,"curveMultiplier",void 0);G([A()],mc.prototype,"mode",void 0);class mr{constructor(){c(this,"enabled");c(this,"range");c(this,"separateAxes");c(this,"size");c(this,"sizeMultiplier");c(this,"x");c(this,"xMultiplier");c(this,"y");c(this,"yMultiplier");c(this,"z");c(this,"zMultiplier")}evaluate(t,e,i,s){const r=t.length(),o=ye.remap(r,this.range.x,this.range.y,0,1),a=this.size.evaluate(o,i);return s*a}}G([A()],mr.prototype,"enabled",void 0);G([A(oe)],mr.prototype,"range",void 0);G([A()],mr.prototype,"separateAxes",void 0);G([A(Ce)],mr.prototype,"size",void 0);G([A()],mr.prototype,"sizeMultiplier",void 0);G([A(Ce)],mr.prototype,"x",void 0);G([A()],mr.prototype,"xMultiplier",void 0);G([A(Ce)],mr.prototype,"y",void 0);G([A()],mr.prototype,"yMultiplier",void 0);G([A(Ce)],mr.prototype,"z",void 0);G([A()],mr.prototype,"zMultiplier",void 0);class Xf{constructor(){c(this,"enabled");c(this,"range");c(this,"color")}evaluate(t,e,i){const s=t.length(),r=ye.remap(s,this.range.x,this.range.y,0,1),o=this.color.evaluate(r,e);i.x*=o.r,i.y*=o.g,i.z*=o.b,"alpha"in o&&(i.w*=o.alpha)}}G([A()],Xf.prototype,"enabled",void 0);G([A(oe)],Xf.prototype,"range",void 0);G([A(wn)],Xf.prototype,"color",void 0);const CW={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},SW={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var Yf=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Rp=z("debugcontactshadows");JO(n=>{const t=n.domElement.getAttribute("contactshadows");t!=null&&t!="0"&&t!="false"&&yo.auto(n)});const c1=class extends re{constructor(){super(...arguments);c(this,"autoFit",!1);c(this,"darkness",.5);c(this,"opacity",.5);c(this,"blur",4);c(this,"occludeBelowGround",!1);c(this,"backfaceShadows",!0);c(this,"minSize");c(this,"shadowsRoot",new ne);c(this,"shadowCamera");c(this,"shadowGroup",new Lr);c(this,"renderTarget");c(this,"renderTargetBlur");c(this,"plane");c(this,"occluderMesh");c(this,"blurPlane");c(this,"depthMaterial");c(this,"horizontalBlurMaterial");c(this,"verticalBlurMaterial");c(this,"textureSize",512)}static auto(e){if(e||(e=je.Current),!e)throw new Error("No context provided and no current context set.");let i=this._instances.get(e);if(!i||i.destroyed){const s=new ne;i=Ao(s,c1,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(e,i)}return e.scene.add(i.gameObject),i.fitShadows(),i}fitShadows(){Rp&&console.warn("Fitting shadows to scene"),z1(this.shadowsRoot,!1);const e=sl(this.context.scene.children,[this.shadowsRoot]),i=Math.max(1,this.blur/32),s=e.max.x-e.min.x,r=e.max.z-e.min.z;e.expandByVector(new w(i*s,0,i*r)),Rp&&Be.DrawWireBox3(e,16776960,60),this.gameObject.parent&&e.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const o=e.min,a=Math.max(1e-5,(e.max.y-o.y)*.002);e.max.y+=a,this.shadowsRoot.position.set((o.x+e.max.x)/2,o.y-a,(o.z+e.max.z)/2),this.shadowsRoot.scale.set(e.max.x-o.x,e.max.y-o.y,e.max.z-o.z),this.applyMinSize(),this.shadowsRoot.matrixWorldNeedsUpdate=!0,Rp&&console.log("Fitted shadows to scene",this.shadowsRoot.scale.clone())}awake(){z1(this.shadowsRoot,!1)}start(){Rp&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.gameObject.add(this.shadowsRoot),this.shadowsRoot.add(this.shadowGroup),this.renderTarget=new Et(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new Et(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const e=new pr(1,1).rotateX(Math.PI/2);this.gameObject instanceof J&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),Gc(this.gameObject,!1));const i=new _t({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:il});this.plane=new J(e,i),this.plane.scale.y=-1,this.plane.layers.set(2),this.shadowsRoot.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new J(this.plane.geometry,new _t({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:Wc})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.shadowsRoot.add(this.occluderMesh),this.blurPlane=new J(e),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane);const s=0,r=1;this.shadowCamera=new Mu(-1/2,1/2,1/2,-1/2,s,r),this.shadowCamera.layers.enableAll(),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new xP,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=KF,this.depthMaterial.blendEquation=JF,this.depthMaterial.onBeforeCompile=o=>{this.depthMaterial&&(o.uniforms.darkness=this.depthMaterial.userData.darkness,o.fragmentShader=`
                uniform float darkness;
                ${o.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new $e(CW),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new $e(SW),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit?this.fitShadows():this.applyMinSize()}onDestroy(){var e,i,s,r,o,a,l,h;(e=this.renderTarget)==null||e.dispose(),(i=this.renderTargetBlur)==null||i.dispose(),(s=this.depthMaterial)==null||s.dispose(),(r=this.horizontalBlurMaterial)==null||r.dispose(),(o=this.verticalBlurMaterial)==null||o.dispose(),(a=this.blurPlane)==null||a.geometry.dispose(),(l=this.plane)==null||l.geometry.dispose(),(h=this.occluderMesh)==null||h.geometry.dispose()}onBeforeRender(e){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){Rp&&console.error("ContactShadows: not initialized yet");return}const i=this.context.scene,s=this.context.renderer,r=s.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const o=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof J&&Gc(this.gameObject,!1);const a=i.background;i.background=null,i.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=_i:this.depthMaterial.side=il;const l=s.getClearAlpha();s.setClearAlpha(0);const h=s.xr.enabled;s.xr.enabled=!1;const u=this.context.scene.matrixWorldAutoUpdate;this.context.scene.matrixWorldAutoUpdate=!1;const d=s.renderLists.get(i,0),f=d.transparent;jR.length=0,d.transparent=jR,sw.length=0;for(const g of d.opaque){if(!g.object.visible)continue;const m=g.material;let v=g.material.colorWrite==!1||m.wireframe===!0||_z(g.object)===!1;!v&&g.material.linewidth!=null&&(v=!0),v&&(sw.push(g.object),g.object["needle:visible"]=g.object.visible,g.object.visible=!1)}s.setRenderTarget(this.renderTarget),s.clear(),s.render(i,this.shadowCamera),d.transparent=f;for(const g of sw)g["needle:visible"]!=null&&(g.visible=g["needle:visible"]);i.overrideMaterial=null;const p=Math.max(this.blur,.05);this.blurShadow(p*2),this.blurShadow(p*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=o,s.setRenderTarget(r),s.setClearAlpha(l),i.background=a,s.xr.enabled=h,this.context.scene.matrixWorldAutoUpdate=u}blurShadow(e){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const i=this.shadowsRoot.worldScale,s=(i.x+i.z)/2,r=i.z/s,o=i.x/s;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=e*1/this.textureSize*r;const a=this.context.renderer,l=a.getRenderTarget();a.setRenderTarget(this.renderTargetBlur),a.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=e*1/this.textureSize*o,a.setRenderTarget(this.renderTarget),a.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,a.setRenderTarget(l)}applyMinSize(){this.minSize&&this.shadowsRoot.scale.set(Math.max(this.minSize.x||0,this.shadowsRoot.scale.x),Math.max(this.minSize.y||0,this.shadowsRoot.scale.y),Math.max(this.minSize.z||0,this.shadowsRoot.scale.z))}};let yo=c1;c(yo,"_instances",new Map);Yf([A()],yo.prototype,"autoFit",void 0);Yf([A()],yo.prototype,"darkness",void 0);Yf([A()],yo.prototype,"opacity",void 0);Yf([A()],yo.prototype,"blur",void 0);Yf([A()],yo.prototype,"occludeBelowGround",void 0);Yf([A()],yo.prototype,"backfaceShadows",void 0);const jR=[],sw=new Array,h1=class{constructor(){c(this,"_quicklookButton");c(this,"_arButton");c(this,"_vrButton");c(this,"_sendToQuestButton")}static create(){return new h1}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return Ha.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const t=document.createElement("button");this._quicklookButton=t,t.dataset.needle="quicklook-button",t.innerText="Open in Quicklook",t.prepend(ys("view_in_ar"));let e=!1,i=null;return t.addEventListener("click",()=>{i=NS(ai),i||(e=!0,i=new ai),e&&(i.objectToExport=je.Current.scene),i?(t.classList.add("this-mode-is-requested"),i.exportAndOpen().then(()=>{t.classList.remove("this-mode-is-requested")}).catch(s=>{t.classList.remove("this-mode-is-requested"),console.error(s)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(t),t}createARButton(t){var s;if(this._arButton)return this._arButton;const e="immersive-ar",i=document.createElement("button");return this._arButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-ar-button",i.innerText="Enter AR",i.prepend(ys("view_in_ar")),i.title="Click to start an AR session",i.addEventListener("click",()=>Le.start(e,t)),this.updateSessionSupported(i,e),this.listenToXRSessionState(i,e),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),sf()||(s=navigator.xr)==null||s.addEventListener("devicechange",()=>this.updateSessionSupported(i,e)),i}createVRButton(t){var s;if(this._vrButton)return this._vrButton;const e="immersive-vr",i=document.createElement("button");return this._vrButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-vr-button",i.innerText="Enter VR",i.prepend(ys("panorama_photosphere")),i.title="Click to start a VR session",i.addEventListener("click",()=>Le.start(e,t)),this.updateSessionSupported(i,e),this.listenToXRSessionState(i,e),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),sf()||(s=navigator.xr)==null||s.addEventListener("devicechange",()=>this.updateSessionSupported(i,e)),i}createSendToQuestButton(){var i;if(this._sendToQuestButton)return this._sendToQuestButton;const t="https://oculus.com/open_url/?url=",e=document.createElement("button");return this._sendToQuestButton=e,e.dataset.needle="webxr-sendtoquest-button",e.innerText="Open on Quest",e.prepend(ys("share_windows")),e.title="Click to send this page to the Oculus Browser on your Quest",e.addEventListener("click",()=>{const s=encodeURIComponent(window.location.href),r=t+s;window.open(r)==null&&bi("This page doesn't allow popups. Please paste "+r+" into your browser.")}),this.listenToXRSessionState(e),this.hideElementDuringXRSession(e),sf()||(i=navigator.xr)==null||i.addEventListener("devicechange",()=>{var s;(s=navigator.xr)!=null&&s.isSessionSupported("immersive-vr")?e.style.display="none":e.style.display=""}),e}createQRCode(){return Ha.getOrCreate().createQRCode()}updateSessionSupported(t,e){if(!("xr"in navigator)){t.style.display="none";return}Le.isSessionSupported(e).then(i=>{t.style.display=i?"":"none",ve()&&!i&&console.log('[WebXR] "'+e+'" is not supported on this device â€“ make sure your server runs using HTTPS and you have a device connected that supports '+e)})}hideElementDuringXRSession(t){CS(e=>{t["previous-display"]=t.style.display,t.style.display="none"}),Gk(e=>{t["previous-display"]!=null&&(t.style.display=t["previous-display"])})}listenToXRSessionState(t,e){e&&(Le.onSessionRequestStart(i=>{i.mode===e?t.classList.add("this-mode-is-requested"):(t["was-disabled"]=t.disabled,t.disabled=!0,t.classList.add("other-mode-is-requested"))}),Le.onSessionRequestEnd(i=>{t.classList.remove("this-mode-is-requested"),t.classList.remove("other-mode-is-requested"),t.disabled=t["was-disabled"]}))}};let rh=h1;c(rh,"_instance");var Rn=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const My=z("debugspriterenderer"),EW=z("wireframe"),t0=class{static getOrCreateGeometry(t){if(t.__cached_geometry)return t.__cached_geometry;if(t.guid&&t0.cache[t.guid])return My&&console.log("Take cached geometry for sprite",t.guid),t0.cache[t.guid];const e=new Ht;t.__cached_geometry=e;const i=new Float32Array(t.triangles.length*3),s=new Float32Array(t.triangles.length*2);for(let r=0;r<t.triangles.length;r+=1){const o=t.triangles[r];i[r*3]=-t.vertices[o].x,i[r*3+1]=t.vertices[o].y,i[r*3+2]=0;const a=t.uv[o];s[r*2]=a.x,s[r*2+1]=1-a.y}return e.setAttribute("position",new Ke(i,3)),e.setAttribute("uv",new Ke(s,2)),t.guid&&(this.cache[t.guid]=e),My&&console.log("Built sprite geometry",t,e),e}};let bu=t0;c(bu,"cache",{});var ky;(function(n){n[n.Simple=0]="Simple",n[n.Sliced=1]="Sliced",n[n.Tiled=2]="Tiled"})(ky||(ky={}));class IW{constructor(){c(this,"x");c(this,"y")}}function P2(n){n&&(n.colorSpace!=Ge&&(n.colorSpace=Ge,n.needsUpdate=!0),n.minFilter==mi&&n.magFilter==mi&&(n.anisotropy=1,n.needsUpdate=!0))}class Ac{constructor(t){c(this,"guid");c(this,"texture");c(this,"triangles");c(this,"uv");c(this,"vertices");c(this,"__cached_geometry");c(this,"_mesh");c(this,"_material");t&&(this.texture=t,this.triangles=[0,1,2,0,2,3],this.uv=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],this.vertices=[{x:-.5,y:-.5},{x:.5,y:-.5},{x:.5,y:.5},{x:-.5,y:.5}])}get mesh(){return this._mesh||(this._mesh=new J(bu.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&P2(this.texture),this._material=new _t({map:this.texture,color:16777215,side:_i,transparent:!0})),this._material}getGeometry(){return bu.getOrCreateGeometry(this)}}Rn([A()],Ac.prototype,"guid",void 0);Rn([A(At)],Ac.prototype,"texture",void 0);Rn([km()],Ac.prototype,"triangles",void 0);Rn([km()],Ac.prototype,"uv",void 0);Rn([km()],Ac.prototype,"vertices",void 0);const rw=Symbol("spriteOwner");class Ru{constructor(){c(this,"sprites")}}Rn([A(Ac)],Ru.prototype,"sprites",void 0);class el{constructor(){c(this,"spriteSheet");c(this,"index",0)}static create(){const t=new el;return t.spriteSheet=new Ru,t}set sprite(t){t&&(this.spriteSheet?((this.index===null||this.index===void 0)&&(this.index=0),this.spriteSheet.sprites[this.index]=t):(this.spriteSheet=new Ru,this.spriteSheet.sprites=[t],this.index=0))}get sprite(){if(this.spriteSheet)return this.spriteSheet.sprites[this.index]}update(t){if(!this.spriteSheet)return;const e=this.index;if(e<0||e>=this.spriteSheet.sprites.length)return;const i=this.spriteSheet.sprites[e],s=i==null?void 0:i.texture;if(s&&(P2(s),!i.__hasLoadedProgressive)){i.__hasLoadedProgressive=!0;const r=s;ht.assignTextureLOD(s,0).then(o=>{o instanceof At&&(i.texture=o,(t==null?void 0:t.map)===r&&(t.map=o,t.needsUpdate=!0))})}}}Rn([A(Ru)],el.prototype,"spriteSheet",void 0);Rn([A()],el.prototype,"index",void 0);class jr extends re{constructor(){super(...arguments);c(this,"drawMode",ky.Simple);c(this,"size",{x:1,y:1});c(this,"color");c(this,"sharedMaterial");c(this,"transparent",!0);c(this,"cutoutThreshold",0);c(this,"castShadows",!1);c(this,"renderOrder",0);c(this,"toneMapped",!0);c(this,"_spriteSheet");c(this,"_currentSprite")}set texture(e){var s;if(!this._spriteSheet)return;const i=(s=this._spriteSheet.spriteSheet)==null?void 0:s.sprites[this.spriteIndex];i&&(i.texture=e,this.updateSprite())}addSprite(e,i=!1){var r,o;if(this._spriteSheet||(this._spriteSheet=el.create()),!this._spriteSheet.spriteSheet)return-1;(r=this._spriteSheet.spriteSheet)==null||r.sprites.push(e);const s=((o=this._spriteSheet.spriteSheet)==null?void 0:o.sprites.length)-1;return i&&(this.spriteIndex=s),s}get sprite(){return this._spriteSheet}set sprite(e){if(e!==this._spriteSheet)if(typeof e=="number"){const i=Math.floor(e);this.spriteIndex=i;return}else e instanceof Ac?(this._spriteSheet||(this._spriteSheet=el.create()),this._spriteSheet.sprite!=e&&(this._spriteSheet.sprite=e,this.updateSprite())):e!=this._spriteSheet&&(this._spriteSheet=e,this.updateSprite())}set spriteIndex(e){this._spriteSheet&&e!==this.spriteIndex&&(this._spriteSheet.index=e,this.updateSprite())}get spriteIndex(){var e;return((e=this._spriteSheet)==null?void 0:e.index)??0}get spriteFrames(){var e,i;return((i=(e=this._spriteSheet)==null?void 0:e.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,this._spriteSheet||(this._spriteSheet=new el,this._spriteSheet.spriteSheet=new Ru),My&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(e=!1){var r;if(!this.__didAwake&&!e)return!1;const i=this._spriteSheet;if(!((r=i==null?void 0:i.spriteSheet)!=null&&r.sprites))return console.warn("SpriteRenderer has no data or spritesheet assigned..."),!1;const s=i.spriteSheet.sprites[this.spriteIndex];if(!s)return My&&console.warn("Sprite not found",this.spriteIndex,i.spriteSheet.sprites),!1;if(this._currentSprite)this._currentSprite.geometry=bu.getOrCreateGeometry(s),this._currentSprite.material.map=s.texture;else{const o=new _t({color:16777215,side:_i});if(EW&&(o.wireframe=!0),this.color&&(o.color||(o.color=new be),o.color.copy(this.color),o.opacity=this.color.alpha),o.transparent=!0,o.toneMapped=this.toneMapped,s.texture&&!o.wireframe){let a=s.texture;a[rw]!==void 0&&a[rw]!==this&&this.spriteFrames>1&&(a=s.texture=a.clone()),a[rw]=this,o.map=a}this.sharedMaterial=o,this._currentSprite=new J(bu.getOrCreateGeometry(s),o),this._currentSprite.renderOrder=Math.round(this.renderOrder),ht.assignTextureLOD(o,0)}return this._currentSprite.parent!==this.gameObject&&(this.drawMode===ky.Tiled&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,i==null||i.update(this.sharedMaterial),!0}}Rn([A()],jr.prototype,"drawMode",void 0);Rn([A(IW)],jr.prototype,"size",void 0);Rn([A(Ut)],jr.prototype,"color",void 0);Rn([A(mt)],jr.prototype,"sharedMaterial",void 0);Rn([A()],jr.prototype,"transparent",void 0);Rn([A()],jr.prototype,"cutoutThreshold",void 0);Rn([A()],jr.prototype,"castShadows",void 0);Rn([A()],jr.prototype,"renderOrder",void 0);Rn([A()],jr.prototype,"toneMapped",void 0);Rn([A(el)],jr.prototype,"sprite",null);const GR=z("debugwebxr"),TW=new ae().makeRotationY(Math.PI);class ph extends re{constructor(){super(...arguments);c(this,"_arScale",1);c(this,"invertForward",!1);c(this,"customReticle");c(this,"arTouchTransform",!0);c(this,"autoPlace",!1);c(this,"autoCenter",!1);c(this,"useXRAnchor",!1);c(this,"_isPlacing",!0);c(this,"_startOffset",new ae);c(this,"_createdPlacementObject",null);c(this,"_reparentedComponents",[]);c(this,"_placementScene",new ws);c(this,"_reticle",[]);c(this,"_hits",[]);c(this,"_placementStartTime",-1);c(this,"_rigPlacementMatrix");c(this,"_anchor",null);c(this,"userInput");c(this,"onPlaceScene",e=>{var r;if(this._isPlacing==!1||e!=null&&e.used)return;let i=this._reticle[0];if(!i){console.warn("No reticle to place...");return}if(!i.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((r=Le.active)!=null&&r.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let s=this._hits[0];if(e&&e.origin instanceof Vk){const o=this._reticle[e.origin.index];o&&(i=o,s=this._hits[e.origin.index])}if(e&&(e.stopImmediatePropagation(),e.stopPropagation(),e.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),i.position.copy(i.lastPos),i.quaternion.copy(i.lastQuat),this.onApplyPose(i),this.useXRAnchor&&this.onCreateAnchor(Le.active,s),this.context.xr)for(const o of this.context.xr.controllers)o.cancelHitTestSource()});c(this,"upVec",new w(0,1,0));c(this,"lookPoint",new w);c(this,"worldUpVec",new w(0,1,0))}static onPlaced(e){const i="placed";return this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(e),()=>{const s=this._eventListeners[i].indexOf(e);s>=0&&this._eventListeners[i].splice(s,1)}}get arScale(){return this._arScale}set arScale(e){e!==this._arScale&&(this._arScale=e,this.onScaleChanged())}onEnable(){var e;(e=this.customReticle)==null||e.preload()}supportsXR(e){return e==="immersive-ar"}onEnterXR(e){GR&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new ne;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let s=this.context.scene.children.length-1;s>=0;s--){const r=this.context.scene.children[s];this._placementScene.add(r)}if(this.context.scene.add(i),this.autoCenter){const s=sl(this._placementScene.children),r=s.getCenter(new w),o=s.getSize(new w),a=new ae;a.makeTranslation(r.x,r.y-o.y*.5,r.z),this._startOffset.multiply(a)}this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),Q.addComponent(i,this);for(const s of this._reticle)wo(s);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:Br.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:Br.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(e){var i,s,r,o;if(e.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=e.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let l=!1;if(e.xr.isPassThrough&&e.xr.controllers.length>0&&!this.autoPlace)for(const h of e.xr.controllers){const u=h.getHitTest();u&&(l=!0,this.updateReticleAndHits(e.xr,h.index,u,e.xr.rigScale))}if(!l){const h=e.xr.getHitTest();h&&this.updateReticleAndHits(e.xr,0,h,e.xr.rigScale)}}else{if(this._anchor&&e.xr.referenceSpace){const a=e.xr.frame.getPose(this._anchor.anchorSpace,e.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const l=e.xr.convertSpace(a.transform),h=this._reticle[0];h&&(h.position.copy(l.position),h.quaternion.copy(l.quaternion),this.onApplyPose(h))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new Bd(this.context)),(s=this.userInput)==null||s.enable()):(r=this.userInput)==null||r.disable(),this.arTouchTransform&&((o=this.userInput)!=null&&o.hasChanged)){if(e.xr.rig){const a=e.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(e,i,s,r){this._hits[i]=s.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=Pm(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new J(new ZF(.07,.09,32).rotateX(-Math.PI/2),new _t({side:_i,depthTest:!1,depthWrite:!1,transparent:!0,opacity:1,color:15658734})),o.name="AR Placement Reticle";if(GR){const a=new dr(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}if(o.lastPos=o.lastPos||s.position.clone(),o.lastQuat=o.lastQuat||s.quaternion.clone(),o.position.copy(o.lastPos.lerp(s.position,this.context.time.deltaTime/.1)),o.lastPos.copy(o.position),o.quaternion.copy(o.lastQuat.slerp(s.quaternion,this.context.time.deltaTime/.05)),o.lastQuat.copy(o.quaternion),o.scale.set(r,r,r),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace)if(this.upVec.set(0,1,0).applyQuaternion(o.quaternion),this.upVec.dot(Re(0,1,0))>.9){let l=o["autoplace:timer"]||0;l>=1?(o.visible=!1,this.onPlaceScene(null)):(l+=this.context.time.deltaTime,o["autoplace:timer"]=l)}else o["autoplace:timer"]=0}onScaleChanged(){}onRevertSceneChanges(){var e;for(const i of this._reticle)i&&(i.visible=!1,i==null||i.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const s=this._placementScene.children[i];this.context.scene.add(s)}(e=this._createdPlacementObject)==null||e.removeFromParent();for(const i of this._reparentedComponents)Q.addComponent(i.originalObject,i.comp)}async onCreateAnchor(e,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),ve()&&qt("Hit does not support creating an anchor");return}else{const s=await i.createAnchor(e.viewerPose.transform);e.running&&s&&(this._anchor=s)}}applyViewBasedTransform(e){const i=this.context.mainCamera,s=e,r=i.worldPosition,o=s.worldPosition;this.upVec.set(0,1,0).applyQuaternion(e.quaternion);const a=i.worldPosition;a&&e.position.clone().sub(a).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const l=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,h=30;l>h&&l<180-h||l<-h&&l>-180+h?(this.lookPoint.copy(e.position).add(this.upVec),this.lookPoint.y=e.position.y,e.lookAt(this.lookPoint)):(r.y=o.y,e.lookAt(r))}onApplyPose(e){var r,o,a,l;const i=(o=(r=Le.active)==null?void 0:r.rig)==null?void 0:o.gameObject;if(!i){console.warn("No rig object to place");return}(a=Le.active)!=null&&a.rigScale;const s=i.parent||this.context.scene;this._rigPlacementMatrix?(l=this._rigPlacementMatrix)==null||l.decompose(i.position,i.quaternion,i.scale):this._rigPlacementMatrix=i.matrix.clone(),this.applyViewBasedTransform(e),e.updateMatrix(),this.context.scene.add(e),e.attach(i),e.removeFromParent(),i.scale.set(this.arScale,this.arScale,this.arScale),i.position.multiplyScalar(this.arScale),i.updateMatrix(),this.invertForward&&i.matrix.premultiply(TW),i.matrix.premultiply(this._startOffset),i.matrix.decompose(i.position,i.quaternion,i.scale),s.add(i)}}c(ph,"_eventListeners",{});const i0=class{constructor(t){c(this,"oneFingerDrag",!0);c(this,"twoFingerRotate",!0);c(this,"twoFingerScale",!0);c(this,"factor",1);c(this,"context");c(this,"offset");c(this,"plane");c(this,"_scale",1);c(this,"_hasChanged",!1);c(this,"_enabled",!1);c(this,"currentlyUsedPointerIds",new Set);c(this,"currentlyUnusedPointerIds",new Set);c(this,"onPointerDownEarly",t=>{this.isActive&&t.stopPropagation()});c(this,"onPointerDownLate",t=>{t.used?this.currentlyUsedPointerIds.add(t.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(t.pointerId)});c(this,"onPointerUpEarly",t=>{this.currentlyUsedPointerIds.delete(t.pointerId),this.currentlyUnusedPointerIds.delete(t.pointerId)});c(this,"prev",new Map);c(this,"_didMultitouch",!1);c(this,"touchStart",t=>{if(!t.defaultPrevented)for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e],s=gU()&&i.clientY<window.innerHeight*.1;this.prev.has(i.identifier)||this.prev.set(i.identifier,{ignore:s,x:0,z:0,screenx:0,screeny:0});const r=this.prev.get(i.identifier);if(r){const o=this.getPositionOnPlane(i.clientX,i.clientY);r.x=o.x,r.z=o.z,r.screenx=i.clientX,r.screeny=i.clientY}}});c(this,"touchEnd",t=>{t.touches.length<=0&&(this._didMultitouch=!1);for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];this.prev.delete(i.identifier)}});c(this,"touchMove",t=>{if(!t.defaultPrevented&&this.isActive){if(t.touches.length===1){if(this._didMultitouch)return;const e=t.touches[0],i=this.prev.get(e.identifier);if(!i||i.ignore)return;const s=this.getPositionOnPlane(e.clientX,e.clientY),r=s.x-i.x,o=s.z-i.z;if(r===0&&o===0)return;this.oneFingerDrag&&this.addMovement(r,o),i.x=s.x,i.z=s.z,i.screenx=e.clientX,i.screeny=e.clientY;return}else if(t.touches.length===2){this._didMultitouch=!0;const e=t.touches[0],i=t.touches[1],s=this.prev.get(e.identifier),r=this.prev.get(i.identifier);if(!s||!r)return;if(this.twoFingerRotate){const o=Math.atan2(e.clientY-i.clientY,e.clientX-i.clientX),a=Math.atan2(s.screeny-r.screeny,s.screenx-r.screenx),l=o-a;Math.abs(l)>.001&&this.addRotation(l)}if(this.twoFingerScale){const o=e.clientX-i.clientX,a=e.clientY-i.clientY,l=Math.sqrt(o*o+a*a),h=s.screenx-r.screenx,u=s.screeny-r.screeny,d=Math.sqrt(h*h+u*u),f=l-d;Math.abs(f)>2&&this.addScale(f)}s.screenx=e.clientX,s.screeny=e.clientY,r.screenx=i.clientX,r.screeny=i.clientY}}});c(this,"_raycaster",new ku);c(this,"_intersection",new w);c(this,"_screenPos",new w);c(this,"_tempMatrix",new ae);this.context=t,this.offset=new ae,this.plane=new ic,this.plane.setFromNormalAndCoplanarPoint(i0.up,i0.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(t,e){this._hasChanged=!1,e?(this.offset.invert(),t.premultiply(this.offset)):t.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:Br.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:Br.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:Br.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:Br.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:Br.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:Br.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(t,e){const i=this.context.mainCamera;return this._screenPos.x=t/window.innerWidth*2-1,this._screenPos.y=-(e/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(t,e){t/=this._scale,e/=this._scale,t*=this.factor,e*=this.factor,this.offset.elements[12]+=t,this.offset.elements[14]+=e,(t!==0||e!==0)&&(this._hasChanged=!0)}addScale(t){t/=window.innerWidth,t*=-1,this._scale*=1+t,this._tempMatrix.makeScale(1-t,1-t,1-t),this.offset.premultiply(this._tempMatrix),t!==0&&(this._hasChanged=!0)}addRotation(t){t*=-1,this._tempMatrix.makeRotationY(t),this.offset.premultiply(this._tempMatrix),t!==0&&(this._hasChanged=!0)}};let Bd=i0;c(Bd,"up",new w(0,1,0)),c(Bd,"zero",new w(0,0,0)),c(Bd,"one",new w(1,1,1));var Kf=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class vc extends re{constructor(){super(...arguments);c(this,"position","bottom");c(this,"showNeedleLogo",!0);c(this,"showSpatialMenu");c(this,"createFullscreenButton");c(this,"createMuteButton");c(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(dc()||this.context.menu.showQRCodeButton(!0))}}Kf([A()],vc.prototype,"position",void 0);Kf([A()],vc.prototype,"showNeedleLogo",void 0);Kf([A()],vc.prototype,"showSpatialMenu",void 0);Kf([A()],vc.prototype,"createFullscreenButton",void 0);Kf([A()],vc.prototype,"createMuteButton",void 0);Kf([A()],vc.prototype,"createQRCodeButton",void 0);const Ri={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function M2(n){const t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function RW(n){if(!n)throw new Error("No basePath supplied");return await M2(`${n}/profilesList.json`)}async function BW(n,t,e=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const s=await RW(t);let r;if(n.profiles.some(l=>{const h=s[l];return h&&(r={profileId:l,profilePath:`${t}/${h.path}`,deprecated:!!h.deprecated}),!!r}),!r){if(!e)throw new Error("No matching profile name found");const l=s[e];if(!l)throw new Error(`No matching profile name found and default profile "${e}" missing.`);r={profileId:e,profilePath:`${t}/${l.path}`,deprecated:!!l.deprecated}}const o=await M2(r.profilePath);let a;if(i){let l;if(n.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const PW={xAxis:0,yAxis:0,button:0,state:Ri.ComponentState.DEFAULT};function MW(n=0,t=0){let e=n,i=t;if(Math.sqrt(n*n+t*t)>1){const o=Math.atan2(t,n);e=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:i*.5+.5}}class kW{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===Ri.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(PW)}updateFromComponent({xAxis:t,yAxis:e,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=MW(t,e);switch(this.componentProperty){case Ri.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case Ri.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case Ri.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case Ri.ComponentProperty.STATE:this.valueNodeProperty===Ri.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class DW{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(i=>{const s=new kW(e.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:Ri.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=Ri.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){const e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=Ri.ComponentState.PRESSED:(e.touched||this.values.button>Ri.ButtonTouchThreshold)&&(this.values.state=Ri.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Ri.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Ri.AxisTouchThreshold&&(this.values.state=Ri.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Ri.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Ri.AxisTouchThreshold&&(this.values.state=Ri.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}}class OW{constructor(t,e,i){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=i,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new DW(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}}const LW="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",FW="generic-trigger";let UW=class extends ne{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t?this:(this.envMap=t,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(i=>{const{valueNode:s,minNode:r,maxNode:o,value:a,valueNodeProperty:l}=i;s&&(l===Ri.VisualResponseProperty.VISIBILITY?s.visible=a:l===Ri.VisualResponseProperty.TRANSFORM&&(s.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),s.position.lerpVectors(r.position,o.position,a)))})}))}};function NW(n,t){Object.values(n.components).forEach(e=>{const{type:i,touchPointNodeName:s,visualResponses:r}=e;if(i===Ri.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(s),e.touchPointNode){const o=new Bu(.001),a=new _t({color:255}),l=new J(o,a);e.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(r).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:h,valueNodeProperty:u}=o;if(u===Ri.VisualResponseProperty.TRANSFORM){if(o.minNode=t.getObjectByName(l),o.maxNode=t.getObjectByName(h),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${h} in the model`);return}}o.valueNode=t.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function HR(n,t){NW(n.motionController,t),n.envMap&&t.traverse(e=>{e.isMesh&&(e.material.envMap=n.envMap,e.material.needsUpdate=!0)}),n.layers.mask!=0&&t.traverse(e=>{e.layers.mask=n.layers.mask}),n.add(t)}class zW{constructor(t=null,e=null){this.gltfLoader=t,this.path=LW,this._assetCache={},this.onLoad=e,this.gltfLoader||(this.gltfLoader=new rl)}setPath(t){return this.path=t,this}createControllerModel(t){const e=new UW;let i=null;return t.addEventListener("connected",s=>{const r=s.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||BW(r,this.path,FW).then(({profile:o,assetPath:a})=>{e.motionController=new OW(r,o,a);const l=this._assetCache[e.motionController.assetUrl];if(l)i=l.scene.clone(),HR(e,i),this.onLoad&&this.onLoad(i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,h=>{this._assetCache[e.motionController.assetUrl]=h,i=h.scene.clone(),HR(e,i),this.onLoad&&this.onLoad(i)},null,()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),t.addEventListener("disconnected",()=>{e.motionController=null,e.remove(i),i=null}),e}}const QW="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class jW{constructor(t,e,i,s,r=null,o=null){this.controller=e,this.handModel=t,this.bones=[],r===null&&(r=new rl,r.setPath(i||QW)),r.load(`${s}.glb`,a=>{const l=a.scene.children[0];this.handModel.add(l),l.layers.mask=this.handModel.layers.mask;const h=l.getObjectByProperty("type","SkinnedMesh");h.frustumCulled=!1,h.castShadow=!0,h.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(d=>{const f=l.getObjectByName(d);f!==void 0?f.jointName=d:console.warn(`Couldn't find ${d} in ${s} hand mesh`),this.bones.push(f)}),o&&o(l)})}updateMesh(){const t=this.controller.joints;for(let e=0;e<this.bones.length;e++){const i=this.bones[e];if(i){const s=t[i.jointName];if(s.visible){const r=s.position;i.position.copy(r),i.quaternion.copy(s.quaternion)}}}}}var rb=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const fa=z("debugwebxr"),Rc=new Array;class lc extends re{constructor(){super(...arguments);c(this,"createControllerModel",!0);c(this,"createHandModel",!0);c(this,"customLeftHand");c(this,"customRightHand");c(this,"_models",new Array)}supportsXR(e){return e==="immersive-vr"||e==="immersive-ar"}async onXRControllerAdded(e){var r,o,a;if(!(e.xr.isVR||e.xr.isPassThrough))return;const{controller:s}=e;if(fa&&console.warn("Add Controller Model for",s.side,s.index),this.createControllerModel||this.createHandModel){if(s.hand){if(this.createHandModel){const l=await this.loadHandModel(s);if(!l||!s.connected||!s.isHand){(r=l==null?void 0:l.handObject)==null||r.removeFromParent(),(a=(o=l==null?void 0:l.handmesh)==null?void 0:o.controller)==null||a.removeFromParent();return}this._models.push({controller:s,model:l.handObject,handmesh:l.handmesh}),this._models.sort((h,u)=>h.controller.index-u.controller.index),this.scene.add(l.handObject),s.model=l.handObject}}else if(this.createControllerModel){const l=await s.getModelUrl();if(l){const h=await this.loadModel(s,l);if(!h||!s.connected||s.isHand)return;this._models.push({controller:s,model:h}),this._models.sort((u,d)=>u.controller.index-d.controller.index),this.scene.add(h),h.traverse(u=>{u.layers.set(2),u.matrixWorldAutoUpdate=!1,u.matrixAutoUpdate=!1,u.updateMatrix()}),s.model=h}else s.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+s.side)}}}onXRControllerRemoved(e){var r;const i=this._models.findIndex(o=>o.controller===e.controller),s=this._models[i];s&&(this._models.splice(i,1),s.handmesh&&((r=s.handmesh.handModel)==null||r.removeFromParent(),s.handmesh=void 0),s.model&&(s.model.removeFromParent(),s.model=void 0))}onBeforeRender(){if(Le.active&&(fa&&(Rc[0]=Date.now()),this.updateRendering(Le.active),fa)){const e=Date.now()-Rc[0];Rc.push(e),Rc.length>=30&&(Rc[0]=0,Rc.reduce((i,s)=>i+s,0)/Rc.length,Rc.length=0)}}onLeaveXR(e){var i;for(const s of this._models)s&&((i=s.model)==null||i.removeFromParent(),s.controller.model===s.model&&(s.controller.model=null));this._models.length=0}updateRendering(e){var i,s,r,o,a;for(let l=0;l<this._models.length;l++){const h=this._models[l];if(!h)continue;const u=h.controller;if(!u.connected){fa&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",u.side,u.hand);continue}if(h.model&&!h.handmesh)h.model.matrixAutoUpdate=!1,h.model.matrixWorldAutoUpdate=!1,h.model.matrix.copy(u.gripMatrix),h.model.visible=u.isTracking,(i=e.rig)==null||i.gameObject.add(h.model);else if(u.inputSource.hand&&h.handmesh){const d=e.referenceSpace,f=this.context.renderer.xr.getHand(u.index);if(d&&e.frame.getJointPose){for(const p of u.inputSource.hand.values()){const g=f.joints[p.jointName];if(g){const m=u.getHandJointPose(p);if(m){const v=m.transform.position,y=m.transform.orientation;g.position.copy(v),g.quaternion.copy(y),g.matrixAutoUpdate=!1,g.matrixWorldAutoUpdate=!1}g.visible=m!=null}}h.model&&(h.model.visible=u.isTracking,h.model.visible&&h.model.parent!==((s=e.rig)==null?void 0:s.gameObject)&&((r=e.rig)==null||r.gameObject.add(h.model))),(o=h.model)!=null&&o.visible&&((a=h.handmesh)==null||a.updateMesh(),h.model.matrixWorldAutoUpdate=!1,h.model.matrixAutoUpdate=!1,h.model.matrix.identity(),h.model.applyMatrix4(lf))}}}}async loadModel(e,i){var o;if(!e.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",e.side),null;const r=await et.getOrCreate("",i).instantiate();return ET(r),(o=Le.active)!=null&&o.isPassThrough&&r.traverseVisible(a=>{this.makeOccluder(a)}),r}async loadHandModel(e){const i=this.context,s=i.renderer.xr.getHand(e.index);s||(fa?Be.DrawLabel(e.rayWorldPosition,"No hand found for index "+e.index,.05,5):console.warn("No hand found for index "+e.index));const r=new rl;F0(r,i),await S2(r,i,this.sourceId??""),r.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const o=e.side==="left"?"left.":"right.",a=e.side==="left"?this.customLeftHand:this.customRightHand;if(a)if(!a.uri.includes(o))console.warn("XRControllerModel: custom hand model must be named "+o),qt("Custom Hand: unexpected name, please see the console for details");else{const u=a.uri.substring(0,a.uri.indexOf(o));r.setPath(u),fa&&console.log("XRControllerModel: loading custom hand model from "+u)}const l=new ne;ET(l);const h=new jW(l,s,r.path,e.inputSource.handedness,r,u=>{u.traverse(d=>{var f;d.layers.set(2),(f=Le.active)!=null&&f.isPassThrough&&this.makeOccluder(d),d instanceof J&&ht.assignMeshLOD(d,0)}),e.connected||(fa&&Be.DrawLabel(e.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),u.removeFromParent())});if(fa&&l.add(new dr(.5)),e.inputSource.hand){fa&&console.log(e.inputSource.hand);for(const u of e.inputSource.hand.values())if(s.joints[u.jointName]===void 0){const d=new Lr;d.matrixAutoUpdate=!1,d.visible=!0,s.joints[u.jointName]=d,s.add(d)}}else fa&&Be.DrawLabel(e.rayWorldPosition,"No inputSource.hand found for index "+e.index,.05,5);return{handObject:l,handmesh:h}}makeOccluder(e){if(e instanceof J){let i=e.material;i instanceof mt&&(i=e.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,e.receiveShadow=!1,e.renderOrder=-100)}}}c(lc,"factory",new zW);rb([A()],lc.prototype,"createControllerModel",void 0);rb([A()],lc.prototype,"createHandModel",void 0);rb([A(et)],lc.prototype,"customLeftHand",void 0);rb([A(et)],lc.prototype,"customRightHand",void 0);const VR=new xn,ZA=new w;class k2 extends jP{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new cn(t,3)),this.setAttribute("uv",new cn(e,2))}applyMatrix4(t){const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),i.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const i=new Qw(e,6,1);return this.setAttribute("instanceStart",new Xc(i,3,0)),this.setAttribute("instanceEnd",new Xc(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const i=new Qw(e,6,1);return this.setAttribute("instanceColorStart",new Xc(i,3,0)),this.setAttribute("instanceColorEnd",new Xc(i,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new $F(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new xn);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),VR.setFromBufferAttribute(e),this.boundingBox.union(VR))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new uc),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let s=0;for(let r=0,o=t.count;r<o;r++)ZA.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(ZA)),ZA.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(ZA));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}}Hn.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new oe(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};nf.line={uniforms:u0.merge([Hn.common,Hn.fog,Hn.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class mE extends $e{constructor(t){super({type:"LineMaterial",uniforms:u0.clone(nf.line.uniforms),vertexShader:nf.line.vertexShader,fragmentShader:nf.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(t===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const WR=new w,qR=new w,Fn=new Fe,Un=new Fe,pa=new Fe,ow=new w,aw=new ae,Wn=new FC,XR=new w,$A=new xn,ev=new uc,ga=new Fe;let Fa,_u;function YR(n,t,e){return ga.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),ga.multiplyScalar(1/ga.w),ga.x=_u/e.width,ga.y=_u/e.height,ga.applyMatrix4(n.projectionMatrixInverse),ga.multiplyScalar(1/ga.w),Math.abs(Math.max(ga.x,ga.y))}function GW(n,t){const e=n.matrixWorld,i=n.geometry,s=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,s.count);for(let a=0,l=o;a<l;a++){Wn.start.fromBufferAttribute(s,a),Wn.end.fromBufferAttribute(r,a),Wn.applyMatrix4(e);const h=new w,u=new w;Fa.distanceSqToSegment(Wn.start,Wn.end,u,h),u.distanceTo(h)<_u*.5&&t.push({point:u,pointOnLine:h,distance:Fa.origin.distanceTo(u),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function HW(n,t,e){const i=t.projectionMatrix,r=n.material.resolution,o=n.matrixWorld,a=n.geometry,l=a.attributes.instanceStart,h=a.attributes.instanceEnd,u=Math.min(a.instanceCount,l.count),d=-t.near;Fa.at(1,pa),pa.w=1,pa.applyMatrix4(t.matrixWorldInverse),pa.applyMatrix4(i),pa.multiplyScalar(1/pa.w),pa.x*=r.x/2,pa.y*=r.y/2,pa.z=0,ow.copy(pa),aw.multiplyMatrices(t.matrixWorldInverse,o);for(let f=0,p=u;f<p;f++){if(Fn.fromBufferAttribute(l,f),Un.fromBufferAttribute(h,f),Fn.w=1,Un.w=1,Fn.applyMatrix4(aw),Un.applyMatrix4(aw),Fn.z>d&&Un.z>d)continue;if(Fn.z>d){const _=Fn.z-Un.z,x=(Fn.z-d)/_;Fn.lerp(Un,x)}else if(Un.z>d){const _=Un.z-Fn.z,x=(Un.z-d)/_;Un.lerp(Fn,x)}Fn.applyMatrix4(i),Un.applyMatrix4(i),Fn.multiplyScalar(1/Fn.w),Un.multiplyScalar(1/Un.w),Fn.x*=r.x/2,Fn.y*=r.y/2,Un.x*=r.x/2,Un.y*=r.y/2,Wn.start.copy(Fn),Wn.start.z=0,Wn.end.copy(Un),Wn.end.z=0;const m=Wn.closestPointToPointParameter(ow,!0);Wn.at(m,XR);const v=ct.lerp(Fn.z,Un.z,m),y=v>=-1&&v<=1,b=ow.distanceTo(XR)<_u*.5;if(y&&b){Wn.start.fromBufferAttribute(l,f),Wn.end.fromBufferAttribute(h,f),Wn.start.applyMatrix4(o),Wn.end.applyMatrix4(o);const _=new w,x=new w;Fa.distanceSqToSegment(Wn.start,Wn.end,x,_),e.push({point:x,pointOnLine:_,distance:Fa.origin.distanceTo(x),object:n,face:null,faceIndex:f,uv:null,uv1:null})}}}class VW extends J{constructor(t=new k2,e=new mE({color:Math.random()*16777215})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,i=t.attributes.instanceEnd,s=new Float32Array(2*e.count);for(let o=0,a=0,l=e.count;o<l;o++,a+=2)WR.fromBufferAttribute(e,o),qR.fromBufferAttribute(i,o),s[a]=a===0?0:s[a-1],s[a+1]=s[a]+WR.distanceTo(qR);const r=new Qw(s,2,1);return t.setAttribute("instanceDistanceStart",new Xc(r,1,0)),t.setAttribute("instanceDistanceEnd",new Xc(r,1,1)),this}raycast(t,e){const i=this.material.worldUnits,s=t.camera;s===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=t.params.Line2!==void 0&&t.params.Line2.threshold||0;Fa=t.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;_u=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),ev.copy(a.boundingSphere).applyMatrix4(o);let h;if(i)h=_u*.5;else{const d=Math.max(s.near,ev.distanceToPoint(Fa.origin));h=YR(s,d,l.resolution)}if(ev.radius+=h,Fa.intersectsSphere(ev)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),$A.copy(a.boundingBox).applyMatrix4(o);let u;if(i)u=_u*.5;else{const d=Math.max(s.near,$A.distanceToPoint(Fa.origin));u=YR(s,d,l.resolution)}$A.expandByScalar(u),Fa.intersectsBox($A)!==!1&&(i?GW(this,e):HW(this,s,e))}}class D2 extends k2{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const e=t.length-3,i=new Float32Array(2*e);for(let s=0;s<e;s+=3)i[2*s]=t[s],i[2*s+1]=t[s+1],i[2*s+2]=t[s+2],i[2*s+3]=t[s+3],i[2*s+4]=t[s+4],i[2*s+5]=t[s+5];return super.setPositions(i),this}setColors(t){const e=t.length-3,i=new Float32Array(2*e);for(let s=0;s<e;s+=3)i[2*s]=t[s],i[2*s+1]=t[s+1],i[2*s+2]=t[s+2],i[2*s+3]=t[s+3],i[2*s+4]=t[s+4],i[2*s+5]=t[s+5];return super.setColors(i),this}fromLine(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}}class WW extends VW{constructor(t=new D2,e=new mE({color:Math.random()*16777215})){super(t,e),this.isLine2=!0,this.type="Line2"}}class AE extends re{}var Sh=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const lw=z("debugwebxr");class Co extends re{constructor(){super(...arguments);c(this,"movementSpeed",1.5);c(this,"rotationStep",30);c(this,"useTeleport",!0);c(this,"usePinchToTeleport",!0);c(this,"useTeleportTarget",!1);c(this,"useTeleportFade",!1);c(this,"showRays",!0);c(this,"showHits",!0);c(this,"isXRMovementHandler",!0);c(this,"xrSessionMode","immersive-vr");c(this,"_didApplyRotation",!1);c(this,"_didTeleport",!1);c(this,"_teleportBuffer",new Array);c(this,"_plane",null);c(this,"_lines",[]);c(this,"_hitDiscs",[]);c(this,"_hitDistances",[]);c(this,"_lastHitDistances",[]);c(this,"hitPointRaycastFilter",e=>e.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(e){const i=e.xr.rig;if(!(i!=null&&i.gameObject)||e.xr.isPassThrough)return;const s=e.xr.leftController,r=e.xr.rightController;s&&this.onHandleMovement(s,i.gameObject),r&&(this.onHandleRotation(r,i.gameObject),this.useTeleport&&this.onHandleTeleport(r,i.gameObject))}onLeaveXR(e){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i==null||i.removeFromParent()}onBeforeRender(){var e;(e=this.context.xr)!=null&&e.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(e,i){const s=e.getStick("xr-standard-thumbstick");if(s.x!=0||s.y!=0){const r=Re(s.x,0,s.y);r.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const o=ri(i);r.multiplyScalar(o.x),r.applyQuaternion(e.xr.poseOrientation),r.y=0,r.applyQuaternion(i.worldQuaternion),i.position.add(r),i.updateWorldMatrix(!1,!1);for(const a of i.children)a.updateWorldMatrix(!1,!1)}}onHandleRotation(e,i){if(e._isMxInk)return;const r=e.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(r)<.3&&(this._didApplyRotation=!1);else if(Math.abs(r)>.5){this._didApplyRotation=!0;const o=r>0?1:-1,a=He(this.context.mainCamera).clone();i.rotateY(o*ye.toRadians(this.rotationStep));const h=He(this.context.mainCamera).clone().sub(a);h.y=0,i.position.sub(h)}}onHandleTeleport(e,i){var r,o,a,l,h;let s=0;if(e.hand&&this.usePinchToTeleport&&e.isTeleportGesture){const u=e.getPointerId("primary");if(u!=null&&this.context.input.getIsPointerIdInUse(u))return;const d=e.getGesture("pinch");d&&(s=d.value)}else s=(r=e.getStick("xr-standard-thumbstick"))==null?void 0:r.y;if(this._didTeleport)s>=0&&s<.4?this._didTeleport=!1:s<0&&s>-.4&&(this._didTeleport=!1);else if(s>.8){this._didTeleport=!0;const u=this.context.physics.raycastFromRay(e.ray)[0];if(u&&u.object instanceof If){const f=(o=u.normal)==null?void 0:o.dot(Re(0,1,0));if(f!==void 0&&f<.4)return}let d=u==null?void 0:u.point;if(!d&&!this.useTeleportTarget){this._plane||(this._plane=new ic(new w(0,1,0),0));const f=i.worldPosition;this._plane.setFromNormalAndCoplanarPoint(new w(0,1,0),f);const p=e.ray;d=f.clone(),this._plane.intersectLine(new FC(p.origin,Re(p.direction).multiplyScalar(1e4).add(p.origin)),d),d.distanceTo(f)>i.scale.x*10&&(d=null)}if(d){if(this.useTeleportTarget&&!Q.getComponentInParent(u.object,AE))return;const f=d.clone();if(lw&&Be.DrawSphere(d,.025,16711680,5),(a=this.context.mainCamera)==null?void 0:a.position){const g=(l=this.context.xr)==null?void 0:l.getUserOffsetInRig();g&&(g.y=0,f.sub(g),lw&&Be.DrawWireSphere(g.add(f),.025,65280,5))}this._teleportBuffer.push(i.matrix.clone()),this._teleportBuffer.length>10&&this._teleportBuffer.shift(),this.useTeleportFade?(h=e.xr.fadeTransition())==null||h.then(()=>{i.worldPosition=f}):i.worldPosition=f}}else if(s<-.8&&(this._didTeleport=!0,this._teleportBuffer.length>0)){const u=this._teleportBuffer.pop();u&&u.decompose(i.position,i.quaternion,i.scale)}}renderRays(e){var i;for(let s=0;s<this._lines.length;s++){const r=this._lines[s];r&&(r.visible=!1)}for(let s=0;s<e.controllers.length;s++){const r=e.controllers[s];let o=this._lines[s];if(!r.connected||!r.isTracking||!r.ray||r.targetRayMode==="transient-pointer"||!r.hasSelectEvent){o&&(o.visible=!1);continue}o||(o=this.createRayLineObject(),o.scale.z=.5,this._lines[s]=o),r.updateRayWorldPosition(),r.updateRayWorldQuaternion();const a=r.rayWorldPosition,l=r.rayWorldQuaternion;o.position.copy(a),o.quaternion.copy(l);const h=e.rigScale,u=this.usePinchToTeleport&&r.isTeleportGesture,d=this._lastHitDistances[s],f=this._hitDistances[s]!=null,p=d??h;o.scale.set(h,h,p),o.visible=!0,o.layers.disableAll(),o.layers.enable(2);let g=o.material.opacity;u?g=1:this.showHits&&p<e.rigScale*.5?g=0:(i=r.getButton("primary"))!=null&&i.pressed?g=.5:g=f?.2:.1,o.material.opacity=ye.lerp(o.material.opacity,g,this.context.time.deltaTimeUnscaled/.1),o.parent!==this.context.scene&&this.context.scene.add(o)}}renderHits(e){var i;for(const s of this._hitDiscs){if(!s)continue;const r=s.controller;if(!r||!r.connected||!r.isTracking){s.visible=!1;continue}}for(let s=0;s<e.controllers.length;s++){const r=e.controllers[s];if(!r.connected||!r.isTracking||!r.ray||!r.hasSelectEvent)continue;let o=this._hitDiscs[s],a=!0;const l=r.getPointerId("primary");l!=null&&this.context.input.getIsPointerIdInUse(l)&&(o&&(o.visible=!1),this._hitDistances[s]=null,this._lastHitDistances[s]=0,a=!1);const h=this.context.time.smoothedFps>=59?1:10;if((this.context.time.frame+r.index)%h!==0&&(a=!1),!a){const f=this._hitDiscs[s];f&&f.visible&&f.hit&&this.updateHitPointerPosition(r,f,f.hit.distance);continue}const u=this.context.physics.raycastFromRay(r.ray,{testObject:this.hitPointRaycastFilter,precise:!1});let d=u.find(f=>this.usePinchToTeleport&&r.isTeleportGesture?!0:this.isObjectWithInteractiveComponent(f.object));if(d||(d=u[0]),o&&(o.controller=r,o.hit=d),this._hitDistances[s]=(d==null?void 0:d.distance)||null,d){this._lastHitDistances[s]=d.distance;const f=e.rigScale??1;lw&&(Be.DrawWireSphere(d.point,.025*f,16711680),Be.DrawLabel(Re(0,.2,0).add(d.point),d.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[s]=o),o.hit=d,o.visible=d.distance>f*.05;let p=.01*(f+d.distance);const g=(i=r.getButton("primary"))==null?void 0:i.pressed;g&&(p*=1.1),o.scale.set(p,p,p),o.layers.set(2);let m=o.material.opacity;if(g?m=1:m=d.distance<.15*f?.2:.6,o.material.opacity=ye.lerp(o.material.opacity,m,this.context.time.deltaTimeUnscaled/.1),o.visible){if(d.normal){this.updateHitPointerPosition(r,o,d.distance);const v=d.normal.applyQuaternion(Gt(d.object));o.quaternion.setFromUnitVectors(qW,v)}else this.updateHitPointerPosition(r,o,d.distance);o.parent!==this.context.scene&&this.context.scene.add(o)}}else this._hitDiscs[s]&&(this._hitDiscs[s].visible=!1)}}isObjectWithInteractiveComponent(e,i=0){return Vx(e)||e.isUI===!0?!0:e.isScene?!1:e.parent?this.isObjectWithInteractiveComponent(e.parent,i+1):!1}updateHitPointerPosition(e,i,s){const r=Re(e.rayWorldPosition);r.add(Re(0,0,s-.01).applyQuaternion(e.rayWorldQuaternion)),i.position.lerp(r,this.context.time.deltaTimeUnscaled/.05)}createHitPointObject(){const e=new J(new Bu(.3,6,6),new _t({color:15658734,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:_i}));return e.layers.disableAll(),e.layers.enable(2),e}createRayLineObject(){const e=new WW;e.layers.disableAll(),e.layers.enable(2);const i=new D2;e.geometry=i;const s=new Float32Array(9);s.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(s);const r=new Float32Array(9);r.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(r);const o=new mE({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,depthWrite:!1,blending:d0,dashed:!1});return e.material=o,e}}Sh([A()],Co.prototype,"movementSpeed",void 0);Sh([A()],Co.prototype,"rotationStep",void 0);Sh([A()],Co.prototype,"useTeleport",void 0);Sh([A()],Co.prototype,"usePinchToTeleport",void 0);Sh([A()],Co.prototype,"useTeleportTarget",void 0);Sh([A()],Co.prototype,"useTeleportFade",void 0);Sh([A()],Co.prototype,"showRays",void 0);Sh([A()],Co.prototype,"showHits",void 0);const qW=new w(0,1,0);var Bn=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const tv=z("debugwebxr"),XW=z("debugusdz"),iu=class extends re{constructor(){super(...arguments);c(this,"createVRButton",!0);c(this,"createARButton",!0);c(this,"createSendToQuestButton",!0);c(this,"createQRCode",!0);c(this,"useDefaultControls",!0);c(this,"showControllerModels",!0);c(this,"showHandModels",!0);c(this,"usePlacementReticle",!0);c(this,"customARPlacementReticle");c(this,"usePlacementAdjustment",!0);c(this,"arScale",1);c(this,"useXRAnchor",!1);c(this,"autoPlace",!0);c(this,"autoCenter",!0);c(this,"useQuicklookExport",!1);c(this,"useDepthSensing",!1);c(this,"useSpatialGrab",!0);c(this,"defaultAvatar");c(this,"_playerSync");c(this,"_createdComponentsInSession",[]);c(this,"_usdzExporter");c(this,"_exitXRMenuButton");c(this,"_previousXRState",0);c(this,"_spatialGrabRaycaster");c(this,"onAvatarSpawned",e=>{tv&&console.log("WebXR.onAvatarSpawned",e),Q.getComponentInChildren(e,Su)??(i=Q.addComponent(e,Su))});c(this,"_buttonFactory");c(this,"_buttons",[])}awake(){Le.getXRSync(this.context)}onEnable(){var e,i;window.location.protocol!=="https:"&&qt('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&(Q.findObjectOfType(ai)||(tv&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=Q.addComponent(this.gameObject,ai),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar===!0&&(tv&&console.warn("WebXR: No default avatar set, using static default avatar"),this.defaultAvatar=new et("https://cdn.needle.tools/static/avatars/DefaultAvatar.glb")),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(ju),this._playerSync.autoSync=!1),this._playerSync&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,(e=this._playerSync.onPlayerSpawned)==null||e.removeEventListener(this.onAvatarSpawned),(i=this._playerSync.onPlayerSpawned)==null||i.addEventListener(this.onAvatarSpawned))}onDisable(){var e;(e=this._usdzExporter)==null||e.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await Le.isVRSupported()&&this.createVRButton?Le.offerSession("immersive-vr","default",this.context):this.createARButton&&await Le.isARSupported()&&this.createARButton?Le.offerSession("immersive-ar","default",this.context):!1}get session(){return Le.active??null}get sessionMode(){return Le.activeMode??null}async enterVR(e){return Le.start("immersive-vr",e,this.context)}async enterAR(e){return Le.start("immersive-ar",e,this.context)}exitXR(){Le.stop()}get isActiveWebXR(){return!iu.activeWebXRComponent||iu.activeWebXRComponent===this}onBeforeXR(e,i){var s;if(!this.isActiveWebXR){console.warn(`WebXR: another WebXR component is already active (${(s=iu.activeWebXRComponent)==null?void 0:s.name}). This is ignored: ${this.name}`);return}iu.activeWebXRComponent=this,e=="immersive-ar"&&this.useDepthSensing&&(i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("depth-sensing"))}async onEnterXR(e){if(!this.isActiveWebXR)return;tv&&console.log("WebXR onEnterXR"),this._previousXRState=bs.Global.Mask;const i=e.xr.isVR;if(bs.Global.Set(i?po.VR:po.AR),this.usePlacementReticle&&e.xr.isAR){let s=Q.findObjectOfType(ph);if(!s){const r=new ne;for(const o of this.context.scene.children)r.add(o);this.context.scene.add(r),s=Q.addComponent(r,ph),this._createdComponentsInSession.push(s)}s.customReticle=this.customARPlacementReticle,s.arScale=this.arScale,s.arTouchTransform=this.usePlacementAdjustment,s.autoPlace=this.autoPlace,s.autoCenter=this.autoCenter,s.useXRAnchor=this.useXRAnchor}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0),this.useSpatialGrab&&(this._spatialGrabRaycaster=Q.findObjectOfType(Au)??void 0,this._spatialGrabRaycaster||(this._spatialGrabRaycaster=this.gameObject.addComponent(Au))),this.createLocalAvatar(e.xr),e.xr.isScreenBasedAR||(this._exitXRMenuButton=this.context.menu.appendChild({label:"Quit XR",onClick:()=>this.exitXR(),icon:"exit_to_app",priority:2e4}))}onUpdateXR(e){this.isActiveWebXR&&this._spatialGrabRaycaster&&(this._spatialGrabRaycaster.enabled=this.useSpatialGrab)}onLeaveXR(e){var i,s;if((i=this._exitXRMenuButton)==null||i.remove(),!!this.isActiveWebXR){bs.Global.Set(this._previousXRState),(s=this._playerSync)==null||s.destroyInstance();for(const r of this._createdComponentsInSession)r.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession(),UC(1).then(()=>iu.activeWebXRComponent=null)}}setDefaultMovementEnabled(e){let i=this.gameObject.getComponent(Co);return!i&&e&&(i=this.gameObject.addComponent(Co),this._createdComponentsInSession.push(i)),i&&(i.enabled=e),i}setDefaultControllerRenderingEnabled(e){let i=this.gameObject.getComponent(lc);return!i&&e&&(i=this.gameObject.addComponent(lc),this._createdComponentsInSession.push(i),i.createControllerModel=this.showControllerModels,i.createHandModel==this.showHandModels),i&&(i.enabled=e),i}async createLocalAvatar(e){this._playerSync&&e.running&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=rh.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((uh()&&eg()||XW)&&this.useQuicklookExport){const i=Q.findObjectOfType(ai);if(!i||i&&i.allowCreateQuicklookButton){const s=this.getButtonsFactory().createQuicklookButton();this.addButton(s,50)}}if(this.createARButton){const i=this.getButtonsFactory().createARButton();this.addButton(i,50)}if(this.createVRButton){const i=this.getButtonsFactory().createVRButton();this.addButton(i,50)}}if(this.createSendToQuestButton&&!zC()&&Le.isVRSupported().then(i=>{if(!i){const s=this.getButtonsFactory().createSendToQuestButton();this.addButton(s,50)}}),this.createQRCode){const i=NS(vc);if(i&&i.createQRCodeButton===!1)ve()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component");else{const s=Ha.getOrCreate().createQRCode();this.addButton(s,50)}}}addButton(e,i){this._buttons.push(e),e.setAttribute("priority",i.toString()),this.context.menu.appendChild(e)}removeButtons(){for(const e of this._buttons)e.remove();this._buttons.length=0}};let Ai=iu;c(Ai,"activeWebXRComponent",null);Bn([A()],Ai.prototype,"createVRButton",void 0);Bn([A()],Ai.prototype,"createARButton",void 0);Bn([A()],Ai.prototype,"createSendToQuestButton",void 0);Bn([A()],Ai.prototype,"createQRCode",void 0);Bn([A()],Ai.prototype,"useDefaultControls",void 0);Bn([A()],Ai.prototype,"showControllerModels",void 0);Bn([A()],Ai.prototype,"showHandModels",void 0);Bn([A()],Ai.prototype,"usePlacementReticle",void 0);Bn([A(et)],Ai.prototype,"customARPlacementReticle",void 0);Bn([A()],Ai.prototype,"usePlacementAdjustment",void 0);Bn([A()],Ai.prototype,"arScale",void 0);Bn([A()],Ai.prototype,"useXRAnchor",void 0);Bn([A()],Ai.prototype,"autoPlace",void 0);Bn([A()],Ai.prototype,"autoCenter",void 0);Bn([A()],Ai.prototype,"useQuicklookExport",void 0);Bn([A()],Ai.prototype,"useDepthSensing",void 0);Bn([A()],Ai.prototype,"useSpatialGrab",void 0);Bn([A(et)],Ai.prototype,"defaultAvatar",void 0);class vE{get extensionName(){return"Physics"}onExportObject(t,e,i){const s=Q.getComponents(t,It).filter(l=>l.enabled),r=Q.getComponents(t,Eo).filter(l=>l.enabled&&!l.isTrigger);let o=s.length>0?s[0]:null;const a=r.length>0?r[0]:null;a&&!o&&(o=new It,o.isKinematic=!0),o&&e.addEventListener("serialize",(l,h)=>{var u,d,f;if(o){if(l.appendLine(),l.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),o.useGravity||l.appendLine("bool gravityEnabled = 0"),l.appendLine('uniform token info:id = "RealityKit.RigidBody"'),o.isKinematic&&l.appendLine('token motionType = "Kinematic"'),l.beginBlock('def RealityKitStruct "massFrame"',"{",!0),l.appendLine(`float m_mass = ${o.mass}`),l.beginBlock('def RealityKitStruct "m_pose"',"{",!0),l.appendLine(`float3 position = (${o.centerOfMass.x}, ${o.centerOfMass.y}, ${o.centerOfMass.z})`),l.closeBlock("}"),l.closeBlock("}"),r.length>0){const p=r[0];l.beginBlock('def RealityKitStruct "material"',"{",!0);const g=p.sharedMaterial;g&&g.dynamicFriction!==void 0&&l.appendLine(`double dynamicFriction = ${(u=p.sharedMaterial)==null?void 0:u.dynamicFriction}`),g&&g.bounciness!==void 0&&l.appendLine(`double restitution = ${(d=p.sharedMaterial)==null?void 0:d.bounciness}`),g&&g.staticFriction!==void 0&&l.appendLine(`double staticFriction = ${(f=p.sharedMaterial)==null?void 0:f.staticFriction}`),l.closeBlock("}")}l.closeBlock("}")}}),a&&(e.addEventListener("serialize",(l,h)=>{var f;l.beginBlock('def RealityKitComponent "Collider"',"{",!0),l.appendLine("uint group = 1"),l.appendLine('uniform token info:id = "RealityKit.Collider"'),l.appendLine("uint mask = 4294967295");const d=a.isTrigger?"Trigger":"Default";if(l.appendLine(`token type = "${d}"`),l.beginBlock('def RealityKitStruct "Shape"',"{",!0),a instanceof Nm){const p=a;l.appendLine('token shapeType = "Sphere"'),l.appendLine(`float radius = ${p.radius}`)}else if(a instanceof Hu){const p=a;l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${p.size.x}, ${p.size.y}, ${p.size.z})`)}else if(a instanceof fh){const p=a;l.appendLine('token shapeType = "Capsule"'),l.appendLine(`float radius = ${p.radius}`),l.appendLine(`float height = ${p.height}`)}else if(a instanceof Hf&&((f=a.sharedMesh)!=null&&f.geometry)){const p=a.sharedMesh.geometry;p.boundingBox||p.computeBoundingBox();const g=a.sharedMesh.geometry.boundingBox;g&&(l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${g.max.x-g.min.x}, ${g.max.y-g.min.y}, ${g.max.z-g.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",a))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",a);l.beginBlock('def RealityKitStruct "pose"',"{",!0),l.closeBlock("}"),l.closeBlock("}"),l.closeBlock("}")}),r.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",a))}}var yc=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Nh=z("debugtext");var st;(function(n){n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight"})(st||(st={}));var _g;(function(n){n[n.Truncate=0]="Truncate",n[n.Overflow=1]="Overflow"})(_g||(_g={}));var wg;(function(n){n[n.Wrap=0]="Wrap",n[n.Overflow=1]="Overflow"})(wg||(wg={}));var sr;(function(n){n[n.Normal=0]="Normal",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic",n[n.BoldAndItalic=3]="BoldAndItalic"})(sr||(sr={}));class Zs extends $l{constructor(){super(...arguments);c(this,"alignment",st.UpperLeft);c(this,"verticalOverflow",_g.Truncate);c(this,"horizontalOverflow",wg.Wrap);c(this,"lineSpacing",1);c(this,"supportRichText",!1);c(this,"font");c(this,"fontStyle",sr.Normal);c(this,"sRGBTextColor",new be(1,0,1));c(this,"_text","");c(this,"_fontSize",12);c(this,"_textMeshUi",null);c(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(e){var i;super.setAlphaFactor(e),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(e){e!==this._text&&(this._text=e,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(e){this.text=e}get fontSize(){return this._fontSize}set fontSize(e){var i;this._fontSize=e,(i=this.uiObject)==null||i.set({fontSize:e})}onColorChanged(){var e;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(e=this.uiObject)==null||e.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(e){this.updateOverflow()}updateOverflow(){var i;const e=(i=this.uiObject)==null?void 0:i._overflow;e&&(e._needsUpdate=!0)}onCreate(e){Nh&&console.log(this),this.horizontalOverflow==wg.Overflow&&(e.whiteSpace="pre"),this.verticalOverflow==_g.Truncate&&(this.context.renderer.localClippingEnabled=!0,e.overflow="hidden"),this.horizontalOverflow==wg.Overflow&&this.verticalOverflow==_g.Truncate,e.lineHeight=this.lineSpacing,delete e.backgroundOpacity,delete e.backgroundColor,Nh&&(e.backgroundColor=16750848,e.backgroundOpacity=.5);const i=this.rectTransform;e={...e,...this.getTextOpts()},this.getAlignment(e),Nh&&(e.backgroundColor=Math.random()*16777215,e.backgroundOpacity=.1),this.uiObject=i.createNewText(e),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const e=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:e,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var e;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(e=this.canvas)==null||e.registerEventReceiver(this)}onDisable(){var e;super.onDisable(),(e=this.canvas)==null||e.unregisterEventReceiver(this)}getAlignment(e){switch(e.flexDirection="column",this.alignment){case st.UpperLeft:case st.MiddleLeft:case st.LowerLeft:e.textAlign="left";break;case st.UpperCenter:case st.MiddleCenter:case st.LowerCenter:e.textAlign="center";break;case st.UpperRight:case st.MiddleRight:case st.LowerRight:e.textAlign="right";break}switch(this.alignment){default:case st.UpperLeft:case st.UpperCenter:case st.UpperRight:e.alignItems="start";break;case st.MiddleLeft:case st.MiddleCenter:case st.MiddleRight:e.alignItems="center";break;case st.LowerLeft:case st.LowerCenter:case st.LowerRight:e.alignItems="end";break}return e}feedText(e,i){var s,r,o;if(Nh&&console.log("feedText",this.uiObject,e,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||e.length===0)this.uiObject.textContent=e;else{let a=this.getNextTag(e);if(a){if(a.startIndex>0){for(let u=this.uiObject.children.length-1;u>=0;u--){const d=this.uiObject.children[u];d.isUI&&(this.uiObject.remove(d),d.clear())}const h=new yv({textContent:e.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(h)}}else{this.uiObject.textContent="",this.setOptions({textContent:e});return}const l=[];for(;a;){const h=this.getNextTag(e,a.endIndex),u={fontFamily:(s=this.uiObject)==null?void 0:s.get("fontFamily"),color:"inherit",textContent:""};if(h){u.textContent=this.getText(e,a,h),this.handleTag(a,u,l);const d=new yv(u);(r=this.uiObject)==null||r.add(d)}else{u.textContent=e.substring(a.endIndex),this.handleTag(a,u,l);const d=new yv(u);(o=this.uiObject)==null||o.add(d)}a=h}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const e=[],i=this.canvas,s={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(e[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(_y(a,s),e[o]=!0)}if(!r)break;yield}}handleTag(e,i,s){if(!e.isEndTag){if(e.type.includes("color")){const r=new cw(e,{color:i.color});if(s.push(r),e.type.length>6){const o=parseInt("0x"+e.type.substring(7));i.color=o}else i.color=new be(1,1,1)}else if(e.type=="b"){this.setFont(i,sr.Bold);const r=new cw(e,{fontWeight:700});s.push(r)}else if(e.type=="i"){this.setFont(i,sr.Italic);const r=new cw(e,{fontStyle:"italic"});s.push(r)}}}getText(e,i,s){return e.substring(i.endIndex,s.startIndex)}getNextTag(e,i=0){const s=e.indexOf("<",i),r=e.indexOf(">",s);if(s>=0&&r>=0){const o=e.substring(s+1,r);return{type:o,startIndex:s,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(e,i){if(!this.font)return;const s=this.font,r=this.getFamilyNameWithCorrectSuffix(s,i);Nh&&console.log("Selected font family:"+r);let o=Xw.getFontFamily(r);switch(o||(o=Xw.addFontFamily(r)),e.fontFamily=o,i){default:case sr.Normal:e.fontWeight=400,e.fontStyle="normal";break;case sr.Bold:e.fontWeight=700,e.fontStyle="normal";break;case sr.Italic:e.fontWeight=400,e.fontStyle="italic";break;case sr.BoldAndItalic:e.fontStyle="italic",e.fontWeight=400}let a=o.getVariant(e.fontWeight,e.fontStyle);if(!a){let l=r;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let h=r;h!=null&&h.endsWith(".png")||(h+=".png"),a=o.addVariant(e.fontWeight,e.fontStyle,l,h),a==null||a.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(e,i){var u;const s=e.lastIndexOf("-");if(s<0)return e;const r=(u=e.substring(s+1))==null?void 0:u.toLowerCase();if(YW.includes(r))return Nh&&console.warn("Unsupported font style: "+r),e;const o=e.lastIndexOf("/");let a=e;o>=0&&(a=a.substring(o+1));const l=a[0]===a[0].toUpperCase(),h=e.substring(0,s);switch(Nh&&console.log("Select font: ",e,sr[i],a,l,h),i){case sr.Normal:return l?h+"-Regular":h+"-regular";case sr.Bold:return l?h+"-Bold":h+"-bold";case sr.Italic:return l?h+"-Italic":h+"-italic";case sr.BoldAndItalic:return l?h+"-BoldItalic":h+"-bolditalic";default:return e}}}yc([A()],Zs.prototype,"alignment",void 0);yc([A()],Zs.prototype,"verticalOverflow",void 0);yc([A()],Zs.prototype,"horizontalOverflow",void 0);yc([A()],Zs.prototype,"lineSpacing",void 0);yc([A()],Zs.prototype,"supportRichText",void 0);yc([A(URL)],Zs.prototype,"font",void 0);yc([A()],Zs.prototype,"fontStyle",void 0);yc([A()],Zs.prototype,"text",null);yc([A()],Zs.prototype,"fontSize",null);class cw{constructor(t,e){c(this,"tag");c(this,"previousValues");this.tag=t,this.previousValues=e}}const YW=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];var xg;(function(n){n.singleLine="singleLine",n.hardBreaks="hardBreaks",n.flowing="flowing"})(xg||(xg={}));var Qd;(function(n){n.left="left",n.center="center",n.right="right",n.justified="justified"})(Qd||(Qd={}));var jd;(function(n){n.top="top",n.middle="middle",n.lowerMiddle="lowerMiddle",n.baseline="baseline",n.bottom="bottom"})(jd||(jd={}));class ru{constructor(t){c(this,"id");c(this,"content","");c(this,"font",[]);c(this,"pointSize",144);c(this,"width");c(this,"height");c(this,"depth");c(this,"wrapMode");c(this,"horizontalAlignment");c(this,"verticalAlignment");c(this,"material");this.id=t}static getId(){return this.global_id++}setDepth(t){return this.depth=t,this}setPointSize(t){return this.pointSize=t,this}setHorizontalAlignment(t){return this.horizontalAlignment=t,this}setVerticalAlignment(t){return this.verticalAlignment=t,this}writeTo(t,e){var s;e.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),e.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),e.closeBlock(")"),e.beginBlock(),this.content&&e.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(s=this.font)==null||s.push("sans-serif"));const i=this.font.map(r=>`"${r}"`).join(", ");e.appendLine(`string[] font = [ ${i} ]`),e.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&e.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&e.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&e.appendLine(`double depth = ${this.depth}`),this.wrapMode&&e.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&e.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&e.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&e.appendLine(`rel material:binding = </StageRoot/Materials/${YS(this.material)}>`),e.closeBlock()}}c(ru,"global_id",0);class yE{static singleLine(t,e,i){const s=new ru("text_"+ru.getId());return s.content=t,e&&(s.pointSize=e),i&&(s.depth=i),s}static multiLine(t,e,i,s,r,o){const a=new ru("text_"+ru.getId());return a.content=t,a.width=e,a.height=i,a.horizontalAlignment=s,a.verticalAlignment=r,o!==void 0&&(a.wrapMode=o),a}}const KW=new ae().makeRotationY(Math.PI),JW=new ae().makeScale(-1,1,-1);class ob{get extensionName(){return"text"}exportText(t,e,i){const s=Q.getComponent(t,Zs);if(!s)return;const r=Q.getComponent(t,es);let o=100,a=100;r&&(o=r.width,a=r.height);const l=KW.clone();r&&l.premultiply(JW),e.setMatrix(l);const h=s.color.clone();e.material=new Kn({color:h,emissive:h}),e.addEventListener("serialize",(u,d)=>{let f=s.text;f=f.replace(/\r/g,""),f=f.replace(/\n/g,"\\n");const p=yE.multiLine(f,o,a,Qd.center,jd.bottom,xg.flowing);this.setTextAlignment(p,s.alignment),this.setOverflow(p,s),e.material&&(p.material=e.material),p.pointSize=this.convertToTextSize(s.fontSize),p.depth=.001,p.writeTo(void 0,u)})}convertToTextSize(t){return 1/.0502*144*t}setOverflow(t,e){e.horizontalOverflow?t.wrapMode=xg.singleLine:t.wrapMode=xg.flowing}setTextAlignment(t,e){switch(e){case st.LowerLeft:case st.MiddleLeft:case st.UpperLeft:t.horizontalAlignment=Qd.left;break;case st.LowerCenter:case st.MiddleCenter:case st.UpperCenter:t.horizontalAlignment=Qd.center;break;case st.LowerRight:case st.MiddleRight:case st.UpperRight:t.horizontalAlignment=Qd.right;break}switch(e){case st.LowerLeft:case st.LowerCenter:case st.LowerRight:t.verticalAlignment=jd.bottom;break;case st.MiddleLeft:case st.MiddleCenter:case st.MiddleRight:t.verticalAlignment=jd.middle;break;case st.UpperLeft:case st.UpperCenter:case st.UpperRight:t.verticalAlignment=jd.top;break}}}class bE{get extensionName(){return"tmui"}onExportObject(t,e,i){const s=Q.getComponent(t,En);if(s&&s.enabled&&s.renderMode===Ta.WorldSpace){const r=new ob,o=Q.getComponent(t,es),a=Q.getComponent(t,Eu),l=new Array;if(o){if(!Q.isActiveSelf(t)){const d=Q.isActiveSelf(t);Q.setActive(t,!0),o.onEnable(),o.updateTransform(),l.push(()=>{o.onDisable(),Q.setActive(t,d)})}t.traverse(d=>{if(!Q.isActiveInHierarchy(d)){const f=Q.isActiveSelf(d);Q.setActive(d,!0);const p=Q.getComponent(d,na);p&&(p.onEnable(),l.push(()=>{p.onDisable()}));const g=Q.getComponent(d,es);g&&(g.onEnable(),g.updateTransform(),g.onApplyTransform(),l.push(()=>{g.onDisable()}));const m=Q.getComponent(d,Zs);m&&(m.onEnable(),l.push(()=>{m.onDisable()})),l.push(()=>{Q.setActive(d,f)})}}),o.width,o.height;const h=_s.createEmpty(),u=o.shadowComponent;if(e.add(h),u){const d=u.matrix;h.setMatrix(d);const f=new Map,p=new Map;f.set(u,h),p.set(u,a?a.alpha:1),u.traverse(g=>{if(g===u)return;const m=_s.createEmpty();m.setMatrix(g.matrix);const v=g.parent,y=!!v&&typeof v.textContent=="string"&&v.textContent.length>0;let b=p.get(v)||1;const _=Q.getComponent(g,Eu);if(_&&(b*=_.alpha),g instanceof J&&y){const S=g[fo];S?r.exportText(S.gameObject,m,i):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",g)}if(g instanceof J&&!y){const S=g.geometry.clone();S.scale(1,1,-1),this.flipWindingOrder(S),m.geometry=S;const E=new be,M=g.material.opacity;E.copy(g.material.color),m.material=new _t({color:E,opacity:M*b,map:g.material.map,transparent:!0})}f.set(g,m),p.set(g,b);const x=f.get(v);if(!x){console.error("Error when exporting UI: shadow component parent not found!",g,g.parent);return}x.add(m)})}}for(const h of l)h()}}flipWindingOrder(t){const e=t.index.array;for(let i=0,s=e.length/3;i<s;i++){const r=e[i*3];e[i*3]=e[i*3+2],e[i*3+2]=r}t.index.needsUpdate=!0}}const Jp=z("debugusdz");function ZW(n,t){var a;const e=[],i=Q.getComponentsInChildren(n,Cs),s=Q.getComponentsInChildren(n,Ws),r=new Array,o=new Array;if(t.injectImplicitBehaviours)for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;const h=l.runtimeAnimatorController.activeState;if(!h||!h.motion||!h.motion.clip||((a=h.motion.clip.tracks)==null?void 0:a.length)<1||r.includes(l))continue;const u=new Wa;u.animator=l,u.stateName=h.name,u.trigger="start",u.name="PlayAnimationOnClick_implicitAtStart_"+u.stateName;const d=new ne;Q.addComponent(d,u),o.push(d),r.push(l),n.add(d)}else for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;Jp&&console.log(l);const h=[];for(const u of l.runtimeAnimatorController.enumerateActions()){Jp&&console.log(u);const d=u.getClip();h.includes(d)||h.push(d)}e.push({root:l.gameObject,clips:h})}if(t.injectImplicitBehaviours)for(const l of s){if(!l||!l.clip||!l.enabled||!l.playAutomatically||r.includes(l))continue;const h=new Wa;h.animation=l,h.stateName=l.clip.name,h.trigger="start",h.name="PlayAnimationOnClick_implicitAtStart_"+h.stateName;const u=new ne;Q.addComponent(u,h),o.push(u),r.push(l),n.add(u)}else for(const l of s){Jp&&console.log(l);const h=[];for(const u of l.animations)h.includes(u)||h.push(u);e.push({root:l.gameObject,clips:h})}Jp&&(e==null?void 0:e.length)>0&&console.log("USDZ Animation Clips without behaviours",e);for(const l of e)for(const h of l.clips)t.registerAnimation(l.root,h);return o}function $W(n,t){const e=Q.getComponentsInChildren(n,kt),i=Q.getComponentsInChildren(n,Iu),s=new Array,r=new Array;Jp&&console.log({audioSources:e,playAudioOnClicks:i});for(const o of i){if(!o.target)continue;const a=e.indexOf(o.target);a>-1&&e.splice(a,1)}for(const o of e){if(!o||!o.clip||o.volume<=0||s.includes(o))continue;const a=new Iu;a.target=o,a.name="PlayAudioOnClick_implicitAtStart_",a.trigger="start";const l=new ne;Q.addComponent(l,a),console.log("implicit PlayAudioOnStart",l,a),r.push(l),s.push(o),n.add(l)}return r}function e7(n){return new hn("DisableAtStart",$n.sceneStartTrigger(),Ct.fadeAction(n,0,!1))}function KR(n){const t=n.domElement.shadowRoot.querySelector("link[rel='ar']");if(t)return t;const e=document.createElement("div");e.classList.add("menu"),e.classList.add("quicklook-menu"),e.style.display="none",e.style.visibility="hidden";const i=document.createElement("button");i.id="open-in-ar",i.innerText="Open in QuickLook",e.appendChild(i);const s=document.createElement("a");s.id="needle-usdz-link",s.style.display="none",s.rel="ar",s.href="",e.appendChild(s);const r=document.createElement("img");return r.id="button",s.appendChild(r),n.domElement.shadowRoot.appendChild(e),s}var Ts=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const $r=z("debugusdz"),t7=z("debugusdzpruning");class Yu{constructor(){c(this,"callToAction");c(this,"checkoutTitle");c(this,"checkoutSubtitle");c(this,"callToActionURL")}}Ts([A()],Yu.prototype,"callToAction",void 0);Ts([A()],Yu.prototype,"checkoutTitle",void 0);Ts([A()],Yu.prototype,"checkoutSubtitle",void 0);Ts([A()],Yu.prototype,"callToActionURL",void 0);const n0=class extends re{constructor(){super(...arguments);c(this,"objectToExport");c(this,"autoExportAnimations",!0);c(this,"autoExportAudioSources",!0);c(this,"exportFileName");c(this,"customUsdzFile");c(this,"customBranding");c(this,"anchoringType","plane");c(this,"maxTextureSize",2048);c(this,"planeAnchoringAlignment","horizontal");c(this,"interactive",!0);c(this,"allowCreateQuicklookButton",!0);c(this,"quickLookCompatible",!0);c(this,"extensions",[]);c(this,"link");c(this,"button");c(this,"onClickedOpenInARElement",e=>{e.preventDefault(),this.exportAndOpen()});c(this,"_currentExportTasks",new Map);c(this,"_previousTimeScale",1);c(this,"lastCallback");c(this,"_rootSessionRootWasAppliedTo",null);c(this,"_rootPositionBeforeExport",new w);c(this,"_rootRotationBeforeExport",new ie);c(this,"_rootScaleBeforeExport",new w)}start(){var e,i,s;$r&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",r=>{switch(r.key){case"t":this.exportAsync();break}}),dc()&&setTimeout(()=>{this.exportAsync()},2e3)),this.objectToExport||(this.objectToExport=this.gameObject),!((i=(e=this.objectToExport)==null?void 0:e.children)!=null&&i.length)&&!((s=this.objectToExport)!=null&&s.isMesh)&&(this.objectToExport=this.context.scene),this.interactive&&(this.extensions.push(new hE),this.extensions.push(new Qu),this.extensions.push(new vE),this.extensions.push(new ob),this.extensions.push(new bE))}onEnable(){var s;const e=uh(),i=eg();($r||e&&i)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=KR(this.context),this.link.addEventListener("message",this.lastCallback)),$r&&bi("USDZ Exporter enabled: "+this.name),(s=document.getElementById("open-in-ar"))==null||s.addEventListener("click",this.onClickedOpenInARElement),em.registerExporter(this)}onDisable(){var e,i,s;(e=this.button)==null||e.remove(),(i=this.link)==null||i.removeEventListener("message",this.lastCallback),$r&&bi("USDZ Exporter disabled: "+this.name),(s=document.getElementById("open-in-ar"))==null||s.removeEventListener("click",this.onClickedOpenInARElement),em.unregisterExporter(this)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var s;let e=this.exportFileName??((s=this.objectToExport)==null?void 0:s.name)??this.name;if(e+="-"+bV(),pu()||(e!==""&&(e+="-"),e+="MadeWithNeedle"),this.link||(this.link=KR(this.context)),this.customUsdzFile)return $r&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,e),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const i=await this.export(this.objectToExport);return i?($r&&console.log("USDZ generation done. Downloading as "+e),this.openInQuickLook(i,e),i):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(e){if(!e)return console.warn("No object to export"),null;const i=this._currentExportTasks.get(e);if(i)return i;const s=this.internalExport(e);return s instanceof Promise?(this._currentExportTasks.set(e,s),s.then(r=>(this._currentExportTasks.delete(e),r)).catch(r=>(this._currentExportTasks.delete(e),console.error("Error during USDZ export â€“ please report a bug!",r),null))):s}async internalExport(e){at.start("export-usdz",{onProgress:_=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:_}}))}}),at.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),at.report("export-usdz",{message:"Load progressive textures",autoStep:5}),at.start("export-usdz-textures","export-usdz");const i=Q.getComponentsInChildren(e,jr);for(const _ of i)_&&_.enabled&&_.updateSprite(!0);const s=Q.getComponentsInChildren(e,li),r=new Array;let o=0;for(const _ of s){for(const x of _.sharedMeshes)if(x){const S=ht.assignMeshLOD(x,0);S instanceof Promise&&r.push(new Promise((E,M)=>{S.then(()=>{o++,at.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:o,totalSteps:r.length}),E()}).catch(I=>M(I))}))}for(const x of _.sharedMaterials)if(x){const S=ht.assignTextureLOD(x,0);S instanceof Promise&&r.push(new Promise((E,M)=>{S.then(()=>{o++,at.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:o,totalSteps:r.length}),E()}).catch(I=>M(I))}))}}$r&&bi("Progressive Loading: "+r.length),await Promise.all(r),$r&&bi("Progressive Loading: done"),at.end("export-usdz-textures");const a=bs.Global.Mask;bs.Global.Set(po.AR);const l=new IV,h=new H0(this.quickLookCompatible),u=[h,...this.extensions],d={self:this,exporter:l,extensions:u,object:e};at.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:d})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,at.report("export-usdz","auto export animations and audio sources");const f=new Array;this.autoExportAnimations&&f.push(...ZW(e,h)),this.extensions.find(_=>_.extensionName==="Audio")&&this.autoExportAudioSources&&f.push(...$W(e)),l.debug=$r,l.pruneUnusedNodes=!t7,l.keepObject=_=>{const x=Q.getComponent(_,li);return!(x&&!x.enabled)};const g=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(_=>{_.visible||g.push(_)});const m=this.extensions.find(_=>_.extensionName==="Behaviour");this.interactive&&m&&g.length>0&&m.addBehavior(e7(g));let v=!0;this.quickLookCompatible&&!this.interactive&&(v=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),at.report("export-usdz","Invoking exporter.parse");const y=await l.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:u,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:v}),b=new Blob([y],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,at.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:d}));for(const _ of f)Q.destroy(_);return bs.Global.Set(a),at.end("export-usdz"),b}openInQuickLook(e,i){const s=e instanceof Blob?URL.createObjectURL(e):e,r=this.buildQuicklookOverlay();$r&&console.log("QuickLook Overlay",r);const o=r.callToAction?encodeURIComponent(r.callToAction):"",a=r.checkoutTitle?encodeURIComponent(r.checkoutTitle):"",l=r.checkoutSubtitle?encodeURIComponent(r.checkoutSubtitle):"";this.link.href=s+`#callToAction=${o}&checkoutTitle=${a}&checkoutSubtitle=${l}&callToActionURL=${r.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=i+".usdz",this.link.click()}download(e,i){n0.save(e,i)}static save(e,i){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),typeof e=="string"?s.href=e:s.href=URL.createObjectURL(e),s.download=i,s.click(),s.remove()}quicklookCallback(e){if((e==null?void 0:e.data)=="_apple_ar_quicklook_button_tapped"){$r&&qt("Quicklook closed via call to action button");var i=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(i),!i.defaultPrevented){const s=new URLSearchParams(this.link.href);if(s){const r=s.get("callToActionURL");$r&&bi("Quicklook url: "+r),r&&(pu()?globalThis.open(r,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",r))}}}}buildQuicklookOverlay(){var s,r,o,a,l,h;const e={};return this.customBranding&&Object.assign(e,this.customBranding),pu()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),e.callToAction="Close",e.checkoutTitle="ðŸŒµ Made with Needle",e.checkoutSubtitle="_"),(((s=e.callToAction)==null?void 0:s.length)||((r=e.checkoutTitle)==null?void 0:r.length)||((o=e.checkoutSubtitle)==null?void 0:o.length))&&((a=e.callToAction)!=null&&a.length||(e.callToAction="\0"),(l=e.checkoutTitle)!=null&&l.length||(e.checkoutTitle="\0"),(h=e.checkoutSubtitle)!=null&&h.length||(e.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:e})),e}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};const e=Q.findObjectOfType(Ai);let i=Q.getComponentInParent(this.objectToExport,ph);i||(i=Q.getComponentInChildren(this.objectToExport,ph));let s=1,r=!1;const o=this.objectToExport;return e?s=e.arScale:i&&(s=i.arScale,r=i.invertForward),{scale:1/s,_invertForward:r,target:o,sessionRoot:(i==null?void 0:i.gameObject)??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:e,_invertForward:i,target:s,sessionRoot:r}=this.getARScaleAndTarget(),o=r==null?void 0:r.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=s,this._rootPositionBeforeExport.copy(s.position),this._rootRotationBeforeExport.copy(s.quaternion),this._rootScaleBeforeExport.copy(s.scale),s.scale.multiplyScalar(e),i&&s.quaternion.multiply(n0.invertForwardQuaternion),s.updateMatrix(),s.updateMatrixWorld(!0),r&&o&&s.matrix.premultiply(o)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const e=this._rootSessionRootWasAppliedTo;e.position.copy(this._rootPositionBeforeExport),e.quaternion.copy(this._rootRotationBeforeExport),e.scale.copy(this._rootScaleBeforeExport),e.updateMatrix(),e.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const i=rh.getOrCreate().createQuicklookButton();return i.parentNode||this.context.menu.appendChild(i),i}};let ai=n0;c(ai,"invertForwardMatrix",new ae().makeRotationY(Math.PI)),c(ai,"invertForwardQuaternion",new ie().setFromEuler(new jt(0,Math.PI,0)));Ts([A(ne)],ai.prototype,"objectToExport",void 0);Ts([A()],ai.prototype,"autoExportAnimations",void 0);Ts([A()],ai.prototype,"autoExportAudioSources",void 0);Ts([A()],ai.prototype,"exportFileName",void 0);Ts([A(URL)],ai.prototype,"customUsdzFile",void 0);Ts([A(Yu)],ai.prototype,"customBranding",void 0);Ts([A()],ai.prototype,"anchoringType",void 0);Ts([A()],ai.prototype,"maxTextureSize",void 0);Ts([A()],ai.prototype,"planeAnchoringAlignment",void 0);Ts([A()],ai.prototype,"interactive",void 0);Ts([A()],ai.prototype,"allowCreateQuicklookButton",void 0);Ts([A()],ai.prototype,"quickLookCompatible",void 0);class ab extends re{constructor(){super(...arguments);c(this,"isUsed",!0);c(this,"usedBy",null)}}class O2 extends re{}const JR=z("debugdeletable");class _E extends qo{}class L2 extends re{constructor(){super(...arguments);c(this,"deleteBoxes",[])}awake(){this.deleteBoxes=Q.findObjectsOfType(_E,this.context)}update(){for(const e of this.deleteBoxes){const i=this.gameObject;if(e.isInBox(i)===!0){const r=Q.getComponentInParent(this.gameObject,ab);r?JR&&console.warn("Can not delete object with usage marker",this.guid,r):(JR&&console.log("DESTROY",this.gameObject),T0(this.gameObject,this.context.connection))}}}}var Ku=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},rC;(function(n){n[n.Off=0]="Off",n[n.Gaussian=1]="Gaussian",n[n.Bokeh=2]="Bokeh"})(rC||(rC={}));const i7=z("debugpost");class hl extends ns{constructor(){super(...arguments);c(this,"mode");c(this,"focusDistance",new me(1));c(this,"focalLength",new me(.2));c(this,"aperture",new me(20));c(this,"gaussianMaxRadius",new me);c(this,"resolutionScale",new me(1*1/window.devicePixelRatio));c(this,"bokehScale",new me)}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=i=>{const s=i/300,r=2;return ye.lerp(r,.01,s)};const e=20;this.aperture.valueProcessor=i=>{const s=1-i/32;return ye.lerp(1,e,s)}}onCreateEffect(){if(this.mode===rC.Off){i7&&console.warn("DepthOfField: Mode is set to Off");return}const e=new dk(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=i=>{e.cocMaterial.worldFocusDistance=i},this.focalLength.onValueChanged=i=>e.cocMaterial.worldFocusRange=i,this.aperture.onValueChanged=i=>e.bokehScale=i,this.resolutionScale&&(this.resolutionScale.onValueChanged=i=>e.resolution.scale=i),[e]}unapply(){}}Ku([A()],hl.prototype,"mode",void 0);Ku([A(me)],hl.prototype,"focusDistance",void 0);Ku([A(me)],hl.prototype,"focalLength",void 0);Ku([A(me)],hl.prototype,"aperture",void 0);Ku([A(me)],hl.prototype,"gaussianMaxRadius",void 0);Ku([A(me)],hl.prototype,"resolutionScale",void 0);Ku([A(me)],hl.prototype,"bokehScale",void 0);ra("DepthOfField",hl);var n7=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Dy;(function(n){n[n.Never=0]="Never",n[n.Desktop=1]="Desktop",n[n.Mobile=2]="Mobile"})(Dy||(Dy={}));class wE extends re{constructor(){super(...arguments);c(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||Q.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:dc()?(this.visibleOn&Dy.Mobile)!==0:(this.visibleOn&Dy.Desktop)!==0}}n7([A()],wE.prototype,"visibleOn",void 0);class F2{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(t){}}var Ju=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const qa=z("debugdrag"),hw=[];var gs;(function(n){n[n.XZPlane=0]="XZPlane",n[n.Attached=1]="Attached",n[n.HitNormal=2]="HitNormal",n[n.DynamicViewAngle=3]="DynamicViewAngle",n[n.SnapToSurfaces=4]="SnapToSurfaces",n[n.None=5]="None"})(gs||(gs={}));const Er=class extends re{constructor(){super(...arguments);c(this,"dragMode",gs.DynamicViewAngle);c(this,"snapGridResolution",0);c(this,"keepRotation",!0);c(this,"xrDragMode",gs.Attached);c(this,"xrKeepRotation",!1);c(this,"xrDistanceDragFactor",1);c(this,"showGizmo",!1);c(this,"_rigidbody",null);c(this,"_targetObject",null);c(this,"_dragHelper",null);c(this,"_draggingRigidbodies",[]);c(this,"_potentialDragStartEvt",null);c(this,"_dragHandlers",new Map);c(this,"_totalMovement",new w);c(this,"_marker",null);c(this,"_isDragging",!1);c(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}static get CurrentlySelected(){hw.length=0;for(const e of this._instances)e._isDragging&&hw.push(e);return hw}get draggedObject(){return this._targetObject}setTargetObject(e){var s,r;this._targetObject=e;for(const o of this._dragHandlers.values())o.setTargetObject(e);const i="_rigidbody-was-kinematic";((s=this._rigidbody)==null?void 0:s[i])===!1&&(this._rigidbody.isKinematic=!1,this._rigidbody[i]=void 0),this._rigidbody=null,e&&(this._rigidbody=Q.getComponentInChildren(e,It),((r=this._rigidbody)==null?void 0:r.isKinematic)===!1&&(this._rigidbody.isKinematic=!0,this._rigidbody[i]=!1))}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new w,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.gameObject.getComponentInParent(xo)||this.gameObject.addComponent(xo)}onEnable(){Er._instances.push(this)}onDisable(){Er._instances=Er._instances.filter(e=>e!==this)}allowEdit(e=null){return this.context.connection.allowEditing}onPointerEnter(e){if(!this.allowEdit(this.gameObject)||e.mode!=="screen"||(e.event.mode==="tracked-pointer"||e.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===gs.None)return;const r=Q.getComponentInParent(e.object,Er);!r||r!==this||(Er.lastHovered=e.object,this.context.domElement.style.cursor="pointer")}onPointerExit(e){this.allowEdit(this.gameObject)&&e.mode==="screen"&&Er.lastHovered===e.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(e){if(!(!this.allowEdit(this.gameObject)||e.used||(e.mode==="tracked-pointer"||e.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===gs.None)&&(Er.lastHovered=e.object,e.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=e),this._targetObject||this.setTargetObject(this.gameObject),Er._active+=1;const r=new r7(this,this._targetObject);if(this._dragHandlers.set(e.event.space,r),r.onDragStart(e),this._dragHandlers.size===2){const o=this._dragHandlers.values(),a=o.next().value,l=o.next().value,h=new s7(this,this._targetObject,a,l);this._dragHandlers.set(this.gameObject,h),h.onDragStart(e)}e.use()}}onPointerMove(e){(this._isDragging||this._potentialDragStartEvt!==null)&&e.use()}onPointerUp(e){if(qa&&Be.DrawLabel(e.point??this.gameObject.worldPosition,"POINTERUP:"+e.pointerId+", "+e.button,.03,3),!this.allowEdit(this.gameObject)||e.button!==0)return;this._potentialDragStartEvt=null;const i=this._dragHandlers.get(e.event.space),s=this._dragHandlers.get(this.gameObject);s&&(s.handlerA===i||s.handlerB===i)&&(this._dragHandlers.delete(this.gameObject),s.onDragEnd(e)),i&&(Er._active>0&&(Er._active-=1),this.setTargetObject(null),i.onDragEnd&&i.onDragEnd(e),this._dragHandlers.delete(e.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(e),e.use())}update(){for(const e of this._dragHandlers.values())e.collectMovementInfo&&e.collectMovementInfo(),e.getTotalMovement&&this._totalMovement.add(e.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const e=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(e)}for(const e of this._dragHandlers.values())e.onDragUpdate&&e.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(e){if(!e||!e.object)return;const i=Q.getComponentInParent(e.object,Er);if(!i||i!==this&&i._isDragging)return;const s=this._targetObject||this.gameObject;if(!s)return;this._isDragging=!0;const r=Q.getComponentInChildren(s,oc);qa&&console.log("DRAG START",r,s),r&&(r.fastMode=!0,r==null||r.requestOwnership()),this._marker=Q.addComponent(s,ab),this._draggingRigidbodies.length=0;const o=Q.getComponentsInChildren(s,It);o&&this._draggingRigidbodies.push(...o)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const i of this._draggingRigidbodies)i.wakeUp(),i.resetVelocities(),i.resetForcesAndTorques();const e=this._targetObject||this.gameObject;ea.markDirty(e)}onLastDragEnd(e){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;for(const s of this._draggingRigidbodies)s.setVelocity(s.smoothedVelocity);this._draggingRigidbodies.length=0;const i=this._dragHelper.selected;if(qa&&console.log("DRAG END",i,i==null?void 0:i.visible),this._dragHelper.setSelected(null,this.context),this._targetObject=null,e!=null&&e.object){const s=Q.getComponentInChildren(e.object,oc);s&&(s.fastMode=!1)}this._marker&&this._marker.destroy()}};let _n=Er;c(_n,"_active",0),c(_n,"_instances",[]),c(_n,"lastHovered");Ju([A()],_n.prototype,"dragMode",void 0);Ju([A()],_n.prototype,"snapGridResolution",void 0);Ju([A()],_n.prototype,"keepRotation",void 0);Ju([A()],_n.prototype,"xrDragMode",void 0);Ju([A()],_n.prototype,"xrKeepRotation",void 0);Ju([A()],_n.prototype,"xrDistanceDragFactor",void 0);Ju([A()],_n.prototype,"showGizmo",void 0);class s7{constructor(t,e,i,s){c(this,"handlerA");c(this,"handlerB");c(this,"context");c(this,"settings");c(this,"gameObject");c(this,"_handlerAAttachmentPoint",new w);c(this,"_handlerBAttachmentPoint",new w);c(this,"_followObject");c(this,"_manipulatorObject");c(this,"_deviceMode");c(this,"_followObjectStartWorldQuaternion",new ie);c(this,"_manipulatorPosOffset",new w);c(this,"_manipulatorRotOffset",new ie);c(this,"_manipulatorScaleOffset",new w);c(this,"_tempVec1",new w);c(this,"_tempVec2",new w);c(this,"_tempVec3",new w);c(this,"tempLookMatrix",new ae);c(this,"_initialScale",new w);c(this,"_initialDistance",0);var o,a;this.context=t.context,this.settings=t,this.gameObject=e,this.handlerA=i,this.handlerB=s,this._followObject=new ne,this._manipulatorObject=new ne,this.context.scene.add(this._manipulatorObject);const r=(a=(o=Le.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),r&&(r.worldToLocal(this._tempVec1),r.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(qa&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now â€“ controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(e.scale),qa){this._followObject.add(new dr(2)),this._manipulatorObject.add(new dr(5));const l=h=>`${h.x.toFixed(2)}, ${h.y.toFixed(2)}, ${h.z.toFixed(2)}`;Be.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),Be.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+l(this._tempVec1)+`
`+l(this._tempVec2),.03,5)}}onDragStart(t){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=t.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(t){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const t=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,t.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const e=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(e/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),qa&&(Be.DrawLabel(this._tempVec3.clone().add(new w(0,.2,0)),"A:B "+e.toFixed(2),.03),Be.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const t=30,e=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const i=this.gameObject,s=this._followObject;s.updateMatrix(),s.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const d=this._followObject.worldPosition,f=this.settings.snapGridResolution;d.x=Math.round(d.x/f)*f,d.y=Math.round(d.y/f)*f,d.z=Math.round(d.z/f)*f,this._followObject.worldPosition=d,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=ye.clamp01(this.context.time.deltaTime*t*e),l=i.worldPosition;l.lerp(s.worldPosition,a),i.worldPosition=l;const h=i.worldQuaternion;h.slerp(s.worldQuaternion,a),i.worldQuaternion=h;const u=i.worldScale;u.lerp(s.worldScale,a),i.worldScale=u}setTargetObject(t){this.gameObject=t}}class r7{constructor(t,e){c(this,"context");c(this,"gameObject");c(this,"settings");c(this,"_lastRig");c(this,"_followObject");c(this,"_totalMovement",new w);c(this,"_totalMovementAlongRayDirection",0);c(this,"_grabStartDistance",0);c(this,"_deviceMode");c(this,"_followObjectStartPosition",new w);c(this,"_followObjectStartQuaternion",new ie);c(this,"_followObjectStartWorldQuaternion",new ie);c(this,"_lastDragPosRigSpace");c(this,"_tempVec",new w);c(this,"_tempMat",new ae);c(this,"_hitPointInLocalSpace",new w);c(this,"_hitNormalInLocalSpace",new w);c(this,"_bottomCenter",new w);c(this,"_backCenter",new w);c(this,"_backBottomCenter",new w);c(this,"_bounds",new xn);c(this,"_dragPlane",new ic(new w(0,1,0)));c(this,"_draggedOverObject",null);c(this,"_draggedOverObjectLastSetUp",null);c(this,"_draggedOverObjectLastNormal",new w);c(this,"_draggedOverObjectDuration",0);c(this,"_hasLastSurfaceHitPoint",!1);c(this,"_lastSurfaceHitPoint",new w);this.settings=t,this.context=t.context,this.gameObject=e,this._followObject=new ne}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(t){this.gameObject=t}recenter(){var r,o;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}const t=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),t.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const e=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(e),this._grabStartDistance=e.distanceTo(t.worldPosition);const i=(o=(r=Le.active)==null?void 0:r.rig)==null?void 0:o.gameObject,s=(i==null?void 0:i.worldScale.x)||1;this._grabStartDistance/=s,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,qa&&(Be.DrawLine(e,t.worldPosition,65280,.5,!1),Be.DrawLabel(t.worldPosition.add(new w(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(t){if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}if(t.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,t.point&&t.normal)this._hitPointInLocalSpace.copy(t.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(t.normal);else if(t){const m=t.event.space,v=m.worldPosition;this.gameObject.worldToLocal(v),this._hitPointInLocalSpace.copy(v);const y=m.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),y.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(y)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=t.mode;const i=this._followObject.parent.worldForward,r=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,o=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(o),r){case gs.XZPlane:const m=new w(0,1,0);this.gameObject.parent&&m.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(m,o);break;case gs.HitNormal:const v=this._hitNormalInLocalSpace.clone();v.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(v,o);break;case gs.Attached:this._dragPlane.setFromNormalAndCoplanarPoint(i,o);break;case gs.DynamicViewAngle:this.setPlaneViewAligned(o,!0);break;case gs.SnapToSurfaces:this.setPlaneViewAligned(o,!1);break;case gs.None:break}const a=this.gameObject.parent,l=this.gameObject.position.clone(),h=this.gameObject.quaternion.clone(),u=this.gameObject.scale.clone(),d=this.gameObject.matrixWorld.clone();a&&a.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1);const f=sl([this.gameObject]);f.expandByPoint(this.gameObject.worldPosition);const p=new w;f.getCenter(p);const g=new w;f.getSize(g),this._bottomCenter.copy(p.clone().add(new w(0,-g.y/2,0))),this._backCenter.copy(p.clone().add(new w(0,0,g.z/2))),this._backBottomCenter.copy(p.clone().add(new w(0,-g.y/2,g.z/2))),this._bounds.copy(f),a&&a.add(this.gameObject),this.gameObject.position.copy(l),this.gameObject.quaternion.copy(h),this.gameObject.scale.copy(u),this.gameObject.matrixWorld.copy(d),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var r,o;if(!this._followObject.parent)return;const t=this._followObject.parent;this._followObject.updateMatrix();const e=t.worldPosition,i=(o=(r=Le.active)==null?void 0:r.rig)==null?void 0:o.gameObject;i&&i.worldToLocal(e),(this._lastDragPosRigSpace===void 0||i!=this._lastRig)&&(this._lastDragPosRigSpace=e.clone(),this._lastRig=i),this._tempVec.copy(e).sub(this._lastDragPosRigSpace);const s=t.worldForward;if(i&&(this._tempMat.copy(i.matrixWorld).invert(),s.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=s.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(e),qa){let a=e;i&&(a=a.clone(),a.transformDirection(i.matrixWorld)),Be.DrawRay(a,s,255)}}onDragUpdate(t){if(t>1)return;const e=this.gameObject,i=this._followObject.parent;this._followObject.updateMatrix();const s=i.worldPosition,r=i.worldForward,o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",a=o?this.settings.xrKeepRotation:this.settings.keepRotation,l=o?this.settings.xrDragMode:this.settings.dragMode;if(l===gs.None)return;const h=10;a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let u=1,d=2;if(o&&this._grabStartDistance>.5){const y=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);u=Math.max(0,y),u=u*u*u}else this._grabStartDistance<=.5&&(d=3);this._followObject.position.copy(this._followObjectStartPosition),a||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(u),this._followObject.updateMatrix();const f=this._hasLastSurfaceHitPoint;this._hasLastSurfaceHitPoint=!1;const p=new mh(s,r);if(l==gs.SnapToSurfaces){const y=this.context.physics.raycastFromRay(p,{testObject:b=>b!==this.followObject&&b!==i&&b!==e});if(y.length>0){const b=y[0];if(this._draggedOverObject===b.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=b.object,this._draggedOverObjectDuration=0),b.face){this._hasLastSurfaceHitPoint=!0,this._lastSurfaceHitPoint.copy(b.point);const _=.15,x=this._draggedOverObjectDuration>=_,S=.001,E=this._totalMovement.length()>=S;if((x||E)&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(b.face.normal)<.999999||this.context.time.frame%60===0)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(b.face.normal);const M=Re(),I=Re();this._bounds.getCenter(M),this._bounds.getSize(I),M.sub(I.multiplyScalar(.5).multiply(b.face.normal)),this._hitPointInLocalSpace.copy(M),this._hitNormalInLocalSpace.copy(b.face.normal),this._bounds.getCenter(M),this._bounds.getSize(I),M.add(I.multiplyScalar(.5).multiply(b.face.normal));const B=Re(this._hitPointInLocalSpace).add(M);this._followObject.localToWorld(B);const R=b.point;this._dragPlane.setFromNormalAndCoplanarPoint(b.face.normal,R)}else if(!(x||E))return}}else f&&this.gameObject&&this.setPlaneViewAligned(this.gameObject.worldPosition,!1)}if(l!==gs.Attached&&p.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const y=this._hitPointInLocalSpace.clone();this._followObject.localToWorld(y),qa&&Be.DrawLine(y,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(y),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const y=this._followObject.worldPosition,b=this.settings.snapGridResolution;y.x=Math.round(y.x/b)*b,y.y=Math.round(y.y/b)*b,y.z=Math.round(y.z/b)*b,this._followObject.worldPosition=y,this._followObject.updateMatrix()}a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const g=ye.clamp01(this.context.time.deltaTime*h*d),m=e.worldPosition;m.lerp(this._followObject.worldPosition,g),e.worldPosition=m;const v=e.worldQuaternion;if(v.slerp(this._followObject.worldQuaternion,g),e.worldQuaternion=v,qa){const y=this._hitPointInLocalSpace.clone();e.localToWorld(y),Be.DrawSphere(y,.02,16711680);const b=this._hitNormalInLocalSpace.clone();b.applyQuaternion(v),Be.DrawRay(y,b,16711680),Be.DrawLabel(m.add(new w(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!Le.active}

                Device: ${this._deviceMode}

                `,.03);const _=this._bottomCenter.clone(),x=this._backCenter.clone(),S=this._backBottomCenter.clone();e.localToWorld(_),e.localToWorld(x),e.localToWorld(S),Be.DrawSphere(_,.01,65280,0,!1),Be.DrawSphere(x,.01,255,0,!1),Be.DrawSphere(S,.01,16711935,0,!1),Be.DrawLine(_,S,65535,0,!1),Be.DrawLine(S,x,65535,0,!1)}}onDragEnd(t){console.assert(this._followObject.parent===t.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}setPlaneViewAligned(t,e){if(!this._followObject.parent)return!1;const i=this._followObject.parent.worldForward,s=Re(0,1,0),r=i,o=s.angleTo(r),a=.5;return e&&(o>Math.PI/2+a||o<Math.PI/2-a)?this._dragPlane.setFromNormalAndCoplanarPoint(s,t):this._dragPlane.setFromNormalAndCoplanarPoint(i,t),!0}}const u1=class{constructor(t){c(this,"showGizmo",!0);c(this,"useViewAngle",!0);c(this,"_selected",null);c(this,"_context",null);c(this,"_camera");c(this,"_cameraPlane",new ic);c(this,"_hasGroundPlane",!1);c(this,"_groundPlane",new ic);c(this,"_groundOffset",new w);c(this,"_groundOffsetFactor",0);c(this,"_groundDistance",0);c(this,"_groundPlanePoint",new w);c(this,"_raycaster",new ku);c(this,"_cameraPlaneOffset",new w);c(this,"_intersection",new w);c(this,"_worldPosition",new w);c(this,"_inverseMatrix",new ae);c(this,"_rbs",[]);c(this,"_groundLine");c(this,"_groundMarker");c(this,"_groundOffsetVector",new w(0,1,0));c(this,"_requireUpdateGroundPlane",!0);c(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=t;const e=new ms(u1.geometry),i=e.material;i.color=new be(.4,.4,.4),e.layers.set(2),e.name="line",e.scale.y=1,this._groundLine=e;const s=new Bu(.5,22,22),r=new _t({color:i.color}),o=new J(s,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(t,e){if(this._selected&&e)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&Jl.Remove(e,this._selected),this._selected=t,this._context=e,this._rbs.length=0,t?(e.scene.add(this._groundLine),e.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!e){console.error("DragHelper: no context");return}Jl.Add(e,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(t){this._selected}onUpdateWorldPosition(t,e,i){if(this._selected){if(i){const s=He(this._selected);s.y=t.y,t=s}if(Cn(this._selected,t),Cn(this._groundLine,t),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=e!==null&&this.showGizmo,e){const s=He(this._camera).distanceTo(e)*.01;this._groundMarker.scale.set(s,s,s),Cn(this._groundMarker,e)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const t=this._context.input.getPointerPositionRC(0);t&&(this._raycaster.setFromCamera(t,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const t=He(this._selected),e=new mh(Re(0,.1,0).add(t),Re(0,-1,0)),i=new rc;i.testObject=r=>r!==this._selected;const s=this._context.physics.raycastFromRay(e,i);for(let r=0;r<s.length;r++){const o=s[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=Re(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(e.direction.multiplyScalar(-1),e.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(t),this._groundOffset.copy(this._intersection).sub(t)}contains(t,e){if(t===e)return!0;if(t.children){for(const i of t.children)if(this.contains(i,e))return!0}return!1}};let uw=u1;c(uw,"geometry",new Ht().setFromPoints([new w(0,0,0),new w(0,-1,0)]));var Oy;(function(n){n.File_Spawned="file-spawned"})(Oy||(Oy={}));class o7{constructor(t,e,i,s,r,o,a,l){c(this,"guid");c(this,"file_name");c(this,"file_hash");c(this,"file_size");c(this,"position");c(this,"seed");c(this,"sender");c(this,"serverUrl");c(this,"parentGuid");c(this,"boundsSize");this.seed=e,this.guid=i,this.file_name=s,this.file_hash=r,this.file_size=o,this.position=a,this.sender=t,this.serverUrl=l}}async function a7(n,t,e){const i=n.name;return i.endsWith(".gltf")||i.endsWith(".glb")||n.type==="model/gltf+json"||n.type==="model/gltf-binary"?new Promise((s,r)=>{const o=new FileReader;o.readAsArrayBuffer(n),o.onloadend=async a=>{const l=o.result,h=DS(),u=new Sn(h),d=await nl().parseSync(t,l,n.name,u);if(d&&d.scene){const f=d.scene;if(!f.guid){const p=new Sn(h);f.guid=p.generateUUID()}e&&h7(t.connection,n,h,f,e),s(d)}}}):(console.warn("Unsupported file type: "+i,n),null)}async function l7(n,t){return new Promise(async(e,i)=>{const s=DS(),r=new Sn(s),o=n.toString(),a=await nl().loadSync(t,o,o,r);a&&a.scene?(a.scene,e(a)):console.warn("Unsupported file type: "+n.toString())})}xt.registerCallback(dt.ContextCreated,n=>{c7(n.context)});function c7(n){n.connection.beginListen(Oy.File_Spawned,async t=>{if(t.sender!==n.connection.connectionId){console.log("received file event",t),u7(t,n);let e=null;try{e=await AO(t.file_name,t.file_hash,t.file_size,t.serverUrl)}finally{d7(t)}if(e){const i=new Sn(t.seed),s=await nl().parseSync(n,e,t.file_name,i);if(s&&s.scene){const r=s.scene;if(t.parentGuid){const o=M0(t.parentGuid,n.scene);o&&"add"in o&&o.add(r)}r.parent||n.scene.add(r),t.position!==null&&r.position.copy(t.position)}}else console.error("download didnt return file")}})}async function h7(n,t,e,i,s){if(!n.connectionId){console.error("Can not upload file - no connection id");return}if(!i.guid){console.error("Can not upload file - no guid",i,i.guid);return}const r=await z6(t,s);if(!r)return;if(!r.filename){console.error("Can not send upload event - no filename",t.name);return}if(!r.hash){console.error("Can not send upload event - no hash",t.name);return}const o=new o7(n.connectionId,e,i.guid,r.filename,r.hash,t.size,i.position,r.url??s);i.parent&&(o.parentGuid=i.parent.guid),n.send(Oy.File_Spawned,o)}const oC={};function u7(n,t){const e=new on,i=new J(e,new _t({color:65280})),s=new NP(i,5592405);if(oC[n.guid]=s,t.scene.add(s),n.parentGuid){const r=M0(n.parentGuid,t.scene);r&&r.add(s)}n.position&&s.position.copy(n.position)}function d7(n,t){const e=n.guid,i=oC[e];i&&(delete oC[e],i.removeFromParent())}var Wm=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Bc=z("debugdroplistener");var Ly;(function(n){n.FileDropped="file-dropped",n.ObjectAdded="object-added"})(Ly||(Ly={}));class Zu extends re{constructor(){super(...arguments);c(this,"dropArea");c(this,"fitIntoVolume",!1);c(this,"fitVolumeSize",new w(1,1,1));c(this,"placeAtHitPosition",!0);c(this,"onDropped",new $t);c(this,"onNetworkEvent",e=>{var i;if((i=e.guid)!=null&&i.startsWith(this.guid)){const s=e.url;if(s)if(Array.isArray(s))for(const r of s)this.addFromUrl(r,{screenposition:new oe},!0).then(o=>{o==null||o.position.set(e.point.x,e.point.y,e.point.z)});else this.addFromUrl(s,{screenposition:new oe},!0).then(r=>{r==null||r.position.set(e.point.x,e.point.y,e.point.z)})}});c(this,"handlePaste",async e=>{if(this.context.connection.allowEditing===!1)return;if((e.ctrlKey||e.metaKey)&&e.key==="v"){const r=await navigator.clipboard.readText().catch(console.warn);if(r&&(r.startsWith("http")||r.startsWith("https")||r.startsWith("blob"))){const a={screenposition:new oe(this.context.input.mousePosition.x,this.context.input.mousePosition.y)};this.testIfIsInDropArea(a)&&this.addFromUrl(r,a,!1)}}});c(this,"onDrag",e=>{this.context.connection.allowEditing!==!1&&e.preventDefault()});c(this,"onDrop",async e=>{if(this.context.connection.allowEditing===!1||(Bc&&console.log(e),!(e!=null&&e.dataTransfer))||e["droplistener:handled"])return;e.preventDefault();const i={screenposition:new oe(e.offsetX,e.offsetY)};if(this.dropArea&&this.testIfIsInDropArea(i)===!1)return;e["droplistener:handled"]=!0;const s=e.dataTransfer.items;if(s)for(const r in s){const o=s[r];if(o.kind==="file"){const a=o.getAsFile();if(!a)continue;await this.addFiles([a],i)}else o.kind==="string"&&o.type=="text/plain"&&o.getAsString(a=>{this.addFromUrl(a,i,!1)})}});c(this,"_addedObjects",new Array)}onEnable(){this.context.renderer.domElement.addEventListener("dragover",this.onDrag),this.context.renderer.domElement.addEventListener("drop",this.onDrop),window.addEventListener("keyup",this.handlePaste),this.context.connection.beginListen("droplistener",this.onNetworkEvent)}onDisable(){this.context.renderer.domElement.removeEventListener("dragover",this.onDrag),this.context.renderer.domElement.removeEventListener("drop",this.onDrop),window.removeEventListener("keyup",this.handlePaste),this.context.connection.stopListen("droplistener",this.onNetworkEvent)}async addFromUrl(e,i,s){Bc&&console.log("dropped url",e);try{if(e.startsWith("https://github.com/")){const a=e.split("/"),l=a[3],h=a[4],u=a[6],d=a.slice(7).join("/");e=`https://raw.githubusercontent.com/${l}/${h}/${u}/${d}`}else e.startsWith("https://polyhaven.com/a")&&(e=f7(e));if(!e)return null;const r=e.toLowerCase();if(r.endsWith(".hdr")||r.endsWith(".hdri")||r.endsWith(".exr")||r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg"))return null;const o=await l7(new URL(e),this.context);if(o)return i.url=e,this.addObject(o,i,s)}catch{console.warn("String is not a valid URL",e)}return null}async addFiles(e,i){if(Bc&&console.log("Add files",e),!!Array.isArray(e)&&e.length)for(const s of e){if(!s)continue;Bc&&console.log("Register file "+s.name,s);const r=await a7(s,this.context);this.dispatchEvent(new CustomEvent(Ly.FileDropped,{detail:s})),r&&this.addObject(r,i,!1)}}addObject(e,i,s){var a,l;if(Bc&&console.log(`Dropped ${this.gameObject.name}`,e),!(e!=null&&e.scene))return console.warn("No object specified to add to scene",e),null;for(const h of this._addedObjects)h.parent===this.gameObject&&wo(h,!0,!0);this._addedObjects.length=0;const r=e.scene;this.gameObject.attach(r),r.position.set(0,0,0),r.quaternion.identity(),this._addedObjects.push(r),Bc&&r.add(new dr(1));const o=new xn().setFromCenterAndSize(new w(0,this.fitVolumeSize.y*.5,0).add(this.gameObject.worldPosition),this.fitVolumeSize);if(Bc&&Be.DrawWireBox3(o,255,5),this.fitIntoVolume&&wz(r,o,{position:!this.placeAtHitPosition}),this.placeAtHitPosition&&i&&i.screenposition){r.visible=!1;const h=this.context.physics.raycast({screenPoint:this.context.input.convertScreenspaceToRaycastSpace(i.screenposition.clone())});if(r.visible=!0,h&&h.length>0)for(const u of h){const d=u.point.clone();Bc&&console.log("Place object at hit",u),xz(r,d);break}}if(sm.assignAnimationsFromFile(e,{createAnimationComponent:h=>Ao(h,Ws)}),this.dispatchEvent(new CustomEvent(Ly.ObjectAdded,{detail:e})),(a=this.onDropped)==null||a.invoke({sender:this,gltf:e}),!s&&((l=i.url)!=null&&l.startsWith("http"))&&this.context.connection.isConnected&&r){const h={guid:this.guid,url:i.url,point:r.position.clone()};this.context.connection.send("droplistener",h)}return r}testIfIsInDropArea(e){if(this.dropArea){const i=this.context.input.convertScreenspaceToRaycastSpace(e.screenposition.clone());if(!this.context.physics.raycast({targets:[this.dropArea],screenPoint:i,recursive:!0,testObject:r=>!this._addedObjects.includes(r)}).length)return ve()&&console.log(`Dropped outside of drop area for DropListener "${this.name}".`),!1}return!0}}Wm([A(ne)],Zu.prototype,"dropArea",void 0);Wm([A()],Zu.prototype,"fitIntoVolume",void 0);Wm([A(w)],Zu.prototype,"fitVolumeSize",void 0);Wm([A()],Zu.prototype,"placeAtHitPosition",void 0);Wm([A($t)],Zu.prototype,"onDropped",void 0);function f7(n){if(!n.startsWith("https://polyhaven.com/"))return n;const t="https://dl.polyhaven.org/file/ph-assets/Models/gltf/4k/",s=new URL(n).pathname.split("/").pop(),r=`${t}${s}/${s}_4k.gltf`;return console.log("Resolved polyhaven asset url",n,"â†’",r),r}var lb=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Eh extends re{constructor(){super(...arguments);c(this,"parent",null);c(this,"object",null);c(this,"limitCount",10);c(this,"limitInterval",60);c(this,"_currentCount",0);c(this,"_startPosition",null);c(this,"_startQuaternion",null);c(this,"_forwardPointerEvents",new Map)}start(){var e,i;if(this._currentCount=0,this._startPosition=null,this._startQuaternion=null,this.object||(this.object=this.gameObject),this.object){if(this.object===this.gameObject){const r=new Sn(this.guid);this.object=Q.instantiate(this.object,{idProvider:r,keepWorldPosition:!1});const o=Q.getComponent(this.object,Eh);o==null||o.destroy();let a=this.object.getComponentInChildren(_n);a||(a=this.object.addComponent(_n,{dragMode:gs.SnapToSurfaces}),a.guid=r.generateUUID());let l=Q.getComponent(a.gameObject,oc);l||(l=a.gameObject.addComponent(oc),l.guid=r.generateUUID())}this.object.visible=!1;const s=this.gameObject.getComponent(_n);s&&(s.enabled=!1),this._startPosition=((e=this.object.position)==null?void 0:e.clone())??new w(0,0,0),this._startQuaternion=((i=this.object.quaternion)==null?void 0:i.clone())??new ie(0,0,0,1)}this.gameObject.getComponentInParent(xo)||this.gameObject.addComponent(xo),this.cloneLimitIntervalFn()}onPointerEnter(e){e.used||this.object&&this.context.connection.allowEditing&&e.button===0&&this.context.input.setCursorPointer()}onPointerExit(e){e.used||this.object&&this.context.connection.allowEditing&&e.button===0&&this.context.input.setCursorNormal()}onPointerDown(e){if(e.used||!this.object||!this.context.connection.allowEditing||e.button!==0)return;const i=this.handleDuplication();if(i){const s=Q.getComponent(i,_n);s?(s.onPointerDown(e),this._forwardPointerEvents.set(e.event.space,s)):console.warn("Duplicated object does not have DragControls")}}onPointerUp(e){if(e.used)return;const i=this._forwardPointerEvents.get(e.event.space);i&&(i.onPointerUp(e),this._forwardPointerEvents.delete(e.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var s;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const e=new ll;this.parent||(this.parent=this.gameObject.parent),this.parent&&(e.parent=this.parent.guid??((s=this.parent.userData)==null?void 0:s.guid),e.keepWorldPosition=!0),e.position=this.worldPosition,e.rotation=this.worldQuaternion,e.context=this.context,this._currentCount+=1;const i=Q.instantiateSynced(this.object,e);return console.assert(i!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),i}}lb([A(ne)],Eh.prototype,"parent",void 0);lb([A(ne)],Eh.prototype,"object",void 0);lb([A()],Eh.prototype,"limitCount",void 0);lb([A()],Eh.prototype,"limitInterval",void 0);class Fy extends ns{constructor(e){super();c(this,"effect");this.effect=e}get typeName(){return this.effect.constructor.name}onCreateEffect(){return this.effect}}var Zh;(function(n){n[n.PointerEnter=0]="PointerEnter",n[n.PointerExit=1]="PointerExit",n[n.PointerDown=2]="PointerDown",n[n.PointerUp=3]="PointerUp",n[n.PointerClick=4]="PointerClick",n[n.Drag=5]="Drag",n[n.Drop=6]="Drop",n[n.Scroll=7]="Scroll",n[n.UpdateSelected=8]="UpdateSelected",n[n.Select=9]="Select",n[n.Deselect=10]="Deselect",n[n.Move=11]="Move",n[n.InitializePotentialDrag=12]="InitializePotentialDrag",n[n.BeginDrag=13]="BeginDrag",n[n.EndDrag=14]="EndDrag",n[n.Submit=15]="Submit",n[n.Cancel=16]="Cancel"})(Zh||(Zh={}));var xE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class CE{constructor(){c(this,"eventID");c(this,"callback",new $t)}}xE([A()],CE.prototype,"eventID",void 0);xE([A($t)],CE.prototype,"callback",void 0);class SE extends re{constructor(){super(...arguments);c(this,"triggers",[])}invoke(e){if(this.triggers)for(const i of this.triggers)i.eventID===e&&i.callback.invoke()}onPointerClick(e){this.invoke(Zh.PointerClick)}onPointerEnter(e){this.invoke(Zh.PointerEnter)}onPointerExit(e){this.invoke(Zh.PointerExit)}onPointerDown(e){this.invoke(Zh.PointerDown)}onPointerUp(e){this.invoke(Zh.PointerUp)}}xE([A(CE)],SE.prototype,"triggers",void 0);var EE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class IE extends re{constructor(){super(...arguments);c(this,"connectedBody");c(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(It)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}EE([A(It)],IE.prototype,"connectedBody",void 0);class U2 extends IE{createJoint(t,e){var i;(i=this.context.physics.engine)==null||i.addFixedJoint(t,e)}}class cb extends IE{constructor(){super(...arguments);c(this,"anchor");c(this,"axis")}createJoint(e,i){var s;this.axis&&this.anchor&&((s=this.context.physics.engine)==null||s.addHingeJoint(e,i,this.anchor,this.axis))}}EE([A(w)],cb.prototype,"anchor",void 0);EE([A(w)],cb.prototype,"axis",void 0);const p7={type:"change"};let g7=class extends hc{constructor(t,e){super(),this.object=t,this.domElement=e,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const i=this,s=1e-6,r=new ie,o=new w;this.tmpQuaternion=new ie,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new w(0,0,0),this.rotationVector=new w(0,0,0),this.keydown=function(g){if(!(g.altKey||this.enabled===!1)){switch(g.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(g){if(this.enabled!==!1){switch(g.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(g){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(g.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(g){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const m=this.getContainerDimensions(),v=m.size[0]/2,y=m.size[1]/2;this.moveState.yawLeft=-(g.pageX-m.offset[0]-v)/v,this.moveState.pitchDown=(g.pageY-m.offset[1]-y)/y,this.updateRotationVector()}},this.pointerup=function(g){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(g.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(g){this.enabled!==!1&&g.preventDefault()},this.update=function(g){if(this.enabled===!1)return;const m=g*i.movementSpeed,v=g*i.rollSpeed;i.object.translateX(i.moveVector.x*m),i.object.translateY(i.moveVector.y*m),i.object.translateZ(i.moveVector.z*m),i.tmpQuaternion.set(i.rotationVector.x*v,i.rotationVector.y*v,i.rotationVector.z*v,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),(o.distanceToSquared(i.object.position)>s||8*(1-r.dot(i.object.quaternion))>s)&&(i.dispatchEvent(p7),r.copy(i.object.quaternion),o.copy(i.object.position))},this.updateMovementVector=function(){const g=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-g+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a),this.domElement.removeEventListener("pointerdown",h),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",u),this.domElement.removeEventListener("pointercancel",d),window.removeEventListener("keydown",f),window.removeEventListener("keyup",p)};const a=this.contextMenu.bind(this),l=this.pointermove.bind(this),h=this.pointerdown.bind(this),u=this.pointerup.bind(this),d=this.pointercancel.bind(this),f=this.keydown.bind(this),p=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",a),this.domElement.addEventListener("pointerdown",h),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",u),this.domElement.addEventListener("pointercancel",d),window.addEventListener("keydown",f),window.addEventListener("keyup",p),this.updateMovementVector(),this.updateRotationVector()}};class N2 extends re{constructor(){super(...arguments);c(this,"_controls",null)}onEnable(){var i;const e=(i=Q.getComponent(this.gameObject,Bt))==null?void 0:i.cam;if(!e){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new g7(e,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var e;(e=this._controls)==null||e.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var TE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},aC;(function(n){n[n.Linear=1]="Linear",n[n.Exponential=2]="Exponential",n[n.ExponentialSquared=3]="ExponentialSquared"})(aC||(aC={}));class qm extends re{constructor(){super(...arguments);c(this,"_fog")}get fog(){return this._fog||(this._fog=new OP(0,0,50)),this._fog}get mode(){return aC.Linear}set near(e){this.fog.near=e}get near(){return this.fog.near}set far(e){this.fog.far=e}get far(){return this.fog.far}set color(e){this.fog.color.copy(e)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}TE([A()],qm.prototype,"near",null);TE([A()],qm.prototype,"far",null);TE([A(be)],qm.prototype,"color",null);let Bp,dw,md,iv;function fw(n,t=1/0,e=null){dw||(dw=new pr(2,2,1,1)),md||(md=new $e({uniforms:{blitTexture:new $(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),md.uniforms.blitTexture.value=n,md.defines.IS_SRGB=n.colorSpace==Ge,md.needsUpdate=!0,iv||(iv=new J(dw,md),iv.frustrumCulled=!1);const i=new bt,s=new ws;s.add(iv),e===null&&(e=Bp=new Pu({antialias:!1}));const r=Math.min(n.image.width,t),o=Math.min(n.image.height,t);e.setSize(r,o),e.clear(),e.render(s,i);const a=document.createElement("canvas"),l=a.getContext("2d");a.width=r,a.height=o,l.drawImage(e.domElement,0,0,r,o);const h=new GP(a);return h.minFilter=n.minFilter,h.magFilter=n.magFilter,h.wrapS=n.wrapS,h.wrapT=n.wrapT,h.name=n.name,Bp&&(Bp.forceContextLoss(),Bp.dispose(),Bp=null),h}const ZR={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class hb{constructor(){this.pluginCallbacks=[],this.register(function(t){return new S7(t)}),this.register(function(t){return new E7(t)}),this.register(function(t){return new R7(t)}),this.register(function(t){return new B7(t)}),this.register(function(t){return new P7(t)}),this.register(function(t){return new M7(t)}),this.register(function(t){return new I7(t)}),this.register(function(t){return new T7(t)}),this.register(function(t){return new k7(t)}),this.register(function(t){return new D7(t)}),this.register(function(t){return new O7(t)}),this.register(function(t){return new L7(t)}),this.register(function(t){return new F7(t)})}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){const r=new C7,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(t,e,s).catch(i)}parseAsync(t,e){const i=this;return new Promise(function(s,r){i.parse(t,s,r,e)})}}const ut={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},pw="KHR_mesh_quantization",Dr={};Dr[mi]=ut.NEAREST;Dr[RP]=ut.NEAREST_MIPMAP_NEAREST;Dr[PP]=ut.NEAREST_MIPMAP_LINEAR;Dr[Mt]=ut.LINEAR;Dr[BP]=ut.LINEAR_MIPMAP_NEAREST;Dr[_m]=ut.LINEAR_MIPMAP_LINEAR;Dr[qv]=ut.CLAMP_TO_EDGE;Dr[nc]=ut.REPEAT;Dr[Xv]=ut.MIRRORED_REPEAT;const $R={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},m7=new be,eB=12,A7=1179937895,v7=2,tB=8,y7=1313821514,b7=5130562;function Zp(n,t){return n.length===t.length&&n.every(function(e,i){return e===t[i]})}function _7(n){return new TextEncoder().encode(n).buffer}function w7(n){return Zp(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function x7(n,t,e){const i={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=t;s<t+e;s++)for(let r=0;r<n.itemSize;r++){let o;n.itemSize>4?o=n.array[s*n.itemSize+r]:(r===0?o=n.getX(s):r===1?o=n.getY(s):r===2?o=n.getZ(s):r===3&&(o=n.getW(s)),n.normalized===!0&&(o=ct.normalize(o,n.array))),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}function z2(n){return Math.ceil(n/4)*4}function gw(n,t=0){const e=z2(n.byteLength);if(e!==n.byteLength){const i=new Uint8Array(e);if(i.set(new Uint8Array(n)),t!==0)for(let s=n.byteLength;s<e;s++)i[s]=t;return i.buffer}return n}function iB(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function nB(n,t){if(n.toBlob!==void 0)return new Promise(i=>n.toBlob(i,t));let e;return t==="image/jpeg"?e=.92:t==="image/webp"&&(e=.8),n.convertToBlob({type:t,quality:e})}class C7{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(t){this.plugins=t}async write(t,e,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(t),await Promise.all(this.pending);const s=this,r=s.buffers,o=s.json;i=s.options;const a=s.extensionsUsed,l=s.extensionsRequired,h=new Blob(r,{type:"application/octet-stream"}),u=Object.keys(a),d=Object.keys(l);if(u.length>0&&(o.extensionsUsed=u),d.length>0&&(o.extensionsRequired=d),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=h.size),i.binary===!0){const f=new FileReader;f.readAsArrayBuffer(h),f.onloadend=function(){const p=gw(f.result),g=new DataView(new ArrayBuffer(tB));g.setUint32(0,p.byteLength,!0),g.setUint32(4,b7,!0);const m=gw(_7(JSON.stringify(o)),32),v=new DataView(new ArrayBuffer(tB));v.setUint32(0,m.byteLength,!0),v.setUint32(4,y7,!0);const y=new ArrayBuffer(eB),b=new DataView(y);b.setUint32(0,A7,!0),b.setUint32(4,v7,!0);const _=eB+v.byteLength+m.byteLength+g.byteLength+p.byteLength;b.setUint32(8,_,!0);const x=new Blob([y,v,m,g,p],{type:"application/octet-stream"}),S=new FileReader;S.readAsArrayBuffer(x),S.onloadend=function(){e(S.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(h),f.onloadend=function(){const p=f.result;o.buffers[0].uri=p,e(o)}}else e(o)}serializeUserData(t,e){if(Object.keys(t.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(t.userData));if(i.includeCustomExtensions&&r.gltfExtensions){e.extensions===void 0&&(e.extensions={});for(const o in r.gltfExtensions)e.extensions[o]=r.gltfExtensions[o],s[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(e.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(t,e=!1){if(this.uids.has(t)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(t,s)}return this.uids.get(t).get(e)}isNormalizedNormalAttribute(t){if(this.cache.attributesNormalized.has(t))return!1;const i=new w;for(let s=0,r=t.count;s<r;s++)if(Math.abs(i.fromBufferAttribute(t,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(t){const e=this.cache;if(e.attributesNormalized.has(t))return e.attributesNormalized.get(t);const i=t.clone(),s=new w;for(let r=0,o=i.count;r<o;r++)s.fromBufferAttribute(i,r),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(r,s.x,s.y,s.z);return e.attributesNormalized.set(t,i),i}applyTextureTransform(t,e){let i=!1;const s={};(e.offset.x!==0||e.offset.y!==0)&&(s.offset=e.offset.toArray(),i=!0),e.rotation!==0&&(s.rotation=e.rotation,i=!0),(e.repeat.x!==1||e.repeat.y!==1)&&(s.scale=e.repeat.toArray(),i=!0),i&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(t,e){if(t===e)return t;function i(p){return p.colorSpace===Ge?function(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)}:function(m){return m}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),t instanceof tf&&(t=fw(t)),e instanceof tf&&(e=fw(e));const s=t?t.image:null,r=e?e.image:null,o=Math.max(s?s.width:0,r?r.width:0),a=Math.max(s?s.height:0,r?r.height:0),l=iB();l.width=o,l.height=a;const h=l.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,o,a);const u=h.getImageData(0,0,o,a);if(s){h.drawImage(s,0,0,o,a);const p=i(t),g=h.getImageData(0,0,o,a).data;for(let m=2;m<g.length;m+=4)u.data[m]=p(g[m]/256)*256}if(r){h.drawImage(r,0,0,o,a);const p=i(e),g=h.getImageData(0,0,o,a).data;for(let m=1;m<g.length;m+=4)u.data[m]=p(g[m]/256)*256}h.putImageData(u,0,0);const f=(t||e).clone();return f.source=new LP(l),f.colorSpace=xu,f.channel=(t||e).channel,t&&e&&t.channel!==e.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),f}processBuffer(t){const e=this.json,i=this.buffers;return e.buffers||(e.buffers=[{byteLength:0}]),i.push(t),0}processBufferView(t,e,i,s,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(e){case ut.BYTE:case ut.UNSIGNED_BYTE:a=1;break;case ut.SHORT:case ut.UNSIGNED_SHORT:a=2;break;default:a=4}const l=z2(s*t.itemSize*a),h=new DataView(new ArrayBuffer(l));let u=0;for(let p=i;p<i+s;p++)for(let g=0;g<t.itemSize;g++){let m;t.itemSize>4?m=t.array[p*t.itemSize+g]:(g===0?m=t.getX(p):g===1?m=t.getY(p):g===2?m=t.getZ(p):g===3&&(m=t.getW(p)),t.normalized===!0&&(m=ct.normalize(m,t.array))),e===ut.FLOAT?h.setFloat32(u,m,!0):e===ut.INT?h.setInt32(u,m,!0):e===ut.UNSIGNED_INT?h.setUint32(u,m,!0):e===ut.SHORT?h.setInt16(u,m,!0):e===ut.UNSIGNED_SHORT?h.setUint16(u,m,!0):e===ut.BYTE?h.setInt8(u,m):e===ut.UNSIGNED_BYTE&&h.setUint8(u,m),u+=a}const d={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(d.target=r),r===ut.ARRAY_BUFFER&&(d.byteStride=t.itemSize*a),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(t){const e=this,i=e.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const r=new FileReader;r.readAsArrayBuffer(t),r.onloadend=function(){const o=gw(r.result),a={buffer:e.processBuffer(o),byteOffset:e.byteOffset,byteLength:o.byteLength};e.byteOffset+=o.byteLength,s(i.bufferViews.push(a)-1)}})}processAccessor(t,e,i,s){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(t.array.constructor===Float32Array)a=ut.FLOAT;else if(t.array.constructor===Int32Array)a=ut.INT;else if(t.array.constructor===Uint32Array)a=ut.UNSIGNED_INT;else if(t.array.constructor===Int16Array)a=ut.SHORT;else if(t.array.constructor===Uint16Array)a=ut.UNSIGNED_SHORT;else if(t.array.constructor===Int8Array)a=ut.BYTE;else if(t.array.constructor===Uint8Array)a=ut.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+t.array.constructor.name);if(i===void 0&&(i=0),(s===void 0||s===1/0)&&(s=t.count),s===0)return null;const l=x7(t,i,s);let h;e!==void 0&&(h=t===e.index?ut.ELEMENT_ARRAY_BUFFER:ut.ARRAY_BUFFER);const u=this.processBufferView(t,a,i,s,h),d={bufferView:u.id,byteOffset:u.byteOffset,componentType:a,count:s,max:l.max,min:l.min,type:o[t.itemSize]};return t.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(t,e,i,s="image/png"){if(t!==null){const r=this,o=r.cache,a=r.json,l=r.options,h=r.pending;o.images.has(t)||o.images.set(t,{});const u=o.images.get(t),d=s+":flipY/"+i.toString();if(u[d]!==void 0)return u[d];a.images||(a.images=[]);const f={mimeType:s},p=iB();p.width=Math.min(t.width,l.maxTextureSize),p.height=Math.min(t.height,l.maxTextureSize);const g=p.getContext("2d");if(i===!0&&(g.translate(0,p.height),g.scale(1,-1)),t.data!==void 0){e!==Wi&&console.error("GLTFExporter: Only RGBAFormat is supported.",e),(t.width>l.maxTextureSize||t.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);const v=new Uint8ClampedArray(t.height*t.width*4);for(let y=0;y<v.length;y+=4)v[y+0]=t.data[y+0],v[y+1]=t.data[y+1],v[y+2]=t.data[y+2],v[y+3]=t.data[y+3];g.putImageData(new ImageData(v,t.width,t.height),0,0)}else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)g.drawImage(t,0,0,p.width,p.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");l.binary===!0?h.push(nB(p,s).then(v=>r.processBufferViewImage(v)).then(v=>{f.bufferView=v})):p.toDataURL!==void 0?f.uri=p.toDataURL(s):h.push(nB(p,s).then(v=>new FileReader().readAsDataURL(v)).then(v=>{f.uri=v}));const m=a.images.push(f)-1;return u[d]=m,m}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(t){const e=this.json;e.samplers||(e.samplers=[]);const i={magFilter:Dr[t.magFilter],minFilter:Dr[t.minFilter],wrapS:Dr[t.wrapS],wrapT:Dr[t.wrapT]};return e.samplers.push(i)-1}processTexture(t){const i=this.options,s=this.cache,r=this.json;if(s.textures.has(t))return s.textures.get(t);const o={keep:!0,newTexture:null};if(this._invokeAll(function(u){u.beforeWriteTexture&&u.beforeWriteTexture(t,o)}),o.keep===!1)return null;o.newTexture!=null&&(t=o.newTexture),r.textures||(r.textures=[]),t instanceof tf&&(t=fw(t,i.maxTextureSize));let a=t.userData.mimeType;a==="image/webp"&&(a="image/png");const l={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY,a)};t.name&&(l.name=t.name),this._invokeAll(function(u){u.writeTexture&&u.writeTexture(t,l)});const h=r.textures.push(l)-1;return s.textures.set(t,h),h}processMaterial(t){var h,u,d,f,p;const e=this.cache,i=this.json;if(e.materials.has(t))return e.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};t.isMeshStandardMaterial!==!0&&t.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=t.color.toArray().concat([t.opacity]);Zp(r,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=r),t.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=t.metalness,s.pbrMetallicRoughness.roughnessFactor=t.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5);const o=(h=t.metalnessMap)!=null&&h.image?t.metalnessMap:void 0,a=(u=t.roughnessMap)!=null&&u.image?t.roughnessMap:void 0;if(o||a){const g=this.buildMetalRoughTexture(o,a),m={index:this.processTexture(g),channel:g.channel};this.applyTextureTransform(m,g),s.pbrMetallicRoughness.metallicRoughnessTexture=m}if(t.map){const g={index:this.processTexture(t.map),texCoord:t.map.channel};this.applyTextureTransform(g,t.map),s.pbrMetallicRoughness.baseColorTexture=g}if(t.emissive){const g=t.emissive;if(Math.max(g.r,g.g,g.b)>0&&(s.emissiveFactor=t.emissive.toArray()),(d=t.emissiveMap)!=null&&d.image){const v={index:this.processTexture(t.emissiveMap),texCoord:t.emissiveMap.channel};this.applyTextureTransform(v,t.emissiveMap),s.emissiveTexture=v}}if((f=t.normalMap)!=null&&f.image){const g={index:this.processTexture(t.normalMap),texCoord:t.normalMap.channel};t.normalScale&&t.normalScale.x!==1&&(g.scale=t.normalScale.x),this.applyTextureTransform(g,t.normalMap),s.normalTexture=g}if((p=t.aoMap)!=null&&p.image){const g={index:this.processTexture(t.aoMap),texCoord:t.aoMap.channel};t.aoMapIntensity!==1&&(g.strength=t.aoMapIntensity),this.applyTextureTransform(g,t.aoMap),s.occlusionTexture=g}t.transparent?s.alphaMode="BLEND":t.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=t.alphaTest),t.side===_i&&(s.doubleSided=!0),t.name!==""&&(s.name=t.name),this.serializeUserData(t,s),this._invokeAll(function(g){g.writeMaterial&&g.writeMaterial(t,s)});const l=i.materials.push(s)-1;return e.materials.set(t,l),l}processMesh(t){const e={keep:!0};if(this._invokeAll(function(S){S.beforeWriteMesh&&S.beforeWriteMesh(t,e)}),e.keep!=!0)return null;const i=this.cache,s=this.json,r=[t.geometry.uuid];if(Array.isArray(t.material))for(let S=0,E=t.material.length;S<E;S++)r.push(t.material[S].uuid);else r.push(t.material.uuid);const o=r.join(":");if(i.meshes.has(o))return i.meshes.get(o);const a=t.geometry;let l;t.isLineSegments?l=ut.LINES:t.isLineLoop?l=ut.LINE_LOOP:t.isLine?l=ut.LINE_STRIP:t.isPoints?l=ut.POINTS:l=t.material.wireframe?ut.LINES:ut.TRIANGLES;const h={},u={},d=[],f=[],p={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},g=a.getAttribute("normal");g!==void 0&&!this.isNormalizedNormalAttribute(g)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(g)));let m=null;for(let S in a.attributes){if(S.slice(0,5)==="morph")continue;const E=a.attributes[S];if(S=p[S]||S.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(S)||(S="_"+S),i.attributes.has(this.getUID(E))){u[S]=i.attributes.get(this.getUID(E));continue}m=null;const I=E.array;S==="JOINTS_0"&&!(I instanceof Uint16Array)&&!(I instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),m=new Ke(new Uint16Array(I),E.itemSize,E.normalized));const B=this.processAccessor(m||E,a);B!==null&&(S.startsWith("_")||this.detectMeshQuantization(S,E),u[S]=B,i.attributes.set(this.getUID(E),B))}if(g!==void 0&&a.setAttribute("normal",g),Object.keys(u).length===0)return null;if(t.morphTargetInfluences!==void 0&&t.morphTargetInfluences.length>0){const S=[],E=[],M={};if(t.morphTargetDictionary!==void 0)for(const I in t.morphTargetDictionary)M[t.morphTargetDictionary[I]]=I;for(let I=0;I<t.morphTargetInfluences.length;++I){const B={};let R=!1;for(const P in a.morphAttributes){if(P!=="position"&&P!=="normal"){R||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),R=!0);continue}const F=a.morphAttributes[P][I],j=P.toUpperCase(),V=a.attributes[P];if(i.attributes.has(this.getUID(F,!0))){B[j]=i.attributes.get(this.getUID(F,!0));continue}const X=F.clone();if(!a.morphTargetsRelative)for(let k=0,O=F.count;k<O;k++)for(let H=0;H<F.itemSize;H++)H===0&&X.setX(k,F.getX(k)-V.getX(k)),H===1&&X.setY(k,F.getY(k)-V.getY(k)),H===2&&X.setZ(k,F.getZ(k)-V.getZ(k)),H===3&&X.setW(k,F.getW(k)-V.getW(k));B[j]=this.processAccessor(X,a),i.attributes.set(this.getUID(V,!0),B[j])}f.push(B),S.push(t.morphTargetInfluences[I]),t.morphTargetDictionary!==void 0&&E.push(M[I])}h.weights=S,E.length>0&&(h.extras={},h.extras.targetNames=E)}const v=Array.isArray(t.material);if(v&&a.groups.length===0)return null;let y=!1;if(v&&a.index===null){const S=[];for(let E=0,M=a.attributes.position.count;E<M;E++)S[E]=E;a.setIndex(S),y=!0}const b=v?t.material:[t.material],_=v?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let S=0,E=_.length;S<E;S++){const M={mode:l,attributes:u};if(this.serializeUserData(a,M),f.length>0&&(M.targets=f),a.index!==null){let B=this.getUID(a.index);(_[S].start!==void 0||_[S].count!==void 0)&&(B+=":"+_[S].start+":"+_[S].count),i.attributes.has(B)?M.indices=i.attributes.get(B):(M.indices=this.processAccessor(a.index,a,_[S].start,_[S].count),i.attributes.set(B,M.indices)),M.indices===null&&delete M.indices}const I=this.processMaterial(b[_[S].materialIndex]);I!==null&&(M.material=I),d.push(M)}y===!0&&a.setIndex(null),h.primitives=d,s.meshes||(s.meshes=[]),this._invokeAll(function(S){S.writeMesh&&S.writeMesh(t,h)});const x=s.meshes.push(h)-1;return i.meshes.set(o,x),x}detectMeshQuantization(t,e){if(this.extensionsUsed[pw])return;let i;switch(e.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}e.normalized&&(i+=" normalized");const s=t.split("_",1)[0];ZR[s]&&ZR[s].includes(i)&&(this.extensionsUsed[pw]=!0,this.extensionsRequired[pw]=!0)}processCamera(t){const e=this.json;e.cameras||(e.cameras=[]);const i=t.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:t.right*2,ymag:t.top*2,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:s.perspective={aspectRatio:t.aspect,yfov:ct.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},t.name!==""&&(s.name=t.type),e.cameras.push(s)-1}processAnimation(t,e){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),t=hb.Utils.mergeMorphTargetTracks(t.clone(),e);const r=t.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const h=r[l],u=Ur.parseTrackName(h.name);let d=Ur.findNode(e,u.nodeName);const f=$R[u.propertyName];if(u.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(u.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name),null;const p=1;let g=h.values.length/h.times.length;f===$R.morphTargetInfluences&&(g/=d.morphTargetInfluences.length);let m;h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(m="CUBICSPLINE",g/=3):h.getInterpolation()===MP?m="STEP":m="LINEAR",a.push({input:this.processAccessor(new Ke(h.times,p)),output:this.processAccessor(new Ke(h.values,g)),interpolation:m}),o.push({sampler:a.length-1,target:{node:s.get(d),path:f}})}return i.animations.push({name:t.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(t){const e=this.json,i=this.nodeMap,s=e.nodes[i.get(t)],r=t.skeleton;if(r===void 0)return null;const o=t.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),h=new ae;for(let d=0;d<r.bones.length;++d)a.push(i.get(r.bones[d])),h.copy(r.boneInverses[d]),h.multiply(t.bindMatrix).toArray(l,d*16);return e.skins===void 0&&(e.skins=[]),e.skins.push({inverseBindMatrices:this.processAccessor(new Ke(l,16)),joints:a,skeleton:i.get(o)}),s.skin=e.skins.length-1}processNode(t){const e={keep:!0};if(this._invokeAll(function(l){l.beforeWriteNode&&l.beforeWriteNode(t,e)}),e.keep!=!0)return null;const i=this.json,s=this.options,r=this.nodeMap;i.nodes||(i.nodes=[]);const o={};if(s.trs){const l=t.quaternion.toArray(),h=t.position.toArray(),u=t.scale.toArray();Zp(l,[0,0,0,1])||(o.rotation=l),Zp(h,[0,0,0])||(o.translation=h),Zp(u,[1,1,1])||(o.scale=u)}else t.matrixAutoUpdate&&t.updateMatrix(),w7(t.matrix)===!1&&(o.matrix=t.matrix.elements);if(t.name!==""&&(o.name=String(t.name)),this.serializeUserData(t,o),t.isMesh||t.isLine||t.isPoints){const l=this.processMesh(t);l!==null&&(o.mesh=l)}else t.isCamera&&(o.camera=this.processCamera(t));if(t.isSkinnedMesh&&this.skins.push(t),t.children.length>0){const l=[];for(let h=0,u=t.children.length;h<u;h++){const d=t.children[h];if(d.visible||s.onlyVisible===!1){const f=this.processNode(d);f!==null&&l.push(f)}}l.length>0&&(o.children=l)}this._invokeAll(function(l){l.writeNode&&l.writeNode(t,o)});const a=i.nodes.push(o)-1;return r.set(t,a),a}processScene(t){const e=this.json,i=this.options;e.scenes||(e.scenes=[],e.scene=0);const s={};t.name!==""&&(s.name=t.name),e.scenes.push(s);const r=[];for(let o=0,a=t.children.length;o<a;o++){const l=t.children[o];if(l.visible||i.onlyVisible===!1){const h=this.processNode(l);h!==null&&r.push(h)}}r.length>0&&(s.nodes=r),this.serializeUserData(t,s)}processObjects(t){const e=new ws;e.name="AuxScene";for(let i=0;i<t.length;i++)e.children.push(t[i]);this.processScene(e)}processInput(t){const e=this.options;t=t instanceof Array?t:[t],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(t)});const i=[];for(let s=0;s<t.length;s++)t[s]instanceof ws?this.processScene(t[s]):i.push(t[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<e.animations.length;++s)this.processAnimation(e.animations[s],t[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(t)})}_invokeAll(t){for(let e=0,i=this.plugins.length;e<i;e++)t(this.plugins[e])}}class S7{constructor(t){this.writer=t,this.name="KHR_lights_punctual"}writeNode(t,e){if(!t.isLight)return;if(!t.isDirectionalLight&&!t.isPointLight&&!t.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t);return}const i=this.writer,s=i.json,r=i.extensionsUsed,o={};t.name&&(o.name=t.name),o.color=t.color.toArray(),o.intensity=t.intensity,t.isDirectionalLight?o.type="directional":t.isPointLight?(o.type="point",t.distance>0&&(o.range=t.distance)):t.isSpotLight&&(o.type="spot",t.distance>0&&(o.range=t.distance),o.spot={},o.spot.innerConeAngle=(1-t.penumbra)*t.angle,o.spot.outerConeAngle=t.angle),t.decay!==void 0&&t.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),t.target&&(t.target.parent!==t||t.target.position.x!==0||t.target.position.y!==0||t.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},r[this.name]=!0);const a=s.extensions[this.name].lights;a.push(o),e.extensions=e.extensions||{},e.extensions[this.name]={light:a.length-1}}}class E7{constructor(t){this.writer=t,this.name="KHR_materials_unlit"}writeMaterial(t,e){if(!t.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},s[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}}class I7{constructor(t){this.writer=t,this.name="KHR_materials_clearcoat"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.clearcoat===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.clearcoatFactor=t.clearcoat,t.clearcoatMap){const o={index:i.processTexture(t.clearcoatMap),texCoord:t.clearcoatMap.channel};i.applyTextureTransform(o,t.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=t.clearcoatRoughness,t.clearcoatRoughnessMap){const o={index:i.processTexture(t.clearcoatRoughnessMap),texCoord:t.clearcoatRoughnessMap.channel};i.applyTextureTransform(o,t.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(t.clearcoatNormalMap){const o={index:i.processTexture(t.clearcoatNormalMap),texCoord:t.clearcoatNormalMap.channel};i.applyTextureTransform(o,t.clearcoatNormalMap),r.clearcoatNormalTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class T7{constructor(t){this.writer=t,this.name="KHR_materials_iridescence"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.iridescence===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.iridescenceFactor=t.iridescence,t.iridescenceMap){const o={index:i.processTexture(t.iridescenceMap),texCoord:t.iridescenceMap.channel};i.applyTextureTransform(o,t.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=t.iridescenceIOR,r.iridescenceThicknessMinimum=t.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=t.iridescenceThicknessRange[1],t.iridescenceThicknessMap){const o={index:i.processTexture(t.iridescenceThicknessMap),texCoord:t.iridescenceThicknessMap.channel};i.applyTextureTransform(o,t.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class R7{constructor(t){this.writer=t,this.name="KHR_materials_transmission"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.transmissionFactor=t.transmission,t.transmissionMap){const o={index:i.processTexture(t.transmissionMap),texCoord:t.transmissionMap.channel};i.applyTextureTransform(o,t.transmissionMap),r.transmissionTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class B7{constructor(t){this.writer=t,this.name="KHR_materials_volume"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.thicknessFactor=t.thickness,t.thicknessMap){const o={index:i.processTexture(t.thicknessMap),texCoord:t.thicknessMap.channel};i.applyTextureTransform(o,t.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=t.attenuationDistance,r.attenuationColor=t.attenuationColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class P7{constructor(t){this.writer=t,this.name="KHR_materials_ior"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.ior===1.5)return;const s=this.writer.extensionsUsed,r={};r.ior=t.ior,e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class M7{constructor(t){this.writer=t,this.name="KHR_materials_specular"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.specularIntensity===1&&t.specularColor.equals(m7)&&!t.specularIntensityMap&&!t.specularColorMap)return;const i=this.writer,s=i.extensionsUsed,r={};if(t.specularIntensityMap){const o={index:i.processTexture(t.specularIntensityMap),texCoord:t.specularIntensityMap.channel};i.applyTextureTransform(o,t.specularIntensityMap),r.specularTexture=o}if(t.specularColorMap){const o={index:i.processTexture(t.specularColorMap),texCoord:t.specularColorMap.channel};i.applyTextureTransform(o,t.specularColorMap),r.specularColorTexture=o}r.specularFactor=t.specularIntensity,r.specularColorFactor=t.specularColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class k7{constructor(t){this.writer=t,this.name="KHR_materials_sheen"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.sheen==0)return;const i=this.writer,s=i.extensionsUsed,r={};if(t.sheenRoughnessMap){const o={index:i.processTexture(t.sheenRoughnessMap),texCoord:t.sheenRoughnessMap.channel};i.applyTextureTransform(o,t.sheenRoughnessMap),r.sheenRoughnessTexture=o}if(t.sheenColorMap){const o={index:i.processTexture(t.sheenColorMap),texCoord:t.sheenColorMap.channel};i.applyTextureTransform(o,t.sheenColorMap),r.sheenColorTexture=o}r.sheenRoughnessFactor=t.sheenRoughness,r.sheenColorFactor=t.sheenColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class D7{constructor(t){this.writer=t,this.name="KHR_materials_anisotropy"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.anisotropy==0)return;const i=this.writer,s=i.extensionsUsed,r={};if(t.anisotropyMap){const o={index:i.processTexture(t.anisotropyMap)};i.applyTextureTransform(o,t.anisotropyMap),r.anisotropyTexture=o}r.anisotropyStrength=t.anisotropy,r.anisotropyRotation=t.anisotropyRotation,e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class O7{constructor(t){this.writer=t,this.name="KHR_materials_emissive_strength"}writeMaterial(t,e){if(!t.isMeshStandardMaterial||t.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,r={};r.emissiveStrength=t.emissiveIntensity,e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class L7{constructor(t){this.writer=t,this.name="EXT_materials_bump"}writeMaterial(t,e){if(!t.isMeshStandardMaterial||t.bumpScale===1&&!t.bumpMap)return;const i=this.writer,s=i.extensionsUsed,r={};if(t.bumpMap){const o={index:i.processTexture(t.bumpMap),texCoord:t.bumpMap.channel};i.applyTextureTransform(o,t.bumpMap),r.bumpTexture=o}r.bumpFactor=t.bumpScale,e.extensions=e.extensions||{},e.extensions[this.name]=r,s[this.name]=!0}}class F7{constructor(t){this.writer=t,this.name="EXT_mesh_gpu_instancing"}writeNode(t,e){if(!t.isInstancedMesh)return;const i=this.writer,s=t,r=new Float32Array(s.count*3),o=new Float32Array(s.count*4),a=new Float32Array(s.count*3),l=new ae,h=new w,u=new ie,d=new w;for(let p=0;p<s.count;p++)s.getMatrixAt(p,l),l.decompose(h,u,d),h.toArray(r,p*3),u.toArray(o,p*4),d.toArray(a,p*3);const f={TRANSLATION:i.processAccessor(new Ke(r,3)),ROTATION:i.processAccessor(new Ke(o,4)),SCALE:i.processAccessor(new Ke(a,3))};s.instanceColor&&(f._COLOR_0=i.processAccessor(s.instanceColor)),e.extensions=e.extensions||{},e.extensions[this.name]={attributes:f},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}hb.Utils={insertKeyframe:function(n,t){const i=n.getValueSize(),s=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){s[0]=t;for(let l=0;l<i;l++)r[l]=0;a=0}else if(t<n.times[0]){if(Math.abs(n.times[0]-t)<.001)return 0;s[0]=t,s.set(n.times,1),r.set(o.evaluate(t),0),r.set(n.values,i),a=0}else if(t>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-t)<.001)return n.times.length-1;s[s.length-1]=t,s.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(t),n.values.length),a=s.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-t)<.001)return l;if(n.times[l]<t&&n.times[l+1]>t){s.set(n.times.slice(0,l+1),0),s[l+1]=t,s.set(n.times.slice(l+1),l+2),r.set(n.values.slice(0,(l+1)*i),0),r.set(o.evaluate(t),(l+1)*i),r.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=s,n.values=r,a},mergeMorphTargetTracks:function(n,t){const e=[],i={},s=n.tracks;for(let r=0;r<s.length;++r){let o=s[r];const a=Ur.parseTrackName(o.name),l=Ur.findNode(t,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){e.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(kC)}const h=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(i[l.uuid]===void 0){d=o.clone();const p=new d.ValueBufferType(h*d.times.length);for(let g=0;g<d.times.length;g++)p[g*h+u]=d.values[g];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=p,i[l.uuid]=d,e.push(d);continue}const f=o.createInterpolant(new o.ValueBufferType(1));d=i[l.uuid];for(let p=0;p<d.times.length;p++)d.values[p*h+u]=f.evaluate(d.times[p]);for(let p=0;p<o.times.length;p++){const g=this.insertKeyframe(d,o.times[p]);d.values[g*h+u]=o.values[p]}}return n.tracks=e,n}};class Q2{constructor(t){this.writer=t,this.name="EXT_mesh_gpu_instancing"}writeNode(t,e){if(t.constructor.name!=="InstancedMesh")return;const i=this.writer,s=i.extensionsUsed,r={};e.extensions=e.extensions||{},e.extensions[this.name]=r;let o=new ae;const a=new Array,l=new Array,h=new Array;for(let p=0;p<t.count;p++){t.getMatrixAt(p,o);let g=new w,m=new ie,v=new w;o.decompose(g,m,v),a.push(g.x,g.y,g.z),l.push(m.x,m.y,m.z,m.w),h.push(v.x,v.y,v.z)}const u=new Float32Array(a),d=new Float32Array(l),f=new Float32Array(h);r.attributes={TRANSLATION:i.processAccessor(new Ke(u,3)),ROTATION:i.processAccessor(new Ke(d,4)),SCALE:i.processAccessor(new Ke(f,3))},s[this.name]=!0}}var j2=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const nv=z("debuggltfexport");class G2 extends qo{constructor(){super(...arguments);c(this,"sceneRoot")}}class Ua extends re{constructor(){super(...arguments);c(this,"binary",!0);c(this,"objects",[]);c(this,"ext")}async exportNow(e){nv&&console.log("Exporting objects as glTF",this.objects),e||(e="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const i={binary:this.binary,pivot:Ua.calculateCenter(this.objects)},s=await this.export(this.objects,i).catch(r=>(console.error(r),!1));return s===!1?!1:(this.binary?e.endsWith(".glb")||(e+=".glb"):e.endsWith(".gltf")||(e+=".gltf"),this.binary?Ua.saveArrayBuffer(s,e):Ua.saveJson(s,e),!0)}async export(e,i){if(!e||e.length<=0){console.warn("No objects set to export");return}const s=new hb;s.register(h=>new Q2(h)),E2(s,this.context),Ua.filterTopmostParent(e);const r={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:(i==null?void 0:i.animations)||Ua.collectAnimations(e),...i},o=new ne;i!=null&&i.pivot&&o.position.sub(i.pivot),nv&&console.log("EXPORT",e),e.forEach(h=>{h&&(o.children.push(h),h.matrixAutoUpdate=!1,h.matrix.copy(h.matrixWorld),Q.getComponentsInChildren(h,li).forEach(u=>{Q.isActiveInHierarchy(u.gameObject)&&u.setInstancingEnabled(!1)}))});const a=new nO(o);return this.ext&&(this.ext.context=a),new Promise((h,u)=>{nv&&console.log("Starting glTF export.");try{s==null||s.parse(o,d=>{l(),h(d)},d=>{l(),u(d)},r)}catch(d){console.error(d),u(d)}finally{nv&&console.log("Finished glTF export.")}});function l(){e.forEach(h=>{h&&(h.matrixAutoUpdate=!0,Q.getComponentsInChildren(h,li).forEach(u=>{Q.isActiveInHierarchy(u.gameObject)&&u.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(e,i){this.save(new Blob([e],{type:"application/octet-stream"}),i)}static saveJson(e,i){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),i)}static save(e,i){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),typeof e=="string"?s.href=e:s.href=URL.createObjectURL(e),s.download=i,s.click(),s.remove()}static collectAnimations(e,i){i=i||[];for(const s of e)s&&s.traverseVisible(r=>{r.animations&&r.animations.length>0&&i.push(...r.animations)});return i}static calculateCenter(e,i){const s=i||new w;return s.set(0,0,0),e.forEach(r=>{s.add(He(r))}),console.log(s),s.divideScalar(e.length),s}static filterTopmostParent(e){if(!(e.length<=0))for(let i=0;i<e.length;i++){let s=e[i];if(!s){e.splice(i,1),i--;continue}for(;s.parent;){if(e.includes(s.parent)){e.splice(i,1),i--;break}s=s.parent}}}}j2([A()],Ua.prototype,"binary",void 0);j2([A(ne)],Ua.prototype,"objects",void 0);var RE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Xm extends re{constructor(){super(...arguments);c(this,"isGizmo",!1);c(this,"color0");c(this,"color1");c(this,"gridHelper");c(this,"size");c(this,"divisions");c(this,"offset")}onEnable(){if(this.isGizmo&&!Tm)return;const e=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new TC(e,i,this.color0??new be(.4,.4,.4),this.color1??new be(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}RE([A()],Xm.prototype,"isGizmo",void 0);RE([A(be)],Xm.prototype,"color0",void 0);RE([A(be)],Xm.prototype,"color1",void 0);var ub=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Pc=z("debuginputfield"),De=class extends re{constructor(){super(...arguments);c(this,"textComponent");c(this,"placeholder");c(this,"onValueChanged");c(this,"onEndEdit");c(this,"inputEventFn");c(this,"_iosEventFn")}get text(){var e;return((e=this.textComponent)==null?void 0:e.text)??""}get isFocused(){return De.active===this}start(){Pc&&console.log(this.name,this)}onEnable(){var e;De.htmlField||(De.htmlField=document.createElement("input"),De.htmlField.style.width="0px",De.htmlField.style.height="0px",De.htmlField.style.padding="0px",De.htmlField.style.border="none",De.htmlField.style.overflow="hidden",De.htmlField.style.caretColor="transparent",De.htmlField.style.outline="none",De.htmlField.classList.add("ar"),De.htmlField.onfocus=()=>De.htmlFieldFocused=!0,De.htmlField.onblur=()=>De.htmlFieldFocused=!1,document.body.append(De.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),De.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((e=this.textComponent)!=null&&e.text.length)&&Q.setActive(this.placeholder.gameObject,!1),uh()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var e;(e=De.htmlField)==null||e.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){De.active===this&&De.htmlField?(De.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&Q.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(e){Pc&&console.log("CLICK",e,De.active),De.activeTime=this.context.time.time,De.active!==this&&this.startCoroutine(this.activeLoop(),We.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();De.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-De.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var e,i,s,r;if(De.active!==this&&(Pc&&console.log("Select",this.name,this,De.htmlField,this.context.isInXR,this.context.arOverlayElement,(e=this.textComponent)==null?void 0:e.text,(i=De.htmlField)==null?void 0:i.value),(s=De.active)==null||s.onDeselected(),De.active=this,this.placeholder&&Q.setActive(this.placeholder.gameObject,!1),De.htmlField)){if(De.htmlField.value=((r=this.textComponent)==null?void 0:r.text)||"",Pc&&console.log("set input field value",De.htmlField.value),this.context.isInXR){const o=this.context.arOverlayElement;o&&o.append(De.htmlField)}this.selectInputField()}}onDeselected(){var e;De.active===this&&(De.active=null,Pc&&console.log("Deselect",this.name,this),De.htmlField&&(De.htmlField.blur(),document.body.append(De.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&Q.setActive(this.placeholder.gameObject,!0),De.htmlField&&((e=this.onEndEdit)==null||e.invoke(De.htmlField.value)))}update(){var e;De.active===this&&((e=this.textComponent)==null||e.markDirty())}onInput(e){var i,s;if(De.active===this){if(Pc&&console.log(e.code,e,(i=De.htmlField)==null?void 0:i.value,(s=this.textComponent)==null?void 0:s.text),e.code==="Escape"||e.code==="Enter"){this.onDeselected();return}De.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&Q.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var e;if(this.textComponent&&De.htmlField){if(this.textComponent.text!==De.htmlField.value){Pc&&console.log("VALUE CHANGED");const i=this.textComponent.text,s=De.htmlField.value;(e=this.onValueChanged)==null||e.invoke(s,i)}this.textComponent.text=De.htmlField.value}}selectInputField(){De.htmlField&&(Pc&&console.log("Focus Inputfield",De.htmlFieldFocused),De.htmlField.setSelectionRange(De.htmlField.value.length,De.htmlField.value.length),uh()?De.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var e;return(e=De.htmlField)==null?void 0:e.focus()},1))}processInputOniOS(){const e=this.context.physics.raycast();if(!e.length)return;const s=e[0].object,r=eE(s);((r==null?void 0:r.gameObject)===this.gameObject||(r==null?void 0:r.gameObject.parent)===this.gameObject)&&this.selectInputField()}};let ho=De;c(ho,"active",null),c(ho,"activeTime",-1),c(ho,"htmlField",null),c(ho,"htmlFieldFocused",!1);ub([A(Zs)],ho.prototype,"textComponent",void 0);ub([A(Zs)],ho.prototype,"placeholder",void 0);ub([A($t)],ho.prototype,"onValueChanged",void 0);ub([A($t)],ho.prototype,"onEndEdit",void 0);var ul=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};function mw(n){return n*Math.PI/180}const sB=300,Mc=z("debuglights");var Rl;(function(n){n[n.Spot=0]="Spot",n[n.Directional=1]="Directional",n[n.Point=2]="Point",n[n.Area=3]="Area",n[n.Rectangle=3]="Rectangle",n[n.Disc=4]="Disc"})(Rl||(Rl={}));var Uy;(function(n){n[n.Realtime=4]="Realtime",n[n.Baked=2]="Baked",n[n.Mixed=1]="Mixed"})(Uy||(Uy={}));var Cg;(function(n){n[n.None=0]="None",n[n.Hard=1]="Hard",n[n.Soft=2]="Soft"})(Cg||(Cg={}));class Gr extends re{constructor(){super(...arguments);c(this,"type",0);c(this,"range",1);c(this,"spotAngle",1);c(this,"innerSpotAngle",1);c(this,"_color",new be(16777215));c(this,"_shadowNearPlane",.1);c(this,"_shadowBias",0);c(this,"_shadowNormalBias",0);c(this,"_overrideShadowBiasSettings",!1);c(this,"_shadows",1);c(this,"lightmapBakeType",Uy.Realtime);c(this,"_intensity",-1);c(this,"_shadowDistance");c(this,"shadowWidth");c(this,"shadowHeight");c(this,"_shadowResolution");c(this,"light");c(this,"_webXRStartedListener");c(this,"_webXREndedListener");c(this,"_webARRoot")}set color(e){this._color=e,this.light!==void 0&&(this.light.color=e)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(e){var i,s;if(e!==this._shadowNearPlane&&(this._shadowNearPlane=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.camera)!==void 0)){const r=this.light.shadow.camera;r.near=e}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(e){var i,s;e!==this._shadowBias&&(this._shadowBias=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.bias)!==void 0&&(this.light.shadow.bias=e,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(e){var i,s;e!==this._shadowNormalBias&&(this._shadowNormalBias=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.normalBias)!==void 0&&(this.light.shadow.normalBias=e,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(e){this._shadows=e,this.light&&(this.light.castShadow=e!==Cg.None,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(e){var i;if(this._intensity=e,this.light){let s=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(s/=r)}this.light.intensity=e*s}Mc&&console.log("Set light intensity to "+this._intensity,e,this)}get intensity(){return this._intensity}get shadowDistance(){const e=this.light;return e!=null&&e.shadow?e.shadow.camera.far:-1}set shadowDistance(e){this._shadowDistance=e;const i=this.light;if(i!=null&&i.shadow){const s=i.shadow.camera;s.far=e,s.updateProjectionMatrix()}}get shadowResolution(){const e=this.light;return e!=null&&e.shadow?e.shadow.mapSize.x:-1}set shadowResolution(e){if(e===this._shadowResolution)return;this._shadowResolution=e;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(e,e),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===Uy.Baked}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(e){return this.light?this.type===Rl.Directional?this.light.getWorldPosition(e).multiplyScalar(1):this.light.getWorldPosition(e):e}awake(){this.color=new be(this.color??16777215),Mc&&console.log(this.name,this)}onEnable(){Mc&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,Mc&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===Rl.Directional&&this.startCoroutine(this.updateMainLightRoutine(),We.LateUpdate))}onDisable(){Mc&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(e){this._webARRoot=Q.getComponentInParent(this.gameObject,ph)??void 0}onLeaveXR(e){}createLight(){const e=this.selfIsLight;if(e&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case Rl.Directional:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case Rl.Directional:const i=new zg(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-sB*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),Tf(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),Mc){const a=new eU(this.light,.2,this.color);this.context.scene.add(a)}break;case Rl.Spot:const s=new PC(this.color,this.intensity*Math.PI,this.range,mw(this.spotAngle/2),1-mw(this.innerSpotAngle/2)/mw(this.spotAngle/2),2);s.position.set(0,0,0),s.rotation.set(0,0,0),this.light=s;const r=s.target;s.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case Rl.Point:const o=new Ng(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==Cg.None?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),Mc&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=sB*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const s=this.gameObject.scale.x;i.left*=s,i.right*=s}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const s=this.gameObject.scale.y;i.top*=s,i.bottom*=s}this.light.shadow.needsUpdate=!0,Mc&&this.context.scene.add(new tU(i))}this.isBaked?this.light.removeFromParent():e||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===Rl.Directional&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===Cg.Soft||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(e){e.add(e.target),e.target.position.set(0,0,-1)}}c(Gr,"allowChangingRendererShadowMapType",!0);ul([A()],Gr.prototype,"type",void 0);ul([A(be)],Gr.prototype,"color",null);ul([A()],Gr.prototype,"shadowNearPlane",null);ul([A()],Gr.prototype,"shadowBias",null);ul([A()],Gr.prototype,"shadowNormalBias",null);ul([A()],Gr.prototype,"shadows",null);ul([A()],Gr.prototype,"lightmapBakeType",void 0);ul([A()],Gr.prototype,"intensity",null);ul([A()],Gr.prototype,"shadowDistance",null);ul([A()],Gr.prototype,"shadowResolution",null);new w(0,0,0);var Ym=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Aw=z("debuglods"),U7=z("nolods");var lC;(function(n){n[n.None=0]="None",n[n.CrossFade=1]="CrossFade",n[n.SpeedTree=2]="SpeedTree"})(lC||(lC={}));class Jf{constructor(){c(this,"screenRelativeTransitionHeight");c(this,"distance");c(this,"renderers")}}Ym([A()],Jf.prototype,"screenRelativeTransitionHeight",void 0);Ym([A()],Jf.prototype,"distance",void 0);Ym([A(li)],Jf.prototype,"renderers",void 0);class N7{constructor(t){c(this,"model");this.model=t}get renderers(){return this.model.renderers}}class db extends re{constructor(){super(...arguments);c(this,"fadeMode",lC.None);c(this,"localReferencePoint");c(this,"lodCount",0);c(this,"size",0);c(this,"animateCrossFading",!1);c(this,"lodModels");c(this,"_lods",[]);c(this,"_settings",[]);c(this,"_lodsHandler");c(this,"_distanceFactor",1)}start(){if(Aw&&console.log("LODGROUP",this.name,this.lodModels,this),!U7&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const e=[];for(const s of this.lodModels){const r=new N7(s);this._lods.push(r);for(const o of r.renderers)e.includes(o)||e.push(o)}this._lodsHandler=new Array;for(let s=0;s<e.length;s++){const r=new iU;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new ne;i.name="Cull "+this.name;for(let s=0;s<e.length;s++){const r=e[s],o=this._lodsHandler[s],a=r.gameObject;Aw&&console.log(s,a.name);for(const l of this._lods){const h=l.model.distance;let u=null;if(l.renderers.includes(r)?u=a:u=i,u.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${u.name}`);continue}Aw&&console.log("LEVEL",u.name,h),o.autoUpdate=!1,this.onAddLodLevel(o,u,l.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const e=this.context.mainCamera;if(e)for(const i of this._lodsHandler){i.update(e);const s=i.getCurrentLevel(),r=i.levels[s];i.layers.mask=r.object.layers.mask}}onAddLodLevel(e,i,s){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}e.addLevel(i,s*this._distanceFactor,.01);const r={lod:e,levelIndex:e.levels.length-1,distance:s};this._settings.push(r)}distanceFactor(e){if(e!==this._distanceFactor){this._distanceFactor=e;for(const i of this._settings){const s=i.lod.levels[i.levelIndex];s.distance=i.distance*e}}}}Ym([A(w)],db.prototype,"localReferencePoint",void 0);Ym([A(Jf)],db.prototype,"lodModels",void 0);const z7=z("logstats");class H2 extends re{onEnable(){console.log(this),z7&&this.startCoroutine(this.run(),We.OnAfterRender)}*run(){for(;this.enabled;){const t=this.context.renderer.info;console.log(t.memory,t.render,t.programs),yield}}}var fb=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const d1=class extends re{constructor(){super(...arguments);c(this,"target");c(this,"invertForward",!1);c(this,"keepUpDirection",!0);c(this,"copyTargetRotation",!1)}onBeforeRender(){let e=this.target;if(e||(e=this.context.mainCamera),!e)return;let i=this.copyTargetRotation;(this.context.isInVR||this.context.isInPassThrough)&&(i=!1),y0(this.gameObject,e,this.keepUpDirection,i),this.invertForward&&this.gameObject.quaternion.multiply(d1.flipYQuat)}createBehaviours(e,i,s){if(i.uuid===this.gameObject.uuid){let r=i;if(this.keepUpDirection){const a=_s.createEmptyParent(i);r=a;const l=this.invertForward?-1:1;a.setMatrix(a.getMatrix().multiply(new ae().makeRotationZ(Math.PI/2*l))),i.setMatrix(i.getMatrix().multiply(new ae().makeRotationZ(-Math.PI/2*l)))}const o=new hn("lookat "+this.name,$n.sceneStartTrigger(),Ct.lookAtCameraAction(r,void 0,this.invertForward?Fd.back:Fd.forward,this.keepUpDirection?Fd.up:Fd.zero));e.addBehavior(o)}}};let ec=d1;c(ec,"flipYQuat",new ie().setFromAxisAngle(new w(0,1,0),Math.PI));fb([A(ne)],ec.prototype,"target",void 0);fb([A()],ec.prototype,"invertForward",void 0);fb([A()],ec.prototype,"keepUpDirection",void 0);fb([A()],ec.prototype,"copyTargetRotation",void 0);var Q7=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const sv=z("debugnestedgltf");class BE extends re{constructor(){super(...arguments);c(this,"filePath");c(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(e){var i;(i=this.filePath)==null||i.beginListenDownload(e)}preload(){var e;(e=this.filePath)==null||e.preload()}async start(){var i,s,r,o,a;if(this._isLoadingOrDoneLoading)return;sv&&console.log(this,this.guid);const e=this.gameObject.parent;if(e){this._isLoadingOrDoneLoading=!0;const l=new ll;l.idProvider=new Sn(this.hash(this.guid)),l.parent=e,this.gameObject.updateMatrix();const h=this.gameObject.matrix;sv&&console.log("Load nested:",((i=this.filePath)==null?void 0:i.uri)??this.filePath,this.gameObject.position);const u=await((r=(s=this.filePath)==null?void 0:s.instantiate)==null?void 0:r.call(this.filePath,l));sv&&console.log("Nested loaded:",((o=this.filePath)==null?void 0:o.uri)??this.filePath,u),u&&(u.matrixAutoUpdate=!1,u.matrix.identity(),u.applyMatrix4(h),u.matrixAutoUpdate=!0,u.layers.disableAll(),u.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:u,assetReference:this.filePath}}))),sv&&console.log("Nested loading done:",((a=this.filePath)==null?void 0:a.uri)??this.filePath,u)}}onDestroy(){var e;(e=this.filePath)==null||e.unload()}hash(e){let i=0;for(let s=0;s<e.length;s++)i=e.charCodeAt(s)+((i<<5)-i);return i}}Q7([A(et)],BE.prototype,"filePath",void 0);var PE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const j7=z("debugnet");class gh extends re{constructor(){super(...arguments);c(this,"url",null);c(this,"urlParameterName",null);c(this,"localhost",null)}awake(){j7&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let e=this.url?gh.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const o=z(this.urlParameterName);o&&typeof o=="string"&&(e=o)}if(!e)return null;const s=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(e);return s!=null&&s.groups?(s==null?void 0:s.groups.socket_prefix)?e:"wss://"+(s==null?void 0:s.groups.url):null}static GetUrl(e,i){let s=e;const r=gh.IsLocalNetwork()&&i;if(r&&(s=i),e!=null&&e.startsWith("/")){const o=r?s:window.location.origin;o!=null&&o.endsWith("/")&&e.startsWith("/")&&(e=e.substring(1)),s=o+e}return s}static IsLocalNetwork(e=window.location.hostname){return fr(e)}}PE([A()],gh.prototype,"url",void 0);PE([A()],gh.prototype,"urlParameterName",void 0);PE([A()],gh.prototype,"localhost",void 0);var pb=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Zf extends re{constructor(){super(...arguments);c(this,"referenceSpace");c(this,"from");c(this,"affectPosition",!1);c(this,"affectRotation",!1);c(this,"alignLookDirection",!1);c(this,"levelLookDirection",!1);c(this,"levelPosition",!1);c(this,"positionOffset",new w(0,0,0));c(this,"rotationOffset",new w(0,0,0));c(this,"offset",new w(0,0,0))}update(){if(!this.from)return;var e=He(this.from),i=Gt(this.from);this.offset.copy(this.positionOffset);const s=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(s),e.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new ic(this.gameObject.up,0),h=He(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,h);const u=new w(0,0,0);l.projectPoint(e,u),e.copy(u)}this.affectPosition&&Cn(this.gameObject,e);const r=new jt(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new ie().setFromEuler(r);this.affectRotation&&ia(this.gameObject,i.multiply(o));const a=new w;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}pb([A(Q)],Zf.prototype,"referenceSpace",void 0);pb([A(Q)],Zf.prototype,"from",void 0);pb([A(w)],Zf.prototype,"positionOffset",void 0);pb([A(w)],Zf.prototype,"rotationOffset",void 0);var ME=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Gd;(function(n){n[n.NewTab=0]="NewTab",n[n.SameTab=1]="SameTab",n[n.NewWindow=2]="NewWindow"})(Gd||(Gd={}));class Km extends re{constructor(){super(...arguments);c(this,"url");c(this,"mode",Gd.NewTab);c(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let e=this.url;switch(!e.startsWith("mailto:")&&e.includes("@")&&(e="mailto:"+e),ve()&&bi("Open URL: "+e),this.mode){case Gd.NewTab:eg(),globalThis.open(e,"_blank");break;case Gd.SameTab:eg()&&uh()?globalThis.open(e,"_top"):globalThis.open(e,"_self");break;case Gd.NewWindow:eg()?globalThis.open(e,"_top"):globalThis.open(e,"_new");break}}start(){this.gameObject.getComponentInParent(xo)||this.gameObject.addComponent(xo)}onPointerEnter(e){!e.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(e){var i;this.clickable&&!e.used&&((i=this.url)!=null&&i.length)&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(ve()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}ME([A()],Km.prototype,"url",void 0);ME([A()],Km.prototype,"mode",void 0);ME([A()],Km.prototype,"clickable",void 0);function G7(n,t){var e=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(e!=null){var i,s,r,o,a=[],l=!0,h=!1;try{if(r=(e=e.call(n)).next,t===0){if(Object(e)!==e)return;l=!1}else for(;!(l=(i=r.call(e)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(u){h=!0,s=u}finally{try{if(!l&&e.return!=null&&(o=e.return(),Object(o)!==o))return}finally{if(h)throw s}}return a}}function cC(){cC=function(){return t};var n,t={},e=Object.prototype,i=e.hasOwnProperty,s=Object.defineProperty||function(k,O,H){k[O]=H.value},r=typeof Symbol=="function"?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function h(k,O,H){return Object.defineProperty(k,O,{value:H,enumerable:!0,configurable:!0,writable:!0}),k[O]}try{h({},"")}catch{h=function(O,H,ee){return O[H]=ee}}function u(k,O,H,ee){var Y=O&&O.prototype instanceof y?O:y,he=Object.create(Y.prototype),ue=new V(ee||[]);return s(he,"_invoke",{value:R(k,H,ue)}),he}function d(k,O,H){try{return{type:"normal",arg:k.call(O,H)}}catch(ee){return{type:"throw",arg:ee}}}t.wrap=u;var f="suspendedStart",p="suspendedYield",g="executing",m="completed",v={};function y(){}function b(){}function _(){}var x={};h(x,o,function(){return this});var S=Object.getPrototypeOf,E=S&&S(S(X([])));E&&E!==e&&i.call(E,o)&&(x=E);var M=_.prototype=y.prototype=Object.create(x);function I(k){["next","throw","return"].forEach(function(O){h(k,O,function(H){return this._invoke(O,H)})})}function B(k,O){function H(Y,he,ue,_e){var Se=d(k[Y],k,he);if(Se.type!=="throw"){var qe=Se.arg,Pe=qe.value;return Pe&&typeof Pe=="object"&&i.call(Pe,"__await")?O.resolve(Pe.__await).then(function(Ye){H("next",Ye,ue,_e)},function(Ye){H("throw",Ye,ue,_e)}):O.resolve(Pe).then(function(Ye){qe.value=Ye,ue(qe)},function(Ye){return H("throw",Ye,ue,_e)})}_e(Se.arg)}var ee;s(this,"_invoke",{value:function(Y,he){function ue(){return new O(function(_e,Se){H(Y,he,_e,Se)})}return ee=ee?ee.then(ue,ue):ue()}})}function R(k,O,H){var ee=f;return function(Y,he){if(ee===g)throw new Error("Generator is already running");if(ee===m){if(Y==="throw")throw he;return{value:n,done:!0}}for(H.method=Y,H.arg=he;;){var ue=H.delegate;if(ue){var _e=P(ue,H);if(_e){if(_e===v)continue;return _e}}if(H.method==="next")H.sent=H._sent=H.arg;else if(H.method==="throw"){if(ee===f)throw ee=m,H.arg;H.dispatchException(H.arg)}else H.method==="return"&&H.abrupt("return",H.arg);ee=g;var Se=d(k,O,H);if(Se.type==="normal"){if(ee=H.done?m:p,Se.arg===v)continue;return{value:Se.arg,done:H.done}}Se.type==="throw"&&(ee=m,H.method="throw",H.arg=Se.arg)}}}function P(k,O){var H=O.method,ee=k.iterator[H];if(ee===n)return O.delegate=null,H==="throw"&&k.iterator.return&&(O.method="return",O.arg=n,P(k,O),O.method==="throw")||H!=="return"&&(O.method="throw",O.arg=new TypeError("The iterator does not provide a '"+H+"' method")),v;var Y=d(ee,k.iterator,O.arg);if(Y.type==="throw")return O.method="throw",O.arg=Y.arg,O.delegate=null,v;var he=Y.arg;return he?he.done?(O[k.resultName]=he.value,O.next=k.nextLoc,O.method!=="return"&&(O.method="next",O.arg=n),O.delegate=null,v):he:(O.method="throw",O.arg=new TypeError("iterator result is not an object"),O.delegate=null,v)}function F(k){var O={tryLoc:k[0]};1 in k&&(O.catchLoc=k[1]),2 in k&&(O.finallyLoc=k[2],O.afterLoc=k[3]),this.tryEntries.push(O)}function j(k){var O=k.completion||{};O.type="normal",delete O.arg,k.completion=O}function V(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(F,this),this.reset(!0)}function X(k){if(k||k===""){var O=k[o];if(O)return O.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var H=-1,ee=function Y(){for(;++H<k.length;)if(i.call(k,H))return Y.value=k[H],Y.done=!1,Y;return Y.value=n,Y.done=!0,Y};return ee.next=ee}}throw new TypeError(typeof k+" is not iterable")}return b.prototype=_,s(M,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:b,configurable:!0}),b.displayName=h(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(k){var O=typeof k=="function"&&k.constructor;return!!O&&(O===b||(O.displayName||O.name)==="GeneratorFunction")},t.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,_):(k.__proto__=_,h(k,l,"GeneratorFunction")),k.prototype=Object.create(M),k},t.awrap=function(k){return{__await:k}},I(B.prototype),h(B.prototype,a,function(){return this}),t.AsyncIterator=B,t.async=function(k,O,H,ee,Y){Y===void 0&&(Y=Promise);var he=new B(u(k,O,H,ee),Y);return t.isGeneratorFunction(O)?he:he.next().then(function(ue){return ue.done?ue.value:he.next()})},I(M),h(M,l,"Generator"),h(M,o,function(){return this}),h(M,"toString",function(){return"[object Generator]"}),t.keys=function(k){var O=Object(k),H=[];for(var ee in O)H.push(ee);return H.reverse(),function Y(){for(;H.length;){var he=H.pop();if(he in O)return Y.value=he,Y.done=!1,Y}return Y.done=!0,Y}},t.values=X,V.prototype={constructor:V,reset:function(k){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(j),!k)for(var O in this)O.charAt(0)==="t"&&i.call(this,O)&&!isNaN(+O.slice(1))&&(this[O]=n)},stop:function(){this.done=!0;var k=this.tryEntries[0].completion;if(k.type==="throw")throw k.arg;return this.rval},dispatchException:function(k){if(this.done)throw k;var O=this;function H(Se,qe){return he.type="throw",he.arg=k,O.next=Se,qe&&(O.method="next",O.arg=n),!!qe}for(var ee=this.tryEntries.length-1;ee>=0;--ee){var Y=this.tryEntries[ee],he=Y.completion;if(Y.tryLoc==="root")return H("end");if(Y.tryLoc<=this.prev){var ue=i.call(Y,"catchLoc"),_e=i.call(Y,"finallyLoc");if(ue&&_e){if(this.prev<Y.catchLoc)return H(Y.catchLoc,!0);if(this.prev<Y.finallyLoc)return H(Y.finallyLoc)}else if(ue){if(this.prev<Y.catchLoc)return H(Y.catchLoc,!0)}else{if(!_e)throw new Error("try statement without catch or finally");if(this.prev<Y.finallyLoc)return H(Y.finallyLoc)}}}},abrupt:function(k,O){for(var H=this.tryEntries.length-1;H>=0;--H){var ee=this.tryEntries[H];if(ee.tryLoc<=this.prev&&i.call(ee,"finallyLoc")&&this.prev<ee.finallyLoc){var Y=ee;break}}Y&&(k==="break"||k==="continue")&&Y.tryLoc<=O&&O<=Y.finallyLoc&&(Y=null);var he=Y?Y.completion:{};return he.type=k,he.arg=O,Y?(this.method="next",this.next=Y.finallyLoc,v):this.complete(he)},complete:function(k,O){if(k.type==="throw")throw k.arg;return k.type==="break"||k.type==="continue"?this.next=k.arg:k.type==="return"?(this.rval=this.arg=k.arg,this.method="return",this.next="end"):k.type==="normal"&&O&&(this.next=O),v},finish:function(k){for(var O=this.tryEntries.length-1;O>=0;--O){var H=this.tryEntries[O];if(H.finallyLoc===k)return this.complete(H.completion,H.afterLoc),j(H),v}},catch:function(k){for(var O=this.tryEntries.length-1;O>=0;--O){var H=this.tryEntries[O];if(H.tryLoc===k){var ee=H.completion;if(ee.type==="throw"){var Y=ee.arg;j(H)}return Y}}throw new Error("illegal catch attempt")},delegateYield:function(k,O,H){return this.delegate={iterator:X(k),resultName:O,nextLoc:H},this.method==="next"&&(this.arg=n),v}},t}function Ue(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function rB(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,W2(i.key),i)}}function Ne(n,t,e){return t&&rB(n.prototype,t),e&&rB(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function U(n,t,e){return t=W2(t),t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function $f(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&hC(n,t)}function Ny(n){return Ny=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ny(n)}function hC(n,t){return hC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},hC(n,t)}function H7(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function lt(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function V7(n,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lt(n)}function ep(n){var t=H7();return function(){var i=Ny(n),s;if(t){var r=Ny(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return V7(this,s)}}function mf(n,t){return W7(n)||G7(n,t)||V2(n,t)||q7()}function W7(n){if(Array.isArray(n))return n}function V2(n,t){if(n){if(typeof n=="string")return oB(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return oB(n,t)}}function oB(n,t){(t==null||t>n.length)&&(t=n.length);for(var e=0,i=new Array(t);e<t;e++)i[e]=n[e];return i}function q7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aB(n,t){var e=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=V2(n))||t&&n&&typeof n.length=="number"){e&&(n=e);var i=0,s=function(){};return{s,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(l){throw l},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r=!0,o=!1,a;return{s:function(){e=e.call(n)},n:function(){var l=e.next();return r=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!r&&e.return!=null&&e.return()}finally{if(o)throw a}}}}function X7(n,t){if(typeof n!="object"||n===null)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var i=e.call(n,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function W2(n){var t=X7(n,"string");return typeof t=="symbol"?t:String(t)}var Y7=function(n){$f(e,n);var t=ep(e);function e(i){var s;return Ue(this,e),s=t.call(this),U(lt(s),"type","ParticleEmitter"),U(lt(s),"system",void 0),s.system=i,s}return Ne(e,[{key:"clone",value:function(){var s=this.system.clone();return s.emitter.copy(this,!0),s.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(s){var r=[];for(var o in s){var a=s[o];delete a.metadata,r.push(a)}return r}},{key:"toJSON",value:function(s){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=s===void 0||typeof s=="string",a={};o&&(s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};if(l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.system!==null&&(l.ps=this.system.toJSON(s,r)),this.children.length>0){l.children=[];for(var h=0;h<this.children.length;h++)this.children[h].type!=="ParticleSystemPreview"&&l.children.push(this.children[h].toJSON(s).object)}if(o){var u=this.extractFromCache(s.geometries),d=this.extractFromCache(s.materials),f=this.extractFromCache(s.textures),p=this.extractFromCache(s.images);u.length>0&&(a.geometries=u),d.length>0&&(a.materials=d),f.length>0&&(a.textures=f),p.length>0&&(a.images=p)}return a.object=l,a}}]),e}(ne),vw=function(){function n(t){Ue(this,n),U(this,"data",void 0),U(this,"next",void 0),U(this,"prev",void 0),this.data=t,this.next=null,this.prev=null}return Ne(n,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),n}(),K7=function(){function n(){Ue(this,n),U(this,"length",void 0),U(this,"head",void 0),U(this,"tail",void 0),this.length=0,this.head=this.tail=null}return Ne(n,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var e=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}}},{key:"pop",value:function(){if(this.tail){var e=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}}},{key:"queue",value:function(e){var i=new vw(e);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}},{key:"push",value:function(e){var i=new vw(e);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}},{key:"insertBefore",value:function(e,i){var s=new vw(i);s.next=e,s.prev=e.prev,s.prev!==null&&(s.prev.next=s),s.next.prev=s,e==this.head&&(this.head=s),this.length++}},{key:"remove",value:function(e){if(!(this.head===null||this.tail===null)){var i=this.head;for(e===this.head.data&&(this.head=this.head.next),e===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==e;)i=i.next;i.data===e&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}}},{key:"values",value:cC().mark(function t(){var e;return cC().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e=this.head;case 1:if(e===null){s.next=7;break}return s.next=4,e.data;case 4:e=e.next,s.next=1;break;case 7:case"end":return s.stop()}},t,this)})}]),n}(),cm=function(){function n(){Ue(this,n),U(this,"parentMatrix",void 0),U(this,"startSpeed",0),U(this,"startColor",new Fe),U(this,"startSize",1),U(this,"position",new w),U(this,"velocity",new w),U(this,"age",0),U(this,"life",1),U(this,"size",1),U(this,"angularVelocity",void 0),U(this,"rotation",0),U(this,"color",new Fe),U(this,"uvTile",0)}return Ne(n,[{key:"died",get:function(){return this.age>=this.life}}]),n}(),J7=Ne(function n(t,e,i){Ue(this,n),this.position=t,this.size=e,this.color=i}),hm=function(){function n(){Ue(this,n),U(this,"parentMatrix",void 0),U(this,"startSpeed",0),U(this,"startColor",new Fe),U(this,"startSize",1),U(this,"position",new w),U(this,"localPosition",void 0),U(this,"velocity",new w),U(this,"age",0),U(this,"life",1),U(this,"size",1),U(this,"length",100),U(this,"color",new Fe),U(this,"previous",new K7),U(this,"uvTile",0)}return Ne(n,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new J7(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),n}(),ps=function(){function n(t){Ue(this,n),U(this,"type",void 0),this.value=t,this.type="value"}return Ne(n,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new n(this.value)}}],[{key:"fromJSON",value:function(e){return new n(e.value)}}]),n}(),gb=function(){function n(t,e){Ue(this,n),U(this,"type",void 0),this.a=t,this.b=e,this.type="value"}return Ne(n,[{key:"genValue",value:function(){return ct.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new n(this.a,this.b)}}],[{key:"fromJSON",value:function(e){return new n(e.a,e.b)}}]),n}(),Z7=function(){function n(){Ue(this,n),U(this,"functions",void 0),this.functions=new Array}return Ne(n,[{key:"findFunction",value:function(e){for(var i=0,s=0,r=this.functions.length-1;s+1<r;)if(i=Math.floor((s+r)/2),e<this.getStartX(i))r=i-1;else if(e>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(e>=this.functions[o][1]&&e<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(e){return this.functions[e][1]}},{key:"setStartX",value:function(e,i){e>0&&(this.functions[e][1]=i)}},{key:"getEndX",value:function(e){return e+1<this.functions.length?this.functions[e+1][1]:1}},{key:"setEndX",value:function(e,i){e+1<this.functions.length&&(this.functions[e+1][1]=i)}},{key:"insertFunction",value:function(e,i){var s=this.findFunction(e);this.functions.splice(s+1,0,[i,e])}},{key:"removeFunction",value:function(e){return this.functions.splice(e,1)[0][0]}},{key:"getFunction",value:function(e){return this.functions[e][0]}},{key:"setFunction",value:function(e,i){this.functions[e][0]=i}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),n}(),uC=function(){function n(t,e,i,s){Ue(this,n),U(this,"p",void 0),this.p=[t,e,i,s]}return Ne(n,[{key:"genValue",value:function(e){var i=e*e,s=e*e*e,r=1-e,o=r*r,a=o*r;return this.p[0]*a+this.p[1]*o*e*3+this.p[2]*r*i*3+this.p[3]*s}},{key:"derivativeCoefficients",value:function(e){for(var i=[],s=e,r=s.length-1;r>0;r--){for(var o=[],a=0;a<r;a++){var l=r*(s[a+1]-s[a]);o.push(l)}i.push(o),s=o}return i}},{key:"getSlope",value:function(e){var i=this.derivativeCoefficients(this.p)[0],s=1-e,r=s*s,o=s*e*2,a=e*e;return r*i[0]+o*i[1]+a*i[2]}},{key:"controlCurve",value:function(e,i){this.p[1]=e/3+this.p[0],this.p[2]=this.p[3]-i/3}},{key:"hull",value:function(e){var i=this.p,s=[],r,o=0,a=0,l=0,h=[];for(h[o++]=i[0],h[o++]=i[1],h[o++]=i[2],h[o++]=i[3];i.length>1;){for(s=[],a=0,l=i.length-1;a<l;a++)r=e*i[a]+(1-e)*i[a+1],h[o++]=r,s.push(r);i=s}return h}},{key:"split",value:function(e){var i=this.hull(e),s={left:new n(i[0],i[4],i[7],i[9]),right:new n(i[9],i[8],i[6],i[3]),span:i};return s}},{key:"clone",value:function(){return new n(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(e){return new n(e.p0,e.p1,e.p2,e.p3)}}]),n}(),$7=function(n){$f(e,n);var t=ep(e);function e(){var i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new uC(0,.3333333333333333,.6666666666666666,1),0]];return Ue(this,e),i=t.call(this),U(lt(i),"type",void 0),i.type="function",i.functions=s,i}return Ne(e,[{key:"genValue",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=this.findFunction(s);return r===-1?0:this.functions[r][0].genValue((s-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toSVG",value:function(s,r){if(r<1)return"";for(var o=["M",0,this.functions[0][0].p[0]].join(" "),a=1/r;a<=1;a+=1/r)o=[o,"L",a*s,this.genValue(a)].join(" ");return o}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(s){var r=mf(s,2),o=r[0],a=r[1];return{function:o.toJSON(),start:a}})}}},{key:"clone",value:function(){return new e(this.functions.map(function(s){var r=mf(s,2),o=r[0],a=r[1];return[o.clone(),a]}))}}],[{key:"fromJSON",value:function(s){return new e(s.functions.map(function(r){return[uC.fromJSON(r.function),r.start]}))}}]),e}(Z7);function Jt(n){switch(n.type){case"ConstantValue":return ps.fromJSON(n);case"IntervalValue":return gb.fromJSON(n);case"PiecewiseBezier":return $7.fromJSON(n);default:return new ps(0)}}var um=function(t){return{r:t.x,g:t.y,b:t.z,a:t.w}},dm=function(t){return new Fe(t.r,t.g,t.b,t.a)},eq=function(t,e){switch(e){case"Vector3":return new w(t.x,t.y,t.z);case"Vector4":return new Fe(t.x,t.y,t.z,t.w);case"Color":return new w(t.r,t.g,t.b);case"Number":return t;default:return t}},tq=function(t,e){switch(e){case"Vector3":return{x:t.x,y:t.y,z:t.z};case"Vector4":return{x:t.x,y:t.y,z:t.z,w:t.w};case"Color":return{r:t.x,g:t.y,b:t.z};case"Number":return t;default:return t}},iq=function(){function n(t,e){Ue(this,n),U(this,"type",void 0),this.a=t,this.b=e,this.type="value"}return Ne(n,[{key:"genColor",value:function(e){var i=Math.random();return e.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:um(this.a),b:um(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(e){return new n(dm(e.a),dm(e.b))}}]),n}(),dC=function(){function n(t,e){Ue(this,n),U(this,"type",void 0),this.a=t,this.b=e,this.type="function"}return Ne(n,[{key:"genColor",value:function(e,i){return e.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:um(this.a),b:um(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(e){return new n(dm(e.a),dm(e.b))}}]),n}(),rv=function(){function n(t,e){Ue(this,n),U(this,"keys",void 0),U(this,"type",void 0),U(this,"subType",void 0),this.subType=e,this.type="function",this.keys=t}return Ne(n,[{key:"findKey",value:function(e){for(var i=0,s=0,r=this.keys.length-1;s+1<r;)if(i=Math.floor((s+r)/2),e<this.getStartX(i))r=i-1;else if(e>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(e>=this.getStartX(o)&&e<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(e){return this.keys[e][1]}},{key:"getEndX",value:function(e){return e+1<this.keys.length?this.keys[e+1][1]:1}},{key:"genValue",value:function(e,i){var s=this.findKey(i);return this.subType==="Number"?s===-1?this.keys[0][0]:s+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[s+1][0]-this.keys[s][0])*((i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))+this.keys[s][0]:s===-1?e.copy(this.keys[0][0]):s+1>=this.keys.length?e.copy(this.keys[this.keys.length-1][0]):e.copy(this.keys[s][0]).lerp(this.keys[s+1][0],(i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))}},{key:"toJSON",value:function(){var e=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(i){var s=mf(i,2),r=s[0],o=s[1];return{value:tq(r,e.subType),pos:o}})}}},{key:"clone",value:function(){return this.subType==="Number"?new n(this.keys.map(function(e){var i=mf(e,2),s=i[0],r=i[1];return[s,r]}),this.subType):new n(this.keys.map(function(e){var i=mf(e,2),s=i[0],r=i[1];return[s.clone(),r]}),this.subType)}}],[{key:"fromJSON",value:function(e){return new n(e.keys.map(function(i){return[eq(i.value,e.subType),i.pos]}),e.subType)}}]),n}(),ov=new w,fC=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new w(0,0,0),0],[new w(1,1,1),0]],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];Ue(this,n),U(this,"type",void 0),U(this,"color",void 0),U(this,"alpha",void 0),this.type="function",this.color=new rv(t,"Color"),this.alpha=new rv(e,"Number")}return Ne(n,[{key:"genColor",value:function(e,i){return this.color.genValue(ov,i),e.set(ov.x,ov.y,ov.z,this.alpha.genValue(1,i))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var e=new n;return e.alpha=this.alpha.clone(),e.color=this.color.clone(),e}}],[{key:"fromJSON",value:function(e){if(e.functions){var i=e.functions.map(function(r){return[dC.fromJSON(r.function).a,r.start]});return e.functions.length>0&&i.push([dC.fromJSON(e.functions[e.functions.length-1].function).b,1]),new n(i.map(function(r){return[new w(r[0].x,r[0].y,r[0].z),r[1]]}),i.map(function(r){return[r[0].w,r[1]]}))}else{var s=new n;return s.alpha=rv.fromJSON(e.alpha),s.color=rv.fromJSON(e.color),s}}}]),n}(),yw=new Fe,nq=function(){function n(t,e){Ue(this,n),U(this,"gradient1",void 0),U(this,"gradient2",void 0),U(this,"type",void 0),this.type="memorizedFunction",this.gradient1=t,this.gradient2=e}return Ne(n,[{key:"startGen",value:function(e){e.rand=Math.random()}},{key:"genColor",value:function(e,i,s){return this.gradient1.genColor(e,i),this.gradient2.genColor(yw,i),s&&s.rand?e.lerp(yw,s.rand):e.lerp(yw,Math.random()),e}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new n(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(e){return new n(fC.fromJSON(e.gradient1),fC.fromJSON(e.gradient2))}}]),n}(),zy=function(){function n(t){Ue(this,n),U(this,"type",void 0),this.color=t,this.type="value"}return Ne(n,[{key:"genColor",value:function(e){return e.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:um(this.color)}}},{key:"clone",value:function(){return new n(this.color.clone())}}],[{key:"fromJSON",value:function(e){return new n(dm(e.color))}}]),n}();function kE(n){switch(n.type){case"ConstantColor":return zy.fromJSON(n);case"ColorRange":return dC.fromJSON(n);case"RandomColor":return iq.fromJSON(n);case"Gradient":return fC.fromJSON(n);case"RandomColorBetweenGradient":return nq.fromJSON(n);default:return new zy(new Fe(1,1,1,1))}}var lB=function(){function n(){Ue(this,n),U(this,"type",void 0),this.type="rotation"}return Ne(n,[{key:"genValue",value:function(e,i){var s,r,o,a,l,h;do s=Math.random()*2-1,r=Math.random()*2-1,o=s*s+r*r;while(o>1);do a=Math.random()*2-1,l=Math.random()*2-1,h=a*a+l*l;while(h>1);var u=Math.sqrt((1-o)/h);return e.set(s,r,u*a,u*l),e}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(e){return new n}}]),n}(),q2=function(){function n(t,e){Ue(this,n),U(this,"type",void 0),this.axis=t,this.angle=e,this.type="rotation"}return Ne(n,[{key:"genValue",value:function(e,i){return e.setFromAxisAngle(this.axis,this.angle.genValue(i))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(e){return new n(e.axis,Jt(e.angle))}}]),n}(),sq=function(){function n(t,e,i){Ue(this,n),U(this,"type",void 0),this.angleX=t,this.angleY=e,this.angleZ=i,this.type="rotation"}return Ne(n,[{key:"genValue",value:function(e,i){return e.setFromEuler(new jt(this.angleX.genValue(i),this.angleY.genValue(i),this.angleZ.genValue(i)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new n(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.angleX),Jt(e.angleY),Jt(e.angleZ))}}]),n}();function X2(n){switch(n.type){case"AxisAngle":return q2.fromJSON(n);case"Euler":return sq.fromJSON(n);case"RandomQuat":return lB.fromJSON(n);default:return new lB}}function rq(n){switch(n.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return Jt(n);case"AxisAngle":case"RandomQuat":case"Euler":return X2(n);default:return new ps(0)}}var cB=function(){function n(t){Ue(this,n),U(this,"type","ColorOverLife"),this.color=t}return Ne(n,[{key:"initialize",value:function(e){this.color.type==="memorizedFunction"&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}},{key:"update",value:function(e,i){this.color.type==="memorizedFunction"?this.color.genColor(e.color,e.age/e.life,e.colorOverLifeMemory):this.color.genColor(e.color,e.age/e.life),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(kE(e.color))}}]),n}(),hB=function(){function n(t,e){Ue(this,n),U(this,"type","RotationOverLife"),U(this,"tempQuat",new ie),this.angularVelocity=t,this.dynamic=e}return Ne(n,[{key:"initialize",value:function(e){!this.dynamic&&e instanceof cm&&(e.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(e,i){this.dynamic?e.rotation+=i*this.angularVelocity.genValue(e.age/e.life):e instanceof cm&&(e.rotation+=i*e.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.angularVelocity),e.dynamic)}}]),n}(),uB=function(){function n(t){Ue(this,n),U(this,"type","SizeOverLife"),this.size=t}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){e.size=e.startSize*this.size.genValue(e.age/e.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.size))}}]),n}(),dB=function(){function n(t){Ue(this,n),U(this,"type","SpeedOverLife"),this.speed=t}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){e.velocity.normalize().multiplyScalar(e.startSpeed*this.speed.genValue(e.age/e.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.speed))}}]),n}(),fB=function(){function n(t,e){Ue(this,n),U(this,"type","RotationBySpeed"),U(this,"tempQuat",new ie),this.angularVelocity=t,this.speedRange=e}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){var s=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.rotation+=i*this.angularVelocity.genValue(s)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.angularVelocity),gb.fromJSON(e.speedRange))}}]),n}(),pB=function(){function n(t,e){Ue(this,n),U(this,"type","SizeBySpeed"),this.size=t,this.speedRange=e}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){var i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.size=e.startSize*this.size.genValue(i)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.size),gb.fromJSON(e.speedRange))}}]),n}(),gB=function(){function n(t,e){Ue(this,n),U(this,"type","ColorBySpeed"),this.color=t,this.speedRange=e}return Ne(n,[{key:"initialize",value:function(e){this.color.type==="memorizedFunction"&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}},{key:"update",value:function(e,i){var s=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(e.color,s,e.colorOverLifeMemory):this.color.genColor(e.color,s),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(kE(e.color),gb.fromJSON(e.speedRange))}}]),n}(),mB=function(){function n(t){Ue(this,n),U(this,"type","FrameOverLife"),this.frame=t}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){e.uvTile=Math.floor(this.frame.genValue(e.age/e.life))}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new n(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.frame))}}]),n}();new w(0,0,1);var AB=function(){function n(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new w(0,1,0);Ue(this,n),U(this,"type","OrbitOverLife"),U(this,"rotation",void 0),U(this,"line",void 0),U(this,"temp",new w),this.orbitSpeed=t,this.axis=e,this.rotation=new ie,this.line=new FC}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){this.line.set(new w(0,0,0),this.axis),this.line.closestPointToPoint(e.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(e.age/e.life)*i),e.position.sub(this.temp),e.position.applyQuaternion(this.rotation),e.position.add(this.temp)}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new n(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.orbitSpeed),e.axis?new w(e.axis[0],e.axis[1],e.axis[2]):void 0)}}]),n}(),vB=function(){function n(t,e){Ue(this,n),U(this,"type","ApplyForce"),U(this,"magnitudeValue",void 0),this.direction=t,this.magnitude=e,this.magnitudeValue=this.magnitude.genValue()}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){e.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}},{key:"frameUpdate",value:function(e){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new n(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){var i;return new n(new w(e.direction[0],e.direction[1],e.direction[2]),Jt((i=e.magnitude)!==null&&i!==void 0?i:e.force))}}]),n}(),yB=function(){function n(t,e){Ue(this,n),U(this,"type","GravityForce"),U(this,"temp",new w),this.center=t,this.magnitude=e}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){this.temp.copy(this.center).sub(e.position).normalize(),e.velocity.addScaledVector(this.temp,this.magnitude/e.position.distanceToSquared(this.center)*i)}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new n(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new w(e.center[0],e.center[1],e.center[2]),e.magnitude)}}]),n}(),bB=function(){function n(t){Ue(this,n),U(this,"type","WidthOverLength"),this.width=t}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){if(e instanceof hm)for(var i=e.previous.values(),s=0;s<e.previous.length;s++){var r=i.next();r.value.size=this.width.genValue((e.previous.length-s)/e.length)}}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new n(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.width))}}]),n}();new w(0,0,1);var _B=function(){function n(t){Ue(this,n),U(this,"type","ChangeEmitDirection"),U(this,"_temp",new w),U(this,"_q",new ie),this.angle=t}return Ne(n,[{key:"initialize",value:function(e){var i=e.velocity.length();i!=0&&(e.velocity.normalize(),e.velocity.x===0&&e.velocity.y===0?this._temp.set(0,e.velocity.z,0):this._temp.set(-e.velocity.y,e.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(e.velocity),e.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),e.velocity.applyQuaternion(this._q),e.velocity.setLength(i))}},{key:"update",value:function(e,i){}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.angle))}}]),n}(),oq=new w(1,1,1),wB=new w(0,0,1),xB=function(){function n(t,e,i){Ue(this,n),U(this,"type","EmitSubParticleSystem"),U(this,"q_",new ie),U(this,"v_",new w),U(this,"v2_",new w),this.particleSystem=t,this.useVelocityAsBasis=e,this.subParticleSystem=i,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return Ne(n,[{key:"initialize",value:function(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new ae}}},{key:"update",value:function(e,i){if(!(!this.subParticleSystem||!e.emissionState)){var s=e.emissionState.matrix,r;if(e.rotation===void 0||this.useVelocityAsBasis)if(e.velocity.x===0&&e.velocity.y===0&&(e.velocity.z===1||e.velocity.z===0))s.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1);else{this.v_.copy(wB).cross(e.velocity),this.v2_.copy(e.velocity).cross(this.v_);var o=this.v_.length(),a=this.v2_.length();s.set(this.v_.x/o,this.v2_.x/a,e.velocity.x,e.position.x,this.v_.y/o,this.v2_.y/a,e.velocity.y,e.position.y,this.v_.z/o,this.v2_.z/a,e.velocity.z,e.position.z,0,0,0,1)}else e.rotation instanceof ie?r=e.rotation:(this.q_.setFromAxisAngle(wB,e.rotation),r=this.q_),s.compose(e.position,r,oq);this.particleSystem.worldSpace||s.multiplyMatrices(this.particleSystem.emitter.matrixWorld,s),this.subParticleSystem.system.emit(i,e.emissionState,s)}}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new n(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e,i){return new n(i,e.useVelocityAsBasis,e.subParticleSystem)}}]),n}(),aq=.5*(Math.sqrt(3)-1),Pp=(3-Math.sqrt(3))/6,lq=1/3,ma=1/6,cq=(Math.sqrt(5)-1)/4,Nn=(5-Math.sqrt(5))/20,pn=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Hi=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),Y2=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;Ue(this,n),U(this,"p",void 0),U(this,"perm",void 0),U(this,"permMod12",void 0);var e=typeof t=="function"?t:uq(t);this.p=hq(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[i&255],this.permMod12[i]=this.perm[i]%12}return Ne(n,[{key:"noise2D",value:function(e,i){var s=this.permMod12,r=this.perm,o=0,a=0,l=0,h=(e+i)*aq,u=Math.floor(e+h),d=Math.floor(i+h),f=(u+d)*Pp,p=u-f,g=d-f,m=e-p,v=i-g,y,b;m>v?(y=1,b=0):(y=0,b=1);var _=m-y+Pp,x=v-b+Pp,S=m-1+2*Pp,E=v-1+2*Pp,M=u&255,I=d&255,B=.5-m*m-v*v;if(B>=0){var R=s[M+r[I]]*3;B*=B,o=B*B*(pn[R]*m+pn[R+1]*v)}var P=.5-_*_-x*x;if(P>=0){var F=s[M+y+r[I+b]]*3;P*=P,a=P*P*(pn[F]*_+pn[F+1]*x)}var j=.5-S*S-E*E;if(j>=0){var V=s[M+1+r[I+1]]*3;j*=j,l=j*j*(pn[V]*S+pn[V+1]*E)}return 70*(o+a+l)}},{key:"noise3D",value:function(e,i,s){var r=this.permMod12,o=this.perm,a,l,h,u,d=(e+i+s)*lq,f=Math.floor(e+d),p=Math.floor(i+d),g=Math.floor(s+d),m=(f+p+g)*ma,v=f-m,y=p-m,b=g-m,_=e-v,x=i-y,S=s-b,E,M,I,B,R,P;_>=x?x>=S?(E=1,M=0,I=0,B=1,R=1,P=0):_>=S?(E=1,M=0,I=0,B=1,R=0,P=1):(E=0,M=0,I=1,B=1,R=0,P=1):x<S?(E=0,M=0,I=1,B=0,R=1,P=1):_<S?(E=0,M=1,I=0,B=0,R=1,P=1):(E=0,M=1,I=0,B=1,R=1,P=0);var F=_-E+ma,j=x-M+ma,V=S-I+ma,X=_-B+2*ma,k=x-R+2*ma,O=S-P+2*ma,H=_-1+3*ma,ee=x-1+3*ma,Y=S-1+3*ma,he=f&255,ue=p&255,_e=g&255,Se=.6-_*_-x*x-S*S;if(Se<0)a=0;else{var qe=r[he+o[ue+o[_e]]]*3;Se*=Se,a=Se*Se*(pn[qe]*_+pn[qe+1]*x+pn[qe+2]*S)}var Pe=.6-F*F-j*j-V*V;if(Pe<0)l=0;else{var Ye=r[he+E+o[ue+M+o[_e+I]]]*3;Pe*=Pe,l=Pe*Pe*(pn[Ye]*F+pn[Ye+1]*j+pn[Ye+2]*V)}var Pt=.6-X*X-k*k-O*O;if(Pt<0)h=0;else{var Tt=r[he+B+o[ue+R+o[_e+P]]]*3;Pt*=Pt,h=Pt*Pt*(pn[Tt]*X+pn[Tt+1]*k+pn[Tt+2]*O)}var ci=.6-H*H-ee*ee-Y*Y;if(ci<0)u=0;else{var Ei=r[he+1+o[ue+1+o[_e+1]]]*3;ci*=ci,u=ci*ci*(pn[Ei]*H+pn[Ei+1]*ee+pn[Ei+2]*Y)}return 32*(a+l+h+u)}},{key:"noise4D",value:function(e,i,s,r){var o=this.perm,a,l,h,u,d,f=(e+i+s+r)*cq,p=Math.floor(e+f),g=Math.floor(i+f),m=Math.floor(s+f),v=Math.floor(r+f),y=(p+g+m+v)*Nn,b=p-y,_=g-y,x=m-y,S=v-y,E=e-b,M=i-_,I=s-x,B=r-S,R=0,P=0,F=0,j=0;E>M?R++:P++,E>I?R++:F++,E>B?R++:j++,M>I?P++:F++,M>B?P++:j++,I>B?F++:j++;var V=R>=3?1:0,X=P>=3?1:0,k=F>=3?1:0,O=j>=3?1:0,H=R>=2?1:0,ee=P>=2?1:0,Y=F>=2?1:0,he=j>=2?1:0,ue=R>=1?1:0,_e=P>=1?1:0,Se=F>=1?1:0,qe=j>=1?1:0,Pe=E-V+Nn,Ye=M-X+Nn,Pt=I-k+Nn,Tt=B-O+Nn,ci=E-H+2*Nn,Ei=M-ee+2*Nn,Bs=I-Y+2*Nn,Vr=B-he+2*Nn,ss=E-ue+3*Nn,Ar=M-_e+3*Nn,Wr=I-Se+3*Nn,qr=B-qe+3*Nn,To=E-1+4*Nn,Ro=M-1+4*Nn,Xr=I-1+4*Nn,vr=B-1+4*Nn,kn=p&255,$s=g&255,yr=m&255,rs=v&255,Ps=.6-E*E-M*M-I*I-B*B;if(Ps<0)a=0;else{var Ms=o[kn+o[$s+o[yr+o[rs]]]]%32*4;Ps*=Ps,a=Ps*Ps*(Hi[Ms]*E+Hi[Ms+1]*M+Hi[Ms+2]*I+Hi[Ms+3]*B)}var Dn=.6-Pe*Pe-Ye*Ye-Pt*Pt-Tt*Tt;if(Dn<0)l=0;else{var Ji=o[kn+V+o[$s+X+o[yr+k+o[rs+O]]]]%32*4;Dn*=Dn,l=Dn*Dn*(Hi[Ji]*Pe+Hi[Ji+1]*Ye+Hi[Ji+2]*Pt+Hi[Ji+3]*Tt)}var os=.6-ci*ci-Ei*Ei-Bs*Bs-Vr*Vr;if(os<0)h=0;else{var er=o[kn+H+o[$s+ee+o[yr+Y+o[rs+he]]]]%32*4;os*=os,h=os*os*(Hi[er]*ci+Hi[er+1]*Ei+Hi[er+2]*Bs+Hi[er+3]*Vr)}var as=.6-ss*ss-Ar*Ar-Wr*Wr-qr*qr;if(as<0)u=0;else{var dn=o[kn+ue+o[$s+_e+o[yr+Se+o[rs+qe]]]]%32*4;as*=as,u=as*as*(Hi[dn]*ss+Hi[dn+1]*Ar+Hi[dn+2]*Wr+Hi[dn+3]*qr)}var zt=.6-To*To-Ro*Ro-Xr*Xr-vr*vr;if(zt<0)d=0;else{var yt=o[kn+1+o[$s+1+o[yr+1+o[rs+1]]]]%32*4;zt*=zt,d=zt*zt*(Hi[yt]*To+Hi[yt+1]*Ro+Hi[yt+2]*Xr+Hi[yt+3]*vr)}return 27*(a+l+h+u+d)}}]),n}();function hq(n){for(var t=new Uint8Array(256),e=0;e<256;e++)t[e]=e;for(var i=0;i<255;i++){var s=i+~~(n()*(256-i)),r=t[i];t[i]=t[s],t[s]=r}return t}function uq(n){var t=0,e=0,i=0,s=1,r=dq();return t=r(" "),e=r(" "),i=r(" "),t-=r(n),t<0&&(t+=1),e-=r(n),e<0&&(e+=1),i-=r(n),i<0&&(i+=1),function(){var o=2091639*t+s*23283064365386963e-26;return t=e,e=i,i=o-(s=o|0)}}function dq(){var n=4022871197;return function(t){t=t.toString();for(var e=0;e<t.length;e++){n+=t.charCodeAt(e);var i=.02519603282416938*n;n=i>>>0,i-=n,i*=n,n=i>>>0,i-=n,n+=i*4294967296}return(n>>>0)*23283064365386963e-26}}var CB=function(){function n(t,e,i,s){Ue(this,n),U(this,"type","TurbulenceField"),U(this,"generator",new Y2),U(this,"timeOffset",new w),U(this,"temp",new w),U(this,"temp2",new w),this.scale=t,this.octaves=e,this.velocityMultiplier=i,this.timeScale=s,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){var s=e.position.x/this.scale.x,r=e.position.y/this.scale.y,o=e.position.z/this.scale.z;this.temp.set(0,0,0);for(var a=1,l=0;l<this.octaves;l++)this.temp2.set(this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),e.velocity.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(e){this.timeOffset.x+=e*this.timeScale.x,this.timeOffset.y+=e*this.timeScale.y,this.timeOffset.z+=e*this.timeScale.z}},{key:"clone",value:function(){return new n(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new w(e.scale[0],e.scale[1],e.scale[2]),e.octaves,new w(e.velocityMultiplier[0],e.velocityMultiplier[1],e.velocityMultiplier[2]),new w(e.timeScale[0],e.timeScale[1],e.timeScale[2]))}}]),n}(),SB=new ie,EB=function(){function n(t,e){Ue(this,n),U(this,"type","Rotation3DOverLife"),U(this,"tempQuat",new ie),this.angularVelocity=t,this.dynamic=e}return Ne(n,[{key:"initialize",value:function(e){!this.dynamic&&e instanceof cm&&(e.angularVelocity=new ie,this.angularVelocity.genValue(e.angularVelocity))}},{key:"update",value:function(e,i){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,e.age/e.life),this.tempQuat.slerpQuaternions(SB,this.tempQuat,i),e.rotation.multiply(this.tempQuat)):e instanceof cm&&(this.tempQuat.slerpQuaternions(SB,e.angularVelocity,i),e.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(X2(e.angularVelocity),e.dynamic)}}]),n}(),IB=function(){function n(t,e,i){Ue(this,n),U(this,"type","ForceOverLife"),U(this,"_temp",new w),this.x=t,this.y=e,this.z=i}return Ne(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){this._temp.set(this.x.genValue(e.age/e.life),this.y.genValue(e.age/e.life),this.z.genValue(e.age/e.life)),e.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Jt(e.x),Jt(e.y),Jt(e.z))}}]),n}(),TB=function(){function n(t,e){Ue(this,n),U(this,"type","Noise"),U(this,"generator",new Y2),U(this,"duration",0),U(this,"temp",new w),this.frequency=t,this.power=e}return Ne(n,[{key:"initialize",value:function(e){e.startTime=this.duration}},{key:"update",value:function(e,i){this.temp.set(this.generator.noise2D(e.startTime*this.frequency.x,e.life/e.age*this.frequency.x),this.generator.noise2D(e.startTime*this.frequency.y+100.25,e.life/e.age*this.frequency.y+100.154),this.generator.noise2D(e.startTime*this.frequency.z+200.89,e.life/e.age*this.frequency.z+200.1)).multiply(this.power),e.position.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(e){this.duration+=e}},{key:"clone",value:function(){return new n(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new w(e.frequency[0],e.frequency[1],e.frequency[2]),new w(e.power[0],e.power[1],e.power[2]))}}]),n}(),fq={ApplyForce:{type:"ApplyForce",constructor:vB,params:[["direction","vec3"],["magnitude","value"]],loadJSON:vB.fromJSON},Noise:{type:"Noise",constructor:TB,params:[["frequency","vec3"],["power","vec3"]],loadJSON:TB.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:CB,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:CB.fromJSON},GravityForce:{type:"GravityForce",constructor:yB,params:[["center","vec3"],["magnitude","number"]],loadJSON:yB.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:cB,params:[["color","colorFunc"]],loadJSON:cB.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:hB,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:hB.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:EB,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:EB.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:uB,params:[["size","valueFunc"]],loadJSON:uB.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:gB,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:gB.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:fB,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:fB.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:pB,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:pB.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:dB,params:[["speed","valueFunc"]],loadJSON:dB.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:mB,params:[["frame","valueFunc"]],loadJSON:mB.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:IB,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:IB.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:AB,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:AB.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:bB,params:[["width","valueFunc"]],loadJSON:bB.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:_B,params:[["angle","value"]],loadJSON:_B.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:xB,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:xB.fromJSON}};function pq(n,t){return fq[n.type].loadJSON(n,t)}var RB=function(){function n(){var t,e,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ue(this,n),U(this,"type","cone"),U(this,"radius",void 0),U(this,"arc",void 0),U(this,"thickness",void 0),U(this,"angle",void 0),this.radius=(t=r.radius)!==null&&t!==void 0?t:10,this.arc=(e=r.arc)!==null&&e!==void 0?e:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(s=r.angle)!==null&&s!==void 0?s:Math.PI/6}return Ne(n,[{key:"initialize",value:function(e){var i=Math.random(),s=ct.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),l=Math.cos(r);e.position.x=o*l,e.position.y=o*a,e.position.z=0;var h=this.angle*o;e.velocity.set(0,0,Math.cos(h)).addScaledVector(e.position,Math.sin(h)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),BB=function(){function n(){var t,e,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ue(this,n),U(this,"type","donut"),U(this,"radius",void 0),U(this,"arc",void 0),U(this,"thickness",void 0),U(this,"angle",void 0),this.radius=(t=r.radius)!==null&&t!==void 0?t:10,this.arc=(e=r.arc)!==null&&e!==void 0?e:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(s=r.angle)!==null&&s!==void 0?s:Math.PI/6}return Ne(n,[{key:"initialize",value:function(e){var i=Math.random(),s=ct.lerp(this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),l=Math.cos(r);e.position.x=o*l,e.position.y=o*a,e.position.z=0;var h=this.angle*o;e.velocity.set(0,0,Math.cos(h)).addScaledVector(e.position,Math.sin(h)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),PB=function(){function n(){Ue(this,n),U(this,"type","point")}return Ne(n,[{key:"initialize",value:function(e){var i=Math.random(),s=Math.random(),r=i*Math.PI*2,o=Math.acos(2*s-1),a=Math.cbrt(Math.random()),l=Math.sin(r),h=Math.cos(r),u=Math.sin(o),d=Math.cos(o);e.velocity.x=a*u*h,e.velocity.y=a*u*l,e.velocity.z=a*d,e.velocity.multiplyScalar(e.startSpeed),e.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(e){return new n}}]),n}(),pC=function(){function n(){var t,e,i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ue(this,n),U(this,"type","sphere"),U(this,"radius",void 0),U(this,"arc",void 0),U(this,"thickness",void 0),this.radius=(t=s.radius)!==null&&t!==void 0?t:10,this.arc=(e=s.arc)!==null&&e!==void 0?e:2*Math.PI,this.thickness=(i=s.thickness)!==null&&i!==void 0?i:1}return Ne(n,[{key:"initialize",value:function(e){var i=Math.random(),s=Math.random(),r=ct.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*s-1),l=Math.cbrt(r),h=Math.sin(o),u=Math.cos(o),d=Math.sin(a),f=Math.cos(a);e.position.x=l*d*u,e.position.y=l*d*h,e.position.z=l*f,e.velocity.setScalar(0).addScaledVector(e.position,e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),MB=function(){function n(t){Ue(this,n),U(this,"type","mesh_surface"),U(this,"_triangleIndexToArea",[]),U(this,"_geometry",void 0),U(this,"_tempA",new w),U(this,"_tempB",new w),U(this,"_tempC",new w),t&&(this.geometry=t)}return Ne(n,[{key:"geometry",get:function(){return this._geometry},set:function(e){if(this._geometry=e,e!==void 0&&typeof e!="string"){var i=new QP;this._triangleIndexToArea.length=0;var s=0;if(e.getIndex()){var r=e.getIndex().array,o=r.length/3;this._triangleIndexToArea.push(0);for(var a=0;a<o;a++)i.setFromAttributeAndIndices(e.getAttribute("position"),r[a*3],r[a*3+1],r[a*3+2]),s+=i.getArea(),this._triangleIndexToArea.push(s);e.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(e){var i=this._geometry;if(!i||i.getIndex()===null){e.position.set(0,0,0),e.velocity.set(0,0,1).multiplyScalar(e.startSpeed);return}for(var s=this._triangleIndexToArea.length-1,r=0,o=s,a=Math.random()*this._triangleIndexToArea[s];r+1<o;){var l=Math.floor((r+o)/2);a<this._triangleIndexToArea[l]?o=l:r=l}var h=Math.random(),u=Math.random();h+u>1&&(h=1-h,u=1-u);var d=i.getIndex().array[r*3],f=i.getIndex().array[r*3+1],p=i.getIndex().array[r*3+2],g=i.getAttribute("position");this._tempA.fromBufferAttribute(g,d),this._tempB.fromBufferAttribute(g,f),this._tempC.fromBufferAttribute(g,p),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,h).addScaledVector(this._tempC,u),e.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),e.velocity.copy(this._tempA).normalize().multiplyScalar(e.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new n(this._geometry)}}],[{key:"fromJSON",value:function(e,i){return new n(i.geometries[e.geometry])}}]),n}(),kB=function(){function n(){var t,e,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ue(this,n),U(this,"type","grid"),U(this,"width",void 0),U(this,"height",void 0),U(this,"column",void 0),U(this,"row",void 0),this.width=(t=r.width)!==null&&t!==void 0?t:1,this.height=(e=r.height)!==null&&e!==void 0?e:1,this.column=(i=r.column)!==null&&i!==void 0?i:10,this.row=(s=r.row)!==null&&s!==void 0?s:10}return Ne(n,[{key:"initialize",value:function(e){var i=Math.floor(Math.random()*this.row),s=Math.floor(Math.random()*this.column);e.position.x=s*this.width/this.column-this.width/2,e.position.y=i*this.height/this.row-this.height/2,e.position.z=0,e.velocity.set(0,0,e.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new n({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),gq={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:RB,loadJSON:RB.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:BB,loadJSON:BB.fromJSON},point:{type:"point",params:[],constructor:PB,loadJSON:PB.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:pC,loadJSON:pC.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:kB,loadJSON:kB.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:MB,loadJSON:MB.fromJSON}};function mq(n,t){return gq[n.type].loadJSON(n,t)}var we=function(n){return n[n.BillBoard=0]="BillBoard",n[n.StretchedBillBoard=1]="StretchedBillBoard",n[n.Mesh=2]="Mesh",n[n.Trail=3]="Trail",n[n.HorizontalBillBoard=4]="HorizontalBillBoard",n[n.VerticalBillBoard=5]="VerticalBillBoard",n}({}),K2=function(n){$f(e,n);var t=ep(e);function e(i){var s;Ue(this,e),s=t.call(this),U(lt(s),"type","VFXBatch"),U(lt(s),"systems",void 0),U(lt(s),"settings",void 0),U(lt(s),"maxParticles",void 0),s.maxParticles=1e3,s.systems=new Set;var r=new go;return r.mask=i.layers.mask,s.settings={instancingGeometry:i.instancingGeometry,renderMode:i.renderMode,renderOrder:i.renderOrder,material:i.material.clone(),uTileCount:i.uTileCount,vTileCount:i.vTileCount,layers:r},s.frustumCulled=!1,s.renderOrder=s.settings.renderOrder,s}return Ne(e,[{key:"addSystem",value:function(s){this.systems.add(s)}},{key:"removeSystem",value:function(s){this.systems.delete(s)}}]),e}(J),Aq=new w(0,0,1),bw=new ie,vq=new w,yq=new w;new w;var DB=60,bq=new pr(1,1,1,1),_q=function(){function n(t){var e,i,s,r,o,a,l,h,u,d,f,p,g,m,v,y,b,_,x,S,E;Ue(this,n),U(this,"autoDestroy",void 0),U(this,"prewarm",void 0),U(this,"looping",void 0),U(this,"duration",void 0),U(this,"startLife",void 0),U(this,"startSpeed",void 0),U(this,"startRotation",void 0),U(this,"startSize",void 0),U(this,"startColor",void 0),U(this,"startTileIndex",void 0),U(this,"rendererEmitterSettings",void 0),U(this,"emissionOverTime",void 0),U(this,"emissionOverDistance",void 0),U(this,"emissionBursts",void 0),U(this,"onlyUsedByOther",void 0),U(this,"worldSpace",void 0),U(this,"speedFactor",void 0),U(this,"particleNum",void 0),U(this,"paused",void 0),U(this,"particles",void 0),U(this,"emitterShape",void 0),U(this,"emitter",void 0),U(this,"rendererSettings",void 0),U(this,"neededToUpdateRender",void 0),U(this,"behaviors",void 0),U(this,"prewarmed",void 0),U(this,"emissionState",void 0),U(this,"emitEnded",void 0),U(this,"markForDestroy",void 0),U(this,"previousWorldPos",void 0),U(this,"temp",new w),U(this,"travelDistance",0),U(this,"normalMatrix",new za),U(this,"_renderer",void 0),this.autoDestroy=t.autoDestroy===void 0?!1:t.autoDestroy,this.duration=(e=t.duration)!==null&&e!==void 0?e:1,this.looping=t.looping===void 0?!0:t.looping,this.prewarm=t.prewarm===void 0?!1:t.prewarm,this.startLife=(i=t.startLife)!==null&&i!==void 0?i:new ps(5),this.startSpeed=(s=t.startSpeed)!==null&&s!==void 0?s:new ps(0),this.startRotation=(r=t.startRotation)!==null&&r!==void 0?r:new ps(0),this.startSize=(o=t.startSize)!==null&&o!==void 0?o:new ps(1),this.startColor=(a=t.startColor)!==null&&a!==void 0?a:new zy(new Fe(1,1,1,1)),this.emissionOverTime=(l=t.emissionOverTime)!==null&&l!==void 0?l:new ps(10),this.emissionOverDistance=(h=t.emissionOverDistance)!==null&&h!==void 0?h:new ps(0),this.emissionBursts=(u=t.emissionBursts)!==null&&u!==void 0?u:[],this.onlyUsedByOther=(d=t.onlyUsedByOther)!==null&&d!==void 0?d:!1,this.emitterShape=(f=t.shape)!==null&&f!==void 0?f:new pC,this.behaviors=(p=t.behaviors)!==null&&p!==void 0?p:new Array,this.worldSpace=(g=t.worldSpace)!==null&&g!==void 0?g:!1,this.speedFactor=(m=t.speedFactor)!==null&&m!==void 0?m:0,this.rendererEmitterSettings=(v=t.rendererEmitterSettings)!==null&&v!==void 0?v:{},this.rendererSettings={instancingGeometry:(y=t.instancingGeometry)!==null&&y!==void 0?y:bq,renderMode:(b=t.renderMode)!==null&&b!==void 0?b:we.BillBoard,renderOrder:(_=t.renderOrder)!==null&&_!==void 0?_:0,material:t.material,uTileCount:(x=t.uTileCount)!==null&&x!==void 0?x:1,vTileCount:(S=t.vTileCount)!==null&&S!==void 0?S:1,layers:(E=t.layers)!==null&&E!==void 0?E:new go},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=t.startTileIndex||new ps(0),this.emitter=new Y7(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return Ne(n,[{key:"time",get:function(){return this.emissionState.time},set:function(e){this.emissionState.time=e}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(e){this.rendererSettings.uTileCount=e,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(e){this.rendererSettings.vTileCount=e,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(e){if((this.rendererSettings.renderMode!=we.Trail&&e===we.Trail||this.rendererSettings.renderMode==we.Trail&&e!==we.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==e)switch(e){case we.Trail:this.rendererEmitterSettings={startLength:new ps(30),followLocalOrigin:!1};break;case we.Mesh:this.rendererEmitterSettings={geometry:new pr(1,1)},this.startRotation=new q2(new w(0,1,0),new ps(0));break;case we.BillBoard:case we.VerticalBillBoard:case we.HorizontalBillBoard:case we.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===we.Mesh&&(this.startRotation=new ps(0));break}this.rendererSettings.renderMode=e,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(e,i,s){bw.setFromRotationMatrix(s);var r=vq,o=bw,a=yq;s.decompose(r,o,a);for(var l=0;l<e;l++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===we.Trail?this.particles.push(new hm):this.particles.push(new cm);var h=this.particles[this.particleNum-1];if(this.startColor.genColor(h.startColor,this.emissionState.time,{}),h.color.copy(h.startColor),h.startSpeed=this.startSpeed.genValue(i.time/this.duration),h.life=this.startLife.genValue(i.time/this.duration),h.age=0,h.startSize=this.startSize.genValue(i.time/this.duration),h.uvTile=Math.floor(this.startTileIndex.genValue()),h.size=h.startSize,this.rendererSettings.renderMode===we.Mesh||this.rendererSettings.renderMode===we.BillBoard||this.rendererSettings.renderMode===we.VerticalBillBoard||this.rendererSettings.renderMode===we.HorizontalBillBoard||this.rendererSettings.renderMode===we.StretchedBillBoard){var u=h;this.rendererSettings.renderMode===we.Mesh?(u.rotation instanceof ie||(u.rotation=new ie),this.startRotation.type==="rotation"?this.startRotation.genValue(u.rotation,i.time/this.duration):u.rotation.setFromAxisAngle(Aq,this.startRotation.genValue(i.time/this.duration))):this.startRotation.type==="rotation"?u.rotation=0:u.rotation=this.startRotation.genValue(i.time/this.duration)}else if(this.rendererSettings.renderMode===we.Trail){var d=h;d.length=this.rendererEmitterSettings.startLength.genValue(i.time/this.duration),d.reset()}if(this.emitterShape.initialize(h),this.rendererSettings.renderMode===we.Trail&&this.rendererEmitterSettings.followLocalOrigin){var f=h;f.localPosition=new w().copy(f.position)}this.worldSpace?(h.position.applyMatrix4(s),h.startSize=h.startSize*(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3,h.size=h.startSize,h.velocity.multiply(a).applyMatrix3(this.normalMatrix),h.rotation&&h.rotation instanceof ie&&h.rotation.multiplyQuaternions(bw,h.rotation)):this.onlyUsedByOther&&(h.parentMatrix=s);for(var p=0;p<this.behaviors.length;p++)this.behaviors[p].initialize(h)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(e){e.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(e){if(!this.paused){for(var i=this.emitter;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var s=0;s<this.duration*DB;s++)this.update(1/DB)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(e,this.emissionState,this.emitter.matrixWorld);for(var r=0;r<this.behaviors.length;r++){for(var o=0;o<this.particleNum;o++)this.particles[o].died||this.behaviors[r].update(this.particles[o],e);this.behaviors[r].frameUpdate(e)}for(var a=0;a<this.particleNum;a++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[a].localPosition?(this.particles[a].position.copy(this.particles[a].localPosition),this.particles[a].parentMatrix?this.particles[a].position.applyMatrix4(this.particles[a].parentMatrix):this.particles[a].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[a].position.addScaledVector(this.particles[a].velocity,e),this.particles[a].age+=e;if(this.rendererSettings.renderMode===we.Trail)for(var l=0;l<this.particleNum;l++){var h=this.particles[l];h.update()}for(var u=0;u<this.particleNum;u++){var d=this.particles[u];d.died&&(!(d instanceof hm)||d.previous.length===0)&&(this.particles[u]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=d,this.particleNum--,u--)}}}},{key:"emit",value:function(e,i,s){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(function(h){h.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(s);var r=Math.ceil(i.waitEmiting);for(this.spawn(r,i,s),i.waitEmiting-=r;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){var o=this.emissionBursts[i.burstIndex].count;this.spawn(o,i,s)}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=e*this.emissionOverTime.genValue(i.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var a=this.emissionOverDistance.genValue(i.time/this.duration);if(this.travelDistance*a>0){var l=Math.floor(this.travelDistance*a);this.travelDistance-=l/a,i.waitEmiting+=l}}this.previousWorldPos===void 0&&(this.previousWorldPos=new w),this.emitter.getWorldPosition(this.previousWorldPos),i.time+=e}},{key:"toJSON",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=e===void 0||typeof e=="string";if(s&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),e.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(e),i.useUrlForImage&&this.texture.source!==void 0){var r=this.texture.source;e.images[r.uuid]={uuid:r.uuid,url:this.texture.image.url}}var o;this.renderMode===we.Trail?o={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===we.Mesh?o={}:o={};var a=this.rendererSettings.instancingGeometry;return e.geometries&&!e.geometries[a.uuid]&&(e.geometries[a.uuid]=a.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:o,speedFactor:this.renderMode===we.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(l){return l.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(e){this.behaviors.push(e)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var e=[],i=aB(this.emissionBursts),s;try{for(i.s();!(s=i.n()).done;){var r=s.value,o={};Object.assign(o,r),e.push(o)}}catch(p){i.e(p)}finally{i.f()}var a=[],l=aB(this.behaviors),h;try{for(l.s();!(h=l.n()).done;){var u=h.value;a.push(u.clone())}}catch(p){l.e(p)}finally{l.f()}var d;this.renderMode===we.Trail?d={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:d={};var f=new go;return f.mask=this.layers.mask,new n({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:e,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:d,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:a,worldSpace:this.worldSpace,layers:f})}}],[{key:"fromJSON",value:function(e,i,s){var r,o=mq(e.shape,i),a;e.renderMode===we.Trail?a={startLength:e.rendererEmitterSettings.startLength!=null?Jt(e.rendererEmitterSettings.startLength):new ps(30),followLocalOrigin:e.rendererEmitterSettings.followLocalOrigin}:e.renderMode===we.Mesh?a={}:a={};var l=new go;e.layers&&(l.mask=e.layers);var h=new n({autoDestroy:e.autoDestroy,looping:e.looping,prewarm:e.prewarm,duration:e.duration,shape:o,startLife:Jt(e.startLife),startSpeed:Jt(e.startSpeed),startRotation:rq(e.startRotation),startSize:Jt(e.startSize),startColor:kE(e.startColor),emissionOverTime:Jt(e.emissionOverTime),emissionOverDistance:Jt(e.emissionOverDistance),emissionBursts:e.emissionBursts,onlyUsedByOther:e.onlyUsedByOther,instancingGeometry:i.geometries[e.instancingGeometry],renderMode:e.renderMode,rendererEmitterSettings:a,renderOrder:e.renderOrder,speedFactor:e.speedFactor,layers:l,material:e.material?i.materials[e.material]:e.texture?new _t({map:i.textures[e.texture],transparent:(r=e.transparent)!==null&&r!==void 0?r:!0,blending:e.blending,side:_i}):new _t({color:16777215,transparent:!0,blending:d0,side:_i}),startTileIndex:typeof e.startTileIndex=="number"?new ps(e.startTileIndex):Jt(e.startTileIndex),uTileCount:e.uTileCount,vTileCount:e.vTileCount,behaviors:[],worldSpace:e.worldSpace});return h.behaviors=e.behaviors.map(function(u){var d=pq(u,h);return d.type==="EmitSubParticleSystem"&&(s[u.subParticleSystem]=d),d}),h}}]),n}(),_w=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,wq=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,Jm=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,xq=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Jm,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Cq=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Jm,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Sq=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(Jm,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),Eq=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(Jm,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function gC(n){return n===0?"uv":"uv".concat(n)}new w(0,0,1);var Iq=function(n){$f(e,n);var t=ep(e);function e(i){var s;return Ue(this,e),s=t.call(this,i),U(lt(s),"offsetBuffer",void 0),U(lt(s),"rotationBuffer",void 0),U(lt(s),"sizeBuffer",void 0),U(lt(s),"colorBuffer",void 0),U(lt(s),"uvTileBuffer",void 0),U(lt(s),"velocityBuffer",void 0),U(lt(s),"vector_",new w),U(lt(s),"vector2_",new w),U(lt(s),"vector3_",new w),U(lt(s),"quaternion_",new ie),U(lt(s),"quaternion2_",new ie),U(lt(s),"quaternion3_",new ie),U(lt(s),"rotationMat_",new za),U(lt(s),"rotationMat2_",new za),s.maxParticles=1e3,s.setupBuffers(),s.rebuildMaterial(),s}return Ne(e,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new Dc(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Gs),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new Dc(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Gs),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===we.Mesh?(this.rotationBuffer=new Dc(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Gs),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===we.BillBoard||this.settings.renderMode===we.HorizontalBillBoard||this.settings.renderMode===we.VerticalBillBoard||this.settings.renderMode===we.StretchedBillBoard)&&(this.rotationBuffer=new Dc(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Gs),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new Dc(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(Gs),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new Dc(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Gs),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===we.StretchedBillBoard&&(this.velocityBuffer=new Dc(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(Gs),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new jP,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s,r={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var o=this.settings.material;s=u0.merge([Hn.common,Hn.envmap,Hn.aomap,Hn.lightmap,Hn.emissivemap,Hn.bumpmap,Hn.normalmap,Hn.displacementmap,Hn.roughnessmap,Hn.metalnessmap,Hn.fog,Hn.lights,{emissive:{value:new be(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),s.diffuse.value=o.color,s.opacity.value=o.opacity,s.emissive.value=o.emissive,s.roughness.value=o.roughness,s.metalness.value=o.metalness,o.envMap&&(s.envMap.value=o.envMap,s.envMapIntensity.value=o.envMapIntensity),o.normalMap&&(s.normalMap.value=o.normalMap,s.normalScale.value=o.normalScale),o.roughnessMap&&(s.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(s.metalnessMap.value=o.metalnessMap),o.map&&(s.map=new $(o.map))}else s={},s.map=new $(this.settings.material.map);this.settings.material.alphaTest&&(r.USE_ALPHATEST="",s.alphaTest=new $(this.settings.material.alphaTest)),r.USE_UV="";var a=this.settings.uTileCount,l=this.settings.vTileCount;(a>1||l>1)&&(r.UV_TILE="",s.tileCount=new $(new oe(a,l))),this.settings.material.normalMap&&(r.USE_NORMALMAP="",r.NORMALMAP_UV=gC(this.settings.material.normalMap.channel),s.normalMapTransform=new $(new za().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=gC(this.settings.material.map.channel),s.mapTransform=new $(new za().copy(this.settings.material.map.matrix))),r.USE_COLOR_ALPHA="";var h=!1;if(this.settings.renderMode===we.BillBoard||this.settings.renderMode===we.VerticalBillBoard||this.settings.renderMode===we.HorizontalBillBoard||this.settings.renderMode===we.Mesh){var u,d;this.settings.renderMode===we.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(r.USE_COLOR="",u=Sq,d=wq,h=!0):(u=Cq,d=_w):(u=xq,d=_w),this.settings.renderMode===we.VerticalBillBoard?r.VERTICAL="":this.settings.renderMode===we.HorizontalBillBoard&&(r.HORIZONTAL=""),this.material=new $e({uniforms:s,defines:r,vertexShader:u,fragmentShader:d,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:h})}else if(this.settings.renderMode===we.StretchedBillBoard)s.speedFactor=new $(1),this.material=new $e({uniforms:s,defines:r,vertexShader:Eq,fragmentShader:_w,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0;this.systems.forEach(function(a){o+=a.particleNum}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(function(a){var l=a.particles,h=a.particleNum,u=s.quaternion2_,d=s.vector2_,f=s.vector3_;a.emitter.matrixWorld.decompose(d,u,f),s.rotationMat_.setFromMatrix4(a.emitter.matrixWorld);for(var p=0;p<h;p++,r++){var g=l[p];if(s.settings.renderMode===we.Mesh){var m=void 0;if(a.worldSpace)m=g.rotation;else{var v=void 0;g.parentMatrix?v=s.quaternion3_.setFromRotationMatrix(g.parentMatrix):v=u,m=s.quaternion_,m.copy(g.rotation).multiply(v)}s.rotationBuffer.setXYZW(r,m.x,m.y,m.z,m.w)}else(s.settings.renderMode===we.StretchedBillBoard||s.settings.renderMode===we.VerticalBillBoard||s.settings.renderMode===we.HorizontalBillBoard||s.settings.renderMode===we.BillBoard)&&s.rotationBuffer.setX(r,g.rotation);var y=void 0;if(a.worldSpace?y=g.position:(y=s.vector_,g.parentMatrix?y.copy(g.position).applyMatrix4(g.parentMatrix):y.copy(g.position).applyMatrix4(a.emitter.matrixWorld)),s.offsetBuffer.setXYZ(r,y.x,y.y,y.z),s.colorBuffer.setXYZW(r,g.color.x,g.color.y,g.color.z,g.color.w),a.worldSpace||g.parentMatrix?s.sizeBuffer.setX(r,g.size):s.sizeBuffer.setX(r,g.size*(Math.abs(f.x)+Math.abs(f.y)+Math.abs(f.z))/3),s.uvTileBuffer.setX(r,g.uvTile),s.settings.renderMode===we.StretchedBillBoard&&s.velocityBuffer){var b=a.speedFactor,_=void 0;a.worldSpace?_=g.velocity:(_=s.vector_,g.parentMatrix?(s.rotationMat2_.setFromMatrix4(g.parentMatrix),_.copy(g.velocity).applyMatrix3(s.rotationMat2_)):_.copy(g.velocity).applyMatrix3(s.rotationMat_)),s.velocityBuffer.setXYZ(r,_.x*b,_.y*b,_.z*b)}}}),this.geometry.instanceCount=r,r>0&&(this.offsetBuffer.updateRange.count=r*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=r,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=r,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===we.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=r*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===we.Mesh?(this.rotationBuffer.updateRange.count=r*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===we.StretchedBillBoard||this.settings.renderMode===we.HorizontalBillBoard||this.settings.renderMode===we.VerticalBillBoard||this.settings.renderMode===we.BillBoard)&&(this.rotationBuffer.updateRange.count=r,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),e}(K2),Tq=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,Rq=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(Jm,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new w(0,0,1);var Bq=function(n){$f(e,n);var t=ep(e);function e(i){var s;return Ue(this,e),s=t.call(this,i),U(lt(s),"positionBuffer",void 0),U(lt(s),"previousBuffer",void 0),U(lt(s),"nextBuffer",void 0),U(lt(s),"uvBuffer",void 0),U(lt(s),"sideBuffer",void 0),U(lt(s),"widthBuffer",void 0),U(lt(s),"colorBuffer",void 0),U(lt(s),"indexBuffer",void 0),U(lt(s),"vector_",new w),U(lt(s),"vector2_",new w),U(lt(s),"vector3_",new w),U(lt(s),"quaternion_",new ie),s.maxParticles=1e4,s.setupBuffers(),s.rebuildMaterial(),s}return Ne(e,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new Ht,this.indexBuffer=new Ke(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Gs),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new Ke(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Gs),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new Ke(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Gs),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new Ke(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Gs),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new Ke(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Gs),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new Ke(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Gs),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new Ke(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Gs),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new Ke(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Gs),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new oe(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new oe(1,1)}},r={};if(r.USE_UV="",r.USE_COLOR_ALPHA="",this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=gC(this.settings.material.map.channel),s.map=new $(this.settings.material.map),s.mapTransform=new $(new za().copy(this.settings.material.map.matrix))),this.settings.renderMode===we.Trail)this.material=new $e({uniforms:s,defines:r,vertexShader:Rq,fragmentShader:Tq,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||d0});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0,a=0;this.systems.forEach(function(l){for(var h=0;h<l.particleNum;h++)a+=l.particles[h].previous.length*2}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(l){var h=s.quaternion_,u=s.vector2_,d=s.vector3_;l.emitter.matrixWorld.decompose(u,h,d);for(var f=l.particles,p=l.particleNum,g=s.settings.uTileCount,m=s.settings.vTileCount,v=1/g,y=1/m,b=0;b<p;b++){var _=f[b],x=_.uvTile%m,S=Math.floor(_.uvTile/m),E=_.previous.values(),M=E.next(),I=M.value,B=I;M.done||(M=E.next());var R=void 0;M.value!==void 0?R=M.value:R=B;for(var P=0;P<_.previous.length;P++,r+=2){if(s.positionBuffer.setXYZ(r,B.position.x,B.position.y,B.position.z),s.positionBuffer.setXYZ(r+1,B.position.x,B.position.y,B.position.z),l.worldSpace?(s.positionBuffer.setXYZ(r,B.position.x,B.position.y,B.position.z),s.positionBuffer.setXYZ(r+1,B.position.x,B.position.y,B.position.z)):(_.parentMatrix?s.vector_.copy(B.position).applyMatrix4(_.parentMatrix):s.vector_.copy(B.position).applyMatrix4(l.emitter.matrixWorld),s.positionBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.positionBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),l.worldSpace?(s.previousBuffer.setXYZ(r,I.position.x,I.position.y,I.position.z),s.previousBuffer.setXYZ(r+1,I.position.x,I.position.y,I.position.z)):(_.parentMatrix?s.vector_.copy(I.position).applyMatrix4(_.parentMatrix):s.vector_.copy(I.position).applyMatrix4(l.emitter.matrixWorld),s.previousBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.previousBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),l.worldSpace?(s.nextBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),s.nextBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z)):(_.parentMatrix?s.vector_.copy(R.position).applyMatrix4(_.parentMatrix):s.vector_.copy(R.position).applyMatrix4(l.emitter.matrixWorld),s.nextBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.nextBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),s.sideBuffer.setX(r,-1),s.sideBuffer.setX(r+1,1),l.worldSpace)s.widthBuffer.setX(r,B.size),s.widthBuffer.setX(r+1,B.size);else if(_.parentMatrix)s.widthBuffer.setX(r,B.size),s.widthBuffer.setX(r+1,B.size);else{var F=(Math.abs(d.x)+Math.abs(d.y)+Math.abs(d.z))/3;s.widthBuffer.setX(r,B.size*F),s.widthBuffer.setX(r+1,B.size*F)}s.uvBuffer.setXY(r,(P/_.previous.length+x)*v,(m-S-1)*y),s.uvBuffer.setXY(r+1,(P/_.previous.length+x)*v,(m-S)*y),s.colorBuffer.setXYZW(r,B.color.x,B.color.y,B.color.z,B.color.w),s.colorBuffer.setXYZW(r+1,B.color.x,B.color.y,B.color.z,B.color.w),P+1<_.previous.length&&(s.indexBuffer.setX(o*3,r),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+2),o++,s.indexBuffer.setX(o*3,r+2),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+3),o++),I=B,B=R,M.done||(M=E.next(),M.value!==void 0&&(R=M.value))}}}),this.positionBuffer.updateRange.count=r*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=r*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=r*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=r,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=r,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=r*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=o*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,o*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),e}(K2),Pq=function(n){$f(e,n);var t=ep(e);function e(){var i;return Ue(this,e),i=t.call(this),U(lt(i),"batches",[]),U(lt(i),"systemToBatchIndex",new Map),U(lt(i),"type","BatchedRenderer"),i}return Ne(e,[{key:"addSystem",value:function(s){s._renderer=this;for(var r=s.getRendererSettings(),o=0;o<this.batches.length;o++)if(e.equals(this.batches[o].settings,r)){this.batches[o].addSystem(s),this.systemToBatchIndex.set(s,o);return}var a;switch(r.renderMode){case we.Trail:a=new Bq(r);break;case we.Mesh:case we.BillBoard:case we.VerticalBillBoard:case we.HorizontalBillBoard:case we.StretchedBillBoard:a=new Iq(r);break}a.addSystem(s),this.batches.push(a),this.systemToBatchIndex.set(s,this.batches.length-1),this.add(a)}},{key:"deleteSystem",value:function(s){var r=this.systemToBatchIndex.get(s);r!=null&&(this.batches[r].removeSystem(s),this.systemToBatchIndex.delete(s))}},{key:"updateSystem",value:function(s){this.deleteSystem(s),this.addSystem(s)}},{key:"update",value:function(s){this.systemToBatchIndex.forEach(function(o,a){a.update(s)});for(var r=0;r<this.batches.length;r++)this.batches[r].update()}}],[{key:"equals",value:function(s,r){return s.material.side===r.material.side&&s.material.blending===r.material.blending&&s.material.transparent===r.material.transparent&&s.material.type===r.material.type&&s.material.alphaTest===r.material.alphaTest&&s.material.map===r.material.map&&s.renderMode===r.renderMode&&s.uTileCount===r.uTileCount&&s.vTileCount===r.vTileCount&&s.instancingGeometry===r.instancingGeometry&&s.renderOrder===r.renderOrder&&s.layers.mask===r.layers.mask}}]),e}(ne),Mq=Pq,OB=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new w;Ue(this,n),U(this,"locations",[]),this.scaleX=t,this.scaleY=e,this.position=i}return Ne(n,[{key:"transform",value:function(e,i){e.x=this.locations[i%this.locations.length].x*this.scaleX+this.position.x,e.y=this.locations[i%this.locations.length].y*this.scaleY+this.position.y,e.z=this.position.z}},{key:"clone",value:function(){var e=new n(this.scaleX,this.scaleY,this.position.clone());return e.locations=this.locations.map(function(i){return i.clone()}),e}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(e){return{x:e.x,y:e.y}})}}},{key:"fromImage",value:function(e,i){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var r=s.getContext("2d");if(r){r.drawImage(e,0,0);var o=r.getImageData(0,0,s.width,s.height,{colorSpace:"srgb"});s.remove(),this.locations.length=0;for(var a=0;a<o.height;a++)for(var l=0;l<o.width;l++)o.data[(a*o.width+l)*4+3]>i&&this.locations.push(new oe(l,o.height-a))}}}],[{key:"fromJSON",value:function(e){var i=new n(e.scaleX,e.scaleY,new w(e.position[0],e.position[1],e.position[2]));return i.locations=e.locations.map(function(s){return new oe(s.x,s.y)}),i}}]),n}();function kq(n){switch(n.type){case"TextureSequencer":return OB.fromJSON(n);default:return new OB}}var Dq=function(){function n(t){Ue(this,n),U(this,"type","ApplySequences"),U(this,"sequencers",[]),U(this,"time",0),U(this,"index",0),U(this,"pCount",0),U(this,"delay",void 0),U(this,"tempV",new w),this.delay=t}return Ne(n,[{key:"initialize",value:function(e){e.id=this.pCount,e.dst=new w,e.begin=new w,e.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(e,i){var s=this.sequencers[this.index],r=e.id*this.delay;this.time>=s[0].a+r&&this.time<=s[0].b+r?(e.inMotion||(e.inMotion=!0,e.begin.copy(e.position),s[1].transform(e.dst,e.id)),e.position.lerpVectors(e.begin,e.dst,n.BEZIER.genValue((this.time-s[0].a-r)/(s[0].b-s[0].a)))):this.time>s[0].b+r&&(e.inMotion=!1)}},{key:"frameUpdate",value:function(e){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=e}},{key:"appendSequencer",value:function(e,i){this.sequencers.push([e,i])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(e){var i=mf(e,2),s=i[0],r=i[1];return{range:s.toJSON(),sequencer:r.toJSON()}})}}},{key:"clone",value:function(){var e=new n(this.delay);return e.sequencers=this.sequencers.map(function(i){return[i[0].clone(),i[1].clone()]}),e}}],[{key:"fromJSON",value:function(e){var i=new n(e.delay);return e.sequencers.forEach(function(s){i.sequencers.push([Jt(s.range),kq(s.sequencer)])}),i}}]),n}();U(Dq,"BEZIER",new uC(0,0,1,1));var q=function(n){return n[n.Number=0]="Number",n[n.Vec2=1]="Vec2",n[n.Vec3=2]="Vec3",n[n.Vec4=3]="Vec4",n[n.Boolean=4]="Boolean",n[n.AnyType=5]="AnyType",n}({}),LB=Ne(function n(t,e,i,s){Ue(this,n),U(this,"input",void 0),U(this,"inputIndex",void 0),U(this,"output",void 0),U(this,"outputIndex",void 0),this.input=t,this.inputIndex=e,this.input.outputs[e].push(this),this.output=i,this.outputIndex=s,this.output.inputs[s]=this}),Oq=function(){function n(){Ue(this,n),U(this,"visited",new Set),U(this,"graph_",void 0),U(this,"context_",void 0),n.Instance=this}return Ne(n,[{key:"traverse",value:function(e){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(e.id);for(var i=[],s=0;s<e.inputs.length;s++)if(e.inputs[s]instanceof LB){var r=e.inputs[s].input;this.visited.has(r.id)||this.traverse(r),i.push(r.outputValues[e.inputs[s].inputIndex])}else i.push(e.inputs[s].getValue(this.context_));e.func(this.context_,i,e.outputValues),this.graph_.nodesInOrder.push(e)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var e=this.graph_.nodesInOrder,i=0;i<e.length;i++){for(var s=[],r=e[i],o=0;o<r.inputs.length;o++)if(r.inputs[o]instanceof LB)s.push(r.inputs[o].input.outputValues[r.inputs[o].inputIndex]);else if(r.inputs[o]!==void 0)s.push(r.inputs[o].getValue(this.context_));else throw new Error("miss input for node ".concat(r.id));r.func(this.context_,s,r.outputValues)}}},{key:"run",value:function(e,i){if(this.graph_=e,this.context_=i,e.compiled)this.executeCompiledGraph();else{e.nodesInOrder.length=0,this.visited.clear();for(var s=0;s<e.outputNodes.length;s++){var r=e.outputNodes[s];this.traverse(r)}e.compiled=!0}}}]),n}();U(Oq,"Instance",void 0);var vt=function(){function n(t){Ue(this,n),U(this,"name",void 0),U(this,"nodeTypeSignatures",[]),this.name=t}return Ne(n,[{key:"addSignature",value:function(e,i,s){this.nodeTypeSignatures.push({inputTypes:e,outputTypes:i,func:s})}}]),n}(),mb=new vt("add");mb.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]+e[1]});mb.addSignature([q.Vec2,q.Vec2],[q.Vec2],function(n,t,e,i){i[0].addVectors(e[0],e[1])});mb.addSignature([q.Vec3,q.Vec3],[q.Vec3],function(n,t,e,i){i[0].addVectors(e[0],e[1])});mb.addSignature([q.Vec4,q.Vec4],[q.Vec4],function(n,t,e,i){i[0].addVectors(e[0],e[1])});var Ab=new vt("sub");Ab.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]-e[1]});Ab.addSignature([q.Vec2,q.Vec2],[q.Vec2],function(n,t,e,i){i[0].subVectors(e[0],e[1])});Ab.addSignature([q.Vec3,q.Vec3],[q.Vec3],function(n,t,e,i){i[0].subVectors(e[0],e[1])});Ab.addSignature([q.Vec4,q.Vec4],[q.Vec4],function(n,t,e,i){i[0].subVectors(e[0],e[1])});var vb=new vt("mul");vb.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]*e[1]});vb.addSignature([q.Vec2,q.Number],[q.Vec2],function(n,t,e,i){i[0].copy(e[0]).multiplyScalar(e[1])});vb.addSignature([q.Vec3,q.Number],[q.Vec3],function(n,t,e,i){i[0].copy(e[0]).multiplyScalar(e[1])});vb.addSignature([q.Vec4,q.Number],[q.Vec4],function(n,t,e,i){i[0].copy(e[0]).multiplyScalar(e[1])});var yb=new vt("div");yb.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]/e[1]});yb.addSignature([q.Vec2,q.Number],[q.Vec2],function(n,t,e,i){i[0].copy(e[0]).divideScalar(e[1])});yb.addSignature([q.Vec3,q.Number],[q.Vec3],function(n,t,e,i){i[0].copy(e[0]).divideScalar(e[1])});yb.addSignature([q.Vec4,q.Number],[q.Vec4],function(n,t,e,i){i[0].copy(e[0]).divideScalar(e[1])});var Lq=new vt("sin");Lq.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=Math.sin(e[0])});var Fq=new vt("cos");Fq.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=Math.cos(e[0])});var Uq=new vt("tan");Uq.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=Math.tan(e[0])});var Nq=new vt("abs");Nq.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=Math.abs(e[0])});var zq=new vt("min");zq.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=Math.min(e[0],e[1])});var Qq=new vt("max");Qq.addSignature([q.Number,q.Number],[q.Number],function(n,t,e,i){i[0]=Math.max(e[0],e[1])});var DE=new vt("dot");DE.addSignature([q.Vec2,q.Vec2],[q.Number],function(n,t,e,i){i[0]=e[0].dot(e[1])});DE.addSignature([q.Vec3,q.Vec3],[q.Number],function(n,t,e,i){i[0]=e[0].dot(e[1])});DE.addSignature([q.Vec4,q.Vec4],[q.Number],function(n,t,e,i){i[0]=e[0].dot(e[1])});var jq=new vt("cross");jq.addSignature([q.Vec3,q.Vec3],[q.Vec3],function(n,t,e,i){i[0].crossVectors(e[0],e[1])});var OE=new vt("length");OE.addSignature([q.Vec2],[q.Number],function(n,t,e,i){i[0]=e[0].length()});OE.addSignature([q.Vec3],[q.Number],function(n,t,e,i){i[0]=e[0].length()});OE.addSignature([q.Vec4],[q.Number],function(n,t,e,i){i[0]=e[0].length()});var LE=new vt("lengthSq");LE.addSignature([q.Vec2],[q.Number],function(n,t,e,i){i[0]=e[0].lengthSq()});LE.addSignature([q.Vec3],[q.Number],function(n,t,e,i){i[0]=e[0].lengthSq()});LE.addSignature([q.Vec4],[q.Number],function(n,t,e,i){i[0]=e[0].lengthSq()});var FE=new vt("normalize");FE.addSignature([q.Vec2],[q.Vec2],function(n,t,e,i){i[0].copy(e[0]).normalize()});FE.addSignature([q.Vec3],[q.Vec3],function(n,t,e,i){i[0].copy(e[0]).normalize()});FE.addSignature([q.Vec4],[q.Vec4],function(n,t,e,i){i[0].copy(e[0]).normalize()});var J2=new vt("distance");J2.addSignature([q.Vec2,q.Vec2],[q.Number],function(n,t,e,i){i[0]=e[0].distanceTo(e[1])});J2.addSignature([q.Vec3,q.Vec3],[q.Number],function(n,t,e,i){i[0]=e[0].distanceTo(e[1])});var Gq=new vt("and");Gq.addSignature([q.Boolean,q.Boolean],[q.Boolean],function(n,t,e,i){i[0]=e[0]&&e[1]});var Hq=new vt("or");Hq.addSignature([q.Boolean,q.Boolean],[q.Boolean],function(n,t,e,i){i[0]=e[0]||e[1]});var Vq=new vt("not");Vq.addSignature([q.Boolean],[q.Boolean],function(n,t,e,i){i[0]=!e[0]});var bb=new vt("equal");bb.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]===e[1]});bb.addSignature([q.Vec2,q.Vec2],[q.Boolean],function(n,t,e,i){i[0]=e[0].equals(e[1])});bb.addSignature([q.Vec3,q.Vec3],[q.Boolean],function(n,t,e,i){i[0]=e[0].equals(e[1])});bb.addSignature([q.Vec4,q.Vec4],[q.Boolean],function(n,t,e,i){i[0]=e[0].equals(e[1])});var Wq=new vt("lessThan");Wq.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]<e[1]});var qq=new vt("greaterThan");qq.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]>e[1]});var Xq=new vt("lessThanOrEqual");Xq.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]<=e[1]});var Yq=new vt("greaterThanOrEqual");Yq.addSignature([q.Number,q.Number],[q.Boolean],function(n,t,e,i){i[0]=e[0]>=e[1]});var Kq=new vt("if");Kq.addSignature([q.Boolean,q.AnyType,q.AnyType],[q.AnyType],function(n,t,e,i){i[0]=e[0]?e[1]:e[2]});var Jq=new vt("number");Jq.addSignature([],[q.Number],function(n,t,e,i){i[0]=t.value});var Zq=new vt("vec2");Zq.addSignature([],[q.Vec2],function(n,t,e,i){i[0]=t.value});var $q=new vt("vec3");$q.addSignature([],[q.Vec3],function(n,t,e,i){i[0]=t.value});var eX=new vt("vec4");eX.addSignature([],[q.Vec4],function(n,t,e,i){i[0]=t.value});var tX=new vt("bool");tX.addSignature([],[q.Boolean],function(n,t,e,i){i[0]=t.value});var iX=new vt("particlePosition");iX.addSignature([],[q.Vec3],function(n,t,e,i){i[0]=n.particle[t.property]});var nX=new vt("particleVelocity");nX.addSignature([],[q.Vec3],function(n,t,e,i){i[0]=n.particle[t.property]});var sX=new vt("particleRotation");sX.addSignature([],[q.Number],function(n,t,e,i){i[0]=n.particle[t.property]});var rX=new vt("particleAge");rX.addSignature([],[q.Number],function(n,t,e,i){i[0]=n.particle[t.property]});var Zm=new vt("output");Zm.addSignature([q.Number],[q.Number],function(n,t,e,i){i[0]=e[0]});Zm.addSignature([q.Vec2],[q.Vec2],function(n,t,e,i){i[0]=e[0]});Zm.addSignature([q.Vec3],[q.Vec3],function(n,t,e,i){i[0]=e[0]});Zm.addSignature([q.Vec4],[q.Vec4],function(n,t,e,i){i[0]=e[0]});Zm.addSignature([q.Boolean],[q.Boolean],function(n,t,e,i){i[0]=e[0]});setTimeout(()=>console.log("Particle system powered by three.quarks. https://quarks.art/"),100);var Si=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const $p=z("debugparticles"),oX=z("noprogressive"),aX=z("debugprogressive");var Qy;(function(n){n[n.Birth=0]="Birth",n[n.Collision=1]="Collision",n[n.Death=2]="Death",n[n.Trigger=3]="Trigger",n[n.Manual=4]="Manual"})(Qy||(Qy={}));class aa extends re{constructor(){super(...arguments);c(this,"renderMode");c(this,"particleMaterial");c(this,"trailMaterial");c(this,"particleMesh");c(this,"maxParticleSize");c(this,"minParticleSize");c(this,"velocityScale");c(this,"cameraVelocityScale");c(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&ve()){const e=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(e)}}get transparent(){var i;return((i=this.particleMaterial)==null?void 0:i.transparent)??!1}getMaterial(e=!1){let i=e===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&e&&i.side===il&&(i=i.clone(),i.side=Wc,e?this.trailMaterial=i:this.particleMaterial=i),i&&!oX&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,aX&&console.log("Load material LOD",i.name),ht.assignTextureLOD(i,0)),i}getMesh(e){let i=null;if(!i&&(this.particleMesh instanceof J&&(i=this.particleMesh.geometry),i===null)){i=new pr(1,1);const r=i.attributes.uv;for(let o=0;o<r.count;o++)r.setX(o,1-r.getX(o))}return new J(i,this.getMaterial())}}Si([A()],aa.prototype,"renderMode",void 0);Si([A(mt)],aa.prototype,"particleMaterial",void 0);Si([A(mt)],aa.prototype,"trailMaterial",void 0);Si([A()],aa.prototype,"maxParticleSize",void 0);Si([A()],aa.prototype,"minParticleSize",void 0);Si([A()],aa.prototype,"velocityScale",void 0);Si([A()],aa.prototype,"cameraVelocityScale",void 0);Si([A()],aa.prototype,"lengthScale",void 0);class av{constructor(t,e=1){c(this,"_curve");c(this,"_factor");c(this,"type","function");this._curve=t,this._factor=e}genValue(t){return this._curve.evaluate(t,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class UE{constructor(t){c(this,"type","value");c(this,"system");this.system=t}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class lX extends UE{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class cX extends UE{constructor(){super(...arguments);c(this,"_lastPosition",new w);c(this,"_lastDistance",0)}update(){const e=He(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(e),this._lastPosition.copy(e)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let e=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let a=this._lastDistance/this.system.deltaTime*r;Number.isFinite(a)||(a=0),e+=a}const i=this.system.emission.getBurst();i>0&&(e+=i/this.system.deltaTime);const s=this.system.maxParticles-this.system.currentParticles;return ye.clamp(e,0,s/this.system.deltaTime)}}class hX extends UE{genValue(){return this.system.isPlaying,0}}class $u{constructor(t){c(this,"system");c(this,"type");this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",t&&(this.system=t)}get context(){return this.system.context}initialize(t){}update(t,e){}frameUpdate(t){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class uX extends $u{constructor(){super(...arguments);c(this,"type","NeedleTextureSheet")}update(e,i){const s=this.system.textureSheetAnimation;if(s.enabled){const r=e.age/e.life,o=s.evaluate(r);o!==void 0&&(e.uvTile=o)}}}const FB=Symbol("particleRotation");class dX extends $u{constructor(){super(...arguments);c(this,"type","NeedleRotation")}initialize(e){e[FB]=Math.random()}update(e,i){if(e.rotation===void 0)return;const s=e.age/e.life;if(typeof e.rotation=="number"&&(this.system.rotationOverLifetime.enabled?e.rotation+=this.system.rotationOverLifetime.evaluate(s,e[FB])*i:this.system.renderer.renderMode===Ma.Billboard&&(e.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=e.velocity.length();e.rotation+=this.system.rotationBySpeed.evaluate(s,r)*i}}}const UB=Symbol("sizeLerpFactor"),fX=new w;class pX extends $u{constructor(){super(...arguments);c(this,"type","NeedleSize");c(this,"_minSize",0);c(this,"_maxSize",1)}initialize(e){e[UB]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(e,i){const s=e.age/e.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(s,void 0,e[UB]).x);let o=1;if(this.system.renderer.renderMode!==Ma.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale),e.size=e.startSize*r*o,this.system.localspace){const a=Z2(this.system,fX);e.size*=a.x}}}const Hd=Symbol("particleLife"),ww=Symbol("trailLifetime"),NB=Symbol("trailStartLength"),xw=Symbol("trailWidthRandom");class gX extends $u{constructor(){super(...arguments);c(this,"type","NeedleTrail")}initialize(e){e instanceof hm&&(e[Hd]=e.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(e[ww]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),e.life+=e[ww]),e[NB]=e.length,e[xw]=Math.random())}update(e){var i;if((i=this.system.trails)!=null&&i.enabled&&e instanceof hm){const s=e,r=e.age/e[Hd],o=e.previous.values(),a=e.previous.length;for(let l=0;l<a;l++){const u=o.next().value,d=1-l/(a-1);let f=e.size;f<=0&&!this.system.trails.sizeAffectsWidth&&(f=20*this.system.trails.widthOverTrail.evaluate(.5,s[xw])),u.size=this.system.trails.getWidth(f,r,d,s[xw]),u.color.copy(e.color),this.system.trails.getColor(u.color,r,d)}if(e.age>e[Hd]){e.velocity.set(0,0,0);const l=(e.age-e[Hd])/e[ww];s.length=ye.lerp(e[NB],0,l)}}}}const lv=Symbol("startVelocity"),zB=Symbol("gravityModifier"),Cw=Symbol("gravitySpeed"),cv=Symbol("velocity lerp factor"),mC=new w;class mX extends $u{constructor(){super(...arguments);c(this,"type","NeedleVelocity");c(this,"_gravityDirection",new w)}initialize(e){var r,o;const i=this.system.main.simulationSpeed;e.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random()),e.velocity.copy(this.system.shape.getDirection(e,e.position)).multiplyScalar(e.startSpeed),(r=this.system.inheritVelocity)!=null&&r.enabled&&this.system.inheritVelocity.applyInitial(e.velocity),e[lv]?e[lv].copy(e.velocity):e[lv]=e.velocity.clone();const s=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());e[zB]=s*i,e[Cw]=s*i*.5,e[cv]=Math.random(),(o=this.system.velocityOverLifetime)==null||o.init(e),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===ta.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(e,i){var f;const s=e[lv],r=e[zB];if(r!==0){const p=r*e[Cw];mC.copy(this._gravityDirection).multiplyScalar(p),e[Cw]+=i*.05,s.add(mC)}e.velocity.copy(s);const o=e.age/e.life;(f=this.system.inheritVelocity)!=null&&f.enabled&&this.system.inheritVelocity.applyCurrent(e.velocity,o,e[cv]);const a=this.system.noise;a.enabled&&a.apply(0,e.position,e.velocity,i,e.age,e.life);const l=this.system.sizeBySpeed;l!=null&&l.enabled&&(e.size=l.evaluate(e.velocity,o,e[cv],e.size));const h=this.system.colorBySpeed;h!=null&&h.enabled&&h.evaluate(e.velocity,e[cv],e.color);const u=this.system.velocityOverLifetime;u.enabled&&u.apply(e,0,e.position,e.velocity,i,e.age,e.life);const d=this.system.limitVelocityOverLifetime;d.enabled&&d.apply(e.position,s,e.velocity,e.size,o,i,1),this.system.worldspace&&e.velocity.multiply(this.system.worldScale)}}const QB=Symbol("colorLerpFactor"),jB=new Ut(1,1,1,1),zh=new Ut(1,1,1,1);class AX extends $u{constructor(){super(...arguments);c(this,"type","NeedleColor")}initialize(e){}_init(e){const i=this.system.renderer.particleMaterial;zh.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(jB.copy(i.color),zh.multiply(jB)),zh.convertLinearToSRGB(),e.startColor.set(zh.r,zh.g,zh.b,zh.alpha),e.color.copy(e.startColor),e[QB]=Math.random()}update(e,i){if(e.age===0&&this._init(e),this.system.colorOverLifetime.enabled){const s=e.age/e.life,r=this.system.colorOverLifetime.color.evaluate(s,e[QB]);e.color.set(r.r,r.g,r.b,"alpha"in r?r.alpha:1).multiply(e.startColor)}else e.color.copy(e.startColor)}}class vX{constructor(t){c(this,"system");c(this,"emission");c(this,"autoDestroy");c(this,"startLength");c(this,"emissionBursts");c(this,"onlyUsedByOther");c(this,"behaviors",[]);c(this,"rendererEmitterSettings",{startLength:new ps(220),followLocalOrigin:!1});c(this,"flatWhiteTexture");c(this,"clonedTexture",{original:void 0,clone:void 0});this.system=t,this.emission=new cX(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new av(this.system.main.startLifetime)}get startSpeed(){return new av(this.system.main.startSpeed)}get startRotation(){return new av(this.system.main.startRotation)}get startSize(){return new av(this.system.main.startSize)}get startColor(){return new zy(new Fe(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new hX(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return we.Trail;switch(this.system.renderer.renderMode){case Ma.Billboard:return we.BillBoard;case Ma.Stretch:return we.StretchedBillBoard;case Ma.HorizontalBillboard:return we.HorizontalBillBoard;case Ma.VerticalBillboard:return we.VerticalBillBoard;case Ma.Mesh:return we.Mesh}return we.BillBoard}get speedFactor(){var e;let t=this.system.main.simulationSpeed;return((e=this.system.renderer)==null?void 0:e.renderMode)===Ma.Stretch&&(t*=this.system.renderer.velocityScale??1),t}get texture(){const t=this.material;if(t&&t.map){const e=t.map;if(this.clonedTexture.original!==e||!this.clonedTexture.clone){const i=e.clone();i.premultiplyAlpha=!1,i.colorSpace=Ni,this.clonedTexture.original=e,this.clonedTexture.clone=i}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=WS(new Ut(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new lX(this.system)}get uTileCount(){var t;return this.anim.enabled?(t=this.anim)==null?void 0:t.numTilesX:void 0}get vTileCount(){var t;return this.anim.enabled?(t=this.anim)==null?void 0:t.numTilesY:void 0}get renderOrder(){return 1}get blending(){var t;return((t=this.system.renderer.particleMaterial)==null?void 0:t.blending)??nU}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===ta.World}}class yX{constructor(){c(this,"burstIndex",0);c(this,"burstWaveIndex",0);c(this,"time",0);c(this,"waitEmiting",0)}}class wi extends re{constructor(){super(...arguments);c(this,"_state");c(this,"colorOverLifetime");c(this,"main");c(this,"emission");c(this,"sizeOverLifetime");c(this,"shape");c(this,"noise");c(this,"trails");c(this,"velocityOverLifetime");c(this,"limitVelocityOverLifetime");c(this,"inheritVelocity");c(this,"colorBySpeed");c(this,"textureSheetAnimation");c(this,"rotationOverLifetime");c(this,"rotationBySpeed");c(this,"sizeBySpeed");c(this,"_cameraScale",1);c(this,"__worldQuaternion",new ie);c(this,"_worldQuaternionInverted",new ie);c(this,"_worldScale",new w);c(this,"_worldPositionFrame",-1);c(this,"_worldPos",new w);c(this,"_renderer");c(this,"_batchSystem");c(this,"_particleSystem");c(this,"_interface");c(this,"_container");c(this,"_time",0);c(this,"_isPlaying",!0);c(this,"_isUsedAsSubsystem",!1);c(this,"_didPreWarm",!1);c(this,"_bursts");c(this,"_subEmitterSystems");c(this,"_lastBatchesCount",-1);c(this,"lastMaterialVersion",-1)}play(e=!1){var i;e&&Q.foreachComponent(this.gameObject,s=>{s instanceof wi&&s!==this&&s.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(i=this.emission)==null||i.reset()}pause(e=!0){e&&Q.foreachComponent(this.gameObject,i=>{i instanceof wi&&i!==this&&i.pause(!1)},!0),this._isPlaying=!1}stop(e=!0,i=!1){e&&Q.foreachComponent(this.gameObject,s=>{s instanceof wi&&s!==this&&s.stop(!1,i)},!0),this._isPlaying=!1,this._time=0,i&&this.reset()}reset(){var e;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(e=this.emission)==null||e.reset())}emit(e){if(this._particleSystem){this.onUpdate(),e=Math.min(e,this.maxParticles-this.currentParticles),this._state||(this._state=new yX),this._state.waitEmiting=e,this._state.time=0;const i=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=i}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(e){this.main.playOnAwake=e}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var e;return((e=this._particleSystem)==null?void 0:e.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===ta.World}get localspace(){return this.main.simulationSpace===ta.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,He(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(e){return this._particleSystem?(e instanceof $u&&(e.system=this),ve()&&console.log("add behaviour",e),this._particleSystem.addBehavior(e),!0):!1}removeBehaviour(e){if(!this._particleSystem)return!1;const i=this._particleSystem.behaviors,s=i.indexOf(e);return s!==-1&&i.splice(s,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(e){for(let i=0;i<e.length;i++){const s=e[i];if(!(s instanceof By)){const r=new By;Mf(r,s),e[i]=r}}this._bursts=e}set subEmitterSystems(e){for(let i=0;i<e.length;i++){const s=e[i];if(!(s instanceof jy)){const r=new jy;Mf(r,s),e[i]=r}}$p&&e.length>0&&console.log("SubEmitters: ",e,this),this._subEmitterSystems=e}onAfterDeserialize(e){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const i of this._subEmitterSystems)i._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(aa),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new ne,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new Mq,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new vX(this),this._particleSystem=new _q(this._interface),this._particleSystem.addBehavior(new pX(this)),this._particleSystem.addBehavior(new AX(this)),this._particleSystem.addBehavior(new uX(this)),this._particleSystem.addBehavior(new dX(this)),this._particleSystem.addBehavior(new mX(this)),this._particleSystem.addBehavior(new gX(this)),this._batchSystem.addSystem(this._particleSystem);const e=this._particleSystem.emitter;this.context.scene.add(e),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),$p&&(console.log(this),this.gameObject.add(new dr(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof J&&this._interface.renderMode==we.Mesh&&ht.assignMeshLOD(this.renderer.particleMesh,0).then(e=>{e&&this.particleSystem&&this._interface.renderMode==we.Mesh&&(this.particleSystem.instancingGeometry=e)})}onDestroy(){var e,i,s,r;(e=this._container)==null||e.removeFromParent(),(i=this._batchSystem)==null||i.removeFromParent(),(s=this._particleSystem)==null||s.emitter.removeFromParent(),(r=this._particleSystem)==null||r.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var e;this.main&&(this._didPreWarm===!1&&((e=this.main)==null?void 0:e.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var u;if(!((u=this.emission)!=null&&u.enabled)||this.emission.rateOverTime.getMax()<=0)return;const i=1/60,s=this.main.duration,r=this.main.startLifetime.getMax(),o=1e3,a=Math.min(Math.max(s,r)/Math.max(.01,this.main.simulationSpeed),o),l=Math.ceil(a/i),h=Date.now();$p&&console.log(`Particles ${this.name} - Prewarm for ${l} frames (${a} sec). Duration: ${s}, Lifetime: ${r}`);for(let d=0;d<l&&!(this.currentParticles>=this.maxParticles);d++){const f=Date.now()-h;if(f>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${f}`);break}this.onUpdate(),this.onSimulate(i)}}onSimulate(e){if(this._batchSystem){let i=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,i=!0),i&&this.updateLayers(),this._batchSystem.update(e)}this._time+=e,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let e=0;e<this._batchSystem.batches.length;e++){const i=this._batchSystem.batches[e];i.layers.disableAll();const s=this.layer;i.layers.mask=1<<s}}onUpdate(){var o,a;const e=this.renderer.getMaterial(this.trails.enabled);if(e&&e.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=e.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const i=this.context.mainCamera;if(i){const l=ri(i);this._cameraScale=l.x}const s=!this.worldspace,r=this.gameObject;if(Gt(r,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),ri(this.gameObject,this._worldScale),s&&this._container&&((o=this.gameObject)!=null&&o.parent)){const l=Z2(this,mC);this._container.matrix.makeScale(l.x,l.y,l.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(a=this.inheritVelocity)==null||a.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var e;if(this._subEmitterSystems&&this._particleSystem)for(const i of this._subEmitterSystems){i.particleSystem&&(i.particleSystem.__internalAwake?i.particleSystem.__internalAwake():ve()&&console.warn("SubParticleSystem serialization issue(?)",i.particleSystem,i));const s=(e=i.particleSystem)==null?void 0:e._particleSystem;if(s){i.particleSystem._isUsedAsSubsystem=!0;const r=new NE(this,this._particleSystem,i.particleSystem,s);r.emitterType=i.type,r.emitterProbability=i.emitProbability,this._particleSystem.addBehavior(r)}else $p&&console.warn("Could not add SubParticleSystem",i,this)}}}Si([A(sb)],wi.prototype,"colorOverLifetime",void 0);Si([A(Es)],wi.prototype,"main",void 0);Si([A(gc)],wi.prototype,"emission",void 0);Si([A(Xu)],wi.prototype,"sizeOverLifetime",void 0);Si([A(Zt)],wi.prototype,"shape",void 0);Si([A(Nt)],wi.prototype,"noise",void 0);Si([A(Ci)],wi.prototype,"trails",void 0);Si([A(Pi)],wi.prototype,"velocityOverLifetime",void 0);Si([A(un)],wi.prototype,"limitVelocityOverLifetime",void 0);Si([A(mc)],wi.prototype,"inheritVelocity",void 0);Si([A(Xf)],wi.prototype,"colorBySpeed",void 0);Si([A(Is)],wi.prototype,"textureSheetAnimation",void 0);Si([A(oa)],wi.prototype,"rotationOverLifetime",void 0);Si([A(Io)],wi.prototype,"rotationBySpeed",void 0);Si([A(mr)],wi.prototype,"sizeBySpeed",void 0);class jy{constructor(){c(this,"particleSystem");c(this,"emitProbability",1);c(this,"properties");c(this,"type")}_deserialize(t,e){const i=this.particleSystem;if(i instanceof wi)return;let s="";i&&typeof i.guid=="string"&&(s=i.guid,this.particleSystem=Q.findByGuid(s,e)),$p&&!(this.particleSystem instanceof wi)&&console.warn("Could not find particle system for sub emitter",s,e,this)}}function Z2(n,t){if(t.set(1,1,1),n.gameObject.parent&&n.localspace)switch(n.main.scalingMode){case Ry.Local:t=ri(n.gameObject.parent,t),t.x=1/t.x,t.y=1/t.y,t.z=1/t.z;break;default:if(!n.unsupported_scaling_mode){n.unsupported_scaling_mode=!0;const e="ParticleSystem scale mode "+Ry[n.main.scalingMode]+" is not supported";ve()&&qt(e),console.warn(e,n.name,n)}t=ri(n.gameObject,t);break}return t}new w(1,1,1);new w(0,0,1);class NE{constructor(t,e,i,s){c(this,"system");c(this,"particleSystem");c(this,"subSystem");c(this,"subParticleSystem");c(this,"type","NeedleParticleSubEmitter");c(this,"emitterType");c(this,"emitterProbability");c(this,"q_",new ie);c(this,"v_",new w);c(this,"v2_",new w);c(this,"_emitterMatrix",new ae);c(this,"_circularBuffer");this.system=t,this.particleSystem=e,this.subSystem=i,this.subParticleSystem=s,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const r=1e3;this._circularBuffer=new _o(()=>new ae,r)}clone(){throw new Error("Method not implemented.")}initialize(t){t.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===Qy.Birth&&this.run(t)}update(t,e){this.run(t)}frameUpdate(t){}toJSON(){}reset(){}run(t){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!t.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const e=this.system.deltaTime;if(this.emitterType===Qy.Death){let s=t.life;if(t[Hd]!==void 0&&(s=t[Hd]),!(t.age+e*1.2>=s))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;t.emissionState.waitEmiting=o}const i=new ae;i.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1),this.particleSystem.worldSpace||i.multiplyMatrices(this._emitterMatrix,i),this.subParticleSystem.emit(e,t.emissionState,i)}}var bX=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class _b extends ns{constructor(){super(...arguments);c(this,"granularity",new me(10))}get typeName(){return"PixelationEffect"}onCreateEffect(){const e=new pk;return this.granularity.onValueChanged=i=>{e.granularity=i},e}}bX([A(me)],_b.prototype,"granularity",void 0);ra("PixelationEffect",_b);class fm extends re{constructor(){super(...arguments);c(this,"_didAssignPlayerColor",!1);c(this,"tryAssignColor",()=>{const e=Q.getComponentInParent(this.gameObject,Jn);if(e&&e.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(e.owner),!0;const i=Q.getComponentInParent(this.gameObject,bn);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(Qe.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(Qe.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield X6(.2),!this.tryAssignColor()););}assignUserColor(e){const i=fm.hashCode(e),s=fm.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(s,e,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(s,e,o)}}assignColor(e,i,s){let r=s.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,s.material=r),r.color=e)}static hashCode(e){var i=0,s,r;if(e.length===0)return i;for(s=0;s<e.length;s++)r=e.charCodeAt(s),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(e){const i=(e&16711680)>>16,s=(e&65280)>>8,r=e&255;return new be(i/255,s/255,r/255)}}new Mu(-1,1,1,-1,0,1);class _X extends Ht{constructor(){super(),this.setAttribute("position",new cn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new cn([0,2,0,0,2,0],2))}}new _X;const $m=new Ht;$m.setAttribute("position",new Ke(new Float32Array([-1,-1,3,-1,-1,3]),2));$m.setAttribute("uv",new Ke(new Float32Array([0,0,2,0,0,2]),2));$m.boundingSphere=new uc;$m.computeBoundingSphere=function(){};const wX=new Mu;class Qh{constructor(t){this._mesh=new J($m,t),this._mesh.frustumCulled=!1}render(t){t.render(this._mesh,wX)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const xX={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new ae},viewMat:{value:new ae},projViewMat:{value:new ae},projectionMatrixInv:{value:new ae},viewMatrixInv:{value:new ae},cameraPos:{value:new w},resolution:{value:new oe},biasAdjustment:{value:new oe},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform vec2 biasAdjustment;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      /*return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);*/
       #ifdef ORTHO

       return linearize_depth_ortho(d, nearZ, farZ);

        #else
        return linearize_depth(linDepth, nearZ, farZ);
        #endif
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
        #endif
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mediump mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ( noise.r * 3.1415962 * 2.0) ;

      mediump float occluded = 0.0;
      mediump float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      bias = biasAdjustment.x + biasAdjustment.y * bias;
      mediump float offsetMove = noise.g;
      mediump float offsetMoveInv = 1.0 / FSAMPLES;
      float farTimesNear = far * near;
      float farMinusNear = far - near;
      
      for(int i = 0; i < SAMPLES; i++) {
        mediump vec3 sampleDirection = tbn * samples[i];

        float moveAmt = fract(offsetMove);
        offsetMove += offsetMoveInv;
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        if (all(greaterThan(offset.xyz * (1.0 - offset.xyz), vec3(0.0)))) {
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          /*#ifdef LOGDEPTH
          float distSample = linearize_depth_log(sampleDepth, near, far);
      #else
          #ifdef ORTHO
              float distSample = near + farMinusNear * sampleDepth;
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif*/
      #ifdef ORTHO
          float distSample = near + sampleDepth * farMinusNear;
      #else
          #ifdef LOGDEPTH
              float distSample = linearize_depth_log(sampleDepth, near, far);
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif
      
      #ifdef ORTHO
          float distWorld = near + offset.z * farMinusNear;
      #else
          float distWorld = (farTimesNear) / (far - offset.z * farMinusNear);
      #endif
          
          mediump float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
          occluded += rangeCheck * float(distSample != distWorld) * float(sampleDepth != depth) * step(distSample + bias, distWorld) * step(
            1.0,
            dot(diff, diff)
          );
          
          totalWeight ++;
        }
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},CX={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new ae},viewMat:{value:new ae},projectionMatrixInv:{value:new ae},viewMatrixInv:{value:new ae},cameraPos:{value:new w},resolution:{value:new oe},color:{value:new w(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0},aoTones:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform float aoTones;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          #ifndef ORTHO
            return getWorldPosLog(vec3(coord, depth));
          #endif
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        if (aoTones > 0.0) {
            finalAo = ceil(finalAo * aoTones) / aoTones;
        }
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = sRGBTransferOETF(gl_FragColor);
        }
    }
    `},SX={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new ae},viewMat:{value:new ae},projectionMatrixInv:{value:new ae},viewMatrixInv:{value:new ae},cameraPos:{value:new w},resolution:{value:new oe},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
      #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
      #endif
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;

        float invDistance = (1.0 / distanceFalloffToUse);
        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = float(dSample != 1.0) * exp(-1.0 * tangentPlaneDist * invDistance ) * max(dot(normal, normalSample), 0.0);
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},EX={uniforms:{sceneDepth:{value:null},resolution:{value:new oe},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new ae},projectionMatrixInv:{value:new ae},logDepth:{value:!1},ortho:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform bool ortho;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth && !ortho) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var $2="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";const IX=Uint8Array.from(atob($2),n=>n.charCodeAt(0));function eL(n,t,e){if(t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)){const r=t.getQueryParameter(n,t.QUERY_RESULT)/1e6;e.lastTime=e.lastTime===0?r:e.timeRollingAverage*e.lastTime+(1-e.timeRollingAverage)*r}else setTimeout(()=>{eL(n,t,e)},1)}class tL extends Tn{constructor(t,e,i=512,s=512){super(),this.width=i,this.height=s,this.clear=!0,this.camera=e,this.scene=t,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,aoTones:0,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,biasOffset:0,biasMultiplier:0,color:new be(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(r,o,a)=>{const l=r[o];return r[o]=a,a.equals?a.equals(l)||this.firstFrame():l!==a&&this.firstFrame(),o==="aoSamples"&&l!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="denoiseSamples"&&l!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="halfRes"&&l!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&l!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="gammaCorrection"&&(this.autosetGamma=!1),o==="transparencyAware"&&l!==a&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new ae,this.lastProjectionMatrix=new ae,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new Qh(new $e({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new Et(this.width,this.height,{minFilter:Mt,magFilter:Mt,depthBuffer:!1,format:Wi}),this.readTargetInternal=new Et(this.width,this.height,{minFilter:Mt,magFilter:Mt,depthBuffer:!1,format:Wi}),this.outputTargetInternal=new Et(this.width,this.height,{minFilter:Mt,magFilter:Mt,depthBuffer:!1}),this.accumulationRenderTarget=new Et(this.width,this.height,{minFilter:Mt,magFilter:Mt,depthBuffer:!1,format:Wi,type:Zn,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new Qh(new $e({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new Uf(IX,128,128),this.bluenoise.colorSpace=xu,this.bluenoise.wrapS=nc,this.bluenoise.wrapT=nc,this.bluenoise.minFilter=mi,this.bluenoise.magFilter=mi,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.timeRollingAverage=.99,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new oe,this._c=new be}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new Et(this.width/2,this.height/2,{count:2}),this.depthDownsampleTarget.textures[0].format=qc,this.depthDownsampleTarget.textures[0].type=mo,this.depthDownsampleTarget.textures[0].minFilter=mi,this.depthDownsampleTarget.textures[0].magFilter=mi,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=Wi,this.depthDownsampleTarget.textures[1].type=Zn,this.depthDownsampleTarget.textures[1].minFilter=mi,this.depthDownsampleTarget.textures[1].magFilter=mi,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new Qh(new $e(EX))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let t=!1;this.scene.traverse(e=>{e.material&&e.material.transparent&&(t=!0)}),t&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new Et(this.width,this.height,{minFilter:Mt,magFilter:mi,type:Zn,format:Wi}),this.transparencyRenderTargetDWTrue=new Et(this.width,this.height,{minFilter:Mt,magFilter:mi,type:Zn,format:Wi}),this.transparencyRenderTargetDWTrue.depthTexture=new RC(this.width,this.height,yP),this.depthCopyPass=new Qh(new $e({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(t){const e=this.scene.background,i=t.getClearColor(new be),s=t.getClearAlpha(),r=new Map,o=t.autoClearDepth;this.scene.traverse(a=>{r.set(a,a.visible)}),this.scene.background=null,t.autoClearDepth=!1,t.setClearColor(new be(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,t.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&(a.material.transparent&&!a.material.depthWrite&&!a.userData.treatAsOpaque||!!a.userData.cannotReceiveAO))}),t.clear(!0,!0,!0),this.depthCopyPass.render(t),t.render(this.scene,this.camera),t.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&a.material.depthWrite&&!a.userData.treatAsOpaque)}),t.clear(!0,!0,!0),this.depthCopyPass.render(t),t.render(this.scene,this.camera),this.scene.traverse(a=>{a.visible=r.get(a)}),t.setClearColor(i,s),this.scene.background=e,t.autoClearDepth=o}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)}configureAOPass(t=!1,e=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const i={...xX};i.fragmentShader=i.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),t&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),e&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.configuration.halfRes&&(i.fragmentShader=`#define HALFRES
`+i.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new $e(i)):this.effectShaderQuad=new Qh(new $e(i))}configureDenoisePass(t=!1,e=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const i={...SX};i.fragmentShader=i.fragmentShader.replace("16",this.configuration.denoiseSamples),t&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),e&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new $e(i)):this.poissonBlurQuad=new Qh(new $e(i))}configureEffectCompositer(t=!1,e=!1){this.firstFrame();const i={...CX};t&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),e&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(i.fragmentShader=`#define HALFRES
`+i.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new $e(i)):this.effectCompositerQuad=new Qh(new $e(i))}generateHemisphereSamples(t){const e=[];for(let i=0;i<t;i++){const s=2.399963*i,r=Math.sqrt(i+.5)/Math.sqrt(t),o=r*Math.cos(s),a=r*Math.sin(s),l=Math.sqrt(1-(o*o+a*a));e.push(new w(o,a,l))}return e}generateDenoiseSamples(t,e){const i=2*Math.PI*e/t,s=1/t,r=s,o=[];let a=s,l=0;for(let h=0;h<t;h++)o.push(new oe(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(a,.75))),a+=r,l+=i;return o}setSize(t,e){this.firstFrame(),this.width=t,this.height=e;const i=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(t*i,e*i),this.readTargetInternal.setSize(t*i,e*i),this.accumulationRenderTarget.setSize(t*i,e*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(t*i,e*i),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(t,e),this.transparencyRenderTargetDWTrue.setSize(t,e)),this.outputTargetInternal.setSize(t,e)}setDepthTexture(t){this.depthTexture=t}firstFrame(){this.needsFrame=!0}render(t,e,i){const s=t.xr.enabled;t.xr.enabled=!1,t.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=t.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)),this.detectTransparency(),(e.texture.type!==this.outputTargetInternal.texture.type||e.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=e.texture.type,this.outputTargetInternal.texture.format=e.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(this.configuration.accumulate&&(t.setRenderTarget(this.accumulationRenderTarget),t.clear(!0,!0,!0)),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let r,o,a;this.debugMode&&(r=t.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a)),this.configuration.transparencyAware&&this.renderTransparency(t),this._r.set(this.width,this.height);let l=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(l*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(t.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.depthDownsampleQuad.render(t)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=e.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.effectShaderQuad.material.uniforms.biasAdjustment.value=new oe(this.configuration.biasOffset,this.configuration.biasMultiplier),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=l,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=t.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,t.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(t);for(let u=0;u<this.configuration.denoiseIterations;u++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=l,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=u,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=t.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,t.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(t);t.setRenderTarget(this.accumulationRenderTarget);const h=t.autoClear;t.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(t),t.autoClear=h}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=e.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.aoTones.value=this.configuration.aoTones,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=t.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=l,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),t.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(t),t.setRenderTarget(this.renderToScreen?null:i),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(t),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),eL(a,r,this)),t.xr.enabled=s}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(t){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(t)}setQualityMode(t){t==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):t==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):t==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):t==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):t==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob($2),n=>n.charCodeAt(0));var iL=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class wb extends ns{constructor(){super(...arguments);c(this,"_effect")}get typeName(){return"Sharpening"}onCreateEffect(){return this.effect}get effect(){return this._effect??(this._effect=new nL),this._effect}set amount(e){this.effect.uniforms.get("amount").value=e}get amount(){return this.effect.uniforms.get("amount").value}set radius(e){this.effect.uniforms.get("radius").value=e}get radius(){return this.effect.uniforms.get("radius").value}}iL([A()],wb.prototype,"amount",null);iL([A()],wb.prototype,"radius",null);const TX=`
  void mainSupport() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,RX=`
uniform sampler2D tDiffuse;
uniform float amount;
uniform float radius;

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    float tx = 1.0 / resolution.x;
    float ty = 1.0 / resolution.y;
    vec2 texelSize = vec2(tx, ty);

    vec4 blurred = vec4(0.0);
    float total = 0.0;

    for (float x = -radius; x <= radius; x++) {
        for (float y = -radius; y <= radius; y++) {
            vec2 offset = vec2(x, y) * texelSize;
            vec4 diffuse = texture2D(tDiffuse, uv + offset);
            float weight = exp(-length(offset) * amount);
            blurred += diffuse * weight;
            total += weight;
        }
    }

    if (total > 0.0) {
        blurred /= total;
    }

    // Calculate the sharpened color using inputColor
    vec4 sharp = inputColor + clamp(inputColor - blurred, 0.0, 1.0) * amount;
    // Keep original alpha
    sharp.a = inputColor.a;

    // Ensure the sharp color does not go below 0 or above 1
    // This means: sharpening must happen AFTER tonemapping.
    sharp = clamp(sharp, 0.0, 1.0);

    outputColor = sharp;
}

`;class nL extends Xs{constructor(){super("Sharpening",RX,{vertexShader:TX,blendFunction:Je.NORMAL,uniforms:new Map([["amount",new $(1)],["radius",new $(1)]])})}}const jh=z("debugpost"),Sw=Symbol("needle:postprocessing-handler"),Ew=Symbol("needle:previous-autoclear-state");class zE{constructor(t){c(this,"_composer",null);c(this,"_lastVolumeComponents");c(this,"_effects",[]);c(this,"_isActive",!1);c(this,"context");this.context=t}get isActive(){return this._isActive}get composer(){return this._composer}apply(t){this._isActive=!0,this.onApply(this.context,t)}unapply(){var i;if(jh&&console.log("Unapplying postprocessing effects"),this._isActive=!1,this._lastVolumeComponents){for(const s of this._lastVolumeComponents)s.unapply();this._lastVolumeComponents.length=0}const t=this.context;t[Sw]===this&&delete t[Sw],t.composer===this._composer&&((i=t.composer)==null||i.dispose(),t.composer=null),typeof t.renderer[Ew]=="boolean"&&(t.renderer.autoClear=t.renderer[Ew])}dispose(){this.unapply();for(const t of this._effects)t.dispose();this._effects.length=0,this._composer=null}onApply(t,e){if(!e)return;t[Sw]=this,jh&&console.log("Apply Postprocessing Effects",e),this._lastVolumeComponents=[...e],this._effects.length=0;const i={handler:this,components:this._lastVolumeComponents};for(let s=0;s<this._lastVolumeComponents.length;s++){const r=this._lastVolumeComponents[s];if(r.context=t,r.apply){if(r.active){if(!t.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const o=r.apply(i);if(!o)continue;Array.isArray(o)?this._effects.push(...o):this._effects.push(o)}}else r.active&&qt("Volume component is not a VolumeComponent: "+r.__type)}if(this.context.renderer.toneMapping!=Cf&&!this._effects.find(s=>s instanceof ny)){const s=new ny;this._effects.push(s)}this.applyEffects(t)}applyEffects(t){const e=this._effects;if(e.length<=0)return;const i=t.mainCameraComponent,s=t.renderer,r=t.scene,o=i.cam;s[Ew]=s.autoClear;const a=s.capabilities.maxSamples;this._composer||(this._composer=new mS(s,{frameBufferType:Zn,stencilBuffer:!0,multisampling:Math.min(dc()?4:8,a)})),t.composer&&t.composer!==this._composer&&console.warn("There's already an active EffectComposer in your scene: replacing it with a new one. This might cause unexpected behaviour. Make sure to only use one PostprocessingManager/Volume in your scene."),t.composer=this._composer;const l=t.composer;l.setMainCamera(o),l.setRenderer(s),l.setMainScene(r);for(const u of l.passes)u.dispose();l.removeAllPasses();const h=new x0(r,o);h.name="Render To Screen",h.mainScene=r,l.addPass(h);try{this.orderEffects();const u=[];for(const d of e)if(d instanceof Xs)u.push(d);else if(d instanceof Tn){const f=new eI(o,...u);f.mainScene=r,f.name=u.map(p=>p.constructor.name).join(", "),f.enabled=!0,u.length=0,l.addPass(d)}if(u.length>0){const d=new eI(o,...u);d.name=u.map(f=>f.name).join(" "),d.mainScene=r,d.enabled=!0,l.addPass(d)}}catch(u){console.error("Error while applying postprocessing effects",u),l.removeAllPasses()}jh&&console.log("PostProcessing Passes",e,"->",l.passes)}orderEffects(){var e;jh&&console.log("Before ordering effects",[...this._effects]);const t=this._effects;t.sort((i,s)=>{const r=GB.findIndex(a=>i.constructor.name.endsWith(a.name)),o=GB.findIndex(a=>s.constructor.name.endsWith(a.name));return r<0?(jh&&console.warn("Unknown effect found: ",i.constructor.name),-1):o<0?(jh&&console.warn("Unknown effect found: ",s.constructor.name),1):r<0?1:o<0?-1:r-o}),jh&&console.log("After ordering effects",[...this._effects]);for(let i=0;i<t.length;i++){const s=t[i];if(((e=s==null?void 0:s.configuration)==null?void 0:e.gammaCorrection)!==void 0){const r=i===t.length-1;s.configuration.gammaCorrection=r}}}}const GB=[bk,bS,mk,Ak,tL,vk,dk,ck,vS,gk,yk,pk,ny,fk,lk,nL];async function QE(n){const{NeedleEngineHTMLElement:t}=await hh(()=>Promise.resolve().then(()=>CY),void 0,import.meta.url);t.observedAttributes.includes(n)||t.observedAttributes.push(n)}var eA=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const lo=z("debugskybox");QE("skybox-image");QE("environment-image");function HB(n,t,e,i,s){const r=new cc;r.allowDrop=!1,r.allowNetworking=!1,r.background=e,r.environment=i,Q.addComponent(n.scene,r);const o=a=>{typeof a=="string"&&(lo&&console.log(s,"CHANGED TO",a),r.setSkybox(a))};return vU(n.domElement,s,o),r.addEventListener("destroy",()=>{lo&&console.log("Destroyed attribute remote skybox",s),yU(n.domElement,s,o)}),r.setSkybox(t)}xt.addContextCreatedCallback(n=>{var r;const t=n.context,e=t.domElement.getAttribute("skybox-image")||t.domElement.getAttribute("background-image"),i=t.domElement.getAttribute("environment-image"),s=new Array;if(e){lo&&console.log("Creating remote skybox to load "+e),((r=t.mainCameraComponent)==null?void 0:r.clearFlags)!==hr.Skybox&&console.warn('"skybox-image"/"background-image" attribute has no effect: camera clearflags are not set to "Skybox"');const o=HB(t,e,!0,!1,"skybox-image");s.push(o)}if(i){lo&&console.log("Creating remote environment to load "+i);const o=HB(t,i,!1,!0,"environment-image");s.push(o)}return s.length>0?QC(s):Promise.resolve()});function sL(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function VB(n){const e=sL().find(i=>i.src===n);return e?(lo&&console.log("Skybox: Found previously loaded texture for "+n),e.texture):null}async function BX(n){const t=await n;HD(t,!0),ii(t)}function PX(n,t){const e=sL();for(;e.length>5;){const i=e.shift();i&&BX(i.texture)}t.then(i=>HD(i,!1)),e.push({src:n,texture:t})}class cc extends re{constructor(){super(...arguments);c(this,"url");c(this,"allowDrop",!0);c(this,"background",!0);c(this,"environment",!0);c(this,"allowNetworking",!0);c(this,"_loader");c(this,"_prevUrl");c(this,"_prevLoadedEnvironment");c(this,"_prevEnvironment",null);c(this,"_prevBackground",null);c(this,"validTextureTypes",[".hdr",".exr",".jpg",".jpeg",".png"]);c(this,"onDragOverEvent",e=>{if(this.allowDrop&&e.dataTransfer)for(const i of e.dataTransfer.types)(i==="text/uri-list"||i==="Files")&&e.preventDefault()});c(this,"onDrop",e=>{var i,s,r,o;if(this.allowDrop&&e.dataTransfer){for(const a of e.dataTransfer.types)if(lo&&console.log(a),a==="text/uri-list"){const l=e.dataTransfer.getData(a);lo&&console.log(a,l);let h=(s=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:s.name;if(h||(h=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:r.groups)==null?void 0:o.name),lo&&console.log(h),h){const u="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+h+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${u}`),e.preventDefault(),this.setSkybox(u);break}else if(this.isValidTextureType(l)){console.log("[Remote Skybox] Setting skybox from url: "+l),e.preventDefault(),this.setSkybox(l);break}else{console.warn(`[RemoteSkybox] Unknown url ${l}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const u=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:e,url:l,apply:d=>{e.preventDefault(),this.setSkybox(d)}}});this.dispatchEvent(u)}}else if(a=="Files"){const l=e.dataTransfer.files.item(0);if(lo&&console.log(a,l),!l)continue;if(!this.isValidTextureType(l.name)){console.warn(`[RemoteSkybox]: File "${l.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(VB(l.name)===null){const h=new Blob([l]),u=URL.createObjectURL(h);e.preventDefault(),this.setSkybox(u,l.name)}else e.preventDefault(),this.setSkybox(l.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var e;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Bt.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(e=this.context.mainCameraComponent)==null||e.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(e,i){var o;if(!this.activeAndEnabled||(e=MX(e,this.environment,this.background),!e))return!1;if(i??(i=e),this.isValidTextureType(i)||console.warn("Potentially invalid skybox url",i,"on",this.name),lo&&console.log("Set remote skybox url: "+e),this._prevUrl===e&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(o=this._prevLoadedEnvironment)==null||o.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=e;const s=await this.loadTexture(e,i);if(!s||!this.enabled)return!1;this.url=e;const r=e.lastIndexOf("/");return s.name=e.substring(r>=0?r+1:0),this._loader instanceof Xa&&(s.colorSpace=Ge),this._prevLoadedEnvironment=s,this.applySkybox(),!0}async loadTexture(e,i){var h,u,d,f,p;if(!e)return Promise.resolve(null);i??(i=e);const s=VB(i);if(s){const g=await s;if(((u=(h=g.source)==null?void 0:h.data)==null?void 0:u.length)>0||(p=(f=(d=g.source)==null?void 0:d.data)==null?void 0:f.data)!=null&&p.length)return g}const r=i.endsWith(".exr"),o=i.endsWith(".hdr");r?this._loader instanceof om||(this._loader=new om):o?this._loader instanceof py||(this._loader=new py):this._loader instanceof Xa||(this._loader=new Xa),lo&&console.log("Loading skybox: "+e);const a=this._loader.loadAsync(e);return PX(i,a),await a}applySkybox(){var i;const e=this._prevLoadedEnvironment;e&&(e.mapping=sU,e.needsUpdate=!0,this.context.scene.background!==e&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==e&&(this._prevEnvironment=this.context.scene.environment),lo&&console.log("Set remote skybox",this.url,!Bt.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=e),this.background&&!Bt.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=e),((i=this.context.mainCameraComponent)==null?void 0:i.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(e){return e.startsWith("http://")||e.startsWith("https://")}isValidTextureType(e){for(const i of this.validTextureTypes)if(e.endsWith(i))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}eA([s2(cc.prototype.urlChangedSyncField),A(URL)],cc.prototype,"url",void 0);eA([A()],cc.prototype,"allowDrop",void 0);eA([A()],cc.prototype,"background",void 0);eA([A()],cc.prototype,"environment",void 0);eA([A()],cc.prototype,"allowNetworking",void 0);function MX(n,t,e){const i=t&&!e;switch(n==null?void 0:n.toLowerCase()){case"studio":return i?"https://cdn.needle.tools/static/skybox/modelviewer-Neutral-small.hdr":"https://cdn.needle.tools/static/skybox/modelviewer-Neutral.hdr";case"blurred-skybox":return i?"https://cdn.needle.tools/static/skybox/blurred-skybox-small.exr":"https://cdn.needle.tools/static/skybox/blurred-skybox.exr";case"quicklook-ar":return i?"https://cdn.needle.tools/static/skybox/QuickLook-ARMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ARMode.exr";case"quicklook":return i?"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode.exr"}return n===void 0?null:n}var Rs=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const lr=z("debugsceneswitcher"),kX=z("sceneswitcher:clearscene"),Qv="scene";QE(Qv);const kc=Promise.resolve(!1);class Pn extends re{constructor(){super(...arguments);c(this,"autoLoadFirstScene",!0);c(this,"scenes",[]);c(this,"loadingScene");c(this,"queryParameterName","scene");c(this,"useSceneName",!0);c(this,"clamp",!0);c(this,"useHistory",!0);c(this,"useKeyboard",!0);c(this,"useSwipe",!0);c(this,"useSceneLighting",!0);c(this,"useSceneBackground",!0);c(this,"preloadNext",1);c(this,"preloadPrevious",1);c(this,"preloadConcurrent",2);c(this,"createMenuButtons",!1);c(this,"sceneLoaded",new $t);c(this,"_currentIndex",-1);c(this,"_currentScene");c(this,"_engineElementOverserver");c(this,"_preloadScheduler");c(this,"_menuButtons");c(this,"onPopState",async e=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let s=!1;if(this.queryParameterName&&(s=await this.tryLoadFromQueryParam()),!s){const r=e==null?void 0:e.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);lr&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}});c(this,"normalizedSwipeThresholdX",.1);c(this,"_didSwipe",!1);c(this,"onInputPointerMove",e=>{if(this.useSwipe&&!this._didSwipe&&e.button===0&&e.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(e.button);if(i){const s=i.x/this.context.domWidth;s>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):s<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}});c(this,"onInputPointerUp",e=>{e.button===0&&(this._didSwipe=!1)});c(this,"onInputKeyDown",e=>{if(!this.useKeyboard||!this.scenes)return;const i=e.key.toLowerCase();if(!i)return;const s=parseInt(i)-1;if(s>=0){this.trySelectSceneFromValue(s);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}});c(this,"__lastSwitchScene");c(this,"__lastSwitchScenePromise");c(this,"_currentlyLoadingScene");c(this,"_lastLoadingScene");c(this,"_loadingScenePromise");c(this,"_isCurrentlyLoading",!1);c(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]);for(const e of this.scenes)e&&!e.hasUrl&&e.asset instanceof ne&&e.asset.removeFromParent();lr&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(ft.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(ft.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(ft.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(e=>{for(const i of e)if(i.type==="attributes"&&i.attributeName===Qv){const s=this.context.domElement.getAttribute(Qv);s!==null&&this.trySelectSceneFromValue(s)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new DX(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const e=this.context.domElement.getAttribute(Qv);try{(e===null||!await this.trySelectSceneFromValue(e))&&this._currentIndex===-1&&this.select(0)}finally{}}this.createMenuButtons&&(this._menuButtons??(this._menuButtons=[]),this._menuButtons.push(this.context.menu.appendChild({label:"Previous",icon:"arrow_back_ios",onClick:()=>this.selectPrev(),priority:-1005,class:"row2"})),this._menuButtons.push(this.context.menu.appendChild({label:"Next",icon:"arrow_forward_ios",iconSide:"right",onClick:()=>this.selectNext(),priority:-1e3,class:"row2"})))}onDisable(){var e;if(globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(ft.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(ft.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(ft.PointerUp,this.onInputPointerUp),(e=this._preloadScheduler)==null||e.stop(),this._menuButtons){for(const i of this._menuButtons)i.remove();this._menuButtons=void 0}}addScene(e){if(typeof e=="string"){let i=this.context.addressables.findAssetReference(e);return i||(i=new et(e),this.context.addressables.registerAssetReference(i)),this.scenes.push(i),i}return this.scenes.push(e),e}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(e){var s,r,o;if(lr&&console.log("select",e),typeof e=="object"&&console.warn('Switching to "'+e+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof e=="string"){const a=(s=this.scenes)==null?void 0:s.find(l=>l.uri===e);if(!a){const l=et.getOrCreate(this.sourceId??"",e,this.context);return this.switchScene(l)}if(a)e=(r=this.scenes)==null?void 0:r.indexOf(a);else return kc}if(!((o=this.scenes)!=null&&o.length))return kc;if(e<0){if(this.clamp)return kc;e=this.scenes.length-1}else if(e>=this.scenes.length){if(this.clamp)return kc;e=0}const i=this.scenes[e];return this.switchScene(i)}async switchScene(e){if(!(e instanceof et)){const s=typeof e;return s==="string"?this.select(e):s==="number"?this.select(e):(console.warn("SceneSwitcher: Can't switch to scene",e,"of type",s),!1)}return e.uri===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===e&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=e,this.__lastSwitchScenePromise=this.__internalSwitchScene(e),await this.__lastSwitchScenePromise)}async __internalSwitchScene(e){var s,r,o,a;if(this._currentScene){lr&&console.log("UNLOAD",this._currentScene.url,"HasURL?: "+this._currentScene.hasUrl);const l=this.tryGetSceneEventListener(this._currentScene.asset);if(l!=null&&l.sceneClosing){const h=l.sceneClosing();h instanceof Promise&&await h}this._currentScene.hasUrl?this._currentScene.unload():this._currentScene.asset instanceof ne&&this._currentScene.asset.removeFromParent()}this._currentScene=void 0;const i=this._currentIndex=((s=this.scenes)==null?void 0:s.indexOf(e))??-1;try{this._currentlyLoadingScene=e,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const l=new CustomEvent("loadscene-start",{detail:{scene:e,switcher:this,index:i}});this.dispatchEvent(l),await this.onStartLoading(),await e.loadAssetAsync((u,d)=>{this._currentLoadingProgress=d,this.dispatchEvent(d)}).catch(console.error),await this.onEndLoading();const h=new CustomEvent("loadscene-finished",{detail:{scene:e,switcher:this,index:i}});if(this.dispatchEvent(h),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,h.defaultPrevented)return lr&&console.warn("Adding loaded scene prevented:",e,h),!1;if(!e.asset)return lr&&console.warn("Failed loading scene:",e),!1;if(this._currentIndex===i){if(lr&&console.log("ADD",e.uri),this._currentScene=e,kX){const f=((r=this.context.mainCameraComponent)==null?void 0:r.gameObject)||this.context.mainCamera;f==null||f.removeFromParent();const p=this.gameObject.removeFromParent();wo(this.context.scene,!0,!0),this.context.scene=new ws,this.context.scene.add(p),f&&this.context.scene.add(f)}if(Q.add(e.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(e),this.useSceneBackground){const f=this.context.lightmaps.tryGetSkybox(e.url);f?(f.mapping=Ya,this.context.scene.background=f):lr&&console.warn("SceneSwitcher: Can't find skybox for scene "+e.url)}if(this.useHistory&&i>=0){let f=i.toString();if(this.useSceneName&&(f=WB(e.uri)),(o=this.queryParameterName)!=null&&o.length)Gw(this.queryParameterName,f,this.useHistory);else{const p=history.state,g=this.guid+"::"+i;p!==g&&history.pushState(g,"unused",location.href)}}const u=this.tryGetSceneEventListener(e.asset);if(u!=null&&u.sceneOpened){const f=u.sceneOpened(this);f instanceof Promise&&await f}const d=new CustomEvent("scene-opened",{detail:{scene:e,switcher:this,index:i}});return this.dispatchEvent(d),(a=this.sceneLoaded)==null||a.invoke(this),!0}}catch(l){console.error(l)}return!1}preload(e){if(e>=0&&e<this.scenes.length){const i=this.scenes[e];if(i instanceof et)return i.preload()}return kc}tryLoadFromQueryParam(){var i;if(!((i=this.queryParameterName)!=null&&i.length))return kc;const e=z(this.queryParameterName);return typeof e=="boolean"?kc:this.trySelectSceneFromValue(e)}trySelectSceneFromValue(e){if(typeof e=="string"){const i=parseInt(e);if(i>=0&&i<this.scenes.length)return this.select(i);{const s=e.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&WB(o.uri).toLowerCase().includes(s))return this.select(r)}}}else if(typeof e=="number"&&e>=0&&e<this.scenes.length)return this.select(e);return fr()&&console.warn('Can not find scene: "'+e+'"',this),kc}async onStartLoading(){var e,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(e=this.loadingScene)==null?void 0:e.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&((i=this.loadingScene)!=null&&i.asset))){lr&&console.log("Add loading scene",this.loadingScene.uri,this.loadingScene.asset);const s=this.loadingScene.asset;Q.add(s,this.gameObject);const r=this.tryGetSceneEventListener(s);if(r!=null&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}if(this._isCurrentlyLoading){const s=this.tryGetSceneEventListener(this.gameObject);if(s&&s.sceneOpened){const r=s.sceneOpened(this);r instanceof Promise&&await r}}}async onEndLoading(){var e;if(this._isCurrentlyLoading=!1,(e=this.loadingScene)!=null&&e.asset){lr&&console.log("Remove loading scene",this.loadingScene.uri);const i=this.loadingScene.asset,s=this.tryGetSceneEventListener(i);if(typeof(s==null?void 0:s.sceneClosing)=="function"){const r=s.sceneClosing();r instanceof Promise&&await r}Q.remove(i)}if(!this._isCurrentlyLoading){const i=this.tryGetSceneEventListener(this.gameObject);if(i&&i.sceneClosing){const s=i.sceneClosing();s instanceof Promise&&await s}}}tryGetSceneEventListener(e,i=0){const s=Q.foreachComponent(e,r=>{const o=r;if(o.sceneClosing||o.sceneOpened)return o});if(i===0&&!s&&e.children.length)for(const r of e.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return s||null}}Rs([A()],Pn.prototype,"autoLoadFirstScene",void 0);Rs([A(et)],Pn.prototype,"scenes",void 0);Rs([A(et)],Pn.prototype,"loadingScene",void 0);Rs([A()],Pn.prototype,"queryParameterName",void 0);Rs([A()],Pn.prototype,"useSceneName",void 0);Rs([A()],Pn.prototype,"clamp",void 0);Rs([A()],Pn.prototype,"useHistory",void 0);Rs([A()],Pn.prototype,"useKeyboard",void 0);Rs([A()],Pn.prototype,"useSwipe",void 0);Rs([A()],Pn.prototype,"useSceneLighting",void 0);Rs([A()],Pn.prototype,"useSceneBackground",void 0);Rs([A()],Pn.prototype,"preloadNext",void 0);Rs([A()],Pn.prototype,"preloadPrevious",void 0);Rs([A()],Pn.prototype,"preloadConcurrent",void 0);Rs([A()],Pn.prototype,"createMenuButtons",void 0);Rs([A($t)],Pn.prototype,"sceneLoaded",void 0);function WB(n){const t=n.split("/").pop(),e=t==null?void 0:t.split(".").shift();return e!=null&&e.length?e:n}class DX{constructor(t,e=1,i=1,s=2){c(this,"maxLoadAhead");c(this,"maxLoadBehind");c(this,"maxConcurrent");c(this,"_isRunning",!1);c(this,"_switcher");c(this,"_loadTasks",[]);c(this,"_maxConcurrentLoads",1);this._switcher=t,this.maxLoadAhead=e,this.maxLoadBehind=i,this.maxConcurrent=s}begin(){if(this._isRunning)return;lr&&console.log("Preload begin"),this._isRunning=!0;let t=-1,e,i;const s=this._switcher.scenes,r=setInterval(()=>{if(this.allLoaded()&&(lr&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(r);return}if(this.canLoadNewScene()===!1)return;t!==this._switcher.currentIndex&&(t=this._switcher.currentIndex,i=0,e=0);const o=i%2===0;o&&(e+=1),i+=1;const a=o?this.maxLoadAhead:this.maxLoadBehind;if(e>a)return;const l=o?t+e:t-e;if(l<0||l<0||l>=s.length)return;const h=s[l];new OX(l,h,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const t of this._switcher.scenes)if((t==null?void 0:t.isLoaded())===!1)return!1}return!0}}class OX{constructor(t,e,i){c(this,"index");c(this,"asset");c(this,"tasks");this.index=t,this.asset=e,this.tasks=i,i.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(lr&&console.log("Preload start: "+this.asset.uri,this.index),await this.asset.preload(),lr&&console.log("Preload finished: "+this.asset.uri,this.index));const t=this.tasks.indexOf(this);t>=0&&this.tasks.splice(t,1)}}function LX(){return new Promise((n,t)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),n())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function FX(n){await LX(),n()}var Hr=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const gn=z("debugvideo");var Vc;(function(n){n[n.None=0]="None",n[n.AdjustHeight=1]="AdjustHeight",n[n.AdjustWidth=2]="AdjustWidth"})(Vc||(Vc={}));var Bl;(function(n){n[n.VideoClip=0]="VideoClip",n[n.Url=1]="Url"})(Bl||(Bl={}));var Sg;(function(n){n[n.None=0]="None",n[n.AudioSource=1]="AudioSource",n[n.Direct=2]="Direct",n[n.APIOnly=3]="APIOnly"})(Sg||(Sg={}));var Eg;(function(n){n[n.CameraFarPlane=0]="CameraFarPlane",n[n.CameraNearPlane=1]="CameraNearPlane",n[n.RenderTexture=2]="RenderTexture",n[n.MaterialOverride=3]="MaterialOverride"})(Eg||(Eg={}));class In extends re{constructor(){super();c(this,"playOnAwake",!0);c(this,"aspectMode",Vc.None);c(this,"clip",null);c(this,"source",Bl.Url);c(this,"_url",null);c(this,"renderMode");c(this,"targetMaterialProperty");c(this,"targetMaterialRenderer");c(this,"targetTexture");c(this,"time",0);c(this,"_playbackSpeed",1);c(this,"_isLooping",!1);c(this,"_muted",!1);c(this,"_audioOutputMode",Sg.Direct);c(this,"playInBackground",!0);c(this,"_crossOrigin","anonymous");c(this,"_videoElement",null);c(this,"_videoTexture",null);c(this,"_videoMaterial",null);c(this,"_isPlaying",!1);c(this,"wasPlaying",!1);c(this,"visibilityChanged",e=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}});c(this,"_receivedInput",!1);c(this,"_overlay",null);c(this,"_targetObjects");c(this,"_updateAspectRoutineId",-1);c(this,"_hls");c(this,"onHlsAvailable",()=>{var e;gn&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(e=this._videoElement)==null||e.play(),gn&&console.log("HLS: loaded",this.clip))});FX(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],z("videoscreenspace")&&window.addEventListener("keydown",e=>{e.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(e){const s=this._url!==e;this.__didAwake?s&&this.setClipURL(e??""):this._url=e}get playbackSpeed(){var e;return((e=this._videoElement)==null?void 0:e.playbackRate)??this._playbackSpeed}set playbackSpeed(e){this._playbackSpeed=e,this._videoElement&&(this._videoElement.playbackRate=e)}get isLooping(){var e;return((e=this._videoElement)==null?void 0:e.loop)??this._isLooping}set isLooping(e){this._isLooping=e,this._videoElement&&(this._videoElement.loop=e)}get currentTime(){var e;return((e=this._videoElement)==null?void 0:e.currentTime)??this.time}set currentTime(e){this._videoElement?this._videoElement.currentTime=e:this.time=e}get isPlaying(){const e=this._videoElement;if(e){if(e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA)return!0;if(e.srcObject&&e.srcObject.active)return!0}return!1}get crossOrigin(){var e;return((e=this._videoElement)==null?void 0:e.crossOrigin)??this._crossOrigin}set crossOrigin(e){this._crossOrigin=e,this._videoElement&&(e!==null?this._videoElement.setAttribute("crossorigin",e):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}requestPictureInPicture(){return this._videoElement?this._videoElement.requestPictureInPicture():null}get muted(){var e;return((e=this._videoElement)==null?void 0:e.muted)??this._muted}set muted(e){this._muted=e,this._videoElement&&(this._videoElement.muted=e)}get currentVideo(){return this.clip}set audioOutputMode(e){e!==this._audioOutputMode&&(e===Sg.AudioSource&&ve()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=e,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){gn&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(e){this.clip=e,this.source=Bl.VideoClip,this._videoElement?(this._videoElement.srcObject=e,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(e){this._url!==e&&(this._url=e,this.source=Bl.Url,gn&&console.log("set url",e),this._videoElement?e.endsWith(".m3u8")||e.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=e,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var e,i;gn&&console.log("VideoPlayer.onEnable",Bl[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(e=this._overlay)==null||e.start():(i=this._overlay)==null||i.stop()}onDisable(){var e;window.removeEventListener("visibilitychange",this.visibilityChanged),(e=this._overlay)==null||e.stop(),this.pause()}onDestroy(){var e;this._videoElement&&((e=this.videoElement)==null||e.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var e,i;if(this._videoElement||this.create(!1),!this._videoElement){gn&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((e=this._videoElement)!=null&&e.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}gn&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(s=>{var r;console.log(s),gn&&console.error("Error playing video",s,"CODE="+s.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),gn&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),gn&&console.log("STOP",this))}pause(){var e,i;this.time=((e=this._videoElement)==null?void 0:e.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),gn&&console.log("PAUSE",this,this.currentTime)}create(e){let i;switch(this.source){case Bl.VideoClip:i=this.clip;break;case Bl.Url:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(gn&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(gn&&console.log("Set Video src",i),this._videoElement.src=i):(gn&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new rU(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=Ge,e&&this.handleBeginPlaying(e),gn&&console.log("Video: handle playing done...",i,e),!0):(gn&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==Vc.None&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var e;return((e=this._overlay)==null?void 0:e.enabled)??!1}set screenspace(e){var i;if(e){if(!this._videoTexture)return;this._overlay||(this._overlay=new UX(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=e)}createVideoElement(){const e=document.createElement("video");return this._crossOrigin&&e.setAttribute("crossorigin",this._crossOrigin),gn&&console.log("created video element",e),e}handleBeginPlaying(e){var r,o;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let i=this.gameObject;switch(this.renderMode){case Eg.MaterialOverride:i=(r=this.targetMaterialRenderer)==null?void 0:r.gameObject,i||(i=(o=Q.getComponent(this.gameObject,li))==null?void 0:o.gameObject);break;case Eg.RenderTexture:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!i){console.error("Missing target for video material renderer",this.name,Eg[this.renderMode],this);return}const s=i.material;if(s){this._targetObjects.push(i),s!==this._videoMaterial&&(this._videoMaterial=s.clone(),i.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),e&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let e=!this._receivedInput||this.audioOutputMode===Sg.None;!e&&this._muted&&(e=!0),this._videoElement.muted=e,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const e=++this._updateAspectRoutineId,i=void 0,s=this.clip;for(;e===this._updateAspectRoutineId&&this.aspectMode!==Vc.None&&this.clip&&s===this.clip&&this._isPlaying;){if(!s||typeof s=="string")return;let r;for(const o of s.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=ri(o.parent);a=l.x/l.y}switch(this.aspectMode){case Vc.AdjustHeight:o.scale.y=1/r*o.scale.x*a;break;case Vc.AdjustWidth:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===Bl.Url}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let e=document.head.querySelector("script[data-hls_library]");e?globalThis.Hls?this.onHlsAvailable():e.addEventListener("load",this.onHlsAvailable):(gn&&console.log("HLS: load script"),e=document.createElement("script"),e.dataset.hls_library="hls.js",e.src="https://cdn.jsdelivr.net/npm/hls.js@1",e.addEventListener("load",this.onHlsAvailable),document.head.append(e))}}Hr([A()],In.prototype,"playOnAwake",void 0);Hr([A()],In.prototype,"aspectMode",void 0);Hr([A(URL)],In.prototype,"clip",void 0);Hr([A()],In.prototype,"source",void 0);Hr([A(URL)],In.prototype,"url",null);Hr([A()],In.prototype,"renderMode",void 0);Hr([A()],In.prototype,"targetMaterialProperty",void 0);Hr([A(li)],In.prototype,"targetMaterialRenderer",void 0);Hr([A(At)],In.prototype,"targetTexture",void 0);Hr([A()],In.prototype,"time",void 0);Hr([A()],In.prototype,"playbackSpeed",null);Hr([A()],In.prototype,"isLooping",null);Hr([A()],In.prototype,"audioOutputMode",null);class UX{constructor(t){c(this,"context");c(this,"_videos",[]);c(this,"_screenspaceModeQuad");c(this,"_isInScreenspaceMode",!1);c(this,"_input");this.context=t,this._input=new NX(this)}get enabled(){return this._isInScreenspaceMode}set enabled(t){t?this.start():this.stop()}add(t){this._videos.indexOf(t)===-1&&this._videos.push(t)}remove(t){if(!t)return;const e=this._videos.indexOf(t);e>=0&&this._videos.splice(e,1)}start(){var s;if(this._isInScreenspaceMode||this._videos.length<0)return;const t=this._videos[this._videos.length-1];if(!t)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=Fu.createPrimitive(Yo.Quad,{material:new zX(t)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const e=this._screenspaceModeQuad;this.context.scene.add(e),this.updateScreenspaceMaterialUniforms();const i=e.material;i==null||i.reset(),(s=this._input)==null||s.enable(i)}stop(){var t;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((t=this._input)==null||t.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var e;const t=(e=this._screenspaceModeQuad)==null?void 0:e.material;t&&(t.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class NX{constructor(t){c(this,"_onResizeScreenFn");c(this,"_onKeyUpFn");c(this,"_onMouseWheelFn");c(this,"context");c(this,"overlay");c(this,"_material");c(this,"_isPinching",!1);c(this,"_lastPinch",0);this.overlay=t,this.context=t.context}enable(t){this._material=t,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=s=>{s.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=s=>{this.overlay.enabled&&(t.zoom+=s.deltaY*5e-4,s.preventDefault())},{passive:!1});const e=new oe;window.addEventListener("mousemove",s=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const r=new oe(s.movementX,s.movementY);r.x/=this.context.domElement.clientWidth,r.y/=this.context.domElement.clientHeight,e.set(r.x,r.y),e.multiplyScalar(t.zoom/-this.context.time.deltaTime*.01),t.offset=t.offset.add(e)}}),window.addEventListener("pointermove",s=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(e.set(s.movementX,s.movementY),e.multiplyScalar(t.zoom*-this.context.time.deltaTime*.05),t.offset=t.offset.add(e))});let i=0;window.addEventListener("touchstart",s=>{if(s.touches.length<2){this.context.time.time-i<.3&&this.overlay.stop(),i=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",s=>{if(!this._isPinching||!this._material)return;const r=s.touches[0],o=s.touches[1],a=r.clientX-o.clientX,l=r.clientY-o.clientY,h=Math.sqrt(a*a+l*l);if(this._lastPinch!==0){const u=h-this._lastPinch;this._material.zoom-=u*.004}this._lastPinch=h}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class zX extends $e{constructor(e){super();c(this,"_offset",new oe);this.uniforms={map:{value:e},screenAspect:{value:1},offsetScale:{value:new Fe(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(e){this.uniforms.screenAspect.value=e,this.needsUpdate=!0}set offset(e){const i=this.uniforms.offsetScale.value;i.x=e.x,i.y=e.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const e=this.uniforms.offsetScale.value;return this._offset.set(e.x,e.y),this._offset}set zoom(e){const i=this.uniforms.offsetScale.value;e<.001&&(e=.001),i.z=e,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var tA=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const zn=z("debugscreensharing");var AC;(function(n){n[n.Screen=0]="Screen",n[n.Camera=1]="Camera",n[n.Canvas=2]="Canvas",n[n.Microphone=3]="Microphone"})(AC||(AC={}));var Cr;(function(n){n[n.Idle=0]="Idle",n[n.Sending=1]="Sending",n[n.Receiving=2]="Receiving"})(Cr||(Cr={}));class ed extends re{constructor(){super(...arguments);c(this,"allowStartOnClick",!0);c(this,"autoConnect",!1);c(this,"_videoPlayer");c(this,"_audioSource");c(this,"device","Screen");c(this,"deviceName");c(this,"deviceFilter");c(this,"_net");c(this,"_requestOpen",!1);c(this,"_currentStream",null);c(this,"_currentMode",Cr.Idle);c(this,"onJoinedRoom",async()=>{await sc(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()});c(this,"_activeShareRequest",null);c(this,"onReceiveStream",e=>{var i;((i=e.stream)==null?void 0:i.active)===!0&&this.setStream(e.stream,Cr.Receiving)});c(this,"onCallEnded",e=>{zn&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(e){var i;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(e&&e.pointerId!==0)){if(this.isReceiving&&((i=this.videoPlayer)!=null&&i.isPlaying)){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(e){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=e,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var e;return((e=this.videoPlayer)==null?void 0:e.screenspace)??!1}set screenspace(e){this.videoPlayer&&(this.videoPlayer.screenspace=e)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var e;return((e=this._currentStream)==null?void 0:e.active)&&this._currentMode===Cr.Sending}get isReceiving(){if(this._currentMode===Cr.Receiving){if(!this._currentStream||this._currentStream.active===!1)return!1;const e=this._currentStream.getTracks();for(const i of e)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=AC[this.device]),zn&&console.log("Screensharing",this.name,this),kt.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===Cr.Receiving&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))});const e=Ag.getOrCreate(this.context,this.guid);this._net=new X0(this.context,e)}onEnable(){var e,i,s;(e=this._net)==null||e.enable(),(i=this._net)==null||i.addEventListener(Bi.StreamReceived,this.onReceiveStream),(s=this._net)==null||s.addEventListener(Bi.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Qe.JoinedRoom,this.onJoinedRoom),this.autoConnect&&sc(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var e,i,s;(e=this._net)==null||e.removeEventListener(Bi.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(Bi.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Qe.JoinedRoom,this.onJoinedRoom),(s=this._net)==null||s.disable(),this.close()}_ensureVideoPlayer(){const e=new In;e.aspectMode=Vc.AdjustWidth,Q.addComponent(this.gameObject,e),this._videoPlayer=e}async share(e){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(e),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(e){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),ve()&&qt("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(e!=null&&e.device&&(this.device=e.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=Q.getComponent(this.gameObject,In)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=(e==null?void 0:e.constraints)??{echoCancellation:!0,autoGainControl:!1},s={video:i,audio:i},r=s.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(s,e);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(s);this._requestOpen?this.setStream(l,Cr.Sending):Hl(l)}break;case"Canvas":const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,Cr.Sending);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}s.video=!1;const l=await navigator.mediaDevices.getUserMedia(s);this._requestOpen?this.setStream(l,Cr.Sending):Hl(l)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var e;this._requestOpen=!1,this._currentStream&&(zn&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(e=this._net)==null||e.stopSendingStream(this._currentStream),Hl(this._currentStream),this._currentMode=Cr.Idle,this._currentStream=null)}setStream(e,i){var o,a,l;if(e===this._currentStream||(this.close(),!e))return;this._currentStream=e,this._requestOpen=!0,this._currentMode=i;const s=this.device!=="Microphone",r=i===Cr.Sending;s?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(e):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new kt,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),r||(zn&&console.log("PLAY",e.getAudioTracks()),this._audioSource.volume=1,(o=this._audioSource)==null||o.play(e))),r&&((a=this._net)==null||a.startSendingStream(e)),r&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(l=this._audioSource)==null||l.stop());for(const h of e.getTracks())h.addEventListener("ended",()=>{zn&&console.log("Track ended",h),this.close()}),zn&&h.kind==="video"&&console.log(r?"Video â†’":"Video â†",h.getSettings())}async tryShareUserCamera(e,i){const s=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");zn&&console.log(`Request camera. These are your kind:videoinput devices:
`,s);let r=!1;for(const o of s)try{if(!this._requestOpen){zn&&console.log("Camera selection cancelled");break}if(o.kind!=="videoinput"){zn&&console.log("Skipping non-video device",o);continue}const a=o.deviceId;if((i==null?void 0:i.deviceId)!=null||(i==null?void 0:i.deviceFilter)!=null){if((i==null?void 0:i.deviceId)!==void 0&&a!==i.deviceId){zn&&console.log("Skipping device due to options.deviceId: "+o.label+"; "+o.deviceId);continue}if(i!=null&&i.deviceFilter&&i.deviceFilter(o)===!1){zn&&console.log("Skipping device due to options.deviceFilter: "+o.label+"; "+o.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(o)===!1){zn&&console.log("Skipping device due to ScreenShare.deviceFilter: "+o.label+"; "+o.deviceId);continue}else zn&&console.log("Selected device by filter",o);else if(this.deviceName){const u=o.label.toLowerCase(),d=this.deviceName.toLowerCase(),f=u.includes(d),p=o.deviceId===this.deviceName;if(!f&&!p){zn&&console.log("Skipping device due to ScreenShare.deviceName: "+o.label+"; "+o.deviceId);continue}else zn&&console.log("Selected device by name",o)}e.video!==!1&&((typeof e.video>"u"||typeof e.video=="boolean")&&(e.video={}),e.video.deviceId=a),r=!0;const h=await navigator.mediaDevices.getUserMedia(e).catch(u=>(console.error("Failed to get user media",u),null));if(h===null)continue;this._requestOpen?(this.setStream(h,Cr.Sending),zn&&console.log("Selected camera",o)):(Hl(h),zn&&console.log("Camera selection cancelled"));break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){qt("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}!r&&ve()&&(qt("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",s,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+i!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+(i==null?void 0:i.deviceId)!=null,"Using options.deviceFilter? "+(i==null?void 0:i.deviceFilter)!=null))}}tA([A()],ed.prototype,"allowStartOnClick",void 0);tA([A()],ed.prototype,"autoConnect",void 0);tA([A(In)],ed.prototype,"videoPlayer",null);tA([A()],ed.prototype,"device",void 0);tA([A()],ed.prototype,"deviceName",void 0);var iA=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Ih extends ns{constructor(){super(...arguments);c(this,"intensity",new me(2));c(this,"falloff",new me(1));c(this,"samples",new me(9));c(this,"color",new me(new be(0,0,0)));c(this,"luminanceInfluence",new me(.7));c(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof bt){const e=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=e*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const e=this.context.mainCamera,i=new bk(this.context.scene,e),s=new bS({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new Ak(e,i.texture,{normalDepthBuffer:s.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:Je.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new be),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(s),o.push(r),o}}iA([A(me)],Ih.prototype,"intensity",void 0);iA([A(me)],Ih.prototype,"falloff",void 0);iA([A(me)],Ih.prototype,"samples",void 0);iA([A(me)],Ih.prototype,"color",void 0);iA([A(me)],Ih.prototype,"luminanceInfluence",void 0);ra("ScreenSpaceAmbientOcclusion",Ih);var td=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Ig;(function(n){n[n.Performance=0]="Performance",n[n.Low=1]="Low",n[n.Medium=2]="Medium",n[n.High=3]="High",n[n.Ultra=4]="Ultra"})(Ig||(Ig={}));class dl extends ns{constructor(){super(...arguments);c(this,"gammaCorrection",!0);c(this,"aoRadius",new me(1));c(this,"falloff",new me(1));c(this,"intensity",new me(1));c(this,"color",new me(new be(0,0,0)));c(this,"screenspaceRadius",!1);c(this,"quality",Ig.Medium);c(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(Ig[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const e=this.context.mainCamera,i=this._ssao=new tL(this.context.scene,e,this.context.domWidth,this.context.domHeight),s=Ig[this.quality];i.setQualityMode(s),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new be),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}td([Ss(),A()],dl.prototype,"gammaCorrection",void 0);td([A(me)],dl.prototype,"aoRadius",void 0);td([A(me)],dl.prototype,"falloff",void 0);td([A(me)],dl.prototype,"intensity",void 0);td([A(me)],dl.prototype,"color",void 0);td([Ss(),A()],dl.prototype,"screenspaceRadius",void 0);td([Ss(),A()],dl.prototype,"quality",void 0);ra("ScreenSpaceAmbientOcclusionN8",dl);var rL=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Vd;(function(n){n[n.ShadowMask=0]="ShadowMask",n[n.Additive=1]="Additive",n[n.Occluder=2]="Occluder"})(Vd||(Vd={}));class xb extends re{constructor(){super(...arguments);c(this,"mode",Vd.ShadowMask);c(this,"shadowColor",new Ut(0,0,0,1));c(this,"targetMesh")}start(){if(this.gameObject instanceof J)this.gameObject instanceof J&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject,this.targetMesh.receiveShadow=!0);else{const e=Fu.createPrimitive(Yo.Quad,{name:"ShadowCatcher",material:new Kn({color:10066329,roughness:1,metalness:0,transparent:!0})});e.receiveShadow=!0,e.geometry.rotateX(-Math.PI/2),this.gameObject.add(e),this.targetMesh=e}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case Vd.ShadowMask:this.applyShadowMaterial();break;case Vd.Additive:this.applyLightBlendMaterial();break;case Vd.Occluder:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const e=this.targetMesh.material;e.blending=d0,this.applyMaterialOptions(e),e.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)}}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const e=new AP;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e),this.targetMesh.material=e}else{const e=this.targetMesh.material;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e)}}applyOccluderMaterial(){if(this.targetMesh){let e=this.targetMesh.material;if(!e){const i=new _t;this.targetMesh.material=i,e=i}e.depthWrite=!0,e.stencilWrite=!0,e.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(e){e&&(e.depthWrite=!1,e.stencilWrite=!1)}}rL([A()],xb.prototype,"mode",void 0);rL([A(Ut)],xb.prototype,"shadowColor",void 0);var Cb=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const f1=class extends re{constructor(){super(...arguments);c(this,"target",null);c(this,"followFactor",.1);c(this,"rotateFactor",.1);c(this,"positionAxes",Ud.All);c(this,"flipForward",!1);c(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(e){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const i=He(this.target),s=this._firstUpdate||e?1:ye.clamp01(this.context.time.deltaTime*this.followFactor),r=this.worldPosition;this.positionAxes&Ud.X&&(r.x=ye.lerp(r.x,i.x,s)),this.positionAxes&Ud.Y&&(r.y=ye.lerp(r.y,i.y,s)),this.positionAxes&Ud.Z&&(r.z=ye.lerp(r.z,i.z,s)),this.worldPosition=r}if(this.rotateFactor>0){const i=Gt(this.target);this.flipForward&&i.premultiply(f1._invertForward);const s=this._firstUpdate||e?1:ye.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(i,s)}this._firstUpdate=!1}}};let tl=f1;c(tl,"_invertForward",new ie().setFromAxisAngle(new w(0,1,0),Math.PI));Cb([A(ne)],tl.prototype,"target",void 0);Cb([A()],tl.prototype,"followFactor",void 0);Cb([A()],tl.prototype,"rotateFactor",void 0);Cb([A()],tl.prototype,"positionAxes",void 0);class QX extends J{constructor(t){const e=new jX(t),i=new pr(e.image.width*.001,e.image.height*.001),s=new _t({map:e,toneMapped:!1,transparent:!0});super(i,s);function r(o){s.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){i.dispose(),s.dispose(),s.map.dispose(),vC.delete(t),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class jX extends GP{constructor(t){super(qB(t)),this.dom=t,this.anisotropy=16,this.colorSpace=Ge,this.minFilter=Mt,this.magFilter=Mt;const e=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),i={attributes:!0,childList:!0,subtree:!0,characterData:!0};e.observe(t,i),this.observer=e}dispatchDOMEvent(t){t.data&&GX(this.dom,t.type,t.data.x,t.data.y)}update(){this.image=qB(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const vC=new WeakMap;function qB(n){const t=document.createRange(),e=new be;function i(f){const p=[];let g=!1;function m(){if(g&&(g=!1,f.restore()),p.length===0)return;let v=-1/0,y=-1/0,b=1/0,_=1/0;for(let x=0;x<p.length;x++){const S=p[x];v=Math.max(v,S.x),y=Math.max(y,S.y),b=Math.min(b,S.x+S.width),_=Math.min(_,S.y+S.height)}f.save(),f.beginPath(),f.rect(v,y,b-v,_-y),f.clip(),g=!0}return{add:function(v){p.push(v),m()},remove:function(){p.pop(),m()}}}function s(f,p,g,m){m!==""&&(f.textTransform==="uppercase"&&(m=m.toUpperCase()),u.font=f.fontWeight+" "+f.fontSize+" "+f.fontFamily,u.textBaseline="top",u.fillStyle=f.color,u.fillText(m,p,g+parseFloat(f.fontSize)*.1))}function r(f,p,g,m,v){g<2*v&&(v=g/2),m<2*v&&(v=m/2),u.beginPath(),u.moveTo(f+v,p),u.arcTo(f+g,p,f+g,p+m,v),u.arcTo(f+g,p+m,f,p+m,v),u.arcTo(f,p+m,f,p,v),u.arcTo(f,p,f+g,p,v),u.closePath()}function o(f,p,g,m,v,y){const b=f[p+"Width"],_=f[p+"Style"],x=f[p+"Color"];b!=="0px"&&_!=="none"&&x!=="transparent"&&x!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=x,u.lineWidth=parseFloat(b),u.beginPath(),u.moveTo(g,m),u.lineTo(g+v,m+y),u.stroke())}function a(f,p){let g=0,m=0,v=0,y=0;if(f.nodeType===Node.TEXT_NODE){t.selectNode(f);const _=t.getBoundingClientRect();g=_.left-l.left-.5,m=_.top-l.top-.5,v=_.width,y=_.height,s(p,g,m,f.nodeValue.trim())}else{if(f.nodeType===Node.COMMENT_NODE)return;if(f instanceof HTMLCanvasElement){if(f.style.display==="none")return;const _=f.getBoundingClientRect();g=_.left-l.left-.5,m=_.top-l.top-.5,u.save();const x=window.devicePixelRatio;u.scale(1/x,1/x),u.drawImage(f,g,m),u.restore()}else if(f instanceof HTMLImageElement){if(f.style.display==="none")return;const _=f.getBoundingClientRect();g=_.left-l.left-.5,m=_.top-l.top-.5,v=_.width,y=_.height,u.drawImage(f,g,m,v,y)}else{if(f.style.display==="none")return;const _=f.getBoundingClientRect();g=_.left-l.left-.5,m=_.top-l.top-.5,v=_.width,y=_.height,p=window.getComputedStyle(f),r(g,m,v,y,parseFloat(p.borderRadius));const x=p.backgroundColor;x!=="transparent"&&x!=="rgba(0, 0, 0, 0)"&&(u.fillStyle=x,u.fill());const S=["borderTop","borderLeft","borderBottom","borderRight"];let E=!0,M=null;for(const I of S){if(M!==null&&(E=p[I+"Width"]===p[M+"Width"]&&p[I+"Color"]===p[M+"Color"]&&p[I+"Style"]===p[M+"Style"]),E===!1)break;M=I}if(E===!0){const I=parseFloat(p.borderTopWidth);p.borderTopWidth!=="0px"&&p.borderTopStyle!=="none"&&p.borderTopColor!=="transparent"&&p.borderTopColor!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=p.borderTopColor,u.lineWidth=I,u.stroke())}else o(p,"borderTop",g,m,v,0),o(p,"borderLeft",g,m,0,y),o(p,"borderBottom",g,m+y,v,0),o(p,"borderRight",g+v,m,0,y);if(f instanceof HTMLInputElement){let I=p.accentColor;(I===void 0||I==="auto")&&(I=p.color),e.set(I);const R=Math.sqrt(.299*e.r**2+.587*e.g**2+.114*e.b**2)<.5?"white":"#111111";if(f.type==="radio"&&(r(g,m,v,y,y),u.fillStyle="white",u.strokeStyle=I,u.lineWidth=1,u.fill(),u.stroke(),f.checked&&(r(g+2,m+2,v-4,y-4,y),u.fillStyle=I,u.strokeStyle=R,u.lineWidth=2,u.fill(),u.stroke())),f.type==="checkbox"&&(r(g,m,v,y,2),u.fillStyle=f.checked?I:"white",u.strokeStyle=f.checked?R:I,u.lineWidth=1,u.stroke(),u.fill(),f.checked)){const P=u.textAlign;u.textAlign="center";const F={color:R,fontFamily:p.fontFamily,fontSize:y+"px",fontWeight:"bold"};s(F,g+v/2,m,"âœ”"),u.textAlign=P}if(f.type==="range"){const[P,F,j]=["min","max","value"].map(X=>parseFloat(f[X])),V=(j-P)/(F-P)*(v-y);r(g,m+y/4,v,y/2,y/4),u.fillStyle=R,u.strokeStyle=I,u.lineWidth=1,u.fill(),u.stroke(),r(g,m+y/4,V+y/2,y/2,y/4),u.fillStyle=I,u.fill(),r(g+V,m,y,y,y/2),u.fillStyle=I,u.fill()}(f.type==="color"||f.type==="text"||f.type==="number")&&(d.add({x:g,y:m,width:v,height:y}),s(p,g+parseInt(p.paddingLeft),m+parseInt(p.paddingTop),f.value),d.remove())}}}const b=p.overflow==="auto"||p.overflow==="hidden";b&&d.add({x:g,y:m,width:v,height:y});for(let _=0;_<f.childNodes.length;_++)a(f.childNodes[_],p);b&&d.remove()}const l=n.getBoundingClientRect();let h=vC.get(n);h===void 0&&(h=document.createElement("canvas"),h.width=l.width,h.height=l.height,vC.set(n,h));const u=h.getContext("2d"),d=new i(u);return u.clearRect(0,0,h.width,h.height),a(n),h}function GX(n,t,e,i){const s={clientX:e*n.offsetWidth+n.offsetLeft,clientY:i*n.offsetHeight+n.offsetTop,view:n.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(t,s));const r=n.getBoundingClientRect();e=e*r.width+r.left,i=i*r.height+r.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const l=a.getBoundingClientRect();if(e>l.left&&e<l.right&&i>l.top&&i<l.bottom&&(a.dispatchEvent(new MouseEvent(t,s)),a instanceof HTMLInputElement&&a.type==="range"&&(t==="mousedown"||t==="click"))){const[h,u]=["min","max"].map(g=>parseFloat(a[g])),d=l.width,p=(e-l.x)/d;a.value=h+(u-h)*p,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let h=0;h<a.childNodes.length;h++)o(a.childNodes[h])}}o(n)}const jv=new oe,Ad={type:"",data:jv},XB=new ku;class HX extends Lr{listenToPointerEvents(t,e){const i=this,s=new ku,r=t.domElement;function o(a){a.stopPropagation();const l=t.domElement.getBoundingClientRect();jv.x=(a.clientX-l.left)/l.width*2-1,jv.y=-(a.clientY-l.top)/l.height*2+1,s.setFromCamera(jv,e);const h=s.intersectObjects(i.children,!1);if(h.length>0){const u=h[0],d=u.object,f=u.uv;Ad.type=a.type,Ad.data.set(f.x,1-f.y),d.dispatchEvent(Ad)}}r.addEventListener("pointerdown",o),r.addEventListener("pointerup",o),r.addEventListener("pointermove",o),r.addEventListener("mousedown",o),r.addEventListener("mouseup",o),r.addEventListener("mousemove",o),r.addEventListener("click",o)}listenToXRControllerEvents(t){const e=this,i={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function s(r){const o=r.target;XB.setFromXRController(o);const a=XB.intersectObjects(e.children,!1);if(a.length>0){const l=a[0],h=l.object,u=l.uv;Ad.type=i[r.type],Ad.data.set(u.x,1-u.y),h.dispatchEvent(Ad)}}t.addEventListener("move",s),t.addEventListener("select",s),t.addEventListener("selectstart",s),t.addEventListener("selectend",s)}}var oL=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Sb extends re{constructor(){super(...arguments);c(this,"id",null);c(this,"keepAspect",!1);c(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const e=document.getElementById(this.id);if(!e){console.warn('Could not find element with id "'+this.id+'"');return}e.style.display="block",e.style.visibility="hidden";const i=new HX;i.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(i);const s=new QX(e);i.add(s),s.visible=!1;const r=s.material;r.transparent=!0,setTimeout(()=>{s.visible=!0;const o=b0(this.gameObject).clone();_0(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new xn;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,h=a.max.y-a.min.y;if(this.keepAspect){const d=l/h;l>h?s.scale.set(1/l,1/h/d,1):s.scale.set(1/l*d,1/h,1)}else s.scale.set(1/l,1/h,1);const u=this.gameObject.scale;s.scale.multiply(u)},1)}onDisable(){var e;(e=this._object)==null||e.removeFromParent()}}oL([A()],Sb.prototype,"id",void 0);oL([A()],Sb.prototype,"keepAspect",void 0);var nA=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Tg=z("debugspatialtrigger"),YB=new go,KB=new go;function VX(n,t){return YB.mask=n,KB.mask=t,YB.test(KB)}class tc extends re{constructor(){super(...arguments);c(this,"triggerMask",0);c(this,"onEnter");c(this,"onStay");c(this,"onExit");c(this,"currentIntersected",[]);c(this,"lastIntersected",[])}start(){Tg&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const e of wu.triggers)VX(e.triggerMask,this.triggerMask)&&e.test(this.gameObject)&&this.currentIntersected.push(e);for(let e=this.lastIntersected.length-1;e>=0;e--){const i=this.lastIntersected[e];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(e,1))}for(const e of this.currentIntersected)this.lastIntersected.indexOf(e)<0&&this.onEnterTrigger(e),this.onStayTrigger(e);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(e){var i;Tg&&console.log("ENTER TRIGGER",this.name,e.name,this,e),e.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,e)}onExitTrigger(e){var i;Tg&&console.log("EXIT TRIGGER",this.name,e.name,this,e),e.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,e)}onStayTrigger(e){var i;e.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,e)}}nA([A()],tc.prototype,"triggerMask",void 0);nA([A($t)],tc.prototype,"onEnter",void 0);nA([A($t)],tc.prototype,"onStay",void 0);nA([A($t)],tc.prototype,"onExit",void 0);const Fg=class extends re{constructor(){super(...arguments);c(this,"triggerMask");c(this,"boxHelper")}start(){Tg&&console.log(this.name,this.triggerMask,this)}onEnable(){var e;Fg.triggers.push(this),this.boxHelper||(this.boxHelper=Q.addNewComponent(this.gameObject,qo),(e=this.boxHelper)==null||e.showHelper(null,Tg))}onDisable(){Fg.triggers.splice(Fg.triggers.indexOf(this),1)}test(e){return this.boxHelper?this.boxHelper.isInBox(e)??!1:!1}raiseOnEnterEvent(e){Q.foreachComponent(this.gameObject,i=>{i!==e&&i instanceof tc&&i.onEnterTrigger(this)},!1)}raiseOnStayEvent(e){Q.foreachComponent(this.gameObject,i=>{i!==e&&i instanceof tc&&i.onStayTrigger(this)},!1)}raiseOnExitEvent(e){Q.foreachComponent(this.gameObject,i=>{i!==e&&i instanceof tc&&i.onExitTrigger(this)},!1)}};let wu=Fg;c(wu,"triggers",[]);nA([A()],wu.prototype,"triggerMask",void 0);var WX=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r},Ff;(function(n){n[n.FirstPerson=0]="FirstPerson",n[n.ThirdPerson=1]="ThirdPerson"})(Ff||(Ff={}));const Pr=z("debugspectator");class jE extends re{constructor(){super(...arguments);c(this,"cam",null);c(this,"useKeys",!0);c(this,"_mode",Ff.FirstPerson);c(this,"orbit",null);c(this,"_handler");c(this,"eventSub_WebXRRequestStartEvent",null);c(this,"eventSub_WebXRStartEvent",null);c(this,"eventSub_WebXREndEvent",null);c(this,"_debug");c(this,"_networking")}get mode(){return this._mode}set mode(e){this._mode=e}get isSpectating(){var e;return((e=this._handler)==null?void 0:e.currentTarget)!==void 0}isSpectatingUser(e){var i;return((i=this.target)==null?void 0:i.userId)===e}isFollowedBy(e){var i;return(i=this.followers)==null?void 0:i.includes(e)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(e){var i;if(this._handler){const s=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);e===void 0||this.context.isInXR===!1&&(r==null?void 0:r.currentObject)===e.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),Q.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(e,s)):this._handler.currentTarget!==e&&(this._handler.set(e),Q.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(e,s))}}get target(){var e;return(e=this._handler)==null?void 0:e.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var e,i;return this.isSpectating&&((e=this.target)==null?void 0:e.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new YX(this.context,this),this._networking=new ZX(this.context,this),this._networking.awake(),Q.setActive(this.gameObject,!1),this.cam=Q.getComponent(this.gameObject,Bt),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new qX(this.context,this.cam,this)),this.orbit=Q.getComponent(this.context.mainCamera,Lt)}onDestroy(){var e,i;this.stopSpectating(),(e=this._handler)==null||e.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const e=window.navigator.userAgent,i=/Windows|MacOS/.test(e),s=/Windows NT/.test(e)&&/Edg/.test(e)&&!/Win64/.test(e);return i&&!s}onBeforeXR(e){this.isSupportedPlatform()&&Q.setActive(this.gameObject,!0)}onEnterXR(e){this.isSupportedPlatform()&&(Pr&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(e){var i,s;this.context.removeCamera(this.cam),Q.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(s=this._handler)==null||s.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,Yl.Headset),this.target=this.context.players.getPlayerView(this.localId)),Pr&&console.log("Follow self",this.target)}onAfterRender(){var u,d,f;if(!this.cam)return;const e=this.context.renderer,i=e.xr.enabled;if(!e.xr.isPresenting&&!((u=this._handler)!=null&&u.currentTarget))return;(d=this._handler)==null||d.update(this._mode);const s=e.getRenderTarget();let r=null;const o=e.state;if(!s){if(!e.state.bindFramebuffer||!o.bindXRFramebuffer)return;r=e._framebuffer,o.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const a=this.context.mainCameraComponent;if(a){const p=a.backgroundColor;p&&e.setClearColor(p,p.alpha),this.cam.backgroundColor=p,this.cam.clearFlags=a.clearFlags,this.cam.nearClipPlane=a.nearClipPlane,this.cam.farClipPlane=a.farClipPlane}else e.setClearColor(new be(1,1,1));e.setRenderTarget(null),e.xr.enabled=!1;const l=(f=this.cam)==null?void 0:f.cam;this.context.updateAspect(l);const h=e.xr.isPresenting;e.xr.isPresenting=!1,e.setSize(this.context.domWidth,this.context.domHeight),e.render(this.context.scene,l),e.xr.isPresenting=h,e.xr.enabled=i,s?e.setRenderTarget(s):o.bindXRFramebuffer&&o.bindXRFramebuffer(r),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const e=this._mode===Ff.FirstPerson;for(const i of bn.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let s=po.All;this.isSpectatingSelf&&(s=e&&i.avatar.isLocalAvatar?po.FirstPerson:po.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(s)}}resetAvatarFlags(){var e;for(const i of bn.instances)if(i.avatar&&"flags"in i.avatar){const s=i.avatar.flags;if(!s)continue;for(const r of s)"isLocalAvatar"in i.avatar&&((e=i.avatar)!=null&&e.isLocalAvatar)?r.UpdateVisible(po.FirstPerson):r.UpdateVisible(po.ThirdPerson)}}}WX([A()],jE.prototype,"useKeys",void 0);class qX{constructor(t,e,i){c(this,"context");c(this,"cam");c(this,"spectator");c(this,"follow");c(this,"target");c(this,"view");c(this,"currentObject");this.context=t,this.cam=e,this.spectator=i}get currentTarget(){return this.view}set(t){const e=t==null?void 0:t.currentObject;if(!e){this.spectator.stopSpectating();return}e!==this.currentObject&&(this.currentObject=e,this.view=t,this.follow||(this.follow=Q.addNewComponent(this.cam.gameObject,tl)),this.target||(this.target=new ne),e.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,Pr&&console.log("FOLLOW",e),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){Pr&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var t;(t=this.target)==null||t.removeFromParent(),this.follow&&Q.destroy(this.follow)}update(t){var s,r,o,a,l,h;if(((s=this.currentTarget)==null?void 0:s.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){Pr&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((o=this.currentTarget)==null?void 0:o.currentObject)!==this.currentObject&&(Pr&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const e=this.context.mainCamera;e&&(this.cam.cam.near!==e.near||this.cam.cam.far!==e.far)&&(this.cam.cam.near=e.near,this.cam.cam.far=e.far,this.cam.cam.updateProjectionMatrix());const i=(a=this.follow)==null?void 0:a.target;if(!(!i||!this.follow)){switch(t){case Ff.FirstPerson:((l=this.view)==null?void 0:l.viewDevice)!==Yl.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),i.position.set(0,0,0);break;case Ff.ThirdPerson:this.follow.followFactor=3,this.follow.rotateFactor=2,i.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((h=this.view)==null?void 0:h.viewDevice)!==Yl.Browser?i.quaternion.copy(XX):i.quaternion.identity()}}}const XX=new ie().setFromAxisAngle(new w(0,1,0),Math.PI);class YX{constructor(t,e){c(this,"context");c(this,"spectator");this.context=t,this.spectator=e,console.log("Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",s=>{if(!this.spectator.useKeys)return;s.key==="Escape"&&this.spectator.stopSpectating()});let i=0;this.context.input.addEventListener(ft.PointerDown,s=>{i=this.context.time.time}),this.context.input.addEventListener(ft.PointerUp,s=>{const r=this.context.time.time-i;r>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&r<.3&&this.trySelectObject()})}trySelectObject(){const t=new rc;t.setMask(16777215);const e=this.context.physics.raycast(t);if(Pr&&console.log(...e),e!=null&&e.length)for(const i of e){if(i.distance<.2)continue;const s=i.object,r=Q.getComponentInParent(s,bn),o=r==null?void 0:r.connectionId;if(o){const a=this.context.players.getPlayerView(o);this.spectator.target=a,Pr&&console.log("spectate",o,r);break}}}}class KX{constructor(t,e,i){c(this,"guid");c(this,"dontSave",!0);c(this,"targetUserId");c(this,"stoppedFollowing");this.guid=t,this.targetUserId=e,this.stoppedFollowing=i}}class JX{constructor(t,e){c(this,"guid");c(this,"userId");this.guid=t.guid,this.userId=e}}class ZX{constructor(t,e){c(this,"followers",[]);c(this,"context");c(this,"spectator");c(this,"_followerEventMethod");c(this,"_requestFollowMethod");c(this,"_joinedRoomMethod");c(this,"_lastRequestFollowUser");c(this,"_enforceFollowInterval");this.context=t,this.spectator=e,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(Qe.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",t=>{this.spectator.useKeys&&(t.key==="f"?this.onRequestFollowMe():t.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(Qe.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(t,e){if(Pr&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",t,e),this.context.connection.connectionId){const i=(t==null?void 0:t.userId)===void 0,s=i?e:t==null?void 0:t.userId,r=new KX(this.context.connection.connectionId,s,i);this.context.connection.send("spectator-follower-changed",r)}}onRequestFollowMe(t=!1){if(Pr&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const e=t?void 0:this.context.connection.connectionId,i=new JX(this.spectator,e);this.context.connection.send("spectator-request-follow",i)}}onUserJoinedRoom(){z("followme")&&this.onRequestFollowMe()}onFollowerEvent(t){const e=t.targetUserId,i=t.guid;if(Pr&&console.log(t),e===this.context.connection.connectionId)if(t.stoppedFollowing){const s=this.followers.indexOf(i);s!==-1&&(this.followers.splice(s,1),this.removeDisconnectedFollowers(),console.log(i,"unfollows you",this.followers.length))}else this.followers.includes(i)||(this.followers.push(i),this.removeDisconnectedFollowers(),console.log(i,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let t=this.followers.length-1;t>=0;t--){const e=this.followers[t];this.context.connection.userIsInRoom(e)===!1&&this.followers.splice(t,1)}}onRequestFollowEvent(t){if(this._lastRequestFollowUser=t,t.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(t.userId===void 0)this.spectator.stopSpectating();else{const e=this.context.players.getPlayerView(t.userId);if(e)this.spectator.target=e;else return Pr&&console.warn("Could not find view",t.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(Pr&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class ka{constructor(){c(this,"bb",null);c(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSyncedCameraModel(t,e){return(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSyncedCameraModel(t,e){return t.setPosition(t.position()+SS),(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}userId(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}guid(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}dontSave(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}pos(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new mu).__init(this.bb_pos+e,this.bb):null}rot(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new mu).__init(this.bb_pos+e,this.bb):null}static startSyncedCameraModel(t){t.startObject(5)}static addUserId(t,e){t.addFieldOffset(0,e,0)}static addGuid(t,e){t.addFieldOffset(1,e,0)}static addDontSave(t,e){t.addFieldInt8(2,+e,0)}static addPos(t,e){t.addFieldStruct(3,e,0)}static addRot(t,e){t.addFieldStruct(4,e,0)}static endSyncedCameraModel(t){return t.endObject()}static finishSyncedCameraModelBuffer(t,e){t.finish(e)}static finishSizePrefixedSyncedCameraModelBuffer(t,e){t.finish(e,void 0,!0)}}var $X=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Gy="SCAM";Xk(Gy,ka.getRootAsSyncedCameraModel);const wr=new Em;class eY{constructor(t,e){c(this,"userId");c(this,"guid");this.guid=e,this.userId=t}send(t,e){if(t){wr.clear();const i=wr.createString(this.guid),s=wr.createString(this.userId);ka.startSyncedCameraModel(wr),ka.addGuid(wr,i),ka.addUserId(wr,s);const r=He(t),o=b0(t);ka.addPos(wr,mu.createVec3(wr,r.x,r.y,r.z)),ka.addRot(wr,mu.createVec3(wr,o.x,o.y,o.z));const a=ka.endSyncedCameraModel(wr);wr.finish(a,Gy),e.sendBinary(wr.asUint8Array())}}}const s0=class extends re{constructor(){super(...arguments);c(this,"cameraPrefab",null);c(this,"_lastWorldPosition");c(this,"_lastWorldQuaternion");c(this,"_model",null);c(this,"_needsUpdate",!0);c(this,"_lastUpdateTime",0);c(this,"remoteCams",{});c(this,"userToCamMap",{});c(this,"_camTimeoutInSeconds",10);c(this,"_receiveCallback",null)}getCameraObject(e){const i=this.userToCamMap[e];return i?this.remoteCams[i].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(Gy,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(Gy,this._receiveCallback)}update(){for(const r in this.remoteCams){const o=this.remoteCams[r],a=this.context.time.realtimeSinceStartup-o.lastUpdate;if(!o||a>this._camTimeoutInSeconds){ve()&&console.log("Remote cam timeout",r),o!=null&&o.obj&&Q.destroy(o.obj),delete this.remoteCams[r],o&&delete this.userToCamMap[o.userId],s0.instances.push(o),this.context.players.removePlayerView(o.userId,Yl.Browser);continue}}if(this.context.isInXR)return;const e=this.context.mainCamera;if(e===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new eY(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const i=He(e),s=Gt(e);(i.distanceTo(this._lastWorldPosition)>.001||s.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(i),this._lastWorldQuaternion.copy(s),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(e,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,e,Yl.Browser))}onReceivedRemoteCameraInfoBin(e){const i=e.guid();if(!i)return;const s=e.userId();if(!s||!this.context.connection.userIsInRoom(s)||!this.cameraPrefab)return;let r=this.remoteCams[i];if(!r)if("isObject3D"in this.cameraPrefab){const h=new ll;h.context=this.context;const u=Q.instantiate(this.cameraPrefab,h);r=this.remoteCams[i]={obj:u,lastUpdate:this.context.time.realtimeSinceStartup,userId:s},r.obj.visible=!0,this.gameObject.add(u),this.userToCamMap[s]=i,s0.instances.push(r);const d=Q.getOrAddComponent(u,bn);d.connectionId=s,d.avatar=u}else return;const o=r.obj;this.context.players.setPlayerView(s,o,Yl.Browser),r.lastUpdate=this.context.time.realtimeSinceStartup,ea.markDirty(o);const a=e.pos();a&&Tf(o,a.x(),a.y(),a.z());const l=e.rot();l&&_0(o,l.x(),l.y(),l.z())}};let Af=s0;c(Af,"instances",[]);$X([A([ne,et])],Af.prototype,"cameraPrefab",void 0);var Th=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Iw="view",Tw=z("debugsyncedroom");class fl extends re{constructor(){super(...arguments);c(this,"roomName","");c(this,"urlParameterName","room");c(this,"joinRandomRoom");c(this,"requireRoomParameter",!1);c(this,"autoRejoin",!0);c(this,"createJoinButton",!0);c(this,"createViewOnlyButton",!1);c(this,"_lastJoinedRoom");c(this,"_roomPrefix","");c(this,"_lastPingTime",0);c(this,"_lastRoomTime",-1);c(this,"_userWantsToBeInARoom",!1);c(this,"_roomButton");c(this,"_roomButtonIconJoin");c(this,"_roomButtonIconLeave");c(this,"updateRoomButtonState",()=>{var e,i;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(e=this._roomButtonIconJoin)==null||e.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(i=this._roomButtonIconLeave)==null||i.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))});c(this,"_viewOnlyButton");c(this,"onCreateViewOnlyButton",()=>{if(!this._viewOnlyButton){const e=document.createElement("button");this._viewOnlyButton=e,e.classList.add("view-only-button"),e.setAttribute("priority","90"),e.onclick=()=>{var s;const i=this.getViewOnlyUrl();i!=null&&i.length?navigator.canShare({url:i})?(s=navigator.share({url:i}))==null||s.catch(r=>{console.warn(r)}):(navigator.clipboard.writeText(i),bi("View only URL copied to clipboard")):qt("Could not create view only URL")},e.title="Copy the view only URL: A page accessed by the view only URL can not be modified by visiting users.",e.textContent="Share View URL",e.prepend(ys("visibility"))}this.context.menu.appendChild(this._viewOnlyButton)})}get currentRoomName(){const e=z(Iw);return e||z(this.urlParameterName)}set roomPrefix(e){this._roomPrefix=e}get roomPrefix(){return this._roomPrefix}awake(){var e;this.joinRandomRoom===void 0&&((e=this.roomName)==null?void 0:e.length)<=0&&(this.joinRandomRoom=!0),Tw&&console.log(`SyncedRoom roomName:${this.roomName}, urlParamName:${this.urlParameterName}, joinRandomRoom:${this.joinRandomRoom}`)}onEnable(){const e=z(Iw);if(e&&typeof e=="string"&&e.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(e,!0);return}if(this.tryJoinRoom(),this.createJoinButton){const i=this.createRoomButton();this.context.menu.appendChild(i)}this.createViewOnlyButton&&this.onEnableViewOnlyButton()}onDisable(){var e;(e=this._roomButton)==null||e.remove(),this.onDisableViewOnlyButton(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(e=0){var s;e===void 0&&(e=0);let i=!1;if(((s=this.urlParameterName)==null?void 0:s.length)>0){const r=z(this.urlParameterName);if(r&&(typeof r=="string"||typeof r=="number")){i=!0;const o=dU(r.toString());this.roomName=o}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),e<1))return this.tryJoinRoom(e+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(this.roomName=this.generateRoomName());return this.requireRoomParameter&&!i?((Tw||ve())&&console.warn('SyncedRoom: Missing required room parameter "'+this.urlParameterName+`" in url - will not connect.
To allow joining a room without a query parameter you can set "requireRoomParameter" to false.`),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.roomName.length<=0?(console.warn(`SyncedRoom: Room name is not set so we can not join a networked room.
Please choose one of the following options to fix this:
A) Set a room name in the SyncedRoom component
B) Set a room name in the URL parameter "?`+this.urlParameterName+`=my_room"
C) Set "joinRandomRoom" to true`),!1):(Tw&&console.log("Join "+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0))}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):ve()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const e=window.location.search,i=new URLSearchParams(e);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(Iw,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}setRandomRoomUrlParameter(){const e=f0(),i=this.generateRoomName();z(this.urlParameterName)?e.set(this.urlParameterName,i):e.append(this.urlParameterName,i),WP(i,e)}generateRoomName(){let e="";for(let i=0;i<6;i++)e+=Math.floor(Math.random()*10).toFixed(0);return e}createRoomButton(){if(this._roomButton)return this._roomButton;const e=document.createElement("button");return this._roomButton=e,e.classList.add("create-room-button"),e.setAttribute("priority","90"),e.onclick=()=>{if(this.context.connection.isInRoom)this.urlParameterName&&Gw(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1;else{if(this.urlParameterName){const i=z(this.urlParameterName);(!i||i===!0)&&(this._lastJoinedRoom?Gw(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())}this.tryJoinRoom()}},this._roomButtonIconJoin=ys("group"),this._roomButtonIconLeave=ys("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(Qe.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(Qe.LeftRoom,this.updateRoomButtonState),e}destroyRoomButton(){this.context.connection.stopListen(Qe.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(Qe.LeftRoom,this.updateRoomButtonState)}onEnableViewOnlyButton(){this.context.connection.isConnected?this.onCreateViewOnlyButton():(this.context.connection.stopListen(Qe.JoinedRoom,this.onCreateViewOnlyButton),this.context.connection.beginListen(Qe.JoinedRoom,this.onCreateViewOnlyButton))}onDisableViewOnlyButton(){var e;this.context.connection.stopListen(Qe.JoinedRoom,this.onCreateViewOnlyButton),(e=this._viewOnlyButton)==null||e.remove()}}Th([A()],fl.prototype,"roomName",void 0);Th([A()],fl.prototype,"urlParameterName",void 0);Th([A()],fl.prototype,"joinRandomRoom",void 0);Th([A()],fl.prototype,"requireRoomParameter",void 0);Th([A()],fl.prototype,"autoRejoin",void 0);Th([A()],fl.prototype,"createJoinButton",void 0);Th([A()],fl.prototype,"createViewOnlyButton",void 0);Th([A()],fl.prototype,"roomPrefix",null);function tY(){const n=z("testwindowcount")||0;n&&n>0&&iY(n)}function iY(n){if(z("testwindow"))return null;const t=new URL(window.location.href);x1(t.searchParams,W9,1),x1(t.searchParams,"testwindow",1);const e=t.toString(),i=[];window.onbeforeunload=()=>{for(const l of i)l.close()};const s=.05,r=128;let o=0,a=0;for(let l=0;l<n;l++){o*r+r*.01>=window.innerWidth&&(a+=1,o=0);const h=o*(r*(1+s))+window.screenLeft,u=a*(r*(1+s))+window.screenTop+90+60*a;o+=1;const d=window.open(e,"test window "+l,`popup=yes width=${r} height=${r} top=${u} left=${h}`);if(!d){console.warn("Failed to open window");continue}i.push(d),d.onload=()=>{d.onbeforeunload=()=>{for(let f=0;f<i.length;f++){const p=i[f];p!==d&&p.close()}i.length=0}}}return i}class aL extends re{awake(){tY()}}class lL extends re{constructor(){super(...arguments);c(this,"transformsPerFrame",10);c(this,"interval",0);c(this,"useFlatbuffers",!0);c(this,"builder",null);c(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(lm,e=>{});else{this.models=[];for(let e=0;e<this.transformsPerFrame;e++)this.models.push(new cL(this.context.connection.connectionId+"_simulatedTransform_"+e,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new Em(1024));const e=this.builder;for(let i=0;i<this.transformsPerFrame;i++){e.clear();const s=e2(this.context.connection.connectionId,this);this.context.connection.sendBinary(s)}}else if(this.models)for(let e=0;e<this.models.length;e++){const i=this.models[e];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+e,i)}}}}class cL{constructor(t,e){c(this,"guid");c(this,"fast",!1);c(this,"position");c(this,"rotation");c(this,"velocity");c(this,"dontSave");this.guid=t,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(e,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(t,e){const i=t.worldPosition;this.position.x=i.x,this.position.y=i.y,this.position.z=i.z;const s=t.worldQuaternion;if(this.rotation.x=s.x,this.rotation.y=s.y,this.rotation.z=s.z,this.rotation.w=s.w,this.fast=!1,e){const r=e.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}c(cL,"temp",new w);var tp=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class bc extends ns{constructor(){super(...arguments);c(this,"offset",new me(0));c(this,"rotation",new me(0));c(this,"focusArea",new me(.4));c(this,"feather",new me(.3));c(this,"kernelSize",new me(Ka.MEDIUM));c(this,"resolutionScale",new me(1/window.devicePixelRatio))}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=Ka.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){const e=new vk({kernelSize:Ka.VERY_LARGE,offset:this.offset.value,rotation:this.rotation.value,focusArea:this.focusArea.value,feather:this.feather.value});return this.offset.onValueChanged=i=>e.offset=i,this.rotation.onValueChanged=i=>e.rotation=i,this.focusArea.onValueChanged=i=>e.focusArea=i,this.feather.onValueChanged=i=>e.feather=i,this.kernelSize.onValueChanged=i=>e.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>e.resolution.scale=i/window.devicePixelRatio,e}}tp([A(me)],bc.prototype,"offset",void 0);tp([A(me)],bc.prototype,"rotation",void 0);tp([A(me)],bc.prototype,"focusArea",void 0);tp([A(me)],bc.prototype,"feather",void 0);tp([A(me)],bc.prototype,"kernelSize",void 0);tp([A(me)],bc.prototype,"resolutionScale",void 0);ra("TiltShiftEffect",bc);var Eb=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class ip extends re{constructor(){super(...arguments);c(this,"isGizmo",!1);c(this,"translationSnap",1);c(this,"rotationSnapAngle",15);c(this,"scaleSnap",.25);c(this,"control");c(this,"orbit");c(this,"onControlChangedEvent",e=>{const i=this.orbit;if(i&&(i.enabled=!e.value),e.value){const s=Q.getComponentInParent(this.gameObject,oc);s&&s.requestOwnership()}});c(this,"windowKeyDownListener",e=>{if(this.enabled&&this.control)switch(e.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}});c(this,"windowKeyUpListener",e=>{if(this.enabled)switch(e.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var e;this.isGizmo&&!Tm||this.context.mainCamera&&(this.control||(this.control=new y6(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(i=>{const s=i;if(s.layers.set(2),s){const r=s.material;r&&(r.opacity=.3)}}),this.orbit=Q.getComponentInParent(this.context.mainCamera,Lt)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),(e=this.control)==null||e.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)))}onDisable(){var e,i;(e=this.control)==null||e.removeFromParent(),(i=this.control)==null||i.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(ct.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}Eb([A()],ip.prototype,"isGizmo",void 0);Eb([A()],ip.prototype,"translationSnap",void 0);Eb([A()],ip.prototype,"rotationSnapAngle",void 0);Eb([A()],ip.prototype,"scaleSnap",void 0);var GE=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class np extends ns{constructor(){super(...arguments);c(this,"color",new me({r:0,g:0,b:0,a:1}));c(this,"intensity",new me(0));c(this,"center",new me({x:.5,y:.5}))}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const e=new yk;return this.intensity.onValueChanged=i=>{e.offset=i,this.updateDarkness(e)},this.color.onValueChanged=i=>{this.updateDarkness(e)},e}updateDarkness(e){const i=this.intensity.value;e.darkness=i}}GE([A(me)],np.prototype,"color",void 0);GE([A(me)],np.prototype,"intensity",void 0);GE([A(me)],np.prototype,"center",void 0);ra("Vignette",np);var nY=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const hv=z("debugpost");class Ib extends re{constructor(){super(...arguments);c(this,"sharedProfile");c(this,"_postprocessing");c(this,"_activeEffects",[]);c(this,"_effects",[]);c(this,"_lastApplyTime");c(this,"_rapidApplyCount",0);c(this,"_isDirty",!1);c(this,"_modificationQueue");c(this,"_recreateId",-1)}get isPostProcessingManager(){return!0}get effects(){return this._activeEffects}addEffect(e){let i=e;return i instanceof Xs&&(i=new Fy(i)),this._effects.includes(i)||(this._effects.push(i),this._isDirty=!0),e}removeEffect(e){var s,r,o,a;let i=-1;if(e instanceof Xs?i=this._effects.findIndex(l=>l instanceof Fy&&l.effect===e):i=this._effects.indexOf(e),i!==-1)return this._effects.splice(i,1),this._isDirty=!0,e;if(e instanceof ns){const l=(r=(s=this.sharedProfile)==null?void 0:s.components)==null?void 0:r.indexOf(e);l!==void 0&&l!==-1&&(this._isDirty=!0,(a=(o=this.sharedProfile)==null?void 0:o.components)==null||a.splice(l,1))}return e}markDirty(){this._isDirty=!0}awake(){var e;hv&&(console.log("PostprocessingManager Awake",this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(this.enabled=!this.enabled,bi("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(e=this.sharedProfile)==null||e.init()}onEnable(){this._isDirty=!0}onDisable(){var e;(e=this._postprocessing)==null||e.unapply(),this._isDirty=!1}onBeforeRender(){var e;if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof mS)){hv&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}this.context.mainCamera&&this._isDirty&&this.apply(),this.context.composer&&((e=this._postprocessing)==null?void 0:e.composer)===this.context.composer&&(this.context.renderer.getContext().isContextLost()&&this.context.renderer.forceContextRestore(),this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var e;(e=this._postprocessing)==null||e.dispose()}apply(){var e;if(hv&&console.log("Apply PostProcessing "+this.name),ve()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._activeEffects.length=0,(e=this.sharedProfile)!=null&&e.components){const i=this.sharedProfile.components;for(const s of i)s.active&&!this._activeEffects.includes(s)&&this._activeEffects.push(s)}for(const i of this._effects)i.active&&!this._activeEffects.includes(i)&&this._activeEffects.push(i);hv&&console.log("Apply PostProcessing",this._activeEffects),this._activeEffects.length>0&&(this._postprocessing||(this._postprocessing=new zE(this.context)),this._postprocessing.apply(this._activeEffects),this._applyPostQueue())}unapply(){var e;(e=this._postprocessing)==null||e.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const e of this._modificationQueue.values())this.onEditorModification(e);this._modificationQueue.clear()}}onEditorModification(e){var i,s;if(e.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(e.propertyName,e),!0;if(!((i=this._activeEffects)!=null&&i.length))return;const r=e.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const l of this._activeEffects)if(((s=l.typeName)==null?void 0:s.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=e.value,this.scheduleRecreate();return}if(!uv.has(o)){const h=new Array;uv.set(o,h);const u=Object.keys(l);for(const d of u)l[d]instanceof me&&h.push(d)}if(uv.has(o)){const h=a.toLowerCase(),u=uv.get(o);for(const d of u)if(d.toLowerCase()===h){const f=l[d];f instanceof me&&(r.length===4&&r[3]==="active"?(f.overrideState=e.value,this.scheduleRecreate()):f&&f.value!==void 0&&(f.value=e.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const e=++this._recreateId;setTimeout(()=>{e===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}nY([km(V0)],Ib.prototype,"sharedProfile",void 0);const uv=new Map;C9(Ib);var sY=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Gv=z("debugarcamera");class HE extends re{constructor(){super(...arguments);c(this,"backgroundTint",new Ut(1,1,1,1));c(this,"backgroundPlane");c(this,"threeTexture");c(this,"forceTextureInitialization",function(){const e=new _t,i=new pr,s=new ws;s.add(new J(i,e));const r=new bt;return function(a,l){e.map=l,a.render(s,r),Gv&&console.warn("Force texture initialization")}}());c(this,"preRender",()=>{if(!this||!this.gameObject)return;const i=this.context.renderer.xr.getFrame();i&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new At,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=oY(this.backgroundTint)),this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.updateFromFrame(i))})}onBeforeXR(e,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),Gv&&console.warn("Requesting camera-access")}onEnterXR(e){this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender)}onLeaveXR(e){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(e){this.updateFromFrame(e)}updateFromFrame(e){if(!e)return;const i=e.session.enabledFeatures;if(i&&!i.some(r=>r==="camera-access")){this.background&&(this.background.visible=!1);return}const s=e.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(s){for(const r of s.views)if("camera"in r&&r.camera){let a=this.context.renderer.xr.getBinding();if(a||(a=new XRWebGLBinding(e.session,this.context.renderer.getContext())),a){let l=null;if("getCameraImage"in a){l=a.getCameraImage(r.camera);const h=this.context.renderer.properties.get(this.threeTexture);h.__webglTexture=l,this.backgroundPlane?(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0):Gv&&console.warn("No background plane to set texture on")}}}}}}sY([A(Ut)],HE.prototype,"backgroundTint",void 0);const rY=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function oY(n){const t="vec4("+n.r.toFixed(3)+","+n.g.toFixed(3)+","+n.b.toFixed(3)+","+n.a.toFixed(3)+")";Gv&&console.log(t);const e=new J(new pr(2,2),new $e({name:"BackgroundMaterial",uniforms:u0.clone(nf.background.uniforms),vertexShader:nf.background.vertexShader,fragmentShader:rY.replaceAll("<backgroundTint>",t),side:_i,depthTest:!1,depthWrite:!1,fog:!1}));return e.geometry.deleteAttribute("normal"),Object.defineProperty(e.material,"map",{get:function(){return this.threeTexture}}),e.renderOrder=-1e4,e.layers.set(2),e.frustumCulled=!1,e.setTexture=function(i){e.material.uniforms.t2D.value=i},e}var id=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const JB=z("debugimagetracking"),r0=class{constructor(t,e,i,s,r,o){c(this,"measuredSize");c(this,"state");c(this,"_position");c(this,"_rotation");c(this,"_trackingComponent");c(this,"_trackedImage");c(this,"_bitmap");c(this,"_pose");this._trackingComponent=t,this._trackedImage=e,this._bitmap=i,this.measuredSize=s,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(t){return this.ensureTransformData(),t.copy(this._position),t}getQuaternion(t){return this.ensureTransformData(),t.copy(this._rotation),t}applyToObject(t,e=void 0){this.ensureTransformData();const i=t.position.distanceToSquared(this._position)/.05+t.quaternion.angleTo(this._rotation)/.05;e&&(e*=Math.max(1,i)),e===void 0||e>=1?(t.position.copy(this._position),t.quaternion.copy(this._rotation)):(e=Math.max(0,Math.min(1,e)),t.position.lerp(this._position,e),t.quaternion.slerp(this._rotation,e))}ensureTransformData(){if(!this._position){this._position=r0._positionBuffer.get(),this._rotation=r0._rotationBuffer.get();const t=this._pose.transform,e=Le.active.convertSpace(t);this._position.copy(e==null?void 0:e.position),this._rotation.copy(e==null?void 0:e.quaternion)}}};let ou=r0;c(ou,"_positionBuffer",new _o(()=>new w,20)),c(ou,"_rotationBuffer",new _o(()=>new ie,20));class _c{constructor(){c(this,"image");c(this,"widthInMeters",.25);c(this,"object");c(this,"createObjectInstance",!1);c(this,"imageDoesNotMove",!1);c(this,"hideWhenTrackingIsLost",!0)}}id([A(URL)],_c.prototype,"image",void 0);id([A()],_c.prototype,"widthInMeters",void 0);id([A(et)],_c.prototype,"object",void 0);id([A()],_c.prototype,"createObjectInstance",void 0);id([A()],_c.prototype,"imageDoesNotMove",void 0);id([A()],_c.prototype,"hideWhenTrackingIsLost",void 0);class aY{constructor(t,e,i){c(this,"filename");c(this,"widthInMeters");c(this,"imageData");this.filename=t,this.imageData=e,this.widthInMeters=i}get extensionName(){return"image-tracking"}onAfterHierarchy(t,e){e.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),e.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),e.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),e.closeBlock()}onBeforeBuildDocument(t){const e=Q.findObjectOfType(oh);!e||!e.trackedImages||e.trackedImages.length>1&&(ve()&&qt("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(t){t.files["image_tracking/"+this.filename]=this.imageData}onExportObject(t,e,i){var r;const s=Q.findObjectOfType(oh);if(!(!s||!s.trackedImages)){for(const o of s.trackedImages)if(((r=o.object)==null?void 0:r.asset)===t){const a=Q.findObjectOfType(ai);if(!a)continue;const{scale:l,target:h}=a.getARScaleAndTarget();let u=t;const d=new ae;if(t!==h)for(;u.parent&&u.parent!==h;)u=u.parent,d.premultiply(u.matrix);const f=d.clone().invert();e.setMatrix(f.scale(new w(l,l,l)));break}}}}const $d=class extends re{constructor(){super(...arguments);c(this,"trackedImages");c(this,"smooth",!0);c(this,"trackedImageIndexMap",new Map);c(this,"imageToObjectMap",new Map);c(this,"currentImages",[]);c(this,"onImageTrackingUpdate",e=>{const i=Le.active;if(i)for(const s of e){const r=s.model,o=s.state==="tracked";if(!r.object)continue;let a=this.imageToObjectMap.get(r);if(a===void 0)a={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(r,a),r.object.loadAssetAsync().then(l=>{if(r.createObjectInstance&&l&&(l=Q.instantiate(l)),l){a.object=l;for(const h of l.getComponentsInChildren(li))h.setInstancingEnabled(!1);i.rig?(i.rig.gameObject.add(l),s.applyToObject(l),l.activeSelf||Q.setActive(l,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(a.frames++,o&&(a.lastTrackingTime=Date.now()),r.imageDoesNotMove&&a.frames>10||!a.object)continue;i.rig&&(i.rig.gameObject.add(a.object),s.applyToObject(a.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),a.object.activeSelf||Q.setActive(a.object,!0))}}})}awake(){if(JB&&console.log(this),!!this.trackedImages){for(const e of this.trackedImages)if(e.image&&!$d._imageElements.has(e.image)){const i=e.image;$d._imageElements.set(i,null);const s=document.createElement("img");s.src=i,s.addEventListener("load",async()=>{const r=await createImageBitmap(s);$d._imageElements.set(i,r);const o=await MV(r);if(o){const l=await(await o.convertToBlob({type:"image/png"})).arrayBuffer(),h=Q.findObjectOfType(ai);h&&this.trackedImages&&(h.extensions.push(new aY("marker.png",new Uint8Array(l),this.trackedImages[0].widthInMeters)),h.anchoringType="image")}})}}}onBeforeXR(e,i){var s;if(this.trackedImages){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.includes("image-tracking")||i.optionalFeatures.push("image-tracking"),i.trackedImages=[];for(const r of this.trackedImages)if((s=r.image)!=null&&s.length&&r.widthInMeters>0){const o=$d._imageElements.get(r.image);o&&(this.trackedImageIndexMap.set(i.trackedImages.length,r),i.trackedImages.push({image:o,widthInMeters:r.widthInMeters}))}}}onEnterXR(e){var i;if(this.trackedImages){for(const s of this.trackedImages)if((i=s.object)!=null&&i.asset){const r=s.object.asset;r.userData||(r.userData={});const o={visible:r.visible,parent:r.parent,matrix:r.matrix.clone()};r.userData["image-tracking"]=o}}for(const s of this.imageToObjectMap.values())s.frames=0}onLeaveXR(e){var i,s;if(this.trackedImages){for(const r of this.trackedImages)if((i=r.object)!=null&&i.asset){const o=r.object.asset;if(o.userData){const a=o.userData["image-tracking"];a&&(o.visible=a.visible,(s=a.parent)==null||s.add(o),o.matrix.copy(a.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale)),delete o.userData["image-tracking"]}}}}onUpdateXR(e){var r;this.currentImages.length=0;const i=e.xr.frame;if(!i)return;if("getImageTrackingResults"in i){if(((r=e.xr.session.enabledFeatures)==null?void 0:r.includes("image-tracking"))===!1)return;if(i.session&&typeof i.getImageTrackingResults=="function"){const o=i.getImageTrackingResults();if(o.length>0){const a=this.context.renderer.xr.getReferenceSpace();if(a){for(const l of o){const h=l.trackingState,u=l.index,d=this.trackedImageIndexMap.get(u);if(d){const f=i.getPose(l.imageSpace,a),p=new ou(this,d,l.image,l.measuredSize,h,f);this.currentImages.push(p)}else JB&&console.warn("No tracked image for index",u)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(l){console.error(l)}}}}}else{const o=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(o)),qt(o);return}const s=1e3;for(const[o,a]of this.imageToObjectMap){if(!a.object||!o||o.hideWhenTrackingIsLost===!1)continue;let l=!1;for(const h of this.currentImages)if(h.model===o){const u=Date.now()-a.lastTrackingTime;if(o.imageDoesNotMove||h.state==="tracked"||u<=s){l=!0;break}}l||Q.setActive(a.object,!1)}}};let oh=$d;c(oh,"_imageElements",new Map);id([A(_c)],oh.prototype,"trackedImages",void 0);const Mp=new w,kp=new w,ZB=new za;class lY extends xf{constructor(t,e=1,i=16711680){const s=new Ht,r=t.geometry.attributes.normal.count,o=new cn(r*2*3,3);s.setAttribute("position",o),super(s,new Jo({color:i,toneMapped:!1})),this.object=t,this.size=e,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),ZB.getNormalMatrix(this.object.matrixWorld);const t=this.object.matrixWorld,e=this.geometry.attributes.position,i=this.object.geometry;if(i){const s=i.attributes.position,r=i.attributes.normal;let o=0;for(let a=0,l=s.count;a<l;a++)Mp.fromBufferAttribute(s,a).applyMatrix4(t),kp.fromBufferAttribute(r,a),kp.applyMatrix3(ZB).normalize().multiplyScalar(this.size).add(Mp),e.setXYZ(o,Mp.x,Mp.y,Mp.z),o=o+1,e.setXYZ(o,kp.x,kp.y,kp.z),o=o+1}e.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}var sp=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const Gh=z("debugplanetracking");class Rh extends re{constructor(){super(...arguments);c(this,"dataTemplate");c(this,"occluder",!0);c(this,"initiateRoomCaptureIfNoData",!0);c(this,"usePlaneData",!0);c(this,"useMeshData",!0);c(this,"runInVR",!0);c(this,"bounds",new xn);c(this,"center",new w);c(this,"labelOffset",new w);c(this,"_dataId",1);c(this,"_allPlanes",new Map);c(this,"_allMeshes",new Map);c(this,"firstTimeNoPlanesDetected",-100);c(this,"makeOccluder",(e,i,s=!1)=>{if(i){if(i instanceof Array){for(const r of i)this.makeOccluder(e,r,s);return}!s&&!i.name.toLowerCase().includes("occlu")||(i.colorWrite=!1,i.depthTest=!0,i.depthWrite=!0,i.transparent=!1,i.polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=.1,e.renderOrder=-1e3)}});c(this,"_flipForwardMatrix",new ae().makeRotationY(Math.PI));c(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(e,i){e==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onLeaveXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(e){if(!this.runInVR&&e.xr.isVR)return;const i=e.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const s=e.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const a=s.detectedPlanes,l=s.detectedMeshes,h=a!==void 0&&a.size>0,u=l!==void 0&&l.size>0;if(this.initiateRoomCaptureIfNoData&&(!h&&!u&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(h||u)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in s.session&&(s.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),a!==void 0&&this.processFrameData(e.xr,i.gameObject,s,a,this._allPlanes),l!==void 0&&this.processFrameData(e.xr,i.gameObject,s,l,this._allMeshes),Gh){const d=this.context.mainCameraComponent.gameObject.worldPosition;for(const f of this._allPlanes.values())!f.mesh||!f.mesh.visible||(this.bounds.makeEmpty(),f.mesh.traverse(p=>{p instanceof J&&this.bounds.expandByObject(p)}),this.bounds.getCenter(this.center),this.labelOffset.copy(d).sub(this.center).normalize().multiplyScalar(.1),Be.DrawLabel(this.center.add(this.labelOffset),(f.xrData.semanticLabel||"plane").toUpperCase()+`
`+f.xrData.lastChangedTime.toFixed(2),.02))}}removeData(e,i){const s=i.get(e);if(!s)return;i.delete(e),Gh&&console.log("Plane no longer tracked, id="+s.id),s.mesh&&(s.mesh.removeFromParent(),s.mesh.traverse(o=>{const a=o.userData.normalsHelper;a?(a.dispose(),a.removeFromParent()):Gh&&console.warn("No normals helper found for mesh",s.mesh)}),wo(s.mesh,!0,!0));const r=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:s}});this.dispatchEvent(r)}processFrameData(e,i,s,r,o){const l=this.context.renderer.xr.getReferenceSpace();if(l){for(const h of o.keys())r.has(h)||this.removeData(h,o);for(const h of r){const u="planeSpace"in h?h.planeSpace:"meshSpace"in h?h.meshSpace:void 0;if(!u)continue;const d=s.getPose(u,l);let f;if(o.has(h)){const p=o.get(h);if(f=p.mesh,p.timestamp<h.lastChangedTime){if(p.timestamp=h.lastChangedTime,p.mesh){const m=this.createGeometry(h);if(p.mesh instanceof J)p.mesh.geometry.dispose(),p.mesh.geometry=m,this.makeOccluder(p.mesh,p.mesh.material);else if(p.mesh instanceof Lr)for(const v of p.mesh.children)v instanceof J&&(v.geometry.dispose(),v.geometry=m,this.makeOccluder(v,v.material));if(p.collider){const v=p.mesh;p.collider.sharedMesh=v,p.collider.convex=this.checkIfContextShouldBeConvex(v,p.xrData),p.collider.onDisable(),p.collider.onEnable()}Gh&&(console.log("Plane updated, id="+p.id,p),p.mesh.traverse(v=>{if(!(v instanceof J))return;const y=v.userData.normalsHelper;y&&y.update()}))}const g=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:p}});this.dispatchEvent(g)}}else{if(!this.dataTemplate){const p=new J;Gh?p.material=new _P:this.occluder?(p.material=new _t,this.makeOccluder(p,p.material,!0)):p.material=new _t({wireframe:!0,opacity:.5,transparent:!0,color:3355443}),this.dataTemplate=new et("","",p)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const p=Q.instantiate(this.dataTemplate.asset);if(p.name="xr-tracked-plane",f=p,YM(p,!1),p instanceof J)ii(p.geometry),p.geometry=this.createGeometry(h),this.makeOccluder(p,p.material,this.occluder);else if(p instanceof Lr)for(const v of p.children)v instanceof J&&(ii(v.geometry),v.geometry=this.createGeometry(h),this.makeOccluder(v,v.material,this.occluder));const g=p.getComponent(Hf);if(g){const v=p;g.sharedMesh=v,g.convex=this.checkIfContextShouldBeConvex(v,h),g.onDisable(),g.onEnable()}p.matrixAutoUpdate=!1,p.matrixWorldNeedsUpdate=!0,i.add(p);const m={id:this._dataId++,xrData:h,timestamp:h.lastChangedTime,mesh:p,collider:g};o.set(h,m),Gh&&console.log("New plane detected, id="+m.id,m);try{const v=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:m}});this.dispatchEvent(v)}catch(v){console.error(v)}}}f&&(d?(f.visible=!0,f.matrix.fromArray(d.transform.matrix),f.matrix.premultiply(this._flipForwardMatrix)):f.visible=!1,Gh&&f.traverse(p=>{if(p instanceof J)if(p.userData.normalsHelper)p.userData.normalsHelper.update();else{const g=new lY(p,.05,255);g.layers.disableAll(),g.layers.set(2),this.context.scene.add(g),p.userData.normalsHelper=g}}))}}}checkIfContextShouldBeConvex(e,i){if(!e)return!0;if(e){const s=new xn;s.expandByObject(e);const r=new w;s.getSize(r);let o=!0;return r.x>2&&r.y>2&&r.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(e){return"polygon"in e?this.createPlaneGeometry(e.polygon):"vertices"in e&&"indices"in e?this.createMeshGeometry(e.vertices,e.indices):new Ht}createMeshGeometry(e,i){const s=e.toString()+"_"+i.toString();if(this._verticesCache.has(s))return this._verticesCache.get(s);const r=new Ht;r.setIndex(new Ke(i,1)),r.setAttribute("position",new Ke(e,3));const o=Array();for(let a=0;a<e.length;a+=3)o.push(e[a],e[a+2]);return r.setAttribute("uv",new Ke(e,3)),r.computeVertexNormals(),this._verticesCache.set(s,r),r}createPlaneGeometry(e){const i=new Ht,s=[],r=[];e.forEach(p=>{s.push(p.x,p.y,p.z),r.push(p.x,p.z)});const o=new w(s[0],s[1],s[2]),a=new w(s[3],s[4],s[5]),l=new w(s[6],s[7],s[8]),h=new w,u=new w;h.subVectors(a,o),u.subVectors(l,o),h.cross(u),h.normalize();const d=[];for(let p=0;p<s.length/3;p++)d.push(h.x,h.y,h.z);const f=[];for(let p=2;p<e.length;++p)f.push(0,p-1,p);return i.setAttribute("position",new Ke(new Float32Array(s),3)),i.setAttribute("uv",new Ke(new Float32Array(r),2)),i.setAttribute("normal",new Ke(new Float32Array(d),3)),i.setIndex(f),i}}sp([A(et)],Rh.prototype,"dataTemplate",void 0);sp([A()],Rh.prototype,"occluder",void 0);sp([A()],Rh.prototype,"initiateRoomCaptureIfNoData",void 0);sp([A()],Rh.prototype,"usePlaneData",void 0);sp([A()],Rh.prototype,"useMeshData",void 0);sp([A()],Rh.prototype,"runInVR",void 0);var rp=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};class Bh extends re{constructor(){super(...arguments);c(this,"side","none");c(this,"controller",!0);c(this,"hands",!1);c(this,"controlVisibility",!0);c(this,"useGripSpace",!1);c(this,"resetTransformAfterXRSession",!0);c(this,"_startPosition",new w);c(this,"_startRotation",new ie);c(this,"_startScale",new w)}get activeAndEnabled(){return!0}onEnterXR(e){this._startPosition.copy(this.gameObject.position),this._startRotation.copy(this.gameObject.quaternion),this._startScale.copy(this.gameObject.scale)}onUpdateXR(e){const i=e.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||i.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion,this.gameObject.worldScale=Re(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale)):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion,this.gameObject.worldScale=Re(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale))}}onLeaveXR(e){this.resetTransformAfterXRSession&&(this.gameObject.position.copy(this._startPosition),this.gameObject.quaternion.copy(this._startRotation),this.gameObject.scale.copy(this._startScale))}}rp([A()],Bh.prototype,"side",void 0);rp([A()],Bh.prototype,"controller",void 0);rp([A()],Bh.prototype,"hands",void 0);rp([A()],Bh.prototype,"controlVisibility",void 0);rp([A()],Bh.prototype,"useGripSpace",void 0);rp([A()],Bh.prototype,"resetTransformAfterXRSession",void 0);var cY=globalThis&&globalThis.__decorate||function(n,t,e,i){var s=arguments.length,r=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(t,e,r):o(t,e))||r);return s>3&&r&&Object.defineProperty(t,e,r),r};const $B=z("debugwebxr");class VE extends re{constructor(){super(...arguments);c(this,"priority",0);c(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var e;(e=Le.active)==null||e.setRigActive(this)}awake(){if($B){const e=new ne;e.position.y+=.5,this.gameObject.add(e);const i=e.addNewComponent(Vf);i&&(i.isGizmo=!1);const s=new dr(.5);this.gameObject.add(s)}}isXRRig(){return!0}supportsXR(e){return!0}onEnterXR(e){this._startScale=this.gameObject.scale.clone(),e.xr.addRig(this),$B&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(e){e.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}cY([A()],VE.prototype,"priority",void 0);class hL{}const hY=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:Ct,ActionCollection:qO,ActionModel:cr,AlignmentConstraint:U0,Animation:Ws,AnimationCurve:Ko,AnimationExtension:H0,AnimationTrackHandler:tE,Animator:Cs,AnimatorController:vo,Antialiasing:W0,AudioExtension:Qu,AudioListener:vu,AudioSource:kt,AudioTrackHandler:ff,Avatar:Su,AvatarBlink_Simple:Gf,AvatarEyeLook_Rotation:sh,AvatarLoader:c2,AvatarMarker:bn,AvatarModel:lE,Avatar_Brain_LookAt:Sy,Avatar_MouthShapes:Y0,Avatar_MustacheShake:l2,Avatar_POI:Jl,AxesHelper:Um,BaseUIComponent:na,BasicIKConstraint:h2,BehaviorExtension:hE,BehaviorModel:hn,BloomEffect:Zl,BoxCollider:Hu,BoxGizmo:Vf,BoxHelperComponent:qo,Button:wh,CallInfo:Nl,Camera:Bt,CameraTargetReachedEvent:wy,Canvas:En,CanvasGroup:Eu,CapsuleCollider:fh,ChangeMaterialOnClick:Vl,ChangeTransformOnClick:Wf,CharacterController:qf,CharacterControllerInput:Ch,ChromaticAberration:tb,Collider:Eo,ColorAdjustments:Wu,ColorBySpeedModule:Xf,ColorOverLifetimeModule:sb,ContactShadows:yo,ControlTrackHandler:iE,CustomBranding:Yu,Deletable:L2,DeleteBox:_E,DepthOfField:hl,DeviceFlag:wE,DocumentExtension:F2,DragControls:_n,DropListener:Zu,Duplicatable:Eh,EffectWrapper:Fy,EmissionModule:gc,EmphasizeOnClick:Hm,EventList:$t,EventListEvent:KS,EventSystem:kr,EventTrigger:SE,FieldWithDefault:R2,FixedJoint:U2,FlyControls:N2,Fog:qm,GltfExport:Ua,GltfExportBox:G2,Gradient:qu,Graphic:$l,GraphicRaycaster:ZS,GridHelper:Xm,GridLayoutGroup:A2,GroundProjectedEnv:bh,GroupActionModel:Zc,HideOnStart:v2,HingeJoint:cb,HorizontalLayoutGroup:m2,Image:jm,InheritVelocityModule:mc,InputField:ho,InstanceHandle:gf,InstancingHandler:pf,Interactable:O2,Keyframe:ur,LODGroup:db,LODModel:Jf,Light:Gr,LimitVelocityOverLifetimeModule:un,LogStats:H2,LookAt:ec,LookAtConstraint:jf,MainModule:Es,MaskableGraphic:J0,MeshCollider:Hf,MeshRenderer:nb,MinMaxCurve:Ce,MinMaxGradient:wn,NeedleMenu:vc,NestedGltf:BE,Networking:gh,NoiseModule:Nt,ObjectRaycaster:xo,OffsetConstraint:Zf,OpenURL:Km,OrbitControls:Lt,Outline:zm,Padding:Vu,ParticleBurst:By,ParticleSubEmitter:NE,ParticleSystem:wi,ParticleSystemRenderer:aa,PhysicsExtension:vE,PixelationEffect:_b,PlayAnimationOnClick:Wa,PlayAudioOnClick:Iu,PlayableDirector:$a,PlayerColor:fm,PointerEventData:Om,PostProcessingHandler:zE,PreliminaryAction:Vm,PreliminaryTrigger:$0,RawImage:pE,Rect:f2,RectTransform:es,ReflectionProbe:Wl,RegisteredAnimationInfo:nE,RemoteSkybox:cc,Renderer:li,RendererLightmap:Iy,Rigidbody:It,RotationBySpeedModule:Io,RotationOverLifetimeModule:oa,SceneSwitcher:Pn,ScreenCapture:ed,ScreenSpaceAmbientOcclusion:Ih,ScreenSpaceAmbientOcclusionN8:dl,SetActiveOnClick:co,ShadowCatcher:xb,ShapeModule:Zt,SharpeningEffect:wb,SignalAsset:Q0,SignalReceiver:nh,SignalReceiverEvent:Fm,SignalTrackHandler:xy,Size:d2,SizeBySpeedModule:mr,SizeOverLifetimeModule:Xu,SkinnedMeshRenderer:B2,SmoothFollow:tl,SpatialGrabRaycaster:Au,SpatialHtml:Sb,SpatialTrigger:wu,SpatialTriggerReceiver:tc,SpectatorCamera:jE,SphereCollider:Nm,Sprite:Ac,SpriteData:el,SpriteRenderer:jr,SpriteSheet:Ru,SubEmitterSystem:jy,SyncedCamera:Af,SyncedRoom:fl,SyncedTransform:oc,TapGestureTrigger:y2,TeleportTarget:AE,TestRunner:aL,TestSimulateUserData:lL,Text:Zs,TextBuilder:yE,TextExtension:ob,TextureSheetAnimationModule:Is,TiltShiftEffect:bc,ToneMappingEffect:ac,TrailModule:Ci,TransformData:ln,TransformGizmo:ip,TriggerBuilder:$n,TriggerModel:Kl,UIRaycastUtils:$S,UIRootComponent:N0,USDZExporter:ai,USDZText:ru,USDZUIExtension:bE,UsageMarker:ab,VariantAction:WO,VelocityOverLifetimeModule:Pi,VerticalLayoutGroup:g2,VideoPlayer:In,Vignette:np,VisibilityAction:eb,Voip:Gu,Volume:Ib,VolumeParameter:me,VolumeProfile:V0,WebARCameraBackground:HE,WebARSessionRoot:ph,WebXR:Ai,WebXRImageTracking:oh,WebXRImageTrackingModel:_c,WebXRPlaneTracking:Rh,WebXRTrackedImage:ou,XRControllerFollow:Bh,XRControllerModel:lc,XRControllerMovement:Co,XRFlag:Yn,XRRig:VE,XRState:bs,__Ignore:hL},Symbol.toStringTag,{value:"Module"}));class uY extends re{constructor(){super(...arguments);c(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}D.add("__Ignore",hL);D.add("ActionBuilder",Ct);D.add("ActionCollection",qO);D.add("ActionModel",cr);D.add("AlignmentConstraint",U0);D.add("Animation",Ws);D.add("AnimationCurve",Ko);D.add("AnimationExtension",H0);D.add("AnimationTrackHandler",tE);D.add("Animator",Cs);D.add("AnimatorController",vo);D.add("Antialiasing",W0);D.add("AudioExtension",Qu);D.add("AudioListener",vu);D.add("AudioSource",kt);D.add("AudioTrackHandler",ff);D.add("Avatar",Su);D.add("Avatar_Brain_LookAt",Sy);D.add("Avatar_MouthShapes",Y0);D.add("Avatar_MustacheShake",l2);D.add("Avatar_POI",Jl);D.add("AvatarBlink_Simple",Gf);D.add("AvatarEyeLook_Rotation",sh);D.add("AvatarLoader",c2);D.add("AvatarMarker",bn);D.add("AvatarModel",lE);D.add("AxesHelper",Um);D.add("BaseUIComponent",na);D.add("BasicIKConstraint",h2);D.add("BehaviorExtension",hE);D.add("BehaviorModel",hn);D.add("BloomEffect",Zl);D.add("BoxCollider",Hu);D.add("BoxGizmo",Vf);D.add("BoxHelperComponent",qo);D.add("Button",wh);D.add("CallInfo",Nl);D.add("Camera",Bt);D.add("CameraTargetReachedEvent",wy);D.add("Canvas",En);D.add("CanvasGroup",Eu);D.add("CapsuleCollider",fh);D.add("ChangeMaterialOnClick",Vl);D.add("ChangeTransformOnClick",Wf);D.add("CharacterController",qf);D.add("CharacterControllerInput",Ch);D.add("ChromaticAberration",tb);D.add("Collider",Eo);D.add("ColorAdjustments",Wu);D.add("ColorBySpeedModule",Xf);D.add("ColorOverLifetimeModule",sb);D.add("ContactShadows",yo);D.add("ControlTrackHandler",iE);D.add("CustomBranding",Yu);D.add("Deletable",L2);D.add("DeleteBox",_E);D.add("DepthOfField",hl);D.add("DeviceFlag",wE);D.add("DocumentExtension",F2);D.add("DragControls",_n);D.add("DropListener",Zu);D.add("Duplicatable",Eh);D.add("EffectWrapper",Fy);D.add("EmissionModule",gc);D.add("EmphasizeOnClick",Hm);D.add("EventList",$t);D.add("EventListEvent",KS);D.add("EventSystem",kr);D.add("EventTrigger",SE);D.add("FieldWithDefault",R2);D.add("FixedJoint",U2);D.add("FlyControls",N2);D.add("Fog",qm);D.add("GltfExport",Ua);D.add("GltfExportBox",G2);D.add("Gradient",qu);D.add("Graphic",$l);D.add("GraphicRaycaster",ZS);D.add("GridHelper",Xm);D.add("GridLayoutGroup",A2);D.add("GroundProjectedEnv",bh);D.add("GroupActionModel",Zc);D.add("HideOnStart",v2);D.add("HingeJoint",cb);D.add("HorizontalLayoutGroup",m2);D.add("Image",jm);D.add("InheritVelocityModule",mc);D.add("InputField",ho);D.add("InstanceHandle",gf);D.add("InstancingHandler",pf);D.add("Interactable",O2);D.add("Keyframe",ur);D.add("Light",Gr);D.add("LimitVelocityOverLifetimeModule",un);D.add("LODGroup",db);D.add("LODModel",Jf);D.add("LogStats",H2);D.add("LookAt",ec);D.add("LookAtConstraint",jf);D.add("MainModule",Es);D.add("MaskableGraphic",J0);D.add("MeshCollider",Hf);D.add("MeshRenderer",nb);D.add("MinMaxCurve",Ce);D.add("MinMaxGradient",wn);D.add("NeedleMenu",vc);D.add("NestedGltf",BE);D.add("Networking",gh);D.add("NoiseModule",Nt);D.add("ObjectRaycaster",xo);D.add("OffsetConstraint",Zf);D.add("OpenURL",Km);D.add("OrbitControls",Lt);D.add("Outline",zm);D.add("Padding",Vu);D.add("ParticleBurst",By);D.add("ParticleSubEmitter",NE);D.add("ParticleSystem",wi);D.add("ParticleSystemRenderer",aa);D.add("PhysicsExtension",vE);D.add("PixelationEffect",_b);D.add("PlayableDirector",$a);D.add("PlayAnimationOnClick",Wa);D.add("PlayAudioOnClick",Iu);D.add("PlayerColor",fm);D.add("PlayerState",Jn);D.add("PlayerSync",ju);D.add("PointerEventData",Om);D.add("PostProcessingHandler",zE);D.add("PreliminaryAction",Vm);D.add("PreliminaryTrigger",$0);D.add("PresentationMode",uY);D.add("RawImage",pE);D.add("Rect",f2);D.add("RectTransform",es);D.add("ReflectionProbe",Wl);D.add("RegisteredAnimationInfo",nE);D.add("RemoteSkybox",cc);D.add("Renderer",li);D.add("RendererLightmap",Iy);D.add("Rigidbody",It);D.add("RotationBySpeedModule",Io);D.add("RotationOverLifetimeModule",oa);D.add("SceneSwitcher",Pn);D.add("ScreenCapture",ed);D.add("ScreenSpaceAmbientOcclusion",Ih);D.add("ScreenSpaceAmbientOcclusionN8",dl);D.add("SetActiveOnClick",co);D.add("ShadowCatcher",xb);D.add("ShapeModule",Zt);D.add("SharpeningEffect",wb);D.add("SignalAsset",Q0);D.add("SignalReceiver",nh);D.add("SignalReceiverEvent",Fm);D.add("SignalTrackHandler",xy);D.add("Size",d2);D.add("SizeBySpeedModule",mr);D.add("SizeOverLifetimeModule",Xu);D.add("SkinnedMeshRenderer",B2);D.add("SmoothFollow",tl);D.add("SpatialGrabRaycaster",Au);D.add("SpatialHtml",Sb);D.add("SpatialTrigger",wu);D.add("SpatialTriggerReceiver",tc);D.add("SpectatorCamera",jE);D.add("SphereCollider",Nm);D.add("Sprite",Ac);D.add("SpriteData",el);D.add("SpriteRenderer",jr);D.add("SpriteSheet",Ru);D.add("SubEmitterSystem",jy);D.add("SyncedCamera",Af);D.add("SyncedRoom",fl);D.add("SyncedTransform",oc);D.add("TapGestureTrigger",y2);D.add("TeleportTarget",AE);D.add("TestRunner",aL);D.add("TestSimulateUserData",lL);D.add("Text",Zs);D.add("TextBuilder",yE);D.add("TextExtension",ob);D.add("TextureSheetAnimationModule",Is);D.add("TiltShiftEffect",bc);D.add("ToneMappingEffect",ac);D.add("TrailModule",Ci);D.add("TransformData",ln);D.add("TransformGizmo",ip);D.add("TriggerBuilder",$n);D.add("TriggerModel",Kl);D.add("UIRaycastUtils",$S);D.add("UIRootComponent",N0);D.add("UsageMarker",ab);D.add("USDZExporter",ai);D.add("USDZText",ru);D.add("USDZUIExtension",bE);D.add("VariantAction",WO);D.add("VelocityOverLifetimeModule",Pi);D.add("VerticalLayoutGroup",g2);D.add("VideoPlayer",In);D.add("Vignette",np);D.add("VisibilityAction",eb);D.add("Voip",Gu);D.add("Volume",Ib);D.add("VolumeParameter",me);D.add("VolumeProfile",V0);D.add("WebARCameraBackground",HE);D.add("WebARSessionRoot",ph);D.add("WebXR",Ai);D.add("WebXRImageTracking",oh);D.add("WebXRImageTrackingModel",_c);D.add("WebXRPlaneTracking",Rh);D.add("WebXRTrackedImage",ou);D.add("XRControllerFollow",Bh);D.add("XRControllerModel",lc);D.add("XRControllerMovement",Co);D.add("XRFlag",Yn);D.add("XRRig",VE);D.add("XRState",bs);const Rg=yn,dY=z("debugtypestore");dY&&console.log(D);function fY(n,t){const i=a6(n,t);return i!==void 0?i:null}const pY=new o6,Rw=Symbol("deserialize-queue");async function gY(n,t,e,i=null,s){if(!e)return;let r=i;typeof r=="number"&&(r=new Sn(i));const o=t.indexOf("?");t=o===-1?t:t.substring(0,o);const a=new nO(e.scene);a.gltfId=t,a.context=n,a.gltf=e,a.nodeToObject=s==null?void 0:s.nodeToObjectMap,a.implementationInformation=pY;let l=n[Rw];if(l||(l=n[Rw]=[]),e.scenes)for(const h of e.scenes)await _C(a,h,l);if(e.children)for(const h of e.children)await _C(a,h,l);n.new_scripts_pre_setup_callbacks.push(()=>{const h=n[Rw];if(h){for(const u of h)mY(u,a);h.length=0}if(r){const u={},d=[];bC(e,r,u,d);for(const f of e.scenes)bC(f,r,u,d);for(const f of d)f.resolveGuids(u)}})}const yC=Symbol("original-component-name"),vd=new Map;function bC(n,t,e,i){if(t===null||!n)return;const s=n.guid,r=n.guid;r!=null&&r.length&&(vd.has(r)||(Rg&&console.log('Creating InstanceIdProvider with key "'+r+'" for object '+n.name),vd.set(r,new Sn(r))));const o=r&&vd.get(r)||t;if(n.guid=o.generateUUID(),s&&s!=="invalid"&&(e[s]=n.guid),n&&n.userData&&n.userData.components)for(const a of n.userData.components){if(a===null)continue;const l=a.guid;l?vd.has(l)||(Rg&&console.log('Creating InstanceIdProvider with key "'+l+'" for component '+a[yC]),vd.set(l,new Sn(l))):Rg&&console.warn("Can not create IdProvider: component "+a[yC]+" has no guid",a.guid);const h=vd.get(l)||t,u=a.guid;a.guid=h.generateUUID(),u&&u!=="invalid"&&(e[u]=a.guid),a.resolveGuids&&i.push(a)}if(n.children)for(const a of n.children)bC(a,t,e,i)}const Dp=[];async function _C(n,t,e,i){if(!t)return;const s=t.userData;if(s){const r=s.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const a=D.get(o.name);if(a!=null){const l=new a;l.sourceId=n.gltfId,Mf(l,o,n.implementationInformation),l.context=n.context,"guid"in o&&(l[_v]=o.guid),l[yC]=o.name,uf(t,l,!1),e.push({instance:l,compData:o,obj:t}),l.isCamera&&n.context&&n.context.mainCamera===null&&l.tag==="MainCamera"&&n.context.setCurrentCamera(l)}else Rg&&console.debug("unknown component: "+o.name),Dp.includes(o.name)||Dp.push(o.name)}catch(a){console.error(o.name+" - "+a.message,a)}if(Dp.length>0){const o=Dp.join(", ");console.warn("unknown components: "+o),Dp.length=0,fr()&&bi(`<strong>Unknown components in scene</strong>:

${o}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,Xi.Warn)}}if(t.children)for(const r of t.children)await _C(n,r,e)}function mY(n,t){const{instance:e,compData:i,obj:s}=n;t.object=s,t.target=e,Ix(e,i,t),Rg&&console.debug("add "+i.name,i,e)}const wC=z("debugfileformat");async function AY(n,t=!0){var i;if(t){const s=n,r=new URL(s,globalThis.location.origin);let o=null;const a=r.searchParams.get("filetype");switch(a&&(o=a.toUpperCase()),o!=null&&o.length||(o=(i=r.pathname.split(".").pop())==null?void 0:i.toUpperCase()),console.debug("Use file extension to determine type: "+o),o){case"GLTF":return"gltf";case"VRM":return"vrm";case"GLB":return"glb";case"FBX":return"fbx";case"USD":return"usd";case"USDA":return"usda";case"USDZ":return"usdz";case"OBJ":return"obj"}}const e=await fetch(n,{method:"GET",headers:{range:"bytes=0-32"}}).catch(s=>null);if(e!=null&&e.ok){const s=await e.arrayBuffer(),r=vY(s);return wC&&console.log("Determined file type from header: "+r),r}return"unknown"}function vY(n){if(n.byteLength<4)return"unknown";const t=new Uint8Array(n);if(wC&&console.warn(`Trying to determine file type from binary data
`,'"'+new TextDecoder().decode(n)+`"
`,t),t[0]==103&&t[1]==108&&t[2]==84&&t[3]==70)return console.debug("GLTF detected"),"glb";if(t[0]==80&&t[1]==75&&t[2]==3&&t[3]==4)return console.debug("USDZ detected"),"usdz";if(t[0]==80&&t[1]==88&&t[2]==82&&t[3]==45&&t[4]==85&&t[5]==83&&t[6]==68&&t[7]==67)return console.debug("Binary USD detected"),"usd";if(t[0]==35&&t[1]==117&&t[2]==115&&t[3]==100&&t[4]==97)return console.debug("ASCII USD detected"),"usda";if(t[0]==75&&t[1]==97&&t[2]==121&&t[3]==100&&t[4]==97&&t[5]==114&&t[6]==97&&t[7]==32)return console.debug("Binary FBX detected"),"fbx";if(t[0]==59&&t[1]==32&&t[2]==70&&t[3]==66&&t[4]==88&&t[5]==32)return console.debug("ASCII FBX detected"),"fbx";if(t[0]==35&&t[1]==32&&t[2]==66&&t[3]==108&&t[4]==101&&t[5]==110&&t[6]==100&&t[7]==101&&t[8]==114&&t[9]==32)return console.debug("OBJ detected"),"obj";if(t[0]==35&&t[1]==32&&t[2]==65&&t[3]==108&&t[4]==105&&t[5]==97&&t[6]==115&&t[7]==32&&t[8]==79&&t[9]==66&&t[10]==74)return console.debug("OBJ detected"),"obj";if(t[0]==118&&t[1]==32||t[0]==102&&t[1]==32)return console.debug("OBJ detected (the file has no header and starts with vertex or face)"),"obj";if(t[0]==35&&t[1]==32&&t[2]==70&&t[3]==105&&t[4]==108&&t[5]==101&&t[6]==32&&t[7]==101&&t[8]==120&&t[9]==112&&t[10]==111&&t[11]==114&&t[12]==116&&t[13]==101&&t[14]==100&&t[15]==32&&t[16]==98&&t[17]==121&&t[18]==32&&t[19]==90&&t[20]==66&&t[21]==114&&t[22]==117&&t[23]==115&&t[24]==104)return console.debug("OBJ detected (exported by ZBrush)"),"obj";if(ve()||wC){const e=new TextDecoder().decode(n.slice(0,16));console.debug('Could not determine file type from binary data: "'+e+'..."',t)}else console.debug("Could not determine file type from binary data",t);return"unknown"}class uL{createBuiltinComponents(t,e,i,s,r){return gY(t,e,i,s,r)}writeBuiltinComponentData(t,e){return fY(t,e)}parseSync(t,e,i,s){return yY(t,e,i,s)}loadSync(t,e,i,s,r){return mL(t,e,i,s,r)}}VP(uL);const dL=z("printGltf")||z("printgltf"),fL=z("downloadgltf");var ah;(function(n){n[n.BeforeLoad=0]="BeforeLoad",n[n.AfterLoaded=1]="AfterLoaded",n[n.FinishedSetup=10]="FinishedSetup"})(ah||(ah={}));class vf{constructor(t,e,i,s){c(this,"context");c(this,"loader");c(this,"path");c(this,"gltf");this.context=t,this.path=e,this.loader=i,this.gltf=s}}const lh={};function xJ(n,t){lh[n]=lh[n]||[],lh[n].push(t)}function CJ(n,t){if(lh[n]){const e=lh[n].indexOf(t);e>=0&&lh[n].splice(e,1)}}function yf(n,t){if(lh[n])for(const e of lh[n])e(t)}async function pL(n,t,e,i,s){dL&&console.warn("glTF",t,e),t.includes("?")&&(t=t.split("?")[0]),await nl().createBuiltinComponents(n,t,e,i,s)}async function gL(n,t){const e=await AY(n)||"unknown";switch(console.debug("Determined file type: "+e+" for url",n),e){case"unknown":return console.warn("Unknown file type. Assuming glTF:",n),new rl;case"fbx":return new MO;case"obj":return new XS;case"usd":case"usda":case"usdz":return console.warn("USD files are not supported."),null;default:console.warn("Unknown file type:",e);case"gltf":case"glb":case"vrm":const i=new rl;return await S2(i,t,n),i}}async function yY(n,t,e,i){typeof e!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",e,typeof e),e=""),dL&&console.log("Parse glTF",e);const s=await gL(e,n);if(!s)return;if(s instanceof XS){typeof t!="string"&&(t=new TextDecoder().decode(t));const o=s.parse(t);return{animations:o.animations,scene:o,scenes:[o]}}if(!(s instanceof rl)){const o=s.parse(t,e);return yL(s,o),{animations:o.animations,scene:o,scenes:[o]}}const r=C2(s);return new Promise((o,a)=>{try{let l=e.split("?")[0].trimEnd();if(l.endsWith(".glb")||l.endsWith(".gltf")){const u=l.split("/");u.pop(),l=u.join("/"),l.endsWith("/")||(l+="/")}s.resourcePath=l,F0(s,n),yf(ah.BeforeLoad,new vf(n,e,s));const h=n.mainCamera;s.parse(t,"",async u=>{I2(e,u,n),yf(ah.AfterLoaded,new vf(n,e,s,u)),await pL(n,e,u,i,r),await AL(u.scene,n,h),yf(ah.FinishedSetup,new vf(n,e,s,u)),o(u),fL&&vL(t)},u=>{console.error('Loading asset at "'+e+`" failed
`,u),o(void 0)})}catch(l){console.error(l),a(l)}})}async function mL(n,t,e,i,s){bY(t);const r=await gL(t,n);if(!r)return;if(!(r instanceof rl)){const a=await r.loadAsync(t,s);return yL(r,a),{animations:a.animations,scene:a,scenes:[a]}}const o=C2(r);return new Promise((a,l)=>{try{F0(r,n),yf(ah.BeforeLoad,new vf(n,t,r));const h=n.mainCamera;r.load(t,async u=>{I2(t,u,n),yf(ah.AfterLoaded,new vf(n,t,r,u)),await pL(n,e,u,i,o),await AL(u.scene,n,h),yf(ah.FinishedSetup,new vf(n,t,r,u)),a(u),fL&&vL(t)},u=>{s==null||s.call(r,u)},u=>{console.error('Loading asset at "'+t+`" failed
`,u),a(void 0)})}catch(h){console.error(h),l(h)}})}async function AL(n,t,e){e||(e=t.mainCamera);try{e?await t.renderer.compileAsync(n,e,t.scene).catch(i=>{console.warn(i.message)}):P5(n,t)}catch(i){console.warn((i==null?void 0:i.message)||i)}}function bY(n){if(new URL(n,window.location.href).href.startsWith("file://")){const e=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;bi(e),console.warn(e)}}function vL(n){if(typeof n=="string"){const t=document.createElement("a");t.href=n,t.download=n.split("/").pop(),t.click()}else{const t=new Blob([n],{type:"application/octet-stream"}),e=window.URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download="download.glb",i.click()}}function yL(n,t){if(t!=null&&t.isObject3D){const e=t;n instanceof MO?e.traverse(i=>{const s=i;s!=null&&s.isMesh&&KM(s,s.material)}):n instanceof XS&&e.traverse(i=>{})}}VP(uL);const Ti=z("debugwebcomponent"),eP="needle-engine",bL="vr",_L="desktop",_Y=[BO,bL,_L],Op="ar-session-active",Lp="desktop-session-active",wY=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath","tone-mapping","tone-mapping-exposure","background-blurriness","background-color"];class wL extends HTMLElement{constructor(){super();c(this,"_context");c(this,"_overlay_ar");c(this,"_loadingProgress01",0);c(this,"_loadingView");c(this,"_previousSrc",null);c(this,"_didFullyLoad",!1);c(this,"_loadId",0);c(this,"_abortController",null);c(this,"_lastSourceFiles",null);c(this,"_createContextPromise",null);c(this,"onXRSessionStarted",()=>{var i;const e=this.context.xrSessionMode;e==="immersive-ar"?this.onEnterAR(this.context.xrSession):e==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:e}})),e==="immersive-ar"?this.onExitAR(this.context.xrSession):e==="immersive-vr"&&this.onExitVR(this.context.xrSession)})});c(this,"onReady",()=>{var e;return(e=this._loadingView)==null?void 0:e.onLoadingFinished()});c(this,"onError",()=>{var e;return(e=this._loadingView)==null?void 0:e.setMessage("Loading failed!")});c(this,"_previouslyRegisteredMap",new Map);this._overlay_ar=new XH,this.addEventListener("ready",this.onReady),SO(),this.attachShadow({mode:"open"});const e=document.createElement("template");e.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        touch-action: none;

        -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }
    :host canvas {   
        position: absolute;
        user-select: none;
        -webkit-user-select: none;

        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
        
        -webkit-touch-callout: none;
        -webkit-user-drag: none;
        -webkit-user-modify: none;
    }
    :host .content {
        position: absolute;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(e.content.cloneNode(!0)),this._context=new je({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return wY}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const e=this.getAttribute("camera-controls");return e==null?null:!(e===null||e==="False"||e==="false"||e==="0")}getContext(){return new Promise((e,i)=>{if(this._context&&this.loadingFinished)e(this._context);else{const s=()=>{this.removeEventListener("loadfinished",s),this._context&&this.loadingFinished&&e(this._context)};this.addEventListener("loadfinished",s)}})}get context(){return this._context}async connectedCallback(){if(Ti&&console.log("<needle-engine> connected"),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];Ti&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(Ti&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}Ti&&console.log("src",this.getAttribute("src"));const e=this._loadId;setTimeout(()=>{this.isConnected!==!1&&e===this._loadId&&this.onLoad()},1),Xo!=null&&Xo.length&&this.setAttribute("version",Xo)}disconnectedCallback(){var s;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const e=this.getAttribute("keep-alive"),i=e==null||(e==null?void 0:e.length)>0&&e!=="true"&&e!=="1";Ti&&console.warn('<needle-engine> disconnected, keep-alive: "'+e+'"',typeof e,"Dispose=",i),i?(Ti&&console.warn("<needle-engine> dispose"),(s=this._context)==null||s.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):Ti&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(e,i,s){switch(Ti&&console.log("attributeChangedCallback",e,i,s),e){case"src":Ti&&console.warn(`<needle-engine src>
changed from "`,i,'" to "',s,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=s);break;case"loadstart":case"progress":case"loadfinished":typeof s=="string"&&s.length>0&&(Ti&&console.log(e+" attribute changed",s),this.registerEventFromAttribute(e,s));break;case"dracoDecoderPath":Ti&&console.log("dracoDecoderPath",s),YT(s);break;case"dracoDecoderType":s==="wasm"||s==="js"?(Ti&&console.log("dracoDecoderType",s),KT(s)):console.error("Invalid dracoDecoderType",s,"expected js or wasm");break;case"ktx2DecoderPath":Ti&&console.log("ktx2DecoderPath",s),JT(s);break;case"tone-mapping":{this.applyAttributes();break}case"tone-mapping-exposure":{this.applyAttributes();break}case"background-blurriness":{const r=parseFloat(s);r!=null&&this._context&&(this._context.scene.backgroundBlurriness=r);break}case"background-color":{this.applyAttributes();break}}}async onLoad(){var m,v;if(!this.isConnected)return;if(this._context||(Ti&&console.warn("Create new context"),this._context=new je({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const e=this.getSourceFiles();if(!this.checkIfSourceHasChanged(e,this._lastSourceFiles))return;this._abortController&&(Ti&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=e;const i=++this._loadId;if((e==null||e.length<=0)&&(Ti&&console.warn("Clear scene",e),this._context.clear(),i!==this._loadId))return;const s=this.getAttribute("alias");this.classList.add("loading");const r=th();this.ensureLoadStartIsRegistered();let o=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:s},cancelable:!0}));if(r){const y=this.getAttribute("hide-loading-overlay");y!=null&&y!=="0"&&(o=!1)}o===!1&&!r&&(ve()||(o=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),ve()&&qt('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&o&&(this._loadingView=new Fv(this)),o&&(this._didFullyLoad!==!0?(m=this._loadingView)==null||m.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===i&&this._loadingView.onLoadingBegin("begin load")},300)),Ti&&console.warn(`--------------
Needle Engine: Begin loading `+i+`
`,e),this.onBeforeBeginLoading();const a=[],l={context:this._context,name:"",progress:{},index:0,count:e.length,totalProgress01:this._loadingProgress01},h=new CustomEvent("progress",{detail:l}),u=new Array,d=new AbortController;this._abortController=d;const f={files:e,abortSignal:d.signal,onLoadingProgress:y=>{var _;if(d.signal.aborted)return;const b=y.index;!u[b]&&y.name&&(u[b]=xY(y.name)),y.name=u[b],o&&((_=this._loadingView)==null||_.onLoadingUpdate(y)),l.name=y.name,l.progress=y.progress,this._loadingProgress01=RO(y),l.totalProgress01=this._loadingProgress01,this.dispatchEvent(h)},onLoadingFinished:(y,b,_)=>{d.signal.aborted||_&&a.push({src:b,file:_})}},p=this.getAttribute("hash");p!=null&&(this._context.hash=p),this._context.alias=s,this._createContextPromise=this._context.create(f);const g=await this._createContextPromise;if(this.applyAttributes(),Ti&&console.warn(`--------------
Needle Engine: finished loading `+i+`
`,e,`Aborted? ${d.signal.aborted}`),this._loadId!==i||d.signal.aborted){console.log("Loading finished but aborted...");return}this._loadingProgress01=1,o&&g&&((v=this._loadingView)==null||v.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:s,loadedFiles:a}}))}applyAttributes(){if(this._context.renderer){const s=this.getAttribute("tonemapping")||this.getAttribute("tone-mapping");switch(s==null?void 0:s.toLowerCase()){case"none":this._context.renderer.toneMapping=Cf;break;case"linear":this._context.renderer.toneMapping=h0;break;case"neutral":this._context.renderer.toneMapping=Qg;break;case"agx":this._context.renderer.toneMapping=c0;break;default:s!=null&&console.warn("Invalid tone-mapping attribute: "+s)}const r=this.getAttribute("tone-mapping-exposure");if(r!=null){const o=parseFloat(r);isNaN(o)||(this._context.renderer.toneMappingExposure=o)}}const e=this.getAttribute("background-blurriness");if(e!=null){const s=parseFloat(e);s!==void 0&&this._context&&(this._context.scene.backgroundBlurriness=s)}const i=this.getAttribute("background-color");if(this._context&&typeof i=="string"&&i.length>0){const s=this._context.scene.background;s instanceof be?s.set(i):this._context.scene.background=new be(i)}}internalSetLoadingMessage(e){var i;(i=this._loadingView)==null||i.setMessage(e)}getSourceFiles(){const e=this.getAttribute("src");if(!e)return[];let i;Array.isArray(e)?i=e:e.startsWith("[")&&e.endsWith("]")?i=JSON.parse(e):e.includes(",")?i=e.split(","):i=[e];for(let s=i.length-1;s>=0;s--){const r=i[s];(r==="null"||r==="undefined"||(r==null?void 0:r.length)<=0)&&i.splice(s,1)}return i}checkIfSourceHasChanged(e,i){if((e==null?void 0:e.length)!==(i==null?void 0:i.length)||e==null&&i!==null||e!==null&&i==null)return!0;if(e!==null&&i!==null){for(let s=0;s<(e==null?void 0:e.length);s++)if(e[s]!==i[s])return!0}return!1}ensureLoadStartIsRegistered(){const e=this.getAttribute("loadstart");e&&this.registerEventFromAttribute("loadstart",e)}registerEventFromAttribute(e,i){const s=this._previouslyRegisteredMap.get(e);if(s&&(this._previouslyRegisteredMap.delete(e),this.removeEventListener(e,s)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(e,r),this.addEventListener(e,o=>r==null?void 0:r.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+e+'="'+i+`" failed with the following error:
`,r)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let e=0;e<this.children.length;e++){const i=this.children[e];if(i.classList.contains("vr"))return i}return null}onEnterAR(e){var s;this.onSetupAR();const i=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,i,e),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:e,context:this._context,htmlContainer:(s=this._overlay_ar)==null?void 0:s.ARContainer}}))}onExitAR(e){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:e,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(e){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:e,context:this._context}}))}onExitVR(e){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:e,context:this._context}}))}onSetupAR(){this.classList.add(Op),this.classList.remove(Lp);const e=this.getAROverlayContainer();Ti&&console.warn("onSetupAR:",e),e&&(e.classList.add(Op),e.classList.remove(Lp)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,BO))}onSetupVR(){this.classList.remove(Op),this.classList.remove(Lp),this.foreachHtmlElement(e=>this.setupElementsForMode(e,bL))}onSetupDesktop(){this.classList.remove(Op),this.classList.add(Lp);const e=this.getAROverlayContainer();e&&(e.classList.remove(Op),e.classList.add(Lp)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,_L))}setupElementsForMode(e,i,s=null){var o,a;if(e===((a=(o=this._context)==null?void 0:o.renderer)==null?void 0:a.domElement)||e.id==="VRButton"||e.id==="ARButton")return;if(e.classList.contains(i))e.style.visibility="visible",e.style.display==="none"&&(e.style.display="block");else for(const l of _Y)e.classList.contains(l)&&(e.style.visibility="hidden",e.style.display="none")}foreachHtmlElement(e){for(let i=0;i<this.children.length;i++){const s=this.children[i];s.style&&e(s)}}onBeforeBeginLoading(){const e=this.getAttribute("dracoDecoderPath");e&&(Ti&&console.log("using custom draco decoder path",e),YT(e));const i=this.getAttribute("dracoDecoderType");i&&(Ti&&console.log("using custom draco decoder type",i),KT(i));const s=this.getAttribute("ktx2DecoderPath");s&&(Ti&&console.log("using custom ktx2 decoder path",s),JT(s))}}typeof window<"u"&&!window.customElements.get(eP)&&window.customElements.define(eP,wL);function xY(n){if(n.startsWith("blob:"))return"blob";const t=n.split("/");let e=t[t.length-1];const i=e.indexOf("?");i>0&&(e=e.substring(0,i));const s=e.indexOf("=");s>0&&(e=e.substring(s));const r=e.split(".").pop(),a=r?["glb","gltf","usdz","usd","fbx","obj","mtl"].indexOf(r.toLowerCase()):-1;if(r&&a>=0&&(e=e.substring(0,e.length-r.length-1)),e=decodeURIComponent(e),e.length>3){let l="",h=!1;const u=["(",")","[","]","{","}",":",";",",",".","!","?"];for(let d=0;d<e.length;d++){let f=e[d];(f==="_"||f==="-")&&(f=" "),!(f===" "&&l.length<=0||u.includes(f)||(l.length===0&&(f=f.toUpperCase()),h&&f===" "))&&(h&&(f=f.toUpperCase()),h=!1,l+=f,f===" "&&(h=!0))}return console.debug('Generated display name: "'+e+'" â†’ "'+l+'"'),l.trim()}return console.debug("Loading: use default name",e),e}const CY=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:wL},Symbol.toStringTag,{value:"Module"}));function SY(){Ja.registerWaitForAllowAudio(()=>{const n=oU.getContext();n.addEventListener("statechange",()=>{setTimeout(()=>{const t=n.state;(t==="suspended"||t==="interrupted")&&n.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(e=>{console.log("Failed to resume AudioContext: "+e)})},500)})})}setTimeout(SY,1e3);const Hv=z("debughotreload");let pm=!1;const Bg=new Map;function SJ(){return pm}function EJ(n){var i;if(pm)return;const e=n.constructor.name;Bg.has(e)?(i=Bg.get(e))==null||i.push(n):Bg.set(e,[n])}function IJ(n){if(pm)return;const e=n.constructor.name,i=Bg.get(e);if(!i)return;const s=i.indexOf(n);s!==-1&&i.splice(s,1)}let tP=!1;function EY(){if(Hv||tP)return;tP=!0;const n=console.error;console.error=(...t)=>{if(t.length){const e=t[0];if(typeof e=="string"&&e.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}n.apply(console,t)}}function TJ(n){Hv&&console.log("[HMR] Apply changes",n,Object.keys(n)),EY();for(const t of Object.keys(n))try{pm=!0;const e=D.get(t);if(!e){Hv&&console.log("[HMR] Type not found: "+t);continue}const i=n[t],s=Bg.get(i.name);let r="[Needle Engine] Updating type: "+t;const o=(s==null?void 0:s.length)??-1;o>0?r+=" x"+o:r+=" - no instances",console.log(r);const a=Object.getOwnPropertyNames(e.prototype),l=Object.getOwnPropertyDescriptors(i.prototype);for(const h in l)l[h].writable&&(e.prototype[h]=n[t].prototype[h]);for(const h of a)l[h]||delete e.prototype[h];if(s){const h=new i,u=Object.getOwnPropertyDescriptors(h);for(const d of s){const f=d,p=f.isComponent===!0,g=p?f.activeAndEnabled:!0,m=p?f.context:void 0;try{if(p&&m&&Ul(f,m),p&&g&&(f.enabled=!1),d.onBeforeHotReloadFields&&d.onBeforeHotReloadFields()===!1)continue;for(const v in u)if(u[v].writable){if(d[v]===void 0)d[v]=h[v];else if(typeof d[v]=="function"&&!d[v].prototype){const b=d[v],_=b.name,x="bound ";if(_===x)continue;const S=b.name.substring(x.length),E=i.prototype[S];E&&(d[v]=E.bind(d))}}d.onAfterHotReloadFields&&d.onAfterHotReloadFields()}finally{p&&m&&kS(f,m),p&&g&&(f.enabled=!0)}}}}catch(e){if(Hv)console.error(e);else return!1}finally{pm=!1,Qa(Xi.Log,"Script changes applied (HMR)")}return!0}let le;const gm=new Array(128).fill(void 0);gm.push(void 0,null,!0,!1);gm.length;let dv=null;function iP(){return dv!==null&&dv.byteLength!==0||(dv=new Int32Array(le.memory.buffer)),dv}const IY=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&IY.decode();function Ie(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`);return n.ptr}let fv=null;function TY(){return fv!==null&&fv.byteLength!==0||(fv=new Float32Array(le.memory.buffer)),fv}let Pg=128;function nP(n){if(Pg==1)throw new Error("out of js stack");return gm[--Pg]=n,Pg}let pv=null;function RY(){return pv!==null&&pv.byteLength!==0||(pv=new Uint32Array(le.memory.buffer)),pv}let Sr=0;function Hh(n,t){const e=t(4*n.length,4)>>>0;return TY().set(n,e/4),Sr=n.length,e}function gv(n,t){const e=t(4*n.length,4)>>>0;return RY().set(n,e/4),Sr=n.length,e}const Qn=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});class BY{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_raweventqueue_free(t)}constructor(t){const e=le.raweventqueue_new(t);return this.__wbg_ptr=e>>>0,this}drainCollisionEvents(t){try{le.raweventqueue_drainCollisionEvents(this.__wbg_ptr,nP(t))}finally{gm[Pg++]=void 0}}drainContactForceEvents(t){try{le.raweventqueue_drainContactForceEvents(this.__wbg_ptr,nP(t))}finally{gm[Pg++]=void 0}}clear(){le.raweventqueue_clear(this.__wbg_ptr)}}class As{static __wrap(t){t>>>=0;const e=Object.create(As.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_rawgenericjoint_free(t)}static generic(t,e,i,s){Ie(t,xe),Ie(e,xe),Ie(i,xe);const r=le.rawgenericjoint_generic(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s);return r===0?void 0:As.__wrap(r)}static spring(t,e,i,s,r){Ie(s,xe),Ie(r,xe);const o=le.rawgenericjoint_spring(t,e,i,s.__wbg_ptr,r.__wbg_ptr);return As.__wrap(o)}static rope(t,e,i){Ie(e,xe),Ie(i,xe);const s=le.rawgenericjoint_rope(t,e.__wbg_ptr,i.__wbg_ptr);return As.__wrap(s)}static spherical(t,e){Ie(t,xe),Ie(e,xe);const i=le.rawgenericjoint_spherical(t.__wbg_ptr,e.__wbg_ptr);return As.__wrap(i)}static prismatic(t,e,i,s,r,o){Ie(t,xe),Ie(e,xe),Ie(i,xe);const a=le.rawgenericjoint_prismatic(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s,r,o);return a===0?void 0:As.__wrap(a)}static fixed(t,e,i,s){Ie(t,xe),Ie(e,qn),Ie(i,xe),Ie(s,qn);const r=le.rawgenericjoint_fixed(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr);return As.__wrap(r)}static revolute(t,e,i){Ie(t,xe),Ie(e,xe),Ie(i,xe);const s=le.rawgenericjoint_revolute(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr);return s===0?void 0:As.__wrap(s)}}class WE{static __wrap(t){t>>>=0;const e=Object.create(WE.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_rawpointprojection_free(t)}point(){const t=le.rawpointprojection_point(this.__wbg_ptr);return xe.__wrap(t)}isInside(){return le.rawpointprojection_isInside(this.__wbg_ptr)!==0}}class qE{static __wrap(t){t>>>=0;const e=Object.create(qE.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_rawrayintersection_free(t)}normal(){const t=le.rawraycolliderintersection_normal(this.__wbg_ptr);return xe.__wrap(t)}toi(){return le.rawraycolliderintersection_toi(this.__wbg_ptr)}featureType(){return le.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const i=le.__wbindgen_add_to_stack_pointer(-16);le.rawpointcolliderprojection_featureId(i,this.__wbg_ptr);var t=iP()[i/4+0],e=iP()[i/4+1];return t===0?void 0:e>>>0}finally{le.__wbindgen_add_to_stack_pointer(16)}}}class qn{static __wrap(t){t>>>=0;const e=Object.create(qn.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_rawrotation_free(t)}constructor(t,e,i,s){const r=le.rawrotation_new(t,e,i,s);return this.__wbg_ptr=r>>>0,this}static identity(){const t=le.rawrotation_identity();return qn.__wrap(t)}get x(){return le.rawrotation_x(this.__wbg_ptr)}get y(){return le.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return le.rawraycolliderintersection_toi(this.__wbg_ptr)}get w(){return le.rawintegrationparameters_erp(this.__wbg_ptr)}}class Ze{static __wrap(t){t>>>=0;const e=Object.create(Ze.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_rawshape_free(t)}static cuboid(t,e,i){const s=le.rawshape_cuboid(t,e,i);return Ze.__wrap(s)}static roundCuboid(t,e,i,s){const r=le.rawshape_roundCuboid(t,e,i,s);return Ze.__wrap(r)}static ball(t){const e=le.rawshape_ball(t);return Ze.__wrap(e)}static halfspace(t){Ie(t,xe);const e=le.rawshape_halfspace(t.__wbg_ptr);return Ze.__wrap(e)}static capsule(t,e){const i=le.rawshape_capsule(t,e);return Ze.__wrap(i)}static cylinder(t,e){const i=le.rawshape_cylinder(t,e);return Ze.__wrap(i)}static roundCylinder(t,e,i){const s=le.rawshape_roundCylinder(t,e,i);return Ze.__wrap(s)}static cone(t,e){const i=le.rawshape_cone(t,e);return Ze.__wrap(i)}static roundCone(t,e,i){const s=le.rawshape_roundCone(t,e,i);return Ze.__wrap(s)}static polyline(t,e){const i=Hh(t,le.__wbindgen_malloc),s=Sr,r=gv(e,le.__wbindgen_malloc),o=Sr,a=le.rawshape_polyline(i,s,r,o);return Ze.__wrap(a)}static trimesh(t,e){const i=Hh(t,le.__wbindgen_malloc),s=Sr,r=gv(e,le.__wbindgen_malloc),o=Sr,a=le.rawshape_trimesh(i,s,r,o);return Ze.__wrap(a)}static heightfield(t,e,i,s){const r=Hh(i,le.__wbindgen_malloc),o=Sr;Ie(s,xe);const a=le.rawshape_heightfield(t,e,r,o,s.__wbg_ptr);return Ze.__wrap(a)}static segment(t,e){Ie(t,xe),Ie(e,xe);const i=le.rawshape_segment(t.__wbg_ptr,e.__wbg_ptr);return Ze.__wrap(i)}static triangle(t,e,i){Ie(t,xe),Ie(e,xe),Ie(i,xe);const s=le.rawshape_triangle(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr);return Ze.__wrap(s)}static roundTriangle(t,e,i,s){Ie(t,xe),Ie(e,xe),Ie(i,xe);const r=le.rawshape_roundTriangle(t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s);return Ze.__wrap(r)}static convexHull(t){const e=Hh(t,le.__wbindgen_malloc),i=Sr,s=le.rawshape_convexHull(e,i);return s===0?void 0:Ze.__wrap(s)}static roundConvexHull(t,e){const i=Hh(t,le.__wbindgen_malloc),s=Sr,r=le.rawshape_roundConvexHull(i,s,e);return r===0?void 0:Ze.__wrap(r)}static convexMesh(t,e){const i=Hh(t,le.__wbindgen_malloc),s=Sr,r=gv(e,le.__wbindgen_malloc),o=Sr,a=le.rawshape_convexMesh(i,s,r,o);return a===0?void 0:Ze.__wrap(a)}static roundConvexMesh(t,e,i){const s=Hh(t,le.__wbindgen_malloc),r=Sr,o=gv(e,le.__wbindgen_malloc),a=Sr,l=le.rawshape_roundConvexMesh(s,r,o,a,i);return l===0?void 0:Ze.__wrap(l)}castShape(t,e,i,s,r,o,a,l,h){Ie(t,xe),Ie(e,qn),Ie(i,xe),Ie(s,Ze),Ie(r,xe),Ie(o,qn),Ie(a,xe);const u=le.rawshape_castShape(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l,h);return u===0?void 0:YE.__wrap(u)}intersectsShape(t,e,i,s,r){return Ie(t,xe),Ie(e,qn),Ie(i,Ze),Ie(s,xe),Ie(r,qn),le.rawshape_intersectsShape(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr)!==0}contactShape(t,e,i,s,r,o){Ie(t,xe),Ie(e,qn),Ie(i,Ze),Ie(s,xe),Ie(r,qn);const a=le.rawshape_contactShape(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o);return a===0?void 0:XE.__wrap(a)}containsPoint(t,e,i){return Ie(t,xe),Ie(e,qn),Ie(i,xe),le.rawshape_containsPoint(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr)!==0}projectPoint(t,e,i,s){Ie(t,xe),Ie(e,qn),Ie(i,xe);const r=le.rawshape_projectPoint(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s);return WE.__wrap(r)}intersectsRay(t,e,i,s,r){return Ie(t,xe),Ie(e,qn),Ie(i,xe),Ie(s,xe),le.rawshape_intersectsRay(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r)!==0}castRay(t,e,i,s,r,o){return Ie(t,xe),Ie(e,qn),Ie(i,xe),Ie(s,xe),le.rawshape_castRay(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r,o)}castRayAndGetNormal(t,e,i,s,r,o){Ie(t,xe),Ie(e,qn),Ie(i,xe),Ie(s,xe);const a=le.rawshape_castRayAndGetNormal(this.__wbg_ptr,t.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r,o);return a===0?void 0:qE.__wrap(a)}}class XE{static __wrap(t){t>>>=0;const e=Object.create(XE.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_rawshapecontact_free(t)}distance(){return le.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const t=le.rawpointprojection_point(this.__wbg_ptr);return xe.__wrap(t)}point2(){const t=le.rawraycolliderintersection_normal(this.__wbg_ptr);return xe.__wrap(t)}normal1(){const t=le.rawshapecollidertoi_witness2(this.__wbg_ptr);return xe.__wrap(t)}normal2(){const t=le.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return xe.__wrap(t)}}class YE{static __wrap(t){t>>>=0;const e=Object.create(YE.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_rawshapetoi_free(t)}toi(){return le.rawrotation_x(this.__wbg_ptr)}witness1(){const t=le.rawshapetoi_witness1(this.__wbg_ptr);return xe.__wrap(t)}witness2(){const t=le.rawcontactforceevent_total_force(this.__wbg_ptr);return xe.__wrap(t)}normal1(){const t=le.rawshapetoi_normal1(this.__wbg_ptr);return xe.__wrap(t)}normal2(){const t=le.rawshapetoi_normal2(this.__wbg_ptr);return xe.__wrap(t)}}class xe{static __wrap(t){t>>>=0;const e=Object.create(xe.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();le.__wbg_rawvector_free(t)}static zero(){const t=le.rawvector_zero();return xe.__wrap(t)}constructor(t,e,i){const s=le.rawvector_new(t,e,i);return this.__wbg_ptr=s>>>0,this}get x(){return le.rawrotation_x(this.__wbg_ptr)}set x(t){le.rawvector_set_x(this.__wbg_ptr,t)}get y(){return le.rawintegrationparameters_dt(this.__wbg_ptr)}set y(t){le.rawintegrationparameters_set_dt(this.__wbg_ptr,t)}get z(){return le.rawraycolliderintersection_toi(this.__wbg_ptr)}set z(t){le.rawvector_set_z(this.__wbg_ptr,t)}xyz(){const t=le.rawvector_xyz(this.__wbg_ptr);return xe.__wrap(t)}yxz(){const t=le.rawvector_yxz(this.__wbg_ptr);return xe.__wrap(t)}zxy(){const t=le.rawvector_zxy(this.__wbg_ptr);return xe.__wrap(t)}xzy(){const t=le.rawvector_xzy(this.__wbg_ptr);return xe.__wrap(t)}yzx(){const t=le.rawvector_yzx(this.__wbg_ptr);return xe.__wrap(t)}zyx(){const t=le.rawvector_zyx(this.__wbg_ptr);return xe.__wrap(t)}}class PY{constructor(t,e,i){this.x=t,this.y=e,this.z=i}}class se{static new(t,e,i){return new PY(t,e,i)}static intoRaw(t){return new xe(t.x,t.y,t.z)}static zeros(){return se.new(0,0,0)}static fromRaw(t){if(!t)return null;let e=se.new(t.x,t.y,t.z);return t.free(),e}static copy(t,e){t.x=e.x,t.y=e.y,t.z=e.z}}class sP{constructor(t,e,i,s){this.x=t,this.y=e,this.z=i,this.w=s}}class Kt{static identity(){return new sP(0,0,0,1)}static fromRaw(t){if(!t)return null;let e=new sP(t.x,t.y,t.z,t.w);return t.free(),e}static intoRaw(t){return new qn(t.x,t.y,t.z,t.w)}static copy(t,e){t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w}}class MY{constructor(t){this.elements=t}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class rP{static fromRaw(t){const e=new MY(t.elements());return t.free(),e}}var Mg,ds,oP,aP,Vi,xC,zi,lP,Hy,CC,cP,Vy,Wd;(function(n){n[n.Dynamic=0]="Dynamic",n[n.Fixed=1]="Fixed",n[n.KinematicPositionBased=2]="KinematicPositionBased",n[n.KinematicVelocityBased=3]="KinematicVelocityBased"})(Mg||(Mg={}));class hP{constructor(t,e,i){this.rawSet=t,this.colliderSet=e,this.handle=i}finalizeDeserialization(t){this.colliderSet=t}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(t,e){return this.rawSet.rbLockTranslations(this.handle,t,e)}lockRotations(t,e){return this.rawSet.rbLockRotations(this.handle,t,e)}setEnabledTranslations(t,e,i,s){return this.rawSet.rbSetEnabledTranslations(this.handle,t,e,i,s)}restrictTranslations(t,e,i,s){this.setEnabledTranslations(t,e,i,s)}setEnabledRotations(t,e,i,s){return this.rawSet.rbSetEnabledRotations(this.handle,t,e,i,s)}restrictRotations(t,e,i,s){this.setEnabledRotations(t,e,i,s)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(t){this.rawSet.rbSetDominanceGroup(this.handle,t)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(t){this.rawSet.rbSetAdditionalSolverIterations(this.handle,t)}enableCcd(t){this.rawSet.rbEnableCcd(this.handle,t)}translation(){let t=this.rawSet.rbTranslation(this.handle);return se.fromRaw(t)}rotation(){let t=this.rawSet.rbRotation(this.handle);return Kt.fromRaw(t)}nextTranslation(){let t=this.rawSet.rbNextTranslation(this.handle);return se.fromRaw(t)}nextRotation(){let t=this.rawSet.rbNextRotation(this.handle);return Kt.fromRaw(t)}setTranslation(t,e){this.rawSet.rbSetTranslation(this.handle,t.x,t.y,t.z,e)}setLinvel(t,e){let i=se.intoRaw(t);this.rawSet.rbSetLinvel(this.handle,i,e),i.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(t,e){this.rawSet.rbSetGravityScale(this.handle,t,e)}setRotation(t,e){this.rawSet.rbSetRotation(this.handle,t.x,t.y,t.z,t.w,e)}setAngvel(t,e){let i=se.intoRaw(t);this.rawSet.rbSetAngvel(this.handle,i,e),i.free()}setNextKinematicTranslation(t){this.rawSet.rbSetNextKinematicTranslation(this.handle,t.x,t.y,t.z)}setNextKinematicRotation(t){this.rawSet.rbSetNextKinematicRotation(this.handle,t.x,t.y,t.z,t.w)}linvel(){return se.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return se.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return se.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return se.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return se.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return se.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return se.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return Kt.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return rP.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return rP.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(t){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,t))}setEnabled(t){this.rawSet.rbSetEnabled(this.handle,t)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(t,e){return this.rawSet.rbSetBodyType(this.handle,t,e)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(t){this.rawSet.rbSetLinearDamping(this.handle,t)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(t,e){this.rawSet.rbSetAdditionalMass(this.handle,t,e)}setAdditionalMassProperties(t,e,i,s,r){let o=se.intoRaw(e),a=se.intoRaw(i),l=Kt.intoRaw(s);this.rawSet.rbSetAdditionalMassProperties(this.handle,t,o,a,l,r),o.free(),a.free(),l.free()}setAngularDamping(t){this.rawSet.rbSetAngularDamping(this.handle,t)}resetForces(t){this.rawSet.rbResetForces(this.handle,t)}resetTorques(t){this.rawSet.rbResetTorques(this.handle,t)}addForce(t,e){const i=se.intoRaw(t);this.rawSet.rbAddForce(this.handle,i,e),i.free()}applyImpulse(t,e){const i=se.intoRaw(t);this.rawSet.rbApplyImpulse(this.handle,i,e),i.free()}addTorque(t,e){const i=se.intoRaw(t);this.rawSet.rbAddTorque(this.handle,i,e),i.free()}applyTorqueImpulse(t,e){const i=se.intoRaw(t);this.rawSet.rbApplyTorqueImpulse(this.handle,i,e),i.free()}addForceAtPoint(t,e,i){const s=se.intoRaw(t),r=se.intoRaw(e);this.rawSet.rbAddForceAtPoint(this.handle,s,r,i),s.free(),r.free()}applyImpulseAtPoint(t,e,i){const s=se.intoRaw(t),r=se.intoRaw(e);this.rawSet.rbApplyImpulseAtPoint(this.handle,s,r,i),s.free(),r.free()}}(function(n){n[n.Revolute=0]="Revolute",n[n.Fixed=1]="Fixed",n[n.Prismatic=2]="Prismatic",n[n.Rope=3]="Rope",n[n.Spring=4]="Spring",n[n.Spherical=5]="Spherical",n[n.Generic=6]="Generic"})(ds||(ds={})),function(n){n[n.AccelerationBased=0]="AccelerationBased",n[n.ForceBased=1]="ForceBased"}(oP||(oP={})),function(n){n[n.X=1]="X",n[n.Y=2]="Y",n[n.Z=4]="Z",n[n.AngX=8]="AngX",n[n.AngY=16]="AngY",n[n.AngZ=32]="AngZ"}(aP||(aP={}));class Pl{constructor(){}static fixed(t,e,i,s){let r=new Pl;return r.anchor1=t,r.anchor2=i,r.frame1=e,r.frame2=s,r.jointType=ds.Fixed,r}static spring(t,e,i,s,r){let o=new Pl;return o.anchor1=s,o.anchor2=r,o.length=t,o.stiffness=e,o.damping=i,o.jointType=ds.Spring,o}static rope(t,e,i){let s=new Pl;return s.anchor1=e,s.anchor2=i,s.length=t,s.jointType=ds.Rope,s}static generic(t,e,i,s){let r=new Pl;return r.anchor1=t,r.anchor2=e,r.axis=i,r.axesMask=s,r.jointType=ds.Generic,r}static spherical(t,e){let i=new Pl;return i.anchor1=t,i.anchor2=e,i.jointType=ds.Spherical,i}static prismatic(t,e,i){let s=new Pl;return s.anchor1=t,s.anchor2=e,s.axis=i,s.jointType=ds.Prismatic,s}static revolute(t,e,i){let s=new Pl;return s.anchor1=t,s.anchor2=e,s.axis=i,s.jointType=ds.Revolute,s}intoRaw(){let t,e,i=se.intoRaw(this.anchor1),s=se.intoRaw(this.anchor2),r=!1,o=0,a=0;switch(this.jointType){case ds.Fixed:let l=Kt.intoRaw(this.frame1),h=Kt.intoRaw(this.frame2);e=As.fixed(i,l,s,h),l.free(),h.free();break;case ds.Spring:e=As.spring(this.length,this.stiffness,this.damping,i,s);break;case ds.Rope:e=As.rope(this.length,i,s);break;case ds.Prismatic:t=se.intoRaw(this.axis),this.limitsEnabled&&(r=!0,o=this.limits[0],a=this.limits[1]),e=As.prismatic(i,s,t,r,o,a),t.free();break;case ds.Generic:t=se.intoRaw(this.axis);let u=this.axesMask;e=As.generic(i,s,t,u);break;case ds.Spherical:e=As.spherical(i,s);break;case ds.Revolute:t=se.intoRaw(this.axis),e=As.revolute(i,s,t),t.free()}return i.free(),s.free(),e}}(function(n){n[n.Average=0]="Average",n[n.Min=1]="Min",n[n.Multiply=2]="Multiply",n[n.Max=3]="Max"})(Vi||(Vi={}));class mm{constructor(t,e,i,s,r){this.distance=t,this.point1=e,this.point2=i,this.normal1=s,this.normal2=r}static fromRaw(t){if(!t)return null;const e=new mm(t.distance(),se.fromRaw(t.point1()),se.fromRaw(t.point2()),se.fromRaw(t.normal1()),se.fromRaw(t.normal2()));return t.free(),e}}(function(n){n[n.Vertex=0]="Vertex",n[n.Edge=1]="Edge",n[n.Face=2]="Face",n[n.Unknown=3]="Unknown"})(xC||(xC={}));class Tb{constructor(t,e){this.point=t,this.isInside=e}static fromRaw(t){if(!t)return null;const e=new Tb(se.fromRaw(t.point()),t.isInside());return t.free(),e}}class kY{constructor(t,e){this.origin=t,this.dir=e}pointAt(t){return{x:this.origin.x+this.dir.x*t,y:this.origin.y+this.dir.y*t,z:this.origin.z+this.dir.z*t}}}class Rb{constructor(t,e,i,s){this.featureType=xC.Unknown,this.featureId=void 0,this.toi=t,this.normal=e,s!==void 0&&(this.featureId=s),i!==void 0&&(this.featureType=i)}static fromRaw(t){if(!t)return null;const e=new Rb(t.toi(),se.fromRaw(t.normal()),t.featureType(),t.featureId());return t.free(),e}}class sA{constructor(t,e,i,s,r){this.toi=t,this.witness1=e,this.witness2=i,this.normal1=s,this.normal2=r}static fromRaw(t,e){if(!e)return null;const i=new sA(e.toi(),se.fromRaw(e.witness1()),se.fromRaw(e.witness2()),se.fromRaw(e.normal1()),se.fromRaw(e.normal2()));return e.free(),i}}class KE extends sA{constructor(t,e,i,s,r,o){super(e,i,s,r,o),this.collider=t}static fromRaw(t,e){if(!e)return null;const i=new KE(t.get(e.colliderHandle()),e.toi(),se.fromRaw(e.witness1()),se.fromRaw(e.witness2()),se.fromRaw(e.normal1()),se.fromRaw(e.normal2()));return e.free(),i}}class Mn{static fromRaw(t,e){const i=t.coShapeType(e);let s,r,o,a,l,h,u;switch(i){case Qn.Ball:return new JE(t.coRadius(e));case Qn.Cuboid:return s=t.coHalfExtents(e),new xL(s.x,s.y,s.z);case Qn.RoundCuboid:return s=t.coHalfExtents(e),r=t.coRoundRadius(e),new CL(s.x,s.y,s.z,r);case Qn.Capsule:return l=t.coHalfHeight(e),h=t.coRadius(e),new SL(l,h);case Qn.Segment:return o=t.coVertices(e),new EL(se.new(o[0],o[1],o[2]),se.new(o[3],o[4],o[5]));case Qn.Polyline:return o=t.coVertices(e),a=t.coIndices(e),new RL(o,a);case Qn.Triangle:return o=t.coVertices(e),new IL(se.new(o[0],o[1],o[2]),se.new(o[3],o[4],o[5]),se.new(o[6],o[7],o[8]));case Qn.RoundTriangle:return o=t.coVertices(e),r=t.coRoundRadius(e),new TL(se.new(o[0],o[1],o[2]),se.new(o[3],o[4],o[5]),se.new(o[6],o[7],o[8]),r);case Qn.HalfSpace:return u=se.fromRaw(t.coHalfspaceNormal(e)),new DY(u);case Qn.TriMesh:return o=t.coVertices(e),a=t.coIndices(e),new BL(o,a);case Qn.HeightField:const d=t.coHeightfieldScale(e),f=t.coHeightfieldHeights(e),p=t.coHeightfieldNRows(e),g=t.coHeightfieldNCols(e);return new PL(p,g,f,d);case Qn.ConvexPolyhedron:return o=t.coVertices(e),a=t.coIndices(e),new SC(o,a);case Qn.RoundConvexPolyhedron:return o=t.coVertices(e),a=t.coIndices(e),r=t.coRoundRadius(e),new EC(o,a,r);case Qn.Cylinder:return l=t.coHalfHeight(e),h=t.coRadius(e),new ML(l,h);case Qn.RoundCylinder:return l=t.coHalfHeight(e),h=t.coRadius(e),r=t.coRoundRadius(e),new kL(l,h,r);case Qn.Cone:return l=t.coHalfHeight(e),h=t.coRadius(e),new DL(l,h);case Qn.RoundCone:return l=t.coHalfHeight(e),h=t.coRadius(e),r=t.coRoundRadius(e),new OL(l,h,r);default:throw new Error("unknown shape type: "+i)}}castShape(t,e,i,s,r,o,a,l,h){let u=se.intoRaw(t),d=Kt.intoRaw(e),f=se.intoRaw(i),p=se.intoRaw(r),g=Kt.intoRaw(o),m=se.intoRaw(a),v=this.intoRaw(),y=s.intoRaw(),b=sA.fromRaw(null,v.castShape(u,d,f,y,p,g,m,l,h));return u.free(),d.free(),f.free(),p.free(),g.free(),m.free(),v.free(),y.free(),b}intersectsShape(t,e,i,s,r){let o=se.intoRaw(t),a=Kt.intoRaw(e),l=se.intoRaw(s),h=Kt.intoRaw(r),u=this.intoRaw(),d=i.intoRaw(),f=u.intersectsShape(o,a,d,l,h);return o.free(),a.free(),l.free(),h.free(),u.free(),d.free(),f}contactShape(t,e,i,s,r,o){let a=se.intoRaw(t),l=Kt.intoRaw(e),h=se.intoRaw(s),u=Kt.intoRaw(r),d=this.intoRaw(),f=i.intoRaw(),p=mm.fromRaw(d.contactShape(a,l,f,h,u,o));return a.free(),l.free(),h.free(),u.free(),d.free(),f.free(),p}containsPoint(t,e,i){let s=se.intoRaw(t),r=Kt.intoRaw(e),o=se.intoRaw(i),a=this.intoRaw(),l=a.containsPoint(s,r,o);return s.free(),r.free(),o.free(),a.free(),l}projectPoint(t,e,i,s){let r=se.intoRaw(t),o=Kt.intoRaw(e),a=se.intoRaw(i),l=this.intoRaw(),h=Tb.fromRaw(l.projectPoint(r,o,a,s));return r.free(),o.free(),a.free(),l.free(),h}intersectsRay(t,e,i,s){let r=se.intoRaw(e),o=Kt.intoRaw(i),a=se.intoRaw(t.origin),l=se.intoRaw(t.dir),h=this.intoRaw(),u=h.intersectsRay(r,o,a,l,s);return r.free(),o.free(),a.free(),l.free(),h.free(),u}castRay(t,e,i,s,r){let o=se.intoRaw(e),a=Kt.intoRaw(i),l=se.intoRaw(t.origin),h=se.intoRaw(t.dir),u=this.intoRaw(),d=u.castRay(o,a,l,h,s,r);return o.free(),a.free(),l.free(),h.free(),u.free(),d}castRayAndGetNormal(t,e,i,s,r){let o=se.intoRaw(e),a=Kt.intoRaw(i),l=se.intoRaw(t.origin),h=se.intoRaw(t.dir),u=this.intoRaw(),d=Rb.fromRaw(u.castRayAndGetNormal(o,a,l,h,s,r));return o.free(),a.free(),l.free(),h.free(),u.free(),d}}(function(n){n[n.Ball=0]="Ball",n[n.Cuboid=1]="Cuboid",n[n.Capsule=2]="Capsule",n[n.Segment=3]="Segment",n[n.Polyline=4]="Polyline",n[n.Triangle=5]="Triangle",n[n.TriMesh=6]="TriMesh",n[n.HeightField=7]="HeightField",n[n.ConvexPolyhedron=9]="ConvexPolyhedron",n[n.Cylinder=10]="Cylinder",n[n.Cone=11]="Cone",n[n.RoundCuboid=12]="RoundCuboid",n[n.RoundTriangle=13]="RoundTriangle",n[n.RoundCylinder=14]="RoundCylinder",n[n.RoundCone=15]="RoundCone",n[n.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",n[n.HalfSpace=17]="HalfSpace"})(zi||(zi={}));class JE extends Mn{constructor(t){super(),this.type=zi.Ball,this.radius=t}intoRaw(){return Ze.ball(this.radius)}}class DY extends Mn{constructor(t){super(),this.type=zi.HalfSpace,this.normal=t}intoRaw(){let t=se.intoRaw(this.normal),e=Ze.halfspace(t);return t.free(),e}}class xL extends Mn{constructor(t,e,i){super(),this.type=zi.Cuboid,this.halfExtents=se.new(t,e,i)}intoRaw(){return Ze.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class CL extends Mn{constructor(t,e,i,s){super(),this.type=zi.RoundCuboid,this.halfExtents=se.new(t,e,i),this.borderRadius=s}intoRaw(){return Ze.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class SL extends Mn{constructor(t,e){super(),this.type=zi.Capsule,this.halfHeight=t,this.radius=e}intoRaw(){return Ze.capsule(this.halfHeight,this.radius)}}class EL extends Mn{constructor(t,e){super(),this.type=zi.Segment,this.a=t,this.b=e}intoRaw(){let t=se.intoRaw(this.a),e=se.intoRaw(this.b),i=Ze.segment(t,e);return t.free(),e.free(),i}}class IL extends Mn{constructor(t,e,i){super(),this.type=zi.Triangle,this.a=t,this.b=e,this.c=i}intoRaw(){let t=se.intoRaw(this.a),e=se.intoRaw(this.b),i=se.intoRaw(this.c),s=Ze.triangle(t,e,i);return t.free(),e.free(),i.free(),s}}class TL extends Mn{constructor(t,e,i,s){super(),this.type=zi.RoundTriangle,this.a=t,this.b=e,this.c=i,this.borderRadius=s}intoRaw(){let t=se.intoRaw(this.a),e=se.intoRaw(this.b),i=se.intoRaw(this.c),s=Ze.roundTriangle(t,e,i,this.borderRadius);return t.free(),e.free(),i.free(),s}}class RL extends Mn{constructor(t,e){super(),this.type=zi.Polyline,this.vertices=t,this.indices=e??new Uint32Array(0)}intoRaw(){return Ze.polyline(this.vertices,this.indices)}}class BL extends Mn{constructor(t,e){super(),this.type=zi.TriMesh,this.vertices=t,this.indices=e}intoRaw(){return Ze.trimesh(this.vertices,this.indices)}}class SC extends Mn{constructor(t,e){super(),this.type=zi.ConvexPolyhedron,this.vertices=t,this.indices=e}intoRaw(){return this.indices?Ze.convexMesh(this.vertices,this.indices):Ze.convexHull(this.vertices)}}class EC extends Mn{constructor(t,e,i){super(),this.type=zi.RoundConvexPolyhedron,this.vertices=t,this.indices=e,this.borderRadius=i}intoRaw(){return this.indices?Ze.roundConvexMesh(this.vertices,this.indices,this.borderRadius):Ze.roundConvexHull(this.vertices,this.borderRadius)}}class PL extends Mn{constructor(t,e,i,s){super(),this.type=zi.HeightField,this.nrows=t,this.ncols=e,this.heights=i,this.scale=s}intoRaw(){let t=se.intoRaw(this.scale),e=Ze.heightfield(this.nrows,this.ncols,this.heights,t);return t.free(),e}}class ML extends Mn{constructor(t,e){super(),this.type=zi.Cylinder,this.halfHeight=t,this.radius=e}intoRaw(){return Ze.cylinder(this.halfHeight,this.radius)}}class kL extends Mn{constructor(t,e,i){super(),this.type=zi.RoundCylinder,this.borderRadius=i,this.halfHeight=t,this.radius=e}intoRaw(){return Ze.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class DL extends Mn{constructor(t,e){super(),this.type=zi.Cone,this.halfHeight=t,this.radius=e}intoRaw(){return Ze.cone(this.halfHeight,this.radius)}}class OL extends Mn{constructor(t,e,i){super(),this.type=zi.RoundCone,this.halfHeight=t,this.radius=e,this.borderRadius=i}intoRaw(){return Ze.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(n){n[n.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",n[n.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",n[n.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",n[n.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",n[n.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",n[n.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",n[n.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",n[n.ONLY_FIXED=6]="ONLY_FIXED"})(lP||(lP={}));(function(n){n[n.NONE=0]="NONE",n[n.COLLISION_EVENTS=1]="COLLISION_EVENTS",n[n.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(Hy||(Hy={}));class OY{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return se.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return se.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class LY{constructor(t,e){this.raw=e||new BY(t)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(t){this.raw.drainCollisionEvents(t)}drainContactForceEvents(t){let e=new OY;this.raw.drainContactForceEvents(i=>{e.raw=i,t(e),e.free()})}clear(){this.raw.clear()}}(function(n){n[n.NONE=0]="NONE",n[n.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",n[n.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(CC||(CC={})),function(n){n[n.EMPTY=0]="EMPTY",n[n.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(cP||(cP={})),function(n){n[n.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",n[n.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",n[n.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",n[n.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",n[n.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",n[n.FIXED_FIXED=32]="FIXED_FIXED",n[n.DEFAULT=15]="DEFAULT",n[n.ALL=60943]="ALL"}(Vy||(Vy={}));class uP{constructor(t,e,i,s){this.colliderSet=t,this.handle=e,this._parent=i,this._shape=s}finalizeDeserialization(t){this.handle!=null&&(this._parent=t.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=Mn.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return se.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Kt.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(t){this.colliderSet.raw.coSetSensor(this.handle,t)}setShape(t){let e=t.intoRaw();this.colliderSet.raw.coSetShape(this.handle,e),e.free(),this._shape=t}setEnabled(t){this.colliderSet.raw.coSetEnabled(this.handle,t)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(t){this.colliderSet.raw.coSetRestitution(this.handle,t)}setFriction(t){this.colliderSet.raw.coSetFriction(this.handle,t)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(t){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,t)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(t){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,t)}setCollisionGroups(t){this.colliderSet.raw.coSetCollisionGroups(this.handle,t)}setSolverGroups(t){this.colliderSet.raw.coSetSolverGroups(this.handle,t)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(t){this.colliderSet.raw.coSetActiveHooks(this.handle,t)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(t){this.colliderSet.raw.coSetActiveEvents(this.handle,t)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(t){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,t)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(t){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,t)}setDensity(t){this.colliderSet.raw.coSetDensity(this.handle,t)}setMass(t){this.colliderSet.raw.coSetMass(this.handle,t)}setMassProperties(t,e,i,s){let r=se.intoRaw(e),o=se.intoRaw(i),a=Kt.intoRaw(s);this.colliderSet.raw.coSetMassProperties(this.handle,t,r,o,a),r.free(),o.free(),a.free()}setTranslation(t){this.colliderSet.raw.coSetTranslation(this.handle,t.x,t.y,t.z)}setTranslationWrtParent(t){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,t.x,t.y,t.z)}setRotation(t){this.colliderSet.raw.coSetRotation(this.handle,t.x,t.y,t.z,t.w)}setRotationWrtParent(t){this.colliderSet.raw.coSetRotationWrtParent(this.handle,t.x,t.y,t.z,t.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return se.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(t){const e=se.intoRaw(t);this.colliderSet.raw.coSetHalfExtents(this.handle,e)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(t){this.colliderSet.raw.coSetRadius(this.handle,t)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(t){this.colliderSet.raw.coSetRoundRadius(this.handle,t)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(t){this.colliderSet.raw.coSetHalfHeight(this.handle,t)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let t=this.colliderSet.raw.coHeightfieldScale(this.handle);return se.fromRaw(t)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(t){let e=se.intoRaw(t),i=this.colliderSet.raw.coContainsPoint(this.handle,e);return e.free(),i}projectPoint(t,e){let i=se.intoRaw(t),s=Tb.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,i,e));return i.free(),s}intersectsRay(t,e){let i=se.intoRaw(t.origin),s=se.intoRaw(t.dir),r=this.colliderSet.raw.coIntersectsRay(this.handle,i,s,e);return i.free(),s.free(),r}castShape(t,e,i,s,r,o,a){let l=se.intoRaw(t),h=se.intoRaw(i),u=Kt.intoRaw(s),d=se.intoRaw(r),f=e.intoRaw(),p=sA.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,l,f,h,u,d,o,a));return l.free(),h.free(),u.free(),d.free(),f.free(),p}castCollider(t,e,i,s,r){let o=se.intoRaw(t),a=se.intoRaw(i),l=KE.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,o,e.handle,a,s,r));return o.free(),a.free(),l}intersectsShape(t,e,i){let s=se.intoRaw(e),r=Kt.intoRaw(i),o=t.intoRaw(),a=this.colliderSet.raw.coIntersectsShape(this.handle,o,s,r);return s.free(),r.free(),o.free(),a}contactShape(t,e,i,s){let r=se.intoRaw(e),o=Kt.intoRaw(i),a=t.intoRaw(),l=mm.fromRaw(this.colliderSet.raw.coContactShape(this.handle,a,r,o,s));return r.free(),o.free(),a.free(),l}contactCollider(t,e){return mm.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,t.handle,e))}castRay(t,e,i){let s=se.intoRaw(t.origin),r=se.intoRaw(t.dir),o=this.colliderSet.raw.coCastRay(this.handle,s,r,e,i);return s.free(),r.free(),o}castRayAndGetNormal(t,e,i){let s=se.intoRaw(t.origin),r=se.intoRaw(t.dir),o=Rb.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,s,r,e,i));return s.free(),r.free(),o}}(function(n){n[n.Density=0]="Density",n[n.Mass=1]="Mass",n[n.MassProps=2]="MassProps"})(Wd||(Wd={}));class pi{constructor(t){this.enabled=!0,this.shape=t,this.massPropsMode=Wd.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Kt.identity(),this.translation=se.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=Vi.Average,this.restitutionCombineRule=Vi.Average,this.activeCollisionTypes=Vy.DEFAULT,this.activeEvents=Hy.NONE,this.activeHooks=CC.NONE,this.mass=0,this.centerOfMass=se.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=se.zeros(),this.angularInertiaLocalFrame=Kt.identity()}static ball(t){const e=new JE(t);return new pi(e)}static capsule(t,e){const i=new SL(t,e);return new pi(i)}static segment(t,e){const i=new EL(t,e);return new pi(i)}static triangle(t,e,i){const s=new IL(t,e,i);return new pi(s)}static roundTriangle(t,e,i,s){const r=new TL(t,e,i,s);return new pi(r)}static polyline(t,e){const i=new RL(t,e);return new pi(i)}static trimesh(t,e){const i=new BL(t,e);return new pi(i)}static cuboid(t,e,i){const s=new xL(t,e,i);return new pi(s)}static roundCuboid(t,e,i,s){const r=new CL(t,e,i,s);return new pi(r)}static heightfield(t,e,i,s){const r=new PL(t,e,i,s);return new pi(r)}static cylinder(t,e){const i=new ML(t,e);return new pi(i)}static roundCylinder(t,e,i){const s=new kL(t,e,i);return new pi(s)}static cone(t,e){const i=new DL(t,e);return new pi(i)}static roundCone(t,e,i){const s=new OL(t,e,i);return new pi(s)}static convexHull(t){const e=new SC(t,null);return new pi(e)}static convexMesh(t,e){const i=new SC(t,e);return new pi(i)}static roundConvexHull(t,e){const i=new EC(t,null,e);return new pi(i)}static roundConvexMesh(t,e,i){const s=new EC(t,e,i);return new pi(s)}setTranslation(t,e,i){if(typeof t!="number"||typeof e!="number"||typeof i!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:t,y:e,z:i},this}setRotation(t){return Kt.copy(this.rotation,t),this}setSensor(t){return this.isSensor=t,this}setEnabled(t){return this.enabled=t,this}setDensity(t){return this.massPropsMode=Wd.Density,this.density=t,this}setMass(t){return this.massPropsMode=Wd.Mass,this.mass=t,this}setMassProperties(t,e,i,s){return this.massPropsMode=Wd.MassProps,this.mass=t,se.copy(this.centerOfMass,e),se.copy(this.principalAngularInertia,i),Kt.copy(this.angularInertiaLocalFrame,s),this}setRestitution(t){return this.restitution=t,this}setFriction(t){return this.friction=t,this}setFrictionCombineRule(t){return this.frictionCombineRule=t,this}setRestitutionCombineRule(t){return this.restitutionCombineRule=t,this}setCollisionGroups(t){return this.collisionGroups=t,this}setSolverGroups(t){return this.solverGroups=t,this}setActiveHooks(t){return this.activeHooks=t,this}setActiveEvents(t){return this.activeEvents=t,this}setActiveCollisionTypes(t){return this.activeCollisionTypes=t,this}setContactForceEventThreshold(t){return this.contactForceEventThreshold=t,this}}for(var RJ={byteLength:function(n){var t=dP(n),e=t[0],i=t[1];return 3*(e+i)/4-i},toByteArray:function(n){var t,e,i=dP(n),s=i[0],r=i[1],o=new FY(function(h,u,d){return 3*(u+d)/4-d}(0,s,r)),a=0,l=r>0?s-4:s;for(e=0;e<l;e+=4)t=to[n.charCodeAt(e)]<<18|to[n.charCodeAt(e+1)]<<12|to[n.charCodeAt(e+2)]<<6|to[n.charCodeAt(e+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;return r===2&&(t=to[n.charCodeAt(e)]<<2|to[n.charCodeAt(e+1)]>>4,o[a++]=255&t),r===1&&(t=to[n.charCodeAt(e)]<<10|to[n.charCodeAt(e+1)]<<4|to[n.charCodeAt(e+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t),o},fromByteArray:function(n){for(var t,e=n.length,i=e%3,s=[],r=16383,o=0,a=e-i;o<a;o+=r)s.push(NY(n,o,o+r>a?a:o+r));return i===1?(t=n[e-1],s.push(Da[t>>2]+Da[t<<4&63]+"==")):i===2&&(t=(n[e-2]<<8)+n[e-1],s.push(Da[t>>10]+Da[t>>4&63]+Da[t<<2&63]+"=")),s.join("")}},Da=[],to=[],FY=typeof Uint8Array<"u"?Uint8Array:Array,Bw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yd=0,UY=Bw.length;yd<UY;++yd)Da[yd]=Bw[yd],to[Bw.charCodeAt(yd)]=yd;function dP(n){var t=n.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=n.indexOf("=");return e===-1&&(e=t),[e,e===t?0:4-e%4]}function NY(n,t,e){for(var i,s,r=[],o=t;o<e;o+=3)i=(n[o]<<16&16711680)+(n[o+1]<<8&65280)+(255&n[o+2]),r.push(Da[(s=i)>>18&63]+Da[s>>12&63]+Da[s>>6&63]+Da[63&s]);return r.join("")}to["-".charCodeAt(0)]=62,to["_".charCodeAt(0)]=63;const BJ=Symbol("object"),Pw=new _o(()=>new w,20);class zY{constructor(t,e,i,s,r,o){c(this,"_point");c(this,"_normal");c(this,"_tangentVelocity");c(this,"distance");c(this,"impulse");c(this,"friction");this._point=t,this.distance=e,this._normal=i,this.impulse=s,this.friction=r,this._tangentVelocity=o}get point(){return Pw.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return Pw.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return Pw.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class QY{constructor(t,e,i){c(this,"contacts");c(this,"me");c(this,"_collider");c(this,"_gameObject");this.me=t,this._collider=e,this._gameObject=e.gameObject,this.contacts=i}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var t;return(t=this.collider)==null?void 0:t.attachedRigidbody}}class jY{constructor(t,e){c(this,"object");c(this,"collider");this.object=t,this.collider=e}}const Gn=z("debugphysics"),Mw=z("debugcolliderplacement"),kw=z("debugcollisions"),GY=z("showcolliders"),Dw=z("debugraycasts"),rr=Symbol("needle component"),Fs=Symbol("physics body"),fP=Symbol("rigidbody");let Vh;globalThis.false=globalThis.false!==void 0?globalThis.false:!0;Gn&&console.log("Use Rapier",!1,globalThis.false);const Ug=class{constructor(){c(this,"debugRenderColliders",!1);c(this,"debugRenderRaycasts",!1);c(this,"context");c(this,"_initializePromise");c(this,"_isInitialized",!1);c(this,"rapierRay",new kY({x:0,y:0,z:0},{x:0,y:0,z:1}));c(this,"raycastVectorsBuffer",new _o(()=>new w,10));c(this,"rapierSphere",null);c(this,"rapierColliderArray",[]);c(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1});c(this,"rapierForwardVector",{x:0,y:0,z:1});c(this,"enabled",!1);c(this,"_tempPosition",new w);c(this,"_tempQuaternion",new ie);c(this,"_tempScale",new w);c(this,"_tempMatrix",new ae);c(this,"_isUpdatingPhysicsWorld",!1);c(this,"_world");c(this,"_hasCreatedWorld",!1);c(this,"eventQueue");c(this,"collisionHandler");c(this,"objects",[]);c(this,"bodies",[]);c(this,"_meshCache",new Map);c(this,"_gravity",{x:0,y:-9.81,z:0});c(this,"lines");c(this,"_tempCenterPos",new w);c(this,"_tempCenterVec",new w);c(this,"_tempCenterQuaternion",new ie)}removeBody(t){var i,s,r;if(!t)return;this.validate();const e=t[Fs];if(t[Fs]=null,e&&this.world){const o=this.objects.findIndex(a=>a===t);if(o>=0){const a=this.bodies[o];if(this.bodies.splice(o,1),this.objects.splice(o,1),a instanceof uP){const l=a;(i=this.world)==null||i.removeCollider(l,!0);const h=l.parent();h&&h.numColliders()<=0&&(h[rr]||(s=this.world)==null||s.removeRigidBody(h))}else a instanceof hP&&(a.numColliders()<=0?(r=this.world)==null||r.removeRigidBody(a):ve()&&(a.did_log_removing||setTimeout(()=>{a.numColliders()>0&&(a.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(t,e,i){if(this.validate(),!!this.enabled&&!(t.destroyed||!t.gameObject)&&!(!e&&!i))if(t.isCollider===!0)console.warn("TODO: implement updating collider position");else{const s=t,r=s[Fs];r&&this.syncPhysicsBody(s.gameObject,r,e,i)}}updateProperties(t){if(this.validate(),t.isCollider){const e=t,i=e[Fs];i&&(this.internalUpdateColliderProperties(e,i),e.sharedMaterial&&this.updatePhysicsMaterial(e))}else{const e=t,i=this.internal_getRigidbody(e);i&&this.internalUpdateRigidbodyProperties(e,i)}}addForce(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.addForce(e,i):console.warn("Rigidbody doesn't exist: can not apply force (does your object with the Rigidbody have a collider?)")}addImpulse(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}getLinearVelocity(t){this.validate();const e=this.internal_getRigidbody(t);return e?e.linvel():null}getAngularVelocity(t){this.validate();const e=this.internal_getRigidbody(t);return e?e.angvel():null}resetForces(t,e){this.validate();const i=this.internal_getRigidbody(t);i==null||i.resetForces(e)}resetTorques(t,e){this.validate();const i=this.internal_getRigidbody(t);i==null||i.resetTorques(e)}applyImpulse(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}wakeup(t){this.validate();const e=this.internal_getRigidbody(t);e?e.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up (does your object with the Rigidbody have a collider?)")}isSleeping(t){this.validate();const e=this.internal_getRigidbody(t);return e==null?void 0:e.isSleeping()}setAngularVelocity(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.setAngvel(e,i):console.warn("Rigidbody doesn't exist: can not set angular velocity (does your object with the Rigidbody have a collider?)")}setLinearVelocity(t,e,i){this.validate();const s=this.internal_getRigidbody(t);s?s.setLinvel(e,i):console.warn("Rigidbody doesn't exist: can not set linear velocity (does your object with the Rigidbody have a collider?)")}async initialize(t){return this.context=t,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return Gn&&console.log("Initialize rapier physics engine"),"env"in import.meta&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&Gn&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||Gn&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(t,e,i){var l;let s=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;s===void 0&&(s=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,t,e);if(!o)return null;(this.debugRenderRaycasts||Dw)&&Be.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRay(o,s,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,h=>{const u=h[rr];return i!=null&&i.filterPredicate?i.filterPredicate(u):(i==null?void 0:i.useIgnoreRaycastLayer)!==!1?!(u!=null&&u.gameObject.layers.isEnabled(2)):!0});if(a){const h=o.pointAt(a.toi),u=this.raycastVectorsBuffer.get();return u.set(h.x,h.y,h.z),{point:u,collider:a.collider[rr]}}return null}raycastAndGetNormal(t,e,i){var l;let s=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;s===void 0&&(s=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,t,e);if(!o)return null;(this.debugRenderRaycasts||Dw)&&Be.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRayAndGetNormal(o,s,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,h=>{const u=h[rr];return i!=null&&i.filterPredicate?i.filterPredicate(u):(i==null?void 0:i.useIgnoreRaycastLayer)!==!1?!(u!=null&&u.gameObject.layers.isEnabled(2)):!0});if(a){const h=o.pointAt(a.toi),u=a.normal,d=this.raycastVectorsBuffer.get(),f=this.raycastVectorsBuffer.get();return d.set(h.x,h.y,h.z),f.set(u.x,u.y,u.z),{point:d,normal:f,collider:a.collider[rr]}}return null}getPhysicsRay(t,e,i){var a,l,h;const s=(a=this.context)==null?void 0:a.mainCamera;if(e===void 0){const u=(l=this.context)==null?void 0:l.input.getPointerPosition(0);if(u)e=u;else return null}if(e.z===void 0){if(!s)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const u=this.raycastVectorsBuffer.get();u.x=e.x,u.y=e.y,u.z=0,(u.x>1||u.y>1||u.y<-1||u.x<-1)&&(Gn&&console.warn("Converting screenspace to raycast space",u),(h=this.context)==null||h.input.convertScreenspaceToRaycastSpace(u)),u.unproject(s),e=u}const r=e;t.origin.x=r.x,t.origin.y=r.y,t.origin.z=r.z;const o=this.raycastVectorsBuffer.get();if(i)o.set(i.x,i.y,i.z);else{if(!s)return console.error("Can not perform raycast - no camera found"),null;o.set(t.origin.x,t.origin.y,t.origin.z);const u=He(s);o.sub(u)}return o.normalize(),t.dir.x=o.x,t.dir.y=o.y,t.dir.z=o.z,t}sphereOverlap(t,e){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new JE(e)),this.rapierSphere.radius=e,(this.debugRenderRaycasts||Dw)&&Be.DrawWireSphere(t,e,3359999,1),this.world.intersectionsWithShape(t,this.rapierIdentityRotation,this.rapierSphere,i=>{const s=i[rr],r=new jY(s.gameObject,s);return this.rapierColliderArray.push(r),!0},void 0,void 0,void 0,void 0,i=>i.isSensor()?!1:i[rr].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var t;return((t=this.world)==null?void 0:t.gravity)??this._gravity}set gravity(t){this.world?this.world.gravity=t:this._gravity=t}clearCaches(){var t,e,i,s;this._meshCache.clear(),(t=this.eventQueue)!=null&&t.raw&&((e=this.eventQueue)==null||e.free()),(i=this.world)!=null&&i.bodies&&((s=this.world)==null||s.free())}async addBoxCollider(t,e){if(this._isInitialized||await this.initialize(t.context),!t.activeAndEnabled)return;if(!this.enabled){Gn&&console.warn("Physics are disabled");return}const i=t.gameObject,s=ri(i,this._tempPosition).multiply(e);s.multiplyScalar(.5),s.x<0&&(s.x=Math.abs(s.x)),s.y<0&&(s.y=Math.abs(s.y)),s.z<0&&(s.z=Math.abs(s.z)),s.x==0&&(s.x=1e-7),s.y==0&&(s.y=1e-7),s.z==0&&(s.z=1e-7);const r=pi.cuboid(s.x,s.y,s.z);this.createCollider(t,r)}async addSphereCollider(t){if(this._isInitialized||await this.initialize(t.context),!t.activeAndEnabled)return;if(!this.enabled){Gn&&console.warn("Physics are disabled");return}const e=pi.ball(.5);this.createCollider(t,e),this.updateProperties(t)}async addCapsuleCollider(t,e,i){if(this._isInitialized||await this.initialize(t.context),!t.activeAndEnabled)return;if(!this.enabled){Gn&&console.warn("Physics are disabled");return}const s=t.gameObject,r=ri(s,this._tempPosition);r.x=Math.abs(r.x),r.y=Math.abs(r.y);const o=i*r.x;e=Math.max(e,o*2);const a=ye.clamp(e*.5*r.y-i*r.x,0,Number.MAX_SAFE_INTEGER),l=pi.capsule(a,o);this.createCollider(t,l)}async addMeshCollider(t,e,i,s){var h,u,d;if(this._isInitialized||await this.initialize(t.context),!t.activeAndEnabled)return;if(!this.enabled){Gn&&console.warn("Physics are disabled");return}let r=e.geometry;if(!r){Gn&&console.warn("Missing mesh geometry",e.name);return}(u=(h=r.index)==null?void 0:h.array)!=null&&u.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${e.name}". Consider providing an indexed geometry.`),r=Gj(r));let o=r.getAttribute("position").array;const a=(d=r.index)==null?void 0:d.array;if(Math.abs(s.x-1)>1e-4||Math.abs(s.y-1)>1e-4||Math.abs(s.z-1)>1e-4){const f=r.uuid+"_"+s.x+"_"+s.y+"_"+s.z+"_"+i;if(this._meshCache.has(f))Gn&&console.warn("Use cached mesh collider"),o=this._meshCache.get(f);else{(Gn||ve())&&console.warn(`Your MeshCollider "${t.name}" is scaled: consider applying the scale to the collider mesh instead (${s.x}, ${s.y}, ${s.z})`);const p=new Float32Array(o.length);for(let g=0;g<o.length;g+=3)p[g]=o[g]*s.x,p[g+1]=o[g+1]*s.y,p[g+2]=o[g+2]*s.z;o=p,this._meshCache.set(f,p)}}const l=i?pi.convexHull(o):pi.trimesh(o,a);l&&this.createCollider(t,l)}updatePhysicsMaterial(t){if(!t)return;const e=t.sharedMaterial,i=t[Fs];if(i&&e){if(e.bounciness!==void 0&&i.setRestitution(e.bounciness),e.bounceCombine!==void 0)switch(e.bounceCombine){case mn.Average:i.setRestitutionCombineRule(Vi.Average);break;case mn.Maximum:i.setRestitutionCombineRule(Vi.Max);break;case mn.Minimum:i.setRestitutionCombineRule(Vi.Min);break;case mn.Multiply:i.setRestitutionCombineRule(Vi.Multiply);break}if(e.dynamicFriction!==void 0&&i.setFriction(e.dynamicFriction),e.frictionCombine!==void 0)switch(e.frictionCombine){case mn.Average:i.setFrictionCombineRule(Vi.Average);break;case mn.Maximum:i.setFrictionCombineRule(Vi.Max);break;case mn.Minimum:i.setFrictionCombineRule(Vi.Min);break;case mn.Multiply:i.setFrictionCombineRule(Vi.Multiply);break}}}getBody(t){return t?t[Fs]:null}getComponent(t){return t?t[rr]:null}createCollider(t,e){var o;if(!this.world)throw new Error("Physics world not initialized");const i=this._tempMatrix;let s;t.attachedRigidbody?s=this.getRigidbody(t,this._tempMatrix):(Gn&&console.log("Create collider without rigidbody",t.name),i.makeRotationFromQuaternion(Gt(t.gameObject)),i.setPosition(He(t.gameObject))),i.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(t,this._tempPosition),e.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),e.setRotation(this._tempQuaternion),e.setSensor(t.isTrigger);const r=t.sharedMaterial;if(r){if(r.bounciness!==void 0&&e.setRestitution(r.bounciness),r.bounceCombine!==void 0)switch(r.bounceCombine){case mn.Average:e.setRestitutionCombineRule(Vi.Average);break;case mn.Maximum:e.setRestitutionCombineRule(Vi.Max);break;case mn.Minimum:e.setRestitutionCombineRule(Vi.Min);break;case mn.Multiply:e.setRestitutionCombineRule(Vi.Multiply);break}if(r.dynamicFriction!==void 0&&e.setFriction(r.dynamicFriction),r.frictionCombine!==void 0)switch(r.frictionCombine){case mn.Average:e.setFrictionCombineRule(Vi.Average);break;case mn.Maximum:e.setFrictionCombineRule(Vi.Max);break;case mn.Minimum:e.setFrictionCombineRule(Vi.Min);break;case mn.Multiply:e.setFrictionCombineRule(Vi.Multiply);break}}((o=t.attachedRigidbody)==null?void 0:o.autoMass)===!1&&(e.setDensity(1e-6),e.setMass(1e-6));try{const a=this.world.createCollider(e,s);return a[rr]=t,t[Fs]=a,a.setActiveEvents(Hy.COLLISION_EVENTS),a.setActiveCollisionTypes(Vy.ALL),this.objects.push(t),this.bodies.push(a),this.updateColliderCollisionGroups(t),a}catch(a){return console.error('Error creating collider "'+t.name+`"
Error:`,a),null}}updateColliderCollisionGroups(t){const e=t[Fs],i=t.membership;let s=0;if(i==null)s=65535;else for(let a=0;a<i.length;a++){const l=i[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):s|=1<<Math.floor(l)}const r=t.filter;let o=0;if(r==null)o=65535;else for(let a=0;a<r.length;a++){const l=r[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):o|=1<<Math.floor(l)}e.setCollisionGroups(s<<16|o)}getRigidbody(t,e){if(!this.world)throw new Error("Physics world not initialized");let i=null;if(t.attachedRigidbody){const s=t.attachedRigidbody;if(i=s[Fs],!i){const r=s.isKinematic&&!Mw;Gn&&console.log("Create rigidbody",r);const o=r?Vh.RigidBodyDesc.kinematicPositionBased():Vh.RigidBodyDesc.dynamic(),a=He(t.attachedRigidbody.gameObject);o.setTranslation(a.x,a.y,a.z),o.setRotation(Gt(t.attachedRigidbody.gameObject)),o.centerOfMass=new Vh.Vector3(s.centerOfMass.x,s.centerOfMass.y,s.centerOfMass.z),i=this.world.createRigidBody(o),this.bodies.push(i),this.objects.push(s)}i[rr]=s,s[Fs]=i,this.internalUpdateRigidbodyProperties(s,i),this.getRigidbodyRelativeMatrix(t.gameObject,s.gameObject,e),t[fP]=i}else{const s=Vh.RigidBodyDesc.kinematicPositionBased(),r=He(t.gameObject);s.setTranslation(r.x,r.y,r.z),s.setRotation(Gt(t.gameObject)),i=this.world.createRigidBody(s),e.identity(),i[rr]=null}return i}internal_getRigidbody(t){return t.isCollider===!0?t[fP]:t[Fs]}internalUpdateColliderProperties(t,e){const i=e.shape;let s=!1;switch(i.type){case zi.Ball:{const f=i,p=t,g=t.gameObject,m=ri(g,this._tempPosition),v=Math.abs(p.radius*m.x);s=f.radius!==v,f.radius=v,s&&e.setShape(f);break}case zi.Cuboid:const r=i,o=t,a=t.gameObject,l=ri(a,this._tempPosition),h=o.size.x*.5*l.x,u=o.size.y*.5*l.y,d=o.size.z*.5*l.z;s=r.halfExtents.x!==h||r.halfExtents.y!==u||r.halfExtents.z!==d,r.halfExtents.x=h,r.halfExtents.y=u,r.halfExtents.z=d,s&&e.setShape(r);break}if(s){const r=t.attachedRigidbody;if(r!=null&&r.autoMass){const o=this.getBody(r);o==null||o.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(t),t.isTrigger!==e.isSensor()&&e.setSensor(t.isTrigger)}internalUpdateRigidbodyProperties(t,e){if(e.enableCcd(t.collisionDetectionMode!==by.Discrete),e.setLinearDamping(t.drag),e.setAngularDamping(t.angularDrag),e.setGravityScale(t.useGravity?t.gravityScale:0,!0),t.dominanceGroup<=127&&t.dominanceGroup>=-127?e.setDominanceGroup(Math.floor(t.dominanceGroup)):e.setDominanceGroup(0),t.autoMass){e.setAdditionalMass(0,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1);e.recomputeMassPropertiesFromColliders()}else{e.setAdditionalMass(t.mass,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1e-7);e.recomputeMassPropertiesFromColliders()}e.setEnabledRotations(!t.lockRotationX,!t.lockRotationY,!t.lockRotationZ,!1),e.setEnabledTranslations(!t.lockPositionX,!t.lockPositionY,!t.lockPositionZ,!1),t.isKinematic?e.setBodyType(Vh.RigidBodyType.KinematicPositionBased,!1):e.setBodyType(Vh.RigidBodyType.Dynamic,!1)}step(t){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new LY(!1)),t===void 0||t<=0){this._isUpdatingPhysicsWorld=!1;return}else t!==void 0&&(this.world.timestep=ye.lerp(this.world.timestep,t,.8));try{this.world.step(this.eventQueue)}catch(e){console.warn("Error running physics step",e)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new HY(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(t){var e,i,s,r;if(Gn||Mw||GY||this.debugRenderColliders===!0){if(!this.lines){const a=new Jo({color:7855479,fog:!1}),l=new Ht;this.lines=new xf(l,a),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((e=this.context)==null?void 0:e.scene)&&((i=this.context)==null||i.scene.add(this.lines));const o=t.debugRender();this.lines.geometry.setAttribute("position",new Ke(o.vertices,3)),this.lines.geometry.setAttribute("color",new Ke(o.colors,4)),(this.context.time.frame%30===0||((s=this.lines.geometry.boundingSphere)==null?void 0:s.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((r=this.context)==null||r.scene.remove(this.lines))}syncObjects(){if(!Mw)for(let t=0;t<this.bodies.length;t++){const e=this.objects[t],i=this.bodies[t],s=e;if((s==null?void 0:s.isCollider)===!0&&!s.attachedRigidbody){const l=i.parent();l?this.syncPhysicsBody(e.gameObject,l,!0,!0):this.syncPhysicsBody(e.gameObject,i,!0,!0);continue}const r=i.translation(),o=i.rotation();if(Number.isNaN(r.x)||Number.isNaN(o.x)){!s.__COLLIDER_NAN&&ve()&&(console.warn("Collider has NaN values",s.name,s.gameObject,i),s.__COLLIDER_NAN=!0);continue}const a=e.center;if(a&&a.isVector3){this._tempQuaternion.set(o.x,o.y,o.z,o.w);const l=this._tempPosition.copy(a).applyQuaternion(this._tempQuaternion),h=ri(e.gameObject);l.multiply(h),r.x-=l.x,r.y-=l.y,r.z-=l.z}Tf(e.gameObject,r.x,r.y,r.z),HM(e.gameObject,o.x,o.y,o.z,o.w)}}syncPhysicsBody(t,e,i,s){if(e instanceof hP){const r=He(t,this._tempPosition),o=Gt(t,this._tempQuaternion);switch(e.bodyType()){case Mg.Fixed:case Mg.KinematicPositionBased:case Mg.KinematicVelocityBased:i&&e.setNextKinematicTranslation(r),s&&e.setNextKinematicRotation(o);break;default:i&&e.setTranslation(r,!1),s&&e.setRotation(o,!1);break}}else if(e instanceof uP){t.matrixWorldNeedsUpdate&&t.updateWorldMatrix(!0,!1),t.matrixWorld.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=this._tempPosition,o=this._tempQuaternion,a=e[rr];if(this.tryApplyCenter(a,r),i){const l=e.translation();(l.x!==r.x||l.y!==r.y||l.z!==r.z)&&e.setTranslation(r)}if(s){const l=e.rotation();(l.x!==o.x||l.y!==o.y||l.z!==o.z||l.w!==o.w)&&e.setRotation(o)}}}tryApplyCenter(t,e){const i=t.center;i&&t.gameObject&&(i.x!==0||i.y!==0||i.z!==0)&&(this._tempCenterPos.x=i.x,this._tempCenterPos.y=i.y,this._tempCenterPos.z=i.z,ri(t.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),t.attachedRigidbody?this._tempCenterPos.applyQuaternion(t.gameObject.quaternion):(Gt(t.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),e.x+=this._tempCenterPos.x,e.y+=this._tempCenterPos.y,e.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(t,e,i,s){if(s===void 0&&(s=Ug._matricesBuffer,s.length=0),t===e){const r=ri(t,this._tempPosition);i.makeScale(r.x,r.y,r.z);for(let o=s.length-1;o>=0;o--)i.multiply(s[o]);return i}return s.push(t.matrix),t.parent&&this.getRigidbodyRelativeMatrix(t.parent,e,i,s),i}addFixedJoint(t,e){if(!this.world){console.error("Physics world not initialized");return}const i=t[Fs],s=e[Fs];this.calculateJointRelativeMatrices(t.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=Pl.fixed(Ug.centerConnectionPos,Ug.centerConnectionRot,this._tempPosition,this._tempQuaternion),o=this.world.createImpulseJoint(r,i,s,!0);Gn&&console.log("ADD FIXED JOINT",o)}addHingeJoint(t,e,i,s){if(!this.world){console.error("Physics world not initialized");return}const r=t[Fs],o=e[Fs];this.calculateJointRelativeMatrices(t.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const a=Vh.JointData.revolute(i,this._tempPosition,s),l=this.world.createImpulseJoint(a,r,o,!0);Gn&&console.log("ADD HINGE JOINT",l)}calculateJointRelativeMatrices(t,e,i){t.updateWorldMatrix(!0,!1),e.updateWorldMatrix(!0,!1);const s=t.matrixWorld,r=e.matrixWorld;s.elements[0]=1,s.elements[5]=1,s.elements[10]=1,r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,i.copy(r).premultiply(s.invert()).invert()}};let bd=Ug;c(bd,"_didLoadPhysicsEngine",!1),c(bd,"_matricesBuffer",[]),c(bd,"centerConnectionPos",{x:0,y:0,z:0}),c(bd,"centerConnectionRot",{x:0,y:0,z:0,w:1});class HY{constructor(t,e){c(this,"world");c(this,"eventQueue");c(this,"activeCollisions",[]);c(this,"activeCollisionsStay",[]);c(this,"activeTriggers",[]);this.world=t,this.eventQueue=e}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((t,e,i)=>{const s=this.world.getCollider(t),r=this.world.getCollider(e);if(!s||!r)return;const o=s[rr],a=r[rr];kw&&console.log("EVT",o.name,a.name,i,s,r),o&&a&&(i?(this.onCollisionStarted(o,s,a,r),this.onCollisionStarted(a,r,o,s)):(this.onCollisionEnded(o,a),this.onCollisionEnded(a,o)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(t,e,i,s){let r=null;if(t.isTrigger||i.isTrigger)Df(t.gameObject,o=>{o.onTriggerEnter&&!o.destroyed&&o.onTriggerEnter(i),this.activeTriggers.push({collider:t,component:o,otherCollider:i})});else{const o=t.gameObject;this.world.contactPair(e,s,(a,l)=>{Df(o,h=>{var d;if(h.destroyed)return;const u=h.onCollisionEnter||h.onCollisionStay||h.onCollisionExit;if(u||kw){if(!r){const f=[],p=a.normal();for(let g=0;g<a.numSolverContacts();g++){const m=a.solverContactPoint(g),v=a.contactImpulse(g);if(m){const y=a.contactDist(g),b=a.solverContactFriction(g),_=a.solverContactTangentVelocity(g),x=new zY(m,y,p,v,b,_);f.push(x),kw&&Be.DrawDirection(m,p,16711680,3,!0)}}r=new QY(o,i,f)}if(u){const f={collider:t,component:h,collision:r};this.activeCollisions.push(f),h.onCollisionStay&&this.activeCollisionsStay.push(f),(d=h.onCollisionEnter)==null||d.call(h,r)}}})})}}onHandleCollisionStay(){for(const t of this.activeCollisionsStay){const e=t.component;if(!e.destroyed&&e.activeAndEnabled&&e.onCollisionStay){if(t.collision.collider.destroyed)continue;const i=t.collision;e.onCollisionStay(i)}}for(const t of this.activeTriggers){const e=t.component;if(!e.destroyed&&e.activeAndEnabled&&e.onTriggerStay){const i=t.otherCollider;if(i.destroyed)continue;e.onTriggerStay(i)}}}onCollisionEnded(t,e){if(!(t.destroyed||e.destroyed)){for(let i=0;i<this.activeCollisions.length;i++){const s=this.activeCollisions[i],r=s.collider;if(r.destroyed||s.collision.collider.destroyed){this.activeCollisions.splice(i,1),i--;continue}if(r===t&&s.collision.collider===e){const o=s.component;if(this.activeCollisions.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=s.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeCollisionsStay.length;i++){const s=this.activeCollisionsStay[i],r=s.collider;if(r.destroyed||s.collision.collider.destroyed){this.activeCollisionsStay.splice(i,1),i--;continue}if(r===t&&s.collision.collider===e){const o=s.component;if(this.activeCollisionsStay.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=s.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeTriggers.length;i++){const s=this.activeTriggers[i],r=s.collider;if(r.destroyed||s.otherCollider.destroyed){this.activeTriggers.splice(i,1),i--;continue}if(r===t&&s.otherCollider===e){const o=s.component;if(this.activeTriggers.splice(i,1),i--,o.activeAndEnabled&&o.onTriggerExit){const a=s.otherCollider;o.onTriggerExit(a)}}}}}}class PJ{static async createComparisonScene(t){const{files:e}=t,s=await Promise.all(e.map(v=>new et(v).loadAssetAsync())),r=new ws;let o=0;for(const v of s)if(v instanceof ne){v.position.y=o,r.add(v);const y=sl([v]);o+=y.getSize(new w).y,o+=.1}const a=new bt(20);r.add(a);const l=t.environment||"https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/studio_small_09_1k.exr";if(l){let v=null;if(l.endsWith(".hdr")){const y=(await hh(()=>Promise.resolve().then(()=>pH),void 0,import.meta.url)).RGBELoader;v=new y}else if(l.endsWith(".exr")){const y=(await hh(()=>Promise.resolve().then(()=>fH),void 0,import.meta.url)).EXRLoader;v=new y}if(v){const y=await v.loadAsync(l).catch(b=>(console.error(b),null));y&&(y.mapping=Ya,y.needsUpdate=!0,r.background=y,r.environment=y,r.backgroundBlurriness=.75)}else console.warn("Unsupported environment map format",l)}const h=sl(r.children),u=h.getCenter(new w),d=h.getSize(new w),p=Math.max(d.x,d.y,d.z)/(2*Math.tan(Math.PI*a.fov/360));a.position.set(u.x,u.y,p),a.lookAt(u);const g=new KO(a,t.domElement||document.body);g.target=u,g.update();const m=(t.domElement||document.body).getBoundingClientRect();return a.aspect=m.width/m.height,a.updateProjectionMatrix(),{scene:r,camera:a}}}function MJ(n,t,e,i="image/webp",s){return VY({context:n,width:t,height:e,mimeType:i,camera:s})}function VY(n){n||(n={});const{mimeType:t="image/png",transparent:e=!1}=n;let{context:i,width:s,height:r,camera:o}=n;if(!i&&(i=xt.Current,!i))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!o&&(o=i.mainCamera,!o))return console.error("No camera found"),null;const a=i.renderer.domElement.width,l=i.renderer.domElement.height;s||(s=a),r||(r=l);const h=window.devicePixelRatio||1;s/=h,r/=h;const u=i.renderer.xr.enabled;i.renderer.xr.enabled=!1,i.renderer.domElement.style.width=s+"px",i.renderer.domElement.style.height=r+"px";const d=i.renderer.getRenderTarget(),f=i.renderer.getClearColor(new be),p=i.renderer.getClearAlpha(),g=i.scene.background,m="aspect"in o?o.aspect:null;try{const v=i.renderer.domElement,y=n.render_events!==!1,b=new Array;y&&(Rm(i.scene,li,b),b.forEach(E=>E==null?void 0:E.onBeforeRender())),e&&(i.scene.background=null,i.renderer.setClearColor(0,0)),n.background&&(i.scene.background=null,i.renderer.setClearColor(n.background),n.background instanceof Ut&&i.renderer.setClearAlpha(n.background.a)),e&&i.renderer.setClearAlpha(0),i.renderer.setSize(s,r,!1),"cam"in o&&(o=o.cam),o instanceof bt&&(o.aspect=s/r,o.updateProjectionMatrix());const _="type"in n&&n.type==="texture";let x=null;if(_&&(x=new Et(s,r,{wrapS:Xv,wrapT:Xv,format:1023}),i.renderer.setRenderTarget(x)),i.renderNow(o||null),y&&b.forEach(E=>E.onAfterRender()),"type"in n&&n.type==="texture")return x?(n.target&&(n.target.image=x==null?void 0:x.texture.image,n.target.needsUpdate=!0),x.texture.offset.set(0,-1),x.texture.needsUpdate=!0,x.texture):(console.error("No target texture found"),null);const S=v.toDataURL(t);return"download_filename"in n&&n.download_filename&&WY(S,n.download_filename),S}finally{i.renderer.setRenderTarget(d),i.scene.background=g,i.renderer.setSize(a,l,!1),i.updateSize(!0),i.renderer.setClearColor(f,p),m!=null&&o instanceof bt&&(o.aspect=m,o.updateProjectionMatrix()),i.renderer.xr.enabled=u}return null}let Fp=null;function WY(n,t){if(n){if(!n.startsWith("data:image")){console.error("Can not save image: Data url is not an image",n);return}Fp||(Fp=document.createElement("a")),Fp.href=n,Fp.download=t,Fp.click()}}let IC=0;function pP(n){n?IC++:IC--}function kJ(){return IC>0}class LL{constructor(t){c(this,"writer");this.writer=t}writeNode(t){}}class qY extends LL{beforeWriteNode(t,e){Be.isGizmo(t)&&(e.keep=!1)}}class XY extends LL{beforeWriteTexture(t,e){t.isRenderTargetTexture&&(e.newTexture=WS(new Ut(1,1,1,0)))}}const YY={binary:!0,animations:!0};async function DJ(n){if(!n.context)throw new Error("No context provided to exportAsGLTF");n.scene||(n.scene=n.context.scene);const t={...YY,...n},{context:e}=t,i=new hb;i.register(a=>new Q2(a)),i.register(a=>new qY(a)),i.register(a=>new XY(a)),E2(i,t.context);const s={binary:t.binary,animations:JY(e,t.scene,[])},r=new KY;console.log("Exporting GLTF",s),r.onBeforeExport(t),pP(!0);const o=await i.parseAsync(t.scene,s).catch(a=>(console.error(a),null));if(pP(!1),r.onAfterExport(t),!o)throw new Error("Failed to export GLTF");if(t.downloadAs!=null){let a=null;if(o instanceof ArrayBuffer?a=new Blob([o],{type:"application/octet-stream"}):console.error("Can not download GLTF as a blob",o),a){const l=URL.createObjectURL(a),h=document.createElement("a");h.href=l;let u=t.downloadAs;!u.endsWith(".glb")&&!u.endsWith(".gltf")&&(u+=t.binary?".glb":".gltf"),h.download=u,h.click()}}return o}const gP=Symbol("needle:weight");class KY{constructor(){c(this,"_undo",[])}onBeforeExport(t){t.context.animations.mixers.forEach(e=>{const i=sm.tryGetActionsFromMixer(e);if(i)for(let s=0;s<i.length;s++){const r=i[s];r[gP]=r.weight,r.weight=0,this._undo.push(()=>{r.weight=r[gP]})}e.update(0)})}onAfterExport(t){this._undo.forEach(e=>e()),this._undo.length=0}}function JY(n,t,e){n.animations.mixers.forEach(s=>{const r=sm.tryGetActionsFromMixer(s);if(r)for(let o=0;o<r.length;o++){const l=r[o].getClip();e.push(l)}}),Array.isArray(t)||(t=[t]);for(const s of t)sm.tryGetAnimationClipsFromObjectHierarchy(s,e);const i=new Set(e);return Array.from(i)}const mP="needle-button",Ow=ve();var au,lu,cu,Qs,Ll,wf,o0,UL,a0,NL,bm;class FL extends HTMLElement{constructor(){super();Qi(this,o0);Qi(this,a0);Qi(this,au,void 0);Qi(this,lu,void 0);Qi(this,cu,void 0);Qi(this,Qs,void 0);Qi(this,Ll,void 0);Qi(this,wf,void 0);Qi(this,bm,e=>{Ow&&console.log("Needle Button clicked"),!e.defaultPrevented&&ke(this,Qs)&&ke(this,Qs).click()});this.removeEventListener("click",ke(this,bm)),this.addEventListener("click",ke(this,bm))}attributeChangedCallback(e,i,s){Mh(this,o0,UL).call(this)}}au=new WeakMap,lu=new WeakMap,cu=new WeakMap,Qs=new WeakMap,Ll=new WeakMap,wf=new WeakMap,o0=new WeakSet,UL=function(){var i,s;if((i=ke(this,Qs))==null||i.remove(),this.getAttribute("ar")!=null)ke(this,Ll)??ji(this,Ll,new rh),ji(this,Qs,ke(this,Ll).createARButton());else if(this.getAttribute("vr")!=null)ke(this,Ll)??ji(this,Ll,new rh),ji(this,Qs,ke(this,Ll).createVRButton());else if(this.getAttribute("quicklook")!=null)ke(this,Ll)??ji(this,Ll,new rh),ji(this,Qs,ke(this,Ll).createQuicklookButton());else{Ow?console.warn("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute."):console.debug("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute.");return}ke(this,au)??ji(this,au,this.attachShadow({mode:"open"})),ke(this,lu)??ji(this,lu,document.createElement("slot")),ke(this,cu)??ji(this,cu,document.createElement("style")),ke(this,cu).innerHTML=`
            button {
                all: initial;
                cursor: inherit;
                color: inherit;
                font-family: inherit;
                gap: inherit;
                white-space: nowrap;
            }
        `,this.getAttribute("unstyled")!=null||(ke(this,cu).innerHTML+=`
            :host {
                display: inline-block;
                background: rgba(255, 255, 255, .8);
                backdrop-filter: blur(10px);
                width: fit-content;
                transition: background .2s;

                cursor: pointer;
                padding: 0.4rem .5rem;
                border-radius: 0.8rem;
                color: black;
                background: rgba(245, 245, 245, .8);
                outline: rgba(0,0,0,.05) 1px solid;
            }
            :host(:hover) {
                background: rgba(255, 255, 255, 1);
                transition: background .2s;
            }
            slot {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: .5rem;
            }
`),ke(this,lu).innerHTML=ke(this,Qs).innerHTML,ke(this,lu).style.cssText="display: flex; align-items: center; justify-content: center;",ke(this,Qs).innerHTML=ke(this,lu).outerHTML,ke(this,au).innerHTML=ke(this,Qs).outerHTML,ke(this,au).prepend(ke(this,cu)),my(Nx,{element:ke(this,au)}),(s=ke(this,wf))==null||s.disconnect(),ke(this,wf)??ji(this,wf,new MutationObserver(()=>Mh(this,a0,NL).call(this))),ke(this,wf).observe(ke(this,Qs),{attributes:!0}),Ow&&console.log("Needle Button updated")},a0=new WeakSet,NL=function(){ke(this,Qs)&&(ke(this,Qs).style.display==="none"?this.style.display="none":this.style.display==="none"&&(this.style.display=""))},bm=new WeakMap,c(FL,"observedAttributes",["ar","vr","quicklook"]);typeof window<"u"&&!window.customElements.get(mP)&&window.customElements.define(mP,FL);const Wy=z("debugmissingcamera");xt.registerCallback(dt.MissingCamera,n=>{var a,l,h;Wy&&console.warn("Creating missing camera");const t=n.context.scene,e=new bt;e.name="Default Fallback Camera",t.add(e);const i=new Bt;i.sourceId=((l=(a=n.files)==null?void 0:a[0])==null?void 0:l.src)??"unknown",(h=n.context.domElement.getAttribute("skybox-image"))!=null&&h.length||0>0||n.context.lightmaps.tryGetSkybox(i.sourceId)?i.clearFlags=hr.Skybox:i.clearFlags=hr.SolidColor,i.backgroundColor=new Ut(.5,.5,.5,1),i.fieldOfView=35,n.context.domElement.getAttribute("transparent")!=null&&(i.clearFlags=hr.Uninitialized),i.backgroundBlurriness=.2;const r=uf(e,i,!0);e.position.x=0,e.position.y=1,e.position.z=2;const o=n.context.domElement;return(o==null?void 0:o.cameraControls)!=!1&&zL(n.context,r),r});xt.registerCallback(dt.ContextCreated,n=>{if(!n.context.mainCamera){Wy&&console.log("Will not auto-fit because a default camera exists");return}const t=n.context.domElement;if((t==null?void 0:t.cameraControls)==!0){const e=oz(n.context.mainCamera);if((e==null?void 0:e.isCameraController)==!0){Wy&&console.log("Will not auto-fit because a camera controller exists");return}zL(n.context)}});function zL(n,t){t=t??n.mainCameraComponent;const e=t==null?void 0:t.gameObject;if(Wy&&console.log("Creating default camera controls",t==null?void 0:t.name),e){const i=R0(e,Lt);i.sourceId=(t==null?void 0:t.sourceId)??"unknown";const s=n.domElement.getAttribute("auto-rotate");if(i.autoRotate=s!=null&&s!="0"&&(s==null?void 0:s.toLowerCase())!="false",i.autoRotateSpeed=.5,i.autoFit=!0,i.autoRotate&&s){const r=parseFloat(s);isNaN(r)||(i.autoRotateSpeed=r)}}else console.warn("Missing camera object, can not add orbit controls")}const nd={Context:je,glTF:{loadFromURL:mL}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported");globalThis.Needle=nd;function QL(n){for(const t in n)nd[t]=n[t]}QL(QV);QL(hY);nd.onStart=JO;nd.onUpdate=ZO;nd.onBeforeRender=i9;nd.NeedleXRSession=Le;for(const n of Object.getOwnPropertyNames(Q))switch(n){case"prototype":case"constructor":case"length":case"name":continue;default:nd[n]=Q[n];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=aU;export{BJ as $physicsKey,Ct as ActionBuilder,qO as ActionCollection,cr as ActionModel,j6 as Addressables,U0 as AlignmentConstraint,La as AmbientMode,Ws as Animation,Ko as AnimationCurve,H0 as AnimationExtension,tE as AnimationTrackHandler,sm as AnimationUtils,Cs as Animator,Qc as AnimatorConditionMode,vo as AnimatorController,Xx as AnimatorControllerParameterType,GA as AnimatorStateInfo,W0 as Antialiasing,Ja as Application,du as ApplicationEvents,w5 as AssetDatabase,et as AssetReference,Qu as AudioExtension,vu as AudioListener,kt as AudioSource,ff as AudioTrackHandler,Su as Avatar,Gf as AvatarBlink_Simple,sh as AvatarEyeLook_Rotation,c2 as AvatarLoader,bn as AvatarMarker,lE as AvatarModel,Sy as Avatar_Brain_LookAt,Y0 as Avatar_MouthShapes,l2 as Avatar_MustacheShake,Jl as Avatar_POI,Ud as Axes,Um as AxesHelper,nk as BUILD_TIME,na as BaseUIComponent,h2 as BasicIKConstraint,hE as BehaviorExtension,hn as BehaviorModel,re as Behaviour,Zl as BloomEffect,Hu as BoxCollider,Vf as BoxGizmo,qo as BoxHelperComponent,wh as Button,Ha as ButtonsFactory,Ql as CallDirection,Nl as CallInfo,Bt as Camera,wy as CameraTargetReachedEvent,En as Canvas,Eu as CanvasGroup,fh as CapsuleCollider,Vl as ChangeMaterialOnClick,Wf as ChangeTransformOnClick,qf as CharacterController,Ch as CharacterControllerInput,tb as ChromaticAberration,_o as CircularBuffer,hr as ClearFlags,va as ClipExtrapolation,Eo as Collider,QY as Collision,by as CollisionDetectionMode,Wu as ColorAdjustments,Xf as ColorBySpeedModule,sb as ColorOverLifetimeModule,re as Component,im as ComponentEvents,I0 as ComponentLifecycleEvents,yx as ConnectionEvents,zY as ContactPoint,yo as ContactShadows,je as Context,tJ as ContextArgs,dt as ContextEvent,xt as ContextRegistry,iE as ControlTrackHandler,Yu as CustomBranding,eo as CustomShader,am as DefaultReflectionMode,L2 as Deletable,_E as DeleteBox,hl as DepthOfField,wE as DeviceFlag,F2 as DocumentExtension,_n as DragControls,gs as DragMode,Zu as DropListener,Eh as Duplicatable,Fy as EffectWrapper,gc as EmissionModule,Hm as EmphasizeOnClick,Fv as EngineLoadingView,$t as EventList,KS as EventListEvent,kr as EventSystem,SE as EventTrigger,R2 as FieldWithDefault,dg as FileReference,W6 as FileReferenceSerializer,o7 as FileSpawnModel,Oy as File_Event,U2 as FixedJoint,N2 as FlyControls,qm as Fog,We as FrameEvent,gS as GENERATOR,Q as GameObject,Be as Gizmos,Ua as GltfExport,G2 as GltfExportBox,vf as GltfLoadEvent,ah as GltfLoadEventType,qu as Gradient,$l as Graphic,ZS as GraphicRaycaster,Go as Graphics,Xm as GridHelper,A2 as GridLayoutGroup,bh as GroundProjectedEnv,Zc as GroupActionModel,ST as HideFlags,v2 as HideOnStart,cb as HingeJoint,m2 as HorizontalLayoutGroup,KK as HostData,jm as Image,ug as ImageReference,V6 as ImageReferenceSerializer,mc as InheritVelocityModule,l8 as Input,Br as InputEventQueue,ft as InputEvents,ho as InputField,gf as InstanceHandle,pf as InstancingHandler,ea as InstancingUtil,Pf as InstantiateEvent,Sn as InstantiateIdProvider,ll as InstantiateOptions,O2 as Interactable,HK as JoinedRoomResponse,QK as KeyEventArgs,ur as Keyframe,db as LODGroup,Jf as LODModel,VK as LeftRoomResponse,Gr as Light,TH as LightData,un as LimitVelocityOverLifetimeModule,iJ as LoadingElementOptions,H2 as LogStats,Xi as LogType,ec as LookAt,jf as LookAtConstraint,Es as MainModule,qx as MarkerType,J0 as MaskableGraphic,ye as Mathf,Hf as MeshCollider,nb as MeshRenderer,Ce as MinMaxCurve,wn as MinMaxGradient,ht as NEEDLE_progressive,vA as NEKeyboardEvent,Oc as NEPointerEvent,FL as NeedleButtonElement,xt as NeedleEngine,wL as NeedleEngineHTMLElement,uL as NeedleGltfLoader,vc as NeedleMenu,Kb as NeedlePatchesKey,IV as NeedleUSDZExporter,Vk as NeedleXRController,Le as NeedleXRSession,n5 as NeedleXRSync,m5 as NeedleXRUtils,BE as NestedGltf,i5 as NetworkConnection,Bi as NetworkedStreamEvents,X0 as NetworkedStreams,gh as Networking,W5 as NewInstanceModel,Nt as NoiseModule,xo as ObjectRaycaster,Fu as ObjectUtils,Zf as OffsetConstraint,jb as OneEuroFilter,jM as OneEuroFilterXYZ,Km as OpenURL,Lt as OrbitControls,zm as Outline,us as OwnershipEvent,UD as OwnershipModel,Vu as Padding,By as ParticleBurst,NE as ParticleSubEmitter,wi as ParticleSystem,$u as ParticleSystemBaseBehaviour,aa as ParticleSystemRenderer,zs as ParticleSystemShapeType,Ag as PeerHandle,$8 as PeerNetworking,lg as Physics,vE as PhysicsExtension,mn as PhysicsMaterialCombine,_b as PixelationEffect,Wa as PlayAnimationOnClick,Iu as PlayAudioOnClick,$a as PlayableDirector,fm as PlayerColor,Jn as PlayerState,Zx as PlayerStateEvent,ju as PlayerSync,yH as PlayerView,bH as PlayerViewManager,Om as PointerEventData,Kc as PointerType,ns as PostProcessingEffect,zE as PostProcessingHandler,Ib as PostProcessingManager,Vm as PreliminaryAction,$0 as PreliminaryTrigger,Yo as PrimitiveType,at as Progress,QC as PromiseAllWithErrors,I1 as PromiseErrorResult,Ut as RGBAColor,bd as RapierPhysics,pE as RawImage,rc as RaycastOptions,f2 as Rect,es as RectTransform,Wl as ReflectionProbe,nE as RegisteredAnimationInfo,cc as RemoteSkybox,gu as RenderTexture,JV as RenderTextureSerializer,li as Renderer,IH as RendererData,Iy as RendererLightmap,It as Rigidbody,ki as RigidbodyConstraints,Qe as RoomEvents,Io as RotationBySpeedModule,oa as RotationOverLifetimeModule,eC as SceneLightSettings,Pn as SceneSwitcher,ed as ScreenCapture,Ih as ScreenSpaceAmbientOcclusion,dl as ScreenSpaceAmbientOcclusionN8,Ho as SendQueue,nO as SerializationContext,co as SetActiveOnClick,xb as ShadowCatcher,Zt as ShapeModule,wb as SharpeningEffect,Q0 as SignalAsset,nh as SignalReceiver,Fm as SignalReceiverEvent,xy as SignalTrackHandler,d2 as Size,mr as SizeBySpeedModule,Xu as SizeOverLifetimeModule,B2 as SkinnedMeshRenderer,tl as SmoothFollow,Au as SpatialGrabRaycaster,Sb as SpatialHtml,wu as SpatialTrigger,tc as SpatialTriggerReceiver,jE as SpectatorCamera,Nm as SphereCollider,QD as SphereIntersection,jY as SphereOverlapResult,Ac as Sprite,el as SpriteData,jr as SpriteRenderer,Ru as SpriteSheet,gJ as StateMachineBehaviour,o2 as StreamEndedEvent,G9 as StreamReceivedEvent,jy as SubEmitterSystem,Af as SyncedCamera,fl as SyncedRoom,oc as SyncedTransform,y2 as TapGestureTrigger,AE as TeleportTarget,aL as TestRunner,PJ as TestSceneUtils,lL as TestSimulateUserData,Zs as Text,yE as TextBuilder,ob as TextExtension,Is as TextureSheetAnimationModule,bc as TiltShiftEffect,RH as Time,ac as ToneMappingEffect,j0 as TrackHandler,xr as TrackType,Ci as TrailModule,ln as TransformData,ip as TransformGizmo,$n as TriggerBuilder,Kl as TriggerModel,D as TypeStore,$S as UIRaycastUtils,N0 as UIRootComponent,_s as USDObject,SV as USDWriter,ai as USDZExporter,ru as USDZText,bE as USDZUIExtension,RT as Upload_Result,ZV as UriSerializer,ab as UsageMarker,WK as UserJoinedOrLeftRoomModel,Xo as VERSION,WO as VariantAction,Pi as VelocityOverLifetimeModule,g2 as VerticalLayoutGroup,In as VideoPlayer,Yl as ViewDevice,np as Vignette,eb as VisibilityAction,Gu as Voip,Ib as Volume,me as VolumeParameter,V0 as VolumeProfile,ZK as WaitForFrames,Y6 as WaitForPromise,X6 as WaitForSeconds,$c as Watch,HE as WebARCameraBackground,ph as WebARSessionRoot,Ai as WebXR,rh as WebXRButtonFactory,oh as WebXRImageTracking,_c as WebXRImageTrackingModel,Rh as WebXRPlaneTracking,ou as WebXRTrackedImage,Bh as XRControllerFollow,lc as XRControllerModel,Co as XRControllerMovement,Yn as XRFlag,VE as XRRig,bs as XRState,po as XRStateFlag,hL as __Ignore,C5 as __internalNotifyObjectDestroyed,eh as activeInHierarchyFieldName,vU as addAttributeChangeCallback,Ao as addComponent,vJ as addCustomExtensionPlugin,a7 as addFile,l7 as addFileFromUrl,xJ as addGltfLoadEventListener,uf as addNewComponent,_S as addPatch,zS as apply,TJ as applyHMRChanges,g6 as applyPrototypeExtensions,V5 as beginListenDestroy,c7 as beginListenFileSpawn,q5 as beginListenInstantiate,qk as binaryIdentifierCasts,eJ as build_scene_functions,wd as builtinComponentKeyName,RO as calculateProgress01,dK as clearBalloonMessages,dK as clearOverlayMessages,oJ as colorSerializer,t6 as compareAssociation,V_ as componentSerializer,vz as copyTexture,gL as createLoader,y9 as createMotion,nr as debugNet,SA as debugOwner,p0 as deepClone,sc as delay,UC as delayForFrames,Ix as deserializeObject,wo as destroy,T6 as destroyComponentInstance,ii as disposeObjectResources,Hl as disposeStream,Q6 as download,AO as download_file,_v as editorGuidKeyName,GB as effectsOrder,rf as enableSpatialConsole,aJ as euler,lJ as eventListSerializer,DJ as exportAsGLTF,M0 as findByGuid,NS as findObjectOfType,R6 as findObjectsOfType,WD as findResourceUsers,wz as fitObjectIntoVolume,Df as foreachComponent,jS as foreachComponentEnumerator,gK as forward,_U as generateQRCode,DS as generateSeed,sl as getBoundingBox,oz as getCameraController,Qf as getComponent,P0 as getComponentInChildren,uy as getComponentInParent,B0 as getComponents,Rm as getComponentsInChildren,US as getComponentsInParent,bV as getFormattedDate,ys as getIconElement,GT as getIconTexture,cK as getIp,hK as getIpAndLocation,lK as getIpCloudflare,nl as getLoader,R0 as getOrAddComponent,z as getParam,mK as getParentHierarchyPath,aK as getPath,jK as getPeerOptions,Z8 as getPeerjsInstance,YK as getResourceUserCount,hz as getTempColor,Ia as getTempQuaternion,Re as getTempVector,f0 as getUrlParams,_z as getVisibleInCustomShadowRendering,VM as getWorldDirection,WM as getWorldEuler,He as getWorldPosition,Gt as getWorldQuaternion,b0 as getWorldRotation,ri as getWorldScale,th as hasCommercialLicense,IO as hasIndieLicense,Vx as hasPointerEventComponent,pu as hasProLicense,mO as hash,Rz as hideDebugConsole,MV as imageToCanvas,Pm as instantiate,I2 as invokeAfterImportPluginHooks,e8 as invokeXRSessionEnd,$G as invokeXRSessionStart,B6 as isActiveInHierarchy,Bm as isActiveSelf,gU as isAndroidDevice,Az as isAnimationAction,nK as isDebugMode,Gg as isDesktop,kf as isDestroyed,ve as isDevEnvironment,XK as isDisposed,kJ as isExporting,lU as isHostedOnGlitch,SJ as isHotReloading,MH as isIconElement,fr as isLocalNetwork,E1 as isMacOS,dc as isMobileDevice,sf as isMozillaXR,zC as isQuest,x5 as isResourceTrackingEnabled,eg as isSafari,QS as isUsingInstancing,uh as isiOS,mL as loadSync,Kw as logHierarchy,pK as lookAtInverse,y0 as lookAtObject,rK as makeId,uU as makeIdFromRandomWords,ol as makeNameSafeForUSD,P6 as markAsInstancedRendered,hA as microphonePermissionsGranted,iK as nameof,cU as nameofFactory,qV as objectSerializer,FK as offXRSessionEnd,LK as offXRSessionStart,fJ as onAfterRender,i9 as onBeforeRender,uJ as onClear,dJ as onDestroy,hJ as onInitialized,JO as onStart,ZO as onUpdate,Gk as onXRSessionEnd,CS as onXRSessionStart,yY as parseSync,xz as placeOnSurface,KM as postprocessFBXMaterials,pJ as prefix,hU as pushState,oK as randomNumber,Xk as registerBinaryType,qS as registerComponent,C2 as registerComponentExtension,ra as registerCustomEffectType,E2 as registerExportExtensions,S2 as registerExtensions,EJ as registerHotReloadType,VP as registerLoader,Y5 as registerPrefabProvider,m6 as registerPrototypeExtensions,JK as registerType,fU as relativePathPrefix,yU as removeAttributeChangeCallback,aO as removeComponent,yJ as removeCustomImportExtensionType,CJ as removeGltfLoadEventListener,xK as removePatch,Du as resolveUrl,dU as sanitizeString,WY as saveImage,MJ as screenshot,VY as screenshot2,ZD as sendDestroyed,A as serializable,a6 as serializeObject,km as serializeable,kv as setActive,CU as setAllowBalloonMessages,uK as setAllowOverlayMessages,z1 as setAutoFitEnabled,N1 as setCameraController,M6 as setDestroyed,vK as setDevEnvironment,HD as setDisposable,ET as setDontDestroy,x1 as setOrAddParamsToUrl,sK as setParam,Gw as setParamWithoutReload,GK as setPeerOptions,qK as setResourceTrackingEnabled,WP as setState,YM as setVisibleInCustomShadowRendering,qM as setWorldEuler,Cn as setWorldPosition,Tf as setWorldPositionXYZ,ia as setWorldQuaternion,HM as setWorldQuaternionXYZW,XM as setWorldRotation,_0 as setWorldRotationXYZ,Kg as setWorldScale,pS as showBalloonError,bi as showBalloonMessage,qt as showBalloonWarning,$M as showDebugConsole,fK as slerp,T0 as syncDestroy,s2 as syncField,$D as syncInstantiate,AK as textureToCanvas,g8 as tryCastBinary,vY as tryDetermineFileTypeFromBinary,AY as tryDetermineFileTypeFromURL,jg as tryFindObject,m8 as tryGetGuid,IJ as unregisterHotReloadType,qP as unwatchWrite,z6 as upload_file,az as useForAutoFit,Ss as validate,NC as watchWrite};
